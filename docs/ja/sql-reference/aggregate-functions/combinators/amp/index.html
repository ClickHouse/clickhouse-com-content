










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="ja">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>コンビネータ | ClickHouseドキュメント</title>
    <link rel="canonical" href="https://clickhouse.com/docs/ja/sql-reference/aggregate-functions/combinators/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "コンビネータ | ClickHouseドキュメント",
"mainEntityOfPage": "https://clickhouse.com/docs/ja/sql-reference/aggregate-functions/combinators/",




"image": "https://clickhouse.com/images/clickhouse-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "ClickHouse, Inc.",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.com/images/logo-400x240.png",
    "width": 400,
    "height": 240
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "コンビネータ | ClickHouseドキュメント",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer,main{display:block}body{margin:0;font-family:Noto Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}ul{margin-bottom:1rem}ul{margin-top:0}ul ul{margin-bottom:0}b,strong{font-weight:bolder}a{text-decoration:none;background-color:transparent}a,a:hover{color:#ff8c00}a:hover{text-decoration:underline}a:not([href]),a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:Hind Siliguri,sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.lead{font-size:1.375rem;font-weight:400}@media(max-width:1200px){.lead{font-size:calc(1.2625rem+.15vw)}}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#495057}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}}.table{width:100%;margin-bottom:8px;color:#212529}.table-primary{background-color:#fff1b8}.table-light{background-color:#fbfcfd}.table-dark{background-color:#ccced0}.table-primary-light{background-color:#fffefb}.table-white{background-color:#fff}.table-black{background-color:#c1c2c3}.table-orange{background-color:#ffdfb8}.table-light-orange{background-color:#fff7ea}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-primary{color:#495057;background-color:#fc0;border-color:#fc0}.btn-primary:focus,.btn-primary:hover{color:#495057;background-color:#d9ad00;border-color:#cca300}.btn-primary:focus{box-shadow:0 0 0 0 rgba(228,185,13,.5)}.btn-primary:disabled{color:#495057;background-color:#fc0;border-color:#fc0}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:focus,.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:focus,.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-primary-light{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-primary-light:focus,.btn-primary-light:hover{color:#495057;background-color:#ffedca;border-color:#ffe9bd}.btn-primary-light:focus{box-shadow:0 0 0 0 rgba(228,225,217,.5)}.btn-primary-light:disabled{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:focus,.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:focus,.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:focus,.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:focus,.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-primary{color:#fc0;border-color:#fc0}.btn-outline-primary:hover{color:#495057;background-color:#fc0;border-color:#fc0}.btn-outline-primary:focus{box-shadow:0 0 0 0 rgba(255,204,0,.5)}.btn-outline-primary:disabled{color:#fc0;background-color:transparent}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-primary-light{color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:hover{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:focus{box-shadow:0 0 0 0 rgba(255,250,240,.5)}.btn-outline-primary-light:disabled{color:#fffaf0;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 hsla(0,0%,100%,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}pre{white-space:pre-wrap}pre{border:1px solid #d6dbdf;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}.container,body{min-width:980px}.table{border-collapse:collapse}.table-dark{color:inherit}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
    <div class="alert alert-primary" role="alert">
      <p class="display-5 mb-2">Help wanted!</p>
      <p class="lead">The following content of this documentation page has been machine-translated. But unlike other websites, it is not done on the fly. This translated text lives on GitHub repository alongside main ClickHouse codebase and waits for fellow native speakers to make it more human-readable. <a href="/docs/en/sql-reference/aggregate-functions/combinators/" class="alert-link">You can also use the original English version as a reference.</a></p>
      <p class="lead">
          <a class="btn btn-lg btn-primary text-white" href="https://github.com/ClickHouse/ClickHouse/edit/master/docs/ja/sql-reference/aggregate-functions/combinators.md" target="_blank" rel="external nofollow noreferrer">
              Help ClickHouse documentation by editing this page
          </a>
      </p>
    </div>

          <h1 id=aggregate_functions_combinators>集計関数コンビネータ<a class=headerlink href=../amp/#aggregate_functions_combinators title="Permanent link"> </a></h1> <p>集計関数の名前には、接尾辞を付加することができます。 これにより、集計関数の動作方法が変更されます。</p> <h2 id=agg-functions-combinator-if>-もし<a class=headerlink href=../amp/#agg-functions-combinator-if title="Permanent link"> </a></h2> <p>The suffix -If can be appended to the name of any aggregate function. In this case, the aggregate function accepts an extra argument – a condition (Uint8 type). The aggregate function processes only the rows that trigger the condition. If the condition was not triggered even once, it returns a default value (usually zeros or empty strings).</p> <p>例: <code class=syntax>sumIf(column, cond)</code>, <code class=syntax>countIf(cond)</code>, <code class=syntax>avgIf(x, cond)</code>, <code class=syntax>quantilesTimingIf(level1, level2)(x, cond)</code>, <code class=syntax>argMinIf(arg, val, cond)</code> など。</p> <p>条件集計関数を使用すると、サブクエリとサブクエリを使用せずに、複数の条件の集計を一度に計算できます。 <code class=syntax>JOIN</code>例えば、Yandexの中。Metricaは、条件付き集計関数を使用してセグメント比較機能を実装します。</p> <h2 id=agg-functions-combinator-array>-配列<a class=headerlink href=../amp/#agg-functions-combinator-array title="Permanent link"> </a></h2> <p>-Arrayサフィックスは、任意の集計関数に追加できます。 この場合、集計関数は ‘Array(T)’ 型(配列)の代わりに ‘T’ 引数を入力します。 集計関数が複数の引数を受け入れる場合、これは同じ長さの配列でなければなりません。 配列を処理する場合、集計関数はすべての配列要素にわたって元の集計関数と同様に機能します。</p> <p>例1: <code class=syntax>sumArray(arr)</code> -すべてのすべての要素を合計します ‘arr’ 配列。 この例では、より簡単に書くことができます: <code class=syntax>sum(arraySum(arr))</code>.</p> <p>例2: <code class=syntax>uniqArray(arr)</code> – Counts the number of unique elements in all ‘arr’ 配列。 これは簡単な方法で行うことができます: <code class=syntax>uniq(arrayJoin(arr))</code> しかし、常に追加することはできません ‘arrayJoin’ クエリに。</p> <p>-Ifと-Arrayを組み合わせることができます。 しかし, ‘Array’ 最初に来なければならない ‘If’. 例: <code class=syntax>uniqArrayIf(arr, cond)</code>, <code class=syntax>quantilesTimingArrayIf(level1, level2)(arr, cond)</code>. この順序が原因で、 ‘cond’ 引数は配列ではありません。</p> <h2 id=agg-functions-combinator-state>-状態<a class=headerlink href=../amp/#agg-functions-combinator-state title="Permanent link"> </a></h2> <p>このコンビネータを適用すると、集計関数は結果の値（例えば、コンビネータの一意の値の数など）を返しません。 <a href=../../reference/amp/#agg_function-uniq>uniq</a> の中間状態である。 <code class=syntax>uniq</code>、これは一意の値の数を計算するためのハッシュテーブルです）。 これは <code class=syntax>AggregateFunction(...)</code> 利用できるため、さらなる処理や保存のテーブルに仕上げを集計します。</p> <p>これらの国は、利用:</p> <ul> <li><a href=../../../../engines/table-engines/mergetree-family/aggregatingmergetree/amp/ >AggregatingMergeTree</a> テーブルエンジン。</li> <li><a href=../../../functions/other-functions/amp/#function-finalizeaggregation>finalizeAggregation</a> 機能。</li> <li><a href=../../../functions/other-functions/amp/#function-runningaccumulate>runningAccumulate</a> 機能。</li> <li><a href=../amp/#aggregate_functions_combinators-merge>-マージ</a> コンビネーター</li> <li><a href=../amp/#aggregate_functions_combinators-mergestate>-MergeState</a> コンビネーター</li> </ul> <h2 id=aggregate_functions_combinators-merge>-マージ<a class=headerlink href=../amp/#aggregate_functions_combinators-merge title="Permanent link"> </a></h2> <p>このコンビネータを適用すると、aggregate関数は中間集計状態を引数として受け取り、状態を結合して集計を終了し、結果の値を返します。</p> <h2 id=aggregate_functions_combinators-mergestate>-MergeState<a class=headerlink href=../amp/#aggregate_functions_combinators-mergestate title="Permanent link"> </a></h2> <p>-Mergeコンビネータと同じ方法で中間集計状態をマージします。 ただし、結果の値を返すのではなく、-Stateコンビネータに似た中間集計状態を返します。</p> <h2 id=agg-functions-combinator-foreach>-ForEach<a class=headerlink href=../amp/#agg-functions-combinator-foreach title="Permanent link"> </a></h2> <p>テーブルの集計関数を、対応する配列項目を集計し、結果の配列を返す配列の集計関数に変換します。 例えば, <code class=syntax>sumForEach</code> 配列の場合 <code class=syntax>[1, 2]</code>, <code class=syntax>[3, 4, 5]</code>と<code class=syntax>[6, 7]</code>結果を返します <code class=syntax>[10, 13, 5]</code> 対応する配列項目を一緒に追加した後。</p> <h2 id=agg-functions-combinator-ordefault>-オルデフォルト<a class=headerlink href=../amp/#agg-functions-combinator-ordefault title="Permanent link"> </a></h2> <p>集計関数の動作を変更します。</p> <p>集計関数に入力値がない場合、このコンビネータを使用すると、戻り値のデータ型のデフォルト値が返されます。 空の入力データを取ることができる集計関数に適用されます。</p> <p><code class=syntax>-OrDefault</code> 他の組合せ器と使用することができる。</p> <p><strong>構文</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=o>&lt;</span><span class=n>aggFunction</span><span class=o>&gt;</span><span class=n>OrDefault</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=w></span>
</code></pre></div> <p><strong>パラメータ</strong></p> <ul> <li><code class=syntax>x</code> — Aggregate function parameters.</li> </ul> <p><strong>戻り値</strong></p> <p>集計するものがない場合は、集計関数の戻り値の型の既定値を返します。</p> <p>型は、使用される集計関数に依存します。</p> <p><strong>例</strong></p> <p>クエリ:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span><span class=w> </span><span class=k>avg</span><span class=p>(</span><span class=nb>number</span><span class=p>),</span><span class=w> </span><span class=n>avgOrDefault</span><span class=p>(</span><span class=nb>number</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>numbers</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=w></span>
</code></pre></div> <p>結果:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─avg(number)─┬─avgOrDefault(number)─┐
│         nan │                    0 │
└─────────────┴──────────────────────┘
</code></pre></div> <p>また <code class=syntax>-OrDefault</code> 他のコンビネータと併用できます。 集計関数が空の入力を受け入れない場合に便利です。</p> <p>クエリ:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span><span class=w> </span><span class=n>avgOrDefaultIf</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>10</span><span class=p>)</span><span class=w></span>
<span class=k>FROM</span><span class=w></span>
<span class=p>(</span><span class=w></span>
<span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>toDecimal32</span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>23</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>x</span><span class=w></span>
<span class=p>)</span><span class=w></span>
</code></pre></div> <p>結果:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─avgOrDefaultIf(x, greater(x, 10))─┐
│                              0.00 │
└───────────────────────────────────┘
</code></pre></div> <h2 id=agg-functions-combinator-ornull>-オルヌル<a class=headerlink href=../amp/#agg-functions-combinator-ornull title="Permanent link"> </a></h2> <p>集計関数の動作を変更します。</p> <p>このコンビネータは、集計関数の結果を <a href=../../../data-types/nullable/amp/ >Null可能</a> データ型。 集計関数に計算する値がない場合は、次の値が返されます <a href=../../../syntax/amp/#null-literal>NULL</a>.</p> <p><code class=syntax>-OrNull</code> 他の組合せ器と使用することができる。</p> <p><strong>構文</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=o>&lt;</span><span class=n>aggFunction</span><span class=o>&gt;</span><span class=n>OrNull</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=w></span>
</code></pre></div> <p><strong>パラメータ</strong></p> <ul> <li><code class=syntax>x</code> — Aggregate function parameters.</li> </ul> <p><strong>戻り値</strong></p> <ul> <li>集計関数の結果は、次のように変換されます。 <code class=syntax>Nullable</code> データ型。</li> <li><code class=syntax>NULL</code>、集約するものがない場合。</li> </ul> <p>タイプ: <code class=syntax>Nullable(aggregate function return type)</code>.</p> <p><strong>例</strong></p> <p>追加 <code class=syntax>-orNull</code> 集計関数の最後に。</p> <p>クエリ:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span><span class=w> </span><span class=n>sumOrNull</span><span class=p>(</span><span class=nb>number</span><span class=p>),</span><span class=w> </span><span class=n>toTypeName</span><span class=p>(</span><span class=n>sumOrNull</span><span class=p>(</span><span class=nb>number</span><span class=p>))</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>numbers</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=nb>number</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>10</span><span class=w></span>
</code></pre></div> <p>結果:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─sumOrNull(number)─┬─toTypeName(sumOrNull(number))─┐
│              ᴺᵁᴸᴸ │ Nullable(UInt64)              │
└───────────────────┴───────────────────────────────┘
</code></pre></div> <p>また <code class=syntax>-OrNull</code> 他のコンビネータと併用できます。 集計関数が空の入力を受け入れない場合に便利です。</p> <p>クエリ:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span><span class=w> </span><span class=n>avgOrNullIf</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>10</span><span class=p>)</span><span class=w></span>
<span class=k>FROM</span><span class=w></span>
<span class=p>(</span><span class=w></span>
<span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>toDecimal32</span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>23</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>x</span><span class=w></span>
<span class=p>)</span><span class=w></span>
</code></pre></div> <p>結果:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─avgOrNullIf(x, greater(x, 10))─┐
│                           ᴺᵁᴸᴸ │
└────────────────────────────────┘
</code></pre></div> <h2 id=agg-functions-combinator-resample>-リサンプリング<a class=headerlink href=../amp/#agg-functions-combinator-resample title="Permanent link"> </a></h2> <p>データをグループに分割し、それらのグループ内のデータを個別に集計できます。 グループは、ある列の値を間隔に分割することによって作成されます。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=o>&lt;</span><span class=n>aggFunction</span><span class=o>&gt;</span><span class=n>Resample</span><span class=p>(</span><span class=k>start</span><span class=p>,</span><span class=w> </span><span class=k>end</span><span class=p>,</span><span class=w> </span><span class=n>step</span><span class=p>)(</span><span class=o>&lt;</span><span class=n>aggFunction_params</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>resampling_key</span><span class=p>)</span><span class=w></span>
</code></pre></div> <p><strong>パラメータ</strong></p> <ul> <li><code class=syntax>start</code> — Starting value of the whole required interval for <code class=syntax>resampling_key</code> 値。</li> <li><code class=syntax>stop</code> — Ending value of the whole required interval for <code class=syntax>resampling_key</code> 値。 全体の区間は含まれていません <code class=syntax>stop</code> 値 <code class=syntax>[start, stop)</code>.</li> <li><code class=syntax>step</code> — Step for separating the whole interval into subintervals. The <code class=syntax>aggFunction</code> これらの部分区間のそれぞれに対して独立に実行されます。</li> <li><code class=syntax>resampling_key</code> — Column whose values are used for separating data into intervals.</li> <li><code class=syntax>aggFunction_params</code> — <code class=syntax>aggFunction</code> 変数。</li> </ul> <p><strong>戻り値</strong></p> <ul> <li>の配列 <code class=syntax>aggFunction</code> 各サブインターバルの結果。</li> </ul> <p><strong>例</strong></p> <p>を考える <code class=syntax>people</code> 次のデータを含むテーブル:</p> <div class=codehilite><pre><span></span><code class=syntax>┌─name───┬─age─┬─wage─┐
│ John   │  16 │   10 │
│ Alice  │  30 │   15 │
│ Mary   │  35 │    8 │
│ Evelyn │  48 │ 11.5 │
│ David  │  62 │  9.9 │
│ Brian  │  60 │   16 │
└────────┴─────┴──────┘
</code></pre></div> <p>のは、その年齢の間隔にある人の名前を取得してみましょう <code class=syntax>[30,60)</code> と <code class=syntax>[60,75)</code>. 年齢に整数表現を使用するので、年齢を取得します <code class=syntax>[30, 59]</code> と <code class=syntax>[60,74]</code> 間隔。</p> <p>配列内の名前を集計するには、 <a href=../../reference/amp/#agg_function-grouparray>グルーパレイ</a> 集計関数。 それは一つの引数を取ります。 私たちの場合、それは <code class=syntax>name</code> 列。 その <code class=syntax>groupArrayResample</code> 関数は、 <code class=syntax>age</code> 年齢別に名前を集計する列。 必要な間隔を定義するために、 <code class=syntax>30, 75, 30</code> の引数 <code class=syntax>groupArrayResample</code> 機能。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span><span class=w> </span><span class=n>groupArrayResample</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>75</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>)(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>people</span><span class=w></span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─groupArrayResample(30, 75, 30)(name, age)─────┐
│ [['Alice','Mary','Evelyn'],['David','Brian']] │
└───────────────────────────────────────────────┘
</code></pre></div> <p>結果を考えてみましょう。</p> <p><code class=syntax>Jonh</code> 彼は若すぎるので、サンプルの外にあります。 他の人は、指定された年齢間隔に従って分配されます。</p> <p>今度は、指定された年齢間隔での人々の総数とその平均賃金を数えましょう。</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span><span class=w></span>
<span class=w>    </span><span class=n>countResample</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>75</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>)(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>avgResample</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>75</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>)(</span><span class=n>wage</span><span class=p>,</span><span class=w> </span><span class=n>age</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>avg_wage</span><span class=w></span>
<span class=k>FROM</span><span class=w> </span><span class=n>people</span><span class=w></span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>┌─amount─┬─avg_wage──────────────────┐
│ [3,2]  │ [11.5,12.949999809265137] │
└────────┴───────────────────────────┘
</code></pre></div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2022 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/c60fd44c5b70c56ff0f9c7fc538e58c6c8186aea" rel="external nofollow noreferrer" target="_blank" class="text-reset">c60fd44c</a>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/ja/sql-reference/aggregate-functions/combinators/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
