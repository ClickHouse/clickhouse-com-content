










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="ja">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>クリックハウス建築の概要 | ClickHouseドキュメント</title>
    <link rel="canonical" href="https://clickhouse.com/docs/ja/development/architecture/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "クリックハウス建築の概要 | ClickHouseドキュメント",
"mainEntityOfPage": "https://clickhouse.com/docs/ja/development/architecture/",




"image": "https://clickhouse.com/images/clickhouse-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "ClickHouse, Inc.",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.com/images/logo-400x240.png",
    "width": 400,
    "height": 240
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "クリックハウス建築の概要 | ClickHouseドキュメント",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer,main{display:block}body{margin:0;font-family:Noto Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}ol,ul{margin-bottom:1rem}ol,ul{margin-top:0}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}a{text-decoration:none;background-color:transparent}a,a:hover{color:#ff8c00}a:hover{text-decoration:underline}a:not([href]),a:not([href]):hover{color:inherit;text-decoration:none}code{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:Hind Siliguri,sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.lead{font-size:1.375rem;font-weight:400}@media(max-width:1200px){.lead{font-size:calc(1.2625rem+.15vw)}}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.blockquote{margin-bottom:8px;font-size:1.25rem}.blockquote-footer{display:block;font-size:80%;color:#6c757d}.blockquote-footer:before{content:"— "}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}.order-md-0{order:0}.order-md-1{order:1}.order-md-2{order:2}.order-md-3{order:3}.order-md-4{order:4}.order-md-5{order:5}.order-md-6{order:6}.order-md-7{order:7}.order-md-8{order:8}.order-md-9{order:9}.order-md-10{order:10}.order-md-11{order:11}.order-md-12{order:12}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}.order-lg-0{order:0}.order-lg-1{order:1}.order-lg-2{order:2}.order-lg-3{order:3}.order-lg-4{order:4}.order-lg-5{order:5}.order-lg-6{order:6}.order-lg-7{order:7}.order-lg-8{order:8}.order-lg-9{order:9}.order-lg-10{order:10}.order-lg-11{order:11}.order-lg-12{order:12}}.table{width:100%;margin-bottom:8px;color:#212529}.table-primary{background-color:#fff1b8}.table-light{background-color:#fbfcfd}.table-dark{background-color:#ccced0}.table-primary-light{background-color:#fffefb}.table-white{background-color:#fff}.table-black{background-color:#c1c2c3}.table-orange{background-color:#ffdfb8}.table-light-orange{background-color:#fff7ea}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-primary{color:#495057;background-color:#fc0;border-color:#fc0}.btn-primary:focus,.btn-primary:hover{color:#495057;background-color:#d9ad00;border-color:#cca300}.btn-primary:focus{box-shadow:0 0 0 0 rgba(228,185,13,.5)}.btn-primary:disabled{color:#495057;background-color:#fc0;border-color:#fc0}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:focus,.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:focus,.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-primary-light{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-primary-light:focus,.btn-primary-light:hover{color:#495057;background-color:#ffedca;border-color:#ffe9bd}.btn-primary-light:focus{box-shadow:0 0 0 0 rgba(228,225,217,.5)}.btn-primary-light:disabled{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:focus,.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:focus,.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:focus,.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:focus,.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-primary{color:#fc0;border-color:#fc0}.btn-outline-primary:hover{color:#495057;background-color:#fc0;border-color:#fc0}.btn-outline-primary:focus{box-shadow:0 0 0 0 rgba(255,204,0,.5)}.btn-outline-primary:disabled{color:#fc0;background-color:transparent}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-primary-light{color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:hover{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:focus{box-shadow:0 0 0 0 rgba(255,250,240,.5)}.btn-outline-primary-light:disabled{color:#fffaf0;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 hsla(0,0%,100%,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}.btn-group{position:relative;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-file{display:inline-block;margin-bottom:0}.custom-file{position:relative;width:100%;height:calc(1.5em+.75rem+2px)}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}blockquote{border:1px solid #d6dbdf;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}.container,body{min-width:980px}.table{border-collapse:collapse}.table-dark{color:inherit}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
    <div class="alert alert-primary" role="alert">
      <p class="display-5 mb-2">Help wanted!</p>
      <p class="lead">The following content of this documentation page has been machine-translated. But unlike other websites, it is not done on the fly. This translated text lives on GitHub repository alongside main ClickHouse codebase and waits for fellow native speakers to make it more human-readable. <a href="/docs/en/development/architecture/" class="alert-link">You can also use the original English version as a reference.</a></p>
      <p class="lead">
          <a class="btn btn-lg btn-primary text-white" href="https://github.com/ClickHouse/ClickHouse/edit/master/docs/ja/development/architecture.md" target="_blank" rel="external nofollow noreferrer">
              Help ClickHouse documentation by editing this page
          </a>
      </p>
    </div>

          <h1 id=overview-of-clickhouse-architecture>クリックハウス建築の概要<a class=headerlink href=../amp/#overview-of-clickhouse-architecture title="Permanent link"> </a></h1> <p>ClickHouseは真の列指向のDBMSです。 データは、列によって、および配列（列のベクトルまたはチャンク）の実行中に格納されます。 可能であれば、個々の値ではなく配列に対して演算が送出されます。 それは呼ばれます “vectorized query execution,” そしてそれは実際のデータ処理の費用を下げるのを助けます。</p> <blockquote> <p>この考え方は、新しいものではない。 それはにさかのぼります <code class=syntax>APL</code> プログラミング言語とその子孫: <code class=syntax>A +</code>, <code class=syntax>J</code>, <code class=syntax>K</code>,and <code class=syntax>Q</code>. 配列プログラミングは科学データ処理で使用されます。 どちらもこの考え方は関係データベースで新しいものではありません。 <code class=syntax>Vectorwise</code> システム</p> </blockquote> <p>クエリ処理の高速化には、ベクトル化されたクエリ実行とランタイムコード生成という二つの方法があります。 後者は、すべての間接および動的ディスパッチを削除します。 ずれのアプローチは厳重によります。 ランタイムコード生成は、多くの操作を融合し、CPU実行単位とパイプラインを完全に利用する場合に優れています。 Vectorizedクエリを実行できる実用的では一時的ベクトルを明記のことは、キャッシュを読みます。 一時データがL2キャッシュに収まらない場合、これが問題になります。 しかし、ベクトル化されたクエリの実行は、CPUのSIMD機能をより簡単に利用します。 A <a href=http://15721.courses.cs.cmu.edu/spring2016/papers/p5-sompolski.pdf rel="external nofollow noreferrer" target=_blank>研究論文</a> 書面による友人達しないことであり、両アプローチ。 ClickHouse用vectorizedクエリを実行して初期支援のためにランタイムコード。</p> <h2 id=columns>列<a class=headerlink href=../amp/#columns title="Permanent link"> </a></h2> <p><code class=syntax>IColumn</code> interfaceは、メモリ内の列（実際には列のチャンク）を表すために使用されます。 このイ 元の列を変更するのではなく、新しい変更された列を作成します。 例えば、 <code class=syntax>IColumn :: filter</code> 法を受け入れフィルタのバイトマスクです。 それはのために使用されます <code class=syntax>WHERE</code> と <code class=syntax>HAVING</code> 関係演算子。 追加の例： <code class=syntax>IColumn :: permute</code> サポートする方法 <code class=syntax>ORDER BY</code> は、 <code class=syntax>IColumn :: cut</code> サポートする方法 <code class=syntax>LIMIT</code>.</p> <p>各種 <code class=syntax>IColumn</code> 実装 (<code class=syntax>ColumnUInt8</code>, <code class=syntax>ColumnString</code> というように）は、列のメモリレイアウトを担当しています。 メモリレイアウトは、通常、連続した配列です。 整数型の列の場合は、次のように連続した配列にすぎません <code class=syntax>std :: vector</code>. のために <code class=syntax>String</code> と <code class=syntax>Array</code> すべての配列要素に対して一つ、連続して配置され、各配列の先頭へのオフセットに対して二つのベクトルです。 また <code class=syntax>ColumnConst</code> これはメモリに一つの値を格納しますが、列のように見えます。</p> <h2 id=field>フィールド<a class=headerlink href=../amp/#field title="Permanent link"> </a></h2> <p>それにもかかわらず、個々の価値を扱うことも可能です。 個々の値を表すために、 <code class=syntax>Field</code> が使用される。 <code class=syntax>Field</code> ただの識別された組合である <code class=syntax>UInt64</code>, <code class=syntax>Int64</code>, <code class=syntax>Float64</code>, <code class=syntax>String</code> と <code class=syntax>Array</code>. <code class=syntax>IColumn</code> は、 <code class=syntax>operator[]</code> n番目の値をaとして取得するメソッド <code class=syntax>Field</code> そして、 <code class=syntax>insert</code> aを追加するメソッド <code class=syntax>Field</code> 列の最後まで。 これらの方法は、一時的な処理を必要とするため、あまり効率的ではありません <code class=syntax>Field</code> 個々の値を表すオブジェクト。 次のようなより効率的な方法があります <code class=syntax>insertFrom</code>, <code class=syntax>insertRangeFrom</code>、というように。</p> <p><code class=syntax>Field</code> テーブルの特定のデータ型に関する十分な情報がありません。 例えば, <code class=syntax>UInt8</code>, <code class=syntax>UInt16</code>, <code class=syntax>UInt32</code>,and <code class=syntax>UInt64</code> すべてとして表されます <code class=syntax>UInt64</code> で <code class=syntax>Field</code>.</p> <h2 id=leaky-abstractions>漏れやすい抽象化<a class=headerlink href=../amp/#leaky-abstractions title="Permanent link"> </a></h2> <p><code class=syntax>IColumn</code> は方法のための共通の関係変容のデータもあるんですが、そのすべて満たす。 例えば, <code class=syntax>ColumnUInt64</code> 二つの列の合計を計算する方法がありません。 <code class=syntax>ColumnString</code> 部分文字列検索を実行するメソッドがありません。 これらの無数のルーチンは <code class=syntax>IColumn</code>.</p> <p>列のさまざまな関数は、次のようにして、一般的で非効率的な方法で実装できます <code class=syntax>IColumn</code> 抽出する方法 <code class=syntax>Field</code> 値、または特定のデータの内部メモリレイアウトの知識を使用して特殊な方法で <code class=syntax>IColumn</code> 実装。 で実施する鋳造機能を特定 <code class=syntax>IColumn</code> 内部表現を直接入力して処理します。 例えば, <code class=syntax>ColumnUInt64</code> は、 <code class=syntax>getData</code> 内部配列への参照を返すメソッドは、別のルーチンが直接その配列を読み取るか、または塗りつぶします。 我々は持っている “leaky abstractions” さまざまなルーチンの効率的な専門化を可能にする。</p> <h2 id=data_types>データ型<a class=headerlink href=../amp/#data_types title="Permanent link"> </a></h2> <p><code class=syntax>IDataType</code> 列または個々の値のチャンクをバイナリ形式またはテキスト形式で読み書きするためのものです。 <code class=syntax>IDataType</code> テーブル内のデータ型に直接対応します。 例えば、次のものがあります <code class=syntax>DataTypeUInt32</code>, <code class=syntax>DataTypeDateTime</code>, <code class=syntax>DataTypeString</code> など。</p> <p><code class=syntax>IDataType</code> と <code class=syntax>IColumn</code> 互いに緩やかに関連しているだけです。 異なるデータ型は、同じメモリで表すことができます <code class=syntax>IColumn</code> 実装。 例えば, <code class=syntax>DataTypeUInt32</code> と <code class=syntax>DataTypeDateTime</code> で表される。 <code class=syntax>ColumnUInt32</code> または <code class=syntax>ColumnConstUInt32</code>. また、同じデータ型で表現することができな <code class=syntax>IColumn</code> 実装。 例えば, <code class=syntax>DataTypeUInt8</code> で表すことができる <code class=syntax>ColumnUInt8</code> または <code class=syntax>ColumnConstUInt8</code>.</p> <p><code class=syntax>IDataType</code> 貨物のメタデータを指すものとします。 例えば, <code class=syntax>DataTypeUInt8</code> 何も保存しません(vptrを除きます)。 <code class=syntax>DataTypeFixedString</code> ちょうど店 <code class=syntax>N</code> (固定サイズの文字列のサイズ)。</p> <p><code class=syntax>IDataType</code> はヘルパーの方法のための様々なデータフォーマット たとえば、クォート可能な値をシリアル化したり、JSONの値をシリアル化したり、XML形式の一部として値をシリアル化したりするメソッドがあります。 データ形式への直接の対応はありません。 たとえば、異なるデータ形式 <code class=syntax>Pretty</code> と <code class=syntax>TabSeparated</code> 同じを使用できます <code class=syntax>serializeTextEscaped</code> からのヘルパーメソッド <code class=syntax>IDataType</code> インタフェース</p> <h2 id=block>ブロック<a class=headerlink href=../amp/#block title="Permanent link"> </a></h2> <p>A <code class=syntax>Block</code> メモリ内のテーブルのサブセット（チャンク）を表すコンテナです。 それは単なるトリプルのセットです: <code class=syntax>(IColumn, IDataType, column name)</code>. クエリの実行中、データは次の方法で処理されます <code class=syntax>Block</code>s.私達にaがあれば <code class=syntax>Block</code>,我々はデータを持っている(で <code class=syntax>IColumn</code> そのタイプに関する情報があります <code class=syntax>IDataType</code>）それはその列をどのように扱うかを教えてくれます。 これは、テーブルの元の列名か、一時的な計算結果を取得するために割り当てられた人工的な名前のいずれかです。</p> <p>ブロック内の列に対して関数を計算するとき、その結果を含む別の列をブロックに追加します。 後で、不要な列はブロックから削除できますが、変更はできません。 共通の部分式を排除するのに便利です。</p> <p>ブロックの作成のための各処理チャンクのデータです。 同じタイプの計算では、列名と型は異なるブロックで同じままであり、列データのみが変更されることに注意してください。 ブロックサイズが小さいと、shared_ptrsと列名をコピーするための一時的な文字列のオーバーヘッドが高くなるため、ブロックヘッダーからブロックデータを分割</p> <h2 id=block-streams>ブロックの流れ<a class=headerlink href=../amp/#block-streams title="Permanent link"> </a></h2> <p>ブロックストリームのための加工データです。 を使用していま流のブロックからデータを読み込むためのどこかに、データ変換、または書き込みデータをどこかということです。 <code class=syntax>IBlockInputStream</code> は、 <code class=syntax>read</code> 利用可能な状態で次のブロックを取得するメソッド。 <code class=syntax>IBlockOutputStream</code> は、 <code class=syntax>write</code> どこかにブロックをプッシュする方法。</p> <p>ストリームは:</p> <ol> <li>テーブルへの読み書き。 のテーブルだけを返しますストリームを読み取りまたは書き込みブロックとなります。</li> <li>データ形式の実装。 たとえば、端末にデータを出力する場合は <code class=syntax>Pretty</code> 書式設定すると、ブロックをプッシュするブロック出力ストリームを作成し、書式設定します。</li> <li>データ変換の実行。 あなたが持っているとしよう <code class=syntax>IBlockInputStream</code> いを作ろうというストリームです。 作成する <code class=syntax>FilterBlockInputStream</code> ストリームで初期化します その後、ブロックを引っ張るときから <code class=syntax>FilterBlockInputStream</code> で引きブロックからストリーム、フィルタでは、フィルタを返しますブロックします。 クエリの実行パイプラインで表現しました。</li> </ol> <p>より洗練された変換があります。 例えば、 <code class=syntax>AggregatingBlockInputStream</code> で読み込みのすべてのデータからのフレームワークを利用して、集合体で、それを返しますストリームの集約トへすでに使用されています。 別の例: <code class=syntax>UnionBlockInputStream</code> コンストラクタ内の多くの入力ソースと多数のスレッドを受け入れます。 複数のスレッドを起動し、複数のソースから並列に読み込みます。</p> <blockquote> <p>ブロックストリームは “pull” 制御フローへのアプローチ：最初のストリームからブロックをプルすると、ネストされたストリームから必要なブロックがプルされ、実行パイプライン全体 どちらも “pull” また “push” 制御フローは暗黙的であり、複数のクエリの同時実行（多くのパイプラインをマージする）などのさまざまな機能の実装を制限するため、最良の解決策で この制限は、コルーチンまたはお互いを待つ余分なスレッドを実行するだけで克服できます。 つまり、ある計算単位から別の計算単位の外部にデータを渡すロジックを見つけると、制御フローを明示的にすると、より多くの可能性があります。 これを読む <a href=http://journal.stuffwithstuff.com/2013/01/13/iteration-inside-and-out/ rel="external nofollow noreferrer" target=_blank>記事</a> より多くの思考のため。</p> </blockquote> <p>クエリ実行パイプラインでは、各ステップで一時データが作成されます。 一時データがCPUキャッシュに収まるように、ブロックサイズを十分に小さくしておきます。 その前提では、一時データの書き込みと読み込みは、他の計算と比較してほとんど自由です。 これは、パイプライン内の多くの操作を一緒に融合させることです。 パイプラインをできるだけ短くし、一時データの多くを削除することができますが、これは利点ですが、欠点もあります。 たとえば、分割パイプラインを使用すると、中間データのキャッシュ、同時に実行される類似クエリからの中間データの盗み、類似クエリのパイプライン</p> <h2 id=formats>形式<a class=headerlink href=../amp/#formats title="Permanent link"> </a></h2> <p>データフォーマットにて実施しブロックわれている。 そこには “presentational” 次のように、クライアントへのデータ出力にのみ適した形式になります <code class=syntax>Pretty</code> のみを提供する形式 <code class=syntax>IBlockOutputStream</code>. そして入出力フォーマットが、のようなあります <code class=syntax>TabSeparated</code> または <code class=syntax>JSONEachRow</code>.</p> <p>行ストリームもあります: <code class=syntax>IRowInputStream</code> と <code class=syntax>IRowOutputStream</code>. ブロックではなく、個々の行でデータをプル/プッシュすることができます。 また、行指向形式の実装を簡素化するためにのみ必要です。 ラッパー <code class=syntax>BlockInputStreamFromRowInputStream</code> と <code class=syntax>BlockOutputStreamFromRowOutputStream</code> 行指向のストリームを通常のブロック指向のストリームに変換できます。</p> <h2 id=io>I/O<a class=headerlink href=../amp/#io title="Permanent link"> </a></h2> <p>バイト指向の入出力には、次のようなものがあります <code class=syntax>ReadBuffer</code> と <code class=syntax>WriteBuffer</code> 抽象クラス。 それらはC++の代わりに使用されます <code class=syntax>iostream</code>心配しないでください：すべての成熟したC++プロジェクトは、 <code class=syntax>iostream</code>正当な理由のためのs。</p> <p><code class=syntax>ReadBuffer</code> と <code class=syntax>WriteBuffer</code> 単なる連続したバッファであり、そのバッファ内の位置を指すカーソルです。 実装にはない独自のメモリにバッファです。 以下のデータでバッファを埋める仮想メソッドがあります <code class=syntax>ReadBuffer</code>）またはバッファをどこかにフラッシュする（ <code class=syntax>WriteBuffer</code>). 仮想メソッドはまれに呼び出されます。</p> <p>の実装 <code class=syntax>ReadBuffer</code>/<code class=syntax>WriteBuffer</code> 圧縮を実装するために、ファイルとファイル記述子とネットワークソケッ (<code class=syntax>CompressedWriteBuffer</code> is initialized with another WriteBuffer and performs compression before writing data to it), and for other purposes – the names <code class=syntax>ConcatReadBuffer</code>, <code class=syntax>LimitReadBuffer</code>,and <code class=syntax>HashingWriteBuffer</code> 自分のために話す。</p> <p>Read/WriteBuffersはバイトのみを扱います。 からの関数があります <code class=syntax>ReadHelpers</code> と <code class=syntax>WriteHelpers</code> 入力/出力のフォーマットに役立つヘッダファイル。 たとえば、小数の形式で数値を書くヘルパーがあります。</p> <p>結果セットを書きたいときに何が起こるかを見てみましょう <code class=syntax>JSON</code> 標準出力にフォーマットします。 結果セットを取得する準備ができています <code class=syntax>IBlockInputStream</code>. 作成する <code class=syntax>WriteBufferFromFileDescriptor(STDOUT_FILENO)</code> stdoutにバイトを書き込む。 作成する <code class=syntax>JSONRowOutputStream</code>、それで初期化されます <code class=syntax>WriteBuffer</code>、行を書き込むには <code class=syntax>JSON</code> 標準出力に。 作成する <code class=syntax>BlockOutputStreamFromRowOutputStream</code> その上に、それを次のように表します <code class=syntax>IBlockOutputStream</code>. それから電話する <code class=syntax>copyData</code> データを転送するには <code class=syntax>IBlockInputStream</code> に <code class=syntax>IBlockOutputStream</code> そして、すべてが動作します。 内部的には, <code class=syntax>JSONRowOutputStream</code> さまざまなJSON区切り文字を書き、 <code class=syntax>IDataType::serializeTextJSON</code> を参照するメソッド <code class=syntax>IColumn</code> 引数として行番号を指定します。 その結果, <code class=syntax>IDataType::serializeTextJSON</code> からメソッドを呼び出します <code class=syntax>WriteHelpers.h</code>：例えば, <code class=syntax>writeText</code> 数値型および <code class=syntax>writeJSONString</code> のために <code class=syntax>DataTypeString</code>.</p> <h2 id=tables>テーブル<a class=headerlink href=../amp/#tables title="Permanent link"> </a></h2> <p>その <code class=syntax>IStorage</code> インタフェースです。 異なる実装のインタフェースの異なるテーブルエンジンです。 例としては <code class=syntax>StorageMergeTree</code>, <code class=syntax>StorageMemory</code>、というように。 これらのクラスのインスタ</p> <p>キー <code class=syntax>IStorage</code> メソッドは <code class=syntax>read</code> と <code class=syntax>write</code>. また、 <code class=syntax>alter</code>, <code class=syntax>rename</code>, <code class=syntax>drop</code>、というように。 その <code class=syntax>read</code> このメソッドは、次の引数を受け入れます。 <code class=syntax>AST</code> 考慮すべきクエリ、および返すストリームの必要な数。 一つまたは複数を返します <code class=syntax>IBlockInputStream</code> クエリの実行中にテーブルエンジン内で完了したデータ処理のステージに関するオブジェクトと情報。</p> <p>ほとんどの場合、readメソッドは、指定された列をテーブルから読み取るだけで、それ以降のデータ処理は行いません。 すべてのデータ処理が行われるクエリの通訳や外部の責任 <code class=syntax>IStorage</code>.</p> <p>しかし、顕著な例外があります:</p> <ul> <li>ASTクエリは <code class=syntax>read</code> 法により処理し、テーブルエンジンを使用できる指の利用と読みの少ないデータを表示します。</li> <li>時々のテーブルエンジンを処理できるデータそのものである場合でも特定の段階にある。 例えば, <code class=syntax>StorageDistributed</code> リモートサーバーにクエリを送信し、異なるリモートサーバーからのデータをマージできるステージにデータを処理するように依頼し、その前処理されたデータを返すこ クエリの通訳を仕上げ加工のデータです。</li> </ul> <p>テーブルの <code class=syntax>read</code> メソッドは、複数の <code class=syntax>IBlockInputStream</code> 並列データ処理を可能にするオブジェクト。 これらの複数のブロックの入力ストリームでテーブルから行なった。 次に、これらのストリームを、独立して計算できるさまざまな変換(式の評価やフィルタリングなど)でラップして、 <code class=syntax>UnionBlockInputStream</code> それらの上に、並列に複数のストリームから読み込みます。</p> <p>また、 <code class=syntax>TableFunction</code>これらは一時的なものを返す関数です <code class=syntax>IStorage</code> で使用するオブジェクト <code class=syntax>FROM</code> クエリの句。</p> <p>テーブルエンジンの実装方法の簡単なアイデアを得るには、次のような単純なものを見てください <code class=syntax>StorageMemory</code> または <code class=syntax>StorageTinyLog</code>.</p> <blockquote> <p>の結果として <code class=syntax>read</code> 方法, <code class=syntax>IStorage</code> ﾂづｩﾂ。 <code class=syntax>QueryProcessingStage</code> – information about what parts of the query were already calculated inside storage.</p> </blockquote> <h2 id=parsers>パーサー<a class=headerlink href=../amp/#parsers title="Permanent link"> </a></h2> <p>手書きの再帰降下パーサーは、クエリを解析します。 例えば, <code class=syntax>ParserSelectQuery</code> クエリのさまざまな部分に対して基になるパーサを再帰的に呼び出すだけです。 パーサーは <code class=syntax>AST</code>. その <code class=syntax>AST</code> ノードによって表されます。 <code class=syntax>IAST</code>.</p> <blockquote> <p>パーサジェネレータは、使用しない歴史的な理由があります。</p> </blockquote> <h2 id=interpreters>通訳者<a class=headerlink href=../amp/#interpreters title="Permanent link"> </a></h2> <p>インタプリタは、クエリ実行パイプラインの作成を担当します。 <code class=syntax>AST</code>. 以下のような簡単な通訳があります <code class=syntax>InterpreterExistsQuery</code> と <code class=syntax>InterpreterDropQuery</code> またはより洗練された <code class=syntax>InterpreterSelectQuery</code>. クエリの実行パイプラインの組み合わせたブロック入力または出力ストリーム. たとえば、 <code class=syntax>SELECT</code> クエリは <code class=syntax>IBlockInputStream</code> 結果セットを読み取るために、INSERTクエリの結果は次のようになります。 <code class=syntax>IBlockOutputStream</code> に挿入するためのデータを書き込むために、および解釈の結果 <code class=syntax>INSERT SELECT</code> クエリは <code class=syntax>IBlockInputStream</code> これは、最初の読み取り時に空の結果セットを返しますが、データをコピーします <code class=syntax>SELECT</code> に <code class=syntax>INSERT</code> 同時に。</p> <p><code class=syntax>InterpreterSelectQuery</code> 用途 <code class=syntax>ExpressionAnalyzer</code> と <code class=syntax>ExpressionActions</code> クエリ分析と変換のための機械。 ここでは、ほとんどのルールベースのクエリの最適化が行われます。 <code class=syntax>ExpressionAnalyzer</code> モジュラー変換やクエリを可能にするために、さまざまなクエリ変換と最適化を別々のクラスに抽出する必要があります。</p> <h2 id=functions>関数<a class=headerlink href=../amp/#functions title="Permanent link"> </a></h2> <p>通常の関数と集計関数があります。 集計関数については、次の節を参照してください。</p> <p>Ordinary functions don't change the number of rows – they work as if they are processing each row independently. In fact, functions are not called for individual rows, but for <code class=syntax>Block</code>ベクトル化されたクエリ実行を実装するためのデータ。</p> <p>いくつかのその他の機能があります。 <a href=../../../sql-reference/functions/other-functions/amp/#function-blocksize>ブロックサイズ</a>, <a href=../../../sql-reference/functions/other-functions/amp/#function-rownumberinblock>rowNumberInBlock</a>,and <a href=../../../sql-reference/functions/other-functions/amp/#function-runningaccumulate>runningAccumulate</a>、それはブロック処理を悪用し、行の独立性に違反します。</p> <p>ClickHouseには強い型指定があるため、暗黙的な型変換はありません。 関数が特定の型の組み合わせをサポートしていない場合、例外がスローされます。 ものの機能で作業する過負荷のもとに多くの異なる組み合わせます。 例えば、 <code class=syntax>plus</code> 関数（実装するには <code class=syntax>+</code> 演算子)数値型の任意の組み合わせに対して動作します: <code class=syntax>UInt8</code> + <code class=syntax>Float32</code>, <code class=syntax>UInt16</code> + <code class=syntax>Int8</code>、というように。 また、一部の可変引数関数は、以下のような任意の数の引数を受け入れることができます。 <code class=syntax>concat</code> 機能。</p> <p>実施の機能が少し不便での機能を明示的に派遣サポートされているデータの種類と対応 <code class=syntax>IColumns</code>. 例えば、 <code class=syntax>plus</code> 関数は、数値型の組み合わせごとにC++テンプレートのインスタンス化によって生成されたコード、および定数または非定数左と右の引数を持っていま</p> <p>テンプレートコードの膨張を避けるために、実行時コード生成を実装するのに最適な場所です。 また、fused multiply-addのようなfused関数を追加したり、一つのループ反復で多重比較を行うこともできます。</p> <p>ベクトル化されたクエリの実行により、関数は短絡されません。 たとえば、 <code class=syntax>WHERE f(x) AND g(y)</code>,両側が計算されます,でも行について,とき <code class=syntax>f(x)</code> がゼロである(場合を除く <code class=syntax>f(x)</code> はゼロ定数式である）。 しかし、の選択性が <code class=syntax>f(x)</code> 条件は高く、計算の <code class=syntax>f(x)</code> よりもはるかに安いです <code class=syntax>g(y)</code>、マルチパス計算を実装する方が良いでしょう。 最初に計算します <code class=syntax>f(x)</code> 次に、結果によって列をフィルター処理し、次に計算します <code class=syntax>g(y)</code> フィルター処理された小さなデータのチャンクのみ。</p> <h2 id=aggregate-functions>集計関数<a class=headerlink href=../amp/#aggregate-functions title="Permanent link"> </a></h2> <p>集計関数はステートフル関数です。 渡された値をある状態に蓄積し、その状態から結果を得ることができます。 それらはと管理されます <code class=syntax>IAggregateFunction</code> インタフェース 状態はかなり単純にすることができます（ <code class=syntax>AggregateFunctionCount</code> ただの単一です <code class=syntax>UInt64</code> 値）または非常に複雑な（の状態 <code class=syntax>AggregateFunctionUniqCombined</code> 線形配列、ハッシュテーブル、およびaの組み合わせです <code class=syntax>HyperLogLog</code> 確率データ構造）。</p> <p>状態は <code class=syntax>Arena</code> (メモリプール)高カーディナリティの実行中に複数の状態を処理する <code class=syntax>GROUP BY</code> クエリ。 たとえば、複雑な集約状態では、追加のメモリを割り当てることができます。 これは、作成し、状態を破壊し、適切にその所有権と破壊命令を渡すためにいくつかの注意が必要です。</p> <p>集約状態をシリアル化および逆シリアル化して、分散クエリの実行中にネットワーク経由で渡したり、十分なRAMがないディスクに書き込んだりできま それらはあるテーブルで貯えることができます <code class=syntax>DataTypeAggregateFunction</code> データの増分集計を可能にする。</p> <blockquote> <p>集計関数状態のシリアル化されたデータ形式は、現在バージョン管理されていません。 集約状態が一時的にのみ格納されていればokです。 しかし、我々は持っている <code class=syntax>AggregatingMergeTree</code> テーブルエンジンが増えた場合の集約、人々に基づき使用されている。 これは、将来集計関数のシリアル化形式を変更するときに下位互換性が必要な理由です。</p> </blockquote> <h2 id=server>サーバ<a class=headerlink href=../amp/#server title="Permanent link"> </a></h2> <p>サーバを実装し複数の複数のインタフェース:</p> <ul> <li>外部クライアント用のHTTPインターフェイス。</li> <li>TCPインタフェースのネイティブClickHouseクライアントとクロス-サーバー通信中に分散クエリを実行します。</li> <li>インターフェース転送データレプリケーション.</li> </ul> <p>内部的には、コルーチンやファイバーのない原始的なマルチスレッドサーバーです。 サーバーは、単純なクエリの割合が高いのではなく、比較的低い複雑なクエリの割合を処理するように設計されているため、それぞれが分析のために膨大</p> <p>サーバーは初期化します <code class=syntax>Context</code> クエリ実行に必要な環境を持つクラス:使用可能なデータベース、ユーザーとアクセス権、設定、クラスター、プロセスリスト、クエリログなどのリスト。 通訳者はこの環境を利用します。</p> <p>古いクライアントは新しいサーバーと話すことができ、新しいクライアントは古いサーバーと話すことができます。 しかし、我々は永遠にそれを維持したくない、と我々は約一年後に古いバージョンのサポートを削除しています。</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">注</p> <p>ほとんどの外部アプリケーションでは、HTTPインターフェイスを使用することをお勧めします。 TCPプロトコルは、データのブロックを渡すために内部形式を使用し、圧縮されたデータにはカスタムフレーミングを使用します。 まだ公表したCライブラリのためのこのプロトコールすることが必要なことから、リンクのClickHouseコードベース、るのは現実的ではありません。</p> </div> <h2 id=distributed-query-execution>分散クエリの実行<a class=headerlink href=../amp/#distributed-query-execution title="Permanent link"> </a></h2> <p>サーバーにクラスターセットアップがほぼ独立しています。 を作成することができます <code class=syntax>Distributed</code> クラスター内のサーバーの表。 その <code class=syntax>Distributed</code> table does not store data itself – it only provides a “view” すべての地方のテーブルに複数のノードのクラスター Aから選択すると <code class=syntax>Distributed</code> テーブルは、そのクエリを書き換え、負荷分散設定に従ってリモートノードを選択し、それらにクエリを送信します。 その <code class=syntax>Distributed</code> テーブル要求をリモートサーバー処理クエリーだけで最大のペースでの中間結果から異なるサーバできます。 その後、中間結果を受信してマージします。 のテーブルを配布してできる限りの仕事へのリモートサーバーを送信しない多くの中間データのネットワーク.</p> <p>INまたはJOIN句にサブクエリがあり、それぞれが <code class=syntax>Distributed</code> テーブル。 これらのクエリの実行には、さまざまな戦略があります。</p> <p>分散クエリ実行用のグローバルクエリプランはありません。 各ノードには、ジョブの一部のローカルクエリプランがあります。 リモートノードに対してクエリを送信し、結果をマージします。 しかし、基数の多いグループBYsを持つ複雑なクエリや、結合のための大量の一時データを持つクエリでは、これは不可能です。 そのような場合には、 “reshuffle” 追加の調整が必要なサーバー間のデータ。 ClickHouseはそのようなクエリの実行をサポートしていません。</p> <h2 id=merge-tree>マージツリー<a class=headerlink href=../amp/#merge-tree title="Permanent link"> </a></h2> <p><code class=syntax>MergeTree</code> 主キ 主キーは、列または式の任意のタプルにすることができます。 Aのデータ <code class=syntax>MergeTree</code> テーブルは “parts”. 各パートはデータを主キーの順序で格納するため、データは主キータプルによって辞書順に並べ替えられます。 すべてのテーブル列は別々に格納されます <code class=syntax>column.bin</code> これらの部分のファイル。 ファイルは圧縮ブロックで構成されます。 各ブロックは、平均値のサイズに応じて、通常64KBから1MBの非圧縮データです。 ブロックは、列の値が連続して次々に配置されています。 列の値は各列で同じ順序になるため（主キーによって順序が定義されます）、多くの列で反復処理すると、対応する行の値が取得されます。</p> <p>主キー自体は次のとおりです “sparse”. すべての行に対処するのではなく、いくつかの範囲のデータのみを扱います。 別の <code class=syntax>primary.idx</code> fileには、N番目の行ごとに主キーの値があります。 <code class=syntax>index_granularity</code> （通常、N=8192）。 また、各列について、我々は持っている <code class=syntax>column.mrk</code> ファイル “marks,” これは、データファイル内のN番目の行ごとにオフセットされます。 各マークは、ファイル内の圧縮ブロックの先頭までのオフセットと、圧縮解除ブロック内のデータの先頭までのオフセットのペアです。 通常、圧縮されたブロックはマークで整列され、解凍されたブロックのオフセットはゼロです。 データのための <code class=syntax>primary.idx</code> 常にメモリ内に存在し、 <code class=syntax>column.mrk</code> ファイ</p> <p>我々は一部から何かを読むつもりですときに <code class=syntax>MergeTree</code> 私たちは <code class=syntax>primary.idx</code> データと要求されたデータを含む可能性のある範囲を見つけて、次に <code class=syntax>column.mrk</code> これらの範囲の読み取りを開始する場所のデータと計算オフセット。 希薄さのために、余分なデータが読み取られることがあります。 ClickHouseは、単純なポイントクエリの高負荷には適していません。 <code class=syntax>index_granularity</code> キーごとに行を読み取り、圧縮されたブロック全体を列ごとに解凍する必要があります。 私たちは、インデックスの顕著なメモリ消費なしに単一のサーバーごとに数兆行を維持できる必要があるため、インデックスを疎にしました。 また、主キーは疎であるため、一意ではありません。 テーブルに同じキーを持つ多くの行を持つことができます。</p> <p>あなたが <code class=syntax>INSERT</code> データの束に <code class=syntax>MergeTree</code>、その束は主キーの順序でソートされ、新しい部分を形成します。 が背景のスレッドを定期的に、選択部分と統合して単一のソート部の部品点数が比較的低い。 それが呼び出される理由です <code class=syntax>MergeTree</code>. もちろん、マージは “write amplification”. すべてのパーツは不変であり、作成および削除のみが行われますが、変更は行われません。 SELECTが実行されると、テーブルのスナップショット(パーツのセット)が保持されます。 マージ後もしばらくの間、古いパーツを保持して、障害後の回復を容易にするため、マージされたパーツが壊れている可能性があることがわかったら、ソースパーツ</p> <p><code class=syntax>MergeTree</code> LSMツリーではありません。 “memtable” と “log”: inserted data is written directly to the filesystem. This makes it suitable only to INSERT data in batches, not by individual row and not very frequently – about once per second is ok, but a thousand times a second is not. We did it this way for simplicity's sake, and because we are already inserting data in batches in our applications.</p> <blockquote> <p>MergeTreeテーブルには、一つの(プライマリ)インデックスしか持つことができません。 たとえば、複数の物理的順序でデータを格納したり、事前に集計されたデータと元のデータを含む表現を許可したりすることもできます。</p> </blockquote> <p>バックグラウンドマージ中に追加の作業を行っているMergeTreeエンジンがあります。 例としては <code class=syntax>CollapsingMergeTree</code> と <code class=syntax>AggregatingMergeTree</code>. この処理として特別支援しました。 なぜなら、ユーザーは通常、バックグラウンドマージが実行される時間とデータを制御することができないからです。 <code class=syntax>MergeTree</code> テーブルは、ほとんどの場合、完全にマージされた形式ではなく、複数の部分に格納されます。</p> <h2 id=replication>複製<a class=headerlink href=../amp/#replication title="Permanent link"> </a></h2> <p>ClickHouseでのレプリケーションは、テーブルごとに構成できます。 きも複製されない一部の複製のテーブルと同じサーバです。 また、二要素複製のテーブルと三要素複製のテーブルなど、さまざまな方法でテーブルをレプリケートすることもできます。</p> <p>レプリケーションは <code class=syntax>ReplicatedMergeTree</code> ストレージエンジン のパス <code class=syntax>ZooKeeper</code> ストレージエンジンのパラメータとして指定します。 同じパスを持つすべてのテーブル <code class=syntax>ZooKeeper</code> 互いのレプリカになる：彼らはデータを同期し、一貫性を維持する。 レプリカは、テーブルを作成または削除するだけで動的に追加および削除できます。</p> <p>複製を使用して非同期マルチマスタースキームです。 次のセッションを持つ任意のレプリカにデータを挿入できます <code class=syntax>ZooKeeper</code> データを複製、その他すべてのレプリカは非同期的に. ClickHouseは更新をサポートしていないため、複製は競合しません。 挿入のクォーラム確認がないため、あるノードに障害が発生すると、挿入されただけのデータが失われる可能性があります。</p> <p>複製のメタデータはZooKeeperに格納されます。 実行するアクションを示すレプリケーションログがあります。 アクションは次のとおりです。 各レプリカコピー、複製のログをキューにその行動からのキューに挿入します 例えば、挿入では、 “get the part” actionを作成し、ログイン、レプリカのダウンロードいます。 マージはレプリカ間で調整され、バイトが同一の結果が得られます。 すべての部品を合併した場合と同様にすべてのレプリカ. では達成を補い、一つのレプリカのリーダーとして、レプリカを始めと融合し、書き込みます “merge parts” ログへのアクション。</p> <p>圧縮された部分のみがノード間で転送され、クエリは転送されません。 合併処理され、各レプリカ多くの場合、自主的に下げるネットワークコストを回避することによるネットワークが増幅。 大合併をさらにネットワークする場合に限り重複製に遅れて波及してきています。</p> <p>さらに、各レプリカは、その状態をパーツとそのチェックサムのセットとしてZooKeeperに格納します。 ローカルファイルシステム上の状態がZooKeeperの参照状態から乖離すると、レプリカは他のレプリカから欠落している部分と壊れている部分をダウンロード ローカルファイルシステムに予期しないデータや壊れたデータがある場合、ClickHouseはそれを削除しませんが、別のディレクトリに移動して忘れます。</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">注</p> <p>ClickHouseクラスターは独立したシャードで構成され、各シャードはレプリカで構成されます。 クラスターは <strong>弾性ではない</strong> したがって、新しいシャードを追加した後、データはシャード間で自動的に再調整されません。 代わりに、クラスタ負荷は不均一に調整されることになっています。 この実装はより多くの制御を提供し、数十のノードなどの比較的小さなクラスタでもokです。 しかし、運用環境で使用している数百のノードを持つクラスターでは、このアプローチは重大な欠点になります。 を実行すべきである"と述べていテーブルエンジンで広がる、クラスターを動的に再現れる可能性がある地域分割のバランスとクラスターの動します。</p> </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2022 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/c60fd44c5b70c56ff0f9c7fc538e58c6c8186aea" rel="external nofollow noreferrer" target="_blank" class="text-reset">c60fd44c</a>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/ja/development/architecture/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
