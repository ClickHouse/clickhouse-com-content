<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-en/whats-new/changelog/2021">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<title data-rh="true">2021 | ClickHouse Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://clickhouse.com//docs/staging/docs/en/whats-new/changelog/2021"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="2021 | ClickHouse Docs"><meta data-rh="true" name="description" content="Changelog"><meta data-rh="true" property="og:description" content="Changelog"><meta data-rh="true" name="keywords" content="clickhouse,changelog"><link data-rh="true" rel="icon" href="/docs/staging/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://clickhouse.com//docs/staging/docs/en/whats-new/changelog/2021"><link data-rh="true" rel="alternate" href="https://clickhouse.com//docs/staging/docs/en/whats-new/changelog/2021" hreflang="en"><link data-rh="true" rel="alternate" href="https://clickhouse.com//docs/staging/docs/en/whats-new/changelog/2021" hreflang="x-default"><link rel="stylesheet" href="/docs/staging/assets/css/styles.242363de.css">
<link rel="preload" href="/docs/staging/assets/js/runtime~main.cd5a0a95.js" as="script">
<link rel="preload" href="/docs/staging/assets/js/main.2d8bfa12.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_ObN2"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/staging/docs/"><div class="navbar__logo"><img src="/docs/staging/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docs/staging/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">ClickHouse</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/staging/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD sidebarWithHideableNavbar_d0QC"><a tabindex="-1" class="sidebarLogo_YUvz" href="/docs/staging/docs/"><img src="/docs/staging/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docs/staging/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--dark_oUvU"><b>ClickHouse</b></a><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/staging/docs/intro">What is ClickHouse?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/staging/docs/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/staging/docs/tutorial">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/staging/docs/connect-a-ui">Connect a UI</a><button aria-label="Toggle the collapsible sidebar category &#x27;Connect a UI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/staging/docs/integrations">Integrations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Integrations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/staging/docs/guides">User Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/staging/docs/en">Reference Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging/docs/en/getting-started/install">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging/docs/en/getting-started/playground">Playground</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging/docs/en/example-datasets">Example Datasets</a><button aria-label="Toggle the collapsible sidebar category &#x27;Example Datasets&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging/docs/en/sql-reference/">SQL Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;SQL Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging/docs/en/table-engines">Database &amp; Table Engines</a><button aria-label="Toggle the collapsible sidebar category &#x27;Database &amp; Table Engines&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging/docs/en/interfaces/">Interfaces</a><button aria-label="Toggle the collapsible sidebar category &#x27;Interfaces&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging/docs/en/operations/">Operations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging/docs/category/building-clickhouse">Building ClickHouse</a><button aria-label="Toggle the collapsible sidebar category &#x27;Building ClickHouse&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/staging/docs/en/whats-new/">What&#x27;s New</a><button aria-label="Toggle the collapsible sidebar category &#x27;What&#x27;s New&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/staging/docs/en/whats-new/changelog/">Changelog</a><button aria-label="Toggle the collapsible sidebar category &#x27;Changelog&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/staging/docs/en/whats-new/changelog/2021">2021</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging/docs/en/whats-new/changelog/2020">2020</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging/docs/en/whats-new/changelog/2019">2019</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging/docs/en/whats-new/changelog/2018">2018</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging/docs/en/whats-new/changelog/2017">2017</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging/docs/en/whats-new/security-changelog">Security Changelog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging/docs/en/whats-new/roadmap">Roadmap</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/staging/docs/faq/">FAQ</a><button aria-label="Toggle the collapsible sidebar category &#x27;FAQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/staging/docs/about-us">About Us</a><button aria-label="Toggle the collapsible sidebar category &#x27;About Us&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/staging/docs/en"><span itemprop="name">Reference Guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/staging/docs/en/whats-new/"><span itemprop="name">What&#x27;s New</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/staging/docs/en/whats-new/changelog/"><span itemprop="name">Changelog</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">2021</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>2021</h1></header><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2112-2021-12-15">ClickHouse release v21.12, 2021-12-15<a class="hash-link" href="#clickhouse-release-v2112-2021-12-15" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change" title="Direct link to heading">​</a></h4><ul><li><em>A fix for a feature that previously had unwanted behaviour.</em> Do not allow direct select for Kafka/RabbitMQ/FileLog. Can be enabled by setting <code>stream_like_engine_allow_direct_select</code>. Direct select will be not allowed even if enabled by setting, in case there is an attached materialized view. For Kafka and RabbitMQ direct selectm if allowed, will not commit massages by default. To enable commits with direct select, user must use storage level setting <code>kafka{rabbitmq}_commit_on_select=1</code> (default <code>0</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/31053" target="_blank" rel="noopener noreferrer">#31053</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li><em>A slight change in behaviour of a new function.</em> Return unquoted string in JSON_VALUE. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27965" target="_blank" rel="noopener noreferrer">#27965</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31008" target="_blank" rel="noopener noreferrer">#31008</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li><em>Setting rename.</em> Add custom null representation support for TSV/CSV input formats. Fix deserialing Nullable(String) in TSV/CSV/JSONCompactStringsEachRow/JSONStringsEachRow input formats. Rename <code>output_format_csv_null_representation</code> and <code>output_format_tsv_null_representation</code> to <code>format_csv_null_representation</code> and <code>format_tsv_null_representation</code> accordingly. <a href="https://github.com/ClickHouse/ClickHouse/pull/30497" target="_blank" rel="noopener noreferrer">#30497</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li><em>Further deprecation of already unused code.</em> This is relevant only for users of ClickHouse versions older than 20.6. A &quot;leader election&quot; mechanism is removed from <code>ReplicatedMergeTree</code>, because multiple leaders are supported since 20.6. If you are upgrading from an older version and some replica with an old version is a leader, then server will fail to start after upgrade. Stop replicas with old version to make new version start. After that it will not be possible to downgrade to version older than 20.6. <a href="https://github.com/ClickHouse/ClickHouse/pull/32140" target="_blank" rel="noopener noreferrer">#32140</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature">New Feature<a class="hash-link" href="#new-feature" title="Direct link to heading">​</a></h4><ul><li>Implemented more of the ZooKeeper Four Letter Words commands in clickhouse-keeper: <a href="https://zookeeper.apache.org/doc/r3.4.8/zookeeperAdmin.html#sc_zkCommands" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.8/zookeeperAdmin.html#sc_zkCommands</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28981" target="_blank" rel="noopener noreferrer">#28981</a> (<a href="https://github.com/JackyWoo" target="_blank" rel="noopener noreferrer">JackyWoo</a>). Now <code>clickhouse-keeper</code> is feature complete.</li><li>Support for <code>Bool</code> data type. <a href="https://github.com/ClickHouse/ClickHouse/pull/31072" target="_blank" rel="noopener noreferrer">#31072</a> (<a href="https://github.com/MaxWk" target="_blank" rel="noopener noreferrer">kevin wan</a>).</li><li>Support for <code>PARTITION BY</code> in File, URL, HDFS storages and with <code>INSERT INTO</code> table function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30273" target="_blank" rel="noopener noreferrer">#30273</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30690" target="_blank" rel="noopener noreferrer">#30690</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Added <code>CONSTRAINT ... ASSUME ...</code> (without checking during <code>INSERT</code>). Added query transformation to CNF (<a href="https://github.com/ClickHouse/ClickHouse/issues/11749" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/issues/11749</a>) for more convenient optimization. Added simple query rewriting using constraints (only simple matching now, will be improved to support &lt;,=,&gt;... later). Added ability to replace heavy columns with light columns if it&#x27;s possible. <a href="https://github.com/ClickHouse/ClickHouse/pull/18787" target="_blank" rel="noopener noreferrer">#18787</a> (<a href="https://github.com/nikvas0" target="_blank" rel="noopener noreferrer">Nikita Vasilev</a>).</li><li>Basic access authentication for http/url functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/31648" target="_blank" rel="noopener noreferrer">#31648</a> (<a href="https://github.com/michael1589" target="_blank" rel="noopener noreferrer">michael1589</a>).</li><li>Support <code>INTERVAL</code> type in <code>STEP</code> clause for <code>WITH FILL</code> modifier. <a href="https://github.com/ClickHouse/ClickHouse/pull/30927" target="_blank" rel="noopener noreferrer">#30927</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Add support for parallel reading from multiple files and support globs in <code>FROM INFILE</code> clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/30135" target="_blank" rel="noopener noreferrer">#30135</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Add support for <code>Identifier</code> table and database query parameters. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27226" target="_blank" rel="noopener noreferrer">#27226</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28668" target="_blank" rel="noopener noreferrer">#28668</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li><em>TLDR: Major improvements of completeness and consistency of text formats.</em> Refactor formats <code>TSV</code>, <code>TSVRaw</code>, <code>CSV</code> and <code>JSONCompactEachRow</code>, <code>JSONCompactStringsEachRow</code>, remove code duplication, add base interface for formats with <code>-WithNames</code> and <code>-WithNamesAndTypes</code> suffixes. Add formats <code>CSVWithNamesAndTypes</code>, <code>TSVRawWithNames</code>, <code>TSVRawWithNamesAndTypes</code>, <code>JSONCompactEachRowWIthNames</code>, <code>JSONCompactStringsEachRowWIthNames</code>, <code>RowBinaryWithNames</code>. Support parallel parsing for formats <code>TSVWithNamesAndTypes</code>, <code>TSVRaw(WithNames/WIthNamesAndTypes)</code>, <code>CSVWithNamesAndTypes</code>, <code>JSONCompactEachRow(WithNames/WIthNamesAndTypes)</code>, <code>JSONCompactStringsEachRow(WithNames/WIthNamesAndTypes)</code>. Support columns mapping and types checking for <code>RowBinaryWithNamesAndTypes</code> format. Add setting <code>input_format_with_types_use_header</code> which specify if we should check that types written in &lt;format_name&gt;<code>WIthNamesAndTypes</code> format matches with table structure. Add setting <code>input_format_csv_empty_as_default</code> and use it in CSV format instead of <code>input_format_defaults_for_omitted_fields</code> (because this setting should not control <code>csv_empty_as_default</code>). Fix usage of setting <code>input_format_defaults_for_omitted_fields</code> (it was used only as <code>csv_empty_as_default</code>, but it should control calculation of default expressions for omitted fields). Fix Nullable input/output in <code>TSVRaw</code> format, make this format fully compatible with inserting into TSV. Fix inserting NULLs in <code>LowCardinality(Nullable)</code> when <code>input_format_null_as_default</code> is enabled (previously default values was inserted instead of actual NULLs). Fix strings deserialization in <code>JSONStringsEachRow</code>/<code>JSONCompactStringsEachRow</code> formats (strings were parsed just until first &#x27;\n&#x27; or &#x27;\t&#x27;). Add ability to use <code>Raw</code> escaping rule in Template input format. Add diagnostic info for JSONCompactEachRow(WithNames/WIthNamesAndTypes) input format. Fix bug with parallel parsing of <code>-WithNames</code> formats in case when setting <code>min_chunk_bytes_for_parallel_parsing</code> is less than bytes in a single row. <a href="https://github.com/ClickHouse/ClickHouse/pull/30178" target="_blank" rel="noopener noreferrer">#30178</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). Allow to print/parse names and types of colums in <code>CustomSeparated</code> input/output format. Add formats <code>CustomSeparatedWithNames/WithNamesAndTypes</code> similar to <code>TSVWithNames/WithNamesAndTypes</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31434" target="_blank" rel="noopener noreferrer">#31434</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Aliyun OSS Storage support. <a href="https://github.com/ClickHouse/ClickHouse/pull/31286" target="_blank" rel="noopener noreferrer">#31286</a> (<a href="https://github.com/cfcz48" target="_blank" rel="noopener noreferrer">cfcz48</a>).</li><li>Exposes all settings of the global thread pool in the configuration file. <a href="https://github.com/ClickHouse/ClickHouse/pull/31285" target="_blank" rel="noopener noreferrer">#31285</a> (<a href="https://github.com/gyfis" target="_blank" rel="noopener noreferrer">Tomáš Hromada</a>).</li><li>Introduced window functions <code>exponentialTimeDecayedSum</code>, <code>exponentialTimeDecayedMax</code>, <code>exponentialTimeDecayedCount</code> and <code>exponentialTimeDecayedAvg</code> which are more effective than <code>exponentialMovingAverage</code> for bigger windows. Also more use-cases were covered. <a href="https://github.com/ClickHouse/ClickHouse/pull/29799" target="_blank" rel="noopener noreferrer">#29799</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Add option to compress logs before writing them to a file using LZ4. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23860" target="_blank" rel="noopener noreferrer">#23860</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29219" target="_blank" rel="noopener noreferrer">#29219</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Support <code>JOIN ON 1 = 1</code> that have CROSS JOIN semantic. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25578" target="_blank" rel="noopener noreferrer">#25578</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25894" target="_blank" rel="noopener noreferrer">#25894</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Add Map combinator for <code>Map</code> type. - Rename old <code>sum-, min-, max- Map</code> for mapped arrays to <code>sum-, min-, max- MappedArrays</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24539" target="_blank" rel="noopener noreferrer">#24539</a> (<a href="https://github.com/ildus" target="_blank" rel="noopener noreferrer">Ildus Kurbangaliev</a>).</li><li>Make reading from HTTP retriable. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29696" target="_blank" rel="noopener noreferrer">#29696</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29894" target="_blank" rel="noopener noreferrer">#29894</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature">Experimental Feature<a class="hash-link" href="#experimental-feature" title="Direct link to heading">​</a></h4><ul><li><code>WINDOW VIEW</code> to enable stream processing in ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/8331" target="_blank" rel="noopener noreferrer">#8331</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Drop support for using Ordinary databases with <code>MaterializedMySQL</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31292" target="_blank" rel="noopener noreferrer">#31292</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li><li>Implement the commands BACKUP and RESTORE for the Log family. This feature is under development. <a href="https://github.com/ClickHouse/ClickHouse/pull/30688" target="_blank" rel="noopener noreferrer">#30688</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement">Performance Improvement<a class="hash-link" href="#performance-improvement" title="Direct link to heading">​</a></h4><ul><li>Reduce memory usage when reading with <code>s3</code> / <code>url</code> / <code>hdfs</code> formats <code>Parquet</code>, <code>ORC</code>, <code>Arrow</code> (controlled by setting <code>input_format_allow_seeks</code>, enabled by default). Also add setting <code>remote_read_min_bytes_for_seek</code> to control seeks. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10461" target="_blank" rel="noopener noreferrer">#10461</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16857" target="_blank" rel="noopener noreferrer">#16857</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30936" target="_blank" rel="noopener noreferrer">#30936</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add optimizations for constant conditions in JOIN ON, ref <a href="https://github.com/ClickHouse/ClickHouse/issues/26928" target="_blank" rel="noopener noreferrer">#26928</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27021" target="_blank" rel="noopener noreferrer">#27021</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Support parallel formatting for all text formats, except <code>JSONEachRowWithProgress</code> and <code>PrettyCompactMonoBlock</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31489" target="_blank" rel="noopener noreferrer">#31489</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Speed up count over nullable columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/31806" target="_blank" rel="noopener noreferrer">#31806</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Speed up <code>avg</code> and <code>sumCount</code> aggregate functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/31694" target="_blank" rel="noopener noreferrer">#31694</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Improve performance of JSON and XML output formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/31673" target="_blank" rel="noopener noreferrer">#31673</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve performance of syncing data to block device. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31181" target="_blank" rel="noopener noreferrer">#31181</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31229" target="_blank" rel="noopener noreferrer">#31229</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>).</li><li>Fixing query performance issue in <code>LiveView</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/30831" target="_blank" rel="noopener noreferrer">#30831</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31006" target="_blank" rel="noopener noreferrer">#31006</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Speed up query parsing. <a href="https://github.com/ClickHouse/ClickHouse/pull/31949" target="_blank" rel="noopener noreferrer">#31949</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Allow to split <code>GraphiteMergeTree</code> rollup rules for plain/tagged metrics (optional <code>rule_type</code> field). <a href="https://github.com/ClickHouse/ClickHouse/pull/25122" target="_blank" rel="noopener noreferrer">#25122</a> (<a href="https://github.com/msaf1980" target="_blank" rel="noopener noreferrer">Michail Safronov</a>).</li><li>Remove excessive <code>DESC TABLE</code> requests for <code>remote()</code> (in case of <code>remote(&#x27;127.1&#x27;, system.one)</code> (i.e. identifier as the db.table instead of string) there was excessive <code>DESC TABLE</code> request). <a href="https://github.com/ClickHouse/ClickHouse/pull/32019" target="_blank" rel="noopener noreferrer">#32019</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Optimize function <code>tupleElement</code> to reading of subcolumn with enabled setting <code>optimize_functions_to_subcolumns</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31261" target="_blank" rel="noopener noreferrer">#31261</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Optimize function <code>mapContains</code> to reading of subcolumn <code>key</code> with enabled settings <code>optimize_functions_to_subcolumns</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31218" target="_blank" rel="noopener noreferrer">#31218</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Add settings <code>merge_tree_min_rows_for_concurrent_read_for_remote_filesystem</code> and <code>merge_tree_min_bytes_for_concurrent_read_for_remote_filesystem</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30970" target="_blank" rel="noopener noreferrer">#30970</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Skipping mutations of different partitions in <code>StorageMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21326" target="_blank" rel="noopener noreferrer">#21326</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement">Improvement<a class="hash-link" href="#improvement" title="Direct link to heading">​</a></h4><ul><li>Do not allow to drop a table or dictionary if some tables or dictionaries depend on it. <a href="https://github.com/ClickHouse/ClickHouse/pull/30977" target="_blank" rel="noopener noreferrer">#30977</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Allow versioning of aggregate function states. Now we can introduce backward compatible changes in serialization format of aggregate function states. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12552" target="_blank" rel="noopener noreferrer">#12552</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24820" target="_blank" rel="noopener noreferrer">#24820</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support PostgreSQL style <code>ALTER MODIFY COLUMN</code> syntax. <a href="https://github.com/ClickHouse/ClickHouse/pull/32003" target="_blank" rel="noopener noreferrer">#32003</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Added <code>update_field</code> support for <code>RangeHashedDictionary</code>, <code>ComplexKeyRangeHashedDictionary</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32185" target="_blank" rel="noopener noreferrer">#32185</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>The <code>murmurHash3_128</code> and <code>sipHash128</code> functions now accept an arbitrary number of arguments. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28774" target="_blank" rel="noopener noreferrer">#28774</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28965" target="_blank" rel="noopener noreferrer">#28965</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Support default expression for <code>HDFS</code> storage and optimize fetching when source is column oriented. <a href="https://github.com/ClickHouse/ClickHouse/pull/32256" target="_blank" rel="noopener noreferrer">#32256</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">李扬</a>).</li><li>Improve the operation name of an opentelemetry span. <a href="https://github.com/ClickHouse/ClickHouse/pull/32234" target="_blank" rel="noopener noreferrer">#32234</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Use <code>Content-Type: application/x-ndjson</code> (<a href="http://ndjson.org/" target="_blank" rel="noopener noreferrer">http://ndjson.org/</a>) for output format <code>JSONEachRow</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32223" target="_blank" rel="noopener noreferrer">#32223</a> (<a href="https://github.com/deem0n" target="_blank" rel="noopener noreferrer">Dmitriy Dorofeev</a>).</li><li>Improve skipping unknown fields with quoted escaping rule in Template/CustomSeparated formats. Previously you could skip only quoted strings, now you can skip values with any type. <a href="https://github.com/ClickHouse/ClickHouse/pull/32204" target="_blank" rel="noopener noreferrer">#32204</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Now <code>clickhouse-keeper</code> refuses to start or apply configuration changes when they contain duplicated IDs or endpoints. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31339" target="_blank" rel="noopener noreferrer">#31339</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32121" target="_blank" rel="noopener noreferrer">#32121</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Set Content-Type in HTTP packets issued from URL engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/32113" target="_blank" rel="noopener noreferrer">#32113</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Return Content-Type as &#x27;application/json&#x27; for <code>JSONEachRow</code> format if <code>output_format_json_array_of_rows</code> is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/32112" target="_blank" rel="noopener noreferrer">#32112</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Allow to parse <code>+</code> before <code>Float32</code>/<code>Float64</code> values. <a href="https://github.com/ClickHouse/ClickHouse/pull/32079" target="_blank" rel="noopener noreferrer">#32079</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Allow a user configured <code>hdfs_replication</code> parameter for <code>DiskHDFS</code> and <code>StorageHDFS</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/32039" target="_blank" rel="noopener noreferrer">#32039</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32049" target="_blank" rel="noopener noreferrer">#32049</a> (<a href="https://github.com/leosunli" target="_blank" rel="noopener noreferrer">leosunli</a>).</li><li>Added ClickHouse <code>exception</code> and <code>exception_code</code> fields to opentelemetry span log. <a href="https://github.com/ClickHouse/ClickHouse/pull/32040" target="_blank" rel="noopener noreferrer">#32040</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Improve opentelemetry span log duration - it was is zero at the query level if there is a query exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/32038" target="_blank" rel="noopener noreferrer">#32038</a> (<a href="https://github.com/FrankChen021" target="_blank" rel="noopener noreferrer">Frank Chen</a>).</li><li>Fix the issue that <code>LowCardinality</code> of <code>Int256</code> cannot be created. <a href="https://github.com/ClickHouse/ClickHouse/pull/31832" target="_blank" rel="noopener noreferrer">#31832</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Recreate <code>system.*_log</code> tables in case of different engine/partition_by. <a href="https://github.com/ClickHouse/ClickHouse/pull/31824" target="_blank" rel="noopener noreferrer">#31824</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li><code>MaterializedMySQL</code>: Fix issue with table named &#x27;table&#x27;. <a href="https://github.com/ClickHouse/ClickHouse/pull/31781" target="_blank" rel="noopener noreferrer">#31781</a> (<a href="https://github.com/havardk" target="_blank" rel="noopener noreferrer">Håvard Kvålen</a>).</li><li>ClickHouse dictionary source: support predefined connections. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31705" target="_blank" rel="noopener noreferrer">#31705</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31749" target="_blank" rel="noopener noreferrer">#31749</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Allow to use predefined connections configuration for Kafka and RabbitMQ engines (the same way as for other integration table engines). <a href="https://github.com/ClickHouse/ClickHouse/pull/31691" target="_blank" rel="noopener noreferrer">#31691</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Always re-render prompt while navigating history in clickhouse-client. This will improve usability of manipulating very long queries that don&#x27;t fit on screen. <a href="https://github.com/ClickHouse/ClickHouse/pull/31675" target="_blank" rel="noopener noreferrer">#31675</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>) (author: Amos Bird).</li><li>Add key bindings for navigating through history (instead of lines/history). <a href="https://github.com/ClickHouse/ClickHouse/pull/31641" target="_blank" rel="noopener noreferrer">#31641</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improve the <code>max_execution_time</code> checks. Fixed some cases when timeout checks do not happen and query could run too long. <a href="https://github.com/ClickHouse/ClickHouse/pull/31636" target="_blank" rel="noopener noreferrer">#31636</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Better exception message when <code>users.xml</code> cannot be loaded due to bad password hash. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24126" target="_blank" rel="noopener noreferrer">#24126</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31557" target="_blank" rel="noopener noreferrer">#31557</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Use shard and replica name from <code>Replicated</code> database arguments when expanding macros in <code>ReplicatedMergeTree</code> arguments if these macros are not defined in config. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31471" target="_blank" rel="noopener noreferrer">#31471</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31488" target="_blank" rel="noopener noreferrer">#31488</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Better analysis for <code>min/max/count</code> projection. Now, with enabled <code>allow_experimental_projection_optimization</code>, virtual <code>min/max/count</code> projection can be used together with columns from partition key. <a href="https://github.com/ClickHouse/ClickHouse/pull/31474" target="_blank" rel="noopener noreferrer">#31474</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add <code>--pager</code> support for <code>clickhouse-local</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31457" target="_blank" rel="noopener noreferrer">#31457</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix waiting of the editor during interactive query edition (<code>waitpid()</code> returns -1 on <code>SIGWINCH</code> and <code>EDITOR</code> and <code>clickhouse-local</code>/<code>clickhouse-client</code> works concurrently). <a href="https://github.com/ClickHouse/ClickHouse/pull/31456" target="_blank" rel="noopener noreferrer">#31456</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Throw an exception if there is some garbage after field in <code>JSONCompactStrings(EachRow)</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/31455" target="_blank" rel="noopener noreferrer">#31455</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Default value of <code>http_send_timeout</code> and <code>http_receive_timeout</code> settings changed from 1800 (30 minutes) to 180 (3 minutes). <a href="https://github.com/ClickHouse/ClickHouse/pull/31450" target="_blank" rel="noopener noreferrer">#31450</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li><code>MaterializedMySQL</code> now handles <code>CREATE TABLE ... LIKE ...</code> DDL queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/31410" target="_blank" rel="noopener noreferrer">#31410</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li><li>Return artificial create query when executing <code>show create table</code> on system&#x27;s tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/31391" target="_blank" rel="noopener noreferrer">#31391</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Previously progress was shown only for <code>numbers</code> table function. Now for <code>numbers_mt</code> it is also shown. <a href="https://github.com/ClickHouse/ClickHouse/pull/31318" target="_blank" rel="noopener noreferrer">#31318</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Initial user&#x27;s roles are used now to find row policies, see <a href="https://github.com/ClickHouse/ClickHouse/issues/31080" target="_blank" rel="noopener noreferrer">#31080</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31262" target="_blank" rel="noopener noreferrer">#31262</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>If some obsolete setting is changed - show warning in <code>system.warnings</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31252" target="_blank" rel="noopener noreferrer">#31252</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Improved backoff for background cleanup tasks in <code>MergeTree</code>. Settings <code>merge_tree_clear_old_temporary_directories_interval_seconds</code> and <code>merge_tree_clear_old_parts_interval_seconds</code> moved from users settings to merge tree settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/31180" target="_blank" rel="noopener noreferrer">#31180</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Now every replica will send to client only incremental information about profile events counters. <a href="https://github.com/ClickHouse/ClickHouse/pull/31155" target="_blank" rel="noopener noreferrer">#31155</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>). This makes <code>--hardware_utilization</code> option in <code>clickhouse-client</code> usable.</li><li>Enable multiline editing in clickhouse-client by default. This addresses <a href="https://github.com/ClickHouse/ClickHouse/issues/31121" target="_blank" rel="noopener noreferrer">#31121</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/31123" target="_blank" rel="noopener noreferrer">#31123</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Function name normalization for <code>ALTER</code> queries. This helps avoid metadata mismatch between creating table with indices/projections and adding indices/projections via alter commands. This is a follow-up PR of <a href="https://github.com/ClickHouse/ClickHouse/pull/20174" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/20174</a>. Mark as improvements as there are no bug reports and the senario is somehow rare. <a href="https://github.com/ClickHouse/ClickHouse/pull/31095" target="_blank" rel="noopener noreferrer">#31095</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support <code>IF EXISTS</code> modifier for <code>RENAME DATABASE</code>/<code>TABLE</code>/<code>DICTIONARY</code> query. If this directive is used, one will not get an error if the DATABASE/TABLE/DICTIONARY to be renamed doesn&#x27;t exist. <a href="https://github.com/ClickHouse/ClickHouse/pull/31081" target="_blank" rel="noopener noreferrer">#31081</a> (<a href="https://github.com/kafka1991" target="_blank" rel="noopener noreferrer">victorgao</a>).</li><li>Cancel vertical merges when partition is dropped. This is a follow-up of <a href="https://github.com/ClickHouse/ClickHouse/pull/25684" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/25684</a> and <a href="https://github.com/ClickHouse/ClickHouse/pull/30996" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/30996</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31057" target="_blank" rel="noopener noreferrer">#31057</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>The local session inside a Clickhouse dictionary source won&#x27;t send its events to the session log anymore. This fixes a possible deadlock (tsan alert) on shutdown. Also this PR fixes flaky <code>test_dictionaries_dependency_xml/</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31013" target="_blank" rel="noopener noreferrer">#31013</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Less locking in ALTER command. <a href="https://github.com/ClickHouse/ClickHouse/pull/31010" target="_blank" rel="noopener noreferrer">#31010</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix <code>--verbose</code> option in clickhouse-local interactive mode and allow logging into file. <a href="https://github.com/ClickHouse/ClickHouse/pull/30881" target="_blank" rel="noopener noreferrer">#30881</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Added <code>\l</code>, <code>\d</code>, <code>\c</code> commands in <code>clickhouse-client</code> like in MySQL and PostgreSQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/30876" target="_blank" rel="noopener noreferrer">#30876</a> (<a href="https://github.com/pmed" target="_blank" rel="noopener noreferrer">Pavel Medvedev</a>).</li><li>For clickhouse-local or clickhouse-client: if there is <code>--interactive</code> option with <code>--query</code> or <code>--queries-file</code>, then first execute them like in non-interactive and then start interactive mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/30851" target="_blank" rel="noopener noreferrer">#30851</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix possible &quot;The local set of parts of X doesn&#x27;t look like the set of parts in ZooKeeper&quot; error (if DROP fails during removing znodes from zookeeper). <a href="https://github.com/ClickHouse/ClickHouse/pull/30826" target="_blank" rel="noopener noreferrer">#30826</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Avro format works against Kafka. Setting <code>output_format_avro_rows_in_file</code> added. <a href="https://github.com/ClickHouse/ClickHouse/pull/30351" target="_blank" rel="noopener noreferrer">#30351</a> (<a href="https://github.com/ilejn" target="_blank" rel="noopener noreferrer">Ilya Golshtein</a>).</li><li>Allow to specify one or any number of PostgreSQL schemas for one <code>MaterializedPostgreSQL</code> database. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28901" target="_blank" rel="noopener noreferrer">#28901</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29324" target="_blank" rel="noopener noreferrer">#29324</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28933" target="_blank" rel="noopener noreferrer">#28933</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Replaced default ports for clickhouse-keeper internal communication from 44444 to 9234. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/30879" target="_blank" rel="noopener noreferrer">#30879</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31799" target="_blank" rel="noopener noreferrer">#31799</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Implement function transform with Decimal arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/31839" target="_blank" rel="noopener noreferrer">#31839</a> (<a href="https://github.com/loneylee" target="_blank" rel="noopener noreferrer">李帅</a>).</li><li>Fix abort in debug server and <code>DB::Exception: std::out_of_range: basic_string</code> error in release server in case of bad hdfs url by adding additional check of hdfs url structure. <a href="https://github.com/ClickHouse/ClickHouse/pull/31042" target="_blank" rel="noopener noreferrer">#31042</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix possible assert in <code>hdfs</code> table function/engine, add test. <a href="https://github.com/ClickHouse/ClickHouse/pull/31036" target="_blank" rel="noopener noreferrer">#31036</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fixes">Bug Fixes<a class="hash-link" href="#bug-fixes" title="Direct link to heading">​</a></h4><ul><li>Fix group by / order by / limit by aliases with positional arguments enabled. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31173" target="_blank" rel="noopener noreferrer">#31173</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31741" target="_blank" rel="noopener noreferrer">#31741</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix usage of <code>Buffer</code> table engine with type <code>Map</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/30546" target="_blank" rel="noopener noreferrer">#30546</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31742" target="_blank" rel="noopener noreferrer">#31742</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix reading from <code>MergeTree</code> tables with enabled <code>use_uncompressed_cache</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31826" target="_blank" rel="noopener noreferrer">#31826</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed the behavior when mutations that have nothing to do are stuck (with enabled setting <code>empty_result_for_aggregation_by_empty_set</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/32358" target="_blank" rel="noopener noreferrer">#32358</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix skipping columns while writing protobuf. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31160" target="_blank" rel="noopener noreferrer">#31160</a>, see the comment <a href="https://github.com/ClickHouse/ClickHouse/issues/31160" target="_blank" rel="noopener noreferrer">#31160</a>#issuecomment-980595318. <a href="https://github.com/ClickHouse/ClickHouse/pull/31988" target="_blank" rel="noopener noreferrer">#31988</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix bug when remove unneeded columns in subquery. If there is an aggregation function in query without group by, do not remove if it is unneeded. <a href="https://github.com/ClickHouse/ClickHouse/pull/32289" target="_blank" rel="noopener noreferrer">#32289</a> (<a href="https://github.com/dyf6372" target="_blank" rel="noopener noreferrer">dongyifeng</a>).</li><li>Quota limit was not reached, but the limit was exceeded. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31174" target="_blank" rel="noopener noreferrer">#31174</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31337" target="_blank" rel="noopener noreferrer">#31337</a> (<a href="https://github.com/sunny19930321" target="_blank" rel="noopener noreferrer">sunny</a>).</li><li>Fix SHOW GRANTS when partial revokes are used. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31138" target="_blank" rel="noopener noreferrer">#31138</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31249" target="_blank" rel="noopener noreferrer">#31249</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Memory amount was incorrectly estimated when ClickHouse is run in containers with cgroup limits. <a href="https://github.com/ClickHouse/ClickHouse/pull/31157" target="_blank" rel="noopener noreferrer">#31157</a> (<a href="https://github.com/pmed" target="_blank" rel="noopener noreferrer">Pavel Medvedev</a>).</li><li>Fix <code>ALTER ... MATERIALIZE COLUMN ...</code> queries in case when data type of default expression is not equal to the data type of column. <a href="https://github.com/ClickHouse/ClickHouse/pull/32348" target="_blank" rel="noopener noreferrer">#32348</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed crash with SIGFPE in aggregate function <code>avgWeighted</code> with <code>Decimal</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/32053" target="_blank" rel="noopener noreferrer">#32053</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32303" target="_blank" rel="noopener noreferrer">#32303</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Server might fail to start with <code>Cannot attach 1 tables due to cyclic dependencies</code> error if <code>Dictionary</code> table looks at XML-dictionary with the same name, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31315" target="_blank" rel="noopener noreferrer">#31315</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32288" target="_blank" rel="noopener noreferrer">#32288</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix parsing error while NaN deserializing for <code>Nullable(Float)</code> for <code>Quoted</code> escaping rule. <a href="https://github.com/ClickHouse/ClickHouse/pull/32190" target="_blank" rel="noopener noreferrer">#32190</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>XML dictionaries: identifiers, used in table create query, can be qualified to <code>default_database</code> during upgrade to newer version. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31963" target="_blank" rel="noopener noreferrer">#31963</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32187" target="_blank" rel="noopener noreferrer">#32187</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Number of active replicas might be determined incorrectly when inserting with quorum if setting <code>replicated_can_become_leader</code> is disabled on some replicas. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/32157" target="_blank" rel="noopener noreferrer">#32157</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Dictionaries: fix cases when <code>{condition}</code> does not work for custom database queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/32117" target="_blank" rel="noopener noreferrer">#32117</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix <code>CAST</code> from <code>Nullable</code> with <code>cast_keep_nullable</code> (<code>PARAMETER_OUT_OF_BOUND</code> error before for i.e. <code>toUInt32OrDefault(toNullable(toUInt32(1)))</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/32080" target="_blank" rel="noopener noreferrer">#32080</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix CREATE TABLE of Join Storage in some obscure cases. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/31680" target="_blank" rel="noopener noreferrer">#31680</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/32066" target="_blank" rel="noopener noreferrer">#32066</a> (<a href="https://github.com/cmsxbc" target="_blank" rel="noopener noreferrer">SuperDJY</a>).</li><li>Fixed <code>Directory ... already exists and is not empty</code> error when detaching part. <a href="https://github.com/ClickHouse/ClickHouse/pull/32063" target="_blank" rel="noopener noreferrer">#32063</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li><code>MaterializedMySQL</code> (experimental feature): Fix misinterpretation of <code>DECIMAL</code> data from MySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/31990" target="_blank" rel="noopener noreferrer">#31990</a> (<a href="https://github.com/havardk" target="_blank" rel="noopener noreferrer">Håvard Kvålen</a>).</li><li><code>FileLog</code> (experimental feature) engine unnesessary created meta data directory when create table failed. Fix <a href="https://github.com/ClickHouse/ClickHouse/issues/31962" target="_blank" rel="noopener noreferrer">#31962</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31967" target="_blank" rel="noopener noreferrer">#31967</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Some <code>GET_PART</code> entry might hang in replication queue if part is lost on all replicas and there are no other parts in the same partition. It&#x27;s fixed in cases when partition key contains only columns of integer types or <code>Date[Time]</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31485" target="_blank" rel="noopener noreferrer">#31485</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31887" target="_blank" rel="noopener noreferrer">#31887</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix functions <code>empty</code> and <code>notEmpty</code> with arguments of <code>UUID</code> type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31819" target="_blank" rel="noopener noreferrer">#31819</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31883" target="_blank" rel="noopener noreferrer">#31883</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Change configuration path from <code>keeper_server.session_timeout_ms</code> to <code>keeper_server.coordination_settings.session_timeout_ms</code> when constructing a <code>KeeperTCPHandler</code>. Same with <code>operation_timeout</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31859" target="_blank" rel="noopener noreferrer">#31859</a> (<a href="https://github.com/JackyWoo" target="_blank" rel="noopener noreferrer">JackyWoo</a>).</li><li>Fix invalid cast of Nullable type when nullable primary key is used. (Nullable primary key is a discouraged feature - please do not use). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31075" target="_blank" rel="noopener noreferrer">#31075</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31823" target="_blank" rel="noopener noreferrer">#31823</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix crash in recursive UDF in SQL. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30856" target="_blank" rel="noopener noreferrer">#30856</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31820" target="_blank" rel="noopener noreferrer">#31820</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix crash when function <code>dictGet</code> with type is used for dictionary attribute when type is <code>Nullable</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/30980" target="_blank" rel="noopener noreferrer">#30980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31800" target="_blank" rel="noopener noreferrer">#31800</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix crash with empty result of ODBC query (with some ODBC drivers). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31465" target="_blank" rel="noopener noreferrer">#31465</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31766" target="_blank" rel="noopener noreferrer">#31766</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix disabling query profiler (In case of <code>query_profiler_real_time_period_ns&gt;0</code>/<code>query_profiler_cpu_time_period_ns&gt;0</code> query profiler can stayed enabled even after query finished). <a href="https://github.com/ClickHouse/ClickHouse/pull/31740" target="_blank" rel="noopener noreferrer">#31740</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed rare segfault on concurrent <code>ATTACH PARTITION</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/31738" target="_blank" rel="noopener noreferrer">#31738</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix race in JSONEachRowWithProgress output format when data and lines with progress are mixed in output. <a href="https://github.com/ClickHouse/ClickHouse/pull/31736" target="_blank" rel="noopener noreferrer">#31736</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixed <code>there are no such cluster here</code> error on execution of <code>ON CLUSTER</code> query if specified cluster name is name of <code>Replicated</code> database. <a href="https://github.com/ClickHouse/ClickHouse/pull/31723" target="_blank" rel="noopener noreferrer">#31723</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix exception on some of the applications of <code>decrypt</code> function on Nullable columns. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31662" target="_blank" rel="noopener noreferrer">#31662</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31426" target="_blank" rel="noopener noreferrer">#31426</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31707" target="_blank" rel="noopener noreferrer">#31707</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed function ngrams when string contains UTF-8 characters. <a href="https://github.com/ClickHouse/ClickHouse/pull/31706" target="_blank" rel="noopener noreferrer">#31706</a> (<a href="https://github.com/yandd" target="_blank" rel="noopener noreferrer">yandd</a>).</li><li>Settings <code>input_format_allow_errors_num</code> and <code>input_format_allow_errors_ratio</code> did not work for parsing of domain types, such as <code>IPv4</code>, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/31686" target="_blank" rel="noopener noreferrer">#31686</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31697" target="_blank" rel="noopener noreferrer">#31697</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed null pointer exception in <code>MATERIALIZE COLUMN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31679" target="_blank" rel="noopener noreferrer">#31679</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li><code>RENAME TABLE</code> query worked incorrectly on attempt to rename an DDL dictionary in <code>Ordinary</code> database, it&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/31638" target="_blank" rel="noopener noreferrer">#31638</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Implement <code>sparkbar</code> aggregate function as it was intended, see: <a href="https://github.com/ClickHouse/ClickHouse/issues/26175" target="_blank" rel="noopener noreferrer">#26175</a>#issuecomment-960353867, <a href="https://github.com/ClickHouse/ClickHouse/issues/26175#issuecomment-961155065" target="_blank" rel="noopener noreferrer">comment</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31624" target="_blank" rel="noopener noreferrer">#31624</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Fix invalid generated JSON when only column names contain invalid UTF-8 sequences. <a href="https://github.com/ClickHouse/ClickHouse/pull/31534" target="_blank" rel="noopener noreferrer">#31534</a> (<a href="https://github.com/kmichel-aiven" target="_blank" rel="noopener noreferrer">Kevin Michel</a>).</li><li>Disable <code>partial_merge_join_left_table_buffer_bytes</code> before bug in this optimization is fixed. See <a href="https://github.com/ClickHouse/ClickHouse/issues/31009" target="_blank" rel="noopener noreferrer">#31009</a>). Remove redundant option <code>partial_merge_join_optimizations</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31528" target="_blank" rel="noopener noreferrer">#31528</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix progress for short <code>INSERT SELECT</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/31510" target="_blank" rel="noopener noreferrer">#31510</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix wrong behavior with group by and positional arguments. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31280" target="_blank" rel="noopener noreferrer">#31280</a>#issuecomment-968696186. <a href="https://github.com/ClickHouse/ClickHouse/pull/31420" target="_blank" rel="noopener noreferrer">#31420</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Resolve <code>nullptr</code> in STS credentials provider for S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/31409" target="_blank" rel="noopener noreferrer">#31409</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Remove <code>notLike</code> function from index analysis, because it was wrong. <a href="https://github.com/ClickHouse/ClickHouse/pull/31169" target="_blank" rel="noopener noreferrer">#31169</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Fix bug in Keeper which can lead to inability to start when some coordination logs was lost and we have more fresh snapshot than our latest log. <a href="https://github.com/ClickHouse/ClickHouse/pull/31150" target="_blank" rel="noopener noreferrer">#31150</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Rewrite right distributed table in local join. solves <a href="https://github.com/ClickHouse/ClickHouse/issues/25809" target="_blank" rel="noopener noreferrer">#25809</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31105" target="_blank" rel="noopener noreferrer">#31105</a> (<a href="https://github.com/abel-cheng" target="_blank" rel="noopener noreferrer">abel-cheng</a>).</li><li>Fix <code>Merge</code> table with aliases and where (it did not work before at all). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28802" target="_blank" rel="noopener noreferrer">#28802</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31044" target="_blank" rel="noopener noreferrer">#31044</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix JSON_VALUE/JSON_QUERY with quoted identifiers. This allows to have spaces in json path. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30971" target="_blank" rel="noopener noreferrer">#30971</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31003" target="_blank" rel="noopener noreferrer">#31003</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Using <code>formatRow</code> function with not row-oriented formats led to segfault. Don&#x27;t allow to use this function with such formats (because it doesn&#x27;t make sense). <a href="https://github.com/ClickHouse/ClickHouse/pull/31001" target="_blank" rel="noopener noreferrer">#31001</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix bug which broke select queries if they happened after dropping materialized view. Found in <a href="https://github.com/ClickHouse/ClickHouse/issues/30691" target="_blank" rel="noopener noreferrer">#30691</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30997" target="_blank" rel="noopener noreferrer">#30997</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Skip <code>max_partition_size_to_drop check</code> in case of ATTACH PARTITION ... FROM and MOVE PARTITION ... <a href="https://github.com/ClickHouse/ClickHouse/pull/30995" target="_blank" rel="noopener noreferrer">#30995</a> (<a href="https://github.com/amralaa-MSFT" target="_blank" rel="noopener noreferrer">Amr Alaa</a>).</li><li>Fix some corner cases with <code>INTERSECT</code> and <code>EXCEPT</code> operators. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30803" target="_blank" rel="noopener noreferrer">#30803</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30965" target="_blank" rel="noopener noreferrer">#30965</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement" title="Direct link to heading">​</a></h4><ul><li>Fix incorrect filtering result on non-x86 builds. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31417" target="_blank" rel="noopener noreferrer">#31417</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/31524" target="_blank" rel="noopener noreferrer">#31524</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31574" target="_blank" rel="noopener noreferrer">#31574</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make ClickHouse build fully reproducible (byte identical on different machines). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22113" target="_blank" rel="noopener noreferrer">#22113</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31899" target="_blank" rel="noopener noreferrer">#31899</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>). Remove filesystem path to the build directory from binaries to enable reproducible builds. This needed for <a href="https://github.com/ClickHouse/ClickHouse/issues/22113" target="_blank" rel="noopener noreferrer">#22113</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/31838" target="_blank" rel="noopener noreferrer">#31838</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Use our own CMakeLists for <code>zlib-ng</code>, <code>cassandra</code>, <code>mariadb-connector-c</code> and <code>xz</code>, <code>re2</code>, <code>sentry</code>, <code>gsasl</code>, <code>arrow</code>, <code>protobuf</code>. This is needed for <a href="https://github.com/ClickHouse/ClickHouse/issues/20151" target="_blank" rel="noopener noreferrer">#20151</a>. Part of <a href="https://github.com/ClickHouse/ClickHouse/issues/9226" target="_blank" rel="noopener noreferrer">#9226</a>. A small step towards removal of annoying trash from the build system. <a href="https://github.com/ClickHouse/ClickHouse/pull/30599" target="_blank" rel="noopener noreferrer">#30599</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Hermetic builds: use fixed version of libc and make sure that no source or binary files from the host OS are using during build. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27133" target="_blank" rel="noopener noreferrer">#27133</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21435" target="_blank" rel="noopener noreferrer">#21435</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30462" target="_blank" rel="noopener noreferrer">#30462</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30011" target="_blank" rel="noopener noreferrer">#30011</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Adding function <code>getFuzzerData()</code> to easily fuzz particular functions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23227" target="_blank" rel="noopener noreferrer">#23227</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27526" target="_blank" rel="noopener noreferrer">#27526</a> (<a href="https://github.com/mathalex" target="_blank" rel="noopener noreferrer">Alexey Boykov</a>).</li><li>More correct setting up capabilities inside Docker. <a href="https://github.com/ClickHouse/ClickHouse/pull/31802" target="_blank" rel="noopener noreferrer">#31802</a> (<a href="https://github.com/pkit" target="_blank" rel="noopener noreferrer">Constantine Peresypkin</a>).</li><li>Enable clang <code>-fstrict-vtable-pointers</code>, <code>-fwhole-program-vtables</code> compile options. <a href="https://github.com/ClickHouse/ClickHouse/pull/20151" target="_blank" rel="noopener noreferrer">#20151</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Avoid downloading toolchain tarballs for cross-compiling for FreeBSD. <a href="https://github.com/ClickHouse/ClickHouse/pull/31672" target="_blank" rel="noopener noreferrer">#31672</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Initial support for risc-v. See development/build-cross-riscv for quirks and build command that was tested. <a href="https://github.com/ClickHouse/ClickHouse/pull/31309" target="_blank" rel="noopener noreferrer">#31309</a> (<a href="https://github.com/Civil" target="_blank" rel="noopener noreferrer">Vladimir Smirnov</a>).</li><li>Support compile in arm machine with parameter &quot;-DENABLE_TESTS=OFF&quot;. <a href="https://github.com/ClickHouse/ClickHouse/pull/31007" target="_blank" rel="noopener noreferrer">#31007</a> (<a href="https://github.com/zhanghuajieHIT" target="_blank" rel="noopener noreferrer">zhanghuajie</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2111-2021-11-09">ClickHouse release v21.11, 2021-11-09<a class="hash-link" href="#clickhouse-release-v2111-2021-11-09" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-1">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-1" title="Direct link to heading">​</a></h4><ul><li>Change order of json_path and json arguments in SQL/JSON functions (to be consistent with the standard). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30449" target="_blank" rel="noopener noreferrer">#30449</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30474" target="_blank" rel="noopener noreferrer">#30474</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Remove <code>MergeTree</code> table setting <code>write_final_mark</code>. It will be always <code>true</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30455" target="_blank" rel="noopener noreferrer">#30455</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). No actions required, all tables are compatible with the new version.</li><li>Function <code>bayesAB</code> is removed. Please help to return this function back, refreshed. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26233" target="_blank" rel="noopener noreferrer">#26233</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29934" target="_blank" rel="noopener noreferrer">#29934</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>This is relevant only if you already started using the experimental <code>clickhouse-keeper</code> support. Now ClickHouse Keeper snapshots compressed with <code>ZSTD</code> codec by default instead of custom ClickHouse LZ4 block compression. This behavior can be turned off with <code>compress_snapshots_with_zstd_format</code> coordination setting (must be equal on all quorum replicas). Backward incompatibility is quite rare and may happen only when new node will send snapshot (happens in case of recovery) to the old node which is unable to read snapshots in ZSTD format. <a href="https://github.com/ClickHouse/ClickHouse/pull/29417" target="_blank" rel="noopener noreferrer">#29417</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-1">New Feature<a class="hash-link" href="#new-feature-1" title="Direct link to heading">​</a></h4><ul><li>New asynchronous INSERT mode allows to accumulate inserted data and store it in a single batch in background. On client it can be enabled by setting <code>async_insert</code> for <code>INSERT</code> queries with data inlined in query or in separate buffer (e.g. for <code>INSERT</code> queries via HTTP protocol). If <code>wait_for_async_insert</code> is true (by default) the client will wait until data will be flushed to table. On server-side it controlled by the settings <code>async_insert_threads</code>, <code>async_insert_max_data_size</code> and <code>async_insert_busy_timeout_ms</code>. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/18282" target="_blank" rel="noopener noreferrer">#18282</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27537" target="_blank" rel="noopener noreferrer">#27537</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/20557" target="_blank" rel="noopener noreferrer">#20557</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>). Notes on performance: with asynchronous inserts you can do up to around 10 000 individual INSERT queries per second, so it is still recommended to insert in batches if you want to achieve performance up to millions inserted rows per second.</li><li>Add interactive mode for <code>clickhouse-local</code>. So, you can just run <code>clickhouse-local</code> to get a command line ClickHouse interface without connecting to a server and process data from files and external data sources. Also merge the code of <code>clickhouse-client</code> and <code>clickhouse-local</code> together. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7203" target="_blank" rel="noopener noreferrer">#7203</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25516" target="_blank" rel="noopener noreferrer">#25516</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22401" target="_blank" rel="noopener noreferrer">#22401</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26231" target="_blank" rel="noopener noreferrer">#26231</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Added support for executable (scriptable) user defined functions. These are UDFs that can be written in any programming language. <a href="https://github.com/ClickHouse/ClickHouse/pull/28803" target="_blank" rel="noopener noreferrer">#28803</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Allow predefined connections to external data sources. This allows to avoid specifying credentials or addresses while using external data sources, they can be referenced by names instead. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28367" target="_blank" rel="noopener noreferrer">#28367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28577" target="_blank" rel="noopener noreferrer">#28577</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Added <code>INFORMATION_SCHEMA</code> database with <code>SCHEMATA</code>, <code>TABLES</code>, <code>VIEWS</code> and <code>COLUMNS</code> views to the corresponding tables in <code>system</code> database. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9770" target="_blank" rel="noopener noreferrer">#9770</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28691" target="_blank" rel="noopener noreferrer">#28691</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Support <code>EXISTS (subquery)</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/6852" target="_blank" rel="noopener noreferrer">#6852</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29731" target="_blank" rel="noopener noreferrer">#29731</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Session logging for audit. Logging all successful and failed login and logout events to a new <code>system.session_log</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/22415" target="_blank" rel="noopener noreferrer">#22415</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>) (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Support multidimensional cosine distance and euclidean distance functions; L1, L2, Lp, Linf distances and norms. Scalar product on tuples and various arithmetic operators on tuples. This fully closes <a href="https://github.com/ClickHouse/ClickHouse/issues/4509" target="_blank" rel="noopener noreferrer">#4509</a> and even more. <a href="https://github.com/ClickHouse/ClickHouse/pull/27933" target="_blank" rel="noopener noreferrer">#27933</a> (<a href="https://github.com/mathalex" target="_blank" rel="noopener noreferrer">Alexey Boykov</a>).</li><li>Add support for compression and decompression for <code>INTO OUTFILE</code> and <code>FROM INFILE</code> (with autodetect or with additional optional parameter). <a href="https://github.com/ClickHouse/ClickHouse/pull/27135" target="_blank" rel="noopener noreferrer">#27135</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Add CORS (Cross Origin Resource Sharing) support with HTTP <code>OPTIONS</code> request. It means, now Grafana will work with serverless requests without a kludges. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18693" target="_blank" rel="noopener noreferrer">#18693</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29155" target="_blank" rel="noopener noreferrer">#29155</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Queries with JOIN ON now supports disjunctions (OR). <a href="https://github.com/ClickHouse/ClickHouse/pull/21320" target="_blank" rel="noopener noreferrer">#21320</a> (<a href="https://github.com/ilejn" target="_blank" rel="noopener noreferrer">Ilya Golshtein</a>).</li><li>Added function <code>tokens</code>. That allow to split string into tokens using non-alpha numeric ASCII characters as separators. <a href="https://github.com/ClickHouse/ClickHouse/pull/29981" target="_blank" rel="noopener noreferrer">#29981</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>). Added function <code>ngrams</code> to extract ngrams from text. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29699" target="_blank" rel="noopener noreferrer">#29699</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29738" target="_blank" rel="noopener noreferrer">#29738</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add functions for Unicode normalization: <code>normalizeUTF8NFC</code>, <code>normalizeUTF8NFD</code>, <code>normalizeUTF8NFKC</code>, <code>normalizeUTF8NFKD</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/28633" target="_blank" rel="noopener noreferrer">#28633</a> (<a href="https://github.com/darkkeks" target="_blank" rel="noopener noreferrer">darkkeks</a>).</li><li>Streaming consumption of application log files in ClickHouse with <code>FileLog</code> table engine. It&#x27;s like <code>Kafka</code> or <code>RabbitMQ</code> engine but for append-only and rotated logs in local filesystem. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/6953" target="_blank" rel="noopener noreferrer">#6953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25969" target="_blank" rel="noopener noreferrer">#25969</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>) (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add <code>CapnProto</code> output format, refactor <code>CapnProto</code> input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/29291" target="_blank" rel="noopener noreferrer">#29291</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Allow to write number in query as binary literal. Example <code>SELECT 0b001;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29304" target="_blank" rel="noopener noreferrer">#29304</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added <code>hashed_array</code> dictionary type. It saves memory when using dictionaries with multiple attributes. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30236" target="_blank" rel="noopener noreferrer">#30236</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30242" target="_blank" rel="noopener noreferrer">#30242</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added <code>JSONExtractKeys</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/30056" target="_blank" rel="noopener noreferrer">#30056</a> (<a href="https://github.com/orloffv" target="_blank" rel="noopener noreferrer">Vitaly</a>).</li><li>Add a function <code>getOSKernelVersion</code> - it returns a string with OS kernel version. <a href="https://github.com/ClickHouse/ClickHouse/pull/29755" target="_blank" rel="noopener noreferrer">#29755</a> (<a href="https://github.com/Joeywzr" target="_blank" rel="noopener noreferrer">Memo</a>).</li><li>Added <code>MD4</code> and <code>SHA384</code> functions. MD4 is an obsolete and insecure hash function, it can be used only in rare cases when MD4 is already being used in some legacy system and you need to get exactly the same result. <a href="https://github.com/ClickHouse/ClickHouse/pull/29602" target="_blank" rel="noopener noreferrer">#29602</a> (<a href="https://github.com/NSTikhomirov" target="_blank" rel="noopener noreferrer">Nikita Tikhomirov</a>).</li><li>HSTS can be enabled for Clickhouse HTTP server by setting <code>hsts_max_age</code> in configuration file with a positive number. <a href="https://github.com/ClickHouse/ClickHouse/pull/29516" target="_blank" rel="noopener noreferrer">#29516</a> (<a href="https://github.com/lingtaolf" target="_blank" rel="noopener noreferrer">凌涛</a>).</li><li>Huawei OBS Storage support. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24294" target="_blank" rel="noopener noreferrer">#24294</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29511" target="_blank" rel="noopener noreferrer">#29511</a> (<a href="https://github.com/MaxWk" target="_blank" rel="noopener noreferrer">kevin wan</a>).</li><li>New function <code>mapContainsKeyLike</code> to get the map that key matches a simple regular expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/29471" target="_blank" rel="noopener noreferrer">#29471</a> (<a href="https://github.com/lingtaolf" target="_blank" rel="noopener noreferrer">凌涛</a>). New function <code>mapExtractKeyLike</code> to get the map only kept elements matched specified pattern. <a href="https://github.com/ClickHouse/ClickHouse/pull/30793" target="_blank" rel="noopener noreferrer">#30793</a> (<a href="https://github.com/lingtaolf" target="_blank" rel="noopener noreferrer">凌涛</a>).</li><li>Implemented <code>ALTER TABLE x MODIFY COMMENT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29264" target="_blank" rel="noopener noreferrer">#29264</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Adds H3 inspection functions that are missing from ClickHouse but are available via the H3 api: <a href="https://h3geo.org/docs/api/inspection" target="_blank" rel="noopener noreferrer">https://h3geo.org/docs/api/inspection</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29209" target="_blank" rel="noopener noreferrer">#29209</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Allow non-replicated ALTER TABLE FETCH and ATTACH in Replicated databases. <a href="https://github.com/ClickHouse/ClickHouse/pull/29202" target="_blank" rel="noopener noreferrer">#29202</a> (<a href="https://github.com/kmichel-aiven" target="_blank" rel="noopener noreferrer">Kevin Michel</a>).</li><li>Added a setting <code>output_format_csv_null_representation</code>: This is the same as <code>output_format_tsv_null_representation</code> but is for CSV output. <a href="https://github.com/ClickHouse/ClickHouse/pull/29123" target="_blank" rel="noopener noreferrer">#29123</a> (<a href="https://github.com/depressed-pho" target="_blank" rel="noopener noreferrer">PHO</a>).</li><li>Added function <code>zookeeperSessionUptime()</code> which returns uptime of current ZooKeeper session in seconds. <a href="https://github.com/ClickHouse/ClickHouse/pull/28983" target="_blank" rel="noopener noreferrer">#28983</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Implements the <code>h3ToGeoBoundary</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/28952" target="_blank" rel="noopener noreferrer">#28952</a> (<a href="https://github.com/fuzzERot" target="_blank" rel="noopener noreferrer">Ivan Veselov</a>).</li><li>Add aggregate function <code>exponentialMovingAverage</code> that can be used as window function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27511" target="_blank" rel="noopener noreferrer">#27511</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28914" target="_blank" rel="noopener noreferrer">#28914</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow to include subcolumns of table columns into <code>DESCRIBE</code> query result (can be enabled by setting <code>describe_include_subcolumns</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/28905" target="_blank" rel="noopener noreferrer">#28905</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li><code>Executable</code>, <code>ExecutablePool</code> added option <code>send_chunk_header</code>. If this option is true then chunk rows_count with line break will be sent to client before chunk. <a href="https://github.com/ClickHouse/ClickHouse/pull/28833" target="_blank" rel="noopener noreferrer">#28833</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li><code>tokenbf_v1</code> and <code>ngram</code> support Map with key of String of FixedSring type. It enhance data skipping in query with map key filter. <code>sql CREATE TABLE map_tokenbf ( row_id UInt32, map Map(String, String), INDEX map_tokenbf map TYPE ngrambf_v1(4,256,2,0) GRANULARITY 1 ) Engine=MergeTree() Order by id </code> With table above, the query <code>select * from map_tokebf where map[&#x27;K&#x27;]=&#x27;V&#x27;</code> will skip the granule that doesn&#x27;t contain key <code>A</code> . Of course, how many rows will skipped is depended on the <code>granularity</code> and <code>index_granularity</code> you set. <a href="https://github.com/ClickHouse/ClickHouse/pull/28511" target="_blank" rel="noopener noreferrer">#28511</a> (<a href="https://github.com/lingtaolf" target="_blank" rel="noopener noreferrer">凌涛</a>).</li><li>Send profile events from server to client. New packet type <code>ProfileEvents</code> was introduced. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26177" target="_blank" rel="noopener noreferrer">#26177</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28364" target="_blank" rel="noopener noreferrer">#28364</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Bit shift operations for <code>FixedString</code> and <code>String</code> data types. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27763" target="_blank" rel="noopener noreferrer">#27763</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28325" target="_blank" rel="noopener noreferrer">#28325</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Support adding / deleting tables to replication from PostgreSQL dynamically in database engine MaterializedPostgreSQL. Support alter for database settings. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27573" target="_blank" rel="noopener noreferrer">#27573</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28301" target="_blank" rel="noopener noreferrer">#28301</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Added function accurateCastOrDefault(x, T). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21330" target="_blank" rel="noopener noreferrer">#21330</a>. Authors @taiyang-li. <a href="https://github.com/ClickHouse/ClickHouse/pull/23028" target="_blank" rel="noopener noreferrer">#23028</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add Function <code>toUUIDOrDefault</code>, <code>toUInt8/16/32/64/256OrDefault</code>, <code>toInt8/16/32/64/128/256OrDefault</code>, which enables user defining default value(not null) when string parsing is failed. <a href="https://github.com/ClickHouse/ClickHouse/pull/21330" target="_blank" rel="noopener noreferrer">#21330</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-1">Performance Improvement<a class="hash-link" href="#performance-improvement-1" title="Direct link to heading">​</a></h4><ul><li>Background merges can be preempted by each other and they are scheduled with appropriate priorities. Now long running merges won&#x27;t prevent short merges to proceed. This is needed for a better scheduling and controlling of merges execution. It reduces the chances to get &quot;too many parts&quot; error. <a href="https://github.com/ClickHouse/ClickHouse/issues/22381" target="_blank" rel="noopener noreferrer">#22381</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25165" target="_blank" rel="noopener noreferrer">#25165</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>). Added an ability to execute more merges and mutations than the number of threads in background pool. Merges and mutations will be executed step by step according to their sizes (lower is more prioritized). The ratio of the number of tasks to threads to execute is controlled by a setting <code>background_merges_mutations_concurrency_ratio</code>, 2 by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/29140" target="_blank" rel="noopener noreferrer">#29140</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Allow to use asynchronous reads for remote filesystems. Lower the number of seeks while reading from remote filesystems. It improves performance tremendously and makes the experimental <code>web</code> and <code>s3</code> disks to work faster than EBS under certain conditions. <a href="https://github.com/ClickHouse/ClickHouse/pull/29205" target="_blank" rel="noopener noreferrer">#29205</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). In the meantime, the <code>web</code> disk type (static dataset hosted on a web server) is graduated from being experimental to be production ready.</li><li>Queries with <code>INTO OUTFILE</code> in <code>clickhouse-client</code> will use multiple threads. Fix the issue with flickering progress-bar when using <code>INTO OUTFILE</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30873" target="_blank" rel="noopener noreferrer">#30873</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30872" target="_blank" rel="noopener noreferrer">#30872</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30886" target="_blank" rel="noopener noreferrer">#30886</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Reduce amount of redundant compressed data read from disk for some types <code>SELECT</code> queries (only for <code>MergeTree</code> engines family). <a href="https://github.com/ClickHouse/ClickHouse/pull/30111" target="_blank" rel="noopener noreferrer">#30111</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Remove some redundant <code>seek</code> calls while reading compressed blocks in MergeTree table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/29766" target="_blank" rel="noopener noreferrer">#29766</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Make <code>url</code> table function to process multiple URLs in parallel. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29670" target="_blank" rel="noopener noreferrer">#29670</a> and closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29671" target="_blank" rel="noopener noreferrer">#29671</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29673" target="_blank" rel="noopener noreferrer">#29673</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve performance of aggregation in order of primary key (with enabled setting <code>optimize_aggregation_in_order</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/30266" target="_blank" rel="noopener noreferrer">#30266</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Now clickhouse is using DNS cache while communicating with external S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/29999" target="_blank" rel="noopener noreferrer">#29999</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add support for pushdown of <code>IS NULL</code>/<code>IS NOT NULL</code> to external databases (i.e. MySQL). <a href="https://github.com/ClickHouse/ClickHouse/pull/29463" target="_blank" rel="noopener noreferrer">#29463</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>). Transform <code>isNull</code>/<code>isNotNull</code> to <code>IS NULL</code>/<code>IS NOT NULL</code> (for external dbs, i.e. MySQL). <a href="https://github.com/ClickHouse/ClickHouse/pull/29446" target="_blank" rel="noopener noreferrer">#29446</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>SELECT queries from Dictionary tables will use multiple threads. <a href="https://github.com/ClickHouse/ClickHouse/pull/30500" target="_blank" rel="noopener noreferrer">#30500</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve performance for filtering (WHERE operation) of <code>Decimal</code> columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/30431" target="_blank" rel="noopener noreferrer">#30431</a> (<a href="https://github.com/vesslanjin" target="_blank" rel="noopener noreferrer">Jun Jin</a>).</li><li>Remove branchy code in filter operation with a better implementation with popcnt/ctz which have better performance. <a href="https://github.com/ClickHouse/ClickHouse/pull/29881" target="_blank" rel="noopener noreferrer">#29881</a> (<a href="https://github.com/vesslanjin" target="_blank" rel="noopener noreferrer">Jun Jin</a>).</li><li>Improve filter bytemask generator (used for WHERE operator) function all in one with SSE/AVX2/AVX512 instructions. Note that by default ClickHouse is only using SSE, so it&#x27;s only relevant for custom builds. <a href="https://github.com/ClickHouse/ClickHouse/pull/30014" target="_blank" rel="noopener noreferrer">#30014</a> (<a href="https://github.com/jinjunzh" target="_blank" rel="noopener noreferrer">jasperzhu</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/30670" target="_blank" rel="noopener noreferrer">#30670</a> (<a href="https://github.com/jinjunzh" target="_blank" rel="noopener noreferrer">jasperzhu</a>).</li><li>Improve the performance of SUM aggregate function of Nullable floating point numbers. <a href="https://github.com/ClickHouse/ClickHouse/pull/28906" target="_blank" rel="noopener noreferrer">#28906</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Speed up part loading process with multiple disks are in use. The idea is similar to <a href="https://github.com/ClickHouse/ClickHouse/pull/16423" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/16423</a> . Prod env shows improvement: 24 min -&gt; 16 min . <a href="https://github.com/ClickHouse/ClickHouse/pull/28363" target="_blank" rel="noopener noreferrer">#28363</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Reduce default settings for S3 multipart upload part size to lower memory usage. <a href="https://github.com/ClickHouse/ClickHouse/pull/28679" target="_blank" rel="noopener noreferrer">#28679</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Speed up <code>bitmapAnd</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/28332" target="_blank" rel="noopener noreferrer">#28332</a> (<a href="https://github.com/OodounaikingoO" target="_blank" rel="noopener noreferrer">dddounaiking</a>).</li><li>Removed sub-optimal mutation notifications in <code>StorageMergeTree</code> when merges are still going. <a href="https://github.com/ClickHouse/ClickHouse/pull/27552" target="_blank" rel="noopener noreferrer">#27552</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Attempt to improve performance of string comparison. <a href="https://github.com/ClickHouse/ClickHouse/pull/28767" target="_blank" rel="noopener noreferrer">#28767</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Primary key index and partition filter can work in tuple. <a href="https://github.com/ClickHouse/ClickHouse/pull/29281" target="_blank" rel="noopener noreferrer">#29281</a> (<a href="https://github.com/lingtaolf" target="_blank" rel="noopener noreferrer">凌涛</a>).</li><li>If query has multiple quantile aggregate functions with the same arguments but different level parameter, they will be fused together and executed in one pass if the setting <code>optimize_syntax_fuse_functions</code> is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/26657" target="_blank" rel="noopener noreferrer">#26657</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Now min-max aggregation over the first expression of primary key is optimized by projection. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/329" target="_blank" rel="noopener noreferrer">#329</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29918" target="_blank" rel="noopener noreferrer">#29918</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-1">Experimental Feature<a class="hash-link" href="#experimental-feature-1" title="Direct link to heading">​</a></h4><ul><li>Add ability to change nodes configuration (in <code>.xml</code> file) for ClickHouse Keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/30372" target="_blank" rel="noopener noreferrer">#30372</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add <code>sparkbar</code> aggregate function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26175" target="_blank" rel="noopener noreferrer">#26175</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27481" target="_blank" rel="noopener noreferrer">#27481</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>). Note: there is one flaw in this function, the behaviour will be changed in future releases.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-1">Improvement<a class="hash-link" href="#improvement-1" title="Direct link to heading">​</a></h4><ul><li>Allow user to change log levels without restart. <a href="https://github.com/ClickHouse/ClickHouse/pull/29586" target="_blank" rel="noopener noreferrer">#29586</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Multiple improvements for SQL UDF. Queries for manipulation of SQL User Defined Functions now support ON CLUSTER clause. Example <code>CREATE FUNCTION test_function ON CLUSTER &#x27;cluster&#x27; AS x -&gt; x + 1;</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30666" target="_blank" rel="noopener noreferrer">#30666</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30734" target="_blank" rel="noopener noreferrer">#30734</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>). Support <code>CREATE OR REPLACE</code>, <code>CREATE IF NOT EXISTS</code> syntaxes. <a href="https://github.com/ClickHouse/ClickHouse/pull/30454" target="_blank" rel="noopener noreferrer">#30454</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>). Added DROP IF EXISTS support. Example <code>DROP FUNCTION IF EXISTS test_function</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30437" target="_blank" rel="noopener noreferrer">#30437</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>). Support lambdas. Example <code>CREATE FUNCTION lambda_function AS x -&gt; arrayMap(element -&gt; element * 2, x);</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30435" target="_blank" rel="noopener noreferrer">#30435</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>). Support SQL user defined functions for <code>clickhouse-local</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30179" target="_blank" rel="noopener noreferrer">#30179</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Enable per-query memory profiler (set to <code>memory_profiler_step</code> = 4MiB) globally. <a href="https://github.com/ClickHouse/ClickHouse/pull/29455" target="_blank" rel="noopener noreferrer">#29455</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added columns <code>data_compressed_bytes</code>, <code>data_uncompressed_bytes</code>, <code>marks_bytes</code> into <code>system.data_skipping_indices</code>. Added columns <code>secondary_indices_compressed_bytes</code>, <code>secondary_indices_uncompressed_bytes</code>, <code>secondary_indices_marks_bytes</code> into <code>system.parts</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29697" target="_blank" rel="noopener noreferrer">#29697</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29896" target="_blank" rel="noopener noreferrer">#29896</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add <code>table</code> alias to system.tables and <code>database</code> alias to system.databases <a href="https://github.com/ClickHouse/ClickHouse/issues/29677" target="_blank" rel="noopener noreferrer">#29677</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29882" target="_blank" rel="noopener noreferrer">#29882</a> (<a href="https://github.com/MaxWk" target="_blank" rel="noopener noreferrer">kevin wan</a>).</li><li>Correctly resolve interdependencies between tables on server startup. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8004" target="_blank" rel="noopener noreferrer">#8004</a>, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15170" target="_blank" rel="noopener noreferrer">#15170</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28373" target="_blank" rel="noopener noreferrer">#28373</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Avoid error &quot;Division by zero&quot; when denominator is Nullable in functions <code>divide</code>, <code>intDiv</code> and <code>modulo</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22621" target="_blank" rel="noopener noreferrer">#22621</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28352" target="_blank" rel="noopener noreferrer">#28352</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Allow to parse values of <code>Date</code> data type in text formats as <code>YYYYMMDD</code> in addition to <code>YYYY-MM-DD</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30870" target="_blank" rel="noopener noreferrer">#30870</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30871" target="_blank" rel="noopener noreferrer">#30871</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Web UI: render bars in table cells. <a href="https://github.com/ClickHouse/ClickHouse/pull/29792" target="_blank" rel="noopener noreferrer">#29792</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>User can now create dictionaries with comments: <code>CREATE DICTIONARY ... COMMENT &#x27;vaue&#x27;</code> ... <a href="https://github.com/ClickHouse/ClickHouse/pull/29899" target="_blank" rel="noopener noreferrer">#29899</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>). Users now can set comments to database in <code>CREATE DATABASE</code> statement ... <a href="https://github.com/ClickHouse/ClickHouse/pull/29429" target="_blank" rel="noopener noreferrer">#29429</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Introduce <code>compiled_expression_cache_elements_size</code> setting. If you will ever want to use this setting, you will already know what it does. <a href="https://github.com/ClickHouse/ClickHouse/pull/30667" target="_blank" rel="noopener noreferrer">#30667</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>clickhouse-format now supports option <code>--query</code>. In previous versions you have to pass the query to stdin. <a href="https://github.com/ClickHouse/ClickHouse/pull/29325" target="_blank" rel="noopener noreferrer">#29325</a> (<a href="https://github.com/lingtaolf" target="_blank" rel="noopener noreferrer">凌涛</a>).</li><li>Support <code>ALTER TABLE</code> for tables in <code>Memory</code> databases. Memory databases are used in <code>clickhouse-local</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30866" target="_blank" rel="noopener noreferrer">#30866</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Arrays of all serializable types are now supported by <code>arrayStringConcat</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30840" target="_blank" rel="noopener noreferrer">#30840</a> (<a href="https://github.com/nickitat" target="_blank" rel="noopener noreferrer">Nickita Taranov</a>).</li><li>ClickHouse now will account docker/cgroups limitations to get system memory amount. See <a href="https://github.com/ClickHouse/ClickHouse/issues/25662" target="_blank" rel="noopener noreferrer">#25662</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30574" target="_blank" rel="noopener noreferrer">#30574</a> (<a href="https://github.com/pmed" target="_blank" rel="noopener noreferrer">Pavel Medvedev</a>).</li><li>Fetched table structure for PostgreSQL database is more reliable now. <a href="https://github.com/ClickHouse/ClickHouse/pull/30477" target="_blank" rel="noopener noreferrer">#30477</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Full support of positional arguments in GROUP BY and ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/30433" target="_blank" rel="noopener noreferrer">#30433</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Allow extracting non-string element as string using JSONExtractString. This is for <a href="https://github.com/ClickHouse/ClickHouse/pull/25452#issuecomment-927123287" target="_blank" rel="noopener noreferrer">pull/25452#issuecomment-927123287</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30426" target="_blank" rel="noopener noreferrer">#30426</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added an ability to use FINAL clause in SELECT queries from <code>GraphiteMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30360" target="_blank" rel="noopener noreferrer">#30360</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Minor improvements in replica cloning and enqueuing fetch for broken parts, that should avoid extremely rare hanging of <code>GET_PART</code> entries in replication queue. <a href="https://github.com/ClickHouse/ClickHouse/pull/30346" target="_blank" rel="noopener noreferrer">#30346</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Allow symlinks to files in <code>user_files</code> directory for file table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/30309" target="_blank" rel="noopener noreferrer">#30309</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fixed comparison of <code>Date32</code> with <code>Date</code>, <code>DateTime</code>, <code>DateTime64</code> and <code>String</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30219" target="_blank" rel="noopener noreferrer">#30219</a> (<a href="https://github.com/lhuang09287750" target="_blank" rel="noopener noreferrer">liang.huang</a>).</li><li>Allow to remove <code>SAMPLE BY</code> expression from <code>MergeTree</code> tables (<code>ALTER TABLE &lt;table&gt; REMOVE SAMPLE BY</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/30180" target="_blank" rel="noopener noreferrer">#30180</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Now <code>Keeper</code> (as part of <code>clickhouse-server</code>) will start asynchronously if it can connect to some other node. <a href="https://github.com/ClickHouse/ClickHouse/pull/30170" target="_blank" rel="noopener noreferrer">#30170</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now <code>clickhouse-client</code> supports native multi-line editing. <a href="https://github.com/ClickHouse/ClickHouse/pull/30143" target="_blank" rel="noopener noreferrer">#30143</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li><code>polygon</code> dictionaries (reverse geocoding): added support for reading the dictionary content with SELECT query method if setting <code>store_polygon_key_column</code> = true. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30090" target="_blank" rel="noopener noreferrer">#30090</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30142" target="_blank" rel="noopener noreferrer">#30142</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add ClickHouse logo to Play UI. <a href="https://github.com/ClickHouse/ClickHouse/pull/29674" target="_blank" rel="noopener noreferrer">#29674</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Better exception message while reading column from Arrow-supported formats like <code>Arrow</code>, <code>ArrowStream</code>, <code>Parquet</code> and <code>ORC</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29926" target="_blank" rel="noopener noreferrer">#29926</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29927" target="_blank" rel="noopener noreferrer">#29927</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix data-race between flush and startup in <code>Buffer</code> tables. This can appear in tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/29930" target="_blank" rel="noopener noreferrer">#29930</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>lock-order-inversion</code> between <code>DROP TABLE</code> for <code>DatabaseMemory</code> and <code>LiveView</code>. Live View is an experimental feature. Memory database is used in clickhouse-local. <a href="https://github.com/ClickHouse/ClickHouse/pull/29929" target="_blank" rel="noopener noreferrer">#29929</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix lock-order-inversion between periodic dictionary reload and config reload. <a href="https://github.com/ClickHouse/ClickHouse/pull/29928" target="_blank" rel="noopener noreferrer">#29928</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Update zoneinfo files to 2021c. <a href="https://github.com/ClickHouse/ClickHouse/pull/29925" target="_blank" rel="noopener noreferrer">#29925</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add ability to configure retries and delays between them for <code>clickhouse-copier</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29921" target="_blank" rel="noopener noreferrer">#29921</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add <code>shutdown_wait_unfinished_queries</code> server setting to allowing waiting for running queries up to <code>shutdown_wait_unfinished</code> time. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/24451" target="_blank" rel="noopener noreferrer">#24451</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29914" target="_blank" rel="noopener noreferrer">#29914</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add ability to trace peak memory usage (with new trace_type in <code>system.trace_log</code> - <code>MemoryPeak</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/29858" target="_blank" rel="noopener noreferrer">#29858</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>PostgreSQL foreign tables: Added partitioned table prefix &#x27;p&#x27; for the query for fetching replica identity index. <a href="https://github.com/ClickHouse/ClickHouse/pull/29828" target="_blank" rel="noopener noreferrer">#29828</a> (<a href="https://github.com/Shohjahon" target="_blank" rel="noopener noreferrer">Shoh Jahon</a>).</li><li>Apply <code>max_untracked_memory</code>/<code>memory_profiler_step</code>/<code>memory_profiler_sample_probability</code> during mutate/merge to profile memory usage during merges. <a href="https://github.com/ClickHouse/ClickHouse/pull/29681" target="_blank" rel="noopener noreferrer">#29681</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Query obfuscator: <code>clickhouse-format --obfuscate</code> now works with more types of queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/29672" target="_blank" rel="noopener noreferrer">#29672</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the issue: <code>clickhouse-format --obfuscate</code> cannot process queries with embedded dictionaries (functions <code>regionTo...</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/29667" target="_blank" rel="noopener noreferrer">#29667</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix incorrect Nullable processing of JSON functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29615" target="_blank" rel="noopener noreferrer">#29615</a> . Mark as improvement because <a href="https://github.com/ClickHouse/ClickHouse/pull/28012" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/28012</a> is not released. <a href="https://github.com/ClickHouse/ClickHouse/pull/29659" target="_blank" rel="noopener noreferrer">#29659</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Increase <code>listen_backlog</code> by default (to match default in newer linux kernel). <a href="https://github.com/ClickHouse/ClickHouse/pull/29643" target="_blank" rel="noopener noreferrer">#29643</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Reload dictionaries, models, user defined executable functions if servers config <code>dictionaries_config</code>, <code>models_config</code>, <code>user_defined_executable_functions_config</code> changes. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28142" target="_blank" rel="noopener noreferrer">#28142</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29529" target="_blank" rel="noopener noreferrer">#29529</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Get rid of pointless restriction on projection name. Now projection name can start with <code>tmp_</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29520" target="_blank" rel="noopener noreferrer">#29520</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed <code>There is no query or query context has expired</code> error in mutations with nested subqueries. Do not allow subqueries in mutation if table is replicated and <code>allow_nondeterministic_mutations</code> setting is disabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/29495" target="_blank" rel="noopener noreferrer">#29495</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Apply config changes to <code>max_concurrent_queries</code> during runtime (no need to restart). <a href="https://github.com/ClickHouse/ClickHouse/pull/29414" target="_blank" rel="noopener noreferrer">#29414</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Added setting <code>use_skip_indexes</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29405" target="_blank" rel="noopener noreferrer">#29405</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add support for <code>FREEZE</code>ing in-memory parts (for backups). <a href="https://github.com/ClickHouse/ClickHouse/pull/29376" target="_blank" rel="noopener noreferrer">#29376</a> (<a href="https://github.com/mo-avatar" target="_blank" rel="noopener noreferrer">Mo Xuan</a>).</li><li>Pass through initial query_id for <code>clickhouse-benchmark</code> (previously if you run remote query via <code>clickhouse-benchmark</code>, queries on shards will not be linked to the initial query via <code>initial_query_id</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/29364" target="_blank" rel="noopener noreferrer">#29364</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Skip indexes <code>tokenbf_v1</code> and <code>ngrambf_v1</code>: added support for <code>Array</code> data type with key of <code>String</code> of <code>FixedString</code> type. <a href="https://github.com/ClickHouse/ClickHouse/pull/29280" target="_blank" rel="noopener noreferrer">#29280</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>). Skip indexes <code>tokenbf_v1</code> and <code>ngrambf_v1</code> added support for <code>Map</code> data type with key of <code>String</code> of <code>FixedString</code> type. Author @lingtaolf. <a href="https://github.com/ClickHouse/ClickHouse/pull/29220" target="_blank" rel="noopener noreferrer">#29220</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Function <code>has</code>: added support for <code>Map</code> data type. <a href="https://github.com/ClickHouse/ClickHouse/pull/29267" target="_blank" rel="noopener noreferrer">#29267</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add <code>compress_logs</code> settings for clickhouse-keeper which allow to compress clickhouse-keeper logs (for replicated state machine) in <code>ZSTD</code> . Implements: <a href="https://github.com/ClickHouse/ClickHouse/issues/26977" target="_blank" rel="noopener noreferrer">#26977</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29223" target="_blank" rel="noopener noreferrer">#29223</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add a setting <code>external_table_strict_query</code> - it will force passing the whole WHERE expression in queries to foreign databases even if it is incompatible. <a href="https://github.com/ClickHouse/ClickHouse/pull/29206" target="_blank" rel="noopener noreferrer">#29206</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Disable projections when <code>ARRAY JOIN</code> is used. In previous versions projection analysis may break aliases in array join. <a href="https://github.com/ClickHouse/ClickHouse/pull/29139" target="_blank" rel="noopener noreferrer">#29139</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support more types in <code>MsgPack</code> input/output format. <a href="https://github.com/ClickHouse/ClickHouse/pull/29077" target="_blank" rel="noopener noreferrer">#29077</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Allow to input and output <code>LowCardinality</code> columns in <code>ORC</code> input/output format. <a href="https://github.com/ClickHouse/ClickHouse/pull/29062" target="_blank" rel="noopener noreferrer">#29062</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Select from <code>system.distributed_ddl_queue</code> might show incorrect values, it&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/29061" target="_blank" rel="noopener noreferrer">#29061</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Correct behaviour with unknown methods for HTTP connection. Solves <a href="https://github.com/ClickHouse/ClickHouse/issues/29050" target="_blank" rel="noopener noreferrer">#29050</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29057" target="_blank" rel="noopener noreferrer">#29057</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li><code>clickhouse-keeper</code>: Fix bug in <code>clickhouse-keeper-converter</code> which can lead to some data loss while restoring from ZooKeeper logs (not snapshot). <a href="https://github.com/ClickHouse/ClickHouse/pull/29030" target="_blank" rel="noopener noreferrer">#29030</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>). Fix bug in <code>clickhouse-keeper-converter</code> which can lead to incorrect ZooKeeper log deserialization. <a href="https://github.com/ClickHouse/ClickHouse/pull/29071" target="_blank" rel="noopener noreferrer">#29071</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Apply settings from <code>CREATE ... AS SELECT</code> queries (fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/28810" target="_blank" rel="noopener noreferrer">#28810</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/28962" target="_blank" rel="noopener noreferrer">#28962</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Respect default database setting for ALTER TABLE ... ON CLUSTER ... REPLACE/MOVE PARTITION FROM/TO ... <a href="https://github.com/ClickHouse/ClickHouse/pull/28955" target="_blank" rel="noopener noreferrer">#28955</a> (<a href="https://github.com/anneji-dev" target="_blank" rel="noopener noreferrer">anneji-dev</a>).</li><li>gRPC protocol: Allow change server-side compression from client. <a href="https://github.com/ClickHouse/ClickHouse/pull/28953" target="_blank" rel="noopener noreferrer">#28953</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Skip &quot;no data&quot; exception when reading thermal sensors for asynchronous metrics. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28852" target="_blank" rel="noopener noreferrer">#28852</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28882" target="_blank" rel="noopener noreferrer">#28882</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed logical race condition that might cause <code>Dictionary not found</code> error for existing dictionary in rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/28853" target="_blank" rel="noopener noreferrer">#28853</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Relax nested function for If-combinator check (but forbid nested identical combinators). <a href="https://github.com/ClickHouse/ClickHouse/pull/28828" target="_blank" rel="noopener noreferrer">#28828</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible uncaught exception during server termination. <a href="https://github.com/ClickHouse/ClickHouse/pull/28761" target="_blank" rel="noopener noreferrer">#28761</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Forbid cleaning of tmp directories that can be used by an active mutation/merge if mutation/merge is extraordinarily long. <a href="https://github.com/ClickHouse/ClickHouse/pull/28760" target="_blank" rel="noopener noreferrer">#28760</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow optimization <code>optimize_arithmetic_operations_in_aggregate_functions = 1</code> when alias is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/28746" target="_blank" rel="noopener noreferrer">#28746</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Implement <code>detach_not_byte_identical_parts</code> setting for <code>ReplicatedMergeTree</code>, that will detach instead of remove not byte-identical parts (after mege/mutate). <a href="https://github.com/ClickHouse/ClickHouse/pull/28708" target="_blank" rel="noopener noreferrer">#28708</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Implement <code>max_suspicious_broken_parts_bytes</code> setting for <code>MergeTree</code> (to limit total size of all broken parts, default is <code>1GiB</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/28707" target="_blank" rel="noopener noreferrer">#28707</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Enable expanding macros in <code>RabbitMQ</code> table settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/28683" target="_blank" rel="noopener noreferrer">#28683</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Restore the possibility to read data of a table using the <code>Log</code> engine in multiple threads. <a href="https://github.com/ClickHouse/ClickHouse/pull/28125" target="_blank" rel="noopener noreferrer">#28125</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix misbehavior of NULL column handling in JSON functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/27930" target="_blank" rel="noopener noreferrer">#27930</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28012" target="_blank" rel="noopener noreferrer">#28012</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Allow to set the size of Mark/Uncompressed cache for skip indices separately from columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/27961" target="_blank" rel="noopener noreferrer">#27961</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Allow to mix JOIN with <code>USING</code> with other JOIN types. <a href="https://github.com/ClickHouse/ClickHouse/pull/23881" target="_blank" rel="noopener noreferrer">#23881</a> (<a href="https://github.com/darkkeks" target="_blank" rel="noopener noreferrer">darkkeks</a>).</li><li>Update aws-sdk submodule for throttling in Yandex Cloud S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/30646" target="_blank" rel="noopener noreferrer">#30646</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Fix releasing query ID and session ID at the end of query processing while handing gRPC call. <a href="https://github.com/ClickHouse/ClickHouse/pull/29954" target="_blank" rel="noopener noreferrer">#29954</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix shutdown of <code>AccessControlManager</code> to fix flaky test. <a href="https://github.com/ClickHouse/ClickHouse/pull/29951" target="_blank" rel="noopener noreferrer">#29951</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix failed assertion in reading from <code>HDFS</code>. Update libhdfs3 library to be able to run in tests in debug. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29251" target="_blank" rel="noopener noreferrer">#29251</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27814" target="_blank" rel="noopener noreferrer">#27814</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29276" target="_blank" rel="noopener noreferrer">#29276</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-1">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-1" title="Direct link to heading">​</a></h4><ul><li>Add support for FreeBSD builds for Aarch64 machines. <a href="https://github.com/ClickHouse/ClickHouse/pull/29952" target="_blank" rel="noopener noreferrer">#29952</a> (<a href="https://github.com/MikaelUrankar" target="_blank" rel="noopener noreferrer">MikaelUrankar</a>).</li><li>Recursive submodules are no longer needed for ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/30315" target="_blank" rel="noopener noreferrer">#30315</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>ClickHouse can be statically built with Musl. This is added as experiment, it does not support building <code>odbc-bridge</code>, <code>library-bridge</code>, integration with CatBoost and some libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/30248" target="_blank" rel="noopener noreferrer">#30248</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Enable <code>Protobuf</code>, <code>Arrow</code>, <code>ORC</code>, <code>Parquet</code> for <code>AArch64</code> and <code>Darwin</code> (macOS) builds. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29248" target="_blank" rel="noopener noreferrer">#29248</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28018" target="_blank" rel="noopener noreferrer">#28018</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30015" target="_blank" rel="noopener noreferrer">#30015</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add cross-build for PowerPC (powerpc64le). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9589" target="_blank" rel="noopener noreferrer">#9589</a>. Enable support for interaction with MySQL for AArch64 and PowerPC. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26301" target="_blank" rel="noopener noreferrer">#26301</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30010" target="_blank" rel="noopener noreferrer">#30010</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Leave only required files in cross-compile toolchains. Include them as submodules (earlier they were downloaded as tarballs). <a href="https://github.com/ClickHouse/ClickHouse/pull/29974" target="_blank" rel="noopener noreferrer">#29974</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Implemented structure-aware fuzzing approach in ClickHouse for select statement parser. <a href="https://github.com/ClickHouse/ClickHouse/pull/30012" target="_blank" rel="noopener noreferrer">#30012</a> (<a href="https://github.com/PaulCher" target="_blank" rel="noopener noreferrer">Paul</a>).</li><li>Turning on experimental constexpr expressions evaluator for clang to speed up template code compilation. <a href="https://github.com/ClickHouse/ClickHouse/pull/29668" target="_blank" rel="noopener noreferrer">#29668</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">myrrc</a>).</li><li>Add ability to compile using newer version fo glibc without using new symbols. <a href="https://github.com/ClickHouse/ClickHouse/pull/29594" target="_blank" rel="noopener noreferrer">#29594</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Reduce Debug build binary size by clang optimization option. <a href="https://github.com/ClickHouse/ClickHouse/pull/28736" target="_blank" rel="noopener noreferrer">#28736</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Now all images for CI will be placed in the separate dockerhub repo. <a href="https://github.com/ClickHouse/ClickHouse/pull/28656" target="_blank" rel="noopener noreferrer">#28656</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Improve support for build with clang-13. <a href="https://github.com/ClickHouse/ClickHouse/pull/28046" target="_blank" rel="noopener noreferrer">#28046</a> (<a href="https://github.com/syominsergey" target="_blank" rel="noopener noreferrer">Sergei Semin</a>).</li><li>Add ability to print raw profile events to <code>clickhouse-client</code> (This can be useful for debugging and for testing). <a href="https://github.com/ClickHouse/ClickHouse/pull/30064" target="_blank" rel="noopener noreferrer">#30064</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add time dependency for clickhouse-server unit (systemd and sysvinit init). <a href="https://github.com/ClickHouse/ClickHouse/pull/28891" target="_blank" rel="noopener noreferrer">#28891</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Reload stacktrace cache when symbol is reloaded. <a href="https://github.com/ClickHouse/ClickHouse/pull/28137" target="_blank" rel="noopener noreferrer">#28137</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix">Bug Fix<a class="hash-link" href="#bug-fix" title="Direct link to heading">​</a></h4><ul><li>Functions for case-insensitive search in UTF-8 strings like <code>positionCaseInsensitiveUTF8</code> and <code>countSubstringsCaseInsensitiveUTF8</code> might find substrings that actually does not match in very rare cases, it&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/30663" target="_blank" rel="noopener noreferrer">#30663</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix reading from empty file on encrypted disk. <a href="https://github.com/ClickHouse/ClickHouse/pull/30494" target="_blank" rel="noopener noreferrer">#30494</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix transformation of disjunctions chain to <code>IN</code> (controlled by settings <code>optimize_min_equality_disjunction_chain_length</code>) in distributed queries with settings <code>legacy_column_name_of_tuple_literal = 0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28658" target="_blank" rel="noopener noreferrer">#28658</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Allow using a materialized column as the sharding key in a distributed table even if <code>insert_allow_materialized_columns=0</code>:. <a href="https://github.com/ClickHouse/ClickHouse/pull/28637" target="_blank" rel="noopener noreferrer">#28637</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix <code>ORDER BY ... WITH FILL</code> with set <code>TO</code> and <code>FROM</code> and no rows in result set. <a href="https://github.com/ClickHouse/ClickHouse/pull/30888" target="_blank" rel="noopener noreferrer">#30888</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix set index not used in AND/OR expressions when there are more than two operands. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/30416" target="_blank" rel="noopener noreferrer">#30416</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/30887" target="_blank" rel="noopener noreferrer">#30887</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix crash when projection with hashing function is materialized. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/30861" target="_blank" rel="noopener noreferrer">#30861</a> . The issue is similar to <a href="https://github.com/ClickHouse/ClickHouse/pull/28560" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/28560</a> which is a lack of proper understanding of the invariant of header&#x27;s emptyness. <a href="https://github.com/ClickHouse/ClickHouse/pull/30877" target="_blank" rel="noopener noreferrer">#30877</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed ambiguity when extracting auxiliary ZooKeeper name from ZooKeeper path in <code>ReplicatedMergeTree</code>. Previously server might fail to start with <code>Unknown auxiliary ZooKeeper name</code> if ZooKeeper path contains a colon. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29052" target="_blank" rel="noopener noreferrer">#29052</a>. Also it was allowed to specify ZooKeeper path that does not start with slash, but now it&#x27;s deprecated and creation of new tables with such path is not allowed. Slashes and colons in auxiliary ZooKeeper names are not allowed too. <a href="https://github.com/ClickHouse/ClickHouse/pull/30822" target="_blank" rel="noopener noreferrer">#30822</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Clean temporary directory when localBackup failed by some reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/30797" target="_blank" rel="noopener noreferrer">#30797</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Fixed a race condition between <code>REPLACE/MOVE PARTITION</code> and background merge in non-replicated <code>MergeTree</code> that might cause a part of moved/replaced data to remain in partition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29327" target="_blank" rel="noopener noreferrer">#29327</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30717" target="_blank" rel="noopener noreferrer">#30717</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix PREWHERE with WHERE in case of always true PREWHERE. <a href="https://github.com/ClickHouse/ClickHouse/pull/30668" target="_blank" rel="noopener noreferrer">#30668</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Limit push down optimization could cause a error <code>Cannot find column</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/30438" target="_blank" rel="noopener noreferrer">#30438</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30562" target="_blank" rel="noopener noreferrer">#30562</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Add missing parenthesis for <code>isNotNull</code>/<code>isNull</code> rewrites to <code>IS [NOT] NULL</code> (fixes queries that has something like <code>isNotNull(1)+isNotNull(2)</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/30520" target="_blank" rel="noopener noreferrer">#30520</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix deadlock on ALTER with scalar subquery to the same table, close <a href="https://github.com/ClickHouse/ClickHouse/issues/30461" target="_blank" rel="noopener noreferrer">#30461</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30492" target="_blank" rel="noopener noreferrer">#30492</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fixed segfault which might happen if session expired during execution of REPLACE PARTITION. <a href="https://github.com/ClickHouse/ClickHouse/pull/30432" target="_blank" rel="noopener noreferrer">#30432</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Queries with condition like <code>IN (subquery)</code> could return incorrect result in case if aggregate projection applied. Fixed creation of sets for projections. <a href="https://github.com/ClickHouse/ClickHouse/pull/30310" target="_blank" rel="noopener noreferrer">#30310</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix column alias resolution of JOIN queries when projection is enabled. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/30146" target="_blank" rel="noopener noreferrer">#30146</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30293" target="_blank" rel="noopener noreferrer">#30293</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix some deficiency in <code>replaceRegexpAll</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/30292" target="_blank" rel="noopener noreferrer">#30292</a> (<a href="https://github.com/Joeywzr" target="_blank" rel="noopener noreferrer">Memo</a>).</li><li>Fix ComplexKeyHashedDictionary, ComplexKeySparseHashedDictionary parsing <code>preallocate</code> option from layout config. <a href="https://github.com/ClickHouse/ClickHouse/pull/30246" target="_blank" rel="noopener noreferrer">#30246</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix <code>[I]LIKE</code> function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28661" target="_blank" rel="noopener noreferrer">#28661</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30244" target="_blank" rel="noopener noreferrer">#30244</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Fix crash with shortcircuit and lowcardinality in multiIf. <a href="https://github.com/ClickHouse/ClickHouse/pull/30243" target="_blank" rel="noopener noreferrer">#30243</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>FlatDictionary, HashedDictionary fix bytes_allocated calculation for nullable attributes. <a href="https://github.com/ClickHouse/ClickHouse/pull/30238" target="_blank" rel="noopener noreferrer">#30238</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Allow identifiers starting with numbers in multiple joins. <a href="https://github.com/ClickHouse/ClickHouse/pull/30230" target="_blank" rel="noopener noreferrer">#30230</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix reading from <code>MergeTree</code> with <code>max_read_buffer_size = 0</code> (when the user wants to shoot himself in the foot) (can lead to exceptions <code>Can&#x27;t adjust last granule</code>, <code>LOGICAL_ERROR</code>, or even data loss). <a href="https://github.com/ClickHouse/ClickHouse/pull/30192" target="_blank" rel="noopener noreferrer">#30192</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>pread_fake_async</code>/<code>pread_threadpool</code> with <code>min_bytes_to_use_direct_io</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30191" target="_blank" rel="noopener noreferrer">#30191</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix INSERT SELECT incorrectly fills MATERIALIZED column based of Nullable column. <a href="https://github.com/ClickHouse/ClickHouse/pull/30189" target="_blank" rel="noopener noreferrer">#30189</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Support nullable arguments in function <code>initializeAggregation</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30177" target="_blank" rel="noopener noreferrer">#30177</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix error <code>Port is already connected</code> for queries with <code>GLOBAL IN</code> and <code>WITH TOTALS</code>. Only for 21.9 and 21.10. <a href="https://github.com/ClickHouse/ClickHouse/pull/30086" target="_blank" rel="noopener noreferrer">#30086</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix race between MOVE PARTITION and merges/mutations for MergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/30074" target="_blank" rel="noopener noreferrer">#30074</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Dropped <code>Memory</code> database might reappear after server restart, it&#x27;s fixed (<a href="https://github.com/ClickHouse/ClickHouse/issues/29795" target="_blank" rel="noopener noreferrer">#29795</a>). Also added <code>force_remove_data_recursively_on_drop</code> setting as a workaround for <code>Directory not empty</code> error when dropping <code>Ordinary</code> database (because it&#x27;s not possible to remove data leftovers manually in cloud environment). <a href="https://github.com/ClickHouse/ClickHouse/pull/30054" target="_blank" rel="noopener noreferrer">#30054</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix crash of sample by <code>tuple()</code>, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/30004" target="_blank" rel="noopener noreferrer">#30004</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/30016" target="_blank" rel="noopener noreferrer">#30016</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>try to close issue: <a href="https://github.com/ClickHouse/ClickHouse/issues/29965" target="_blank" rel="noopener noreferrer">#29965</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29976" target="_blank" rel="noopener noreferrer">#29976</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix possible data-race between <code>FileChecker</code> and <code>StorageLog</code>/<code>StorageStripeLog</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29959" target="_blank" rel="noopener noreferrer">#29959</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix data-race between <code>LogSink::writeMarks()</code> and <code>LogSource</code> in <code>StorageLog</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29946" target="_blank" rel="noopener noreferrer">#29946</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix potential resource leak of the concurrent query limit of merge tree tables introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/19544" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/19544</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29879" target="_blank" rel="noopener noreferrer">#29879</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix system tables recreation check (fails to detect changes in enum values). <a href="https://github.com/ClickHouse/ClickHouse/pull/29857" target="_blank" rel="noopener noreferrer">#29857</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>MaterializedMySQL: Fix an issue where if the connection to MySQL was lost, only parts of a transaction could be processed. <a href="https://github.com/ClickHouse/ClickHouse/pull/29837" target="_blank" rel="noopener noreferrer">#29837</a> (<a href="https://github.com/havardk" target="_blank" rel="noopener noreferrer">Håvard Kvålen</a>).</li><li>Avoid <code>Timeout exceeded: elapsed 18446744073.709553 seconds</code> error that might happen in extremely rare cases, presumably due to some bug in kernel. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29154" target="_blank" rel="noopener noreferrer">#29154</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29811" target="_blank" rel="noopener noreferrer">#29811</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix bad cast in <code>ATTACH TABLE ... FROM &#x27;path&#x27;</code> query when non-string literal is used instead of path. It may lead to reading of uninitialized memory. <a href="https://github.com/ClickHouse/ClickHouse/pull/29790" target="_blank" rel="noopener noreferrer">#29790</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix concurrent access to <code>LowCardinality</code> during <code>GROUP BY</code> (in combination with <code>Buffer</code> tables it may lead to troubles). <a href="https://github.com/ClickHouse/ClickHouse/pull/29782" target="_blank" rel="noopener noreferrer">#29782</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix incorrect <code>GROUP BY</code> (multiple rows with the same keys in result) in case of distributed query when shards had mixed versions <code>&lt;= 21.3</code> and <code>&gt;= 21.4</code>, <code>GROUP BY</code> key had several columns all with fixed size, and two-level aggregation was activated (see <code>group_by_two_level_threshold</code> and <code>group_by_two_level_threshold_bytes</code>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29580" target="_blank" rel="noopener noreferrer">#29580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29735" target="_blank" rel="noopener noreferrer">#29735</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed incorrect behaviour of setting <code>materialized_postgresql_tables_list</code> at server restart. Found in <a href="https://github.com/ClickHouse/ClickHouse/issues/28529" target="_blank" rel="noopener noreferrer">#28529</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29686" target="_blank" rel="noopener noreferrer">#29686</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Condition in filter predicate could be lost after push-down optimisation. <a href="https://github.com/ClickHouse/ClickHouse/pull/29625" target="_blank" rel="noopener noreferrer">#29625</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix JIT expression compilation with aliases and short-circuit expression evaluation. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29403" target="_blank" rel="noopener noreferrer">#29403</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29574" target="_blank" rel="noopener noreferrer">#29574</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix rare segfault in <code>ALTER MODIFY</code> query when using incorrect table identifier in <code>DEFAULT</code> expression like <code>x.y.z...</code> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29184" target="_blank" rel="noopener noreferrer">#29184</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29573" target="_blank" rel="noopener noreferrer">#29573</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix nullptr deference for <code>GROUP BY WITH TOTALS HAVING</code> (when the column from <code>HAVING</code> wasn&#x27;t selected). <a href="https://github.com/ClickHouse/ClickHouse/pull/29553" target="_blank" rel="noopener noreferrer">#29553</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Avoid deadlocks when reading and writting on Join table engine tables at the same time. <a href="https://github.com/ClickHouse/ClickHouse/pull/29544" target="_blank" rel="noopener noreferrer">#29544</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fix bug in check <code>pathStartsWith</code> becuase there was bug with the usage of <code>std::mismatch</code>: <code> The behavior is undefined if the second range is shorter than the first range.</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29531" target="_blank" rel="noopener noreferrer">#29531</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>In ODBC bridge add retries for error Invalid cursor state. It is a retriable error. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29473" target="_blank" rel="noopener noreferrer">#29473</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29518" target="_blank" rel="noopener noreferrer">#29518</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fixed incorrect table name parsing on loading of <code>Lazy</code> database. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29456" target="_blank" rel="noopener noreferrer">#29456</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29476" target="_blank" rel="noopener noreferrer">#29476</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix possible <code>Block structure mismatch</code> for subqueries with pushed-down <code>HAVING</code> predicate. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29010" target="_blank" rel="noopener noreferrer">#29010</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29475" target="_blank" rel="noopener noreferrer">#29475</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix Logical error <code>Cannot capture columns</code> in functions greatest/least. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29334" target="_blank" rel="noopener noreferrer">#29334</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29454" target="_blank" rel="noopener noreferrer">#29454</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>RocksDB table engine: fix race condition during multiple DB opening (and get back some tests that triggers the problem on CI). <a href="https://github.com/ClickHouse/ClickHouse/pull/29393" target="_blank" rel="noopener noreferrer">#29393</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix replicated access storage not shutting down cleanly when misconfigured. <a href="https://github.com/ClickHouse/ClickHouse/pull/29388" target="_blank" rel="noopener noreferrer">#29388</a> (<a href="https://github.com/kmichel-aiven" target="_blank" rel="noopener noreferrer">Kevin Michel</a>).</li><li>Remove window function <code>nth_value</code> as it is not memory-safe. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/29347" target="_blank" rel="noopener noreferrer">#29347</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29348" target="_blank" rel="noopener noreferrer">#29348</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix vertical merges of projection parts. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/29253" target="_blank" rel="noopener noreferrer">#29253</a> . This PR also fixes several projection merge/mutation issues introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/25165" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/25165</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29337" target="_blank" rel="noopener noreferrer">#29337</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix hanging DDL queries on Replicated database while adding a new replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/29328" target="_blank" rel="noopener noreferrer">#29328</a> (<a href="https://github.com/kmichel-aiven" target="_blank" rel="noopener noreferrer">Kevin Michel</a>).</li><li>Fix connection timeouts (<code>send_timeout</code>/<code>receive_timeout</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/29282" target="_blank" rel="noopener noreferrer">#29282</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible <code>Table columns structure in ZooKeeper is different from local table structure</code> exception while recreating or creating new replicas of <code>ReplicatedMergeTree</code>, when one of table columns have default expressions with case-insensitive functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/29266" target="_blank" rel="noopener noreferrer">#29266</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Send normal <code>Database doesn&#x27;t exist error</code> (<code>UNKNOWN_DATABASE</code>) to the client (via TCP) instead of <code>Attempt to read after eof</code> (<code>ATTEMPT_TO_READ_AFTER_EOF</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/29229" target="_blank" rel="noopener noreferrer">#29229</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix segfault while inserting into column with type LowCardinality(Nullable) in Avro input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/29132" target="_blank" rel="noopener noreferrer">#29132</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Do not allow to reuse previous credentials in case of inter-server secret (Before INSERT via Buffer/Kafka to Distributed table with interserver secret configured for that cluster, may re-use previously set user for that connection). <a href="https://github.com/ClickHouse/ClickHouse/pull/29060" target="_blank" rel="noopener noreferrer">#29060</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Handle <code>any_join_distinct_right_table_keys</code> when join with dictionary, close <a href="https://github.com/ClickHouse/ClickHouse/issues/29007" target="_blank" rel="noopener noreferrer">#29007</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29014" target="_blank" rel="noopener noreferrer">#29014</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix &quot;Not found column ... in block&quot; error, when join on alias column, close <a href="https://github.com/ClickHouse/ClickHouse/issues/26980" target="_blank" rel="noopener noreferrer">#26980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/29008" target="_blank" rel="noopener noreferrer">#29008</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix the number of threads used in <code>GLOBAL IN</code> subquery (it was executed in single threads since <a href="https://github.com/ClickHouse/ClickHouse/issues/19414" target="_blank" rel="noopener noreferrer">#19414</a> bugfix). <a href="https://github.com/ClickHouse/ClickHouse/pull/28997" target="_blank" rel="noopener noreferrer">#28997</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bad optimizations of ORDER BY if it contains WITH FILL. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28908" target="_blank" rel="noopener noreferrer">#28908</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26049" target="_blank" rel="noopener noreferrer">#26049</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28910" target="_blank" rel="noopener noreferrer">#28910</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix higher-order array functions (<code>SIGSEGV</code> for <code>arrayCompact</code>/<code>ILLEGAL_COLUMN</code> for <code>arrayDifference</code>/<code>arrayCumSumNonNegative</code>) with consts. <a href="https://github.com/ClickHouse/ClickHouse/pull/28904" target="_blank" rel="noopener noreferrer">#28904</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix waiting for mutation with <code>mutations_sync=2</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28889" target="_blank" rel="noopener noreferrer">#28889</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix queries to external databases (i.e. MySQL) with multiple columns in IN ( i.e. <code>(k,v) IN ((1, 2))</code> ). <a href="https://github.com/ClickHouse/ClickHouse/pull/28888" target="_blank" rel="noopener noreferrer">#28888</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix bug with <code>LowCardinality</code> in short-curcuit function evaluation. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28884" target="_blank" rel="noopener noreferrer">#28884</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28887" target="_blank" rel="noopener noreferrer">#28887</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix reading of subcolumns from compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/28873" target="_blank" rel="noopener noreferrer">#28873</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed a race condition between <code>DROP PART</code> and <code>REPLACE/MOVE PARTITION</code> that might cause replicas to diverge in rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/28864" target="_blank" rel="noopener noreferrer">#28864</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix expressions compilation with short circuit evaluation. <a href="https://github.com/ClickHouse/ClickHouse/pull/28821" target="_blank" rel="noopener noreferrer">#28821</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix extremely rare case when ReplicatedMergeTree replicas can diverge after hard reboot of all replicas. The error looks like <code>Part ... intersects (previous|next) part ...</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28817" target="_blank" rel="noopener noreferrer">#28817</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Better check for connection usability and also catch any exception in <code>RabbitMQ</code> shutdown just in case. <a href="https://github.com/ClickHouse/ClickHouse/pull/28797" target="_blank" rel="noopener noreferrer">#28797</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix benign race condition in ReplicatedMergeTreeQueue. Shouldn&#x27;t be visible for user, but can lead to subtle bugs. <a href="https://github.com/ClickHouse/ClickHouse/pull/28734" target="_blank" rel="noopener noreferrer">#28734</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix possible crash for <code>SELECT</code> with partially created aggregate projection in case of exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/28700" target="_blank" rel="noopener noreferrer">#28700</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix the coredump in the creation of distributed tables, when the parameters passed in are wrong. <a href="https://github.com/ClickHouse/ClickHouse/pull/28686" target="_blank" rel="noopener noreferrer">#28686</a> (<a href="https://github.com/ljcui" target="_blank" rel="noopener noreferrer">Zhiyong Wang</a>).</li><li>Add Settings.Names, Settings.Values aliases for system.processes table. <a href="https://github.com/ClickHouse/ClickHouse/pull/28685" target="_blank" rel="noopener noreferrer">#28685</a> (<a href="https://github.com/orloffv" target="_blank" rel="noopener noreferrer">Vitaly</a>).</li><li>Support for S2 Geometry library: Fix the number of arguments required by <code>s2RectAdd</code> and <code>s2RectContains</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/28663" target="_blank" rel="noopener noreferrer">#28663</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix invalid constant type conversion when Nullable or LowCardinality primary key is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/28636" target="_blank" rel="noopener noreferrer">#28636</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix &quot;Column is not under aggregate function and not in GROUP BY&quot; with PREWHERE (Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/28461" target="_blank" rel="noopener noreferrer">#28461</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/28502" target="_blank" rel="noopener noreferrer">#28502</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2110-2021-10-16">ClickHouse release v21.10, 2021-10-16<a class="hash-link" href="#clickhouse-release-v2110-2021-10-16" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-2">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-2" title="Direct link to heading">​</a></h4><ul><li>Now the following MergeTree table-level settings: <code>replicated_max_parallel_sends</code>, <code>replicated_max_parallel_sends_for_table</code>, <code>replicated_max_parallel_fetches</code>, <code>replicated_max_parallel_fetches_for_table</code> do nothing. They never worked well and were replaced with <code>max_replicated_fetches_network_bandwidth</code>, <code>max_replicated_sends_network_bandwidth</code> and <code>background_fetches_pool_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28404" target="_blank" rel="noopener noreferrer">#28404</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-2">New Feature<a class="hash-link" href="#new-feature-2" title="Direct link to heading">​</a></h4><ul><li>Add feature for creating user-defined functions (UDF) as lambda expressions. Syntax <code>CREATE FUNCTION {function_name} as ({parameters}) -&gt; {function core}</code>. Example <code>CREATE FUNCTION plus_one as (a) -&gt; a + 1</code>. Authors @Realist007. <a href="https://github.com/ClickHouse/ClickHouse/pull/27796" target="_blank" rel="noopener noreferrer">#27796</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/23978" target="_blank" rel="noopener noreferrer">#23978</a> (<a href="https://github.com/Realist007" target="_blank" rel="noopener noreferrer">Realist007</a>).</li><li>Added <code>Executable</code> storage engine and <code>executable</code> table function. It enables data processing with external scripts in streaming fashion. <a href="https://github.com/ClickHouse/ClickHouse/pull/28102" target="_blank" rel="noopener noreferrer">#28102</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>) (<a href="https://github.com/ruct" target="_blank" rel="noopener noreferrer">ruct</a>).</li><li>Added <code>ExecutablePool</code> storage engine. Similar to <code>Executable</code> but it&#x27;s using a pool of long running processes. <a href="https://github.com/ClickHouse/ClickHouse/pull/28518" target="_blank" rel="noopener noreferrer">#28518</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add <code>ALTER TABLE ... MATERIALIZE COLUMN</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/27038" target="_blank" rel="noopener noreferrer">#27038</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Support for partitioned write into <code>s3</code> table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/23051" target="_blank" rel="noopener noreferrer">#23051</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Support <code>lz4</code> compression format (in addition to <code>gz</code>, <code>bz2</code>, <code>xz</code>, <code>zstd</code>) for data import / export. <a href="https://github.com/ClickHouse/ClickHouse/pull/25310" target="_blank" rel="noopener noreferrer">#25310</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Allow positional arguments under setting <code>enable_positional_arguments</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/2592" target="_blank" rel="noopener noreferrer">#2592</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27530" target="_blank" rel="noopener noreferrer">#27530</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Accept user settings related to file formats in <code>SETTINGS</code> clause in <code>CREATE</code> query for s3 tables. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27580" target="_blank" rel="noopener noreferrer">#27580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28037" target="_blank" rel="noopener noreferrer">#28037</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Allow SSL connection for <code>RabbitMQ</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/28365" target="_blank" rel="noopener noreferrer">#28365</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add <code>getServerPort</code> function to allow getting server port. When the port is not used by the server, throw an exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/27900" target="_blank" rel="noopener noreferrer">#27900</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add conversion functions between &quot;snowflake id&quot; and <code>DateTime</code>, <code>DateTime64</code>. See <a href="https://github.com/ClickHouse/ClickHouse/issues/27058" target="_blank" rel="noopener noreferrer">#27058</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27704" target="_blank" rel="noopener noreferrer">#27704</a> (<a href="https://github.com/jasine" target="_blank" rel="noopener noreferrer">jasine</a>).</li><li>Add function <code>SHA512</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27830" target="_blank" rel="noopener noreferrer">#27830</a> (<a href="https://github.com/zhanglistar" target="_blank" rel="noopener noreferrer">zhanglistar</a>).</li><li>Add <code>log_queries_probability</code> setting that allows user to write to query_log only a sample of queries. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16609" target="_blank" rel="noopener noreferrer">#16609</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27527" target="_blank" rel="noopener noreferrer">#27527</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-2">Experimental Feature<a class="hash-link" href="#experimental-feature-2" title="Direct link to heading">​</a></h4><ul><li><code>web</code> type of disks to store readonly tables on web server in form of static files. See <a href="https://github.com/ClickHouse/ClickHouse/issues/23982" target="_blank" rel="noopener noreferrer">#23982</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25251" target="_blank" rel="noopener noreferrer">#25251</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). This is mostly needed to faciliate testing of operation on shared storage and for easy importing of datasets. Not recommended to use before release 21.11.</li><li>Added new commands <code>BACKUP</code> and <code>RESTORE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21945" target="_blank" rel="noopener noreferrer">#21945</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>). This is under development and not intended to be used in current version.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-2">Performance Improvement<a class="hash-link" href="#performance-improvement-2" title="Direct link to heading">​</a></h4><ul><li>Speed up <code>sumIf</code> and <code>countIf</code> aggregation functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/28272" target="_blank" rel="noopener noreferrer">#28272</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Create virtual projection for <code>minmax</code> indices. Now, when <code>allow_experimental_projection_optimization</code> is enabled, queries will use minmax index instead of reading the data when possible. <a href="https://github.com/ClickHouse/ClickHouse/pull/26286" target="_blank" rel="noopener noreferrer">#26286</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Introducing two checks in <code>sequenceMatch</code> and <code>sequenceCount</code> that allow for early exit when some deterministic part of the sequence pattern is missing from the events list. This change unlocks many queries that would previously fail due to reaching operations cap, and generally speeds up the pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/27729" target="_blank" rel="noopener noreferrer">#27729</a> (<a href="https://github.com/jkuklis" target="_blank" rel="noopener noreferrer">Jakub Kuklis</a>).</li><li>Enhance primary key analysis with always monotonic information of binary functions, notably non-zero constant division. <a href="https://github.com/ClickHouse/ClickHouse/pull/28302" target="_blank" rel="noopener noreferrer">#28302</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Make <code>hasAll</code> filter condition leverage bloom filter data-skipping indexes. <a href="https://github.com/ClickHouse/ClickHouse/pull/27984" target="_blank" rel="noopener noreferrer">#27984</a> (<a href="https://github.com/BraulioVM" target="_blank" rel="noopener noreferrer">Braulio Valdivielso Martínez</a>).</li><li>Speed up data parts loading by delaying table startup process. <a href="https://github.com/ClickHouse/ClickHouse/pull/28313" target="_blank" rel="noopener noreferrer">#28313</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed possible excessive number of conditions moved from <code>WHERE</code> to <code>PREWHERE</code> (optimization controlled by settings <code>optimize_move_to_prewhere</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/28139" target="_blank" rel="noopener noreferrer">#28139</a> (<a href="https://github.com/lthaooo" target="_blank" rel="noopener noreferrer">lthaooo</a>).</li><li>Enable <code>optimize_distributed_group_by_sharding_key</code> by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/28105" target="_blank" rel="noopener noreferrer">#28105</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-2">Improvement<a class="hash-link" href="#improvement-2" title="Direct link to heading">​</a></h4><ul><li>Check cluster name before creating <code>Distributed</code> table, do not allow to create a table with incorrect cluster name. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/27832" target="_blank" rel="noopener noreferrer">#27832</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27927" target="_blank" rel="noopener noreferrer">#27927</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Add aggregate function <code>quantileBFloat16Weighted</code> similarly to other quantile...Weighted functions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27745" target="_blank" rel="noopener noreferrer">#27745</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27758" target="_blank" rel="noopener noreferrer">#27758</a> (<a href="https://github.com/RedClusive" target="_blank" rel="noopener noreferrer">Ivan Novitskiy</a>).</li><li>Allow to create dictionaries with empty attributes list. <a href="https://github.com/ClickHouse/ClickHouse/pull/27905" target="_blank" rel="noopener noreferrer">#27905</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add interactive documentation in <code>clickhouse-client</code> about how to reset the password. This is useful in scenario when user has installed ClickHouse, set up the password and instantly forget it. See <a href="https://github.com/ClickHouse/ClickHouse/issues/27750" target="_blank" rel="noopener noreferrer">#27750</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27903" target="_blank" rel="noopener noreferrer">#27903</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support the case when the data is enclosed in array in <code>JSONAsString</code> input format. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25517" target="_blank" rel="noopener noreferrer">#25517</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25633" target="_blank" rel="noopener noreferrer">#25633</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add new column <code>last_queue_update_exception</code> to <code>system.replicas</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/26843" target="_blank" rel="noopener noreferrer">#26843</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Support reconnections on failover for <code>MaterializedPostgreSQL</code> tables. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28529" target="_blank" rel="noopener noreferrer">#28529</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28614" target="_blank" rel="noopener noreferrer">#28614</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Generate a unique server UUID on first server start. <a href="https://github.com/ClickHouse/ClickHouse/pull/20089" target="_blank" rel="noopener noreferrer">#20089</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Introduce <code>connection_wait_timeout</code> (default to 5 seconds, 0 - do not wait) setting for <code>MySQL</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/28474" target="_blank" rel="noopener noreferrer">#28474</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Do not allow creating <code>MaterializedPostgreSQL</code> with bad arguments. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28423" target="_blank" rel="noopener noreferrer">#28423</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28430" target="_blank" rel="noopener noreferrer">#28430</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Use real tmp file instead of predefined &quot;rows_sources&quot; for vertical merges. This avoids generating garbage directories in tmp disks. <a href="https://github.com/ClickHouse/ClickHouse/pull/28299" target="_blank" rel="noopener noreferrer">#28299</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added <code>libhdfs3_conf</code> in server config instead of export env <code>LIBHDFS3_CONF</code> in clickhouse-server.service. This is for configuration of interaction with HDFS. <a href="https://github.com/ClickHouse/ClickHouse/pull/28268" target="_blank" rel="noopener noreferrer">#28268</a> (<a href="https://github.com/yuzhichang" target="_blank" rel="noopener noreferrer">Zhichang Yu</a>).</li><li>Fix removing of parts in a Temporary state which can lead to an unexpected exception (<code>Part %name% doesn&#x27;t exist</code>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23661" target="_blank" rel="noopener noreferrer">#23661</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28221" target="_blank" rel="noopener noreferrer">#28221</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/28221" target="_blank" rel="noopener noreferrer">#28221</a>) (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>zookeeper_log.address</code> (before the first patch in this PR the address was always <code>::</code>) and reduce number of calls <code>getpeername(2)</code> for this column (since each time entry for <code>zookeeper_log</code> is added <code>getpeername()</code> is called, cache this address in the zookeeper client to avoid this). <a href="https://github.com/ClickHouse/ClickHouse/pull/28212" target="_blank" rel="noopener noreferrer">#28212</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Support implicit conversions between index in operator <code>[]</code> and key of type <code>Map</code> (e.g. different <code>Int</code> types, <code>String</code> and <code>FixedString</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/28096" target="_blank" rel="noopener noreferrer">#28096</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Support <code>ON CONFLICT</code> clause when inserting into PostgreSQL table engine or table function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27727" target="_blank" rel="noopener noreferrer">#27727</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28081" target="_blank" rel="noopener noreferrer">#28081</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Lower restrictions for <code>Enum</code> data type to allow attaching compatible data. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26672" target="_blank" rel="noopener noreferrer">#26672</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28028" target="_blank" rel="noopener noreferrer">#28028</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Add a setting <code>empty_result_for_aggregation_by_constant_keys_on_empty_set</code> to control the behavior of grouping by constant keys on empty set. This is to bring back the old baviour of <a href="https://github.com/ClickHouse/ClickHouse/issues/6842" target="_blank" rel="noopener noreferrer">#6842</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27932" target="_blank" rel="noopener noreferrer">#27932</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added <code>replication_wait_for_inactive_replica_timeout</code> setting. It allows to specify how long to wait for inactive replicas to execute <code>ALTER</code>/<code>OPTIMZE</code>/<code>TRUNCATE</code> query (default is 120 seconds). If <code>replication_alter_partitions_sync</code> is 2 and some replicas are not active for more than <code>replication_wait_for_inactive_replica_timeout</code> seconds, then <code>UNFINISHED</code> will be thrown. <a href="https://github.com/ClickHouse/ClickHouse/pull/27931" target="_blank" rel="noopener noreferrer">#27931</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Support lambda argument for <code>APPLY</code> column transformer which allows applying functions with more than one argument. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/27877" target="_blank" rel="noopener noreferrer">#27877</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27901" target="_blank" rel="noopener noreferrer">#27901</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Enable <code>tcp_keep_alive_timeout</code> by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/27882" target="_blank" rel="noopener noreferrer">#27882</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improve remote query cancelation (in case of remote server abnormaly terminated). <a href="https://github.com/ClickHouse/ClickHouse/pull/27881" target="_blank" rel="noopener noreferrer">#27881</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Use Multipart copy upload for large S3 objects. <a href="https://github.com/ClickHouse/ClickHouse/pull/27858" target="_blank" rel="noopener noreferrer">#27858</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Allow symlink traversal for library dictionaty path. <a href="https://github.com/ClickHouse/ClickHouse/pull/27815" target="_blank" rel="noopener noreferrer">#27815</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Now <code>ALTER MODIFY COLUM</code> <code>T</code> to <code>Nullable(T)</code> doesn&#x27;t require mutation. <a href="https://github.com/ClickHouse/ClickHouse/pull/27787" target="_blank" rel="noopener noreferrer">#27787</a> (<a href="https://github.com/kafka1991" target="_blank" rel="noopener noreferrer">victorgao</a>).</li><li>Don&#x27;t silently ignore errors and don&#x27;t count delays in <code>ReadBufferFromS3</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27484" target="_blank" rel="noopener noreferrer">#27484</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Improve <code>ALTER ... MATERIALIZE TTL</code> by recalculating metadata only without actual TTL action. <a href="https://github.com/ClickHouse/ClickHouse/pull/27019" target="_blank" rel="noopener noreferrer">#27019</a> (<a href="https://github.com/lthaooo" target="_blank" rel="noopener noreferrer">lthaooo</a>).</li><li>Allow reading the list of custom top level domains without a new line at EOF. <a href="https://github.com/ClickHouse/ClickHouse/pull/28213" target="_blank" rel="noopener noreferrer">#28213</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-1">Bug Fix<a class="hash-link" href="#bug-fix-1" title="Direct link to heading">​</a></h4><ul><li>Fix cases, when reading compressed data from <code>carbon-clickhouse</code> fails with &#x27;attempt to read after end of file&#x27;. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26149" target="_blank" rel="noopener noreferrer">#26149</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28150" target="_blank" rel="noopener noreferrer">#28150</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">FArthur-cmd</a>).</li><li>Fix checking access grants when executing <code>GRANT WITH REPLACE</code> statement with <code>ON CLUSTER</code> clause. This PR improves fix <a href="https://github.com/ClickHouse/ClickHouse/pull/27701" target="_blank" rel="noopener noreferrer">#27001</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27983" target="_blank" rel="noopener noreferrer">#27983</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Allow selecting with <code>extremes = 1</code> from a column of the type <code>LowCardinality(UUID)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27918" target="_blank" rel="noopener noreferrer">#27918</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix PostgreSQL-style cast (<code>::</code> operator) with negative numbers. <a href="https://github.com/ClickHouse/ClickHouse/pull/27876" target="_blank" rel="noopener noreferrer">#27876</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>After <a href="https://github.com/ClickHouse/ClickHouse/pull/26864" target="_blank" rel="noopener noreferrer">#26864</a>. Fix shutdown of <code>NamedSessionStorage</code>: session contexts stored in <code>NamedSessionStorage</code> are now destroyed before destroying the global context. <a href="https://github.com/ClickHouse/ClickHouse/pull/27875" target="_blank" rel="noopener noreferrer">#27875</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Bugfix for <code>windowFunnel</code> &quot;strict&quot; mode. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/27469" target="_blank" rel="noopener noreferrer">#27469</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27563" target="_blank" rel="noopener noreferrer">#27563</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>).</li><li>Fix infinite loop while reading truncated <code>bzip2</code> archive. <a href="https://github.com/ClickHouse/ClickHouse/pull/28543" target="_blank" rel="noopener noreferrer">#28543</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix UUID overlap in <code>DROP TABLE</code> for internal DDL from <code>MaterializedMySQL</code>. MaterializedMySQL is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/28533" target="_blank" rel="noopener noreferrer">#28533</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>There is no subcolumn</code> error, while select from tables, which have <code>Nested</code> columns and scalar columns with dot in name and the same prefix as <code>Nested</code> (e.g. <code>n.id UInt32, n.arr1 Array(UInt64), n.arr2 Array(UInt64)</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/28531" target="_blank" rel="noopener noreferrer">#28531</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix bug which can lead to error <code>Existing table metadata in ZooKeeper differs in sorting key expression.</code> after ALTER of <code>ReplicatedVersionedCollapsingMergeTree</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/28515" target="_blank" rel="noopener noreferrer">#28515</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28528" target="_blank" rel="noopener noreferrer">#28528</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed possible ZooKeeper watches leak (minor issue) on background processing of distributed DDL queue. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26036" target="_blank" rel="noopener noreferrer">#26036</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28446" target="_blank" rel="noopener noreferrer">#28446</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix missing quoting of table names in <code>MaterializedPostgreSQL</code> engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/28316" target="_blank" rel="noopener noreferrer">#28316</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28433" target="_blank" rel="noopener noreferrer">#28433</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix the wrong behaviour of non joined rows from nullable column. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/27691" target="_blank" rel="noopener noreferrer">#27691</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28349" target="_blank" rel="noopener noreferrer">#28349</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Fix NOT-IN index optimization when not all key columns are used. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/28120" target="_blank" rel="noopener noreferrer">#28120</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28315" target="_blank" rel="noopener noreferrer">#28315</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix intersecting parts due to new part had been replaced with an empty part. <a href="https://github.com/ClickHouse/ClickHouse/pull/28310" target="_blank" rel="noopener noreferrer">#28310</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix inconsistent result in queries with <code>ORDER BY</code> and <code>Merge</code> tables with enabled setting <code>optimize_read_in_order</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28266" target="_blank" rel="noopener noreferrer">#28266</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible read of uninitialized memory for queries with <code>Nullable(LowCardinality)</code> type and the setting <code>extremes</code> set to 1. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/28165" target="_blank" rel="noopener noreferrer">#28165</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28205" target="_blank" rel="noopener noreferrer">#28205</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Multiple small fixes for projections. See detailed description in the PR. <a href="https://github.com/ClickHouse/ClickHouse/pull/28178" target="_blank" rel="noopener noreferrer">#28178</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix extremely rare segfaults on shutdown due to incorrect order of context/config reloader shutdown. <a href="https://github.com/ClickHouse/ClickHouse/pull/28088" target="_blank" rel="noopener noreferrer">#28088</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Fix handling null value with type of <code>Nullable(String)</code> in function <code>JSONExtract</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/27929" target="_blank" rel="noopener noreferrer">#27929</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/27930" target="_blank" rel="noopener noreferrer">#27930</a>. This was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/25452" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/25452</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/27939" target="_blank" rel="noopener noreferrer">#27939</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Multiple fixes for the new <code>clickhouse-keeper</code> tool. Fix a rare bug in <code>clickhouse-keeper</code> when the client can receive a watch response before request-response. <a href="https://github.com/ClickHouse/ClickHouse/pull/28197" target="_blank" rel="noopener noreferrer">#28197</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>). Fix incorrect behavior in <code>clickhouse-keeper</code> when list watches (<code>getChildren</code>) triggered with <code>set</code> requests for children. <a href="https://github.com/ClickHouse/ClickHouse/pull/28190" target="_blank" rel="noopener noreferrer">#28190</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>). Fix rare case when changes of <code>clickhouse-keeper</code> settings may lead to lost logs and server hung. <a href="https://github.com/ClickHouse/ClickHouse/pull/28360" target="_blank" rel="noopener noreferrer">#28360</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>). Fix bug in <code>clickhouse-keeper</code> which can lead to endless logs when <code>rotate_logs_interval</code> decreased. <a href="https://github.com/ClickHouse/ClickHouse/pull/28152" target="_blank" rel="noopener noreferrer">#28152</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-2">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-2" title="Direct link to heading">​</a></h4><ul><li>Enable Thread Fuzzer in Stress Test. Thread Fuzzer is ClickHouse feature that allows to test more permutations of thread scheduling and discover more potential issues. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9813" target="_blank" rel="noopener noreferrer">#9813</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9814" target="_blank" rel="noopener noreferrer">#9814</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9515" target="_blank" rel="noopener noreferrer">#9515</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9516" target="_blank" rel="noopener noreferrer">#9516</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27538" target="_blank" rel="noopener noreferrer">#27538</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add new log level <code>test</code> for testing environments. It is even more verbose than the default <code>trace</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/28559" target="_blank" rel="noopener noreferrer">#28559</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Print out git status information at CMake configure stage. <a href="https://github.com/ClickHouse/ClickHouse/pull/28047" target="_blank" rel="noopener noreferrer">#28047</a> (<a href="https://github.com/BraulioVM" target="_blank" rel="noopener noreferrer">Braulio Valdivielso Martínez</a>).</li><li>Temporarily switched ubuntu apt repository to mirror ru.archive.ubuntu.com as the default one (archive.ubuntu.com) is not responding from our CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/28016" target="_blank" rel="noopener noreferrer">#28016</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v219-2021-09-09">ClickHouse release v21.9, 2021-09-09<a class="hash-link" href="#clickhouse-release-v219-2021-09-09" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-3">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-3" title="Direct link to heading">​</a></h4><ul><li>Do not output trailing zeros in text representation of <code>Decimal</code> types. Example: <code>1.23</code> will be printed instead of <code>1.230000</code> for decimal with scale 6. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15794" target="_blank" rel="noopener noreferrer">#15794</a>. It may introduce slight incompatibility if your applications somehow relied on the trailing zeros. Serialization in output formats can be controlled with the setting <code>output_format_decimal_trailing_zeros</code>. Implementation of <code>toString</code> and casting to String is changed unconditionally. <a href="https://github.com/ClickHouse/ClickHouse/pull/27680" target="_blank" rel="noopener noreferrer">#27680</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Do not allow to apply parametric aggregate function with <code>-Merge</code> combinator to aggregate function state if state was produced by aggregate function with different parameters. For example, state of <code>fooState(42)(x)</code> cannot be finalized with <code>fooMerge(s)</code> or <code>fooMerge(123)(s)</code>, parameters must be specified explicitly like <code>fooMerge(42)(s)</code> and must be equal. It does not affect some special aggregate functions like <code>quantile</code> and <code>sequence*</code> that use parameters for finalization only. <a href="https://github.com/ClickHouse/ClickHouse/pull/26847" target="_blank" rel="noopener noreferrer">#26847</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Under clickhouse-local, always treat local addresses with a port as remote. <a href="https://github.com/ClickHouse/ClickHouse/pull/26736" target="_blank" rel="noopener noreferrer">#26736</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fix the issue that in case of some sophisticated query with column aliases identical to the names of expressions, bad cast may happen. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25447" target="_blank" rel="noopener noreferrer">#25447</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/26914" target="_blank" rel="noopener noreferrer">#26914</a>. This fix may introduce backward incompatibility: if there are different expressions with identical names, exception will be thrown. It may break some rare cases when <code>enable_optimize_predicate_expression</code> is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/26639" target="_blank" rel="noopener noreferrer">#26639</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now, scalar subquery always returns <code>Nullable</code> result if it&#x27;s type can be <code>Nullable</code>. It is needed because in case of empty subquery it&#x27;s result should be <code>Null</code>. Previously, it was possible to get error about incompatible types (type deduction does not execute scalar subquery, and it could use not-nullable type). Scalar subquery with empty result which can&#x27;t be converted to <code>Nullable</code> (like <code>Array</code> or <code>Tuple</code>) now throws error. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25411" target="_blank" rel="noopener noreferrer">#25411</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26423" target="_blank" rel="noopener noreferrer">#26423</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Introduce syntax for here documents. Example <code>SELECT $doc$ VALUE $doc$</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26671" target="_blank" rel="noopener noreferrer">#26671</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>). This change is backward incompatible if in query there are identifiers that contain <code>$</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/28768" target="_blank" rel="noopener noreferrer">#28768</a>.</li><li>Now indices can handle Nullable types, including <code>isNull</code> and <code>isNotNull</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12433" target="_blank" rel="noopener noreferrer">#12433</a> and <a href="https://github.com/ClickHouse/ClickHouse/pull/12455" target="_blank" rel="noopener noreferrer">#12455</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>) and <a href="https://github.com/ClickHouse/ClickHouse/pull/27250" target="_blank" rel="noopener noreferrer">#27250</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>). But this was done with on-disk format changes, and even though new server can read old data, old server cannot. Also, in case you have <code>MINMAX</code> data skipping indices, you may get <code>Data after mutation/merge is not byte-identical</code> error, since new index will have <code>.idx2</code> extension while before it was <code>.idx</code>. That said, that you should not delay updating all existing replicas, in this case, otherwise, if old replica (&lt;21.9) will download data from new replica with 21.9+ it will not be able to apply index for downloaded part.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-3">New Feature<a class="hash-link" href="#new-feature-3" title="Direct link to heading">​</a></h4><ul><li>Implementation of short circuit function evaluation, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12587" target="_blank" rel="noopener noreferrer">#12587</a>. Add settings <code>short_circuit_function_evaluation</code> to configure short circuit function evaluation. <a href="https://github.com/ClickHouse/ClickHouse/pull/23367" target="_blank" rel="noopener noreferrer">#23367</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add support for INTERSECT, EXCEPT, ANY, ALL operators. <a href="https://github.com/ClickHouse/ClickHouse/pull/24757" target="_blank" rel="noopener noreferrer">#24757</a> (<a href="https://github.com/zdikov" target="_blank" rel="noopener noreferrer">Kirill Ershov</a>). (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add support for encryption at the virtual file system level (data encryption at rest) using AES-CTR algorithm. <a href="https://github.com/ClickHouse/ClickHouse/pull/24206" target="_blank" rel="noopener noreferrer">#24206</a> (<a href="https://github.com/alexelex" target="_blank" rel="noopener noreferrer">Latysheva Alexandra</a>). (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/26733" target="_blank" rel="noopener noreferrer">#26733</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/26377" target="_blank" rel="noopener noreferrer">#26377</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/26465" target="_blank" rel="noopener noreferrer">#26465</a>.</li><li>Added natural language processing (NLP) functions for tokenization, stemming, lemmatizing and search in synonyms extensions. <a href="https://github.com/ClickHouse/ClickHouse/pull/24997" target="_blank" rel="noopener noreferrer">#24997</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Added integration with S2 geometry library. <a href="https://github.com/ClickHouse/ClickHouse/pull/24980" target="_blank" rel="noopener noreferrer">#24980</a> (<a href="https://github.com/Andr0901" target="_blank" rel="noopener noreferrer">Andr0901</a>). (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Add SQLite table engine, table function, database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/24194" target="_blank" rel="noopener noreferrer">#24194</a> (<a href="https://github.com/g-arslan" target="_blank" rel="noopener noreferrer">Arslan Gumerov</a>). (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Added support for custom query for <code>MySQL</code>, <code>PostgreSQL</code>, <code>ClickHouse</code>, <code>JDBC</code>, <code>Cassandra</code> dictionary source. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/1270" target="_blank" rel="noopener noreferrer">#1270</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26995" target="_blank" rel="noopener noreferrer">#26995</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add shared (replicated) storage of user, roles, row policies, quotas and settings profiles through ZooKeeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/27426" target="_blank" rel="noopener noreferrer">#27426</a> (<a href="https://github.com/kmichel-aiven" target="_blank" rel="noopener noreferrer">Kevin Michel</a>).</li><li>Add compression for <code>INTO OUTFILE</code> that automatically choose compression algorithm. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3473" target="_blank" rel="noopener noreferrer">#3473</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27134" target="_blank" rel="noopener noreferrer">#27134</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Add <code>INSERT ... FROM INFILE</code> similarly to <code>SELECT ... INTO OUTFILE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27655" target="_blank" rel="noopener noreferrer">#27655</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Added <code>complex_key_range_hashed</code> dictionary. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22029" target="_blank" rel="noopener noreferrer">#22029</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27629" target="_blank" rel="noopener noreferrer">#27629</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Support expressions in JOIN ON section. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/21868" target="_blank" rel="noopener noreferrer">#21868</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24420" target="_blank" rel="noopener noreferrer">#24420</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>When client connects to server, it receives information about all warnings that are already were collected by server. (It can be disabled by using option <code>--no-warnings</code>). Add <code>system.warnings</code> table to collect warnings about server configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/26246" target="_blank" rel="noopener noreferrer">#26246</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/26282" target="_blank" rel="noopener noreferrer">#26282</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Allow using constant expressions from with and select in aggregate function parameters. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/10945" target="_blank" rel="noopener noreferrer">#10945</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27531" target="_blank" rel="noopener noreferrer">#27531</a> (<a href="https://github.com/abel-cheng" target="_blank" rel="noopener noreferrer">abel-cheng</a>).</li><li>Add <code>tupleToNameValuePairs</code>, a function that turns a named tuple into an array of pairs. <a href="https://github.com/ClickHouse/ClickHouse/pull/27505" target="_blank" rel="noopener noreferrer">#27505</a> (<a href="https://github.com/BraulioVM" target="_blank" rel="noopener noreferrer">Braulio Valdivielso Martínez</a>).</li><li>Add support for <code>bzip2</code> compression method for import/export. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22428" target="_blank" rel="noopener noreferrer">#22428</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27377" target="_blank" rel="noopener noreferrer">#27377</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Added <code>bitmapSubsetOffsetLimit(bitmap, offset, cardinality_limit)</code> function. It creates a subset of bitmap limit the results to <code>cardinality_limit</code> with offset of <code>offset</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27234" target="_blank" rel="noopener noreferrer">#27234</a> (<a href="https://github.com/DHBin" target="_blank" rel="noopener noreferrer">DHBin</a>).</li><li>Add column <code>default_database</code> to <code>system.users</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27054" target="_blank" rel="noopener noreferrer">#27054</a> (<a href="https://github.com/MaxWk" target="_blank" rel="noopener noreferrer">kevin wan</a>).</li><li>Supported <code>cluster</code> macros inside table functions &#x27;cluster&#x27; and &#x27;clusterAllReplicas&#x27;. <a href="https://github.com/ClickHouse/ClickHouse/pull/26913" target="_blank" rel="noopener noreferrer">#26913</a> (<a href="https://github.com/PolyProgrammist" target="_blank" rel="noopener noreferrer">polyprogrammist</a>).</li><li>Add new functions <code>currentRoles()</code>, <code>enabledRoles()</code>, <code>defaultRoles()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26780" target="_blank" rel="noopener noreferrer">#26780</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>New functions <code>currentProfiles()</code>, <code>enabledProfiles()</code>, <code>defaultProfiles()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26714" target="_blank" rel="noopener noreferrer">#26714</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Add functions that return (initial_)query_id of the current query. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23682" target="_blank" rel="noopener noreferrer">#23682</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26410" target="_blank" rel="noopener noreferrer">#26410</a> (<a href="https://github.com/mathalex" target="_blank" rel="noopener noreferrer">Alexey Boykov</a>).</li><li>Add <code>REPLACE GRANT</code> feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/26384" target="_blank" rel="noopener noreferrer">#26384</a> (<a href="https://github.com/Cas-pian" target="_blank" rel="noopener noreferrer">Caspian</a>).</li><li><code>EXPLAIN</code> query now has <code>EXPLAIN ESTIMATE ...</code> mode that will show information about read rows, marks and parts from MergeTree tables. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23941" target="_blank" rel="noopener noreferrer">#23941</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26131" target="_blank" rel="noopener noreferrer">#26131</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Added <code>system.zookeeper_log</code> table. All actions of ZooKeeper client are logged into this table. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/25449" target="_blank" rel="noopener noreferrer">#25449</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26129" target="_blank" rel="noopener noreferrer">#26129</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Zero-copy replication for <code>ReplicatedMergeTree</code> over <code>HDFS</code> storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/25918" target="_blank" rel="noopener noreferrer">#25918</a> (<a href="https://github.com/yuzhichang" target="_blank" rel="noopener noreferrer">Zhichang Yu</a>).</li><li>Allow to insert Nested type as array of structs in <code>Arrow</code>, <code>ORC</code> and <code>Parquet</code> input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/25902" target="_blank" rel="noopener noreferrer">#25902</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add a new datatype <code>Date32</code> (store data as Int32), support date range same with <code>DateTime64</code> support load parquet date32 to ClickHouse <code>Date32</code> Add new function <code>toDate32</code> like <code>toDate</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25774" target="_blank" rel="noopener noreferrer">#25774</a> (<a href="https://github.com/liuneng1994" target="_blank" rel="noopener noreferrer">LiuNeng</a>).</li><li>Allow setting default database for users. <a href="https://github.com/ClickHouse/ClickHouse/issues/25268" target="_blank" rel="noopener noreferrer">#25268</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25687" target="_blank" rel="noopener noreferrer">#25687</a> (<a href="https://github.com/MaxWk" target="_blank" rel="noopener noreferrer">kevin wan</a>).</li><li>Add an optional parameter to <code>MongoDB</code> engine to accept connection string options and support SSL connection. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21189" target="_blank" rel="noopener noreferrer">#21189</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21041" target="_blank" rel="noopener noreferrer">#21041</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22045" target="_blank" rel="noopener noreferrer">#22045</a> (<a href="https://github.com/OmarBazaraa" target="_blank" rel="noopener noreferrer">Omar Bazaraa</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-3">Experimental Feature<a class="hash-link" href="#experimental-feature-3" title="Direct link to heading">​</a></h4><ul><li>Added a compression codec <code>AES_128_GCM_SIV</code> which encrypts columns instead of compressing them. <a href="https://github.com/ClickHouse/ClickHouse/pull/19896" target="_blank" rel="noopener noreferrer">#19896</a> (<a href="https://github.com/depressed-pho" target="_blank" rel="noopener noreferrer">PHO</a>). Will be rewritten, do not use.</li><li>Rename <code>MaterializeMySQL</code> to <code>MaterializedMySQL</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26822" target="_blank" rel="noopener noreferrer">#26822</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-3">Performance Improvement<a class="hash-link" href="#performance-improvement-3" title="Direct link to heading">​</a></h4><ul><li>Improve the performance of fast queries when <code>max_execution_time = 0</code> by reducing the number of <code>clock_gettime</code> system calls. <a href="https://github.com/ClickHouse/ClickHouse/pull/27325" target="_blank" rel="noopener noreferrer">#27325</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Specialize date time related comparison to achieve better performance. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/27083" target="_blank" rel="noopener noreferrer">#27083</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/27122" target="_blank" rel="noopener noreferrer">#27122</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Share file descriptors in concurrent reads of the same files. There is no noticeable performance difference on Linux. But the number of opened files will be significantly (10..100 times) lower on typical servers and it makes operations easier. See <a href="https://github.com/ClickHouse/ClickHouse/issues/26214" target="_blank" rel="noopener noreferrer">#26214</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26768" target="_blank" rel="noopener noreferrer">#26768</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve latency of short queries, that require reading from tables with large number of columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/26371" target="_blank" rel="noopener noreferrer">#26371</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Don&#x27;t build sets for indices when analyzing a query. <a href="https://github.com/ClickHouse/ClickHouse/pull/26365" target="_blank" rel="noopener noreferrer">#26365</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Vectorize the SUM of Nullable integer types with native representation (<a href="https://github.com/davidmanzanares" target="_blank" rel="noopener noreferrer">David Manzanares</a>, <a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/26248" target="_blank" rel="noopener noreferrer">#26248</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Compile expressions involving columns with <code>Enum</code> types. <a href="https://github.com/ClickHouse/ClickHouse/pull/26237" target="_blank" rel="noopener noreferrer">#26237</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Compile aggregate functions <code>groupBitOr</code>, <code>groupBitAnd</code>, <code>groupBitXor</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26161" target="_blank" rel="noopener noreferrer">#26161</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improved memory usage with better block size prediction when reading empty DEFAULT columns. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17317" target="_blank" rel="noopener noreferrer">#17317</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25917" target="_blank" rel="noopener noreferrer">#25917</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Reduce memory usage and number of read rows in queries with <code>ORDER BY primary_key</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25721" target="_blank" rel="noopener noreferrer">#25721</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Enable <code>distributed_push_down_limit</code> by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/27104" target="_blank" rel="noopener noreferrer">#27104</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Make <code>toTimeZone</code> monotonicity when timeZone is a constant value to support partition puring when use sql like:. <a href="https://github.com/ClickHouse/ClickHouse/pull/26261" target="_blank" rel="noopener noreferrer">#26261</a> (<a href="https://github.com/SaintBacchus" target="_blank" rel="noopener noreferrer">huangzhaowei</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-3">Improvement<a class="hash-link" href="#improvement-3" title="Direct link to heading">​</a></h4><ul><li>Mark window functions as ready for general use. Remove the <code>allow_experimental_window_functions</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/27184" target="_blank" rel="noopener noreferrer">#27184</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Improve compatibility with non-whole-minute timezone offsets. <a href="https://github.com/ClickHouse/ClickHouse/pull/27080" target="_blank" rel="noopener noreferrer">#27080</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>If file descriptor in <code>File</code> table is regular file - allow to read multiple times from it. It allows <code>clickhouse-local</code> to read multiple times from stdin (with multiple SELECT queries or subqueries) if stdin is a regular file like <code>clickhouse-local --query &quot;SELECT * FROM table UNION ALL SELECT * FROM table&quot; ... &lt; file</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11124" target="_blank" rel="noopener noreferrer">#11124</a>. Co-authored with (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/25960" target="_blank" rel="noopener noreferrer">#25960</a> (<a href="https://github.com/BoloniniD" target="_blank" rel="noopener noreferrer">BoloniniD</a>).</li><li>Remove duplicate index analysis and avoid possible invalid limit checks during projection analysis. <a href="https://github.com/ClickHouse/ClickHouse/pull/27742" target="_blank" rel="noopener noreferrer">#27742</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Enable query parameters to be passed in the body of HTTP requests. <a href="https://github.com/ClickHouse/ClickHouse/pull/27706" target="_blank" rel="noopener noreferrer">#27706</a> (<a href="https://github.com/hllustosa" target="_blank" rel="noopener noreferrer">Hermano Lustosa</a>).</li><li>Disallow <code>arrayJoin</code> on partition expressions. <a href="https://github.com/ClickHouse/ClickHouse/pull/27648" target="_blank" rel="noopener noreferrer">#27648</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Log client IP address if authentication fails. <a href="https://github.com/ClickHouse/ClickHouse/pull/27514" target="_blank" rel="noopener noreferrer">#27514</a> (<a href="https://github.com/imiskolee" target="_blank" rel="noopener noreferrer">Misko Lee</a>).</li><li>Use bytes instead of strings for binary data in the GRPC protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/27431" target="_blank" rel="noopener noreferrer">#27431</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Send response with error message if HTTP port is not set and user tries to send HTTP request to TCP port. <a href="https://github.com/ClickHouse/ClickHouse/pull/27385" target="_blank" rel="noopener noreferrer">#27385</a> (<a href="https://github.com/BraulioVM" target="_blank" rel="noopener noreferrer">Braulio Valdivielso Martínez</a>).</li><li>Add <code>_CAST</code> function for internal usage, which will not preserve type nullability, but non-internal cast will preserve according to setting <code>cast_keep_nullable</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12636" target="_blank" rel="noopener noreferrer">#12636</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27382" target="_blank" rel="noopener noreferrer">#27382</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add setting <code>log_formatted_queries</code> to log additional formatted query into <code>system.query_log</code>. It&#x27;s useful for normalized query analysis because functions like <code>normalizeQuery</code> and <code>normalizeQueryKeepNames</code> don&#x27;t parse/format queries in order to achieve better performance. <a href="https://github.com/ClickHouse/ClickHouse/pull/27380" target="_blank" rel="noopener noreferrer">#27380</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add two settings <code>max_hyperscan_regexp_length</code> and <code>max_hyperscan_regexp_total_length</code> to prevent huge regexp being used in hyperscan related functions, such as <code>multiMatchAny</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27378" target="_blank" rel="noopener noreferrer">#27378</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Memory consumed by bitmap aggregate functions now is taken into account for memory limits. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26555" target="_blank" rel="noopener noreferrer">#26555</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27252" target="_blank" rel="noopener noreferrer">#27252</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add 10 seconds cache for S3 proxy resolver. <a href="https://github.com/ClickHouse/ClickHouse/pull/27216" target="_blank" rel="noopener noreferrer">#27216</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Split global mutex into individual regexp construction. This helps avoid huge regexp construction blocking other related threads. <a href="https://github.com/ClickHouse/ClickHouse/pull/27211" target="_blank" rel="noopener noreferrer">#27211</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support schema for PostgreSQL database engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27166" target="_blank" rel="noopener noreferrer">#27166</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27198" target="_blank" rel="noopener noreferrer">#27198</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Track memory usage in clickhouse-client. <a href="https://github.com/ClickHouse/ClickHouse/pull/27191" target="_blank" rel="noopener noreferrer">#27191</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">Filatenkov Artur</a>).</li><li>Try recording <code>query_kind</code> in <code>system.query_log</code> even when query fails to start. <a href="https://github.com/ClickHouse/ClickHouse/pull/27182" target="_blank" rel="noopener noreferrer">#27182</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added columns <code>replica_is_active</code> that maps replica name to is replica active status to table <code>system.replicas</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27138" target="_blank" rel="noopener noreferrer">#27138</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27180" target="_blank" rel="noopener noreferrer">#27180</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Allow to pass query settings via server URI in Web UI. <a href="https://github.com/ClickHouse/ClickHouse/pull/27177" target="_blank" rel="noopener noreferrer">#27177</a> (<a href="https://github.com/kolsys" target="_blank" rel="noopener noreferrer">kolsys</a>).</li><li>Add a new metric called <code>MaxPushedDDLEntryID</code> which is the maximum ddl entry id that current node push to zookeeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/27174" target="_blank" rel="noopener noreferrer">#27174</a> (<a href="https://github.com/fuwhu" target="_blank" rel="noopener noreferrer">Fuwang Hu</a>).</li><li>Improved the existence condition judgment and empty string node judgment when <code>clickhouse-keeper</code> creates znode. <a href="https://github.com/ClickHouse/ClickHouse/pull/27125" target="_blank" rel="noopener noreferrer">#27125</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Merge JOIN correctly handles empty set in the right. <a href="https://github.com/ClickHouse/ClickHouse/pull/27078" target="_blank" rel="noopener noreferrer">#27078</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Now functions can be shard-level constants, which means if it&#x27;s executed in the context of some distributed table, it generates a normal column, otherwise it produces a constant value. Notable functions are: <code>hostName()</code>, <code>tcpPort()</code>, <code>version()</code>, <code>buildId()</code>, <code>uptime()</code>, etc. <a href="https://github.com/ClickHouse/ClickHouse/pull/27020" target="_blank" rel="noopener noreferrer">#27020</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Updated <code>extractAllGroupsHorizontal</code> - upper limit on the number of matches per row can be set via optional third argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/26961" target="_blank" rel="noopener noreferrer">#26961</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Expose <code>RocksDB</code> statistics via system.rocksdb table. Read rocksdb options from ClickHouse config (<code>rocksdb...</code> keys). NOTE: ClickHouse does not rely on RocksDB, it is just one of the additional integration storage engines. <a href="https://github.com/ClickHouse/ClickHouse/pull/26821" target="_blank" rel="noopener noreferrer">#26821</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Less verbose internal RocksDB logs. NOTE: ClickHouse does not rely on RocksDB, it is just one of the additional integration storage engines. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26252" target="_blank" rel="noopener noreferrer">#26252</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26789" target="_blank" rel="noopener noreferrer">#26789</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Changing default roles affects new sessions only. <a href="https://github.com/ClickHouse/ClickHouse/pull/26759" target="_blank" rel="noopener noreferrer">#26759</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Watchdog is disabled in docker by default. Fix for not handling ctrl+c. <a href="https://github.com/ClickHouse/ClickHouse/pull/26757" target="_blank" rel="noopener noreferrer">#26757</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li><code>SET PROFILE</code> now applies constraints too if they&#x27;re set for a passed profile. <a href="https://github.com/ClickHouse/ClickHouse/pull/26730" target="_blank" rel="noopener noreferrer">#26730</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Improve handling of <code>KILL QUERY</code> requests. <a href="https://github.com/ClickHouse/ClickHouse/pull/26675" target="_blank" rel="noopener noreferrer">#26675</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li><code>mapPopulatesSeries</code> function supports <code>Map</code> type. <a href="https://github.com/ClickHouse/ClickHouse/pull/26663" target="_blank" rel="noopener noreferrer">#26663</a> (<a href="https://github.com/ildus" target="_blank" rel="noopener noreferrer">Ildus Kurbangaliev</a>).</li><li>Fix excessive (x2) connect attempts with <code>skip_unavailable_shards</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26658" target="_blank" rel="noopener noreferrer">#26658</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Avoid hanging <code>clickhouse-benchmark</code> if connection fails (i.e. on EMFILE). <a href="https://github.com/ClickHouse/ClickHouse/pull/26656" target="_blank" rel="noopener noreferrer">#26656</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow more threads to be used by the Kafka engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/26642" target="_blank" rel="noopener noreferrer">#26642</a> (<a href="https://github.com/feihengye" target="_blank" rel="noopener noreferrer">feihengye</a>).</li><li>Add round-robin support for <code>clickhouse-benchmark</code> (it does not differ from the regular multi host/port run except for statistics report). <a href="https://github.com/ClickHouse/ClickHouse/pull/26607" target="_blank" rel="noopener noreferrer">#26607</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Executable dictionaries (<code>executable</code>, <code>executable_pool</code>) enable creation with DDL query using <code>clickhouse-local</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22355" target="_blank" rel="noopener noreferrer">#22355</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26510" target="_blank" rel="noopener noreferrer">#26510</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Set client query kind for <code>mysql</code> and <code>postgresql</code> compatibility protocol handlers. <a href="https://github.com/ClickHouse/ClickHouse/pull/26498" target="_blank" rel="noopener noreferrer">#26498</a> (<a href="https://github.com/anneji-dev" target="_blank" rel="noopener noreferrer">anneji-dev</a>).</li><li>Apply <code>LIMIT</code> on the shards for queries like <code>SELECT * FROM dist ORDER BY key LIMIT 10</code> w/ <code>distributed_push_down_limit=1</code>. Avoid running <code>Distinct</code>/<code>LIMIT BY</code> steps for queries like <code>SELECT DISTINCT shading_key FROM dist ORDER BY key</code>. Now <code>distributed_push_down_limit</code> is respected by <code>optimize_distributed_group_by_sharding_key</code> optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/26466" target="_blank" rel="noopener noreferrer">#26466</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Updated protobuf to 3.17.3. Changelogs are available on <a href="https://github.com/protocolbuffers/protobuf/releases" target="_blank" rel="noopener noreferrer">https://github.com/protocolbuffers/protobuf/releases</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26424" target="_blank" rel="noopener noreferrer">#26424</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Enable <code>use_hedged_requests</code> setting that allows to mitigate tail latencies on large clusters. <a href="https://github.com/ClickHouse/ClickHouse/pull/26380" target="_blank" rel="noopener noreferrer">#26380</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve behaviour with non-existing host in user allowed host list. <a href="https://github.com/ClickHouse/ClickHouse/pull/26368" target="_blank" rel="noopener noreferrer">#26368</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Add ability to set <code>Distributed</code> directory monitor settings via CREATE TABLE (i.e. <code>CREATE TABLE dist (key Int) Engine=Distributed(cluster, db, table) SETTINGS monitor_batch_inserts=1</code> and similar). <a href="https://github.com/ClickHouse/ClickHouse/pull/26336" target="_blank" rel="noopener noreferrer">#26336</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Save server address in history URLs in web UI if it differs from the origin of web UI. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26044" target="_blank" rel="noopener noreferrer">#26044</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26322" target="_blank" rel="noopener noreferrer">#26322</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add events to profile calls to <code>sleep</code> / <code>sleepEachRow</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26320" target="_blank" rel="noopener noreferrer">#26320</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Allow to reuse connections of shards among different clusters. It also avoids creating new connections when using <code>cluster</code> table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/26318" target="_blank" rel="noopener noreferrer">#26318</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Control the execution period of clear old temporary directories by parameter with default value. <a href="https://github.com/ClickHouse/ClickHouse/issues/26212" target="_blank" rel="noopener noreferrer">#26212</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26313" target="_blank" rel="noopener noreferrer">#26313</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Add a setting <code>function_range_max_elements_in_block</code> to tune the safety threshold for data volume generated by function <code>range</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26303" target="_blank" rel="noopener noreferrer">#26303</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26305" target="_blank" rel="noopener noreferrer">#26305</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Check hash function at table creation, not at sampling. Add settings for MergeTree, if someone create a table with incorrect sampling column but sampling never be used, disable this settings for starting the server without exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/26256" target="_blank" rel="noopener noreferrer">#26256</a> (<a href="https://github.com/zxc111" target="_blank" rel="noopener noreferrer">zhaoyu</a>).</li><li>Added <code>output_format_avro_string_column_pattern</code> setting to put specified String columns to Avro as string instead of default bytes. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/22414" target="_blank" rel="noopener noreferrer">#22414</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26245" target="_blank" rel="noopener noreferrer">#26245</a> (<a href="https://github.com/ilejn" target="_blank" rel="noopener noreferrer">Ilya Golshtein</a>).</li><li>Add information about column sizes in <code>system.columns</code> table for <code>Log</code> and <code>TinyLog</code> tables. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9001" target="_blank" rel="noopener noreferrer">#9001</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26241" target="_blank" rel="noopener noreferrer">#26241</a> (<a href="https://github.com/evillique" target="_blank" rel="noopener noreferrer">Nikolay Degterinsky</a>).</li><li>Don&#x27;t throw exception when querying <code>system.detached_parts</code> table if there is custom disk configuration and <code>detached</code> directory does not exist on some disks. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26078" target="_blank" rel="noopener noreferrer">#26078</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26236" target="_blank" rel="noopener noreferrer">#26236</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Check for non-deterministic functions in keys, including constant expressions like <code>now()</code>, <code>today()</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25875" target="_blank" rel="noopener noreferrer">#25875</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11333" target="_blank" rel="noopener noreferrer">#11333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26235" target="_blank" rel="noopener noreferrer">#26235</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>convert timestamp and timestamptz data types to <code>DateTime64</code> in PostgreSQL table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/26234" target="_blank" rel="noopener noreferrer">#26234</a> (<a href="https://github.com/jasine" target="_blank" rel="noopener noreferrer">jasine</a>).</li><li>Apply aggressive IN index analysis for projections so that better projection candidate can be selected. <a href="https://github.com/ClickHouse/ClickHouse/pull/26218" target="_blank" rel="noopener noreferrer">#26218</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Remove GLOBAL keyword for IN when scalar function is passed. In previous versions, if user specified <code>GLOBAL IN f(x)</code> exception was thrown. <a href="https://github.com/ClickHouse/ClickHouse/pull/26217" target="_blank" rel="noopener noreferrer">#26217</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add error id (like <code>BAD_ARGUMENTS</code>) to exception messages. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25862" target="_blank" rel="noopener noreferrer">#25862</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26172" target="_blank" rel="noopener noreferrer">#26172</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix incorrect output with --progress option for clickhouse-local. Progress bar will be cleared once it gets to 100% - same as it is done for clickhouse-client. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17484" target="_blank" rel="noopener noreferrer">#17484</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26128" target="_blank" rel="noopener noreferrer">#26128</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add <code>merge_selecting_sleep_ms</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/26120" target="_blank" rel="noopener noreferrer">#26120</a> (<a href="https://github.com/lthaooo" target="_blank" rel="noopener noreferrer">lthaooo</a>).</li><li>Remove complicated usage of Linux AIO with one block readahead and replace it with plain simple synchronous IO with O_DIRECT. In previous versions, the setting <code>min_bytes_to_use_direct_io</code> may not work correctly if <code>max_threads</code> is greater than one. Reading with direct IO (that is disabled by default for queries and enabled by default for large merges) will work in less efficient way. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25997" target="_blank" rel="noopener noreferrer">#25997</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26003" target="_blank" rel="noopener noreferrer">#26003</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Flush <code>Distributed</code> table on <code>REPLACE TABLE</code> query. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/24566" target="_blank" rel="noopener noreferrer">#24566</a> - Do not replace (or create) table on <code>[CREATE OR] REPLACE TABLE ... AS SELECT</code> query if insertion into new table fails. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/23175" target="_blank" rel="noopener noreferrer">#23175</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25895" target="_blank" rel="noopener noreferrer">#25895</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Add <code>views</code> column to system.query_log containing the names of the (materialized or live) views executed by the query. Adds a new log table (<code>system.query_views_log</code>) that contains information about each view executed during a query. Modifies view execution: When an exception is thrown while executing a view, any view that has already startedwill continue running until it finishes. This used to be the behaviour under parallel_view_processing=true and now it&#x27;s always the same behaviour. - Dependent views now report reading progress to the context. <a href="https://github.com/ClickHouse/ClickHouse/pull/25714" target="_blank" rel="noopener noreferrer">#25714</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Do connection draining asynchonously upon finishing executing distributed queries. A new server setting is added <code>max_threads_for_connection_collector</code> which specifies the number of workers to recycle connections in background. If the pool is full, connection will be drained synchronously but a bit different than before: It&#x27;s drained after we send EOS to client, query will succeed immediately after receiving enough data, and any exception will be logged instead of throwing to the client. Added setting <code>drain_timeout</code> (3 seconds by default). Connection draining will disconnect upon timeout. <a href="https://github.com/ClickHouse/ClickHouse/pull/25674" target="_blank" rel="noopener noreferrer">#25674</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support for multiple includes in configuration. It is possible to include users configuration, remote servers configuration from multiple sources. Simply place <code>&lt;include /&gt;</code> element with <code>from_zk</code>, <code>from_env</code> or <code>incl</code> attribute and it will be replaced with the substitution. <a href="https://github.com/ClickHouse/ClickHouse/pull/24404" target="_blank" rel="noopener noreferrer">#24404</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Fix multiple block insertion into distributed table with <code>insert_distributed_one_random_shard = 1</code>. This is a marginal feature. Mark as improvement. <a href="https://github.com/ClickHouse/ClickHouse/pull/23140" target="_blank" rel="noopener noreferrer">#23140</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support <code>LowCardinality</code> and <code>FixedString</code> keys/values for <code>Map</code> type. <a href="https://github.com/ClickHouse/ClickHouse/pull/21543" target="_blank" rel="noopener noreferrer">#21543</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Enable reloading of local disk config. <a href="https://github.com/ClickHouse/ClickHouse/pull/19526" target="_blank" rel="noopener noreferrer">#19526</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-2">Bug Fix<a class="hash-link" href="#bug-fix-2" title="Direct link to heading">​</a></h4><ul><li>Fix a couple of bugs that may cause replicas to diverge. <a href="https://github.com/ClickHouse/ClickHouse/pull/27808" target="_blank" rel="noopener noreferrer">#27808</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix a rare bug in <code>DROP PART</code> which can lead to the error <code>Unexpected merged part intersects drop range</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27807" target="_blank" rel="noopener noreferrer">#27807</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Prevent crashes for some formats when NULL (tombstone) message was coming from Kafka. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19255" target="_blank" rel="noopener noreferrer">#19255</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27794" target="_blank" rel="noopener noreferrer">#27794</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix column filtering with union distinct in subquery. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27578" target="_blank" rel="noopener noreferrer">#27578</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27689" target="_blank" rel="noopener noreferrer">#27689</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix bad type cast when functions like <code>arrayHas</code> are applied to arrays of LowCardinality of Nullable of different non-numeric types like <code>DateTime</code> and <code>DateTime64</code>. In previous versions bad cast occurs. In new version it will lead to exception. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26330" target="_blank" rel="noopener noreferrer">#26330</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27682" target="_blank" rel="noopener noreferrer">#27682</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix postgresql table function resulting in non-closing connections. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26088" target="_blank" rel="noopener noreferrer">#26088</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27662" target="_blank" rel="noopener noreferrer">#27662</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fixed another case of <code>Unexpected merged part ... intersecting drop range ...</code> error. <a href="https://github.com/ClickHouse/ClickHouse/pull/27656" target="_blank" rel="noopener noreferrer">#27656</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix an error with aliased column in <code>Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/27652" target="_blank" rel="noopener noreferrer">#27652</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>After setting <code>max_memory_usage*</code> to non-zero value it was not possible to reset it back to 0 (unlimited). It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/27638" target="_blank" rel="noopener noreferrer">#27638</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed underflow of the time value when constructing it from components. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27193" target="_blank" rel="noopener noreferrer">#27193</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27605" target="_blank" rel="noopener noreferrer">#27605</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fix crash during projection materialization when some parts contain missing columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/27512" target="_blank" rel="noopener noreferrer">#27512</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27528" target="_blank" rel="noopener noreferrer">#27528</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>fix metric <code>BackgroundMessageBrokerSchedulePoolTask</code>, maybe mistyped. <a href="https://github.com/ClickHouse/ClickHouse/pull/27452" target="_blank" rel="noopener noreferrer">#27452</a> (<a href="https://github.com/benbiti" target="_blank" rel="noopener noreferrer">Ben</a>).</li><li>Fix distributed queries with zero shards and aggregation. <a href="https://github.com/ClickHouse/ClickHouse/pull/27427" target="_blank" rel="noopener noreferrer">#27427</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Compatibility when <code>/proc/meminfo</code> does not contain KB suffix. <a href="https://github.com/ClickHouse/ClickHouse/pull/27361" target="_blank" rel="noopener noreferrer">#27361</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike Kot</a>).</li><li>Fix incorrect result for query with row-level security, PREWHERE and LowCardinality filter. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/27179" target="_blank" rel="noopener noreferrer">#27179</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27329" target="_blank" rel="noopener noreferrer">#27329</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed incorrect validation of partition id for MergeTree tables that created with old syntax. <a href="https://github.com/ClickHouse/ClickHouse/pull/27328" target="_blank" rel="noopener noreferrer">#27328</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix MySQL protocol when using parallel formats (CSV / TSV). <a href="https://github.com/ClickHouse/ClickHouse/pull/27326" target="_blank" rel="noopener noreferrer">#27326</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fix <code>Cannot find column</code> error for queries with sampling. Was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/24574" target="_blank" rel="noopener noreferrer">#24574</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/26522" target="_blank" rel="noopener noreferrer">#26522</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27301" target="_blank" rel="noopener noreferrer">#27301</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix errors like <code>Expected ColumnLowCardinality, gotUInt8</code> or <code>Bad cast from type DB::ColumnVector&lt;char8_t&gt; to DB::ColumnLowCardinality</code> for some queries with <code>LowCardinality</code> in <code>PREWHERE</code>. And more importantly, fix the lack of whitespace in the error message. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23515" target="_blank" rel="noopener noreferrer">#23515</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27298" target="_blank" rel="noopener noreferrer">#27298</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix <code>distributed_group_by_no_merge = 2</code> with <code>distributed_push_down_limit = 1</code> or <code>optimize_distributed_group_by_sharding_key = 1</code> with <code>LIMIT BY</code> and <code>LIMIT OFFSET</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27249" target="_blank" rel="noopener noreferrer">#27249</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>). These are obscure combination of settings that no one is using.</li><li>Fix mutation stuck on invalid partitions in non-replicated MergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/27248" target="_blank" rel="noopener noreferrer">#27248</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>In case of ambiguity, lambda functions prefer its arguments to other aliases or identifiers. <a href="https://github.com/ClickHouse/ClickHouse/pull/27235" target="_blank" rel="noopener noreferrer">#27235</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fix column structure in merge join, close <a href="https://github.com/ClickHouse/ClickHouse/issues/27091" target="_blank" rel="noopener noreferrer">#27091</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27217" target="_blank" rel="noopener noreferrer">#27217</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>In rare cases <code>system.detached_parts</code> table might contain incorrect information for some parts, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/27114" target="_blank" rel="noopener noreferrer">#27114</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27183" target="_blank" rel="noopener noreferrer">#27183</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix uninitialized memory in functions <code>multiSearch*</code> with empty array, close <a href="https://github.com/ClickHouse/ClickHouse/issues/27169" target="_blank" rel="noopener noreferrer">#27169</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27181" target="_blank" rel="noopener noreferrer">#27181</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix synchronization in GRPCServer. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/27024" target="_blank" rel="noopener noreferrer">#27024</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27064" target="_blank" rel="noopener noreferrer">#27064</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed <code>cache</code>, <code>complex_key_cache</code>, <code>ssd_cache</code>, <code>complex_key_ssd_cache</code> configuration parsing. Options <code>allow_read_expired_keys</code>, <code>max_update_queue_size</code>, <code>update_queue_push_timeout_milliseconds</code>, <code>query_wait_timeout_milliseconds</code> were not parsed for dictionaries with non <code>cache</code> type. <a href="https://github.com/ClickHouse/ClickHouse/pull/27032" target="_blank" rel="noopener noreferrer">#27032</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix possible mutation stack due to race with DROP_RANGE. <a href="https://github.com/ClickHouse/ClickHouse/pull/27002" target="_blank" rel="noopener noreferrer">#27002</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Now partition ID in queries like <code>ALTER TABLE ... PARTITION ID xxx</code> validates for correctness. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25718" target="_blank" rel="noopener noreferrer">#25718</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26963" target="_blank" rel="noopener noreferrer">#26963</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix &quot;Unknown column name&quot; error with multiple JOINs in some cases, close <a href="https://github.com/ClickHouse/ClickHouse/issues/26899" target="_blank" rel="noopener noreferrer">#26899</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26957" target="_blank" rel="noopener noreferrer">#26957</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix reading of custom TLDs (stops processing with lower buffer or bigger file). <a href="https://github.com/ClickHouse/ClickHouse/pull/26948" target="_blank" rel="noopener noreferrer">#26948</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix error <code>Missing columns: &#x27;xxx&#x27;</code> when <code>DEFAULT</code> column references other non materialized column without <code>DEFAULT</code> expression. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/26591" target="_blank" rel="noopener noreferrer">#26591</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26900" target="_blank" rel="noopener noreferrer">#26900</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix loading of dictionary keys in <code>library-bridge</code> for <code>library</code> dictionary source. <a href="https://github.com/ClickHouse/ClickHouse/pull/26834" target="_blank" rel="noopener noreferrer">#26834</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Aggregate function parameters might be lost when applying some combinators causing exceptions like <code>Conversion from AggregateFunction(topKArray, Array(String)) to AggregateFunction(topKArray(10), Array(String)) is not supported</code>. It&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/26196" target="_blank" rel="noopener noreferrer">#26196</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/26433" target="_blank" rel="noopener noreferrer">#26433</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26814" target="_blank" rel="noopener noreferrer">#26814</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Add <code>event_time_microseconds</code> value for <code>REMOVE_PART</code> in <code>system.part_log</code>. In previous versions is was not set. <a href="https://github.com/ClickHouse/ClickHouse/pull/26720" target="_blank" rel="noopener noreferrer">#26720</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Do not remove data on ReplicatedMergeTree table shutdown to avoid creating data to metadata inconsistency. <a href="https://github.com/ClickHouse/ClickHouse/pull/26716" target="_blank" rel="noopener noreferrer">#26716</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Sometimes <code>SET ROLE</code> could work incorrectly, this PR fixes that. <a href="https://github.com/ClickHouse/ClickHouse/pull/26707" target="_blank" rel="noopener noreferrer">#26707</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Some fixes for parallel formatting (<a href="https://github.com/ClickHouse/ClickHouse/issues/26694" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/issues/26694</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/26703" target="_blank" rel="noopener noreferrer">#26703</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Fix potential nullptr dereference in window functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25276" target="_blank" rel="noopener noreferrer">#25276</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26668" target="_blank" rel="noopener noreferrer">#26668</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fix clickhouse-client history file conversion (when upgrading from the format of 3 years old version of clickhouse-client) if file is empty. <a href="https://github.com/ClickHouse/ClickHouse/pull/26589" target="_blank" rel="noopener noreferrer">#26589</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix incorrect function names of groupBitmapAnd/Or/Xor (can be displayed in some occasions). This fixes. <a href="https://github.com/ClickHouse/ClickHouse/pull/26557" target="_blank" rel="noopener noreferrer">#26557</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Update <code>chown</code> cmd check in clickhouse-server docker entrypoint. It fixes the bug that cluster pod restart failed (or timeout) on kubernetes. <a href="https://github.com/ClickHouse/ClickHouse/pull/26545" target="_blank" rel="noopener noreferrer">#26545</a> (<a href="https://github.com/Kylinrix" target="_blank" rel="noopener noreferrer">Ky Li</a>).</li><li>Fix crash in <code>RabbitMQ</code> shutdown in case <code>RabbitMQ</code> setup was not started. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26504" target="_blank" rel="noopener noreferrer">#26504</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26529" target="_blank" rel="noopener noreferrer">#26529</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix issues with <code>CREATE DICTIONARY</code> query if dictionary name or database name was quoted. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26491" target="_blank" rel="noopener noreferrer">#26491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26508" target="_blank" rel="noopener noreferrer">#26508</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix broken column name resolution after rewriting column aliases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/26432" target="_blank" rel="noopener noreferrer">#26432</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26475" target="_blank" rel="noopener noreferrer">#26475</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix some fuzzed msan crash. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22517" target="_blank" rel="noopener noreferrer">#22517</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26428" target="_blank" rel="noopener noreferrer">#26428</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix infinite non joined block stream in <code>partial_merge_join</code> close <a href="https://github.com/ClickHouse/ClickHouse/issues/26325" target="_blank" rel="noopener noreferrer">#26325</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26374" target="_blank" rel="noopener noreferrer">#26374</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix possible crash when login as dropped user. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/26073" target="_blank" rel="noopener noreferrer">#26073</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26363" target="_blank" rel="noopener noreferrer">#26363</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix <code>optimize_distributed_group_by_sharding_key</code> for multiple columns (leads to incorrect result w/ <code>optimize_skip_unused_shards=1</code>/<code>allow_nondeterministic_optimize_skip_unused_shards=1</code> and multiple columns in sharding key expression). <a href="https://github.com/ClickHouse/ClickHouse/pull/26353" target="_blank" rel="noopener noreferrer">#26353</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed rare bug in lost replica recovery that may cause replicas to diverge. <a href="https://github.com/ClickHouse/ClickHouse/pull/26321" target="_blank" rel="noopener noreferrer">#26321</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix zstd decompression (for import/export in zstd framing format that is unrelated to tables data) in case there are escape sequences at the end of internal buffer. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26013" target="_blank" rel="noopener noreferrer">#26013</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26314" target="_blank" rel="noopener noreferrer">#26314</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix logical error on join with totals, close <a href="https://github.com/ClickHouse/ClickHouse/issues/26017" target="_blank" rel="noopener noreferrer">#26017</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26250" target="_blank" rel="noopener noreferrer">#26250</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Remove excessive newline in <code>thread_name</code> column in <code>system.stack_trace</code> table. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24124" target="_blank" rel="noopener noreferrer">#24124</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26210" target="_blank" rel="noopener noreferrer">#26210</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potential crash if more than one <code>untuple</code> expression is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/26179" target="_blank" rel="noopener noreferrer">#26179</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Don&#x27;t throw exception in <code>toString</code> for Nullable Enum if Enum does not have a value for zero, close <a href="https://github.com/ClickHouse/ClickHouse/issues/25806" target="_blank" rel="noopener noreferrer">#25806</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26123" target="_blank" rel="noopener noreferrer">#26123</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fixed incorrect <code>sequence_id</code> in MySQL protocol packets that ClickHouse sends on exception during query execution. It might cause MySQL client to reset connection to ClickHouse server. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21184" target="_blank" rel="noopener noreferrer">#21184</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26051" target="_blank" rel="noopener noreferrer">#26051</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix for the case that <code>cutToFirstSignificantSubdomainCustom()</code>/<code>cutToFirstSignificantSubdomainCustomWithWWW()</code>/<code>firstSignificantSubdomainCustom()</code> returns incorrect type for consts, and hence <code>optimize_skip_unused_shards</code> does not work:. <a href="https://github.com/ClickHouse/ClickHouse/pull/26041" target="_blank" rel="noopener noreferrer">#26041</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible mismatched header when using normal projection with prewhere. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/26020" target="_blank" rel="noopener noreferrer">#26020</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26038" target="_blank" rel="noopener noreferrer">#26038</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix sharding_key from column w/o function for remote() (before <code>select * from remote(&#x27;127.1&#x27;, system.one, dummy)</code> leads to <code>Unknown column: dummy, there are only columns .</code> error). <a href="https://github.com/ClickHouse/ClickHouse/pull/25824" target="_blank" rel="noopener noreferrer">#25824</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <code>Not found column ...</code> and <code>Missing column ...</code> errors when selecting from <code>MaterializeMySQL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23708" target="_blank" rel="noopener noreferrer">#23708</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/24830" target="_blank" rel="noopener noreferrer">#24830</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/25794" target="_blank" rel="noopener noreferrer">#25794</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25822" target="_blank" rel="noopener noreferrer">#25822</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix <code>optimize_skip_unused_shards_rewrite_in</code> for non-UInt64 types (may select incorrect shards eventually or throw <code>Cannot infer type of an empty tuple</code> or <code>Function tuple requires at least one argument</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/25798" target="_blank" rel="noopener noreferrer">#25798</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-3">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-3" title="Direct link to heading">​</a></h4><ul><li>Now we ran stateful and stateless tests in random timezones. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12439" target="_blank" rel="noopener noreferrer">#12439</a>. Reading String as DateTime and writing DateTime as String in Protobuf format now respect timezone. Reading UInt16 as DateTime in Arrow and Parquet formats now treat it as Date and then converts to DateTime with respect to DateTime&#x27;s timezone, because Date is serialized in Arrow and Parquet as UInt16. GraphiteMergeTree now respect time zone for rounding of times. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5098" target="_blank" rel="noopener noreferrer">#5098</a>. Author: @alexey-milovidov. <a href="https://github.com/ClickHouse/ClickHouse/pull/15408" target="_blank" rel="noopener noreferrer">#15408</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li><code>clickhouse-test</code> supports SQL tests with <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/#synopsis" target="_blank" rel="noopener noreferrer">Jinja2</a> templates. <a href="https://github.com/ClickHouse/ClickHouse/pull/26579" target="_blank" rel="noopener noreferrer">#26579</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Add support for build with <code>clang-13</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/27705" target="_blank" rel="noopener noreferrer">#27705</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27714" target="_blank" rel="noopener noreferrer">#27714</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/27777" target="_blank" rel="noopener noreferrer">#27777</a> (<a href="https://github.com/syominsergey" target="_blank" rel="noopener noreferrer">Sergei Semin</a>)</li><li>Add CMake options to build with or without specific CPU instruction set. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/17469" target="_blank" rel="noopener noreferrer">#17469</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/27509" target="_blank" rel="noopener noreferrer">#27509</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/27508" target="_blank" rel="noopener noreferrer">#27508</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix linking of auxiliar programs when using dynamic libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/26958" target="_blank" rel="noopener noreferrer">#26958</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>Update RocksDB to <code>2021-07-16</code> master. <a href="https://github.com/ClickHouse/ClickHouse/pull/26411" target="_blank" rel="noopener noreferrer">#26411</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v218-2021-08-12">ClickHouse release v21.8, 2021-08-12<a class="hash-link" href="#clickhouse-release-v218-2021-08-12" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="upgrade-notes">Upgrade Notes<a class="hash-link" href="#upgrade-notes" title="Direct link to heading">​</a></h4><ul><li>New version is using <code>Map</code> data type for system logs tables (<code>system.query_log</code>, <code>system.query_thread_log</code>, <code>system.processes</code>, <code>system.opentelemetry_span_log</code>). These tables will be auto-created with new data types. Virtual columns are created to support old queries. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18698" target="_blank" rel="noopener noreferrer">#18698</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23934" target="_blank" rel="noopener noreferrer">#23934</a>, <a href="https://github.com/ClickHouse/ClickHouse/pull/25773" target="_blank" rel="noopener noreferrer">#25773</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>, <a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundy-li</a>, <a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>). If you want to <em>downgrade</em> from version 21.8 to older versions, you will need to cleanup system tables with logs manually. Look at <code>/var/lib/clickhouse/data/system/*_log</code>.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-features">New Features<a class="hash-link" href="#new-features" title="Direct link to heading">​</a></h4><ul><li>Add support for a part of SQL/JSON standard. <a href="https://github.com/ClickHouse/ClickHouse/pull/24148" target="_blank" rel="noopener noreferrer">#24148</a> (<a href="https://github.com/l1tsolaiki" target="_blank" rel="noopener noreferrer">l1tsolaiki</a>, <a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Collect common system metrics (in <code>system.asynchronous_metrics</code> and <code>system.asynchronous_metric_log</code>) on CPU usage, disk usage, memory usage, IO, network, files, load average, CPU frequencies, thermal sensors, EDAC counters, system uptime; also added metrics about the scheduling jitter and the time spent collecting the metrics. It works similar to <code>atop</code> in ClickHouse and allows access to monitoring data even if you have no additional tools installed. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/9430" target="_blank" rel="noopener noreferrer">#9430</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24416" target="_blank" rel="noopener noreferrer">#24416</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>, <a href="https://github.com/elevankoff" target="_blank" rel="noopener noreferrer">Yegor Levankov</a>).</li><li>Add MaterializedPostgreSQL table engine and database engine. This database engine allows replicating a whole database or any subset of database tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/20470" target="_blank" rel="noopener noreferrer">#20470</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add new functions <code>leftPad()</code>, <code>rightPad()</code>, <code>leftPadUTF8()</code>, <code>rightPadUTF8()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26075" target="_blank" rel="noopener noreferrer">#26075</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Add the <code>FIRST</code> keyword to the <code>ADD INDEX</code> command to be able to add the index at the beginning of the indices list. <a href="https://github.com/ClickHouse/ClickHouse/pull/25904" target="_blank" rel="noopener noreferrer">#25904</a> (<a href="https://github.com/xjewer" target="_blank" rel="noopener noreferrer">xjewer</a>).</li><li>Introduce <code>system.data_skipping_indices</code> table containing information about existing data skipping indices. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/7659" target="_blank" rel="noopener noreferrer">#7659</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25693" target="_blank" rel="noopener noreferrer">#25693</a> (<a href="https://github.com/novikd" target="_blank" rel="noopener noreferrer">Dmitry Novik</a>).</li><li>Add <code>bin</code>/<code>unbin</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/25609" target="_blank" rel="noopener noreferrer">#25609</a> (<a href="https://github.com/zxc111" target="_blank" rel="noopener noreferrer">zhaoyu</a>).</li><li>Support <code>Map</code> and <code>UInt128</code>, <code>Int128</code>, <code>UInt256</code>, <code>Int256</code> types in <code>mapAdd</code> and <code>mapSubtract</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/25596" target="_blank" rel="noopener noreferrer">#25596</a> (<a href="https://github.com/ildus" target="_blank" rel="noopener noreferrer">Ildus Kurbangaliev</a>).</li><li>Support <code>DISTINCT ON (columns)</code> expression, close <a href="https://github.com/ClickHouse/ClickHouse/issues/25404" target="_blank" rel="noopener noreferrer">#25404</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25589" target="_blank" rel="noopener noreferrer">#25589</a> (<a href="https://github.com/TszKitLo40" target="_blank" rel="noopener noreferrer">Zijie Lu</a>).</li><li>Add an ability to reset a custom setting to default and remove it from the table&#x27;s metadata. It allows rolling back the change without knowing the system/config&#x27;s default.  Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14449" target="_blank" rel="noopener noreferrer">#14449</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17769" target="_blank" rel="noopener noreferrer">#17769</a> (<a href="https://github.com/xjewer" target="_blank" rel="noopener noreferrer">xjewer</a>).</li><li>Render pipelines as graphs in Web UI if <code>EXPLAIN PIPELINE graph = 1</code> query is submitted. <a href="https://github.com/ClickHouse/ClickHouse/pull/26067" target="_blank" rel="noopener noreferrer">#26067</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvements">Performance Improvements<a class="hash-link" href="#performance-improvements" title="Direct link to heading">​</a></h4><ul><li>Compile aggregate functions. Use option <code>compile_aggregate_expressions</code> to enable it. <a href="https://github.com/ClickHouse/ClickHouse/pull/24789" target="_blank" rel="noopener noreferrer">#24789</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Improve latency of short queries that require reading from tables with many columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/26371" target="_blank" rel="noopener noreferrer">#26371</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvements">Improvements<a class="hash-link" href="#improvements" title="Direct link to heading">​</a></h4><ul><li>Use <code>Map</code> data type for system logs tables (<code>system.query_log</code>, <code>system.query_thread_log</code>, <code>system.processes</code>, <code>system.opentelemetry_span_log</code>). These tables will be auto-created with new data types. Virtual columns are created to support old queries. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18698" target="_blank" rel="noopener noreferrer">#18698</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23934" target="_blank" rel="noopener noreferrer">#23934</a>, <a href="https://github.com/ClickHouse/ClickHouse/pull/25773" target="_blank" rel="noopener noreferrer">#25773</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>, <a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundy-li</a>, <a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>For a dictionary with a complex key containing only one attribute, allow not wrapping the key expression in tuple for functions <code>dictGet</code>, <code>dictHas</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26130" target="_blank" rel="noopener noreferrer">#26130</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Implement function <code>bin</code>/<code>hex</code> from <code>AggregateFunction</code> states. <a href="https://github.com/ClickHouse/ClickHouse/pull/26094" target="_blank" rel="noopener noreferrer">#26094</a> (<a href="https://github.com/zxc111" target="_blank" rel="noopener noreferrer">zhaoyu</a>).</li><li>Support arguments of <code>UUID</code> type for <code>empty</code> and <code>notEmpty</code> functions. <code>UUID</code> is empty if it is all zeros (nil UUID). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3446" target="_blank" rel="noopener noreferrer">#3446</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25974" target="_blank" rel="noopener noreferrer">#25974</a> (<a href="https://github.com/zxc111" target="_blank" rel="noopener noreferrer">zhaoyu</a>).</li><li>Add support for <code>SET SQL_SELECT_LIMIT</code> in MySQL protocol. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17115" target="_blank" rel="noopener noreferrer">#17115</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25972" target="_blank" rel="noopener noreferrer">#25972</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>More instrumentation for network interaction: add counters for recv/send bytes; add gauges for recvs/sends. Added missing documentation. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/5897" target="_blank" rel="noopener noreferrer">#5897</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25962" target="_blank" rel="noopener noreferrer">#25962</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add setting <code>optimize_move_to_prewhere_if_final</code>. If query has <code>FINAL</code>, the optimization <code>move_to_prewhere</code> will be enabled only if both <code>optimize_move_to_prewhere</code> and <code>optimize_move_to_prewhere_if_final</code> are enabled. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8684" target="_blank" rel="noopener noreferrer">#8684</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25940" target="_blank" rel="noopener noreferrer">#25940</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Allow complex quoted identifiers of JOINed tables. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/17861" target="_blank" rel="noopener noreferrer">#17861</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25924" target="_blank" rel="noopener noreferrer">#25924</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add support for Unicode (e.g. Chinese, Cyrillic) components in <code>Nested</code> data types. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/25594" target="_blank" rel="noopener noreferrer">#25594</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25923" target="_blank" rel="noopener noreferrer">#25923</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow <code>quantiles*</code> functions to work with <code>aggregate_functions_null_for_empty</code>. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/25892" target="_blank" rel="noopener noreferrer">#25892</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25919" target="_blank" rel="noopener noreferrer">#25919</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow parameters for parametric aggregate functions to be arbitrary constant expressions (e.g., <code>1 + 2</code>), not just literals. It also allows using the query parameters (in parameterized queries like <code>{param:UInt8}</code>) inside parametric aggregate functions. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11607" target="_blank" rel="noopener noreferrer">#11607</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25910" target="_blank" rel="noopener noreferrer">#25910</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Correctly throw the exception on the attempt to parse an invalid <code>Date</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/6481" target="_blank" rel="noopener noreferrer">#6481</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25909" target="_blank" rel="noopener noreferrer">#25909</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support for multiple includes in configuration. It is possible to include users configuration, remote server configuration from multiple sources. Simply place <code>&lt;include /&gt;</code> element with <code>from_zk</code>, <code>from_env</code> or <code>incl</code> attribute, and it will be replaced with the substitution. <a href="https://github.com/ClickHouse/ClickHouse/pull/24404" target="_blank" rel="noopener noreferrer">#24404</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Support for queries with a column named <code>&quot;null&quot;</code> (it must be specified in back-ticks or double quotes) and <code>ON CLUSTER</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24035" target="_blank" rel="noopener noreferrer">#24035</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25907" target="_blank" rel="noopener noreferrer">#25907</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support <code>LowCardinality</code>, <code>Decimal</code>, and <code>UUID</code> for <code>JSONExtract</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24606" target="_blank" rel="noopener noreferrer">#24606</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25900" target="_blank" rel="noopener noreferrer">#25900</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Convert history file from <code>readline</code> format to <code>replxx</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/25888" target="_blank" rel="noopener noreferrer">#25888</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix an issue which can lead to intersecting parts after <code>DROP PART</code> or background deletion of an empty part. <a href="https://github.com/ClickHouse/ClickHouse/pull/25884" target="_blank" rel="noopener noreferrer">#25884</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Better handling of lost parts for <code>ReplicatedMergeTree</code> tables. Fixes rare inconsistencies in <code>ReplicationQueue</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10368" target="_blank" rel="noopener noreferrer">#10368</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25820" target="_blank" rel="noopener noreferrer">#25820</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Allow starting clickhouse-client with unreadable working directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/25817" target="_blank" rel="noopener noreferrer">#25817</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Fix &quot;No available columns&quot; error for <code>Merge</code> storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/25801" target="_blank" rel="noopener noreferrer">#25801</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>MySQL Engine now supports the exchange of column comments between MySQL and ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/25795" target="_blank" rel="noopener noreferrer">#25795</a> (<a href="https://github.com/sand6255" target="_blank" rel="noopener noreferrer">Storozhuk Kostiantyn</a>).</li><li>Fix inconsistent behaviour of <code>GROUP BY</code> constant on empty set. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/6842" target="_blank" rel="noopener noreferrer">#6842</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25786" target="_blank" rel="noopener noreferrer">#25786</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Cancel already running merges in partition on <code>DROP PARTITION</code> and <code>TRUNCATE</code> for <code>ReplicatedMergeTree</code>. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/17151" target="_blank" rel="noopener noreferrer">#17151</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25684" target="_blank" rel="noopener noreferrer">#25684</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Support ENUM` data type for MaterializeMySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/25676" target="_blank" rel="noopener noreferrer">#25676</a> (<a href="https://github.com/sand6255" target="_blank" rel="noopener noreferrer">Storozhuk Kostiantyn</a>).</li><li>Support materialized and aliased columns in JOIN, close <a href="https://github.com/ClickHouse/ClickHouse/issues/13274" target="_blank" rel="noopener noreferrer">#13274</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25634" target="_blank" rel="noopener noreferrer">#25634</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix possible logical race condition between <code>ALTER TABLE ... DETACH</code> and background merges. <a href="https://github.com/ClickHouse/ClickHouse/pull/25605" target="_blank" rel="noopener noreferrer">#25605</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Make <code>NetworkReceiveElapsedMicroseconds</code> metric to correctly include the time spent waiting for data from the client to <code>INSERT</code>. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/9958" target="_blank" rel="noopener noreferrer">#9958</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25602" target="_blank" rel="noopener noreferrer">#25602</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support <code>TRUNCATE TABLE</code> for S3 and HDFS. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/25530" target="_blank" rel="noopener noreferrer">#25530</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25550" target="_blank" rel="noopener noreferrer">#25550</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support for dynamic reloading of config to change number of threads in pool for background jobs execution (merges, mutations, fetches). <a href="https://github.com/ClickHouse/ClickHouse/pull/25548" target="_blank" rel="noopener noreferrer">#25548</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Allow extracting of non-string element as string using <code>JSONExtract</code>. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/25414" target="_blank" rel="noopener noreferrer">#25414</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25452" target="_blank" rel="noopener noreferrer">#25452</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support regular expression in <code>Database</code> argument for <code>StorageMerge</code>. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/776" target="_blank" rel="noopener noreferrer">#776</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25064" target="_blank" rel="noopener noreferrer">#25064</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Web UI: if the value looks like a URL, automatically generate a link. <a href="https://github.com/ClickHouse/ClickHouse/pull/25965" target="_blank" rel="noopener noreferrer">#25965</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make <code>sudo service clickhouse-server start</code> to work on systems with <code>systemd</code> like Centos 8. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/14298" target="_blank" rel="noopener noreferrer">#14298</a>. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/17799" target="_blank" rel="noopener noreferrer">#17799</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25921" target="_blank" rel="noopener noreferrer">#25921</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fixes-1">Bug Fixes<a class="hash-link" href="#bug-fixes-1" title="Direct link to heading">​</a></h4><ul><li>Fix incorrect <code>SET ROLE</code> in some cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/26707" target="_blank" rel="noopener noreferrer">#26707</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix potential <code>nullptr</code> dereference in window functions. Fix <a href="https://github.com/ClickHouse/ClickHouse/issues/25276" target="_blank" rel="noopener noreferrer">#25276</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26668" target="_blank" rel="noopener noreferrer">#26668</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fix incorrect function names of <code>groupBitmapAnd/Or/Xor</code>. Fix <a href="https://github.com/ClickHouse/ClickHouse/pull/26557" target="_blank" rel="noopener noreferrer">#26557</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix crash in RabbitMQ shutdown in case RabbitMQ setup was not started. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26504" target="_blank" rel="noopener noreferrer">#26504</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26529" target="_blank" rel="noopener noreferrer">#26529</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix issues with <code>CREATE DICTIONARY</code> query if dictionary name or database name was quoted. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26491" target="_blank" rel="noopener noreferrer">#26491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26508" target="_blank" rel="noopener noreferrer">#26508</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix broken name resolution after rewriting column aliases. Fix <a href="https://github.com/ClickHouse/ClickHouse/issues/26432" target="_blank" rel="noopener noreferrer">#26432</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26475" target="_blank" rel="noopener noreferrer">#26475</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix infinite non-joined block stream in <code>partial_merge_join</code> close <a href="https://github.com/ClickHouse/ClickHouse/issues/26325" target="_blank" rel="noopener noreferrer">#26325</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26374" target="_blank" rel="noopener noreferrer">#26374</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix possible crash when login as dropped user. Fix <a href="https://github.com/ClickHouse/ClickHouse/issues/26073" target="_blank" rel="noopener noreferrer">#26073</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26363" target="_blank" rel="noopener noreferrer">#26363</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix <code>optimize_distributed_group_by_sharding_key</code> for multiple columns (leads to incorrect result w/ <code>optimize_skip_unused_shards=1</code>/<code>allow_nondeterministic_optimize_skip_unused_shards=1</code> and multiple columns in sharding key expression). <a href="https://github.com/ClickHouse/ClickHouse/pull/26353" target="_blank" rel="noopener noreferrer">#26353</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li><code>CAST</code> from <code>Date</code> to <code>DateTime</code> (or <code>DateTime64</code>) was not using the timezone of the <code>DateTime</code> type. It can also affect the comparison between <code>Date</code> and <code>DateTime</code>. Inference of the common type for <code>Date</code> and <code>DateTime</code> also was not using the corresponding timezone. It affected the results of function <code>if</code> and array construction. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24128" target="_blank" rel="noopener noreferrer">#24128</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24129" target="_blank" rel="noopener noreferrer">#24129</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fixed rare bug in lost replica recovery that may cause replicas to diverge. <a href="https://github.com/ClickHouse/ClickHouse/pull/26321" target="_blank" rel="noopener noreferrer">#26321</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix zstd decompression in case there are escape sequences at the end of internal buffer. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/26013" target="_blank" rel="noopener noreferrer">#26013</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26314" target="_blank" rel="noopener noreferrer">#26314</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix logical error on join with totals, close <a href="https://github.com/ClickHouse/ClickHouse/issues/26017" target="_blank" rel="noopener noreferrer">#26017</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26250" target="_blank" rel="noopener noreferrer">#26250</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Remove excessive newline in <code>thread_name</code> column in <code>system.stack_trace</code> table. Fix <a href="https://github.com/ClickHouse/ClickHouse/issues/24124" target="_blank" rel="noopener noreferrer">#24124</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26210" target="_blank" rel="noopener noreferrer">#26210</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>joinGet</code> with <code>LowCarinality</code> columns, close <a href="https://github.com/ClickHouse/ClickHouse/issues/25993" target="_blank" rel="noopener noreferrer">#25993</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26118" target="_blank" rel="noopener noreferrer">#26118</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix possible crash in <code>pointInPolygon</code> if the setting <code>validate_polygons</code> is turned off. <a href="https://github.com/ClickHouse/ClickHouse/pull/26113" target="_blank" rel="noopener noreferrer">#26113</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix throwing exception when iterate over non-existing remote directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/26087" target="_blank" rel="noopener noreferrer">#26087</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Fix rare server crash because of <code>abort</code> in ZooKeeper client. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25813" target="_blank" rel="noopener noreferrer">#25813</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26079" target="_blank" rel="noopener noreferrer">#26079</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix wrong thread count estimation for right subquery join in some cases. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/24075" target="_blank" rel="noopener noreferrer">#24075</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26052" target="_blank" rel="noopener noreferrer">#26052</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fixed incorrect <code>sequence_id</code> in MySQL protocol packets that ClickHouse sends on exception during query execution. It might cause MySQL client to reset connection to ClickHouse server. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21184" target="_blank" rel="noopener noreferrer">#21184</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26051" target="_blank" rel="noopener noreferrer">#26051</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix possible mismatched header when using normal projection with <code>PREWHERE</code>. Fix <a href="https://github.com/ClickHouse/ClickHouse/issues/26020" target="_blank" rel="noopener noreferrer">#26020</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26038" target="_blank" rel="noopener noreferrer">#26038</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix formatting of type <code>Map</code> with integer keys to <code>JSON</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25982" target="_blank" rel="noopener noreferrer">#25982</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible deadlock during query profiler stack unwinding. Fix <a href="https://github.com/ClickHouse/ClickHouse/issues/25968" target="_blank" rel="noopener noreferrer">#25968</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25970" target="_blank" rel="noopener noreferrer">#25970</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix crash on call <code>dictGet()</code> with bad arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/25913" target="_blank" rel="noopener noreferrer">#25913</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed <code>scram-sha-256</code> authentication for PostgreSQL engines. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24516" target="_blank" rel="noopener noreferrer">#24516</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25906" target="_blank" rel="noopener noreferrer">#25906</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix extremely long backoff for background tasks when the background pool is full. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25836" target="_blank" rel="noopener noreferrer">#25836</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25893" target="_blank" rel="noopener noreferrer">#25893</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix ARM exception handling with non default page size. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25512" target="_blank" rel="noopener noreferrer">#25512</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/25044" target="_blank" rel="noopener noreferrer">#25044</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/24901" target="_blank" rel="noopener noreferrer">#24901</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/23183" target="_blank" rel="noopener noreferrer">#23183</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/20221" target="_blank" rel="noopener noreferrer">#20221</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/19703" target="_blank" rel="noopener noreferrer">#19703</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/19028" target="_blank" rel="noopener noreferrer">#19028</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/18391" target="_blank" rel="noopener noreferrer">#18391</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/18121" target="_blank" rel="noopener noreferrer">#18121</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/17994" target="_blank" rel="noopener noreferrer">#17994</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12483" target="_blank" rel="noopener noreferrer">#12483</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25854" target="_blank" rel="noopener noreferrer">#25854</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix sharding_key from column w/o function for <code>remote()</code> (before <code>select * from remote(&#x27;127.1&#x27;, system.one, dummy)</code> leads to <code>Unknown column: dummy, there are only columns .</code> error). <a href="https://github.com/ClickHouse/ClickHouse/pull/25824" target="_blank" rel="noopener noreferrer">#25824</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <code>Not found column ...</code> and <code>Missing column ...</code> errors when selecting from <code>MaterializeMySQL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23708" target="_blank" rel="noopener noreferrer">#23708</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/24830" target="_blank" rel="noopener noreferrer">#24830</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/25794" target="_blank" rel="noopener noreferrer">#25794</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25822" target="_blank" rel="noopener noreferrer">#25822</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix <code>optimize_skip_unused_shards_rewrite_in</code> for non-UInt64 types (may select incorrect shards eventually or throw <code>Cannot infer type of an empty tuple</code> or <code>Function tuple requires at least one argument</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/25798" target="_blank" rel="noopener noreferrer">#25798</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix rare bug with <code>DROP PART</code> query for <code>ReplicatedMergeTree</code> tables which can lead to error message <code>Unexpected merged part intersecting drop range</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25783" target="_blank" rel="noopener noreferrer">#25783</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug in <code>TTL</code> with <code>GROUP BY</code> expression which refuses to execute <code>TTL</code> after first execution in part. <a href="https://github.com/ClickHouse/ClickHouse/pull/25743" target="_blank" rel="noopener noreferrer">#25743</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Allow StorageMerge to access tables with aliases. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/6051" target="_blank" rel="noopener noreferrer">#6051</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25694" target="_blank" rel="noopener noreferrer">#25694</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix slow dict join in some cases, close <a href="https://github.com/ClickHouse/ClickHouse/issues/24209" target="_blank" rel="noopener noreferrer">#24209</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25618" target="_blank" rel="noopener noreferrer">#25618</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix <code>ALTER MODIFY COLUMN</code> of columns, which participates in TTL expressions. <a href="https://github.com/ClickHouse/ClickHouse/pull/25554" target="_blank" rel="noopener noreferrer">#25554</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix assertion in <code>PREWHERE</code> with non-UInt8 type, close <a href="https://github.com/ClickHouse/ClickHouse/issues/19589" target="_blank" rel="noopener noreferrer">#19589</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25484" target="_blank" rel="noopener noreferrer">#25484</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir C</a>).</li><li>Fix some fuzzed msan crash. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22517" target="_blank" rel="noopener noreferrer">#22517</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/26428" target="_blank" rel="noopener noreferrer">#26428</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Update <code>chown</code> cmd check in <code>clickhouse-server</code> docker entrypoint. It fixes error &#x27;cluster pod restart failed (or timeout)&#x27; on kubernetes. <a href="https://github.com/ClickHouse/ClickHouse/pull/26545" target="_blank" rel="noopener noreferrer">#26545</a> (<a href="https://github.com/Kylinrix" target="_blank" rel="noopener noreferrer">Ky Li</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v217-2021-07-09">ClickHouse release v21.7, 2021-07-09<a class="hash-link" href="#clickhouse-release-v217-2021-07-09" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-4">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-4" title="Direct link to heading">​</a></h4><ul><li>Improved performance of queries with explicitly defined large sets. Added compatibility setting <code>legacy_column_name_of_tuple_literal</code>. It makes sense to set it to <code>true</code>, while doing rolling update of cluster from version lower than 21.7 to any higher version. Otherwise distributed queries with explicitly defined sets at <code>IN</code> clause may fail during update. <a href="https://github.com/ClickHouse/ClickHouse/pull/25371" target="_blank" rel="noopener noreferrer">#25371</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Forward/backward incompatible change of maximum buffer size in clickhouse-keeper (an experimental alternative to ZooKeeper). Better to do it now (before production), than later. <a href="https://github.com/ClickHouse/ClickHouse/pull/25421" target="_blank" rel="noopener noreferrer">#25421</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-4">New Feature<a class="hash-link" href="#new-feature-4" title="Direct link to heading">​</a></h4><ul><li>Support configuration in YAML format as alternative to XML. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3607" target="_blank" rel="noopener noreferrer">#3607</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21858" target="_blank" rel="noopener noreferrer">#21858</a> (<a href="https://github.com/BoloniniD" target="_blank" rel="noopener noreferrer">BoloniniD</a>).</li><li>Provides a way to restore replicated table when the data is (possibly) present, but the ZooKeeper metadata is lost. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/13458" target="_blank" rel="noopener noreferrer">#13458</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13652" target="_blank" rel="noopener noreferrer">#13652</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike Kot</a>).</li><li>Support structs and maps in Arrow/Parquet/ORC and dictionaries in Arrow input/output formats. Present new setting <code>output_format_arrow_low_cardinality_as_dictionary</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24341" target="_blank" rel="noopener noreferrer">#24341</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Added support for <code>Array</code> type in dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/25119" target="_blank" rel="noopener noreferrer">#25119</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added function <code>bitPositionsToArray</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23792" target="_blank" rel="noopener noreferrer">#23792</a>. Author <!-- -->[Kevin Wan]<!-- --> (@MaxWk). <a href="https://github.com/ClickHouse/ClickHouse/pull/25394" target="_blank" rel="noopener noreferrer">#25394</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added function <code>dateName</code> to return names like &#x27;Friday&#x27; or &#x27;April&#x27;. Author <!-- -->[Daniil Kondratyev]<!-- --> (@dankondr). <a href="https://github.com/ClickHouse/ClickHouse/pull/25372" target="_blank" rel="noopener noreferrer">#25372</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add <code>toJSONString</code> function to serialize columns to their JSON representations. <a href="https://github.com/ClickHouse/ClickHouse/pull/25164" target="_blank" rel="noopener noreferrer">#25164</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Now <code>query_log</code> has two new columns: <code>initial_query_start_time</code>, <code>initial_query_start_time_microsecond</code> that record the starting time of a distributed query if any. <a href="https://github.com/ClickHouse/ClickHouse/pull/25022" target="_blank" rel="noopener noreferrer">#25022</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add aggregate function <code>segmentLengthSum</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24250" target="_blank" rel="noopener noreferrer">#24250</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Add a new boolean setting <code>prefer_global_in_and_join</code> which defaults all IN/JOIN as GLOBAL IN/JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/23434" target="_blank" rel="noopener noreferrer">#23434</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support <code>ALTER DELETE</code> queries for <code>Join</code> table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/23260" target="_blank" rel="noopener noreferrer">#23260</a> (<a href="https://github.com/foolchi" target="_blank" rel="noopener noreferrer">foolchi</a>).</li><li>Add <code>quantileBFloat16</code> aggregate function as well as the corresponding <code>quantilesBFloat16</code> and <code>medianBFloat16</code>. It is very simple and fast quantile estimator with relative error not more than 0.390625%. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16641" target="_blank" rel="noopener noreferrer">#16641</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23204" target="_blank" rel="noopener noreferrer">#23204</a> (<a href="https://github.com/RedClusive" target="_blank" rel="noopener noreferrer">Ivan Novitskiy</a>).</li><li>Implement <code>sequenceNextNode()</code> function useful for <code>flow analysis</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19766" target="_blank" rel="noopener noreferrer">#19766</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-4">Experimental Feature<a class="hash-link" href="#experimental-feature-4" title="Direct link to heading">​</a></h4><ul><li>Add support for virtual filesystem over HDFS. <a href="https://github.com/ClickHouse/ClickHouse/pull/11058" target="_blank" rel="noopener noreferrer">#11058</a> (<a href="https://github.com/overshov" target="_blank" rel="noopener noreferrer">overshov</a>) (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Now clickhouse-keeper (an experimental alternative to ZooKeeper) supports ZooKeeper-like <code>digest</code> ACLs. <a href="https://github.com/ClickHouse/ClickHouse/pull/24448" target="_blank" rel="noopener noreferrer">#24448</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-4">Performance Improvement<a class="hash-link" href="#performance-improvement-4" title="Direct link to heading">​</a></h4><ul><li>Added optimization that transforms some functions to reading of subcolumns to reduce amount of read data. E.g., statement <code>col IS NULL</code> is transformed to reading of subcolumn <code>col.null</code>. Optimization can be enabled by setting <code>optimize_functions_to_subcolumns</code> which is currently off by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/24406" target="_blank" rel="noopener noreferrer">#24406</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Rewrite more columns to possible alias expressions. This may enable better optimization, such as projections. <a href="https://github.com/ClickHouse/ClickHouse/pull/24405" target="_blank" rel="noopener noreferrer">#24405</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Index of type <code>bloom_filter</code> can be used for expressions with <code>hasAny</code> function with constant arrays. This closes: <a href="https://github.com/ClickHouse/ClickHouse/issues/24291" target="_blank" rel="noopener noreferrer">#24291</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24900" target="_blank" rel="noopener noreferrer">#24900</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Add exponential backoff to reschedule read attempt in case RabbitMQ queues are empty. (ClickHouse has support for importing data from RabbitMQ). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24340" target="_blank" rel="noopener noreferrer">#24340</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24415" target="_blank" rel="noopener noreferrer">#24415</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-4">Improvement<a class="hash-link" href="#improvement-4" title="Direct link to heading">​</a></h4><ul><li>Allow to limit bandwidth for replication. Add two Replicated<!-- -->*<!-- -->MergeTree settings: <code>max_replicated_fetches_network_bandwidth</code> and <code>max_replicated_sends_network_bandwidth</code> which allows to limit maximum speed of replicated fetches/sends for table. Add two server-wide settings (in <code>default</code> user profile): <code>max_replicated_fetches_network_bandwidth_for_server</code> and <code>max_replicated_sends_network_bandwidth_for_server</code> which limit maximum speed of replication for all tables. The settings are not followed perfectly accurately. Turned off by default. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/1821" target="_blank" rel="noopener noreferrer">#1821</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24573" target="_blank" rel="noopener noreferrer">#24573</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Resource constraints and isolation for ODBC and Library bridges. Use separate <code>clickhouse-bridge</code> group and user for bridge processes. Set oom_score_adj so the bridges will be first subjects for OOM killer. Set set maximum RSS to 1 GiB. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23861" target="_blank" rel="noopener noreferrer">#23861</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25280" target="_blank" rel="noopener noreferrer">#25280</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add standalone <code>clickhouse-keeper</code> symlink to the main <code>clickhouse</code> binary. Now it&#x27;s possible to run coordination without the main clickhouse server. <a href="https://github.com/ClickHouse/ClickHouse/pull/24059" target="_blank" rel="noopener noreferrer">#24059</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Use global settings for query to <code>VIEW</code>. Fixed the behavior when queries to <code>VIEW</code> use local settings, that leads to errors if setting on <code>CREATE VIEW</code> and <code>SELECT</code> were different. As for now, <code>VIEW</code> won&#x27;t use these modified settings, but you can still pass additional settings in <code>SETTINGS</code> section of <code>CREATE VIEW</code> query. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/20551" target="_blank" rel="noopener noreferrer">#20551</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24095" target="_blank" rel="noopener noreferrer">#24095</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>On server start, parts with incorrect partition ID would not be ever removed, but always detached. <a href="https://github.com/ClickHouse/ClickHouse/issues/25070" target="_blank" rel="noopener noreferrer">#25070</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25166" target="_blank" rel="noopener noreferrer">#25166</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Increase size of background schedule pool to 128 (<code>background_schedule_pool_size</code> setting). It allows avoiding replication queue hung on slow zookeeper connection. <a href="https://github.com/ClickHouse/ClickHouse/pull/25072" target="_blank" rel="noopener noreferrer">#25072</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add merge tree setting <code>max_parts_to_merge_at_once</code> which limits the number of parts that can be merged in the background at once. Doesn&#x27;t affect <code>OPTIMIZE FINAL</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/1820" target="_blank" rel="noopener noreferrer">#1820</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24496" target="_blank" rel="noopener noreferrer">#24496</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Allow <code>NOT IN</code> operator to be used in partition pruning. <a href="https://github.com/ClickHouse/ClickHouse/pull/24894" target="_blank" rel="noopener noreferrer">#24894</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Recognize IPv4 addresses like <code>127.0.1.1</code> as local. This is controversial and closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23504" target="_blank" rel="noopener noreferrer">#23504</a>. Michael Filimonov will test this feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/24316" target="_blank" rel="noopener noreferrer">#24316</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>ClickHouse database created with MaterializeMySQL (it is an experimental feature) now contains all column comments from the MySQL database that materialized. <a href="https://github.com/ClickHouse/ClickHouse/pull/25199" target="_blank" rel="noopener noreferrer">#25199</a> (<a href="https://github.com/sand6255" target="_blank" rel="noopener noreferrer">Storozhuk Kostiantyn</a>).</li><li>Add settings (<code>connection_auto_close</code>/<code>connection_max_tries</code>/<code>connection_pool_size</code>) for MySQL storage engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/24146" target="_blank" rel="noopener noreferrer">#24146</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improve startup time of Distributed engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/25663" target="_blank" rel="noopener noreferrer">#25663</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improvement for Distributed tables. Drop replicas from dirname for internal_replication=true (allows INSERT into Distributed with cluster from any number of replicas, before only 15 replicas was supported, everything more will fail with ENAMETOOLONG while creating directory for async blocks). <a href="https://github.com/ClickHouse/ClickHouse/pull/25513" target="_blank" rel="noopener noreferrer">#25513</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added support <code>Interval</code> type for <code>LowCardinality</code>. It is needed for intermediate values of some expressions. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21730" target="_blank" rel="noopener noreferrer">#21730</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25410" target="_blank" rel="noopener noreferrer">#25410</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>Add <code>==</code> operator on time conditions for <code>sequenceMatch</code> and <code>sequenceCount</code> functions. For eg: sequenceMatch(&#x27;(?1)(?t==1)(?2)&#x27;)(time, data = 1, data = 2). <a href="https://github.com/ClickHouse/ClickHouse/pull/25299" target="_blank" rel="noopener noreferrer">#25299</a> (<a href="https://github.com/mga-chka" target="_blank" rel="noopener noreferrer">Christophe Kalenzaga</a>).</li><li>Add settings <code>http_max_fields</code>, <code>http_max_field_name_size</code>, <code>http_max_field_value_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25296" target="_blank" rel="noopener noreferrer">#25296</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Add support for function <code>if</code> with <code>Decimal</code> and <code>Int</code> types on its branches. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20549" target="_blank" rel="noopener noreferrer">#20549</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10142" target="_blank" rel="noopener noreferrer">#10142</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25283" target="_blank" rel="noopener noreferrer">#25283</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Update prompt in <code>clickhouse-client</code> and display a message when reconnecting. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10577" target="_blank" rel="noopener noreferrer">#10577</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25281" target="_blank" rel="noopener noreferrer">#25281</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Correct memory tracking in aggregate function <code>topK</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25259" target="_blank" rel="noopener noreferrer">#25259</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25260" target="_blank" rel="noopener noreferrer">#25260</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>topLevelDomain</code> for IDN hosts (i.e. <code>example.рф</code>), before it returns empty string for such hosts. <a href="https://github.com/ClickHouse/ClickHouse/pull/25103" target="_blank" rel="noopener noreferrer">#25103</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Detect Linux kernel version at runtime (for worked nested epoll, that is required for <code>async_socket_for_remote</code>/<code>use_hedged_requests</code>, otherwise remote queries may stuck). <a href="https://github.com/ClickHouse/ClickHouse/pull/25067" target="_blank" rel="noopener noreferrer">#25067</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>For distributed query, when <code>optimize_skip_unused_shards=1</code>, allow to skip shard with condition like <code>(sharding key) IN (one-element-tuple)</code>. (Tuples with many elements were supported. Tuple with single element did not work because it is parsed as literal). <a href="https://github.com/ClickHouse/ClickHouse/pull/24930" target="_blank" rel="noopener noreferrer">#24930</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Improved log messages of S3 errors, no more double whitespaces in case of empty keys and buckets. <a href="https://github.com/ClickHouse/ClickHouse/pull/24897" target="_blank" rel="noopener noreferrer">#24897</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Some queries require multi-pass semantic analysis. Try reusing built sets for <code>IN</code> in this case. <a href="https://github.com/ClickHouse/ClickHouse/pull/24874" target="_blank" rel="noopener noreferrer">#24874</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Respect <code>max_distributed_connections</code> for <code>insert_distributed_sync</code> (otherwise for huge clusters and sync insert it may run out of <code>max_thread_pool_size</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/24754" target="_blank" rel="noopener noreferrer">#24754</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Avoid hiding errors like <code>Limit for rows or bytes to read exceeded</code> for scalar subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/24545" target="_blank" rel="noopener noreferrer">#24545</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Make String-to-Int parser stricter so that <code>toInt64(&#x27;+&#x27;)</code> will throw. <a href="https://github.com/ClickHouse/ClickHouse/pull/24475" target="_blank" rel="noopener noreferrer">#24475</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>If <code>SSD_CACHE</code> is created with DDL query, it can be created only inside <code>user_files</code> directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/24466" target="_blank" rel="noopener noreferrer">#24466</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>PostgreSQL support for specifying non default schema for insert queries. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24149" target="_blank" rel="noopener noreferrer">#24149</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24413" target="_blank" rel="noopener noreferrer">#24413</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix IPv6 addresses resolving (i.e. fixes <code>select * from remote(&#x27;[::1]&#x27;, system.one)</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/24319" target="_blank" rel="noopener noreferrer">#24319</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix trailing whitespaces in FROM clause with subqueries in multiline mode, and also changes the output of the queries slightly in a more human friendly way. <a href="https://github.com/ClickHouse/ClickHouse/pull/24151" target="_blank" rel="noopener noreferrer">#24151</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improvement for Distributed tables. Add ability to split distributed batch on failures (i.e. due to memory limits, corruptions), under <code>distributed_directory_monitor_split_batch_on_failure</code> (OFF by default). <a href="https://github.com/ClickHouse/ClickHouse/pull/23864" target="_blank" rel="noopener noreferrer">#23864</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Handle column name clashes for <code>Join</code> table engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20309" target="_blank" rel="noopener noreferrer">#20309</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23769" target="_blank" rel="noopener noreferrer">#23769</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>Display progress for <code>File</code> table engine in <code>clickhouse-local</code> and on INSERT query in <code>clickhouse-client</code> when data is passed to stdin. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18209" target="_blank" rel="noopener noreferrer">#18209</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23656" target="_blank" rel="noopener noreferrer">#23656</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Bugfixes and improvements of <code>clickhouse-copier</code>. Allow to copy tables with different (but compatible schemas). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9159" target="_blank" rel="noopener noreferrer">#9159</a>. Added test to copy ReplacingMergeTree. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22711" target="_blank" rel="noopener noreferrer">#22711</a>. Support TTL on columns and Data Skipping Indices. It simply removes it to create internal Distributed table (underlying table will have TTL and skipping indices). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19384" target="_blank" rel="noopener noreferrer">#19384</a>. Allow to copy MATERIALIZED and ALIAS columns. There are some cases in which it could be helpful (e.g. if this column is in PRIMARY KEY). Now it could be allowed by setting <code>allow_to_copy_alias_and_materialized_columns</code> property to true in task configuration. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9177" target="_blank" rel="noopener noreferrer">#9177</a>. Closes <!-- -->[#11007]<!-- --> (<a href="https://github.com/ClickHouse/ClickHouse/issues/11007" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/issues/11007</a>). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9514" target="_blank" rel="noopener noreferrer">#9514</a>. Added a property <code>allow_to_drop_target_partitions</code> in task configuration to drop partition in original table before moving helping tables. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20957" target="_blank" rel="noopener noreferrer">#20957</a>. Get rid of <code>OPTIMIZE DEDUPLICATE</code> query. This hack was needed, because <code>ALTER TABLE MOVE PARTITION</code> was retried many times and plain MergeTree tables don&#x27;t have deduplication. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17966" target="_blank" rel="noopener noreferrer">#17966</a>. Write progress to ZooKeeper node on path <code>task_path + /status</code> in JSON format. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20955" target="_blank" rel="noopener noreferrer">#20955</a>. Support for ReplicatedTables without arguments. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24834" target="_blank" rel="noopener noreferrer">#24834</a> .<a href="https://github.com/ClickHouse/ClickHouse/pull/23518" target="_blank" rel="noopener noreferrer">#23518</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Added sleep with backoff between read retries from S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/23461" target="_blank" rel="noopener noreferrer">#23461</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Respect <code>insert_allow_materialized_columns</code> (allows materialized columns) for INSERT into <code>Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/23349" target="_blank" rel="noopener noreferrer">#23349</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add ability to push down LIMIT for distributed queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/23027" target="_blank" rel="noopener noreferrer">#23027</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix zero-copy replication with several S3 volumes (Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22679" target="_blank" rel="noopener noreferrer">#22679</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/22864" target="_blank" rel="noopener noreferrer">#22864</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Resolve the actual port number bound when a user requests any available port from the operating system to show it in the log message. <a href="https://github.com/ClickHouse/ClickHouse/pull/25569" target="_blank" rel="noopener noreferrer">#25569</a> (<a href="https://github.com/bnaecker" target="_blank" rel="noopener noreferrer">bnaecker</a>).</li><li>Fixed case, when sometimes conversion of postgres arrays resulted in String data type, not n-dimensional array, because <code>attndims</code> works incorrectly in some cases. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24804" target="_blank" rel="noopener noreferrer">#24804</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25538" target="_blank" rel="noopener noreferrer">#25538</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix convertion of DateTime with timezone for MySQL, PostgreSQL, ODBC. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/5057" target="_blank" rel="noopener noreferrer">#5057</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25528" target="_blank" rel="noopener noreferrer">#25528</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Distinguish KILL MUTATION for different tables (fixes unexpected <code>Cancelled mutating parts</code> error). <a href="https://github.com/ClickHouse/ClickHouse/pull/25025" target="_blank" rel="noopener noreferrer">#25025</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow to declare S3 disk at root of bucket (S3 virtual filesystem is an experimental feature under development). <a href="https://github.com/ClickHouse/ClickHouse/pull/24898" target="_blank" rel="noopener noreferrer">#24898</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Enable reading of subcolumns (e.g. components of Tuples) for distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/24472" target="_blank" rel="noopener noreferrer">#24472</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>A feature for MySQL compatibility protocol: make <code>user</code> function to return correct output. Closes <a href="https://github.com/ClickHouse/ClickHouse/pull/25697" target="_blank" rel="noopener noreferrer">#25697</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25697" target="_blank" rel="noopener noreferrer">#25697</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-3">Bug Fix<a class="hash-link" href="#bug-fix-3" title="Direct link to heading">​</a></h4><ul><li>Improvement for backward compatibility. Use old modulo function version when used in partition key. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23508" target="_blank" rel="noopener noreferrer">#23508</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24157" target="_blank" rel="noopener noreferrer">#24157</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix extremely rare bug on low-memory servers which can lead to the inability to perform merges without restart. Possibly fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24603" target="_blank" rel="noopener noreferrer">#24603</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24872" target="_blank" rel="noopener noreferrer">#24872</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix extremely rare error <code>Tagging already tagged part</code> in replication queue during concurrent <code>alter move/replace partition</code>. Possibly fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22142" target="_blank" rel="noopener noreferrer">#22142</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24961" target="_blank" rel="noopener noreferrer">#24961</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix potential crash when calculating aggregate function states by aggregation of aggregate function states of other aggregate functions (not a practical use case). See <a href="https://github.com/ClickHouse/ClickHouse/issues/24523" target="_blank" rel="noopener noreferrer">#24523</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25015" target="_blank" rel="noopener noreferrer">#25015</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the behavior when query <code>SYSTEM RESTART REPLICA</code> or <code>SYSTEM SYNC REPLICA</code> does not finish. This was detected on server with extremely low amount of RAM. <a href="https://github.com/ClickHouse/ClickHouse/pull/24457" target="_blank" rel="noopener noreferrer">#24457</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix bug which can lead to ZooKeeper client hung inside clickhouse-server. <a href="https://github.com/ClickHouse/ClickHouse/pull/24721" target="_blank" rel="noopener noreferrer">#24721</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>If ZooKeeper connection was lost and replica was cloned after restoring the connection, its replication queue might contain outdated entries. Fixed failed assertion when replication queue contains intersecting virtual parts. It may rarely happen if some data part was lost. Print error in log instead of terminating. <a href="https://github.com/ClickHouse/ClickHouse/pull/24777" target="_blank" rel="noopener noreferrer">#24777</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix lost <code>WHERE</code> condition in expression-push-down optimization of query plan (setting <code>query_plan_filter_push_down = 1</code> by default). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25368" target="_blank" rel="noopener noreferrer">#25368</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25370" target="_blank" rel="noopener noreferrer">#25370</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bug which can lead to intersecting parts after merges with TTL: <code>Part all_40_40_0 is covered by all_40_40_1 but should be merged into all_40_41_1. This shouldn&#x27;t happen often.</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25549" target="_blank" rel="noopener noreferrer">#25549</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>On ZooKeeper connection loss <code>ReplicatedMergeTree</code> table might wait for background operations to complete before trying to reconnect. It&#x27;s fixed, now background operations are stopped forcefully. <a href="https://github.com/ClickHouse/ClickHouse/pull/25306" target="_blank" rel="noopener noreferrer">#25306</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix error <code>Key expression contains comparison between inconvertible types</code> for queries with <code>ARRAY JOIN</code> in case if array is used in primary key. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8247" target="_blank" rel="noopener noreferrer">#8247</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25546" target="_blank" rel="noopener noreferrer">#25546</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix wrong totals for query <code>WITH TOTALS</code> and <code>WITH FILL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20872" target="_blank" rel="noopener noreferrer">#20872</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25539" target="_blank" rel="noopener noreferrer">#25539</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix data race when querying <code>system.clusters</code> while reloading the cluster configuration at the same time. <a href="https://github.com/ClickHouse/ClickHouse/pull/25737" target="_blank" rel="noopener noreferrer">#25737</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed <code>No such file or directory</code> error on moving <code>Distributed</code> table between databases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24971" target="_blank" rel="noopener noreferrer">#24971</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25667" target="_blank" rel="noopener noreferrer">#25667</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li><code>REPLACE PARTITION</code> might be ignored in rare cases if the source partition was empty. It&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24869" target="_blank" rel="noopener noreferrer">#24869</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25665" target="_blank" rel="noopener noreferrer">#25665</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed a bug in <code>Replicated</code> database engine that might rarely cause some replica to skip enqueued DDL query. <a href="https://github.com/ClickHouse/ClickHouse/pull/24805" target="_blank" rel="noopener noreferrer">#24805</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix null pointer dereference in <code>EXPLAIN AST</code> without query. <a href="https://github.com/ClickHouse/ClickHouse/pull/25631" target="_blank" rel="noopener noreferrer">#25631</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix waiting of automatic dropping of empty parts. It could lead to full filling of background pool and stuck of replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/23315" target="_blank" rel="noopener noreferrer">#23315</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix restore of a table stored in S3 virtual filesystem (it is an experimental feature not ready for production). <a href="https://github.com/ClickHouse/ClickHouse/pull/25601" target="_blank" rel="noopener noreferrer">#25601</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Fix nullptr dereference in <code>Arrow</code> format when using <code>Decimal256</code>. Add <code>Decimal256</code> support for <code>Arrow</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/25531" target="_blank" rel="noopener noreferrer">#25531</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix excessive underscore before the names of the preprocessed configuration files. <a href="https://github.com/ClickHouse/ClickHouse/pull/25431" target="_blank" rel="noopener noreferrer">#25431</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>A fix for <code>clickhouse-copier</code> tool: Fix segfault when sharding_key is absent in task config for copier. <a href="https://github.com/ClickHouse/ClickHouse/pull/25419" target="_blank" rel="noopener noreferrer">#25419</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix <code>REPLACE</code> column transformer when used in DDL by correctly quoting the formated query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23925" target="_blank" rel="noopener noreferrer">#23925</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25391" target="_blank" rel="noopener noreferrer">#25391</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix the possibility of non-deterministic behaviour of the <code>quantileDeterministic</code> function and similar. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20480" target="_blank" rel="noopener noreferrer">#20480</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25313" target="_blank" rel="noopener noreferrer">#25313</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support <code>SimpleAggregateFunction(LowCardinality)</code> for <code>SummingMergeTree</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25134" target="_blank" rel="noopener noreferrer">#25134</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25300" target="_blank" rel="noopener noreferrer">#25300</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix logical error with exception message &quot;Cannot sum Array/Tuple in min/maxMap&quot;. <a href="https://github.com/ClickHouse/ClickHouse/pull/25298" target="_blank" rel="noopener noreferrer">#25298</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix error <code>Bad cast from type DB::ColumnLowCardinality to DB::ColumnVector&lt;char8_t&gt;</code> for queries where <code>LowCardinality</code> argument was used for IN (this bug appeared in 21.6). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25187" target="_blank" rel="noopener noreferrer">#25187</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25290" target="_blank" rel="noopener noreferrer">#25290</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix incorrect behaviour of <code>joinGetOrNull</code> with not-nullable columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24261" target="_blank" rel="noopener noreferrer">#24261</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25288" target="_blank" rel="noopener noreferrer">#25288</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix incorrect behaviour and UBSan report in big integers. In previous versions <code>CAST(1e19 AS UInt128)</code> returned zero. <a href="https://github.com/ClickHouse/ClickHouse/pull/25279" target="_blank" rel="noopener noreferrer">#25279</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed an error which occurred while inserting a subset of columns using CSVWithNames format. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25129" target="_blank" rel="noopener noreferrer">#25129</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25169" target="_blank" rel="noopener noreferrer">#25169</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Do not use table&#x27;s projection for <code>SELECT</code> with <code>FINAL</code>. It is not supported yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/25163" target="_blank" rel="noopener noreferrer">#25163</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix possible parts loss after updating up to 21.5 in case table used <code>UUID</code> in partition key. (It is not recommended to use <code>UUID</code> in partition key). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/25070" target="_blank" rel="noopener noreferrer">#25070</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25127" target="_blank" rel="noopener noreferrer">#25127</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix crash in query with cross join and <code>joined_subquery_requires_alias = 0</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24011" target="_blank" rel="noopener noreferrer">#24011</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25082" target="_blank" rel="noopener noreferrer">#25082</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bug with constant maps in mapContains function that lead to error <code>empty column was returned by function mapContains</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/25077" target="_blank" rel="noopener noreferrer">#25077</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25080" target="_blank" rel="noopener noreferrer">#25080</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Remove possibility to create tables with columns referencing themselves like <code>a UInt32 ALIAS a + 1</code> or <code>b UInt32 MATERIALIZED b</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24910" target="_blank" rel="noopener noreferrer">#24910</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/24292" target="_blank" rel="noopener noreferrer">#24292</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25059" target="_blank" rel="noopener noreferrer">#25059</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix wrong result when using aggregate projection with <em>not empty</em> <code>GROUP BY</code> key to execute query with <code>GROUP BY</code> by <em>empty</em> key. <a href="https://github.com/ClickHouse/ClickHouse/pull/25055" target="_blank" rel="noopener noreferrer">#25055</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix serialization of splitted nested messages in Protobuf format. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24647" target="_blank" rel="noopener noreferrer">#24647</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25000" target="_blank" rel="noopener noreferrer">#25000</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix limit/offset settings for distributed queries (ignore on the remote nodes). <a href="https://github.com/ClickHouse/ClickHouse/pull/24940" target="_blank" rel="noopener noreferrer">#24940</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible heap-buffer-overflow in <code>Arrow</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/24922" target="_blank" rel="noopener noreferrer">#24922</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fixed possible error &#x27;Cannot read from istream at offset 0&#x27; when reading a file from DiskS3 (S3 virtual filesystem is an experimental feature under development that should not be used in production). <a href="https://github.com/ClickHouse/ClickHouse/pull/24885" target="_blank" rel="noopener noreferrer">#24885</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fix &quot;Missing columns&quot; exception when joining Distributed Materialized View. <a href="https://github.com/ClickHouse/ClickHouse/pull/24870" target="_blank" rel="noopener noreferrer">#24870</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow <code>NULL</code> values in postgresql compatibility protocol. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22622" target="_blank" rel="noopener noreferrer">#22622</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24857" target="_blank" rel="noopener noreferrer">#24857</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix bug when exception <code>Mutation was killed</code> can be thrown to the client on mutation wait when mutation not loaded into memory yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/24809" target="_blank" rel="noopener noreferrer">#24809</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed bug in deserialization of random generator state with might cause some data types such as <code>AggregateFunction(groupArraySample(N), T))</code> to behave in a non-deterministic way. <a href="https://github.com/ClickHouse/ClickHouse/pull/24538" target="_blank" rel="noopener noreferrer">#24538</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Disallow building uniqXXXXStates of other aggregation states. <a href="https://github.com/ClickHouse/ClickHouse/pull/24523" target="_blank" rel="noopener noreferrer">#24523</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>). Then allow it back by actually eliminating the root cause of the related issue. (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix usage of tuples in <code>CREATE .. AS SELECT</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/24464" target="_blank" rel="noopener noreferrer">#24464</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix computation of total bytes in <code>Buffer</code> table. In current ClickHouse version total_writes.bytes counter decreases too much during the buffer flush. It leads to counter overflow and totalBytes return something around 17.44 EB some time after the flush. <a href="https://github.com/ClickHouse/ClickHouse/pull/24450" target="_blank" rel="noopener noreferrer">#24450</a> (<a href="https://github.com/DimasKovas" target="_blank" rel="noopener noreferrer">DimasKovas</a>).</li><li>Fix incorrect information about the monotonicity of toWeek function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24422" target="_blank" rel="noopener noreferrer">#24422</a> . This bug was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/5212" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/5212</a> , and was exposed later by smarter partition pruner. <a href="https://github.com/ClickHouse/ClickHouse/pull/24446" target="_blank" rel="noopener noreferrer">#24446</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>When user authentication is managed by LDAP. Fixed potential deadlock that can happen during LDAP role (re)mapping, when LDAP group is mapped to a nonexistent local role. <a href="https://github.com/ClickHouse/ClickHouse/pull/24431" target="_blank" rel="noopener noreferrer">#24431</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>In &quot;multipart/form-data&quot; message consider the CRLF preceding a boundary as part of it. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23905" target="_blank" rel="noopener noreferrer">#23905</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24399" target="_blank" rel="noopener noreferrer">#24399</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Fix drop partition with intersect fake parts. In rare cases there might be parts with mutation version greater than current block number. <a href="https://github.com/ClickHouse/ClickHouse/pull/24321" target="_blank" rel="noopener noreferrer">#24321</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed a bug in moving Materialized View from Ordinary to Atomic database (<code>RENAME TABLE</code> query). Now inner table is moved to new database together with Materialized View. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23926" target="_blank" rel="noopener noreferrer">#23926</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24309" target="_blank" rel="noopener noreferrer">#24309</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Allow empty HTTP headers. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23901" target="_blank" rel="noopener noreferrer">#23901</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24285" target="_blank" rel="noopener noreferrer">#24285</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Correct processing of mutations (ALTER UPDATE/DELETE) in Memory tables. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24274" target="_blank" rel="noopener noreferrer">#24274</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24275" target="_blank" rel="noopener noreferrer">#24275</a> (<a href="https://github.com/ucasfl" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Make column LowCardinality property in JOIN output the same as in the input, close <a href="https://github.com/ClickHouse/ClickHouse/issues/23351" target="_blank" rel="noopener noreferrer">#23351</a>, close <a href="https://github.com/ClickHouse/ClickHouse/issues/20315" target="_blank" rel="noopener noreferrer">#20315</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24061" target="_blank" rel="noopener noreferrer">#24061</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>A fix for Kafka tables. Fix the bug in failover behavior when Engine = Kafka was not able to start consumption if the same consumer had an empty assignment previously. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21118" target="_blank" rel="noopener noreferrer">#21118</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21267" target="_blank" rel="noopener noreferrer">#21267</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-4">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-4" title="Direct link to heading">​</a></h4><ul><li>Add <code>darwin-aarch64</code> (Mac M1 / Apple Silicon) builds in CI <a href="https://github.com/ClickHouse/ClickHouse/pull/25560" target="_blank" rel="noopener noreferrer">#25560</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>) and put the links to the docs and website (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Adds cross-platform embedding of binary resources into executables. It works on Illumos. <a href="https://github.com/ClickHouse/ClickHouse/pull/25146" target="_blank" rel="noopener noreferrer">#25146</a> (<a href="https://github.com/bnaecker" target="_blank" rel="noopener noreferrer">bnaecker</a>).</li><li>Add join related options to stress tests to improve fuzzing. <a href="https://github.com/ClickHouse/ClickHouse/pull/25200" target="_blank" rel="noopener noreferrer">#25200</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>Enable build with s3 module in osx <a href="https://github.com/ClickHouse/ClickHouse/issues/25217" target="_blank" rel="noopener noreferrer">#25217</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/25218" target="_blank" rel="noopener noreferrer">#25218</a> (<a href="https://github.com/MaxWk" target="_blank" rel="noopener noreferrer">kevin wan</a>).</li><li>Add integration test cases to cover JDBC bridge. <a href="https://github.com/ClickHouse/ClickHouse/pull/25047" target="_blank" rel="noopener noreferrer">#25047</a> (<a href="https://github.com/zhicwu" target="_blank" rel="noopener noreferrer">Zhichun Wu</a>).</li><li>Integration tests configuration has special treatment for dictionaries. Removed remaining dictionaries manual setup. <a href="https://github.com/ClickHouse/ClickHouse/pull/24728" target="_blank" rel="noopener noreferrer">#24728</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Add libfuzzer tests for YAMLParser class. <a href="https://github.com/ClickHouse/ClickHouse/pull/24480" target="_blank" rel="noopener noreferrer">#24480</a> (<a href="https://github.com/BoloniniD" target="_blank" rel="noopener noreferrer">BoloniniD</a>).</li><li>Ubuntu 20.04 is now used to run integration tests, docker-compose version used to run integration tests is updated to 1.28.2. Environment variables now take effect on docker-compose. Rework test_dictionaries_all_layouts_separate_sources to allow parallel run. <a href="https://github.com/ClickHouse/ClickHouse/pull/20393" target="_blank" rel="noopener noreferrer">#20393</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Fix TOCTOU error in installation script. <a href="https://github.com/ClickHouse/ClickHouse/pull/25277" target="_blank" rel="noopener noreferrer">#25277</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-216-2021-06-05">ClickHouse release 21.6, 2021-06-05<a class="hash-link" href="#clickhouse-release-216-2021-06-05" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-5">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-5" title="Direct link to heading">​</a></h4><ul><li>uniqState / uniqHLL12State / uniqCombinedState / uniqCombined64State produce incompatible states with <code>UUID</code> type. <a href="https://github.com/ClickHouse/ClickHouse/issues/33607" target="_blank" rel="noopener noreferrer">#33607</a>.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="upgrade-notes-1">Upgrade Notes<a class="hash-link" href="#upgrade-notes-1" title="Direct link to heading">​</a></h4><ul><li><code>zstd</code> compression library is updated to v1.5.0. You may get messages about &quot;checksum does not match&quot; in replication. These messages are expected due to update of compression algorithm and you can ignore them. These messages are informational and do not indicate any kinds of undesired behaviour.</li><li>The setting <code>compile_expressions</code> is enabled by default. Although it has been heavily tested on variety of scenarios, if you find some undesired behaviour on your servers, you can try turning this setting off.</li><li>Values of <code>UUID</code> type cannot be compared with integer. For example, instead of writing <code>uuid != 0</code> type <code>uuid != &#x27;00000000-0000-0000-0000-000000000000&#x27;</code>.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-5">New Feature<a class="hash-link" href="#new-feature-5" title="Direct link to heading">​</a></h4><ul><li>Add Postgres-like cast operator (<code>::</code>). E.g.: <code>[1, 2]::Array(UInt8)</code>, <code>0.1::Decimal(4, 4)</code>, <code>number::UInt16</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23871" target="_blank" rel="noopener noreferrer">#23871</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Make big integers production ready. Add support for <code>UInt128</code> data type. Fix known issues with the <code>Decimal256</code> data type. Support big integers in dictionaries. Support <code>gcd</code>/<code>lcm</code> functions for big integers. Support big integers in array search and conditional functions. Support <code>LowCardinality(UUID)</code>. Support big integers in <code>generateRandom</code> table function and <code>clickhouse-obfuscator</code>. Fix error with returning <code>UUID</code> from scalar subqueries. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7834" target="_blank" rel="noopener noreferrer">#7834</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23936" target="_blank" rel="noopener noreferrer">#23936</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4176" target="_blank" rel="noopener noreferrer">#4176</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24018" target="_blank" rel="noopener noreferrer">#24018</a>. Backward incompatible change: values of <code>UUID</code> type cannot be compared with integer. For example, instead of writing <code>uuid != 0</code> type <code>uuid != &#x27;00000000-0000-0000-0000-000000000000&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23631" target="_blank" rel="noopener noreferrer">#23631</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support <code>Array</code> data type for inserting and selecting data in <code>Arrow</code>, <code>Parquet</code> and <code>ORC</code> formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/21770" target="_blank" rel="noopener noreferrer">#21770</a> (<a href="https://github.com/taylor12805" target="_blank" rel="noopener noreferrer">taylor12805</a>).</li><li>Implement table comments. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23225" target="_blank" rel="noopener noreferrer">#23225</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23548" target="_blank" rel="noopener noreferrer">#23548</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Support creating dictionaries with DDL queries in <code>clickhouse-local</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22354" target="_blank" rel="noopener noreferrer">#22354</a>. Added support for <code>DETACH DICTIONARY PERMANENTLY</code>. Added support for <code>EXCHANGE DICTIONARIES</code> for <code>Atomic</code> database engine. Added support for moving dictionaries between databases using <code>RENAME DICTIONARY</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23436" target="_blank" rel="noopener noreferrer">#23436</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add aggregate function <code>uniqTheta</code> to support <a href="https://datasketches.apache.org/docs/Theta/ThetaSketchFramework.html" target="_blank" rel="noopener noreferrer">Theta Sketch</a> in ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/23894" target="_blank" rel="noopener noreferrer">#23894</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22609" target="_blank" rel="noopener noreferrer">#22609</a> (<a href="https://github.com/pingyu" target="_blank" rel="noopener noreferrer">Ping Yu</a>).</li><li>Add function <code>splitByRegexp</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24077" target="_blank" rel="noopener noreferrer">#24077</a> (<a href="https://github.com/abel-cheng" target="_blank" rel="noopener noreferrer">abel-cheng</a>).</li><li>Add function <code>arrayProduct</code> which accept an array as the parameter, and return the product of all the elements in array. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21613" target="_blank" rel="noopener noreferrer">#21613</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23782" target="_blank" rel="noopener noreferrer">#23782</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add <code>thread_name</code> column in <code>system.stack_trace</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23256" target="_blank" rel="noopener noreferrer">#23256</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24124" target="_blank" rel="noopener noreferrer">#24124</a> (<a href="https://github.com/abel-cheng" target="_blank" rel="noopener noreferrer">abel-cheng</a>).</li><li>If <code>insert_null_as_default</code> = 1, insert default values instead of NULL in <code>INSERT ... SELECT</code> and <code>INSERT ... SELECT ... UNION ALL ...</code> queries. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22832" target="_blank" rel="noopener noreferrer">#22832</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23524" target="_blank" rel="noopener noreferrer">#23524</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add support for progress indication in <code>clickhouse-local</code> with <code>--progress</code> option. <a href="https://github.com/ClickHouse/ClickHouse/pull/23196" target="_blank" rel="noopener noreferrer">#23196</a> (<a href="https://github.com/Amesaru" target="_blank" rel="noopener noreferrer">Egor Savin</a>).</li><li>Add support for HTTP compression (determined by <code>Content-Encoding</code> HTTP header) in <code>http</code> dictionary source. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8912" target="_blank" rel="noopener noreferrer">#8912</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23946" target="_blank" rel="noopener noreferrer">#23946</a> (<a href="https://github.com/FArthur-cmd" target="_blank" rel="noopener noreferrer">FArthur-cmd</a>).</li><li>Added <code>SYSTEM QUERY RELOAD MODEL</code>, <code>SYSTEM QUERY RELOAD MODELS</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18722" target="_blank" rel="noopener noreferrer">#18722</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23182" target="_blank" rel="noopener noreferrer">#23182</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add setting <code>json</code> (boolean, 0 by default) for <code>EXPLAIN PLAN</code> query. When enabled, query output will be a single <code>JSON</code> row. It is recommended to use <code>TSVRaw</code> format to avoid unnecessary escaping. <a href="https://github.com/ClickHouse/ClickHouse/pull/23082" target="_blank" rel="noopener noreferrer">#23082</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Add setting <code>indexes</code> (boolean, disabled by default) to <code>EXPLAIN PIPELINE</code> query. When enabled, shows used indexes, number of filtered parts and granules for every index applied. Supported for <code>MergeTree*</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/22352" target="_blank" rel="noopener noreferrer">#22352</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>LDAP: implemented user DN detection functionality to use when mapping Active Directory groups to ClickHouse roles. <a href="https://github.com/ClickHouse/ClickHouse/pull/22228" target="_blank" rel="noopener noreferrer">#22228</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>New aggregate function <code>deltaSumTimestamp</code> for summing the difference between consecutive rows while maintaining ordering during merge by storing timestamps. <a href="https://github.com/ClickHouse/ClickHouse/pull/21888" target="_blank" rel="noopener noreferrer">#21888</a> (<a href="https://github.com/rf" target="_blank" rel="noopener noreferrer">Russ Frank</a>).</li><li>Added less secure IMDS credentials provider for S3 which works under docker correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/21852" target="_blank" rel="noopener noreferrer">#21852</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Add back <code>indexHint</code> function. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/21238" target="_blank" rel="noopener noreferrer">#21238</a>. This reverts <a href="https://github.com/ClickHouse/ClickHouse/pull/9542" target="_blank" rel="noopener noreferrer">#9542</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9540" target="_blank" rel="noopener noreferrer">#9540</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21304" target="_blank" rel="noopener noreferrer">#21304</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-5">Experimental Feature<a class="hash-link" href="#experimental-feature-5" title="Direct link to heading">​</a></h4><ul><li>Add <code>PROJECTION</code> support for <code>MergeTree*</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/20202" target="_blank" rel="noopener noreferrer">#20202</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-5">Performance Improvement<a class="hash-link" href="#performance-improvement-5" title="Direct link to heading">​</a></h4><ul><li>Enable <code>compile_expressions</code> setting by default. When this setting enabled, compositions of simple functions and operators will be compiled to native code with LLVM at runtime. <a href="https://github.com/ClickHouse/ClickHouse/pull/8482" target="_blank" rel="noopener noreferrer">#8482</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>, <a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>). Note: if you feel in trouble, turn this option off.</li><li>Update <code>re2</code> library. Performance of regular expressions matching is improved. Also this PR adds compatibility with gcc-11. <a href="https://github.com/ClickHouse/ClickHouse/pull/24196" target="_blank" rel="noopener noreferrer">#24196</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>).</li><li>ORC input format reading by stripe instead of reading entire table into memory by once which is cost memory when file size is huge. <a href="https://github.com/ClickHouse/ClickHouse/pull/23102" target="_blank" rel="noopener noreferrer">#23102</a> (<a href="https://github.com/godliness" target="_blank" rel="noopener noreferrer">Chao Ma</a>).</li><li>Fusion of aggregate functions <code>sum</code>, <code>count</code> and <code>avg</code> in a query into single aggregate function. The optimization is controlled with the <code>optimize_fuse_sum_count_avg</code> setting. This is implemented with a new aggregate function <code>sumCount</code>. This function returns a tuple of two fields: <code>sum</code> and <code>count</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21337" target="_blank" rel="noopener noreferrer">#21337</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Update <code>zstd</code> to v1.5.0. The performance of compression is improved for single digits percentage. <a href="https://github.com/ClickHouse/ClickHouse/pull/24135" target="_blank" rel="noopener noreferrer">#24135</a> (<a href="https://github.com/Algunenano" target="_blank" rel="noopener noreferrer">Raúl Marín</a>). Note: you may get messages about &quot;checksum does not match&quot; in replication. These messages are expected due to update of compression algorithm and you can ignore them.</li><li>Improved performance of <code>Buffer</code> tables: do not acquire lock for total_bytes/total_rows for <code>Buffer</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/24066" target="_blank" rel="noopener noreferrer">#24066</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Preallocate support for hashed/sparse_hashed dictionaries is returned. <a href="https://github.com/ClickHouse/ClickHouse/pull/23979" target="_blank" rel="noopener noreferrer">#23979</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Enable <code>async_socket_for_remote</code> by default (lower amount of threads in querying Distributed tables with large fanout). <a href="https://github.com/ClickHouse/ClickHouse/pull/23683" target="_blank" rel="noopener noreferrer">#23683</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-5">Improvement<a class="hash-link" href="#improvement-5" title="Direct link to heading">​</a></h4><ul><li>Add <code>_partition_value</code> virtual column to MergeTree table family. It can be used to prune partition in a deterministic way. It&#x27;s needed to implement partition matcher for mutations. <a href="https://github.com/ClickHouse/ClickHouse/pull/23673" target="_blank" rel="noopener noreferrer">#23673</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added <code>region</code> parameter for S3 storage and disk. <a href="https://github.com/ClickHouse/ClickHouse/pull/23846" target="_blank" rel="noopener noreferrer">#23846</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Allow configuring different log levels for different logging channels. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19569" target="_blank" rel="noopener noreferrer">#19569</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23857" target="_blank" rel="noopener noreferrer">#23857</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Keep default timezone on <code>DateTime</code> operations if it was not provided explicitly. For example, if you add one second to a value of <code>DateTime</code> type without timezone it will remain <code>DateTime</code> without timezone. In previous versions the value of default timezone was placed to the returned data type explicitly so it becomes DateTime(&#x27;something&#x27;). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/4854" target="_blank" rel="noopener noreferrer">#4854</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23392" target="_blank" rel="noopener noreferrer">#23392</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow user to specify empty string instead of database name for <code>MySQL</code> storage. Default database will be used for queries. In previous versions it was working for SELECT queries and not support for INSERT was also added. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19281" target="_blank" rel="noopener noreferrer">#19281</a>. This can be useful working with <code>Sphinx</code> or other MySQL-compatible foreign databases. <a href="https://github.com/ClickHouse/ClickHouse/pull/23319" target="_blank" rel="noopener noreferrer">#23319</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>quantile(s)TDigest</code>. Added special handling of singleton centroids according to tdunning/t-digest 3.2+. Also a bug with over-compression of centroids in implementation of earlier version of the algorithm was fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/23314" target="_blank" rel="noopener noreferrer">#23314</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Function <code>now64</code> now supports optional timezone argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/24091" target="_blank" rel="noopener noreferrer">#24091</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fix the case when a progress bar in interactive mode in clickhouse-client that appear in the middle of the data may rewrite some parts of visible data in terminal. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19283" target="_blank" rel="noopener noreferrer">#19283</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23050" target="_blank" rel="noopener noreferrer">#23050</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash when memory allocation fails in simdjson. <a href="https://github.com/simdjson/simdjson/pull/1567" target="_blank" rel="noopener noreferrer">https://github.com/simdjson/simdjson/pull/1567</a> . Mark as improvement because it&#x27;s a very rare bug. <a href="https://github.com/ClickHouse/ClickHouse/pull/24147" target="_blank" rel="noopener noreferrer">#24147</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Preserve dictionaries until storage shutdown (this will avoid possible <code>external dictionary &#x27;DICT&#x27; not found</code> errors at server shutdown during final flush of the <code>Buffer</code> engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/24068" target="_blank" rel="noopener noreferrer">#24068</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Flush <code>Buffer</code> tables before shutting down tables (within one database), to avoid discarding blocks due to underlying table had been already detached (and <code>Destination table default.a_data_01870 doesn&#x27;t exist. Block of data is discarded</code> error in the log). <a href="https://github.com/ClickHouse/ClickHouse/pull/24067" target="_blank" rel="noopener noreferrer">#24067</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Now <code>prefer_column_name_to_alias = 1</code> will also favor column names for <code>group by</code>, <code>having</code> and <code>order by</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23882" target="_blank" rel="noopener noreferrer">#23882</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24022" target="_blank" rel="noopener noreferrer">#24022</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add support for <code>ORDER BY WITH FILL</code> with <code>DateTime64</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24016" target="_blank" rel="noopener noreferrer">#24016</a> (<a href="https://github.com/MaxWk" target="_blank" rel="noopener noreferrer">kevin wan</a>).</li><li>Enable <code>DateTime64</code> to be a version column in <code>ReplacingMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23992" target="_blank" rel="noopener noreferrer">#23992</a> (<a href="https://github.com/MaxWk" target="_blank" rel="noopener noreferrer">kevin wan</a>).</li><li>Log information about OS name, kernel version and CPU architecture on server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/23988" target="_blank" rel="noopener noreferrer">#23988</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Support specifying table schema for <code>postgresql</code> dictionary source. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23958" target="_blank" rel="noopener noreferrer">#23958</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23980" target="_blank" rel="noopener noreferrer">#23980</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add hints for names of <code>Enum</code> elements (suggest names in case of typos). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17112" target="_blank" rel="noopener noreferrer">#17112</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23919" target="_blank" rel="noopener noreferrer">#23919</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Measure found rate (the percentage for which the value was found) for dictionaries (see <code>found_rate</code> in <code>system.dictionaries</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/23916" target="_blank" rel="noopener noreferrer">#23916</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow to add specific queue settings via table settng <code>rabbitmq_queue_settings_list</code>. (Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23737" target="_blank" rel="noopener noreferrer">#23737</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/23918" target="_blank" rel="noopener noreferrer">#23918</a>). Allow user to control all RabbitMQ setup: if table setting <code>rabbitmq_queue_consume</code> is set to <code>1</code> - RabbitMQ table engine will only connect to specified queue and will not perform any RabbitMQ consumer-side setup like declaring exchange, queues, bindings. (Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21757" target="_blank" rel="noopener noreferrer">#21757</a>). Add proper cleanup when RabbitMQ table is dropped - delete queues, which the table has declared and all bound exchanges - if they were created by the table. <a href="https://github.com/ClickHouse/ClickHouse/pull/23887" target="_blank" rel="noopener noreferrer">#23887</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add <code>broken_data_files</code>/<code>broken_data_compressed_bytes</code> into <code>system.distribution_queue</code>. Add metric for number of files for asynchronous insertion into Distributed tables that has been marked as broken (<code>BrokenDistributedFilesToInsert</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/23885" target="_blank" rel="noopener noreferrer">#23885</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Querying <code>system.tables</code> does not go to ZooKeeper anymore. <a href="https://github.com/ClickHouse/ClickHouse/pull/23793" target="_blank" rel="noopener noreferrer">#23793</a> (<a href="https://github.com/fuwhu" target="_blank" rel="noopener noreferrer">Fuwang Hu</a>).</li><li>Respect <code>lock_acquire_timeout_for_background_operations</code> for <code>OPTIMIZE</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/23623" target="_blank" rel="noopener noreferrer">#23623</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Possibility to change <code>S3</code> disk settings in runtime via new <code>SYSTEM RESTART DISK</code> SQL command. <a href="https://github.com/ClickHouse/ClickHouse/pull/23429" target="_blank" rel="noopener noreferrer">#23429</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>If user applied a misconfiguration by mistakenly setting <code>max_distributed_connections</code> to value zero, every query to a <code>Distributed</code> table will throw exception with a message containing &quot;logical error&quot;. But it&#x27;s really an expected behaviour, not a logical error, so the exception message was slightly incorrect. It also triggered checks in our CI enviroment that ensures that no logical errors ever happen. Instead we will treat <code>max_distributed_connections</code> misconfigured to zero as the minimum possible value (one). <a href="https://github.com/ClickHouse/ClickHouse/pull/23348" target="_blank" rel="noopener noreferrer">#23348</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Disable <code>min_bytes_to_use_mmap_io</code> by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/23322" target="_blank" rel="noopener noreferrer">#23322</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Support <code>LowCardinality</code> nullability with <code>join_use_nulls</code>, close <a href="https://github.com/ClickHouse/ClickHouse/issues/15101" target="_blank" rel="noopener noreferrer">#15101</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23237" target="_blank" rel="noopener noreferrer">#23237</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Added possibility to restore <code>MergeTree</code> parts to <code>detached</code> directory for <code>S3</code> disk. <a href="https://github.com/ClickHouse/ClickHouse/pull/23112" target="_blank" rel="noopener noreferrer">#23112</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Retries on HTTP connection drops in S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/22988" target="_blank" rel="noopener noreferrer">#22988</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Add settings <code>external_storage_max_read_rows</code> and <code>external_storage_max_read_rows</code> for MySQL table engine, dictionary source and MaterializeMySQL minor data fetches. <a href="https://github.com/ClickHouse/ClickHouse/pull/22697" target="_blank" rel="noopener noreferrer">#22697</a> (<a href="https://github.com/TCeason" target="_blank" rel="noopener noreferrer">TCeason</a>).</li><li><code>MaterializeMySQL</code> (experimental feature): Previously, MySQL 5.7.9 was not supported due to SQL incompatibility. Now leave MySQL parameter verification to the MaterializeMySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/23413" target="_blank" rel="noopener noreferrer">#23413</a> (<a href="https://github.com/TCeason" target="_blank" rel="noopener noreferrer">TCeason</a>).</li><li>Enable reading of subcolumns for distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/24472" target="_blank" rel="noopener noreferrer">#24472</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix usage of tuples in <code>CREATE .. AS SELECT</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/24464" target="_blank" rel="noopener noreferrer">#24464</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Support for <code>Parquet</code> format in <code>Kafka</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/23412" target="_blank" rel="noopener noreferrer">#23412</a> (<a href="https://github.com/godliness" target="_blank" rel="noopener noreferrer">Chao Ma</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-4">Bug Fix<a class="hash-link" href="#bug-fix-4" title="Direct link to heading">​</a></h4><ul><li>Use old modulo function version when used in partition key and primary key. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23508" target="_blank" rel="noopener noreferrer">#23508</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24157" target="_blank" rel="noopener noreferrer">#24157</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>). It was a source of backward incompatibility in previous releases.</li><li>Fixed the behavior when query <code>SYSTEM RESTART REPLICA</code> or <code>SYSTEM SYNC REPLICA</code> is being processed infinitely. This was detected on server with extremely little amount of RAM. <a href="https://github.com/ClickHouse/ClickHouse/pull/24457" target="_blank" rel="noopener noreferrer">#24457</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix incorrect monotonicity of <code>toWeek</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24422" target="_blank" rel="noopener noreferrer">#24422</a> . This bug was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/5212" target="_blank" rel="noopener noreferrer">#5212</a>, and was exposed later by smarter partition pruner. <a href="https://github.com/ClickHouse/ClickHouse/pull/24446" target="_blank" rel="noopener noreferrer">#24446</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix drop partition with intersect fake parts. In rare cases there might be parts with mutation version greater than current block number. <a href="https://github.com/ClickHouse/ClickHouse/pull/24321" target="_blank" rel="noopener noreferrer">#24321</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed a bug in moving Materialized View from Ordinary to Atomic database (<code>RENAME TABLE</code> query). Now inner table is moved to new database together with Materialized View. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23926" target="_blank" rel="noopener noreferrer">#23926</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24309" target="_blank" rel="noopener noreferrer">#24309</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Allow empty HTTP headers in client requests. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23901" target="_blank" rel="noopener noreferrer">#23901</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24285" target="_blank" rel="noopener noreferrer">#24285</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Set <code>max_threads = 1</code> to fix mutation fail of <code>Memory</code> tables. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24274" target="_blank" rel="noopener noreferrer">#24274</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24275" target="_blank" rel="noopener noreferrer">#24275</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Fix typo in implementation of <code>Memory</code> tables, this bug was introduced at <a href="https://github.com/ClickHouse/ClickHouse/issues/15127" target="_blank" rel="noopener noreferrer">#15127</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24192" target="_blank" rel="noopener noreferrer">#24192</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24193" target="_blank" rel="noopener noreferrer">#24193</a> (<a href="https://github.com/plugine" target="_blank" rel="noopener noreferrer">张中南</a>).</li><li>Fix abnormal server termination due to <code>HDFS</code> becoming not accessible during query execution. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24117" target="_blank" rel="noopener noreferrer">#24117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24191" target="_blank" rel="noopener noreferrer">#24191</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix crash on updating of <code>Nested</code> column with const condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/24183" target="_blank" rel="noopener noreferrer">#24183</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix race condition which could happen in RBAC under a heavy load. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/24090" target="_blank" rel="noopener noreferrer">#24090</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/24134" target="_blank" rel="noopener noreferrer">#24134</a>,. <a href="https://github.com/ClickHouse/ClickHouse/pull/24176" target="_blank" rel="noopener noreferrer">#24176</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix a rare bug that could lead to a partially initialized table that can serve write requests (insert/alter/so on). Now such tables will be in readonly mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/24122" target="_blank" rel="noopener noreferrer">#24122</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix an issue: <code>EXPLAIN PIPELINE</code> with <code>SELECT xxx FINAL</code> showed a wrong pipeline. (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fixed using const <code>DateTime</code> value vs <code>DateTime64</code> column in <code>WHERE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24100" target="_blank" rel="noopener noreferrer">#24100</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fix crash in merge JOIN, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/24010" target="_blank" rel="noopener noreferrer">#24010</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/24013" target="_blank" rel="noopener noreferrer">#24013</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Some <code>ALTER PARTITION</code> queries might cause <code>Part A intersects previous part B</code> and <code>Unexpected merged part C intersecting drop range D</code> errors in replication queue. It&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23296" target="_blank" rel="noopener noreferrer">#23296</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23997" target="_blank" rel="noopener noreferrer">#23997</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix SIGSEGV for external GROUP BY and overflow row (i.e. queries like <code>SELECT FROM GROUP BY WITH TOTALS SETTINGS max_bytes_before_external_group_by&gt;0, max_rows_to_group_by&gt;0, group_by_overflow_mode=&#x27;any&#x27;, totals_mode=&#x27;before_having&#x27;</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/23962" target="_blank" rel="noopener noreferrer">#23962</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix keys metrics accounting for <code>CACHE</code> dictionary with duplicates in the source (leads to <code>DictCacheKeysRequestedMiss</code> overflows). <a href="https://github.com/ClickHouse/ClickHouse/pull/23929" target="_blank" rel="noopener noreferrer">#23929</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix implementation of connection pool of <code>PostgreSQL</code> engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23897" target="_blank" rel="noopener noreferrer">#23897</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23909" target="_blank" rel="noopener noreferrer">#23909</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix <code>distributed_group_by_no_merge = 2</code> with <code>GROUP BY</code> and aggregate function wrapped into regular function (had been broken in <a href="https://github.com/ClickHouse/ClickHouse/issues/23546" target="_blank" rel="noopener noreferrer">#23546</a>). Throw exception in case of someone trying to use <code>distributed_group_by_no_merge = 2</code> with window functions. Disable <code>optimize_distributed_group_by_sharding_key</code> for queries with window functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/23906" target="_blank" rel="noopener noreferrer">#23906</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>A fix for <code>s3</code> table function: better handling of HTTP errors. Response bodies of HTTP errors were being ignored earlier. <a href="https://github.com/ClickHouse/ClickHouse/pull/23844" target="_blank" rel="noopener noreferrer">#23844</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>A fix for <code>s3</code> table function: better handling of URI&#x27;s. Fixed an incompatibility with URLs containing <code>+</code> symbol, data with such keys could not be read previously. <a href="https://github.com/ClickHouse/ClickHouse/pull/23822" target="_blank" rel="noopener noreferrer">#23822</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fix error <code>Can&#x27;t initialize pipeline with empty pipe</code> for queries with <code>GLOBAL IN/JOIN</code> and <code>use_hedged_requests</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23431" target="_blank" rel="noopener noreferrer">#23431</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23805" target="_blank" rel="noopener noreferrer">#23805</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix <code>CLEAR COLUMN</code> does not work when it is referenced by materialized view. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/23764" target="_blank" rel="noopener noreferrer">#23764</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23781" target="_blank" rel="noopener noreferrer">#23781</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Fix heap use after free when reading from HDFS if <code>Values</code> format is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/23761" target="_blank" rel="noopener noreferrer">#23761</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Avoid possible &quot;Cannot schedule a task&quot; error (in case some exception had been occurred) on INSERT into Distributed. <a href="https://github.com/ClickHouse/ClickHouse/pull/23744" target="_blank" rel="noopener noreferrer">#23744</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed a bug in recovery of staled <code>ReplicatedMergeTree</code> replica. Some metadata updates could be ignored by staled replica if <code>ALTER</code> query was executed during downtime of the replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/23742" target="_blank" rel="noopener noreferrer">#23742</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix a bug with <code>Join</code> and <code>WITH TOTALS</code>, close <a href="https://github.com/ClickHouse/ClickHouse/issues/17718" target="_blank" rel="noopener noreferrer">#17718</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23549" target="_blank" rel="noopener noreferrer">#23549</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Fix possible <code>Block structure mismatch</code> error for queries with <code>UNION</code> which could possibly happen after filter-pushdown optimization. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23029" target="_blank" rel="noopener noreferrer">#23029</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23359" target="_blank" rel="noopener noreferrer">#23359</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Add type conversion when the setting <code>optimize_skip_unused_shards_rewrite_in</code> is enabled. This fixes MSan report. <a href="https://github.com/ClickHouse/ClickHouse/pull/23219" target="_blank" rel="noopener noreferrer">#23219</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add a missing check when updating nested subcolumns, close issue: <a href="https://github.com/ClickHouse/ClickHouse/issues/22353" target="_blank" rel="noopener noreferrer">#22353</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22503" target="_blank" rel="noopener noreferrer">#22503</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-5">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-5" title="Direct link to heading">​</a></h4><ul><li>Support building on Illumos. <a href="https://github.com/ClickHouse/ClickHouse/pull/24144" target="_blank" rel="noopener noreferrer">#24144</a>. Adds support for building on Solaris-derived operating systems. <a href="https://github.com/ClickHouse/ClickHouse/pull/23746" target="_blank" rel="noopener noreferrer">#23746</a> (<a href="https://github.com/bnaecker" target="_blank" rel="noopener noreferrer">bnaecker</a>).</li><li>Add more benchmarks for hash tables, including the Swiss Table from Google (that appeared to be slower than ClickHouse hash map in our specific usage scenario). <a href="https://github.com/ClickHouse/ClickHouse/pull/24111" target="_blank" rel="noopener noreferrer">#24111</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Update librdkafka 1.6.0-RC3 to 1.6.1. <a href="https://github.com/ClickHouse/ClickHouse/pull/23874" target="_blank" rel="noopener noreferrer">#23874</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Always enable <code>asynchronous-unwind-tables</code> explicitly. It may fix query profiler on AArch64. <a href="https://github.com/ClickHouse/ClickHouse/pull/23602" target="_blank" rel="noopener noreferrer">#23602</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Avoid possible build dependency on locale and filesystem order. This allows reproducible builds. <a href="https://github.com/ClickHouse/ClickHouse/pull/23600" target="_blank" rel="noopener noreferrer">#23600</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove a source of nondeterminism from build. Now builds at different point of time will produce byte-identical binaries. Partially addressed <a href="https://github.com/ClickHouse/ClickHouse/issues/22113" target="_blank" rel="noopener noreferrer">#22113</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23559" target="_blank" rel="noopener noreferrer">#23559</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add simple tool for benchmarking (Zoo)Keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/23038" target="_blank" rel="noopener noreferrer">#23038</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-215-2021-05-20">ClickHouse release 21.5, 2021-05-20<a class="hash-link" href="#clickhouse-release-215-2021-05-20" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-6">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-6" title="Direct link to heading">​</a></h4><ul><li>Change comparison of integers and floating point numbers when integer is not exactly representable in the floating point data type. In new version comparison will return false as the rounding error will occur. Example: <code>9223372036854775808.0 != 9223372036854775808</code>, because the number <code>9223372036854775808</code> is not representable as floating point number exactly (and <code>9223372036854775808.0</code> is rounded to <code>9223372036854776000.0</code>). But in previous version the comparison will return as the numbers are equal, because if the floating point number <code>9223372036854776000.0</code> get converted back to UInt64, it will yield <code>9223372036854775808</code>. For the reference, the Python programming language also treats these numbers as equal. But this behaviour was dependend on CPU model (different results on AMD64 and AArch64 for some out-of-range numbers), so we make the comparison more precise. It will treat int and float numbers equal only if int is represented in floating point type exactly. <a href="https://github.com/ClickHouse/ClickHouse/pull/22595" target="_blank" rel="noopener noreferrer">#22595</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove support for <code>argMin</code> and <code>argMax</code> for single <code>Tuple</code> argument. The code was not memory-safe. The feature was added by mistake and it is confusing for people. These functions can be reintroduced under different names later. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22384" target="_blank" rel="noopener noreferrer">#22384</a> and reverts <a href="https://github.com/ClickHouse/ClickHouse/issues/17359" target="_blank" rel="noopener noreferrer">#17359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23393" target="_blank" rel="noopener noreferrer">#23393</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-6">New Feature<a class="hash-link" href="#new-feature-6" title="Direct link to heading">​</a></h4><ul><li>Added functions <code>dictGetChildren(dictionary, key)</code>, <code>dictGetDescendants(dictionary, key, level)</code>. Function <code>dictGetChildren</code> return all children as an array if indexes. It is a inverse transformation for <code>dictGetHierarchy</code>. Function <code>dictGetDescendants</code> return all descendants as if <code>dictGetChildren</code> was applied <code>level</code> times recursively. Zero <code>level</code> value is equivalent to infinity. Improved performance of <code>dictGetHierarchy</code>, <code>dictIsIn</code> functions. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14656" target="_blank" rel="noopener noreferrer">#14656</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22096" target="_blank" rel="noopener noreferrer">#22096</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added function <code>dictGetOrNull</code>. It works like <code>dictGet</code>, but return <code>Null</code> in case key was not found in dictionary. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22375" target="_blank" rel="noopener noreferrer">#22375</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22413" target="_blank" rel="noopener noreferrer">#22413</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added a table function <code>s3Cluster</code>, which allows to process files from <code>s3</code> in parallel on every node of a specified cluster. <a href="https://github.com/ClickHouse/ClickHouse/pull/22012" target="_blank" rel="noopener noreferrer">#22012</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Added support for replicas and shards in MySQL/PostgreSQL table engine / table function. You can write <code>SELECT * FROM mysql(&#x27;host{1,2}-{1|2}&#x27;, ...)</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20969" target="_blank" rel="noopener noreferrer">#20969</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22217" target="_blank" rel="noopener noreferrer">#22217</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Added <code>ALTER TABLE ... FETCH PART ...</code> query. It&#x27;s similar to <code>FETCH PARTITION</code>, but fetches only one part. <a href="https://github.com/ClickHouse/ClickHouse/pull/22706" target="_blank" rel="noopener noreferrer">#22706</a> (<a href="https://github.com/songenjie" target="_blank" rel="noopener noreferrer">turbo jason</a>).</li><li>Added a setting <code>max_distributed_depth</code> that limits the depth of recursive queries to <code>Distributed</code> tables. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20229" target="_blank" rel="noopener noreferrer">#20229</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21942" target="_blank" rel="noopener noreferrer">#21942</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-6">Performance Improvement<a class="hash-link" href="#performance-improvement-6" title="Direct link to heading">​</a></h4><ul><li>Improved performance of <code>intDiv</code> by dynamic dispatch for AVX2. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22314" target="_blank" rel="noopener noreferrer">#22314</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23000" target="_blank" rel="noopener noreferrer">#23000</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improved performance of reading from <code>ArrowStream</code> input format for sources other then local file (e.g. URL). <a href="https://github.com/ClickHouse/ClickHouse/pull/22673" target="_blank" rel="noopener noreferrer">#22673</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Disabled compression by default when interacting with localhost (with clickhouse-client or server to server with distributed queries) via native protocol. It may improve performance of some import/export operations. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22234" target="_blank" rel="noopener noreferrer">#22234</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22237" target="_blank" rel="noopener noreferrer">#22237</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Exclude values that does not belong to the shard from right part of IN section for distributed queries (under <code>optimize_skip_unused_shards_rewrite_in</code>, enabled by default, since it still requires <code>optimize_skip_unused_shards</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/21511" target="_blank" rel="noopener noreferrer">#21511</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improved performance of reading a subset of columns with File-like table engine and column-oriented format like Parquet, Arrow or ORC. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20129" target="_blank" rel="noopener noreferrer">#issue:20129</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21302" target="_blank" rel="noopener noreferrer">#21302</a> (<a href="https://github.com/keen-wolf" target="_blank" rel="noopener noreferrer">keenwolf</a>).</li><li>Allow to move more conditions to <code>PREWHERE</code> as it was before version 21.1 (adjustment of internal heuristics). Insufficient number of moved condtions could lead to worse performance. <a href="https://github.com/ClickHouse/ClickHouse/pull/23397" target="_blank" rel="noopener noreferrer">#23397</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Improved performance of ODBC connections and fixed all the outstanding issues from the backlog. Using <code>nanodbc</code> library instead of <code>Poco::ODBC</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9678" target="_blank" rel="noopener noreferrer">#9678</a>. Add support for DateTime64 and Decimal* for ODBC table engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21961" target="_blank" rel="noopener noreferrer">#21961</a>. Fixed issue with cyrillic text being truncated. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16246" target="_blank" rel="noopener noreferrer">#16246</a>. Added connection pools for odbc bridge. <a href="https://github.com/ClickHouse/ClickHouse/pull/21972" target="_blank" rel="noopener noreferrer">#21972</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-6">Improvement<a class="hash-link" href="#improvement-6" title="Direct link to heading">​</a></h4><ul><li>Increase <code>max_uri_size</code> (the maximum size of URL in HTTP interface) to 1 MiB by default. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21197" target="_blank" rel="noopener noreferrer">#21197</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22997" target="_blank" rel="noopener noreferrer">#22997</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Set <code>background_fetches_pool_size</code> to <code>8</code> that is better for production usage with frequent small insertions or slow ZooKeeper cluster. <a href="https://github.com/ClickHouse/ClickHouse/pull/22945" target="_blank" rel="noopener noreferrer">#22945</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>FlatDictionary added <code>initial_array_size</code>, <code>max_array_size</code> options. <a href="https://github.com/ClickHouse/ClickHouse/pull/22521" target="_blank" rel="noopener noreferrer">#22521</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add new setting <code>non_replicated_deduplication_window</code> for non-replicated MergeTree inserts deduplication. <a href="https://github.com/ClickHouse/ClickHouse/pull/22514" target="_blank" rel="noopener noreferrer">#22514</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Update paths to the <code>CatBoost</code> model configs in config reloading. <a href="https://github.com/ClickHouse/ClickHouse/pull/22434" target="_blank" rel="noopener noreferrer">#22434</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Added <code>Decimal256</code> type support in dictionaries. <code>Decimal256</code> is experimental feature. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20979" target="_blank" rel="noopener noreferrer">#20979</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22960" target="_blank" rel="noopener noreferrer">#22960</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Enabled <code>async_socket_for_remote</code> by default (using less amount of OS threads for distributed queries). <a href="https://github.com/ClickHouse/ClickHouse/pull/23683" target="_blank" rel="noopener noreferrer">#23683</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed <code>quantile(s)TDigest</code>. Added special handling of singleton centroids according to tdunning/t-digest 3.2+. Also a bug with over-compression of centroids in implementation of earlier version of the algorithm was fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/23314" target="_blank" rel="noopener noreferrer">#23314</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Make function name <code>unhex</code> case insensitive for compatibility with MySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/23229" target="_blank" rel="noopener noreferrer">#23229</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Implement functions <code>arrayHasAny</code>, <code>arrayHasAll</code>, <code>has</code>, <code>indexOf</code>, <code>countEqual</code> for generic case when types of array elements are different. In previous versions the functions <code>arrayHasAny</code>, <code>arrayHasAll</code> returned false and <code>has</code>, <code>indexOf</code>, <code>countEqual</code> thrown exception. Also add support for <code>Decimal</code> and big integer types in functions <code>has</code> and similar. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20272" target="_blank" rel="noopener noreferrer">#20272</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23044" target="_blank" rel="noopener noreferrer">#23044</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Raised the threshold on max number of matches in result of the function <code>extractAllGroupsHorizontal</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23036" target="_blank" rel="noopener noreferrer">#23036</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Do not perform <code>optimize_skip_unused_shards</code> for cluster with one node. <a href="https://github.com/ClickHouse/ClickHouse/pull/22999" target="_blank" rel="noopener noreferrer">#22999</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added ability to run clickhouse-keeper (experimental drop-in replacement to ZooKeeper) with SSL. Config settings <code>keeper_server.tcp_port_secure</code> can be used for secure interaction between client and keeper-server. <code>keeper_server.raft_configuration.secure</code> can be used to enable internal secure communication between nodes. <a href="https://github.com/ClickHouse/ClickHouse/pull/22992" target="_blank" rel="noopener noreferrer">#22992</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Added ability to flush buffer only in background for <code>Buffer</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/22986" target="_blank" rel="noopener noreferrer">#22986</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>When selecting from MergeTree table with NULL in WHERE condition, in rare cases, exception was thrown. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20019" target="_blank" rel="noopener noreferrer">#20019</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22978" target="_blank" rel="noopener noreferrer">#22978</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix error handling in Poco HTTP Client for AWS. <a href="https://github.com/ClickHouse/ClickHouse/pull/22973" target="_blank" rel="noopener noreferrer">#22973</a> (<a href="https://github.com/kreuzerkrieg" target="_blank" rel="noopener noreferrer">kreuzerkrieg</a>).</li><li>Respect <code>max_part_removal_threads</code> for <code>ReplicatedMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22971" target="_blank" rel="noopener noreferrer">#22971</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix obscure corner case of MergeTree settings inactive_parts_to_throw_insert = 0 with inactive_parts_to_delay_insert &gt; 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/22947" target="_blank" rel="noopener noreferrer">#22947</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li><code>dateDiff</code> now works with <code>DateTime64</code> arguments (even for values outside of <code>DateTime</code> range) <a href="https://github.com/ClickHouse/ClickHouse/pull/22931" target="_blank" rel="noopener noreferrer">#22931</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>MaterializeMySQL (experimental feature): added an ability to replicate MySQL databases containing views without failing. This is accomplished by ignoring the views. <a href="https://github.com/ClickHouse/ClickHouse/pull/22760" target="_blank" rel="noopener noreferrer">#22760</a> (<a href="https://github.com/cfroystad" target="_blank" rel="noopener noreferrer">Christian</a>).</li><li>Allow RBAC row policy via postgresql protocol. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22658" target="_blank" rel="noopener noreferrer">#22658</a>. PostgreSQL protocol is enabled in configuration by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/22755" target="_blank" rel="noopener noreferrer">#22755</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Add metric to track how much time is spend during waiting for Buffer layer lock. <a href="https://github.com/ClickHouse/ClickHouse/pull/22725" target="_blank" rel="noopener noreferrer">#22725</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow to use CTE in VIEW definition. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22491" target="_blank" rel="noopener noreferrer">#22491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22657" target="_blank" rel="noopener noreferrer">#22657</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Clear the rest of the screen and show cursor in <code>clickhouse-client</code> if previous program has left garbage in terminal. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16518" target="_blank" rel="noopener noreferrer">#16518</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22634" target="_blank" rel="noopener noreferrer">#22634</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make <code>round</code> function to behave consistently on non-x86_64 platforms. Rounding half to nearest even (Banker&#x27;s rounding) is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/22582" target="_blank" rel="noopener noreferrer">#22582</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Correctly check structure of blocks of data that are sending by Distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/22325" target="_blank" rel="noopener noreferrer">#22325</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow publishing Kafka errors to a virtual column of Kafka engine, controlled by the <code>kafka_handle_error_mode</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/21850" target="_blank" rel="noopener noreferrer">#21850</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Add aliases <code>simpleJSONExtract/simpleJSONHas</code> to <code>visitParam/visitParamExtract{UInt, Int, Bool, Float, Raw, String}</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21383" target="_blank" rel="noopener noreferrer">#21383</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21519" target="_blank" rel="noopener noreferrer">#21519</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Add <code>clickhouse-library-bridge</code> for library dictionary source. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9502" target="_blank" rel="noopener noreferrer">#9502</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21509" target="_blank" rel="noopener noreferrer">#21509</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Forbid to drop a column if it&#x27;s referenced by materialized view. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21164" target="_blank" rel="noopener noreferrer">#21164</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21303" target="_blank" rel="noopener noreferrer">#21303</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Support dynamic interserver credentials (rotating credentials without downtime). <a href="https://github.com/ClickHouse/ClickHouse/pull/14113" target="_blank" rel="noopener noreferrer">#14113</a> (<a href="https://github.com/johnskopis" target="_blank" rel="noopener noreferrer">johnskopis</a>).</li><li>Add support for Kafka storage with <code>Arrow</code> and <code>ArrowStream</code> format messages. <a href="https://github.com/ClickHouse/ClickHouse/pull/23415" target="_blank" rel="noopener noreferrer">#23415</a> (<a href="https://github.com/godliness" target="_blank" rel="noopener noreferrer">Chao Ma</a>).</li><li>Fixed missing semicolon in exception message. The user may find this exception message unpleasant to read. <a href="https://github.com/ClickHouse/ClickHouse/pull/23208" target="_blank" rel="noopener noreferrer">#23208</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed missing whitespace in some exception messages about <code>LowCardinality</code> type. <a href="https://github.com/ClickHouse/ClickHouse/pull/23207" target="_blank" rel="noopener noreferrer">#23207</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Some values were formatted with alignment in center in table cells in <code>Markdown</code> format. Not anymore. <a href="https://github.com/ClickHouse/ClickHouse/pull/23096" target="_blank" rel="noopener noreferrer">#23096</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove non-essential details from suggestions in clickhouse-client. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22158" target="_blank" rel="noopener noreferrer">#22158</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23040" target="_blank" rel="noopener noreferrer">#23040</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Correct calculation of <code>bytes_allocated</code> field in system.dictionaries for sparse_hashed dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/22867" target="_blank" rel="noopener noreferrer">#22867</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed approximate total rows accounting for reverse reading from MergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/22726" target="_blank" rel="noopener noreferrer">#22726</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix the case when it was possible to configure dictionary with clickhouse source that was looking to itself that leads to infinite loop. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14314" target="_blank" rel="noopener noreferrer">#14314</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22479" target="_blank" rel="noopener noreferrer">#22479</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-5">Bug Fix<a class="hash-link" href="#bug-fix-5" title="Direct link to heading">​</a></h4><ul><li>Multiple fixes for hedged requests. Fixed an error <code>Can&#x27;t initialize pipeline with empty pipe</code> for queries with <code>GLOBAL IN/JOIN</code> when the setting <code>use_hedged_requests</code> is enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23431" target="_blank" rel="noopener noreferrer">#23431</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23805" target="_blank" rel="noopener noreferrer">#23805</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>). Fixed a race condition in hedged connections which leads to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22161" target="_blank" rel="noopener noreferrer">#22161</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22443" target="_blank" rel="noopener noreferrer">#22443</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). Fix possible crash in case if <code>unknown packet</code> was received from remote query (with <code>async_socket_for_remote</code> enabled). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21167" target="_blank" rel="noopener noreferrer">#21167</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23309" target="_blank" rel="noopener noreferrer">#23309</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed the behavior when disabling <code>input_format_with_names_use_header </code> setting discards all the input with CSVWithNames format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22406" target="_blank" rel="noopener noreferrer">#22406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23202" target="_blank" rel="noopener noreferrer">#23202</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed remote JDBC bridge timeout connection issue. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9609" target="_blank" rel="noopener noreferrer">#9609</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23771" target="_blank" rel="noopener noreferrer">#23771</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>, <a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix the logic of initial load of <code>complex_key_hashed</code> if <code>update_field</code> is specified. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/23800" target="_blank" rel="noopener noreferrer">#23800</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23824" target="_blank" rel="noopener noreferrer">#23824</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fixed crash when <code>PREWHERE</code> and row policy filter are both in effect with empty result. <a href="https://github.com/ClickHouse/ClickHouse/pull/23763" target="_blank" rel="noopener noreferrer">#23763</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Avoid possible &quot;Cannot schedule a task&quot; error (in case some exception had been occurred) on INSERT into Distributed. <a href="https://github.com/ClickHouse/ClickHouse/pull/23744" target="_blank" rel="noopener noreferrer">#23744</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added an exception in case of completely the same values in both samples in aggregate function <code>mannWhitneyUTest</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23646" target="_blank" rel="noopener noreferrer">#23646</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23654" target="_blank" rel="noopener noreferrer">#23654</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed server fault when inserting data through HTTP caused an exception. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23512" target="_blank" rel="noopener noreferrer">#23512</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23643" target="_blank" rel="noopener noreferrer">#23643</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed misinterpretation of some <code>LIKE</code> expressions with escape sequences. <a href="https://github.com/ClickHouse/ClickHouse/pull/23610" target="_blank" rel="noopener noreferrer">#23610</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed restart / stop command hanging. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20214" target="_blank" rel="noopener noreferrer">#20214</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23552" target="_blank" rel="noopener noreferrer">#23552</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed <code>COLUMNS</code> matcher in case of multiple JOINs in select query. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22736" target="_blank" rel="noopener noreferrer">#22736</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23501" target="_blank" rel="noopener noreferrer">#23501</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fixed a crash when modifying column&#x27;s default value when a column itself is used as <code>ReplacingMergeTree</code>&#x27;s parameter. <a href="https://github.com/ClickHouse/ClickHouse/pull/23483" target="_blank" rel="noopener noreferrer">#23483</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fixed corner cases in vertical merges with <code>ReplacingMergeTree</code>. In rare cases they could lead to fails of merges with exceptions like <code>Incomplete granules are not allowed while blocks are granules size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23459" target="_blank" rel="noopener noreferrer">#23459</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed bug that does not allow cast from empty array literal, to array with dimensions greater than 1, e.g. <code>CAST([] AS Array(Array(String)))</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14476" target="_blank" rel="noopener noreferrer">#14476</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23456" target="_blank" rel="noopener noreferrer">#23456</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fixed a bug when <code>deltaSum</code> aggregate function produced incorrect result after resetting the counter. <a href="https://github.com/ClickHouse/ClickHouse/pull/23437" target="_blank" rel="noopener noreferrer">#23437</a> (<a href="https://github.com/rf" target="_blank" rel="noopener noreferrer">Russ Frank</a>).</li><li>Fixed <code>Cannot unlink file</code> error on unsuccessful creation of ReplicatedMergeTree table with multidisk configuration. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21755" target="_blank" rel="noopener noreferrer">#21755</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23433" target="_blank" rel="noopener noreferrer">#23433</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed incompatible constant expression generation during partition pruning based on virtual columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/pull/21401#discussion_r611888913" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/21401#discussion_r611888913</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23366" target="_blank" rel="noopener noreferrer">#23366</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed a crash when setting join_algorithm is set to &#x27;auto&#x27; and Join is performed with a Dictionary. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/23002" target="_blank" rel="noopener noreferrer">#23002</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23312" target="_blank" rel="noopener noreferrer">#23312</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>Don&#x27;t relax NOT conditions during partition pruning. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23305" target="_blank" rel="noopener noreferrer">#23305</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/21539" target="_blank" rel="noopener noreferrer">#21539</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23310" target="_blank" rel="noopener noreferrer">#23310</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed very rare race condition on background cleanup of old blocks. It might cause a block not to be deduplicated if it&#x27;s too close to the end of deduplication window. <a href="https://github.com/ClickHouse/ClickHouse/pull/23301" target="_blank" rel="noopener noreferrer">#23301</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed very rare (distributed) race condition between creation and removal of ReplicatedMergeTree tables. It might cause exceptions like <code>node doesn&#x27;t exist</code> on attempt to create replicated table. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21419" target="_blank" rel="noopener noreferrer">#21419</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23294" target="_blank" rel="noopener noreferrer">#23294</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed simple key dictionary from DDL creation if primary key is not first attribute. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/23236" target="_blank" rel="noopener noreferrer">#23236</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23262" target="_blank" rel="noopener noreferrer">#23262</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fixed reading from ODBC when there are many long column names in a table. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8853" target="_blank" rel="noopener noreferrer">#8853</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23215" target="_blank" rel="noopener noreferrer">#23215</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>MaterializeMySQL (experimental feature): fixed <code>Not found column</code> error when selecting from <code>MaterializeMySQL</code> with condition on key column. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22432" target="_blank" rel="noopener noreferrer">#22432</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23200" target="_blank" rel="noopener noreferrer">#23200</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Correct aliases handling if subquery was optimized to constant. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22924" target="_blank" rel="noopener noreferrer">#22924</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10401" target="_blank" rel="noopener noreferrer">#10401</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23191" target="_blank" rel="noopener noreferrer">#23191</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Server might fail to start if <code>data_type_default_nullable</code> setting is enabled in default profile, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22573" target="_blank" rel="noopener noreferrer">#22573</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/23185" target="_blank" rel="noopener noreferrer">#23185</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed a crash on shutdown which happened because of wrong accounting of current connections. <a href="https://github.com/ClickHouse/ClickHouse/pull/23154" target="_blank" rel="noopener noreferrer">#23154</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed <code>Table .inner_id... doesn&#x27;t exist</code> error when selecting from Materialized View after detaching it from Atomic database and attaching back. <a href="https://github.com/ClickHouse/ClickHouse/pull/23047" target="_blank" rel="noopener noreferrer">#23047</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix error <code>Cannot find column in ActionsDAG result</code> which may happen if subquery uses <code>untuple</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22290" target="_blank" rel="noopener noreferrer">#22290</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22991" target="_blank" rel="noopener noreferrer">#22991</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix usage of constant columns of type <code>Map</code> with nullable values. <a href="https://github.com/ClickHouse/ClickHouse/pull/22939" target="_blank" rel="noopener noreferrer">#22939</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>fixed <code>formatDateTime()</code> on <code>DateTime64</code> and &quot;%C&quot; format specifier fixed <code>toDateTime64()</code> for large values and non-zero scale. <a href="https://github.com/ClickHouse/ClickHouse/pull/22937" target="_blank" rel="noopener noreferrer">#22937</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fixed a crash when using <code>mannWhitneyUTest</code> and <code>rankCorr</code> with window functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22728" target="_blank" rel="noopener noreferrer">#22728</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22876" target="_blank" rel="noopener noreferrer">#22876</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>LIVE VIEW (experimental feature): fixed possible hanging in concurrent DROP/CREATE of TEMPORARY LIVE VIEW in <code>TemporaryLiveViewCleaner</code>, <a href="https://gist.github.com/vzakaznikov/0c03195960fc86b56bfe2bc73a90019e" target="_blank" rel="noopener noreferrer">see</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22858" target="_blank" rel="noopener noreferrer">#22858</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed pushdown of <code>HAVING</code> in case, when filter column is used in aggregation. <a href="https://github.com/ClickHouse/ClickHouse/pull/22763" target="_blank" rel="noopener noreferrer">#22763</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed possible hangs in Zookeeper requests in case of OOM exception. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22438" target="_blank" rel="noopener noreferrer">#22438</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22684" target="_blank" rel="noopener noreferrer">#22684</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed wait for mutations on several replicas for ReplicatedMergeTree table engines. Previously, mutation/alter query may finish before mutation actually executed on other replicas. <a href="https://github.com/ClickHouse/ClickHouse/pull/22669" target="_blank" rel="noopener noreferrer">#22669</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed exception for Log with nested types without columns in the SELECT clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/22654" target="_blank" rel="noopener noreferrer">#22654</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix unlimited wait for auxiliary AWS requests. <a href="https://github.com/ClickHouse/ClickHouse/pull/22594" target="_blank" rel="noopener noreferrer">#22594</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fixed a crash when client closes connection very early <a href="https://github.com/ClickHouse/ClickHouse/issues/22579" target="_blank" rel="noopener noreferrer">#22579</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22591" target="_blank" rel="noopener noreferrer">#22591</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li><code>Map</code> data type (experimental feature): fixed an incorrect formatting of function <code>map</code> in distributed queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/22588" target="_blank" rel="noopener noreferrer">#22588</a> (<a href="https://github.com/foolchi" target="_blank" rel="noopener noreferrer">foolchi</a>).</li><li>Fixed deserialization of empty string without newline at end of TSV format. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20244" target="_blank" rel="noopener noreferrer">#20244</a>. Possible workaround without version update: set <code>input_format_null_as_default</code> to zero. It was zero in old versions. <a href="https://github.com/ClickHouse/ClickHouse/pull/22527" target="_blank" rel="noopener noreferrer">#22527</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed wrong cast of a column of <code>LowCardinality</code> type in Merge Join algorithm. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/22386" target="_blank" rel="noopener noreferrer">#22386</a>, close <a href="https://github.com/ClickHouse/ClickHouse/issues/22388" target="_blank" rel="noopener noreferrer">#22388</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22510" target="_blank" rel="noopener noreferrer">#22510</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>Buffer overflow (on read) was possible in <code>tokenbf_v1</code> full text index. The excessive bytes are not used but the read operation may lead to crash in rare cases. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19233" target="_blank" rel="noopener noreferrer">#19233</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22421" target="_blank" rel="noopener noreferrer">#22421</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Do not limit HTTP chunk size. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21907" target="_blank" rel="noopener noreferrer">#21907</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22322" target="_blank" rel="noopener noreferrer">#22322</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Fixed a bug, which leads to underaggregation of data in case of enabled <code>optimize_aggregation_in_order</code> and many parts in table. Slightly improve performance of aggregation with enabled <code>optimize_aggregation_in_order</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21889" target="_blank" rel="noopener noreferrer">#21889</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Check if table function view is used as a column. This complements #20350. <a href="https://github.com/ClickHouse/ClickHouse/pull/21465" target="_blank" rel="noopener noreferrer">#21465</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix &quot;unknown column&quot; error for tables with <code>Merge</code> engine in queris with <code>JOIN</code> and aggregation. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18368" target="_blank" rel="noopener noreferrer">#18368</a>, close <a href="https://github.com/ClickHouse/ClickHouse/issues/22226" target="_blank" rel="noopener noreferrer">#22226</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21370" target="_blank" rel="noopener noreferrer">#21370</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>Fixed name clashes in pushdown optimization. It caused incorrect <code>WHERE</code> filtration after FULL JOIN. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/20497" target="_blank" rel="noopener noreferrer">#20497</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20622" target="_blank" rel="noopener noreferrer">#20622</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>Fixed very rare bug when quorum insert with <code>quorum_parallel=1</code> is not really &quot;quorum&quot; because of deduplication. <a href="https://github.com/ClickHouse/ClickHouse/pull/18215" target="_blank" rel="noopener noreferrer">#18215</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a> - reported, <a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a> - fixed).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-6">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-6" title="Direct link to heading">​</a></h4><ul><li>Run stateless tests in parallel in CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/22300" target="_blank" rel="noopener noreferrer">#22300</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Simplify debian packages. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21698" target="_blank" rel="noopener noreferrer">#21698</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22976" target="_blank" rel="noopener noreferrer">#22976</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added support for ClickHouse build on Apple M1. <a href="https://github.com/ClickHouse/ClickHouse/pull/21639" target="_blank" rel="noopener noreferrer">#21639</a> (<a href="https://github.com/changvvb" target="_blank" rel="noopener noreferrer">changvvb</a>).</li><li>Fixed ClickHouse Keeper build for MacOS. <a href="https://github.com/ClickHouse/ClickHouse/pull/22860" target="_blank" rel="noopener noreferrer">#22860</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed some tests on AArch64 platform. <a href="https://github.com/ClickHouse/ClickHouse/pull/22596" target="_blank" rel="noopener noreferrer">#22596</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added function alignment for possibly better performance. <a href="https://github.com/ClickHouse/ClickHouse/pull/21431" target="_blank" rel="noopener noreferrer">#21431</a> (<a href="https://github.com/danlark1" target="_blank" rel="noopener noreferrer">Danila Kutenin</a>).</li><li>Adjust some tests to output identical results on amd64 and aarch64 (qemu). The result was depending on implementation specific CPU behaviour. <a href="https://github.com/ClickHouse/ClickHouse/pull/22590" target="_blank" rel="noopener noreferrer">#22590</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow query profiling only on x86_64. See <a href="https://github.com/ClickHouse/ClickHouse/issues/15174#issuecomment-812954965" target="_blank" rel="noopener noreferrer">#15174</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/15638#issuecomment-703805337" target="_blank" rel="noopener noreferrer">#15638</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15638" target="_blank" rel="noopener noreferrer">#15638</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22580" target="_blank" rel="noopener noreferrer">#22580</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow building with unbundled xz (lzma) using <code>USE_INTERNAL_XZ_LIBRARY=OFF</code> CMake option. <a href="https://github.com/ClickHouse/ClickHouse/pull/22571" target="_blank" rel="noopener noreferrer">#22571</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>).</li><li>Enable bundled <code>openldap</code> on <code>ppc64le</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/22487" target="_blank" rel="noopener noreferrer">#22487</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>).</li><li>Disable incompatible libraries (platform specific typically) on <code>ppc64le</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/22475" target="_blank" rel="noopener noreferrer">#22475</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>).</li><li>Add Jepsen test in CI for clickhouse Keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/22373" target="_blank" rel="noopener noreferrer">#22373</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Build <code>jemalloc</code> with support for <a href="https://github.com/jemalloc/jemalloc/wiki/Use-Case%3A-Heap-Profiling" target="_blank" rel="noopener noreferrer">heap profiling</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22834" target="_blank" rel="noopener noreferrer">#22834</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Avoid UB in <code>*Log</code> engines for rwlock unlock due to unlock from another thread. <a href="https://github.com/ClickHouse/ClickHouse/pull/22583" target="_blank" rel="noopener noreferrer">#22583</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed UB by unlocking the rwlock of the TinyLog from the same thread. <a href="https://github.com/ClickHouse/ClickHouse/pull/22560" target="_blank" rel="noopener noreferrer">#22560</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-214">ClickHouse release 21.4<a class="hash-link" href="#clickhouse-release-214" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-2141-2021-04-12">ClickHouse release 21.4.1 2021-04-12<a class="hash-link" href="#clickhouse-release-2141-2021-04-12" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-7">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-7" title="Direct link to heading">​</a></h4><ul><li>The <code>toStartOfIntervalFunction</code> will align hour intervals to the midnight (in previous versions they were aligned to the start of unix epoch). For example, <code>toStartOfInterval(x, INTERVAL 11 HOUR)</code> will split every day into three intervals: <code>00:00:00..10:59:59</code>, <code>11:00:00..21:59:59</code> and <code>22:00:00..23:59:59</code>. This behaviour is more suited for practical needs. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9510" target="_blank" rel="noopener noreferrer">#9510</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22060" target="_blank" rel="noopener noreferrer">#22060</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li><code>Age</code> and <code>Precision</code> in graphite rollup configs should increase from retention to retention. Now it&#x27;s checked and the wrong config raises an exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/21496" target="_blank" rel="noopener noreferrer">#21496</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Fix <code>cutToFirstSignificantSubdomainCustom()</code>/<code>firstSignificantSubdomainCustom()</code> returning wrong result for 3+ level domains present in custom top-level domain list. For input domains matching these custom top-level domains, the third-level domain was considered to be the first significant one. This is now fixed. This change may introduce incompatibility if the function is used in e.g. the sharding key. <a href="https://github.com/ClickHouse/ClickHouse/pull/21946" target="_blank" rel="noopener noreferrer">#21946</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Column <code>keys</code> in table <code>system.dictionaries</code> was replaced to columns <code>key.names</code> and <code>key.types</code>. Columns <code>key.names</code>, <code>key.types</code>, <code>attribute.names</code>, <code>attribute.types</code> from <code>system.dictionaries</code> table does not require dictionary to be loaded. <a href="https://github.com/ClickHouse/ClickHouse/pull/21884" target="_blank" rel="noopener noreferrer">#21884</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Now replicas that are processing the <code>ALTER TABLE ATTACH PART[ITION]</code> command search in their <code>detached/</code> folders before fetching the data from other replicas. As an implementation detail, a new command <code>ATTACH_PART</code> is introduced in the replicated log. Parts are searched and compared by their checksums. <a href="https://github.com/ClickHouse/ClickHouse/pull/18978" target="_blank" rel="noopener noreferrer">#18978</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike Kot</a>). <strong>Note</strong>:<ul><li><code>ATTACH PART[ITION]</code> queries may not work during cluster upgrade.</li><li>It&#x27;s not possible to rollback to older ClickHouse version after executing <code>ALTER ... ATTACH</code> query in new version as the old servers would fail to pass the <code>ATTACH_PART</code> entry in the replicated log.</li></ul></li><li>In this version, empty <code>&lt;remote_url_allow_hosts&gt;&lt;/remote_url_allow_hosts&gt;</code> will block all access to remote hosts while in previous versions it did nothing. If you want to keep old behaviour and you have empty <code>remote_url_allow_hosts</code> element in configuration file, remove it. <a href="https://github.com/ClickHouse/ClickHouse/pull/20058" target="_blank" rel="noopener noreferrer">#20058</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-7">New Feature<a class="hash-link" href="#new-feature-7" title="Direct link to heading">​</a></h4><ul><li>Extended range of <code>DateTime64</code> to support dates from year 1925 to 2283. Improved support of <code>DateTime</code> around zero date (<code>1970-01-01</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9404" target="_blank" rel="noopener noreferrer">#9404</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>, <a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>). Not every time and date functions are working for extended range of dates.</li><li>Added support of Kerberos authentication for preconfigured users and HTTP requests (GSS-SPNEGO). <a href="https://github.com/ClickHouse/ClickHouse/pull/14995" target="_blank" rel="noopener noreferrer">#14995</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>Add <code>prefer_column_name_to_alias</code> setting to use original column names instead of aliases. it is needed to be more compatible with common databases&#x27; aliasing rules. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/9715" target="_blank" rel="noopener noreferrer">#9715</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/9887" target="_blank" rel="noopener noreferrer">#9887</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22044" target="_blank" rel="noopener noreferrer">#22044</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added functions <code>dictGetChildren(dictionary, key)</code>, <code>dictGetDescendants(dictionary, key, level)</code>. Function <code>dictGetChildren</code> return all children as an array if indexes. It is a inverse transformation for <code>dictGetHierarchy</code>. Function <code>dictGetDescendants</code> return all descendants as if <code>dictGetChildren</code> was applied <code>level</code> times recursively. Zero <code>level</code> value is equivalent to infinity. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14656" target="_blank" rel="noopener noreferrer">#14656</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22096" target="_blank" rel="noopener noreferrer">#22096</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added <code>executable_pool</code> dictionary source. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/14528" target="_blank" rel="noopener noreferrer">#14528</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21321" target="_blank" rel="noopener noreferrer">#21321</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added table function <code>dictionary</code>. It works the same way as <code>Dictionary</code> engine. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21560" target="_blank" rel="noopener noreferrer">#21560</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21910" target="_blank" rel="noopener noreferrer">#21910</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Support <code>Nullable</code> type for <code>PolygonDictionary</code> attribute. <a href="https://github.com/ClickHouse/ClickHouse/pull/21890" target="_blank" rel="noopener noreferrer">#21890</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Functions <code>dictGet</code>, <code>dictHas</code> use current database name if it is not specified for dictionaries created with DDL. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21632" target="_blank" rel="noopener noreferrer">#21632</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21859" target="_blank" rel="noopener noreferrer">#21859</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added function <code>dictGetOrNull</code>. It works like <code>dictGet</code>, but return <code>Null</code> in case key was not found in dictionary. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22375" target="_blank" rel="noopener noreferrer">#22375</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22413" target="_blank" rel="noopener noreferrer">#22413</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added async update in <code>ComplexKeyCache</code>, <code>SSDCache</code>, <code>SSDComplexKeyCache</code> dictionaries. Added support for <code>Nullable</code> type in <code>Cache</code>, <code>ComplexKeyCache</code>, <code>SSDCache</code>, <code>SSDComplexKeyCache</code> dictionaries. Added support for multiple attributes fetch with <code>dictGet</code>, <code>dictGetOrDefault</code> functions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21517" target="_blank" rel="noopener noreferrer">#21517</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20595" target="_blank" rel="noopener noreferrer">#20595</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Support <code>dictHas</code> function for <code>RangeHashedDictionary</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6680" target="_blank" rel="noopener noreferrer">#6680</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19816" target="_blank" rel="noopener noreferrer">#19816</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add function <code>timezoneOf</code> that returns the timezone name of <code>DateTime</code> or <code>DateTime64</code> data types. This does not close <a href="https://github.com/ClickHouse/ClickHouse/issues/9959" target="_blank" rel="noopener noreferrer">#9959</a>. Fix inconsistencies in function names: add aliases <code>timezone</code> and <code>timeZone</code> as well as <code>toTimezone</code> and <code>toTimeZone</code> and <code>timezoneOf</code> and <code>timeZoneOf</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22001" target="_blank" rel="noopener noreferrer">#22001</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add new optional clause <code>GRANTEES</code> for <code>CREATE/ALTER USER</code> commands. It specifies users or roles which are allowed to receive grants from this user on condition this user has also all required access granted with grant option. By default <code>GRANTEES ANY</code> is used which means a user with grant option can grant to anyone. Syntax: <code>CREATE USER ... GRANTEES {user | role | ANY | NONE} [,...] [EXCEPT {user | role} [,...]]</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21641" target="_blank" rel="noopener noreferrer">#21641</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Add new column <code>slowdowns_count</code> to <code>system.clusters</code>. When using hedged requests, it shows how many times we switched to another replica because this replica was responding slowly. Also show actual value of <code>errors_count</code> in <code>system.clusters</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21480" target="_blank" rel="noopener noreferrer">#21480</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add <code>_partition_id</code> virtual column for <code>MergeTree*</code> engines. Allow to prune partitions by <code>_partition_id</code>. Add <code>partitionID()</code> function to calculate partition id string. <a href="https://github.com/ClickHouse/ClickHouse/pull/21401" target="_blank" rel="noopener noreferrer">#21401</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add function <code>isIPAddressInRange</code> to test if an IPv4 or IPv6 address is contained in a given CIDR network prefix. <a href="https://github.com/ClickHouse/ClickHouse/pull/21329" target="_blank" rel="noopener noreferrer">#21329</a> (<a href="https://github.com/depressed-pho" target="_blank" rel="noopener noreferrer">PHO</a>).</li><li>Added new SQL command <code>ALTER TABLE &#x27;table_name&#x27; UNFREEZE [PARTITION &#x27;part_expr&#x27;] WITH NAME &#x27;backup_name&#x27;</code>. This command is needed to properly remove &#x27;freezed&#x27; partitions from all disks. <a href="https://github.com/ClickHouse/ClickHouse/pull/21142" target="_blank" rel="noopener noreferrer">#21142</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Supports implicit key type conversion for JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/19885" target="_blank" rel="noopener noreferrer">#19885</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-6">Experimental Feature<a class="hash-link" href="#experimental-feature-6" title="Direct link to heading">​</a></h4><ul><li>Support <code>RANGE OFFSET</code> frame (for window functions) for floating point types. Implement <code>lagInFrame</code>/<code>leadInFrame</code> window functions, which are analogous to <code>lag</code>/<code>lead</code>, but respect the window frame. They are identical when the frame is <code>between unbounded preceding and unbounded following</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/5485" target="_blank" rel="noopener noreferrer">#5485</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21895" target="_blank" rel="noopener noreferrer">#21895</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Zero-copy replication for <code>ReplicatedMergeTree</code> over S3 storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/16240" target="_blank" rel="noopener noreferrer">#16240</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Added possibility to migrate existing S3 disk to the schema with backup-restore capabilities. <a href="https://github.com/ClickHouse/ClickHouse/pull/22070" target="_blank" rel="noopener noreferrer">#22070</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-7">Performance Improvement<a class="hash-link" href="#performance-improvement-7" title="Direct link to heading">​</a></h4><ul><li>Supported parallel formatting in <code>clickhouse-local</code> and everywhere else. <a href="https://github.com/ClickHouse/ClickHouse/pull/21630" target="_blank" rel="noopener noreferrer">#21630</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Support parallel parsing for <code>CSVWithNames</code> and <code>TSVWithNames</code> formats. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21085" target="_blank" rel="noopener noreferrer">#21085</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21149" target="_blank" rel="noopener noreferrer">#21149</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Enable read with mmap IO for file ranges from 64 MiB (the settings <code>min_bytes_to_use_mmap_io</code>). It may lead to moderate performance improvement. <a href="https://github.com/ClickHouse/ClickHouse/pull/22326" target="_blank" rel="noopener noreferrer">#22326</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add cache for files read with <code>min_bytes_to_use_mmap_io</code> setting. It makes significant (2x and more) performance improvement when the value of the setting is small by avoiding frequent mmap/munmap calls and the consequent page faults. Note that mmap IO has major drawbacks that makes it less reliable in production (e.g. hung or SIGBUS on faulty disks; less controllable memory usage). Nevertheless it is good in benchmarks. <a href="https://github.com/ClickHouse/ClickHouse/pull/22206" target="_blank" rel="noopener noreferrer">#22206</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Avoid unnecessary data copy when using codec <code>NONE</code>. Please note that codec <code>NONE</code> is mostly useless - it&#x27;s recommended to always use compression (<code>LZ4</code> is by default). Despite the common belief, disabling compression may not improve performance (the opposite effect is possible). The <code>NONE</code> codec is useful in some cases: - when data is uncompressable; - for synthetic benchmarks. <a href="https://github.com/ClickHouse/ClickHouse/pull/22145" target="_blank" rel="noopener noreferrer">#22145</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Faster <code>GROUP BY</code> with small <code>max_rows_to_group_by</code> and <code>group_by_overflow_mode=&#x27;any&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21856" target="_blank" rel="noopener noreferrer">#21856</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Optimize performance of queries like <code>SELECT ... FINAL ... WHERE</code>. Now in queries with <code>FINAL</code> it&#x27;s allowed to move to <code>PREWHERE</code> columns, which are in sorting key. <a href="https://github.com/ClickHouse/ClickHouse/pull/21830" target="_blank" rel="noopener noreferrer">#21830</a> (<a href="https://github.com/foolchi" target="_blank" rel="noopener noreferrer">foolchi</a>).</li><li>Improved performance by replacing <code>memcpy</code> to another implementation. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18583" target="_blank" rel="noopener noreferrer">#18583</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21520" target="_blank" rel="noopener noreferrer">#21520</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve performance of aggregation in order of sorting key (with enabled setting <code>optimize_aggregation_in_order</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/19401" target="_blank" rel="noopener noreferrer">#19401</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-7">Improvement<a class="hash-link" href="#improvement-7" title="Direct link to heading">​</a></h4><ul><li>Add connection pool for PostgreSQL table/database engine and dictionary source. Should fix <a href="https://github.com/ClickHouse/ClickHouse/issues/21444" target="_blank" rel="noopener noreferrer">#21444</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21839" target="_blank" rel="noopener noreferrer">#21839</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support non-default table schema for postgres storage/table-function. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21701" target="_blank" rel="noopener noreferrer">#21701</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21711" target="_blank" rel="noopener noreferrer">#21711</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support replicas priority for postgres dictionary source. <a href="https://github.com/ClickHouse/ClickHouse/pull/21710" target="_blank" rel="noopener noreferrer">#21710</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Introduce a new merge tree setting <code>min_bytes_to_rebalance_partition_over_jbod</code> which allows assigning new parts to different disks of a JBOD volume in a balanced way. <a href="https://github.com/ClickHouse/ClickHouse/pull/16481" target="_blank" rel="noopener noreferrer">#16481</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added <code>Grant</code>, <code>Revoke</code> and <code>System</code> values of <code>query_kind</code> column for corresponding queries in <code>system.query_log</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21102" target="_blank" rel="noopener noreferrer">#21102</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Allow customizing timeouts for HTTP connections used for replication independently from other HTTP timeouts. <a href="https://github.com/ClickHouse/ClickHouse/pull/20088" target="_blank" rel="noopener noreferrer">#20088</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Better exception message in client in case of exception while server is writing blocks. In previous versions client may get misleading message like <code>Data compressed with different methods</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22427" target="_blank" rel="noopener noreferrer">#22427</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix error <code>Directory tmp_fetch_XXX already exists</code> which could happen after failed fetch part. Delete temporary fetch directory if it already exists. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14197" target="_blank" rel="noopener noreferrer">#14197</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22411" target="_blank" rel="noopener noreferrer">#22411</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Fix MSan report for function <code>range</code> with <code>UInt256</code> argument (support for large integers is experimental). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22157" target="_blank" rel="noopener noreferrer">#22157</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22387" target="_blank" rel="noopener noreferrer">#22387</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add <code>current_database</code> column to <code>system.processes</code> table. It contains the current database of the query. <a href="https://github.com/ClickHouse/ClickHouse/pull/22365" target="_blank" rel="noopener noreferrer">#22365</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Add case-insensitive history search/navigation and subword movement features to <code>clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22105" target="_blank" rel="noopener noreferrer">#22105</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>If tuple of NULLs, e.g. <code>(NULL, NULL)</code> is on the left hand side of <code>IN</code> operator with tuples of non-NULLs on the right hand side, e.g. <code>SELECT (NULL, NULL) IN ((0, 0), (3, 1))</code> return 0 instead of throwing an exception about incompatible types. The expression may also appear due to optimization of something like <code>SELECT (NULL, NULL) = (8, 0) OR (NULL, NULL) = (3, 2) OR (NULL, NULL) = (0, 0) OR (NULL, NULL) = (3, 1)</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22017" target="_blank" rel="noopener noreferrer">#22017</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22063" target="_blank" rel="noopener noreferrer">#22063</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Update used version of simdjson to 0.9.1. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21984" target="_blank" rel="noopener noreferrer">#21984</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22057" target="_blank" rel="noopener noreferrer">#22057</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Added case insensitive aliases for <code>CONNECTION_ID()</code> and <code>VERSION()</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22028" target="_blank" rel="noopener noreferrer">#22028</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22042" target="_blank" rel="noopener noreferrer">#22042</a> (<a href="https://github.com/Slach" target="_blank" rel="noopener noreferrer">Eugene Klimov</a>).</li><li>Add option <code>strict_increase</code> to <code>windowFunnel</code> function to calculate each event once (resolve <a href="https://github.com/ClickHouse/ClickHouse/issues/21835" target="_blank" rel="noopener noreferrer">#21835</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/22025" target="_blank" rel="noopener noreferrer">#22025</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>If partition key of a <code>MergeTree</code> table does not include <code>Date</code> or <code>DateTime</code> columns but includes exactly one <code>DateTime64</code> column, expose its values in the <code>min_time</code> and <code>max_time</code> columns in <code>system.parts</code> and <code>system.parts_columns</code> tables. Add <code>min_time</code> and <code>max_time</code> columns to <code>system.parts_columns</code> table (these was inconsistency to the <code>system.parts</code> table). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18244" target="_blank" rel="noopener noreferrer">#18244</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22011" target="_blank" rel="noopener noreferrer">#22011</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Supported <code>replication_alter_partitions_sync=1</code> setting in <code>clickhouse-copier</code> for moving partitions from helping table to destination. Decreased default timeouts. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21911" target="_blank" rel="noopener noreferrer">#21911</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21912" target="_blank" rel="noopener noreferrer">#21912</a> (<a href="https://github.com/songenjie" target="_blank" rel="noopener noreferrer">turbo jason</a>).</li><li>Show path to data directory of <code>EmbeddedRocksDB</code> tables in system tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/21903" target="_blank" rel="noopener noreferrer">#21903</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Add profile event <code>HedgedRequestsChangeReplica</code>, change read data timeout from sec to ms. <a href="https://github.com/ClickHouse/ClickHouse/pull/21886" target="_blank" rel="noopener noreferrer">#21886</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>DiskS3 (experimental feature under development). Fixed bug with the impossibility to move directory if the destination is not empty and cache disk is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/21837" target="_blank" rel="noopener noreferrer">#21837</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Better formatting for <code>Array</code> and <code>Map</code> data types in Web UI. <a href="https://github.com/ClickHouse/ClickHouse/pull/21798" target="_blank" rel="noopener noreferrer">#21798</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Update clusters only if their configurations were updated. <a href="https://github.com/ClickHouse/ClickHouse/pull/21685" target="_blank" rel="noopener noreferrer">#21685</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Propagate query and session settings for distributed DDL queries. Set <code>distributed_ddl_entry_format_version</code> to 2 to enable this. Added <code>distributed_ddl_output_mode</code> setting. Supported modes: <code>none</code>, <code>throw</code> (default), <code>null_status_on_timeout</code> and <code>never_throw</code>. Miscellaneous fixes and improvements for <code>Replicated</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/21535" target="_blank" rel="noopener noreferrer">#21535</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>If <code>PODArray</code> was instantiated with element size that is neither a fraction or a multiple of 16, buffer overflow was possible. No bugs in current releases exist. <a href="https://github.com/ClickHouse/ClickHouse/pull/21533" target="_blank" rel="noopener noreferrer">#21533</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add <code>last_error_time</code>/<code>last_error_message</code>/<code>last_error_stacktrace</code>/<code>remote</code> columns for <code>system.errors</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21529" target="_blank" rel="noopener noreferrer">#21529</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add aliases <code>simpleJSONExtract/simpleJSONHas</code> to <code>visitParam/visitParamExtract{UInt, Int, Bool, Float, Raw, String}</code>. Fixes #21383. <a href="https://github.com/ClickHouse/ClickHouse/pull/21519" target="_blank" rel="noopener noreferrer">#21519</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Add setting <code>optimize_skip_unused_shards_limit</code> to limit the number of sharding key values for <code>optimize_skip_unused_shards</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21512" target="_blank" rel="noopener noreferrer">#21512</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improve <code>clickhouse-format</code> to not throw exception when there are extra spaces or comment after the last query, and throw exception early with readable message when format <code>ASTInsertQuery</code> with data . <a href="https://github.com/ClickHouse/ClickHouse/pull/21311" target="_blank" rel="noopener noreferrer">#21311</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Improve support of integer keys in data type <code>Map</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21157" target="_blank" rel="noopener noreferrer">#21157</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>MaterializeMySQL: attempt to reconnect to MySQL if the connection is lost. <a href="https://github.com/ClickHouse/ClickHouse/pull/20961" target="_blank" rel="noopener noreferrer">#20961</a> (<a href="https://github.com/havardk" target="_blank" rel="noopener noreferrer">Håvard Kvålen</a>).</li><li>Support more cases to rewrite <code>CROSS JOIN</code> to <code>INNER JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20392" target="_blank" rel="noopener noreferrer">#20392</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>Do not create empty parts on INSERT when <code>optimize_on_insert</code> setting enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20304" target="_blank" rel="noopener noreferrer">#20304</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20387" target="_blank" rel="noopener noreferrer">#20387</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li><code>MaterializeMySQL</code>: add minmax skipping index for <code>_version</code> column. <a href="https://github.com/ClickHouse/ClickHouse/pull/20382" target="_blank" rel="noopener noreferrer">#20382</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li><li>Add option <code>--backslash</code> for <code>clickhouse-format</code>, which can add a backslash at the end of each line of the formatted query. <a href="https://github.com/ClickHouse/ClickHouse/pull/21494" target="_blank" rel="noopener noreferrer">#21494</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Now clickhouse will not throw <code>LOGICAL_ERROR</code> exception when we try to mutate the already covered part. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22013" target="_blank" rel="noopener noreferrer">#22013</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22291" target="_blank" rel="noopener noreferrer">#22291</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-6">Bug Fix<a class="hash-link" href="#bug-fix-6" title="Direct link to heading">​</a></h4><ul><li>Remove socket from epoll before cancelling packet receiver in <code>HedgedConnections</code> to prevent possible race. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/22161" target="_blank" rel="noopener noreferrer">#22161</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22443" target="_blank" rel="noopener noreferrer">#22443</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add (missing) memory accounting in parallel parsing routines. In previous versions OOM was possible when the resultset contains very large blocks of data. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22008" target="_blank" rel="noopener noreferrer">#22008</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22425" target="_blank" rel="noopener noreferrer">#22425</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix exception which may happen when <code>SELECT</code> has constant <code>WHERE</code> condition and source table has columns which names are digits. <a href="https://github.com/ClickHouse/ClickHouse/pull/22270" target="_blank" rel="noopener noreferrer">#22270</a> (<a href="https://github.com/liuneng1994" target="_blank" rel="noopener noreferrer">LiuNeng</a>).</li><li>Fix query cancellation with <code>use_hedged_requests=0</code> and <code>async_socket_for_remote=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22183" target="_blank" rel="noopener noreferrer">#22183</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix uncaught exception in <code>InterserverIOHTTPHandler</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22146" target="_blank" rel="noopener noreferrer">#22146</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix docker entrypoint in case <code>http_port</code> is not in the config. <a href="https://github.com/ClickHouse/ClickHouse/pull/22132" target="_blank" rel="noopener noreferrer">#22132</a> (<a href="https://github.com/devwout" target="_blank" rel="noopener noreferrer">Ewout</a>).</li><li>Fix error <code>Invalid number of rows in Chunk</code> in <code>JOIN</code> with <code>TOTALS</code> and <code>arrayJoin</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19303" target="_blank" rel="noopener noreferrer">#19303</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22129" target="_blank" rel="noopener noreferrer">#22129</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>Fix the background thread pool name which used to poll message from Kafka. The Kafka engine with the broken thread pool will not consume the message from message queue. <a href="https://github.com/ClickHouse/ClickHouse/pull/22122" target="_blank" rel="noopener noreferrer">#22122</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Fix waiting for <code>OPTIMIZE</code> and <code>ALTER</code> queries for <code>ReplicatedMergeTree</code> table engines. Now the query will not hang when the table was detached or restarted. <a href="https://github.com/ClickHouse/ClickHouse/pull/22118" target="_blank" rel="noopener noreferrer">#22118</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Disable <code>async_socket_for_remote</code>/<code>use_hedged_requests</code> for buggy Linux kernels. <a href="https://github.com/ClickHouse/ClickHouse/pull/22109" target="_blank" rel="noopener noreferrer">#22109</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Docker entrypoint: avoid chown of <code>.</code> in case when <code>LOG_PATH</code> is empty. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/22100" target="_blank" rel="noopener noreferrer">#22100</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22102" target="_blank" rel="noopener noreferrer">#22102</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>The function <code>decrypt</code> was lacking a check for the minimal size of data encrypted in <code>AEAD</code> mode. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21897" target="_blank" rel="noopener noreferrer">#21897</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22064" target="_blank" rel="noopener noreferrer">#22064</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>In rare case, merge for <code>CollapsingMergeTree</code> may create granule with <code>index_granularity + 1</code> rows. Because of this, internal check, added in <a href="https://github.com/ClickHouse/ClickHouse/issues/18928" target="_blank" rel="noopener noreferrer">#18928</a> (affects 21.2 and 21.3), may fail with error <code>Incomplete granules are not allowed while blocks are granules size</code>. This error did not allow parts to merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/21976" target="_blank" rel="noopener noreferrer">#21976</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Reverted <a href="https://github.com/ClickHouse/ClickHouse/issues/15454" target="_blank" rel="noopener noreferrer">#15454</a> that may cause significant increase in memory usage while loading external dictionaries of hashed type. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21935" target="_blank" rel="noopener noreferrer">#21935</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21948" target="_blank" rel="noopener noreferrer">#21948</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Prevent hedged connections overlaps (<code>Unknown packet 9 from server</code> error). <a href="https://github.com/ClickHouse/ClickHouse/pull/21941" target="_blank" rel="noopener noreferrer">#21941</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix reading the HTTP POST request with &quot;multipart/form-data&quot; content type in some cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/21936" target="_blank" rel="noopener noreferrer">#21936</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Fix wrong <code>ORDER BY</code> results when a query contains window functions, and optimization for reading in primary key order is applied. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21828" target="_blank" rel="noopener noreferrer">#21828</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21915" target="_blank" rel="noopener noreferrer">#21915</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fix deadlock in first catboost model execution. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13832" target="_blank" rel="noopener noreferrer">#13832</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21844" target="_blank" rel="noopener noreferrer">#21844</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fix incorrect query result (and possible crash) which could happen when <code>WHERE</code> or <code>HAVING</code> condition is pushed before <code>GROUP BY</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21773" target="_blank" rel="noopener noreferrer">#21773</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21841" target="_blank" rel="noopener noreferrer">#21841</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Better error handling and logging in <code>WriteBufferFromS3</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21836" target="_blank" rel="noopener noreferrer">#21836</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fix possible crashes in aggregate functions with combinator <code>Distinct</code>, while using two-level aggregation. This is a follow-up fix of <a href="https://github.com/ClickHouse/ClickHouse/pull/18365" target="_blank" rel="noopener noreferrer">#18365</a> . Can only reproduced in production env. <a href="https://github.com/ClickHouse/ClickHouse/pull/21818" target="_blank" rel="noopener noreferrer">#21818</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix scalar subquery index analysis. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21717" target="_blank" rel="noopener noreferrer">#21717</a> , which was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/18896" target="_blank" rel="noopener noreferrer">#18896</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21766" target="_blank" rel="noopener noreferrer">#21766</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix bug for <code>ReplicatedMerge</code> table engines when <code>ALTER MODIFY COLUMN</code> query doesn&#x27;t change the type of <code>Decimal</code> column if its size (32 bit or 64 bit) doesn&#x27;t change. <a href="https://github.com/ClickHouse/ClickHouse/pull/21728" target="_blank" rel="noopener noreferrer">#21728</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix possible infinite waiting when concurrent <code>OPTIMIZE</code> and <code>DROP</code> are run for <code>ReplicatedMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21716" target="_blank" rel="noopener noreferrer">#21716</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix function <code>arrayElement</code> with type <code>Map</code> for constant integer arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/21699" target="_blank" rel="noopener noreferrer">#21699</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix SIGSEGV on not existing attributes from <code>ip_trie</code> with <code>access_to_key_from_attributes</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21692" target="_blank" rel="noopener noreferrer">#21692</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Server now start accepting connections only after <code>DDLWorker</code> and dictionaries initialization. <a href="https://github.com/ClickHouse/ClickHouse/pull/21676" target="_blank" rel="noopener noreferrer">#21676</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add type conversion for keys of tables of type <code>Join</code> (previously led to SIGSEGV). <a href="https://github.com/ClickHouse/ClickHouse/pull/21646" target="_blank" rel="noopener noreferrer">#21646</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix distributed requests cancellation (for example simple select from multiple shards with limit, i.e. <code>select * from remote(&#x27;127.{2,3}&#x27;, system.numbers) limit 100</code>) with <code>async_socket_for_remote=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21643" target="_blank" rel="noopener noreferrer">#21643</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>fsync_part_directory</code> for horizontal merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/21642" target="_blank" rel="noopener noreferrer">#21642</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Remove unknown columns from joined table in <code>WHERE</code> for queries to external database engines (MySQL, PostgreSQL). close <a href="https://github.com/ClickHouse/ClickHouse/issues/14614" target="_blank" rel="noopener noreferrer">#14614</a>, close <a href="https://github.com/ClickHouse/ClickHouse/issues/19288" target="_blank" rel="noopener noreferrer">#19288</a> (dup), close <a href="https://github.com/ClickHouse/ClickHouse/issues/19645" target="_blank" rel="noopener noreferrer">#19645</a> (dup). <a href="https://github.com/ClickHouse/ClickHouse/pull/21640" target="_blank" rel="noopener noreferrer">#21640</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li><code>std::terminate</code> was called if there is an error writing data into s3. <a href="https://github.com/ClickHouse/ClickHouse/pull/21624" target="_blank" rel="noopener noreferrer">#21624</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li><li>Fix possible error <code>Cannot find column</code> when <code>optimize_skip_unused_shards</code> is enabled and zero shards are used. <a href="https://github.com/ClickHouse/ClickHouse/pull/21579" target="_blank" rel="noopener noreferrer">#21579</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>In case if query has constant <code>WHERE</code> condition, and setting <code>optimize_skip_unused_shards</code> enabled, all shards may be skipped and query could return incorrect empty result. <a href="https://github.com/ClickHouse/ClickHouse/pull/21550" target="_blank" rel="noopener noreferrer">#21550</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix table function <code>clusterAllReplicas</code> returns wrong <code>_shard_num</code>. close <a href="https://github.com/ClickHouse/ClickHouse/issues/21481" target="_blank" rel="noopener noreferrer">#21481</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21498" target="_blank" rel="noopener noreferrer">#21498</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Fix that S3 table holds old credentials after config update. <a href="https://github.com/ClickHouse/ClickHouse/pull/21457" target="_blank" rel="noopener noreferrer">#21457</a> (<a href="https://github.com/GrigoryPervakov" target="_blank" rel="noopener noreferrer">Grigory Pervakov</a>).</li><li>Fixed race on SSL object inside <code>SecureSocket</code> in Poco. <a href="https://github.com/ClickHouse/ClickHouse/pull/21456" target="_blank" rel="noopener noreferrer">#21456</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix <code>Avro</code> format parsing for <code>Kafka</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21437" target="_blank" rel="noopener noreferrer">#21437</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21438" target="_blank" rel="noopener noreferrer">#21438</a> (<a href="https://github.com/ilejn" target="_blank" rel="noopener noreferrer">Ilya Golshtein</a>).</li><li>Fix receive and send timeouts and non-blocking read in secure socket. <a href="https://github.com/ClickHouse/ClickHouse/pull/21429" target="_blank" rel="noopener noreferrer">#21429</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li><code>force_drop_table</code> flag didn&#x27;t work for <code>MATERIALIZED VIEW</code>, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18943" target="_blank" rel="noopener noreferrer">#18943</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20626" target="_blank" rel="noopener noreferrer">#20626</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix name clashes in <code>PredicateRewriteVisitor</code>. It caused incorrect <code>WHERE</code> filtration after full join. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/20497" target="_blank" rel="noopener noreferrer">#20497</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20622" target="_blank" rel="noopener noreferrer">#20622</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">Vladimir</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-7">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-7" title="Direct link to heading">​</a></h4><ul><li>Add <a href="https://github.com/jepsen-io/jepsen" target="_blank" rel="noopener noreferrer">Jepsen</a> tests for ClickHouse Keeper. <a href="https://github.com/ClickHouse/ClickHouse/pull/21677" target="_blank" rel="noopener noreferrer">#21677</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Run stateless tests in parallel in CI. Depends on <a href="https://github.com/ClickHouse/ClickHouse/issues/22181" target="_blank" rel="noopener noreferrer">#22181</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22300" target="_blank" rel="noopener noreferrer">#22300</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Enable status check for <a href="https://github.com/sqlancer/sqlancer" target="_blank" rel="noopener noreferrer">SQLancer</a> CI run. <a href="https://github.com/ClickHouse/ClickHouse/pull/22015" target="_blank" rel="noopener noreferrer">#22015</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Multiple preparations for PowerPC builds: Enable the bundled openldap on <code>ppc64le</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22487" target="_blank" rel="noopener noreferrer">#22487</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>).  Enable compiling on <code>ppc64le</code> with Clang. <a href="https://github.com/ClickHouse/ClickHouse/pull/22476" target="_blank" rel="noopener noreferrer">#22476</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>). Fix compiling boost on <code>ppc64le</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22474" target="_blank" rel="noopener noreferrer">#22474</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>). Fix CMake error about internal CMake variable <code>CMAKE_ASM_COMPILE_OBJECT</code> not set on <code>ppc64le</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22469" target="_blank" rel="noopener noreferrer">#22469</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>). Fix Fedora/RHEL/CentOS not finding <code>libclang_rt.builtins</code> on <code>ppc64le</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22458" target="_blank" rel="noopener noreferrer">#22458</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>).  Enable building with <code>jemalloc</code> on <code>ppc64le</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22447" target="_blank" rel="noopener noreferrer">#22447</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>). Fix ClickHouse&#x27;s config embedding and cctz&#x27;s timezone embedding on <code>ppc64le</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22445" target="_blank" rel="noopener noreferrer">#22445</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>). Fixed compiling on <code>ppc64le</code> and use the correct instruction pointer register on <code>ppc64le</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22430" target="_blank" rel="noopener noreferrer">#22430</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>).</li><li>Re-enable the S3 (AWS) library on <code>aarch64</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22484" target="_blank" rel="noopener noreferrer">#22484</a> (<a href="https://github.com/mastertheknife" target="_blank" rel="noopener noreferrer">Kfir Itzhak</a>).</li><li>Add <code>tzdata</code> to Docker containers because reading <code>ORC</code> formats requires it. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14156" target="_blank" rel="noopener noreferrer">#14156</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/22000" target="_blank" rel="noopener noreferrer">#22000</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Introduce 2 arguments for <code>clickhouse-server</code> image Dockerfile: <code>deb_location</code> &amp; <code>single_binary_location</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21977" target="_blank" rel="noopener noreferrer">#21977</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Allow to use clang-tidy with release builds by enabling assertions if it is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/21914" target="_blank" rel="noopener noreferrer">#21914</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add llvm-12 binaries name to search in cmake scripts. Implicit constants conversions to mute clang warnings. Updated submodules to build with CMake 3.19. Mute recursion in macro expansion in <code>readpassphrase</code> library. Deprecated <code>-fuse-ld</code> changed to <code>--ld-path</code> for clang. <a href="https://github.com/ClickHouse/ClickHouse/pull/21597" target="_blank" rel="noopener noreferrer">#21597</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Updating <code>docker/test/testflows/runner/dockerd-entrypoint.sh</code> to use Yandex dockerhub-proxy, because Docker Hub has enabled very restrictive rate limits <a href="https://github.com/ClickHouse/ClickHouse/pull/21551" target="_blank" rel="noopener noreferrer">#21551</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Fix macOS shared lib build. <a href="https://github.com/ClickHouse/ClickHouse/pull/20184" target="_blank" rel="noopener noreferrer">#20184</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Add <code>ctime</code> option to <code>zookeeper-dump-tree</code>. It allows to dump node creation time. <a href="https://github.com/ClickHouse/ClickHouse/pull/21842" target="_blank" rel="noopener noreferrer">#21842</a> (<a href="https://github.com/HumanUser" target="_blank" rel="noopener noreferrer">Ilya</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-213-lts">ClickHouse release 21.3 (LTS)<a class="hash-link" href="#clickhouse-release-213-lts" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v213-2021-03-12">ClickHouse release v21.3, 2021-03-12<a class="hash-link" href="#clickhouse-release-v213-2021-03-12" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-8">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-8" title="Direct link to heading">​</a></h4><ul><li>Now it&#x27;s not allowed to create MergeTree tables in old syntax with table TTL because it&#x27;s just ignored. Attach of old tables is still possible. <a href="https://github.com/ClickHouse/ClickHouse/pull/20282" target="_blank" rel="noopener noreferrer">#20282</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now all case-insensitive function names will be rewritten to their canonical representations. This is needed for projection query routing (the upcoming feature). <a href="https://github.com/ClickHouse/ClickHouse/pull/20174" target="_blank" rel="noopener noreferrer">#20174</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix creation of <code>TTL</code> in cases, when its expression is a function and it is the same as <code>ORDER BY</code> key. Now it&#x27;s allowed to set custom aggregation to primary key columns in <code>TTL</code> with <code>GROUP BY</code>. Backward incompatible: For primary key columns, which are not in <code>GROUP BY</code> and aren&#x27;t set explicitly now is applied function <code>any</code> instead of <code>max</code>, when TTL is expired. Also if you use TTL with <code>WHERE</code> or <code>GROUP BY</code> you can see exceptions at merges, while making rolling update. <a href="https://github.com/ClickHouse/ClickHouse/pull/15450" target="_blank" rel="noopener noreferrer">#15450</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-8">New Feature<a class="hash-link" href="#new-feature-8" title="Direct link to heading">​</a></h4><ul><li>Add file engine settings: <code>engine_file_empty_if_not_exists</code> and <code>engine_file_truncate_on_insert</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20620" target="_blank" rel="noopener noreferrer">#20620</a> (<a href="https://github.com/M0r64n" target="_blank" rel="noopener noreferrer">M0r64n</a>).</li><li>Add aggregate function <code>deltaSum</code> for summing the differences between consecutive rows. <a href="https://github.com/ClickHouse/ClickHouse/pull/20057" target="_blank" rel="noopener noreferrer">#20057</a> (<a href="https://github.com/rf" target="_blank" rel="noopener noreferrer">Russ Frank</a>).</li><li>New <code>event_time_microseconds</code> column in <code>system.part_log</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/20027" target="_blank" rel="noopener noreferrer">#20027</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Added <code>timezoneOffset(datetime)</code> function which will give the offset from UTC in seconds. This close <a href="https://github.com/ClickHouse/ClickHouse/issues/19850" target="_blank" rel="noopener noreferrer">#issue:19850</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19962" target="_blank" rel="noopener noreferrer">#19962</a> (<a href="https://github.com/keen-wolf" target="_blank" rel="noopener noreferrer">keenwolf</a>).</li><li>Add setting <code>insert_shard_id</code> to support insert data into specific shard from distributed table. <a href="https://github.com/ClickHouse/ClickHouse/pull/19961" target="_blank" rel="noopener noreferrer">#19961</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Function <code>reinterpretAs</code> updated to support big integers. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19691" target="_blank" rel="noopener noreferrer">#19691</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19858" target="_blank" rel="noopener noreferrer">#19858</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added Server Side Encryption Customer Keys (the <code>x-amz-server-side-encryption-customer-(key/md5)</code> header) support in S3 client. See <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerSideEncryptionCustomerKeys.html" target="_blank" rel="noopener noreferrer">the link</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19428" target="_blank" rel="noopener noreferrer">#19428</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19748" target="_blank" rel="noopener noreferrer">#19748</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Added <code>implicit_key</code> option for <code>executable</code> dictionary source. It allows to avoid printing key for every record if records comes in the same order as the input keys. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/14527" target="_blank" rel="noopener noreferrer">#14527</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19677" target="_blank" rel="noopener noreferrer">#19677</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add quota type <code>query_selects</code> and <code>query_inserts</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19603" target="_blank" rel="noopener noreferrer">#19603</a> (<a href="https://github.com/JackyWoo" target="_blank" rel="noopener noreferrer">JackyWoo</a>).</li><li>Add function <code>extractTextFromHTML</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/19600" target="_blank" rel="noopener noreferrer">#19600</a> (<a href="https://github.com/zlx19950903" target="_blank" rel="noopener noreferrer">zlx19950903</a>), (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Tables with <code>MergeTree*</code> engine now have two new table-level settings for query concurrency control. Setting <code>max_concurrent_queries</code> limits the number of concurrently executed queries which are related to this table. Setting <code>min_marks_to_honor_max_concurrent_queries</code> tells to apply previous setting only if query reads at least this number of marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/19544" target="_blank" rel="noopener noreferrer">#19544</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added <code>file</code> function to read file from user_files directory as a String. This is different from the <code>file</code> table function. This implements <a href="https://github.com/ClickHouse/ClickHouse/issues/18851" target="_blank" rel="noopener noreferrer">#issue:18851</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19204" target="_blank" rel="noopener noreferrer">#19204</a> (<a href="https://github.com/keen-wolf" target="_blank" rel="noopener noreferrer">keenwolf</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-7">Experimental feature<a class="hash-link" href="#experimental-feature-7" title="Direct link to heading">​</a></h4><ul><li>Add experimental <code>Replicated</code> database engine. It replicates DDL queries across multiple hosts. <a href="https://github.com/ClickHouse/ClickHouse/pull/16193" target="_blank" rel="noopener noreferrer">#16193</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Introduce experimental support for window functions, enabled with <code>allow_experimental_window_functions = 1</code>. This is a preliminary, alpha-quality implementation that is not suitable for production use and will change in backward-incompatible ways in future releases. Please see <a href="https://github.com/ClickHouse/ClickHouse/blob/master/docs/en/sql-reference/window-functions/index.md#experimental-window-functions" target="_blank" rel="noopener noreferrer">the documentation</a> for the list of supported features. <a href="https://github.com/ClickHouse/ClickHouse/pull/20337" target="_blank" rel="noopener noreferrer">#20337</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Add the ability to backup/restore metadata files for DiskS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/18377" target="_blank" rel="noopener noreferrer">#18377</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-8">Performance Improvement<a class="hash-link" href="#performance-improvement-8" title="Direct link to heading">​</a></h4><ul><li>Hedged requests for remote queries. When setting <code>use_hedged_requests</code> enabled (off by default), allow to establish many connections with different replicas for query. New connection is enabled in case existent connection(s) with replica(s) were not established within <code>hedged_connection_timeout</code> or no data was received within <code>receive_data_timeout</code>. Query uses the first connection which send non empty progress packet (or data packet, if <code>allow_changing_replica_until_first_data_packet</code>); other connections are cancelled. Queries with <code>max_parallel_replicas &gt; 1</code> are supported. <a href="https://github.com/ClickHouse/ClickHouse/pull/19291" target="_blank" rel="noopener noreferrer">#19291</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>). This allows to significantly reduce tail latencies on very large clusters.</li><li>Added support for <code>PREWHERE</code> (and enable the corresponding optimization) when tables have row-level security expressions specified. <a href="https://github.com/ClickHouse/ClickHouse/pull/19576" target="_blank" rel="noopener noreferrer">#19576</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>The setting <code>distributed_aggregation_memory_efficient</code> is enabled by default. It will lower memory usage and improve performance of distributed queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/20599" target="_blank" rel="noopener noreferrer">#20599</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve performance of GROUP BY multiple fixed size keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/20472" target="_blank" rel="noopener noreferrer">#20472</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve performance of aggregate functions by more strict aliasing. <a href="https://github.com/ClickHouse/ClickHouse/pull/19946" target="_blank" rel="noopener noreferrer">#19946</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Speed up reading from <code>Memory</code> tables in extreme cases (when reading speed is in order of 50 GB/sec) by simplification of pipeline and (consequently) less lock contention in pipeline scheduling. <a href="https://github.com/ClickHouse/ClickHouse/pull/20468" target="_blank" rel="noopener noreferrer">#20468</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Partially reimplement HTTP server to make it making less copies of incoming and outgoing data. It gives up to 1.5 performance improvement on inserting long records over HTTP. <a href="https://github.com/ClickHouse/ClickHouse/pull/19516" target="_blank" rel="noopener noreferrer">#19516</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Add <code>compress</code> setting for <code>Memory</code> tables. If it&#x27;s enabled the table will use less RAM. On some machines and datasets it can also work faster on SELECT, but it is not always the case. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20093" target="_blank" rel="noopener noreferrer">#20093</a>. Note: there are reasons why Memory tables can work slower than MergeTree: (1) lack of compression (2) static size of blocks (3) lack of indices and prewhere... <a href="https://github.com/ClickHouse/ClickHouse/pull/20168" target="_blank" rel="noopener noreferrer">#20168</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Slightly better code in aggregation. <a href="https://github.com/ClickHouse/ClickHouse/pull/20978" target="_blank" rel="noopener noreferrer">#20978</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add back <code>intDiv</code>/<code>modulo</code> specializations for better performance. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21293" target="_blank" rel="noopener noreferrer">#21293</a> . The regression was introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/18145" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/18145</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/21307" target="_blank" rel="noopener noreferrer">#21307</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Do not squash blocks too much on INSERT SELECT if inserting into Memory table. In previous versions inefficient data representation was created in Memory table after INSERT SELECT. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13052" target="_blank" rel="noopener noreferrer">#13052</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20169" target="_blank" rel="noopener noreferrer">#20169</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix at least one case when DataType parser may have exponential complexity (found by fuzzer). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20096" target="_blank" rel="noopener noreferrer">#20096</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20132" target="_blank" rel="noopener noreferrer">#20132</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Parallelize SELECT with FINAL for single part with level &gt; 0 when <code>do_not_merge_across_partitions_select_final</code> setting is 1. <a href="https://github.com/ClickHouse/ClickHouse/pull/19375" target="_blank" rel="noopener noreferrer">#19375</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Fill only requested columns when querying <code>system.parts</code> and <code>system.parts_columns</code>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19570" target="_blank" rel="noopener noreferrer">#19570</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21035" target="_blank" rel="noopener noreferrer">#21035</a> (<a href="https://github.com/anmolarora" target="_blank" rel="noopener noreferrer">Anmol Arora</a>).</li><li>Perform algebraic optimizations of arithmetic expressions inside <code>avg</code> aggregate function. close <a href="https://github.com/ClickHouse/ClickHouse/issues/20092" target="_blank" rel="noopener noreferrer">#20092</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20183" target="_blank" rel="noopener noreferrer">#20183</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-8">Improvement<a class="hash-link" href="#improvement-8" title="Direct link to heading">​</a></h4><ul><li>Case-insensitive compression methods for table functions. Also fixed LZMA compression method which was checked in upper case. <a href="https://github.com/ClickHouse/ClickHouse/pull/21416" target="_blank" rel="noopener noreferrer">#21416</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Add two settings to delay or throw error during insertion when there are too many inactive parts. This is useful when server fails to clean up parts quickly enough. <a href="https://github.com/ClickHouse/ClickHouse/pull/20178" target="_blank" rel="noopener noreferrer">#20178</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Provide better compatibility for mysql clients. 1. mysql jdbc 2. mycli. <a href="https://github.com/ClickHouse/ClickHouse/pull/21367" target="_blank" rel="noopener noreferrer">#21367</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Forbid to drop a column if it&#x27;s referenced by materialized view. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21164" target="_blank" rel="noopener noreferrer">#21164</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21303" target="_blank" rel="noopener noreferrer">#21303</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>MySQL dictionary source will now retry unexpected connection failures (Lost connection to MySQL server during query) which sometimes happen on SSL/TLS connections. <a href="https://github.com/ClickHouse/ClickHouse/pull/21237" target="_blank" rel="noopener noreferrer">#21237</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Usability improvement: more consistent <code>DateTime64</code> parsing: recognize the case when unix timestamp with subsecond resolution is specified as scaled integer (like <code>1111111111222</code> instead of <code>1111111111.222</code>). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13194" target="_blank" rel="noopener noreferrer">#13194</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21053" target="_blank" rel="noopener noreferrer">#21053</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Do only merging of sorted blocks on initiator with distributed_group_by_no_merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/20882" target="_blank" rel="noopener noreferrer">#20882</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>When loading config for mysql source ClickHouse will now randomize the list of replicas with the same priority to ensure the round-robin logics of picking mysql endpoint. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20629" target="_blank" rel="noopener noreferrer">#20629</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20632" target="_blank" rel="noopener noreferrer">#20632</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Function &#x27;reinterpretAs(x, Type)&#x27; renamed into &#x27;reinterpret(x, Type)&#x27;. <a href="https://github.com/ClickHouse/ClickHouse/pull/20611" target="_blank" rel="noopener noreferrer">#20611</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Support vhost for RabbitMQ engine <a href="https://github.com/ClickHouse/ClickHouse/issues/20576" target="_blank" rel="noopener noreferrer">#20576</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20596" target="_blank" rel="noopener noreferrer">#20596</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Improved serialization for data types combined of Arrays and Tuples. Improved matching enum data types to protobuf enum type. Fixed serialization of the <code>Map</code> data type. Omitted values are now set by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/20506" target="_blank" rel="noopener noreferrer">#20506</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed race between execution of distributed DDL tasks and cleanup of DDL queue. Now DDL task cannot be removed from ZooKeeper if there are active workers. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20016" target="_blank" rel="noopener noreferrer">#20016</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20448" target="_blank" rel="noopener noreferrer">#20448</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Make FQDN and other DNS related functions work correctly in alpine images. <a href="https://github.com/ClickHouse/ClickHouse/pull/20336" target="_blank" rel="noopener noreferrer">#20336</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Do not allow early constant folding of explicitly forbidden functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/20303" target="_blank" rel="noopener noreferrer">#20303</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Implicit conversion from integer to Decimal type might succeeded if integer value doe not fit into Decimal type. Now it throws <code>ARGUMENT_OUT_OF_BOUND</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20232" target="_blank" rel="noopener noreferrer">#20232</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Lockless <code>SYSTEM FLUSH DISTRIBUTED</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20215" target="_blank" rel="noopener noreferrer">#20215</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Normalize count(constant), sum(1) to count(). This is needed for projection query routing. <a href="https://github.com/ClickHouse/ClickHouse/pull/20175" target="_blank" rel="noopener noreferrer">#20175</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support all native integer types in bitmap functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/20171" target="_blank" rel="noopener noreferrer">#20171</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Updated <code>CacheDictionary</code>, <code>ComplexCacheDictionary</code>, <code>SSDCacheDictionary</code>, <code>SSDComplexKeyDictionary</code> to use LRUHashMap as underlying index. <a href="https://github.com/ClickHouse/ClickHouse/pull/20164" target="_blank" rel="noopener noreferrer">#20164</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>The setting <code>access_management</code> is now configurable on startup by providing <code>CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT</code>, defaults to disabled (<code>0</code>) which was the prior value. <a href="https://github.com/ClickHouse/ClickHouse/pull/20139" target="_blank" rel="noopener noreferrer">#20139</a> (<a href="https://github.com/sonirico" target="_blank" rel="noopener noreferrer">Marquitos</a>).</li><li>Fix toDateTime64(toDate()/toDateTime()) for DateTime64 - Implement DateTime64 clamping to match DateTime behaviour. <a href="https://github.com/ClickHouse/ClickHouse/pull/20131" target="_blank" rel="noopener noreferrer">#20131</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Quota improvements: SHOW TABLES is now considered as one query in the quota calculations, not two queries. SYSTEM queries now consume quota. Fix calculation of interval&#x27;s end in quota consumption. <a href="https://github.com/ClickHouse/ClickHouse/pull/20106" target="_blank" rel="noopener noreferrer">#20106</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Supports <code>path IN (set)</code> expressions for <code>system.zookeeper</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/20105" target="_blank" rel="noopener noreferrer">#20105</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>).</li><li>Show full details of <code>MaterializeMySQL</code> tables in <code>system.tables</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20051" target="_blank" rel="noopener noreferrer">#20051</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li><li>Fix data race in executable dictionary that was possible only on misuse (when the script returns data ignoring its input). <a href="https://github.com/ClickHouse/ClickHouse/pull/20045" target="_blank" rel="noopener noreferrer">#20045</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>The value of MYSQL_OPT_RECONNECT option can now be controlled by &quot;opt_reconnect&quot; parameter in the config section of mysql replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/19998" target="_blank" rel="noopener noreferrer">#19998</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>If user calls <code>JSONExtract</code> function with <code>Float32</code> type requested, allow inaccurate conversion to the result type. For example the number <code>0.1</code> in JSON is double precision and is not representable in Float32, but the user still wants to get it. Previous versions return 0 for non-Nullable type and NULL for Nullable type to indicate that conversion is imprecise. The logic was 100% correct but it was surprising to users and leading to questions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13962" target="_blank" rel="noopener noreferrer">#13962</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19960" target="_blank" rel="noopener noreferrer">#19960</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add conversion of block structure for INSERT into Distributed tables if it does not match. <a href="https://github.com/ClickHouse/ClickHouse/pull/19947" target="_blank" rel="noopener noreferrer">#19947</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improvement for the <code>system.distributed_ddl_queue</code> table. Initialize MaxDDLEntryID to the last value after restarting. Before this PR, MaxDDLEntryID will remain zero until a new DDLTask is processed. <a href="https://github.com/ClickHouse/ClickHouse/pull/19924" target="_blank" rel="noopener noreferrer">#19924</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Show <code>MaterializeMySQL</code> tables in <code>system.parts</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19770" target="_blank" rel="noopener noreferrer">#19770</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li><li>Add separate config directive for <code>Buffer</code> profile. <a href="https://github.com/ClickHouse/ClickHouse/pull/19721" target="_blank" rel="noopener noreferrer">#19721</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Move conditions that are not related to JOIN to WHERE clause. <a href="https://github.com/ClickHouse/ClickHouse/issues/18720" target="_blank" rel="noopener noreferrer">#18720</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19685" target="_blank" rel="noopener noreferrer">#19685</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Add ability to throttle INSERT into Distributed based on amount of pending bytes for async send (<code>bytes_to_delay_insert</code>/<code>max_delay_to_insert</code> and <code>bytes_to_throw_insert</code> settings for <code>Distributed</code> engine has been added). <a href="https://github.com/ClickHouse/ClickHouse/pull/19673" target="_blank" rel="noopener noreferrer">#19673</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix some rare cases when write errors can be ignored in destructors. <a href="https://github.com/ClickHouse/ClickHouse/pull/19451" target="_blank" rel="noopener noreferrer">#19451</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Print inline frames in stack traces for fatal errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/19317" target="_blank" rel="noopener noreferrer">#19317</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-7">Bug Fix<a class="hash-link" href="#bug-fix-7" title="Direct link to heading">​</a></h4><ul><li>Fix redundant reconnects to ZooKeeper and the possibility of two active sessions for a single clickhouse server. Both problems introduced in #14678. <a href="https://github.com/ClickHouse/ClickHouse/pull/21264" target="_blank" rel="noopener noreferrer">#21264</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix error <code>Bad cast from type ... to DB::ColumnLowCardinality</code> while inserting into table with <code>LowCardinality</code> column from <code>Values</code> format. Fixes #21140 <a href="https://github.com/ClickHouse/ClickHouse/pull/21357" target="_blank" rel="noopener noreferrer">#21357</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix a deadlock in <code>ALTER DELETE</code> mutations for non replicated MergeTree table engines when the predicate contains the table itself. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20558" target="_blank" rel="noopener noreferrer">#20558</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21477" target="_blank" rel="noopener noreferrer">#21477</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix SIGSEGV for distributed queries on failures. <a href="https://github.com/ClickHouse/ClickHouse/pull/21434" target="_blank" rel="noopener noreferrer">#21434</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Now <code>ALTER MODIFY COLUMN</code> queries will correctly affect changes in partition key, skip indices, TTLs, and so on. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13675" target="_blank" rel="noopener noreferrer">#13675</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21334" target="_blank" rel="noopener noreferrer">#21334</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug with <code>join_use_nulls</code> and joining <code>TOTALS</code> from subqueries. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19362" target="_blank" rel="noopener noreferrer">#19362</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/21137" target="_blank" rel="noopener noreferrer">#21137</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21248" target="_blank" rel="noopener noreferrer">#21248</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Fix crash in <code>EXPLAIN</code> for query with <code>UNION</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20876" target="_blank" rel="noopener noreferrer">#20876</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/21170" target="_blank" rel="noopener noreferrer">#21170</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21246" target="_blank" rel="noopener noreferrer">#21246</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Now mutations allowed only for table engines that support them (MergeTree family, Memory, MaterializedView). Other engines will report a more clear error. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21168" target="_blank" rel="noopener noreferrer">#21168</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21183" target="_blank" rel="noopener noreferrer">#21183</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21112" target="_blank" rel="noopener noreferrer">#21112</a>. Fixed bug that could cause duplicates with insert query (if one of the callbacks came a little too late). <a href="https://github.com/ClickHouse/ClickHouse/pull/21138" target="_blank" rel="noopener noreferrer">#21138</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix <code>input_format_null_as_default</code> take effective when types are nullable. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21116" target="_blank" rel="noopener noreferrer">#21116</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/21121" target="_blank" rel="noopener noreferrer">#21121</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>fix bug related to cast Tuple to Map. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/21029" target="_blank" rel="noopener noreferrer">#21029</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21120" target="_blank" rel="noopener noreferrer">#21120</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix the metadata leak when the Replicated*MergeTree with custom (non default) ZooKeeper cluster is dropped. <a href="https://github.com/ClickHouse/ClickHouse/pull/21119" target="_blank" rel="noopener noreferrer">#21119</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Fix type mismatch issue when using LowCardinality keys in joinGet. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/21114" target="_blank" rel="noopener noreferrer">#21114</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21117" target="_blank" rel="noopener noreferrer">#21117</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>fix default_replica_path and default_replica_name values are useless on Replicated(*)MergeTree engine when the engine needs specify other parameters. <a href="https://github.com/ClickHouse/ClickHouse/pull/21060" target="_blank" rel="noopener noreferrer">#21060</a> (<a href="https://github.com/mxzlxy" target="_blank" rel="noopener noreferrer">mxzlxy</a>).</li><li>Out of bound memory access was possible when formatting specifically crafted out of range value of type <code>DateTime64</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20494" target="_blank" rel="noopener noreferrer">#20494</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20543" target="_blank" rel="noopener noreferrer">#20543</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/21023" target="_blank" rel="noopener noreferrer">#21023</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Block parallel insertions into storage join. <a href="https://github.com/ClickHouse/ClickHouse/pull/21009" target="_blank" rel="noopener noreferrer">#21009</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Fixed behaviour, when <code>ALTER MODIFY COLUMN</code> created mutation, that will knowingly fail. <a href="https://github.com/ClickHouse/ClickHouse/pull/21007" target="_blank" rel="noopener noreferrer">#21007</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9969" target="_blank" rel="noopener noreferrer">#9969</a>. Fixed Brotli http compression error, which reproduced for large data sizes, slightly complicated structure and with json output format. Update Brotli to the latest version to include the &quot;fix rare access to uninitialized data in ring-buffer&quot;. <a href="https://github.com/ClickHouse/ClickHouse/pull/20991" target="_blank" rel="noopener noreferrer">#20991</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix &#x27;Empty task was returned from async task queue&#x27; on query cancellation. <a href="https://github.com/ClickHouse/ClickHouse/pull/20881" target="_blank" rel="noopener noreferrer">#20881</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li><code>USE database;</code> query did not work when using MySQL 5.7 client to connect to ClickHouse server, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18926" target="_blank" rel="noopener noreferrer">#18926</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20878" target="_blank" rel="noopener noreferrer">#20878</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix usage of <code>-Distinct</code> combinator with <code>-State</code> combinator in aggregate functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/20866" target="_blank" rel="noopener noreferrer">#20866</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix subquery with union distinct and limit clause. close <a href="https://github.com/ClickHouse/ClickHouse/issues/20597" target="_blank" rel="noopener noreferrer">#20597</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20610" target="_blank" rel="noopener noreferrer">#20610</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Fixed inconsistent behavior of dictionary in case of queries where we look for absent keys in dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/20578" target="_blank" rel="noopener noreferrer">#20578</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix the number of threads for scalar subqueries and subqueries for index (after <a href="https://github.com/ClickHouse/ClickHouse/issues/19007" target="_blank" rel="noopener noreferrer">#19007</a> single thread was always used). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20457" target="_blank" rel="noopener noreferrer">#20457</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/20512" target="_blank" rel="noopener noreferrer">#20512</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20550" target="_blank" rel="noopener noreferrer">#20550</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix crash which could happen if unknown packet was received from remove query (was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/17868" target="_blank" rel="noopener noreferrer">#17868</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/20547" target="_blank" rel="noopener noreferrer">#20547</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add proper checks while parsing directory names for async INSERT (fixes SIGSEGV). <a href="https://github.com/ClickHouse/ClickHouse/pull/20498" target="_blank" rel="noopener noreferrer">#20498</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix function <code>transform</code> does not work properly for floating point keys. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20460" target="_blank" rel="noopener noreferrer">#20460</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20479" target="_blank" rel="noopener noreferrer">#20479</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Fix infinite loop when propagating WITH aliases to subqueries. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20388" target="_blank" rel="noopener noreferrer">#20388</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20476" target="_blank" rel="noopener noreferrer">#20476</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix abnormal server termination when http client goes away. <a href="https://github.com/ClickHouse/ClickHouse/pull/20464" target="_blank" rel="noopener noreferrer">#20464</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>LOGICAL_ERROR</code> for <code>join_use_nulls=1</code> when JOIN contains const from SELECT. <a href="https://github.com/ClickHouse/ClickHouse/pull/20461" target="_blank" rel="noopener noreferrer">#20461</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Check if table function <code>view</code> is used in expression list and throw an error. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20342" target="_blank" rel="noopener noreferrer">#20342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20350" target="_blank" rel="noopener noreferrer">#20350</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Avoid invalid dereference in RANGE_HASHED() dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/20345" target="_blank" rel="noopener noreferrer">#20345</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix null dereference with <code>join_use_nulls=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20344" target="_blank" rel="noopener noreferrer">#20344</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix incorrect result of binary operations between two constant decimals of different scale. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20283" target="_blank" rel="noopener noreferrer">#20283</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20339" target="_blank" rel="noopener noreferrer">#20339</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix too often retries of failed background tasks for <code>ReplicatedMergeTree</code> table engines family. This could lead to too verbose logging and increased CPU load. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20203" target="_blank" rel="noopener noreferrer">#20203</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20335" target="_blank" rel="noopener noreferrer">#20335</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Restrict to <code>DROP</code> or <code>RENAME</code> version column of <code>*CollapsingMergeTree</code> and <code>ReplacingMergeTree</code> table engines. <a href="https://github.com/ClickHouse/ClickHouse/pull/20300" target="_blank" rel="noopener noreferrer">#20300</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed the behavior when in case of broken JSON we tried to read the whole file into memory which leads to exception from the allocator. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19719" target="_blank" rel="noopener noreferrer">#19719</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20286" target="_blank" rel="noopener noreferrer">#20286</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix exception during vertical merge for <code>MergeTree</code> table engines family which don&#x27;t allow to perform vertical merges. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20259" target="_blank" rel="noopener noreferrer">#20259</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20279" target="_blank" rel="noopener noreferrer">#20279</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix rare server crash on config reload during the shutdown. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19689" target="_blank" rel="noopener noreferrer">#19689</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20224" target="_blank" rel="noopener noreferrer">#20224</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix CTE when using in INSERT SELECT. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20187" target="_blank" rel="noopener noreferrer">#20187</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/20195" target="_blank" rel="noopener noreferrer">#20195</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20211" target="_blank" rel="noopener noreferrer">#20211</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19314" target="_blank" rel="noopener noreferrer">#19314</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20156" target="_blank" rel="noopener noreferrer">#20156</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>fix toMinute function to handle special timezone correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/20149" target="_blank" rel="noopener noreferrer">#20149</a> (<a href="https://github.com/keen-wolf" target="_blank" rel="noopener noreferrer">keenwolf</a>).</li><li>Fix server crash after query with <code>if</code> function with <code>Tuple</code> type of then/else branches result. <code>Tuple</code> type must contain <code>Array</code> or another complex type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18356" target="_blank" rel="noopener noreferrer">#18356</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20133" target="_blank" rel="noopener noreferrer">#20133</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>The <code>MongoDB</code> table engine now establishes connection only when it&#x27;s going to read data. <code>ATTACH TABLE</code> won&#x27;t try to connect anymore. <a href="https://github.com/ClickHouse/ClickHouse/pull/20110" target="_blank" rel="noopener noreferrer">#20110</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Bugfix in StorageJoin. <a href="https://github.com/ClickHouse/ClickHouse/pull/20079" target="_blank" rel="noopener noreferrer">#20079</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Fix the case when calculating modulo of division of negative number by small divisor, the resulting data type was not large enough to accomodate the negative result. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/20052" target="_blank" rel="noopener noreferrer">#20052</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20067" target="_blank" rel="noopener noreferrer">#20067</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>MaterializeMySQL: Fix replication for statements that update several tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/20066" target="_blank" rel="noopener noreferrer">#20066</a> (<a href="https://github.com/havardk" target="_blank" rel="noopener noreferrer">Håvard Kvålen</a>).</li><li>Prevent &quot;Connection refused&quot; in docker during initialization script execution. <a href="https://github.com/ClickHouse/ClickHouse/pull/20012" target="_blank" rel="noopener noreferrer">#20012</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li><code>EmbeddedRocksDB</code> is an experimental storage. Fix the issue with lack of proper type checking. Simplified code. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19967" target="_blank" rel="noopener noreferrer">#19967</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19972" target="_blank" rel="noopener noreferrer">#19972</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix a segfault in function <code>fromModifiedJulianDay</code> when the argument type is <code>Nullable(T)</code> for any integral types other than Int32. <a href="https://github.com/ClickHouse/ClickHouse/pull/19959" target="_blank" rel="noopener noreferrer">#19959</a> (<a href="https://github.com/depressed-pho" target="_blank" rel="noopener noreferrer">PHO</a>).</li><li>BloomFilter index crash fix. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19757" target="_blank" rel="noopener noreferrer">#19757</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19884" target="_blank" rel="noopener noreferrer">#19884</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Deadlock was possible if system.text_log is enabled. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19874" target="_blank" rel="noopener noreferrer">#19874</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19875" target="_blank" rel="noopener noreferrer">#19875</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix starting the server with tables having default expressions containing dictGet(). Allow getting return type of dictGet() without loading dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/19805" target="_blank" rel="noopener noreferrer">#19805</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix clickhouse-client abort exception while executing only <code>select</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19790" target="_blank" rel="noopener noreferrer">#19790</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li><li>Fix a bug that moving pieces to destination table may failed in case of launching multiple clickhouse-copiers. <a href="https://github.com/ClickHouse/ClickHouse/pull/19743" target="_blank" rel="noopener noreferrer">#19743</a> (<a href="https://github.com/mdianjun" target="_blank" rel="noopener noreferrer">madianjun</a>).</li><li>Background thread which executes <code>ON CLUSTER</code> queries might hang waiting for dropped replicated table to do something. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/19684" target="_blank" rel="noopener noreferrer">#19684</a> (<a href="https://github.com/yiguolei" target="_blank" rel="noopener noreferrer">yiguolei</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-8">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-8" title="Direct link to heading">​</a></h4><ul><li>Allow to build ClickHouse with AVX-2 enabled globally. It gives slight performance benefits on modern CPUs. Not recommended for production and will not be supported as official build for now. <a href="https://github.com/ClickHouse/ClickHouse/pull/20180" target="_blank" rel="noopener noreferrer">#20180</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix some of the issues found by Coverity. See <a href="https://github.com/ClickHouse/ClickHouse/issues/19964" target="_blank" rel="noopener noreferrer">#19964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20010" target="_blank" rel="noopener noreferrer">#20010</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow to start up with modified binary under gdb. In previous version if you set up breakpoint in gdb before start, server will refuse to start up due to failed integrity check. <a href="https://github.com/ClickHouse/ClickHouse/pull/21258" target="_blank" rel="noopener noreferrer">#21258</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add a test for different compression methods in Kafka. <a href="https://github.com/ClickHouse/ClickHouse/pull/21111" target="_blank" rel="noopener noreferrer">#21111</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed port clash from test_storage_kerberized_hdfs test. <a href="https://github.com/ClickHouse/ClickHouse/pull/19974" target="_blank" rel="noopener noreferrer">#19974</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Print <code>stdout</code> and <code>stderr</code> to log when failed to start docker in integration tests. Before this PR there was a very short error message in this case which didn&#x27;t help to investigate the problems. <a href="https://github.com/ClickHouse/ClickHouse/pull/20631" target="_blank" rel="noopener noreferrer">#20631</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-212">ClickHouse release 21.2<a class="hash-link" href="#clickhouse-release-212" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v21228-stable-2021-02-07">ClickHouse release v21.2.2.8-stable, 2021-02-07<a class="hash-link" href="#clickhouse-release-v21228-stable-2021-02-07" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-9">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-9" title="Direct link to heading">​</a></h4><ul><li>Bitwise functions (<code>bitAnd</code>, <code>bitOr</code>, etc) are forbidden for floating point arguments. Now you have to do explicit cast to integer. <a href="https://github.com/ClickHouse/ClickHouse/pull/19853" target="_blank" rel="noopener noreferrer">#19853</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Forbid <code>lcm</code>/<code>gcd</code> for floats. <a href="https://github.com/ClickHouse/ClickHouse/pull/19532" target="_blank" rel="noopener noreferrer">#19532</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix memory tracking for <code>OPTIMIZE TABLE</code>/merges; account query memory limits and sampling for <code>OPTIMIZE TABLE</code>/merges. <a href="https://github.com/ClickHouse/ClickHouse/pull/18772" target="_blank" rel="noopener noreferrer">#18772</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Disallow floating point column as partition key, see <a href="https://github.com/ClickHouse/ClickHouse/issues/18421#event-4147046255" target="_blank" rel="noopener noreferrer">#18421</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18464" target="_blank" rel="noopener noreferrer">#18464</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Excessive parenthesis in type definitions no longer supported, example: <code>Array((UInt8))</code>.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-9">New Feature<a class="hash-link" href="#new-feature-9" title="Direct link to heading">​</a></h4><ul><li>Added <code>PostgreSQL</code> table engine (both select/insert, with support for multidimensional arrays), also as table function. Added <code>PostgreSQL</code> dictionary source. Added <code>PostgreSQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/18554" target="_blank" rel="noopener noreferrer">#18554</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Data type <code>Nested</code> now supports arbitrary levels of nesting. Introduced subcolumns of complex types, such as <code>size0</code> in <code>Array</code>, <code>null</code> in <code>Nullable</code>, names of <code>Tuple</code> elements, which can be read without reading of whole column. <a href="https://github.com/ClickHouse/ClickHouse/pull/17310" target="_blank" rel="noopener noreferrer">#17310</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Added <code>Nullable</code> support for <code>FlatDictionary</code>, <code>HashedDictionary</code>, <code>ComplexKeyHashedDictionary</code>, <code>DirectDictionary</code>, <code>ComplexKeyDirectDictionary</code>, <code>RangeHashedDictionary</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18236" target="_blank" rel="noopener noreferrer">#18236</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Adds a new table called <code>system.distributed_ddl_queue</code> that displays the queries in the DDL worker queue. <a href="https://github.com/ClickHouse/ClickHouse/pull/17656" target="_blank" rel="noopener noreferrer">#17656</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Added support of mapping LDAP group names, and attribute values in general, to local roles for users from ldap user directories. <a href="https://github.com/ClickHouse/ClickHouse/pull/17211" target="_blank" rel="noopener noreferrer">#17211</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>Support insert into table function <code>cluster</code>, and for both table functions <code>remote</code> and <code>cluster</code>, support distributing data across nodes by specify sharding key. Close <a href="https://github.com/ClickHouse/ClickHouse/issues/16752" target="_blank" rel="noopener noreferrer">#16752</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18264" target="_blank" rel="noopener noreferrer">#18264</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Add function <code>decodeXMLComponent</code> to decode characters for XML. Example: <code>SELECT decodeXMLComponent(&#x27;Hello,&amp;quot;world&amp;quot;!&#x27;)</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/17659" target="_blank" rel="noopener noreferrer">#17659</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18542" target="_blank" rel="noopener noreferrer">#18542</a> (<a href="https://github.com/nautaa" target="_blank" rel="noopener noreferrer">nauta</a>).</li><li>Added functions <code>parseDateTimeBestEffortUSOrZero</code>, <code>parseDateTimeBestEffortUSOrNull</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19712" target="_blank" rel="noopener noreferrer">#19712</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add <code>sign</code> math function. <a href="https://github.com/ClickHouse/ClickHouse/pull/19527" target="_blank" rel="noopener noreferrer">#19527</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Add information about used features (functions, table engines, etc) into system.query_log. <a href="https://github.com/ClickHouse/ClickHouse/issues/18495" target="_blank" rel="noopener noreferrer">#18495</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19371" target="_blank" rel="noopener noreferrer">#19371</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Function <code>formatDateTime</code> support the <code>%Q</code> modification to format date to quarter. <a href="https://github.com/ClickHouse/ClickHouse/pull/19224" target="_blank" rel="noopener noreferrer">#19224</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>Support MetaKey+Enter hotkey binding in play UI. <a href="https://github.com/ClickHouse/ClickHouse/pull/19012" target="_blank" rel="noopener noreferrer">#19012</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Add three functions for map data type: 1. <code>mapContains(map, key)</code> to check weather map.keys include the second parameter key. 2. <code>mapKeys(map)</code> return all the keys in Array format 3. <code>mapValues(map)</code> return all the values in Array format. <a href="https://github.com/ClickHouse/ClickHouse/pull/18788" target="_blank" rel="noopener noreferrer">#18788</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Add <code>log_comment</code> setting related to <a href="https://github.com/ClickHouse/ClickHouse/issues/18494" target="_blank" rel="noopener noreferrer">#18494</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18549" target="_blank" rel="noopener noreferrer">#18549</a> (<a href="https://github.com/TszKitLo40" target="_blank" rel="noopener noreferrer">Zijie Lu</a>).</li><li>Add support of tuple argument to <code>argMin</code> and <code>argMax</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/17359" target="_blank" rel="noopener noreferrer">#17359</a> (<a href="https://github.com/ildus" target="_blank" rel="noopener noreferrer">Ildus Kurbangaliev</a>).</li><li>Support <code>EXISTS VIEW</code> syntax. <a href="https://github.com/ClickHouse/ClickHouse/pull/18552" target="_blank" rel="noopener noreferrer">#18552</a> (<a href="https://github.com/spongedu" target="_blank" rel="noopener noreferrer">Du Chuan</a>).</li><li>Add <code>SELECT ALL</code> syntax. closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18706" target="_blank" rel="noopener noreferrer">#18706</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18723" target="_blank" rel="noopener noreferrer">#18723</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-9">Performance Improvement<a class="hash-link" href="#performance-improvement-9" title="Direct link to heading">​</a></h4><ul><li>Faster parts removal by lowering the number of <code>stat</code> syscalls. This returns the optimization that existed while ago. More safe interface of <code>IDisk</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19065" target="_blank" rel="noopener noreferrer">#19065</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19086" target="_blank" rel="noopener noreferrer">#19086</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Aliases declared in <code>WITH</code> statement are properly used in index analysis. Queries like <code>WITH column AS alias SELECT ... WHERE alias = ...</code> may use index now. <a href="https://github.com/ClickHouse/ClickHouse/pull/18896" target="_blank" rel="noopener noreferrer">#18896</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add <code>optimize_alias_column_prediction</code> (on by default), that will: - Respect aliased columns in WHERE during partition pruning and skipping data using secondary indexes; - Respect aliased columns in WHERE for trivial count queries for optimize_trivial_count; - Respect aliased columns in GROUP BY/ORDER BY for optimize_aggregation_in_order/optimize_read_in_order. <a href="https://github.com/ClickHouse/ClickHouse/pull/16995" target="_blank" rel="noopener noreferrer">#16995</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Speed up aggregate function <code>sum</code>. Improvement only visible on synthetic benchmarks and not very practical. <a href="https://github.com/ClickHouse/ClickHouse/pull/19216" target="_blank" rel="noopener noreferrer">#19216</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Update libc++ and use another ABI to provide better performance. <a href="https://github.com/ClickHouse/ClickHouse/pull/18914" target="_blank" rel="noopener noreferrer">#18914</a> (<a href="https://github.com/danlark1" target="_blank" rel="noopener noreferrer">Danila Kutenin</a>).</li><li>Rewrite <code>sumIf()</code> and <code>sum(if())</code> function to <code>countIf()</code> function when logically equivalent. <a href="https://github.com/ClickHouse/ClickHouse/pull/17041" target="_blank" rel="noopener noreferrer">#17041</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Use a connection pool for S3 connections, controlled by the <code>s3_max_connections</code> settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/13405" target="_blank" rel="noopener noreferrer">#13405</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Add support for zstd long option for better compression of string columns to save space. <a href="https://github.com/ClickHouse/ClickHouse/pull/17184" target="_blank" rel="noopener noreferrer">#17184</a> (<a href="https://github.com/ygrek" target="_blank" rel="noopener noreferrer">ygrek</a>).</li><li>Slightly improve server latency by removing access to configuration on every connection. <a href="https://github.com/ClickHouse/ClickHouse/pull/19863" target="_blank" rel="noopener noreferrer">#19863</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Reduce lock contention for multiple layers of the <code>Buffer</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/19379" target="_blank" rel="noopener noreferrer">#19379</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Support splitting <code>Filter</code> step of query plan into <code>Expression + Filter</code> pair. Together with <code>Expression + Expression</code> merging optimization (<a href="https://github.com/ClickHouse/ClickHouse/issues/17458" target="_blank" rel="noopener noreferrer">#17458</a>) it may delay execution for some expressions after <code>Filter</code> step. <a href="https://github.com/ClickHouse/ClickHouse/pull/19253" target="_blank" rel="noopener noreferrer">#19253</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-9">Improvement<a class="hash-link" href="#improvement-9" title="Direct link to heading">​</a></h4><ul><li><code>SELECT count() FROM table</code> now can be executed if only one any column can be selected from the <code>table</code>. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10639" target="_blank" rel="noopener noreferrer">#10639</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18233" target="_blank" rel="noopener noreferrer">#18233</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Set charset to <code>utf8mb4</code> when interacting with remote MySQL servers. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19795" target="_blank" rel="noopener noreferrer">#19795</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19800" target="_blank" rel="noopener noreferrer">#19800</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li><code>S3</code> table function now supports <code>auto</code> compression mode (autodetect). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18754" target="_blank" rel="noopener noreferrer">#18754</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19793" target="_blank" rel="noopener noreferrer">#19793</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Correctly output infinite arguments for <code>formatReadableTimeDelta</code> function. In previous versions, there was implicit conversion to implementation specific integer value. <a href="https://github.com/ClickHouse/ClickHouse/pull/19791" target="_blank" rel="noopener noreferrer">#19791</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Table function <code>S3</code> will use global region if the region can&#x27;t be determined exactly. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10998" target="_blank" rel="noopener noreferrer">#10998</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19750" target="_blank" rel="noopener noreferrer">#19750</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>In distributed queries if the setting <code>async_socket_for_remote</code> is enabled, it was possible to get stack overflow at least in debug build configuration if very deeply nested data type is used in table (e.g. <code>Array(Array(Array(...more...)))</code>). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19108" target="_blank" rel="noopener noreferrer">#19108</a>. This change introduces minor backward incompatibility: excessive parenthesis in type definitions no longer supported, example: <code>Array((UInt8))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19736" target="_blank" rel="noopener noreferrer">#19736</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add separate pool for message brokers (RabbitMQ and Kafka). <a href="https://github.com/ClickHouse/ClickHouse/pull/19722" target="_blank" rel="noopener noreferrer">#19722</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix rare <code>max_number_of_merges_with_ttl_in_pool</code> limit overrun (more merges with TTL can be assigned) for non-replicated MergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/19708" target="_blank" rel="noopener noreferrer">#19708</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Dictionary: better error message during attribute parsing. <a href="https://github.com/ClickHouse/ClickHouse/pull/19678" target="_blank" rel="noopener noreferrer">#19678</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add an option to disable validation of checksums on reading. Should never be used in production. Please do not expect any benefits in disabling it. It may only be used for experiments and benchmarks. The setting only applicable for tables of MergeTree family. Checksums are always validated for other table engines and when receiving data over network. In my observations there is no performance difference or it is less than 0.5%. <a href="https://github.com/ClickHouse/ClickHouse/pull/19588" target="_blank" rel="noopener noreferrer">#19588</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support constant result in function <code>multiIf</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19533" target="_blank" rel="noopener noreferrer">#19533</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Enable function length/empty/notEmpty for datatype Map, which returns keys number in Map. <a href="https://github.com/ClickHouse/ClickHouse/pull/19530" target="_blank" rel="noopener noreferrer">#19530</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li><li>Add <code>--reconnect</code> option to <code>clickhouse-benchmark</code>. When this option is specified, it will reconnect before every request. This is needed for testing. <a href="https://github.com/ClickHouse/ClickHouse/pull/19872" target="_blank" rel="noopener noreferrer">#19872</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support using the new location of <code>.debug</code> file. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19348" target="_blank" rel="noopener noreferrer">#19348</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19520" target="_blank" rel="noopener noreferrer">#19520</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li><code>toIPv6</code> function parses <code>IPv4</code> addresses. <a href="https://github.com/ClickHouse/ClickHouse/pull/19518" target="_blank" rel="noopener noreferrer">#19518</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add <code>http_referer</code> field to <code>system.query_log</code>, <code>system.processes</code>, etc. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19389" target="_blank" rel="noopener noreferrer">#19389</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19390" target="_blank" rel="noopener noreferrer">#19390</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve MySQL compatibility by making more functions case insensitive and adding aliases. <a href="https://github.com/ClickHouse/ClickHouse/pull/19387" target="_blank" rel="noopener noreferrer">#19387</a> (<a href="https://github.com/dankondr" target="_blank" rel="noopener noreferrer">Daniil Kondratyev</a>).</li><li>Add metrics for MergeTree parts (Wide/Compact/InMemory) types. <a href="https://github.com/ClickHouse/ClickHouse/pull/19381" target="_blank" rel="noopener noreferrer">#19381</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow docker to be executed with arbitrary uid. <a href="https://github.com/ClickHouse/ClickHouse/pull/19374" target="_blank" rel="noopener noreferrer">#19374</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix wrong alignment of values of <code>IPv4</code> data type in Pretty formats. They were aligned to the right, not to the left. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19184" target="_blank" rel="noopener noreferrer">#19184</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19339" target="_blank" rel="noopener noreferrer">#19339</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow change <code>max_server_memory_usage</code> without restart. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18154" target="_blank" rel="noopener noreferrer">#18154</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19186" target="_blank" rel="noopener noreferrer">#19186</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>The exception when function <code>bar</code> is called with certain NaN argument may be slightly misleading in previous versions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19088" target="_blank" rel="noopener noreferrer">#19088</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19107" target="_blank" rel="noopener noreferrer">#19107</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Explicitly set uid / gid of clickhouse user &amp; group to the fixed values (101) in clickhouse-server images. <a href="https://github.com/ClickHouse/ClickHouse/pull/19096" target="_blank" rel="noopener noreferrer">#19096</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed <code>PeekableReadBuffer: Memory limit exceed</code> error when inserting data with huge strings. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18690" target="_blank" rel="noopener noreferrer">#18690</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18979" target="_blank" rel="noopener noreferrer">#18979</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Docker image: several improvements for clickhouse-server entrypoint. <a href="https://github.com/ClickHouse/ClickHouse/pull/18954" target="_blank" rel="noopener noreferrer">#18954</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Add <code>normalizeQueryKeepNames</code> and <code>normalizedQueryHashKeepNames</code> to normalize queries without masking long names with <code>?</code>. This helps better analyze complex query logs. <a href="https://github.com/ClickHouse/ClickHouse/pull/18910" target="_blank" rel="noopener noreferrer">#18910</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Check per-block checksum of the distributed batch on the sender before sending (without reading the file twice, the checksums will be verified while reading), this will avoid stuck of the INSERT on the receiver (on truncated .bin file on the sender). Avoid reading .bin files twice for batched INSERT (it was required to calculate rows/bytes to take squashing into account, now this information included into the header, backward compatible is preserved). <a href="https://github.com/ClickHouse/ClickHouse/pull/18853" target="_blank" rel="noopener noreferrer">#18853</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix issues with RIGHT and FULL JOIN of tables with aggregate function states. In previous versions exception about <code>cloneResized</code> method was thrown. <a href="https://github.com/ClickHouse/ClickHouse/pull/18818" target="_blank" rel="noopener noreferrer">#18818</a> (<a href="https://github.com/templarzq" target="_blank" rel="noopener noreferrer">templarzq</a>).</li><li>Added prefix-based S3 endpoint settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/18812" target="_blank" rel="noopener noreferrer">#18812</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Add <!-- -->[UInt8, UInt16, UInt32, UInt64]<!-- --> arguments types support for bitmapTransform, bitmapSubsetInRange, bitmapSubsetLimit, bitmapContains functions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18713" target="_blank" rel="noopener noreferrer">#18713</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18791" target="_blank" rel="noopener noreferrer">#18791</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Allow CTE (Common Table Expressions) to be further aliased. Propagate CSE (Common Subexpressions Elimination) to subqueries in the same level when <code>enable_global_with_statement = 1</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17378" target="_blank" rel="noopener noreferrer">#17378</a> . This fixes <a href="https://github.com/ClickHouse/ClickHouse/pull/16575#issuecomment-753416235" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/16575#issuecomment-753416235</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/18684" target="_blank" rel="noopener noreferrer">#18684</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Update librdkafka to v1.6.0-RC2. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18668" target="_blank" rel="noopener noreferrer">#18668</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18671" target="_blank" rel="noopener noreferrer">#18671</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>In case of unexpected exceptions automatically restart background thread which is responsible for execution of distributed DDL queries. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17991" target="_blank" rel="noopener noreferrer">#17991</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18285" target="_blank" rel="noopener noreferrer">#18285</a> (<a href="https://github.com/weeds085490" target="_blank" rel="noopener noreferrer">徐炘</a>).</li><li>Updated AWS C++ SDK in order to utilize global regions in S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/17870" target="_blank" rel="noopener noreferrer">#17870</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Added support for <code>WITH ... [AND] [PERIODIC] REFRESH [interval_in_sec]</code> clause when creating <code>LIVE VIEW</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/14822" target="_blank" rel="noopener noreferrer">#14822</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Restrict <code>MODIFY TTL</code> queries for <code>MergeTree</code> tables created in old syntax. Previously the query succeeded, but actually it had no effect. <a href="https://github.com/ClickHouse/ClickHouse/pull/19064" target="_blank" rel="noopener noreferrer">#19064</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-8">Bug Fix<a class="hash-link" href="#bug-fix-8" title="Direct link to heading">​</a></h4><ul><li>Fix index analysis of binary functions with constant argument which leads to wrong query results. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18364" target="_blank" rel="noopener noreferrer">#18364</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18373" target="_blank" rel="noopener noreferrer">#18373</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix starting the server with tables having default expressions containing dictGet(). Allow getting return type of dictGet() without loading dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/19805" target="_blank" rel="noopener noreferrer">#19805</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix server crash after query with <code>if</code> function with <code>Tuple</code> type of then/else branches result. <code>Tuple</code> type must contain <code>Array</code> or another complex type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18356" target="_blank" rel="noopener noreferrer">#18356</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/20133" target="_blank" rel="noopener noreferrer">#20133</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li><code>MaterializeMySQL</code> (experimental feature): Fix replication for statements that update several tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/20066" target="_blank" rel="noopener noreferrer">#20066</a> (<a href="https://github.com/havardk" target="_blank" rel="noopener noreferrer">Håvard Kvålen</a>).</li><li>Prevent &quot;Connection refused&quot; in docker during initialization script execution. <a href="https://github.com/ClickHouse/ClickHouse/pull/20012" target="_blank" rel="noopener noreferrer">#20012</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li><code>EmbeddedRocksDB</code> is an experimental storage. Fix the issue with lack of proper type checking. Simplified code. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19967" target="_blank" rel="noopener noreferrer">#19967</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19972" target="_blank" rel="noopener noreferrer">#19972</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix a segfault in function <code>fromModifiedJulianDay</code> when the argument type is <code>Nullable(T)</code> for any integral types other than Int32. <a href="https://github.com/ClickHouse/ClickHouse/pull/19959" target="_blank" rel="noopener noreferrer">#19959</a> (<a href="https://github.com/depressed-pho" target="_blank" rel="noopener noreferrer">PHO</a>).</li><li>The function <code>greatCircleAngle</code> returned inaccurate results in previous versions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19769" target="_blank" rel="noopener noreferrer">#19769</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19789" target="_blank" rel="noopener noreferrer">#19789</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix rare bug when some replicated operations (like mutation) cannot process some parts after data corruption. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19593" target="_blank" rel="noopener noreferrer">#19593</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19702" target="_blank" rel="noopener noreferrer">#19702</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Background thread which executes <code>ON CLUSTER</code> queries might hang waiting for dropped replicated table to do something. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/19684" target="_blank" rel="noopener noreferrer">#19684</a> (<a href="https://github.com/yiguolei" target="_blank" rel="noopener noreferrer">yiguolei</a>).</li><li>Fix wrong deserialization of columns description. It makes INSERT into a table with a column named <code>\</code> impossible. <a href="https://github.com/ClickHouse/ClickHouse/pull/19479" target="_blank" rel="noopener noreferrer">#19479</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Mark distributed batch as broken in case of empty data block in one of files. <a href="https://github.com/ClickHouse/ClickHouse/pull/19449" target="_blank" rel="noopener noreferrer">#19449</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed very rare bug that might cause mutation to hang after <code>DROP/DETACH/REPLACE/MOVE PARTITION</code>. It was partially fixed by <a href="https://github.com/ClickHouse/ClickHouse/issues/15537" target="_blank" rel="noopener noreferrer">#15537</a> for the most cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/19443" target="_blank" rel="noopener noreferrer">#19443</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix possible error <code>Extremes transform was already added to pipeline</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14100" target="_blank" rel="noopener noreferrer">#14100</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19430" target="_blank" rel="noopener noreferrer">#19430</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix default value in join types with non-zero default (e.g. some Enums). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18197" target="_blank" rel="noopener noreferrer">#18197</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19360" target="_blank" rel="noopener noreferrer">#19360</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Do not mark file for distributed send as broken on EOF. <a href="https://github.com/ClickHouse/ClickHouse/pull/19290" target="_blank" rel="noopener noreferrer">#19290</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix leaking of pipe fd for <code>async_socket_for_remote</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19153" target="_blank" rel="noopener noreferrer">#19153</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix infinite reading from file in <code>ORC</code> format (was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/10580" target="_blank" rel="noopener noreferrer">#10580</a>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19095" target="_blank" rel="noopener noreferrer">#19095</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19134" target="_blank" rel="noopener noreferrer">#19134</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix issue in merge tree data writer which can lead to marks with bigger size than fixed granularity size. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18913" target="_blank" rel="noopener noreferrer">#18913</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19123" target="_blank" rel="noopener noreferrer">#19123</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix startup bug when clickhouse was not able to read compression codec from <code>LowCardinality(Nullable(...))</code> and throws exception <code>Attempt to read after EOF</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18340" target="_blank" rel="noopener noreferrer">#18340</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19101" target="_blank" rel="noopener noreferrer">#19101</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Simplify the implementation of <code>tupleHammingDistance</code>. Support for tuples of any equal length. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19029" target="_blank" rel="noopener noreferrer">#19029</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19084" target="_blank" rel="noopener noreferrer">#19084</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Make sure <code>groupUniqArray</code> returns correct type for argument of Enum type. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17875" target="_blank" rel="noopener noreferrer">#17875</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19019" target="_blank" rel="noopener noreferrer">#19019</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix possible error <code>Expected single dictionary argument for function</code> if use function <code>ignore</code> with <code>LowCardinality</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14275" target="_blank" rel="noopener noreferrer">#14275</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19016" target="_blank" rel="noopener noreferrer">#19016</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix inserting of <code>LowCardinality</code> column to table with <code>TinyLog</code> engine. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18629" target="_blank" rel="noopener noreferrer">#18629</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19010" target="_blank" rel="noopener noreferrer">#19010</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix minor issue in JOIN: Join tries to materialize const columns, but our code waits for them in other places. <a href="https://github.com/ClickHouse/ClickHouse/pull/18982" target="_blank" rel="noopener noreferrer">#18982</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Disable <code>optimize_move_functions_out_of_any</code> because optimization is not always correct. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18051" target="_blank" rel="noopener noreferrer">#18051</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18973" target="_blank" rel="noopener noreferrer">#18973</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18981" target="_blank" rel="noopener noreferrer">#18981</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix possible exception <code>QueryPipeline stream: different number of columns</code> caused by merging of query plan&#x27;s <code>Expression</code> steps. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18190" target="_blank" rel="noopener noreferrer">#18190</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18980" target="_blank" rel="noopener noreferrer">#18980</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed very rare deadlock at shutdown. <a href="https://github.com/ClickHouse/ClickHouse/pull/18977" target="_blank" rel="noopener noreferrer">#18977</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed rare crashes when server run out of memory. <a href="https://github.com/ClickHouse/ClickHouse/pull/18976" target="_blank" rel="noopener noreferrer">#18976</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix incorrect behavior when <code>ALTER TABLE ... DROP PART &#x27;part_name&#x27;</code> query removes all deduplication blocks for the whole partition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18874" target="_blank" rel="noopener noreferrer">#18874</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18969" target="_blank" rel="noopener noreferrer">#18969</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed issue <a href="https://github.com/ClickHouse/ClickHouse/issues/18894" target="_blank" rel="noopener noreferrer">#18894</a> Add a check to avoid exception when long column alias(&#x27;table.column&#x27; style, usually auto-generated by BI tools like Looker) equals to long table name. <a href="https://github.com/ClickHouse/ClickHouse/pull/18968" target="_blank" rel="noopener noreferrer">#18968</a> (<a href="https://github.com/mathfool" target="_blank" rel="noopener noreferrer">Daniel Qin</a>).</li><li>Fix error <code>Task was not found in task queue</code> (possible only for remote queries, with <code>async_socket_for_remote = 1</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/18964" target="_blank" rel="noopener noreferrer">#18964</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bug when mutation with some escaped text (like <code>ALTER ... UPDATE e = CAST(&#x27;foo&#x27;, &#x27;Enum8(\&#x27;foo\&#x27; = 1&#x27;)</code> serialized incorrectly. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18878" target="_blank" rel="noopener noreferrer">#18878</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18944" target="_blank" rel="noopener noreferrer">#18944</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>ATTACH PARTITION will reset mutations. <a href="https://github.com/ClickHouse/ClickHouse/issues/18804" target="_blank" rel="noopener noreferrer">#18804</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18935" target="_blank" rel="noopener noreferrer">#18935</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Fix issue with <code>bitmapOrCardinality</code> that may lead to nullptr dereference. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18911" target="_blank" rel="noopener noreferrer">#18911</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18912" target="_blank" rel="noopener noreferrer">#18912</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Fixed <code>Attempt to read after eof</code> error when trying to <code>CAST</code> <code>NULL</code> from <code>Nullable(String)</code> to <code>Nullable(Decimal(P, S))</code>. Now function <code>CAST</code> returns <code>NULL</code> when it cannot parse decimal from nullable string. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7690" target="_blank" rel="noopener noreferrer">#7690</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18718" target="_blank" rel="noopener noreferrer">#18718</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix data type convert issue for MySQL engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/18124" target="_blank" rel="noopener noreferrer">#18124</a> (<a href="https://github.com/mis98zb" target="_blank" rel="noopener noreferrer">bo zeng</a>).</li><li>Fix clickhouse-client abort exception while executing only <code>select</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19790" target="_blank" rel="noopener noreferrer">#19790</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-9">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-9" title="Direct link to heading">​</a></h4><ul><li>Run <a href="https://twitter.com/RiggerManuel/status/1352345625480884228" target="_blank" rel="noopener noreferrer">SQLancer</a> (logical SQL fuzzer) in CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/19006" target="_blank" rel="noopener noreferrer">#19006</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Query Fuzzer will fuzz newly added tests more extensively. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18916" target="_blank" rel="noopener noreferrer">#18916</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19185" target="_blank" rel="noopener noreferrer">#19185</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Integrate with <a href="https://github.com/minimaxir/big-list-of-naughty-strings/" target="_blank" rel="noopener noreferrer">Big List of Naughty Strings</a> for better fuzzing. <a href="https://github.com/ClickHouse/ClickHouse/pull/19480" target="_blank" rel="noopener noreferrer">#19480</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add integration tests run with MSan. <a href="https://github.com/ClickHouse/ClickHouse/pull/18974" target="_blank" rel="noopener noreferrer">#18974</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed MemorySanitizer errors in cyrus-sasl and musl. <a href="https://github.com/ClickHouse/ClickHouse/pull/19821" target="_blank" rel="noopener noreferrer">#19821</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Insuffiient arguments check in <code>positionCaseInsensitiveUTF8</code> function triggered address sanitizer. <a href="https://github.com/ClickHouse/ClickHouse/pull/19720" target="_blank" rel="noopener noreferrer">#19720</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove --project-directory for docker-compose in integration test. Fix logs formatting from docker container. <a href="https://github.com/ClickHouse/ClickHouse/pull/19706" target="_blank" rel="noopener noreferrer">#19706</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Made generation of macros.xml easier for integration tests. No more excessive logging from dicttoxml. dicttoxml project is not active for 5+ years. <a href="https://github.com/ClickHouse/ClickHouse/pull/19697" target="_blank" rel="noopener noreferrer">#19697</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Allow to explicitly enable or disable watchdog via environment variable <code>CLICKHOUSE_WATCHDOG_ENABLE</code>. By default it is enabled if server is not attached to terminal. <a href="https://github.com/ClickHouse/ClickHouse/pull/19522" target="_blank" rel="noopener noreferrer">#19522</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow building ClickHouse with Kafka support on arm64. <a href="https://github.com/ClickHouse/ClickHouse/pull/19369" target="_blank" rel="noopener noreferrer">#19369</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Allow building librdkafka without ssl. <a href="https://github.com/ClickHouse/ClickHouse/pull/19337" target="_blank" rel="noopener noreferrer">#19337</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Restore Kafka input in FreeBSD builds. <a href="https://github.com/ClickHouse/ClickHouse/pull/18924" target="_blank" rel="noopener noreferrer">#18924</a> (<a href="https://github.com/snar" target="_blank" rel="noopener noreferrer">Alexandre Snarskii</a>).</li><li>Fix potential nullptr dereference in table function <code>VALUES</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19357" target="_blank" rel="noopener noreferrer">#19357</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Avoid UBSan reports in <code>arrayElement</code> function, <code>substring</code> and <code>arraySum</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19305" target="_blank" rel="noopener noreferrer">#19305</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19287" target="_blank" rel="noopener noreferrer">#19287</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19336" target="_blank" rel="noopener noreferrer">#19336</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19347" target="_blank" rel="noopener noreferrer">#19347</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-211">ClickHouse release 21.1<a class="hash-link" href="#clickhouse-release-211" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v211332-stable-2021-02-03">ClickHouse release v21.1.3.32-stable, 2021-02-03<a class="hash-link" href="#clickhouse-release-v211332-stable-2021-02-03" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-9">Bug Fix<a class="hash-link" href="#bug-fix-9" title="Direct link to heading">​</a></h4><ul><li>BloomFilter index crash fix. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19757" target="_blank" rel="noopener noreferrer">#19757</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19884" target="_blank" rel="noopener noreferrer">#19884</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix crash when pushing down predicates to union distinct subquery. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19855" target="_blank" rel="noopener noreferrer">#19855</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19861" target="_blank" rel="noopener noreferrer">#19861</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix filtering by UInt8 greater than 127. <a href="https://github.com/ClickHouse/ClickHouse/pull/19799" target="_blank" rel="noopener noreferrer">#19799</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>In previous versions, unusual arguments for function arrayEnumerateUniq may cause crash or infinite loop. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19787" target="_blank" rel="noopener noreferrer">#19787</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19788" target="_blank" rel="noopener noreferrer">#19788</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed stack overflow when using accurate comparison of arithmetic type with string type. <a href="https://github.com/ClickHouse/ClickHouse/pull/19773" target="_blank" rel="noopener noreferrer">#19773</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix crash when nested column name was used in <code>WHERE</code> or <code>PREWHERE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19755" target="_blank" rel="noopener noreferrer">#19755</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19763" target="_blank" rel="noopener noreferrer">#19763</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix a segmentation fault in <code>bitmapAndnot</code> function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19668" target="_blank" rel="noopener noreferrer">#19668</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19713" target="_blank" rel="noopener noreferrer">#19713</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Some functions with big integers may cause segfault. Big integers is experimental feature. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19667" target="_blank" rel="noopener noreferrer">#19667</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19672" target="_blank" rel="noopener noreferrer">#19672</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix wrong result of function <code>neighbor</code> for <code>LowCardinality</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10333" target="_blank" rel="noopener noreferrer">#10333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19617" target="_blank" rel="noopener noreferrer">#19617</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix use-after-free of the CompressedWriteBuffer in Connection after disconnect. <a href="https://github.com/ClickHouse/ClickHouse/pull/19599" target="_blank" rel="noopener noreferrer">#19599</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li><code>DROP/DETACH TABLE table ON CLUSTER cluster SYNC</code> query might hang, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19568" target="_blank" rel="noopener noreferrer">#19568</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19572" target="_blank" rel="noopener noreferrer">#19572</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Query CREATE DICTIONARY id expression fix. <a href="https://github.com/ClickHouse/ClickHouse/pull/19571" target="_blank" rel="noopener noreferrer">#19571</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix SIGSEGV with merge_tree_min_rows_for_concurrent_read/merge_tree_min_bytes_for_concurrent_read=0/UINT64_MAX. <a href="https://github.com/ClickHouse/ClickHouse/pull/19528" target="_blank" rel="noopener noreferrer">#19528</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Buffer overflow (on memory read) was possible if <code>addMonth</code> function was called with specifically crafted arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19441" target="_blank" rel="noopener noreferrer">#19441</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19413" target="_blank" rel="noopener noreferrer">#19413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19472" target="_blank" rel="noopener noreferrer">#19472</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Uninitialized memory read was possible in encrypt/decrypt functions if empty string was passed as IV. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19391" target="_blank" rel="noopener noreferrer">#19391</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19397" target="_blank" rel="noopener noreferrer">#19397</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix possible buffer overflow in Uber H3 library. See <a href="https://github.com/uber/h3/issues/392" target="_blank" rel="noopener noreferrer">https://github.com/uber/h3/issues/392</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19219" target="_blank" rel="noopener noreferrer">#19219</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19383" target="_blank" rel="noopener noreferrer">#19383</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix system.parts _state column (LOGICAL_ERROR when querying this column, due to incorrect order). <a href="https://github.com/ClickHouse/ClickHouse/pull/19346" target="_blank" rel="noopener noreferrer">#19346</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed possible wrong result or segfault on aggregation when Materialized View and its target table have different structure. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18063" target="_blank" rel="noopener noreferrer">#18063</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19322" target="_blank" rel="noopener noreferrer">#19322</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix error <code>Cannot convert column now64() because it is constant but values of constants are different in source and result</code>. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/7156" target="_blank" rel="noopener noreferrer">#7156</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19316" target="_blank" rel="noopener noreferrer">#19316</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bug when concurrent <code>ALTER</code> and <code>DROP</code> queries may hang while processing ReplicatedMergeTree table. <a href="https://github.com/ClickHouse/ClickHouse/pull/19237" target="_blank" rel="noopener noreferrer">#19237</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>There is no checkpoint</code> error when inserting data through http interface using <code>Template</code> or <code>CustomSeparated</code> format. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19021" target="_blank" rel="noopener noreferrer">#19021</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19072" target="_blank" rel="noopener noreferrer">#19072</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Disable constant folding for subqueries on the analysis stage, when the result cannot be calculated. <a href="https://github.com/ClickHouse/ClickHouse/pull/18446" target="_blank" rel="noopener noreferrer">#18446</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Mutation might hang waiting for some non-existent part after <code>MOVE</code> or <code>REPLACE PARTITION</code> or, in rare cases, after <code>DETACH</code> or <code>DROP PARTITION</code>. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" target="_blank" rel="noopener noreferrer">#15537</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v211215-stable-2021-01-18">ClickHouse release v21.1.2.15-stable 2021-01-18<a class="hash-link" href="#clickhouse-release-v211215-stable-2021-01-18" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-10">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-10" title="Direct link to heading">​</a></h4><ul><li>The setting <code>input_format_null_as_default</code> is enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/17525" target="_blank" rel="noopener noreferrer">#17525</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Check settings constraints for profile settings from config. Server will fail to start if users.xml contain settings that do not meet corresponding constraints. <a href="https://github.com/ClickHouse/ClickHouse/pull/18486" target="_blank" rel="noopener noreferrer">#18486</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Restrict <code>ALTER MODIFY SETTING</code> from changing storage settings that affects data parts (<code>write_final_mark</code> and <code>enable_mixed_granularity_parts</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/18306" target="_blank" rel="noopener noreferrer">#18306</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Set <code>insert_quorum_parallel</code> to 1 by default. It is significantly more convenient to use than &quot;sequential&quot; quorum inserts. But if you rely to sequential consistency, you should set the setting back to zero. <a href="https://github.com/ClickHouse/ClickHouse/pull/17567" target="_blank" rel="noopener noreferrer">#17567</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove <code>sumburConsistentHash</code> function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18120" target="_blank" rel="noopener noreferrer">#18120</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18656" target="_blank" rel="noopener noreferrer">#18656</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Removed aggregate functions <code>timeSeriesGroupSum</code>, <code>timeSeriesGroupRateSum</code> because a friend of mine said they never worked. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16869" target="_blank" rel="noopener noreferrer">#16869</a>. If you have luck using these functions, write a email to <a href="mailto:clickhouse-feedback@yandex-team.com." target="_blank" rel="noopener noreferrer">clickhouse-feedback@yandex-team.com.</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/17423" target="_blank" rel="noopener noreferrer">#17423</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Prohibit toUnixTimestamp(Date()) (before it just returns UInt16 representation of Date). <a href="https://github.com/ClickHouse/ClickHouse/pull/17376" target="_blank" rel="noopener noreferrer">#17376</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow using extended integer types (<code>Int128</code>, <code>Int256</code>, <code>UInt256</code>) in <code>avg</code> and <code>avgWeighted</code> functions. Also allow using different types (integer, decimal, floating point) for value and for weight in <code>avgWeighted</code> function. This is a backward-incompatible change: now the <code>avg</code> and <code>avgWeighted</code> functions always return <code>Float64</code> (as documented). Before this change the return type for <code>Decimal</code> arguments was also <code>Decimal</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15419" target="_blank" rel="noopener noreferrer">#15419</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Expression <code>toUUID(N)</code> no longer works. Replace with <code>toUUID(&#x27;00000000-0000-0000-0000-000000000000&#x27;)</code>. This change is motivated by non-obvious results of <code>toUUID(N)</code> where N is non zero.</li><li>SSL Certificates with incorrect &quot;key usage&quot; are rejected. In previous versions they are used to work. See <a href="https://github.com/ClickHouse/ClickHouse/issues/19262" target="_blank" rel="noopener noreferrer">#19262</a>.</li><li><code>incl</code> references to substitutions file (<code>/etc/metrika.xml</code>) were removed from the default config (<code>&lt;remote_servers&gt;</code>, <code>&lt;zookeeper&gt;</code>, <code>&lt;macros&gt;</code>, <code>&lt;compression&gt;</code>, <code>&lt;networks&gt;</code>). If you were using substitutions file and were relying on those implicit references, you should put them back manually and explicitly by adding corresponding sections with <code>incl=&quot;...&quot;</code> attributes before the update. See <a href="https://github.com/ClickHouse/ClickHouse/pull/18740" target="_blank" rel="noopener noreferrer">#18740</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-10">New Feature<a class="hash-link" href="#new-feature-10" title="Direct link to heading">​</a></h4><ul><li>Implement gRPC protocol in ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/15111" target="_blank" rel="noopener noreferrer">#15111</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Allow to use multiple zookeeper clusters. <a href="https://github.com/ClickHouse/ClickHouse/pull/17070" target="_blank" rel="noopener noreferrer">#17070</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Implemented <code>REPLACE TABLE</code> and <code>CREATE OR REPLACE TABLE</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/18521" target="_blank" rel="noopener noreferrer">#18521</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Implement <code>UNION DISTINCT</code> and treat the plain <code>UNION</code> clause as <code>UNION DISTINCT</code> by default. Add a setting <code>union_default_mode</code> that allows to treat it as <code>UNION ALL</code> or require explicit mode specification. <a href="https://github.com/ClickHouse/ClickHouse/pull/16338" target="_blank" rel="noopener noreferrer">#16338</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Added function <code>accurateCastOrNull</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10290" target="_blank" rel="noopener noreferrer">#10290</a>. Add type conversions in <code>x IN (subquery)</code> expressions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10266" target="_blank" rel="noopener noreferrer">#10266</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16724" target="_blank" rel="noopener noreferrer">#16724</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>IP Dictionary supports <code>IPv4</code> / <code>IPv6</code> types directly. <a href="https://github.com/ClickHouse/ClickHouse/pull/17571" target="_blank" rel="noopener noreferrer">#17571</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>IP Dictionary supports key fetching. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/18241" target="_blank" rel="noopener noreferrer">#18241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18480" target="_blank" rel="noopener noreferrer">#18480</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Add <code>*.zst</code> compression/decompression support for data import and export. It enables using <code>*.zst</code> in <code>file()</code> function and <code>Content-encoding: zstd</code> in HTTP client. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16791" target="_blank" rel="noopener noreferrer">#16791 </a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17144" target="_blank" rel="noopener noreferrer">#17144</a> (<a href="https://github.com/fibersel" target="_blank" rel="noopener noreferrer">Abi Palagashvili</a>).</li><li>Added <code>mannWitneyUTest</code>, <code>studentTTest</code> and <code>welchTTest</code> aggregate functions. Refactored <code>rankCorr</code> a bit. <a href="https://github.com/ClickHouse/ClickHouse/pull/16883" target="_blank" rel="noopener noreferrer">#16883</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Add functions <code>countMatches</code>/<code>countMatchesCaseInsensitive</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17459" target="_blank" rel="noopener noreferrer">#17459</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Implement <code>countSubstrings()</code>/<code>countSubstringsCaseInsensitive()</code>/<code>countSubstringsCaseInsensitiveUTF8()</code> (Count the number of substring occurrences). <a href="https://github.com/ClickHouse/ClickHouse/pull/17347" target="_blank" rel="noopener noreferrer">#17347</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add information about used databases, tables and columns in system.query_log. Add <code>query_kind</code> and <code>normalized_query_hash</code> fields. <a href="https://github.com/ClickHouse/ClickHouse/pull/17726" target="_blank" rel="noopener noreferrer">#17726</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add a setting <code>optimize_on_insert</code>. When enabled, do the same transformation for INSERTed block of data as if merge was done on this block (e.g. Replacing, Collapsing, Aggregating...). This setting is enabled by default. This can influence Materialized View and MaterializeMySQL behaviour (see detailed description). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10683" target="_blank" rel="noopener noreferrer">#10683</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16954" target="_blank" rel="noopener noreferrer">#16954</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Kerberos Authenticaiton for HDFS. <a href="https://github.com/ClickHouse/ClickHouse/pull/16621" target="_blank" rel="noopener noreferrer">#16621</a> (<a href="https://github.com/ilejn" target="_blank" rel="noopener noreferrer">Ilya Golshtein</a>).</li><li>Support <code>SHOW SETTINGS</code> statement to show parameters in system.settings. <code>SHOW CHANGED SETTINGS</code> and <code>LIKE/ILIKE</code> clause are also supported. <a href="https://github.com/ClickHouse/ClickHouse/pull/18056" target="_blank" rel="noopener noreferrer">#18056</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>Function <code>position</code> now supports <code>POSITION(needle IN haystack)</code> synax for SQL compatibility. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18701" target="_blank" rel="noopener noreferrer">#18701</a>. ... <a href="https://github.com/ClickHouse/ClickHouse/pull/18779" target="_blank" rel="noopener noreferrer">#18779</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>Now we have a new storage setting <code>max_partitions_to_read</code> for tables in the MergeTree family. It limits the max number of partitions that can be accessed in one query. A user setting <code>force_max_partition_limit</code> is also added to enforce this constraint. <a href="https://github.com/ClickHouse/ClickHouse/pull/18712" target="_blank" rel="noopener noreferrer">#18712</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add <code>query_id</code> column to <code>system.part_log</code> for inserted parts. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10097" target="_blank" rel="noopener noreferrer">#10097</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18644" target="_blank" rel="noopener noreferrer">#18644</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Allow create table as select with columns specification. Example <code>CREATE TABLE t1 (x String) ENGINE = Memory AS SELECT 1;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18060" target="_blank" rel="noopener noreferrer">#18060</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added <code>arrayMin</code>, <code>arrayMax</code>, <code>arrayAvg</code> aggregation functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/18032" target="_blank" rel="noopener noreferrer">#18032</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Implemented <code>ATTACH TABLE name FROM &#x27;path/to/data/&#x27; (col1 Type1, ...</code> query. It creates new table with provided structure and attaches table data from provided directory in <code>user_files</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17903" target="_blank" rel="noopener noreferrer">#17903</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Add mutation support for StorageMemory. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9117" target="_blank" rel="noopener noreferrer">#9117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15127" target="_blank" rel="noopener noreferrer">#15127</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Support syntax <code>EXISTS DATABASE name</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18458" target="_blank" rel="noopener noreferrer">#18458</a> (<a href="https://github.com/spongedu" target="_blank" rel="noopener noreferrer">Du Chuan</a>).</li><li>Support builtin function <code>isIPv4String</code> &amp;&amp; <code>isIPv6String</code> like <a href="https://github.com/ClickHouse/ClickHouse/compare/master...spongedu:support_is_ipv4?expand=1" target="_blank" rel="noopener noreferrer">MySQL</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18349" target="_blank" rel="noopener noreferrer">#18349</a> (<a href="https://github.com/spongedu" target="_blank" rel="noopener noreferrer">Du Chuan</a>).</li><li>Add a new setting <code>insert_distributed_one_random_shard = 1</code> to allow insertion into multi-sharded distributed table without any distributed key. <a href="https://github.com/ClickHouse/ClickHouse/pull/18294" target="_blank" rel="noopener noreferrer">#18294</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add settings <code>min_compress_block_size</code> and <code>max_compress_block_size</code> to MergeTreeSettings, which have higher priority than the global settings and take effect when they are set. close <a href="https://github.com/ClickHouse/ClickHouse/issues/13890" target="_blank" rel="noopener noreferrer">13890</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17867" target="_blank" rel="noopener noreferrer">#17867</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Add support for 64bit roaring bitmaps. <a href="https://github.com/ClickHouse/ClickHouse/pull/17858" target="_blank" rel="noopener noreferrer">#17858</a> (<a href="https://github.com/andyyzh" target="_blank" rel="noopener noreferrer">Andy Yang</a>).</li><li>Extended <code>OPTIMIZE ... DEDUPLICATE</code> syntax to allow explicit (or implicit with asterisk/column transformers) list of columns to check for duplicates on. ... <a href="https://github.com/ClickHouse/ClickHouse/pull/17846" target="_blank" rel="noopener noreferrer">#17846</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Added functions <code>toModifiedJulianDay</code>, <code>fromModifiedJulianDay</code>, <code>toModifiedJulianDayOrNull</code>, and <code>fromModifiedJulianDayOrNull</code>. These functions convert between Proleptic Gregorian calendar date and Modified Julian Day number. <a href="https://github.com/ClickHouse/ClickHouse/pull/17750" target="_blank" rel="noopener noreferrer">#17750</a> (<a href="https://github.com/depressed-pho" target="_blank" rel="noopener noreferrer">PHO</a>).</li><li>Add ability to use custom TLD list: added functions <code>firstSignificantSubdomainCustom</code>, <code>cutToFirstSignificantSubdomainCustom</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17748" target="_blank" rel="noopener noreferrer">#17748</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add support for <code>PROXYv1</code> protocol to wrap native TCP interface. Allow quotas to be keyed by proxy-forwarded IP address (applied for <code>PROXYv1</code> address and for <code>X-Forwarded-For</code> from HTTP interface). This is useful when you provide access to ClickHouse only via trusted proxy (e.g. CloudFlare) but want to account user resources by their original IP addresses. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17268" target="_blank" rel="noopener noreferrer">#17268</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17707" target="_blank" rel="noopener noreferrer">#17707</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now clickhouse-client supports opening <code>EDITOR</code> to edit commands. <code>Alt-Shift-E</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17665" target="_blank" rel="noopener noreferrer">#17665</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add function <code>encodeXMLComponent</code> to escape characters to place string into XML text node or attribute. <a href="https://github.com/ClickHouse/ClickHouse/pull/17659" target="_blank" rel="noopener noreferrer">#17659</a> (<a href="https://github.com/nautaa" target="_blank" rel="noopener noreferrer">nauta</a>).</li><li>Introduce <code>DETACH TABLE/VIEW ... PERMANENTLY</code> syntax, so that after restarting the table does not reappear back automatically on restart (only by explicit request). The table can still be attached back using the short syntax ATTACH TABLE. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/5555" target="_blank" rel="noopener noreferrer">#5555</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13850" target="_blank" rel="noopener noreferrer">#13850</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17642" target="_blank" rel="noopener noreferrer">#17642</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Add asynchronous metrics on total amount of rows, bytes and parts in MergeTree tables. This fix <a href="https://github.com/ClickHouse/ClickHouse/issues/11714" target="_blank" rel="noopener noreferrer">#11714</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17639" target="_blank" rel="noopener noreferrer">#17639</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Add settings <code>limit</code> and <code>offset</code> for out-of-SQL pagination: <a href="https://github.com/ClickHouse/ClickHouse/issues/16176" target="_blank" rel="noopener noreferrer">#16176</a> They are useful for building APIs. These two settings will affect SELECT query as if it is added like <code>select * from (your_original_select_query) t limit xxx offset xxx;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17633" target="_blank" rel="noopener noreferrer">#17633</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Provide a new aggregator combinator : <code>-SimpleState</code> to build <code>SimpleAggregateFunction</code> types via query. It&#x27;s useful for defining MaterializedView of AggregatingMergeTree engine, and will benefit projections too. <a href="https://github.com/ClickHouse/ClickHouse/pull/16853" target="_blank" rel="noopener noreferrer">#16853</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added <code>queries-file</code> parameter for <code>clickhouse-client</code> and <code>clickhouse-local</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15930" target="_blank" rel="noopener noreferrer">#15930</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added <code>query</code> parameter for <code>clickhouse-benchmark</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17832" target="_blank" rel="noopener noreferrer">#17832</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li><code>EXPLAIN AST</code> now support queries other then <code>SELECT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18136" target="_blank" rel="noopener noreferrer">#18136</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-8">Experimental Feature<a class="hash-link" href="#experimental-feature-8" title="Direct link to heading">​</a></h4><ul><li>Added functions for calculation of minHash and simHash of text n-grams and shingles. They are intended for semi-duplicate search. Also functions <code>bitHammingDistance</code> and <code>tupleHammingDistance</code> are added. <a href="https://github.com/ClickHouse/ClickHouse/pull/7649" target="_blank" rel="noopener noreferrer">#7649</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Add new data type <code>Map</code>. See <a href="https://github.com/ClickHouse/ClickHouse/issues/1841" target="_blank" rel="noopener noreferrer">#1841</a>. First version for Map only supports <code>String</code> type of key and value. <a href="https://github.com/ClickHouse/ClickHouse/pull/15806" target="_blank" rel="noopener noreferrer">#15806</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Implement alternative SQL parser based on ANTLR4 runtime and generated from EBNF grammar. <a href="https://github.com/ClickHouse/ClickHouse/pull/11298" target="_blank" rel="noopener noreferrer">#11298</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-10">Performance Improvement<a class="hash-link" href="#performance-improvement-10" title="Direct link to heading">​</a></h4><ul><li>New IP Dictionary implementation with lower memory consumption, improved performance for some cases, and fixed bugs. <a href="https://github.com/ClickHouse/ClickHouse/pull/16804" target="_blank" rel="noopener noreferrer">#16804</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Parallel formatting for data export. <a href="https://github.com/ClickHouse/ClickHouse/pull/11617" target="_blank" rel="noopener noreferrer">#11617</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>LDAP integration: Added <code>verification_cooldown</code> parameter in LDAP server connection configuration to allow caching of successful &quot;bind&quot; attempts for configurable period of time. <a href="https://github.com/ClickHouse/ClickHouse/pull/15988" target="_blank" rel="noopener noreferrer">#15988</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>Add <code>--no-system-table</code> option for <code>clickhouse-local</code> to run without system tables. This avoids initialization of <code>DateLUT</code> that may take noticeable amount of time (tens of milliseconds) at startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/18899" target="_blank" rel="noopener noreferrer">#18899</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Replace <code>PODArray</code> with <code>PODArrayWithStackMemory</code> in <code>AggregateFunctionWindowFunnelData</code> to improve <code>windowFunnel</code> function performance. <a href="https://github.com/ClickHouse/ClickHouse/pull/18817" target="_blank" rel="noopener noreferrer">#18817</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Don&#x27;t send empty blocks to shards on synchronous INSERT into Distributed table. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14571" target="_blank" rel="noopener noreferrer">#14571</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18775" target="_blank" rel="noopener noreferrer">#18775</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Optimized read for StorageMemory. <a href="https://github.com/ClickHouse/ClickHouse/pull/18052" target="_blank" rel="noopener noreferrer">#18052</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Using Dragonbox algorithm for float to string conversion instead of ryu. This improves performance of float to string conversion significantly. <a href="https://github.com/ClickHouse/ClickHouse/pull/17831" target="_blank" rel="noopener noreferrer">#17831</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Speedup <code>IPv6CIDRToRange</code> implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/17569" target="_blank" rel="noopener noreferrer">#17569</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Add <code>remerge_sort_lowered_memory_bytes_ratio</code> setting (If memory usage after remerge does not reduced by this ratio, remerge will be disabled). <a href="https://github.com/ClickHouse/ClickHouse/pull/17539" target="_blank" rel="noopener noreferrer">#17539</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Improve performance of AggregatingMergeTree with SimpleAggregateFunction(String) in PK. <a href="https://github.com/ClickHouse/ClickHouse/pull/17109" target="_blank" rel="noopener noreferrer">#17109</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Now the <code>-If</code> combinator is devirtualized, and <code>count</code> is properly vectorized. It is for <a href="https://github.com/ClickHouse/ClickHouse/pull/17041" target="_blank" rel="noopener noreferrer">this PR</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17043" target="_blank" rel="noopener noreferrer">#17043</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix performance of reading from <code>Merge</code> tables over huge number of <code>MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7748" target="_blank" rel="noopener noreferrer">#7748</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16988" target="_blank" rel="noopener noreferrer">#16988</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Improved performance of function <code>repeat</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16937" target="_blank" rel="noopener noreferrer">#16937</a> (<a href="https://github.com/satanson" target="_blank" rel="noopener noreferrer">satanson</a>).</li><li>Slightly improved performance of float parsing. <a href="https://github.com/ClickHouse/ClickHouse/pull/16809" target="_blank" rel="noopener noreferrer">#16809</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add possibility to skip merged partitions for <code>OPTIMIZE TABLE ... FINAL</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15939" target="_blank" rel="noopener noreferrer">#15939</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Integrate with <a href="https://github.com/lemire/fast_float" target="_blank" rel="noopener noreferrer">fast_float from Daniel Lemire</a> to parse floating point numbers. <a href="https://github.com/ClickHouse/ClickHouse/pull/16787" target="_blank" rel="noopener noreferrer">#16787</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>). It is not enabled, because performance its performance is still lower than rough float parser in ClickHouse.</li><li>Fix max_distributed_connections (affects <code>prefer_localhost_replica = 1</code> and <code>max_threads != max_distributed_connections</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17848" target="_blank" rel="noopener noreferrer">#17848</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Adaptive choice of single/multi part upload when sending data to S3. Single part upload is controlled by a new setting <code>max_single_part_upload_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17934" target="_blank" rel="noopener noreferrer">#17934</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Support for async tasks in <code>PipelineExecutor</code>. Initial support of async sockets for remote queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/17868" target="_blank" rel="noopener noreferrer">#17868</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Allow to use <code>optimize_move_to_prewhere</code> optimization with compact parts, when sizes of columns are unknown. <a href="https://github.com/ClickHouse/ClickHouse/pull/17330" target="_blank" rel="noopener noreferrer">#17330</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-10">Improvement<a class="hash-link" href="#improvement-10" title="Direct link to heading">​</a></h4><ul><li>Avoid deadlock when executing INSERT SELECT into itself from a table with <code>TinyLog</code> or <code>Log</code> table engines. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/6802" target="_blank" rel="noopener noreferrer">#6802</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18691" target="_blank" rel="noopener noreferrer">#18691</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/16812" target="_blank" rel="noopener noreferrer">#16812</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14570" target="_blank" rel="noopener noreferrer">#14570</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15260" target="_blank" rel="noopener noreferrer">#15260</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support <code>SHOW CREATE VIEW name</code> syntax like <a href="https://dev.mysql.com/doc/refman/5.7/en/show-create-view.html" target="_blank" rel="noopener noreferrer">MySQL</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18095" target="_blank" rel="noopener noreferrer">#18095</a> (<a href="https://github.com/spongedu" target="_blank" rel="noopener noreferrer">Du Chuan</a>).</li><li>All queries of type <code>Decimal * Float</code> or vice versa are allowed, including aggregate ones (e.g. <code>SELECT sum(decimal_field * 1.1)</code> or <code>SELECT dec_col * float_col</code>), the result type is Float32 or Float64. <a href="https://github.com/ClickHouse/ClickHouse/pull/18145" target="_blank" rel="noopener noreferrer">#18145</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Improved minimal Web UI: add history; add sharing support; avoid race condition of different requests; add request in-flight and ready indicators; add favicon; detect Ctrl+Enter if textarea is not in focus. <a href="https://github.com/ClickHouse/ClickHouse/pull/17293" target="_blank" rel="noopener noreferrer">#17293</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/17770" target="_blank" rel="noopener noreferrer">#17770</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>clickhouse-server didn&#x27;t send <code>close</code> request to ZooKeeper server. <a href="https://github.com/ClickHouse/ClickHouse/pull/16837" target="_blank" rel="noopener noreferrer">#16837</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Avoid server abnormal termination in case of too low memory limits (<code>max_memory_usage = 1</code> / <code>max_untracked_memory = 1</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17453" target="_blank" rel="noopener noreferrer">#17453</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix non-deterministic result of <code>windowFunnel</code> function in case of same timestamp for different events. <a href="https://github.com/ClickHouse/ClickHouse/pull/18884" target="_blank" rel="noopener noreferrer">#18884</a> (<a href="https://github.com/fuwhu" target="_blank" rel="noopener noreferrer">Fuwang Hu</a>).</li><li>Docker: Explicitly set uid / gid of clickhouse user &amp; group to the fixed values (101) in clickhouse-server Docker images. <a href="https://github.com/ClickHouse/ClickHouse/pull/19096" target="_blank" rel="noopener noreferrer">#19096</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Asynchronous INSERTs to <code>Distributed</code> tables: Two new settings (by analogy with MergeTree family) has been added: - <code>fsync_after_insert</code> - Do fsync for every inserted. Will decreases performance of inserts. - <code>fsync_directories</code> - Do fsync for temporary directory (that is used for async INSERT only) after all operations (writes, renames, etc.). <a href="https://github.com/ClickHouse/ClickHouse/pull/18864" target="_blank" rel="noopener noreferrer">#18864</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li><code>SYSTEM KILL</code> command started to work in Docker. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18847" target="_blank" rel="noopener noreferrer">#18847</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18848" target="_blank" rel="noopener noreferrer">#18848</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Expand macros in the zk path when executing <code>FETCH PARTITION</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18839" target="_blank" rel="noopener noreferrer">#18839</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Apply <code>ALTER TABLE &lt;replicated_table&gt; ON CLUSTER MODIFY SETTING ...</code> to all replicas. Because we don&#x27;t replicate such alter commands. <a href="https://github.com/ClickHouse/ClickHouse/pull/18789" target="_blank" rel="noopener noreferrer">#18789</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Allow column transformer <code>EXCEPT</code> to accept a string as regular expression matcher. This resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/18685" target="_blank" rel="noopener noreferrer">#18685</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/18699" target="_blank" rel="noopener noreferrer">#18699</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix SimpleAggregateFunction in SummingMergeTree. Now it works like AggregateFunction. In previous versions values were summed together regardless to the aggregate function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18564" target="_blank" rel="noopener noreferrer">#18564</a> . <a href="https://github.com/ClickHouse/ClickHouse/issues/8052" target="_blank" rel="noopener noreferrer">#8052</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18637" target="_blank" rel="noopener noreferrer">#18637</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>). Another fix of using <code>SimpleAggregateFunction</code> in <code>SummingMergeTree</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18676" target="_blank" rel="noopener noreferrer">#18676</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/18677" target="_blank" rel="noopener noreferrer">#18677</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed assertion error inside allocator in case when last argument of function bar is NaN. Now simple ClickHouse&#x27;s exception is being thrown. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17876" target="_blank" rel="noopener noreferrer">#17876</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18520" target="_blank" rel="noopener noreferrer">#18520</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix usability issue: no newline after exception message in some tools. <a href="https://github.com/ClickHouse/ClickHouse/pull/18444" target="_blank" rel="noopener noreferrer">#18444</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add ability to modify primary and partition key column type from <code>LowCardinality(Type)</code> to <code>Type</code> and vice versa. Also add an ability to modify primary key column type from <code>EnumX </code> to <code>IntX</code> type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5604" target="_blank" rel="noopener noreferrer">#5604</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18362" target="_blank" rel="noopener noreferrer">#18362</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Implement <code>untuple</code> field access. <a href="https://github.com/ClickHouse/ClickHouse/issues/18133" target="_blank" rel="noopener noreferrer">#18133</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18309" target="_blank" rel="noopener noreferrer">#18309</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Allow to parse Array fields from CSV if it is represented as a string containing array that was serialized as nested CSV. Example: <code>&quot;[&quot;&quot;Hello&quot;&quot;, &quot;&quot;world&quot;&quot;, &quot;&quot;42&quot;&quot;&quot;&quot; TV&quot;&quot;]&quot;</code> will parse as <code>[&#x27;Hello&#x27;, &#x27;world&#x27;, &#x27;42&quot; TV&#x27;]</code>. Allow to parse array in CSV in a string without enclosing braces. Example: <code>&quot;&#x27;Hello&#x27;, &#x27;world&#x27;, &#x27;42&quot;&quot; TV&#x27;&quot;</code> will parse as <code>[&#x27;Hello&#x27;, &#x27;world&#x27;, &#x27;42&quot; TV&#x27;]</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18271" target="_blank" rel="noopener noreferrer">#18271</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make better adaptive granularity calculation for merge tree wide parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/18223" target="_blank" rel="noopener noreferrer">#18223</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now <code>clickhouse install</code> could work on Mac. The problem was that there is no procfs on this platform. <a href="https://github.com/ClickHouse/ClickHouse/pull/18201" target="_blank" rel="noopener noreferrer">#18201</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Better hints for <code>SHOW ...</code> query syntax. <a href="https://github.com/ClickHouse/ClickHouse/pull/18183" target="_blank" rel="noopener noreferrer">#18183</a> (<a href="https://github.com/spongedu" target="_blank" rel="noopener noreferrer">Du Chuan</a>).</li><li>Array aggregation <code>arrayMin</code>, <code>arrayMax</code>, <code>arraySum</code>, <code>arrayAvg</code> support for <code>Int128</code>, <code>Int256</code>, <code>UInt256</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18147" target="_blank" rel="noopener noreferrer">#18147</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add <code>disk</code> to Set and Join storage settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/18112" target="_blank" rel="noopener noreferrer">#18112</a> (<a href="https://github.com/GrigoryPervakov" target="_blank" rel="noopener noreferrer">Grigory Pervakov</a>).</li><li>Access control: Now table function <code>merge()</code> requires current user to have <code>SELECT</code> privilege on each table it receives data from. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16964" target="_blank" rel="noopener noreferrer">#16964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18104" target="_blank" rel="noopener noreferrer">#18104</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/17983" target="_blank" rel="noopener noreferrer">#17983</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Temporary tables are visible in the system tables <code>system.tables</code> and <code>system.columns</code> now only in those session where they have been created. The internal database <code>_temporary_and_external_tables</code> is now hidden in those system tables; temporary tables are shown as tables with empty database with the <code>is_temporary</code> flag set instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/18014" target="_blank" rel="noopener noreferrer">#18014</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix clickhouse-client rendering issue when the size of terminal window changes. <a href="https://github.com/ClickHouse/ClickHouse/pull/18009" target="_blank" rel="noopener noreferrer">#18009</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Decrease log verbosity of the events when the client drops the connection from Warning to Information. <a href="https://github.com/ClickHouse/ClickHouse/pull/18005" target="_blank" rel="noopener noreferrer">#18005</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Forcibly removing empty or bad metadata files from filesystem for DiskS3. S3 is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/17935" target="_blank" rel="noopener noreferrer">#17935</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Access control: <code>allow_introspection_functions=0</code> prohibits usage of introspection functions but doesn&#x27;t prohibit giving grants for them anymore (the grantee will need to set <code>allow_introspection_functions=1</code> for himself to be able to use that grant). Similarly <code>allow_ddl=0</code> prohibits usage of DDL commands but doesn&#x27;t prohibit giving grants for them anymore. <a href="https://github.com/ClickHouse/ClickHouse/pull/17908" target="_blank" rel="noopener noreferrer">#17908</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Usability improvement: hints for column names. <a href="https://github.com/ClickHouse/ClickHouse/issues/17112" target="_blank" rel="noopener noreferrer">#17112</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17857" target="_blank" rel="noopener noreferrer">#17857</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Add diagnostic information when two merge tables try to read each other&#x27;s data. <a href="https://github.com/ClickHouse/ClickHouse/pull/17854" target="_blank" rel="noopener noreferrer">#17854</a> (<a href="https://github.com/weeds085490" target="_blank" rel="noopener noreferrer">徐炘</a>).</li><li>Let the possibility to override timeout value for running script using the ClickHouse docker image. <a href="https://github.com/ClickHouse/ClickHouse/pull/17818" target="_blank" rel="noopener noreferrer">#17818</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>).</li><li>Check system log tables&#x27; engine definition grammar to prevent some configuration errors. Notes that this grammar check is not semantical, that means such mistakes as non-existent columns / expression functions would be not found out util the table is created. <a href="https://github.com/ClickHouse/ClickHouse/pull/17739" target="_blank" rel="noopener noreferrer">#17739</a> (<a href="https://github.com/spongedu" target="_blank" rel="noopener noreferrer">Du Chuan</a>).</li><li>Removed exception throwing at <code>RabbitMQ</code> table initialization if there was no connection (it will be reconnecting in the background). <a href="https://github.com/ClickHouse/ClickHouse/pull/17709" target="_blank" rel="noopener noreferrer">#17709</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Do not ignore server memory limits during Buffer flush. <a href="https://github.com/ClickHouse/ClickHouse/pull/17646" target="_blank" rel="noopener noreferrer">#17646</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Switch to patched version of RocksDB (from ClickHouse-Extras) to fix use-after-free error. <a href="https://github.com/ClickHouse/ClickHouse/pull/17643" target="_blank" rel="noopener noreferrer">#17643</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Added an offset to exception message for parallel parsing. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17457" target="_blank" rel="noopener noreferrer">#17457</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17641" target="_blank" rel="noopener noreferrer">#17641</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Don&#x27;t throw &quot;Too many parts&quot; error in the middle of INSERT query. <a href="https://github.com/ClickHouse/ClickHouse/pull/17566" target="_blank" rel="noopener noreferrer">#17566</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow query parameters in UPDATE statement of ALTER query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10976" target="_blank" rel="noopener noreferrer">#10976</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17563" target="_blank" rel="noopener noreferrer">#17563</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Query obfuscator: avoid usage of some SQL keywords for identifier names. <a href="https://github.com/ClickHouse/ClickHouse/pull/17526" target="_blank" rel="noopener noreferrer">#17526</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Export current max ddl entry executed by DDLWorker via server metric. It&#x27;s useful to check if DDLWorker hangs somewhere. <a href="https://github.com/ClickHouse/ClickHouse/pull/17464" target="_blank" rel="noopener noreferrer">#17464</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Export asynchronous metrics of all servers current threads. It&#x27;s useful to track down issues like <a href="https://github.com/ClickHouse-Extras/poco/pull/28" target="_blank" rel="noopener noreferrer">this</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17463" target="_blank" rel="noopener noreferrer">#17463</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Include dynamic columns like MATERIALIZED / ALIAS for wildcard query when settings <code>asterisk_include_materialized_columns</code> and <code>asterisk_include_alias_columns</code> are turned on. <a href="https://github.com/ClickHouse/ClickHouse/pull/17462" target="_blank" rel="noopener noreferrer">#17462</a> (<a href="https://github.com/chenziliang" target="_blank" rel="noopener noreferrer">Ken Chen</a>).</li><li>Allow specifying <a href="https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-table-ttl" target="_blank" rel="noopener noreferrer">TTL</a> to remove old entries from <a href="https://clickhouse.com/docs/en/operations/system-tables/" target="_blank" rel="noopener noreferrer">system log tables</a>, using the <code>&lt;ttl&gt;</code> attribute in <code>config.xml</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17438" target="_blank" rel="noopener noreferrer">#17438</a> (<a href="https://github.com/spongedu" target="_blank" rel="noopener noreferrer">Du Chuan</a>).</li><li>Now queries coming to the server via MySQL and PostgreSQL protocols have distinctive interface types (which can be seen in the <code>interface</code> column of the table<code>system.query_log</code>): <code>4</code> for MySQL, and <code>5</code> for PostgreSQL, instead of formerly used <code>1</code> which is now used for the native protocol only. <a href="https://github.com/ClickHouse/ClickHouse/pull/17437" target="_blank" rel="noopener noreferrer">#17437</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix parsing of SETTINGS clause of the <code>INSERT ... SELECT ... SETTINGS</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/17414" target="_blank" rel="noopener noreferrer">#17414</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Correctly account memory in RadixSort. <a href="https://github.com/ClickHouse/ClickHouse/pull/17412" target="_blank" rel="noopener noreferrer">#17412</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Add eof check in <code>receiveHello</code> in server to prevent getting <code>Attempt to read after eof</code> exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/17365" target="_blank" rel="noopener noreferrer">#17365</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Avoid possible stack overflow in bigint conversion. Big integers are experimental. <a href="https://github.com/ClickHouse/ClickHouse/pull/17269" target="_blank" rel="noopener noreferrer">#17269</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Now <code>set</code> indices will work with <code>GLOBAL IN</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17232" target="_blank" rel="noopener noreferrer">#17232</a> , <a href="https://github.com/ClickHouse/ClickHouse/issues/5576" target="_blank" rel="noopener noreferrer">#5576</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17253" target="_blank" rel="noopener noreferrer">#17253</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add limit for http redirects in request to S3 storage (<code>s3_max_redirects</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17220" target="_blank" rel="noopener noreferrer">#17220</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>When <code>-OrNull</code> combinator combined <code>-If</code>, <code>-Merge</code>, <code>-MergeState</code>, <code>-State</code> combinators, we should put <code>-OrNull</code> in front. <a href="https://github.com/ClickHouse/ClickHouse/pull/16935" target="_blank" rel="noopener noreferrer">#16935</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Support HTTP proxy and HTTPS S3 endpoint configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/16861" target="_blank" rel="noopener noreferrer">#16861</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Added proper authentication using environment, <code>~/.aws</code> and <code>AssumeRole</code> for S3 client. <a href="https://github.com/ClickHouse/ClickHouse/pull/16856" target="_blank" rel="noopener noreferrer">#16856</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Add more OpenTelemetry spans. Add an example of how to export the span data to Zipkin. <a href="https://github.com/ClickHouse/ClickHouse/pull/16535" target="_blank" rel="noopener noreferrer">#16535</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Cache dictionaries: Completely eliminate callbacks and locks for acquiring them. Keys are not divided into &quot;not found&quot; and &quot;expired&quot;, but stored in the same map during query. <a href="https://github.com/ClickHouse/ClickHouse/pull/14958" target="_blank" rel="noopener noreferrer">#14958</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix never worked <code>fsync_part_directory</code>/<code>fsync_after_insert</code>/<code>in_memory_parts_insert_sync</code> (experimental feature). <a href="https://github.com/ClickHouse/ClickHouse/pull/18845" target="_blank" rel="noopener noreferrer">#18845</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow using <code>Atomic</code> engine for nested database of <code>MaterializeMySQL</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14849" target="_blank" rel="noopener noreferrer">#14849</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-10">Bug Fix<a class="hash-link" href="#bug-fix-10" title="Direct link to heading">​</a></h4><ul><li>Fix the issue when server can stop accepting connections in very rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/17542" target="_blank" rel="noopener noreferrer">#17542</a> (Amos Bird, <a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix index analysis of binary functions with constant argument which leads to wrong query results. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18364" target="_blank" rel="noopener noreferrer">#18364</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18373" target="_blank" rel="noopener noreferrer">#18373</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix possible wrong index analysis when the types of the index comparison are different. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17122" target="_blank" rel="noopener noreferrer">#17122</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17145" target="_blank" rel="noopener noreferrer">#17145</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Disable write with AIO during merges because it can lead to extremely rare data corruption of primary key columns during merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/18481" target="_blank" rel="noopener noreferrer">#18481</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Restrict merges from wide to compact parts. In case of vertical merge it led to broken result part. <a href="https://github.com/ClickHouse/ClickHouse/pull/18381" target="_blank" rel="noopener noreferrer">#18381</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible incomplete query result while reading from <code>MergeTree*</code> in case of read backoff (message <code>&lt;Debug&gt; MergeTreeReadPool: Will lower number of threads</code> in logs). Was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/16423" target="_blank" rel="noopener noreferrer">#16423</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18137" target="_blank" rel="noopener noreferrer">#18137</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18216" target="_blank" rel="noopener noreferrer">#18216</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix use after free bug in <code>rocksdb</code> library. <a href="https://github.com/ClickHouse/ClickHouse/pull/18862" target="_blank" rel="noopener noreferrer">#18862</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Fix infinite reading from file in <code>ORC</code> format (was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/10580" target="_blank" rel="noopener noreferrer">#10580</a>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19095" target="_blank" rel="noopener noreferrer">#19095</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19134" target="_blank" rel="noopener noreferrer">#19134</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bug in merge tree data writer which can lead to marks with bigger size than fixed granularity size. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18913" target="_blank" rel="noopener noreferrer">#18913</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19123" target="_blank" rel="noopener noreferrer">#19123</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix startup bug when clickhouse was not able to read compression codec from <code>LowCardinality(Nullable(...))</code> and throws exception <code>Attempt to read after EOF</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18340" target="_blank" rel="noopener noreferrer">#18340</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19101" target="_blank" rel="noopener noreferrer">#19101</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Restrict <code>MODIFY TTL</code> queries for <code>MergeTree</code> tables created in old syntax. Previously the query succeeded, but actually it had no effect. <a href="https://github.com/ClickHouse/ClickHouse/pull/19064" target="_blank" rel="noopener noreferrer">#19064</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Make sure <code>groupUniqArray</code> returns correct type for argument of Enum type. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17875" target="_blank" rel="noopener noreferrer">#17875</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19019" target="_blank" rel="noopener noreferrer">#19019</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix possible error <code>Expected single dictionary argument for function</code> if use function <code>ignore</code> with <code>LowCardinality</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14275" target="_blank" rel="noopener noreferrer">#14275</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19016" target="_blank" rel="noopener noreferrer">#19016</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix inserting of <code>LowCardinality</code> column to table with <code>TinyLog</code> engine. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18629" target="_blank" rel="noopener noreferrer">#18629</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19010" target="_blank" rel="noopener noreferrer">#19010</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Join tries to materialize const columns, but our code wants them in other places. <a href="https://github.com/ClickHouse/ClickHouse/pull/18982" target="_blank" rel="noopener noreferrer">#18982</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Disable <code>optimize_move_functions_out_of_any</code> because optimization is not always correct. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18051" target="_blank" rel="noopener noreferrer">#18051</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18973" target="_blank" rel="noopener noreferrer">#18973</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18981" target="_blank" rel="noopener noreferrer">#18981</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix possible exception <code>QueryPipeline stream: different number of columns</code> caused by merging of query plan&#x27;s <code>Expression</code> steps. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18190" target="_blank" rel="noopener noreferrer">#18190</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18980" target="_blank" rel="noopener noreferrer">#18980</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed very rare deadlock at shutdown. <a href="https://github.com/ClickHouse/ClickHouse/pull/18977" target="_blank" rel="noopener noreferrer">#18977</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix incorrect behavior when <code>ALTER TABLE ... DROP PART &#x27;part_name&#x27;</code> query removes all deduplication blocks for the whole partition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18874" target="_blank" rel="noopener noreferrer">#18874</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18969" target="_blank" rel="noopener noreferrer">#18969</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Attach partition should reset the mutation. <a href="https://github.com/ClickHouse/ClickHouse/issues/18804" target="_blank" rel="noopener noreferrer">#18804</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18935" target="_blank" rel="noopener noreferrer">#18935</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Fix issue with <code>bitmapOrCardinality</code> that may lead to nullptr dereference. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18911" target="_blank" rel="noopener noreferrer">#18911</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18912" target="_blank" rel="noopener noreferrer">#18912</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Fix possible hang at shutdown in <code>clickhouse-local</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18891" target="_blank" rel="noopener noreferrer">#18891</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18893" target="_blank" rel="noopener noreferrer">#18893</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Queries for external databases (MySQL, ODBC, JDBC) were incorrectly rewritten if there was an expression in form of <code>x IN table</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9756" target="_blank" rel="noopener noreferrer">#9756</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18876" target="_blank" rel="noopener noreferrer">#18876</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix *If combinator with unary function and Nullable types. <a href="https://github.com/ClickHouse/ClickHouse/pull/18806" target="_blank" rel="noopener noreferrer">#18806</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix the issue that asynchronous distributed INSERTs can be rejected by the server if the setting <code>network_compression_method</code> is globally set to non-default value. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18741" target="_blank" rel="noopener noreferrer">#18741</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18776" target="_blank" rel="noopener noreferrer">#18776</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>Attempt to read after eof</code> error when trying to <code>CAST</code> <code>NULL</code> from <code>Nullable(String)</code> to <code>Nullable(Decimal(P, S))</code>. Now function <code>CAST</code> returns <code>NULL</code> when it cannot parse decimal from nullable string. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7690" target="_blank" rel="noopener noreferrer">#7690</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18718" target="_blank" rel="noopener noreferrer">#18718</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix minor issue with logging. <a href="https://github.com/ClickHouse/ClickHouse/pull/18717" target="_blank" rel="noopener noreferrer">#18717</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Fix removing of empty parts in <code>ReplicatedMergeTree</code> tables, created with old syntax. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18582" target="_blank" rel="noopener noreferrer">#18582</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18614" target="_blank" rel="noopener noreferrer">#18614</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix previous bug when date overflow with different values. Strict Date value limit to &quot;2106-02-07&quot;, cast date &gt; &quot;2106-02-07&quot; to value 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/18565" target="_blank" rel="noopener noreferrer">#18565</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Add FixedString data type support for replication from MySQL. Replication from MySQL is an experimental feature. This patch fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18450" target="_blank" rel="noopener noreferrer">#18450</a> Also fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6556" target="_blank" rel="noopener noreferrer">#6556</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18553" target="_blank" rel="noopener noreferrer">#18553</a> (<a href="https://github.com/awesomeleo" target="_blank" rel="noopener noreferrer">awesomeleo</a>).</li><li>Fix possible <code>Pipeline stuck</code> error while using <code>ORDER BY</code> after subquery with <code>RIGHT</code> or <code>FULL</code> join. <a href="https://github.com/ClickHouse/ClickHouse/pull/18550" target="_blank" rel="noopener noreferrer">#18550</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bug which may lead to <code>ALTER</code> queries hung after corresponding mutation kill. Found by thread fuzzer. <a href="https://github.com/ClickHouse/ClickHouse/pull/18518" target="_blank" rel="noopener noreferrer">#18518</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Proper support for 12AM in <code>parseDateTimeBestEffort</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18402" target="_blank" rel="noopener noreferrer">#18402</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18449" target="_blank" rel="noopener noreferrer">#18449</a> (<a href="https://github.com/vladimir-golovchenko" target="_blank" rel="noopener noreferrer">vladimir-golovchenko</a>).</li><li>Fixed <code>value is too short</code> error when executing <code>toType(...)</code> functions (<code>toDate</code>, <code>toUInt32</code>, etc) with argument of type <code>Nullable(String)</code>. Now such functions return <code>NULL</code> on parsing errors instead of throwing exception. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7673" target="_blank" rel="noopener noreferrer">#7673</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18445" target="_blank" rel="noopener noreferrer">#18445</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix the unexpected behaviour of <code>SHOW TABLES</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18431" target="_blank" rel="noopener noreferrer">#18431</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Fix -SimpleState combinator generates incompatible arugment type and return type. <a href="https://github.com/ClickHouse/ClickHouse/pull/18404" target="_blank" rel="noopener noreferrer">#18404</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix possible race condition in concurrent usage of <code>Set</code> or <code>Join</code> tables and selects from <code>system.tables</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18385" target="_blank" rel="noopener noreferrer">#18385</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix filling table <code>system.settings_profile_elements</code>. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18231" target="_blank" rel="noopener noreferrer">#18231</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18379" target="_blank" rel="noopener noreferrer">#18379</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix possible crashes in aggregate functions with combinator <code>Distinct</code>, while using two-level aggregation. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17682" target="_blank" rel="noopener noreferrer">#17682</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18365" target="_blank" rel="noopener noreferrer">#18365</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed issue when <code>clickhouse-odbc-bridge</code> process is unreachable by server on machines with dual IPv4/IPv6 stack; Fixed issue when ODBC dictionary updates are performed using malformed queries and/or cause crashes of the odbc-bridge process; Possibly closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14489" target="_blank" rel="noopener noreferrer">#14489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18278" target="_blank" rel="noopener noreferrer">#18278</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>Access control: <code>SELECT count() FROM table</code> now can be executed if the user has access to at least single column from a table. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10639" target="_blank" rel="noopener noreferrer">#10639</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18233" target="_blank" rel="noopener noreferrer">#18233</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Access control: <code>SELECT JOIN</code> now requires the <code>SELECT</code> privilege on each of the joined tables. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17654" target="_blank" rel="noopener noreferrer">#17654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18232" target="_blank" rel="noopener noreferrer">#18232</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix key comparison between Enum and Int types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17989" target="_blank" rel="noopener noreferrer">#17989</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18214" target="_blank" rel="noopener noreferrer">#18214</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Replication from MySQL (experimental feature). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18186" target="_blank" rel="noopener noreferrer">#18186</a> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16372" target="_blank" rel="noopener noreferrer">#16372</a> Fix unique key convert issue in MaterializeMySQL database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/18211" target="_blank" rel="noopener noreferrer">#18211</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix inconsistency for queries with both <code>WITH FILL</code> and <code>WITH TIES</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/17466" target="_blank" rel="noopener noreferrer">#17466</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18188" target="_blank" rel="noopener noreferrer">#18188</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix inserting a row with default value in case of parsing error in the last column. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17712" target="_blank" rel="noopener noreferrer">#17712</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18182" target="_blank" rel="noopener noreferrer">#18182</a> (<a href="https://github.com/zhangjmruc" target="_blank" rel="noopener noreferrer">Jianmei Zhang</a>).</li><li>Fix <code>Unknown setting profile</code> error on attempt to set settings profile. <a href="https://github.com/ClickHouse/ClickHouse/pull/18167" target="_blank" rel="noopener noreferrer">#18167</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix error when query <code>MODIFY COLUMN ... REMOVE TTL</code> doesn&#x27;t actually remove column TTL. <a href="https://github.com/ClickHouse/ClickHouse/pull/18130" target="_blank" rel="noopener noreferrer">#18130</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>std::out_of_range: basic_string</code> in S3 URL parsing. <a href="https://github.com/ClickHouse/ClickHouse/pull/18059" target="_blank" rel="noopener noreferrer">#18059</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fix comparison of <code>DateTime64</code> and <code>Date</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13804" target="_blank" rel="noopener noreferrer">#13804</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/11222" target="_blank" rel="noopener noreferrer">#11222</a>. ... <a href="https://github.com/ClickHouse/ClickHouse/pull/18050" target="_blank" rel="noopener noreferrer">#18050</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Replication from MySQL (experimental feature): Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15187" target="_blank" rel="noopener noreferrer">#15187</a> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17912" target="_blank" rel="noopener noreferrer">#17912</a> support convert MySQL prefix index for MaterializeMySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/17944" target="_blank" rel="noopener noreferrer">#17944</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>When server log rotation was configured using <code>logger.size</code> parameter with numeric value larger than 2^32, the logs were not rotated properly. This is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/17905" target="_blank" rel="noopener noreferrer">#17905</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Trivial query optimization was producing wrong result if query contains ARRAY JOIN (so query is actually non trivial). <a href="https://github.com/ClickHouse/ClickHouse/pull/17887" target="_blank" rel="noopener noreferrer">#17887</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Fix possible segfault in <code>topK</code> aggregate function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17404" target="_blank" rel="noopener noreferrer">#17404</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17845" target="_blank" rel="noopener noreferrer">#17845</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>WAL (experimental feature): Do not restore parts from WAL if <code>in_memory_parts_enable_wal</code> is disabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/17802" target="_blank" rel="noopener noreferrer">#17802</a> (<a href="https://github.com/detailyang" target="_blank" rel="noopener noreferrer">detailyang</a>).</li><li>Exception message about max table size to drop was displayed incorrectly. <a href="https://github.com/ClickHouse/ClickHouse/pull/17764" target="_blank" rel="noopener noreferrer">#17764</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed possible segfault when there is not enough space when inserting into <code>Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/17737" target="_blank" rel="noopener noreferrer">#17737</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" target="_blank" rel="noopener noreferrer">#17681</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Windows: Fixed <code>Function not implemented</code> error when executing <code>RENAME</code> query in <code>Atomic</code> database with ClickHouse running on Windows Subsystem for Linux. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17661" target="_blank" rel="noopener noreferrer">#17661</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17664" target="_blank" rel="noopener noreferrer">#17664</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>In might be determined incorrectly if cluster is circular- (cross-) replicated or not when executing <code>ON CLUSTER</code> query due to race condition when <code>pool_size</code> &gt; 1. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/17640" target="_blank" rel="noopener noreferrer">#17640</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix empty <code>system.stack_trace</code> table when server is running in daemon mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/17630" target="_blank" rel="noopener noreferrer">#17630</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Exception <code>fmt::v7::format_error</code> can be logged in background for MergeTree tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17613" target="_blank" rel="noopener noreferrer">#17613</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17615" target="_blank" rel="noopener noreferrer">#17615</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>When clickhouse-client is used in interactive mode with multiline queries, single line comment was erronously extended till the end of query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13654" target="_blank" rel="noopener noreferrer">#13654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17565" target="_blank" rel="noopener noreferrer">#17565</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix alter query hang when the corresponding mutation was killed on the different replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" target="_blank" rel="noopener noreferrer">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" target="_blank" rel="noopener noreferrer">#17499</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix issue with memory accounting when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" target="_blank" rel="noopener noreferrer">#17496</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix <code>ORDER BY</code> with enabled setting <code>optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" target="_blank" rel="noopener noreferrer">#17471</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix duplicates after <code>DISTINCT</code> which were possible because of incorrect optimization. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17294" target="_blank" rel="noopener noreferrer">#17294</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17296" target="_blank" rel="noopener noreferrer">#17296</a> (<a href="https://github.com/chengxianglibra" target="_blank" rel="noopener noreferrer">li chengxiang</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17439" target="_blank" rel="noopener noreferrer">#17439</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed high CPU usage in background tasks of *MergeTree tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/17416" target="_blank" rel="noopener noreferrer">#17416</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix possible crash while reading from <code>JOIN</code> table with <code>LowCardinality</code> types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17228" target="_blank" rel="noopener noreferrer">#17228</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17397" target="_blank" rel="noopener noreferrer">#17397</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Replication from MySQL (experimental feature): Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16835" target="_blank" rel="noopener noreferrer">#16835</a> try fix miss match header with MySQL SHOW statement. <a href="https://github.com/ClickHouse/ClickHouse/pull/17366" target="_blank" rel="noopener noreferrer">#17366</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix nondeterministic functions with predicate optimizer. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17244" target="_blank" rel="noopener noreferrer">#17244</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17273" target="_blank" rel="noopener noreferrer">#17273</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix possible <code>Unexpected packet Data received from client</code> error for Distributed queries with <code>LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17254" target="_blank" rel="noopener noreferrer">#17254</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix set index invalidation when there are const columns in the subquery. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17246" target="_blank" rel="noopener noreferrer">#17246</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17249" target="_blank" rel="noopener noreferrer">#17249</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>clickhouse-copier: Fix for non-partitioned tables <a href="https://github.com/ClickHouse/ClickHouse/issues/15235" target="_blank" rel="noopener noreferrer">#15235</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17248" target="_blank" rel="noopener noreferrer">#17248</a> (<a href="https://github.com/kaka11chen" target="_blank" rel="noopener noreferrer">Qi Chen</a>).</li><li>Fixed possible not-working mutations for parts stored on S3 disk (experimental feature). <a href="https://github.com/ClickHouse/ClickHouse/pull/17227" target="_blank" rel="noopener noreferrer">#17227</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Bug fix for funciton <code>fuzzBits</code>, related issue: <a href="https://github.com/ClickHouse/ClickHouse/issues/16980" target="_blank" rel="noopener noreferrer">#16980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17051" target="_blank" rel="noopener noreferrer">#17051</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix <code>optimize_distributed_group_by_sharding_key</code> for query with OFFSET only. <a href="https://github.com/ClickHouse/ClickHouse/pull/16996" target="_blank" rel="noopener noreferrer">#16996</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix queries from <code>Merge</code> tables over <code>Distributed</code> tables with JOINs. <a href="https://github.com/ClickHouse/ClickHouse/pull/16993" target="_blank" rel="noopener noreferrer">#16993</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix order by optimization with monotonic functions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16107" target="_blank" rel="noopener noreferrer">#16107</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16956" target="_blank" rel="noopener noreferrer">#16956</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix incorrect comparison of types <code>DateTime64</code> with different scales. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16655" target="_blank" rel="noopener noreferrer">#16655</a> ... <a href="https://github.com/ClickHouse/ClickHouse/pull/16952" target="_blank" rel="noopener noreferrer">#16952</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fix optimization of group by with enabled setting <code>optimize_aggregators_of_group_by_keys</code> and joins. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12604" target="_blank" rel="noopener noreferrer">#12604</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16951" target="_blank" rel="noopener noreferrer">#16951</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Minor fix in SHOW ACCESS query. <a href="https://github.com/ClickHouse/ClickHouse/pull/16866" target="_blank" rel="noopener noreferrer">#16866</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix the behaviour with enabled <code>optimize_trivial_count_query</code> setting with partition predicate. <a href="https://github.com/ClickHouse/ClickHouse/pull/16767" target="_blank" rel="noopener noreferrer">#16767</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Return number of affected rows for INSERT queries via MySQL wire protocol. Previously ClickHouse used to always return 0, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16605" target="_blank" rel="noopener noreferrer">#16605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16715" target="_blank" rel="noopener noreferrer">#16715</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix inconsistent behavior caused by <code>select_sequential_consistency</code> for optimized trivial count query and system tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/16309" target="_blank" rel="noopener noreferrer">#16309</a> (<a href="https://github.com/haoch" target="_blank" rel="noopener noreferrer">Hao Chen</a>).</li><li>Throw error when <code>REPLACE</code> column transformer operates on non existing column. <a href="https://github.com/ClickHouse/ClickHouse/pull/16183" target="_blank" rel="noopener noreferrer">#16183</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Throw exception in case of not equi-join ON expression in RIGH|FULL JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/15162" target="_blank" rel="noopener noreferrer">#15162</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-10">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-10" title="Direct link to heading">​</a></h4><ul><li>Add simple integrity check for ClickHouse binary. It allows to detect corruption due to faulty hardware (bit rot on storage media or bit flips in RAM). <a href="https://github.com/ClickHouse/ClickHouse/pull/18811" target="_blank" rel="noopener noreferrer">#18811</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Change <code>OpenSSL</code> to <code>BoringSSL</code>. It allows to avoid issues with sanitizers. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12490" target="_blank" rel="noopener noreferrer">#12490</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17502" target="_blank" rel="noopener noreferrer">#17502</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12952" target="_blank" rel="noopener noreferrer">#12952</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18129" target="_blank" rel="noopener noreferrer">#18129</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Simplify <code>Sys/V</code> init script. It was not working on Ubuntu 12.04 or older. <a href="https://github.com/ClickHouse/ClickHouse/pull/17428" target="_blank" rel="noopener noreferrer">#17428</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Multiple improvements in <code>./clickhouse install</code> script. <a href="https://github.com/ClickHouse/ClickHouse/pull/17421" target="_blank" rel="noopener noreferrer">#17421</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now ClickHouse can pretend to be a fake ZooKeeper. Currently, storage implementation is just stored in-memory hash-table, and server partially support ZooKeeper protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/16877" target="_blank" rel="noopener noreferrer">#16877</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix dead list watches removal for TestKeeperStorage (a mock for ZooKeeper). <a href="https://github.com/ClickHouse/ClickHouse/pull/18065" target="_blank" rel="noopener noreferrer">#18065</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add <code>SYSTEM SUSPEND</code> command for fault injection. It can be used to faciliate failover tests. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15979" target="_blank" rel="noopener noreferrer">#15979</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18850" target="_blank" rel="noopener noreferrer">#18850</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Generate build id when ClickHouse is linked with <code>lld</code>. It&#x27;s appeared that <code>lld</code> does not generate it by default on my machine. Build id is used for crash reports and introspection. <a href="https://github.com/ClickHouse/ClickHouse/pull/18808" target="_blank" rel="noopener noreferrer">#18808</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix shellcheck errors in style check. <a href="https://github.com/ClickHouse/ClickHouse/pull/18566" target="_blank" rel="noopener noreferrer">#18566</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Update timezones info to 2020e. <a href="https://github.com/ClickHouse/ClickHouse/pull/18531" target="_blank" rel="noopener noreferrer">#18531</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix codespell warnings. Split style checks into separate parts. Update style checks docker image. <a href="https://github.com/ClickHouse/ClickHouse/pull/18463" target="_blank" rel="noopener noreferrer">#18463</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Automated check for leftovers of conflict markers in docs. <a href="https://github.com/ClickHouse/ClickHouse/pull/18332" target="_blank" rel="noopener noreferrer">#18332</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Enable Thread Fuzzer for stateless tests flaky check. <a href="https://github.com/ClickHouse/ClickHouse/pull/18299" target="_blank" rel="noopener noreferrer">#18299</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Do not use non thread-safe function <code>strerror</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18204" target="_blank" rel="noopener noreferrer">#18204</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Update <code>anchore/scan-action@main</code> workflow action (was moved from <code>master</code> to <code>main</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/18192" target="_blank" rel="noopener noreferrer">#18192</a> (<a href="https://github.com/stigsb" target="_blank" rel="noopener noreferrer">Stig Bakken</a>).</li><li>Now <code>clickhouse-test</code> does DROP/CREATE databases with a timeout. <a href="https://github.com/ClickHouse/ClickHouse/pull/18098" target="_blank" rel="noopener noreferrer">#18098</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Enable experimental support for Pytest framework for stateless tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/17902" target="_blank" rel="noopener noreferrer">#17902</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Now we use the fresh docker daemon version in integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/17671" target="_blank" rel="noopener noreferrer">#17671</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Send info about official build, memory, cpu and free disk space to Sentry if it is enabled. Sentry is opt-in feature to help ClickHouse developers. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17279" target="_blank" rel="noopener noreferrer">#17279</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17543" target="_blank" rel="noopener noreferrer">#17543</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>There was an uninitialized variable in the code of clickhouse-copier. <a href="https://github.com/ClickHouse/ClickHouse/pull/17363" target="_blank" rel="noopener noreferrer">#17363</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix <a href="https://clickhouse-test-reports.s3.yandex.net/17309/065cd002578f2e8228f12a2744bd40c970065e0c/stress_test_(memory)/stderr.log" target="_blank" rel="noopener noreferrer">one MSan report</a> from <a href="https://github.com/ClickHouse/ClickHouse/issues/17309" target="_blank" rel="noopener noreferrer">#17309</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17344" target="_blank" rel="noopener noreferrer">#17344</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix for the issue with IPv6 in Arrow Flight library. See <a href="https://github.com/ClickHouse/ClickHouse/pull/16243#issuecomment-720830294" target="_blank" rel="noopener noreferrer">the comments</a> for details. <a href="https://github.com/ClickHouse/ClickHouse/pull/16664" target="_blank" rel="noopener noreferrer">#16664</a> (<a href="https://github.com/FawnD2" target="_blank" rel="noopener noreferrer">Zhanna</a>).</li><li>Add a library that replaces some <code>libc</code> functions to traps that will terminate the process. <a href="https://github.com/ClickHouse/ClickHouse/pull/16366" target="_blank" rel="noopener noreferrer">#16366</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Provide diagnostics in server logs in case of stack overflow, send error message to clickhouse-client. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14840" target="_blank" rel="noopener noreferrer">#14840</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16346" target="_blank" rel="noopener noreferrer">#16346</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now we can run almost all stateless functional tests in parallel. <a href="https://github.com/ClickHouse/ClickHouse/pull/15236" target="_blank" rel="noopener noreferrer">#15236</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix corruption in <code>librdkafka</code> snappy decompression (was a problem only for gcc10 builds, but official builds uses clang already, so at least recent official releases are not affected). <a href="https://github.com/ClickHouse/ClickHouse/pull/18053" target="_blank" rel="noopener noreferrer">#18053</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>If server was terminated by OOM killer, print message in log. <a href="https://github.com/ClickHouse/ClickHouse/pull/13516" target="_blank" rel="noopener noreferrer">#13516</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>PODArray: Avoid call to memcpy with (nullptr, 0) arguments (Fix UBSan report). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18525" target="_blank" rel="noopener noreferrer">#18525</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18526" target="_blank" rel="noopener noreferrer">#18526</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Minor improvement for path concatenation of zookeeper paths inside DDLWorker. <a href="https://github.com/ClickHouse/ClickHouse/pull/17767" target="_blank" rel="noopener noreferrer">#17767</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Allow to reload symbols from debug file. This PR also fixes a build-id issue. <a href="https://github.com/ClickHouse/ClickHouse/pull/17637" target="_blank" rel="noopener noreferrer">#17637</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="changelog-for-2020"><a href="https://github.com/ClickHouse/ClickHouse/blob/master/docs/en/whats-new/changelog/2020.md" target="_blank" rel="noopener noreferrer">Changelog for 2020</a><a class="hash-link" href="#changelog-for-2020" title="Direct link to heading">​</a></h2></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/staging/docs/en/whats-new/changelog/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Changelog</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/staging/docs/en/whats-new/changelog/2020"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">2020</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#clickhouse-release-v2112-2021-12-15" class="table-of-contents__link toc-highlight">ClickHouse release v21.12, 2021-12-15</a></li><li><a href="#clickhouse-release-v2111-2021-11-09" class="table-of-contents__link toc-highlight">ClickHouse release v21.11, 2021-11-09</a></li><li><a href="#clickhouse-release-v2110-2021-10-16" class="table-of-contents__link toc-highlight">ClickHouse release v21.10, 2021-10-16</a></li><li><a href="#clickhouse-release-v219-2021-09-09" class="table-of-contents__link toc-highlight">ClickHouse release v21.9, 2021-09-09</a></li><li><a href="#clickhouse-release-v218-2021-08-12" class="table-of-contents__link toc-highlight">ClickHouse release v21.8, 2021-08-12</a></li><li><a href="#clickhouse-release-v217-2021-07-09" class="table-of-contents__link toc-highlight">ClickHouse release v21.7, 2021-07-09</a></li><li><a href="#clickhouse-release-216-2021-06-05" class="table-of-contents__link toc-highlight">ClickHouse release 21.6, 2021-06-05</a></li><li><a href="#clickhouse-release-215-2021-05-20" class="table-of-contents__link toc-highlight">ClickHouse release 21.5, 2021-05-20</a></li><li><a href="#clickhouse-release-214" class="table-of-contents__link toc-highlight">ClickHouse release 21.4</a><ul><li><a href="#clickhouse-release-2141-2021-04-12" class="table-of-contents__link toc-highlight">ClickHouse release 21.4.1 2021-04-12</a></li></ul></li><li><a href="#clickhouse-release-213-lts" class="table-of-contents__link toc-highlight">ClickHouse release 21.3 (LTS)</a><ul><li><a href="#clickhouse-release-v213-2021-03-12" class="table-of-contents__link toc-highlight">ClickHouse release v21.3, 2021-03-12</a></li></ul></li><li><a href="#clickhouse-release-212" class="table-of-contents__link toc-highlight">ClickHouse release 21.2</a><ul><li><a href="#clickhouse-release-v21228-stable-2021-02-07" class="table-of-contents__link toc-highlight">ClickHouse release v21.2.2.8-stable, 2021-02-07</a></li></ul></li><li><a href="#clickhouse-release-211" class="table-of-contents__link toc-highlight">ClickHouse release 21.1</a><ul><li><a href="#clickhouse-release-v211332-stable-2021-02-03" class="table-of-contents__link toc-highlight">ClickHouse release v21.1.3.32-stable, 2021-02-03</a></li><li><a href="#clickhouse-release-v211215-stable-2021-01-18" class="table-of-contents__link toc-highlight">ClickHouse release v21.1.2.15-stable 2021-01-18</a></li></ul></li><li><a href="#changelog-for-2020" class="table-of-contents__link toc-highlight">Changelog for 2020</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ClickHouse</div><ul class="footer__items"><li class="footer__item"><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Company</a></li><li class="footer__item"><a href="https://clickhouse.com/cloud/" target="_blank" rel="noopener noreferrer" class="footer__link-item">ClickHouse as a Service</a></li><li class="footer__item"><a href="https://clickhouse.com/careers/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers</a></li><li class="footer__item"><a href="https://clickhouse.com/learn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Learn ClickHouse</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ClickHouse/ClickHouse" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://clickhouse.com/blog/en/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/c/ClickHouseDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ClickHouseDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/clickhousedb/shared_invite/zt-rxm3rdrk-lIUmhLC3V8WTaL0TGxsOmg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Policies</div><ul class="footer__items"><li class="footer__item"><a href="https://clickhouse.com/legal/trademark-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trademark Policy</a></li><li class="footer__item"><a href="https://clickhouse.com/legal/privacy-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li><li class="footer__item"><a href="https://clickhouse.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/docs/staging/img/logo.png" alt="ClickHouse Documentation" class="themedImage_W2Cr themedImage--light_TfLj footer__logo"><img src="/docs/staging/img/logo.png" alt="ClickHouse Documentation" class="themedImage_W2Cr themedImage--dark_oUvU footer__logo"></div><div class="footer__copyright">Copyright © 2016 - 2022 ClickHouse, Inc. ClickHouse Docs provided under the Creative Commons CC BY-NC-SA license. ClickHouse is a registered trademark of ClickHouse, Inc.</div></div></div></footer></div>
<script src="/docs/staging/assets/js/runtime~main.cd5a0a95.js"></script>
<script src="/docs/staging/assets/js/main.2d8bfa12.js"></script>
</body>
</html>