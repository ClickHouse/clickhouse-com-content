<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-en/whats-new/changelog/2020">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<title data-rh="true">2020 | ClickHouse Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://clickhouse.com//docs/staging3/docs/en/whats-new/changelog/2020"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="2020 | ClickHouse Docs"><meta data-rh="true" name="description" content="ClickHouse release 20.12"><meta data-rh="true" property="og:description" content="ClickHouse release 20.12"><link data-rh="true" rel="icon" href="/docs/staging3/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://clickhouse.com//docs/staging3/docs/en/whats-new/changelog/2020"><link data-rh="true" rel="alternate" href="https://clickhouse.com//docs/staging3/docs/en/whats-new/changelog/2020" hreflang="en"><link data-rh="true" rel="alternate" href="https://clickhouse.com//docs/staging3/docs/en/whats-new/changelog/2020" hreflang="x-default"><link rel="stylesheet" href="/docs/staging3/assets/css/styles.c4f08da8.css">
<link rel="preload" href="/docs/staging3/assets/js/runtime~main.1413fc46.js" as="script">
<link rel="preload" href="/docs/staging3/assets/js/main.4e67e7ae.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_ObN2"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/staging3/docs/"><div class="navbar__logo"><img src="/docs/staging3/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docs/staging3/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">ClickHouse</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/staging3/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD sidebarWithHideableNavbar_d0QC"><a tabindex="-1" class="sidebarLogo_YUvz" href="/docs/staging3/docs/"><img src="/docs/staging3/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docs/staging3/img/clickhouse.svg" alt="ClickHouse" class="themedImage_W2Cr themedImage--dark_oUvU"><b>ClickHouse</b></a><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/staging3/docs/intro">What is ClickHouse?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/staging3/docs/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/staging3/docs/tutorial">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/staging3/docs/connect-a-ui">Connect a UI</a><button aria-label="Toggle the collapsible sidebar category &#x27;Connect a UI&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/staging3/docs/integrations">Integrations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Integrations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/staging3/docs/guides">User Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/staging3/docs/en">Reference Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging3/docs/en/getting-started/install">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging3/docs/en/getting-started/playground">Playground</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging3/docs/en/example-datasets">Example Datasets</a><button aria-label="Toggle the collapsible sidebar category &#x27;Example Datasets&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging3/docs/en/sql-reference/">SQL Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;SQL Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging3/docs/en/table-engines">Database &amp; Table Engines</a><button aria-label="Toggle the collapsible sidebar category &#x27;Database &amp; Table Engines&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging3/docs/en/interfaces/">Interfaces</a><button aria-label="Toggle the collapsible sidebar category &#x27;Interfaces&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging3/docs/en/operations/">Operations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/staging3/docs/category/building-clickhouse">Building ClickHouse</a><button aria-label="Toggle the collapsible sidebar category &#x27;Building ClickHouse&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/staging3/docs/en/whats-new/">What&#x27;s New</a><button aria-label="Toggle the collapsible sidebar category &#x27;What&#x27;s New&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/staging3/docs/en/whats-new/changelog/">Changelog</a><button aria-label="Toggle the collapsible sidebar category &#x27;Changelog&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging3/docs/en/whats-new/changelog/2021">2021</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/staging3/docs/en/whats-new/changelog/2020">2020</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging3/docs/en/whats-new/changelog/2019">2019</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging3/docs/en/whats-new/changelog/2018">2018</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging3/docs/en/whats-new/changelog/2017">2017</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging3/docs/en/whats-new/security-changelog">Security Changelog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/staging3/docs/en/whats-new/roadmap">Roadmap</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/staging3/docs/faq/">FAQ</a><button aria-label="Toggle the collapsible sidebar category &#x27;FAQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/staging3/docs/about-us">About Us</a><button aria-label="Toggle the collapsible sidebar category &#x27;About Us&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/staging3/docs/en"><span itemprop="name">Reference Guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/staging3/docs/en/whats-new/"><span itemprop="name">What&#x27;s New</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/staging3/docs/en/whats-new/changelog/"><span itemprop="name">Changelog</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">2020</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>2020</h1></header><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-2012">ClickHouse release 20.12<a class="hash-link" href="#clickhouse-release-2012" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2012514-stable-2020-12-28">ClickHouse release v20.12.5.14-stable, 2020-12-28<a class="hash-link" href="#clickhouse-release-v2012514-stable-2020-12-28" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix">Bug Fix<a class="hash-link" href="#bug-fix" title="Direct link to heading">​</a></h4><ul><li>Disable write with AIO during merges because it can lead to extremely rare data corruption of primary key columns during merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/18481" target="_blank" rel="noopener noreferrer">#18481</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>value is too short</code> error when executing <code>toType(...)</code> functions (<code>toDate</code>, <code>toUInt32</code>, etc) with argument of type <code>Nullable(String)</code>. Now such functions return <code>NULL</code> on parsing errors instead of throwing exception. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7673" target="_blank" rel="noopener noreferrer">#7673</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18445" target="_blank" rel="noopener noreferrer">#18445</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Restrict merges from wide to compact parts. In case of vertical merge it led to broken result part. <a href="https://github.com/ClickHouse/ClickHouse/pull/18381" target="_blank" rel="noopener noreferrer">#18381</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix filling table <code>system.settings_profile_elements</code>. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18231" target="_blank" rel="noopener noreferrer">#18231</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18379" target="_blank" rel="noopener noreferrer">#18379</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix possible crashes in aggregate functions with combinator <code>Distinct</code>, while using two-level aggregation. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17682" target="_blank" rel="noopener noreferrer">#17682</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18365" target="_blank" rel="noopener noreferrer">#18365</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix error when query <code>MODIFY COLUMN ... REMOVE TTL</code> does not actually remove column TTL. <a href="https://github.com/ClickHouse/ClickHouse/pull/18130" target="_blank" rel="noopener noreferrer">#18130</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement" title="Direct link to heading">​</a></h4><ul><li>Update timezones info to 2020e. <a href="https://github.com/ClickHouse/ClickHouse/pull/18531" target="_blank" rel="noopener noreferrer">#18531</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201245-stable-2020-12-24">ClickHouse release v20.12.4.5-stable, 2020-12-24<a class="hash-link" href="#clickhouse-release-v201245-stable-2020-12-24" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-1">Bug Fix<a class="hash-link" href="#bug-fix-1" title="Direct link to heading">​</a></h4><ul><li>Fixed issue when <code>clickhouse-odbc-bridge</code> process is unreachable by server on machines with dual IPv4/IPv6 stack; - Fixed issue when ODBC dictionary updates are performed using malformed queries and/or cause crashes; Possibly closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14489" target="_blank" rel="noopener noreferrer">#14489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18278" target="_blank" rel="noopener noreferrer">#18278</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>Fixed key comparison between Enum and Int types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17989" target="_blank" rel="noopener noreferrer">#17989</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18214" target="_blank" rel="noopener noreferrer">#18214</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed unique key convert crash in <code>MaterializeMySQL</code> database engine. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18186" target="_blank" rel="noopener noreferrer">#18186</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16372" target="_blank" rel="noopener noreferrer">#16372</a>  <a href="https://github.com/ClickHouse/ClickHouse/pull/18211" target="_blank" rel="noopener noreferrer">#18211</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <code>std::out_of_range: basic_string</code> in S3 URL parsing. <a href="https://github.com/ClickHouse/ClickHouse/pull/18059" target="_blank" rel="noopener noreferrer">#18059</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fixed the issue when some tables not synchronized to ClickHouse from MySQL caused by the fact that convertion MySQL prefix index wasn&#x27;t supported for MaterializeMySQL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15187" target="_blank" rel="noopener noreferrer">#15187</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17912" target="_blank" rel="noopener noreferrer">#17912</a>  <a href="https://github.com/ClickHouse/ClickHouse/pull/17944" target="_blank" rel="noopener noreferrer">#17944</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed the issue when query optimization was producing wrong result if query contains <code>ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17887" target="_blank" rel="noopener noreferrer">#17887</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Fixed possible segfault in <code>topK</code> aggregate function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17404" target="_blank" rel="noopener noreferrer">#17404</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17845" target="_blank" rel="noopener noreferrer">#17845</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fixed empty <code>system.stack_trace</code> table when server is running in daemon mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/17630" target="_blank" rel="noopener noreferrer">#17630</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201233-stable-2020-12-13">ClickHouse release v20.12.3.3-stable, 2020-12-13<a class="hash-link" href="#clickhouse-release-v201233-stable-2020-12-13" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change" title="Direct link to heading">​</a></h4><ul><li>Enable <code>use_compact_format_in_distributed_parts_names</code> by default (see the documentation for the reference). <a href="https://github.com/ClickHouse/ClickHouse/pull/16728" target="_blank" rel="noopener noreferrer">#16728</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Accept user settings related to file formats (e.g. <code>format_csv_delimiter</code>) in the <code>SETTINGS</code> clause when creating a table that uses <code>File</code> engine, and use these settings in all <code>INSERT</code>s and <code>SELECT</code>s. The file format settings changed in the current user session, or in the <code>SETTINGS</code> clause of a DML query itself, no longer affect the query. <a href="https://github.com/ClickHouse/ClickHouse/pull/16591" target="_blank" rel="noopener noreferrer">#16591</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature">New Feature<a class="hash-link" href="#new-feature" title="Direct link to heading">​</a></h4><ul><li>add <code>*.xz</code> compression/decompression support.It enables using <code>*.xz</code> in <code>file()</code> function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8828" target="_blank" rel="noopener noreferrer">#8828</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16578" target="_blank" rel="noopener noreferrer">#16578</a> (<a href="https://github.com/fibersel" target="_blank" rel="noopener noreferrer">Abi Palagashvili</a>).</li><li>Introduce the query <code>ALTER TABLE ... DROP|DETACH PART &#x27;part_name&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15511" target="_blank" rel="noopener noreferrer">#15511</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Added new ALTER UPDATE/DELETE IN PARTITION syntax. <a href="https://github.com/ClickHouse/ClickHouse/pull/13403" target="_blank" rel="noopener noreferrer">#13403</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Allow formatting named tuples as JSON objects when using JSON input/output formats, controlled by the <code>output_format_json_named_tuples_as_objects</code> setting, disabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/17175" target="_blank" rel="noopener noreferrer">#17175</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Add a possibility to input enum value as it&#x27;s id in TSV and CSV formats by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/16834" target="_blank" rel="noopener noreferrer">#16834</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Add COLLATE support for Nullable, LowCardinality, Array and Tuple, where nested type is String. Also refactor the code associated with collations in ColumnString.cpp. <a href="https://github.com/ClickHouse/ClickHouse/pull/16273" target="_blank" rel="noopener noreferrer">#16273</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>New <code>tcpPort</code> function returns TCP port listened by this server. <a href="https://github.com/ClickHouse/ClickHouse/pull/17134" target="_blank" rel="noopener noreferrer">#17134</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Add new math functions: <code>acosh</code>, <code>asinh</code>, <code>atan2</code>, <code>atanh</code>, <code>cosh</code>, <code>hypot</code>, <code>log1p</code>, <code>sinh</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16636" target="_blank" rel="noopener noreferrer">#16636</a> (<a href="https://github.com/hombit" target="_blank" rel="noopener noreferrer">Konstantin Malanchev</a>).</li><li>Possibility to distribute the merges between different replicas. Introduces the <code>execute_merges_on_single_replica_time_threshold</code> mergetree setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/16424" target="_blank" rel="noopener noreferrer">#16424</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Add setting <code>aggregate_functions_null_for_empty</code> for SQL standard compatibility. This option will rewrite all aggregate functions in a query, adding -OrNull suffix to them. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/10273" target="_blank" rel="noopener noreferrer">10273</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16123" target="_blank" rel="noopener noreferrer">#16123</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Updated DateTime, DateTime64 parsing to accept string Date literal format. <a href="https://github.com/ClickHouse/ClickHouse/pull/16040" target="_blank" rel="noopener noreferrer">#16040</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Make it possible to change the path to history file in <code>clickhouse-client</code> using the <code>--history_file</code> parameter. <a href="https://github.com/ClickHouse/ClickHouse/pull/15960" target="_blank" rel="noopener noreferrer">#15960</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-2">Bug Fix<a class="hash-link" href="#bug-fix-2" title="Direct link to heading">​</a></h4><ul><li>Fix the issue when server can stop accepting connections in very rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/17542" target="_blank" rel="noopener noreferrer">#17542</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed <code>Function not implemented</code> error when executing <code>RENAME</code> query in <code>Atomic</code> database with ClickHouse running on Windows Subsystem for Linux. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17661" target="_blank" rel="noopener noreferrer">#17661</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17664" target="_blank" rel="noopener noreferrer">#17664</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Do not restore parts from WAL if <code>in_memory_parts_enable_wal</code> is disabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/17802" target="_blank" rel="noopener noreferrer">#17802</a> (<a href="https://github.com/detailyang" target="_blank" rel="noopener noreferrer">detailyang</a>).</li><li>fix incorrect initialization of <code>max_compress_block_size</code> of MergeTreeWriterSettings with <code>min_compress_block_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17833" target="_blank" rel="noopener noreferrer">#17833</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Exception message about max table size to drop was displayed incorrectly. <a href="https://github.com/ClickHouse/ClickHouse/pull/17764" target="_blank" rel="noopener noreferrer">#17764</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed possible segfault when there is not enough space when inserting into <code>Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/17737" target="_blank" rel="noopener noreferrer">#17737</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" target="_blank" rel="noopener noreferrer">#17681</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>In might be determined incorrectly if cluster is circular- (cross-) replicated or not when executing <code>ON CLUSTER</code> query due to race condition when <code>pool_size</code> &gt; 1. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/17640" target="_blank" rel="noopener noreferrer">#17640</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Exception <code>fmt::v7::format_error</code> can be logged in background for MergeTree tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17613" target="_blank" rel="noopener noreferrer">#17613</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17615" target="_blank" rel="noopener noreferrer">#17615</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>When clickhouse-client is used in interactive mode with multiline queries, single line comment was erronously extended till the end of query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13654" target="_blank" rel="noopener noreferrer">#13654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17565" target="_blank" rel="noopener noreferrer">#17565</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix alter query hang when the corresponding mutation was killed on the different replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" target="_blank" rel="noopener noreferrer">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" target="_blank" rel="noopener noreferrer">#17499</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix issue when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" target="_blank" rel="noopener noreferrer">#17496</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix <code>ORDER BY</code> with enabled setting <code>optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" target="_blank" rel="noopener noreferrer">#17471</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix duplicates after <code>DISTINCT</code> which were possible because of incorrect optimization. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17294" target="_blank" rel="noopener noreferrer">#17294</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17296" target="_blank" rel="noopener noreferrer">#17296</a> (<a href="https://github.com/chengxianglibra" target="_blank" rel="noopener noreferrer">li chengxiang</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17439" target="_blank" rel="noopener noreferrer">#17439</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix crash while reading from <code>JOIN</code> table with <code>LowCardinality</code> types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17228" target="_blank" rel="noopener noreferrer">#17228</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17397" target="_blank" rel="noopener noreferrer">#17397</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>fix <code>toInt256(inf)</code> stack overflow. Int256 is an experimental feature. Closed <a href="https://github.com/ClickHouse/ClickHouse/issues/17235" target="_blank" rel="noopener noreferrer">#17235</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17257" target="_blank" rel="noopener noreferrer">#17257</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Fix possible <code>Unexpected packet Data received from client</code> error logged for Distributed queries with <code>LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17254" target="_blank" rel="noopener noreferrer">#17254</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix set index invalidation when there are const columns in the subquery. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17246" target="_blank" rel="noopener noreferrer">#17246</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17249" target="_blank" rel="noopener noreferrer">#17249</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix possible wrong index analysis when the types of the index comparison are different. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17122" target="_blank" rel="noopener noreferrer">#17122</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17145" target="_blank" rel="noopener noreferrer">#17145</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix ColumnConst comparison which leads to crash. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/17088" target="_blank" rel="noopener noreferrer">#17088</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17135" target="_blank" rel="noopener noreferrer">#17135</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Multiple fixed for MaterializeMySQL (experimental feature). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16923" target="_blank" rel="noopener noreferrer">#16923</a> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15883" target="_blank" rel="noopener noreferrer">#15883</a> Fix MaterializeMySQL SYNC failure when the modify MySQL binlog_checksum. <a href="https://github.com/ClickHouse/ClickHouse/pull/17091" target="_blank" rel="noopener noreferrer">#17091</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix bug when <code>ON CLUSTER</code> queries may hang forever for non-leader ReplicatedMergeTreeTables. <a href="https://github.com/ClickHouse/ClickHouse/pull/17089" target="_blank" rel="noopener noreferrer">#17089</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed crash on <code>CREATE TABLE ... AS some_table</code> query when <code>some_table</code> was created <code>AS table_function()</code> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16944" target="_blank" rel="noopener noreferrer">#16944</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17072" target="_blank" rel="noopener noreferrer">#17072</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Bug unfinished implementation for funciton fuzzBits, related issue: <a href="https://github.com/ClickHouse/ClickHouse/issues/16980" target="_blank" rel="noopener noreferrer">#16980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17051" target="_blank" rel="noopener noreferrer">#17051</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fix LLVM&#x27;s libunwind in the case when CFA register is RAX. This is the <a href="https://bugs.llvm.org/show_bug.cgi?id=48186" target="_blank" rel="noopener noreferrer">bug</a> in <a href="https://github.com/llvm/llvm-project/tree/master/libunwind" target="_blank" rel="noopener noreferrer">LLVM&#x27;s libunwind</a>. We already have workarounds for this bug. <a href="https://github.com/ClickHouse/ClickHouse/pull/17046" target="_blank" rel="noopener noreferrer">#17046</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Avoid unnecessary network errors for remote queries which may be cancelled while execution, like queries with <code>LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17006" target="_blank" rel="noopener noreferrer">#17006</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>optimize_distributed_group_by_sharding_key</code> setting (that is disabled by default) for query with OFFSET only. <a href="https://github.com/ClickHouse/ClickHouse/pull/16996" target="_blank" rel="noopener noreferrer">#16996</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix for Merge tables over Distributed tables with JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/16993" target="_blank" rel="noopener noreferrer">#16993</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed wrong result in big integers (128, 256 bit) when casting from double. Big integers support is experimental. <a href="https://github.com/ClickHouse/ClickHouse/pull/16986" target="_blank" rel="noopener noreferrer">#16986</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Fix possible server crash after <code>ALTER TABLE ... MODIFY COLUMN ... NewType</code> when <code>SELECT</code> have <code>WHERE</code> expression on altering column and alter does not finished yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/16968" target="_blank" rel="noopener noreferrer">#16968</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Blame info was not calculated correctly in <code>clickhouse-git-import</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16959" target="_blank" rel="noopener noreferrer">#16959</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix order by optimization with monotonous functions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16107" target="_blank" rel="noopener noreferrer">#16107</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16956" target="_blank" rel="noopener noreferrer">#16956</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix optimization of group by with enabled setting <code>optimize_aggregators_of_group_by_keys</code> and joins. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12604" target="_blank" rel="noopener noreferrer">#12604</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16951" target="_blank" rel="noopener noreferrer">#16951</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible error <code>Illegal type of argument</code> for queries with <code>ORDER BY</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16580" target="_blank" rel="noopener noreferrer">#16580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16928" target="_blank" rel="noopener noreferrer">#16928</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix strange code in InterpreterShowAccessQuery. <a href="https://github.com/ClickHouse/ClickHouse/pull/16866" target="_blank" rel="noopener noreferrer">#16866</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Prevent clickhouse server crashes when using the function <code>timeSeriesGroupSum</code>. The function is removed from newer ClickHouse releases. <a href="https://github.com/ClickHouse/ClickHouse/pull/16865" target="_blank" rel="noopener noreferrer">#16865</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix rare silent crashes when query profiler is on and ClickHouse is installed on OS with glibc version that has (supposedly) broken asynchronous unwind tables for some functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15301" target="_blank" rel="noopener noreferrer">#15301</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13098" target="_blank" rel="noopener noreferrer">#13098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16846" target="_blank" rel="noopener noreferrer">#16846</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash when using <code>any</code> without any arguments. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/16803" target="_blank" rel="noopener noreferrer">#16803</a> . cc @azat. <a href="https://github.com/ClickHouse/ClickHouse/pull/16826" target="_blank" rel="noopener noreferrer">#16826</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>If no memory can be allocated while writing table metadata on disk, broken metadata file can be written. <a href="https://github.com/ClickHouse/ClickHouse/pull/16772" target="_blank" rel="noopener noreferrer">#16772</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix trivial query optimization with partition predicate. <a href="https://github.com/ClickHouse/ClickHouse/pull/16767" target="_blank" rel="noopener noreferrer">#16767</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>IN</code> operator over several columns and tuples with enabled <code>transform_null_in</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15310" target="_blank" rel="noopener noreferrer">#15310</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16722" target="_blank" rel="noopener noreferrer">#16722</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Return number of affected rows for INSERT queries via MySQL protocol. Previously ClickHouse used to always return 0, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16605" target="_blank" rel="noopener noreferrer">#16605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16715" target="_blank" rel="noopener noreferrer">#16715</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix remote query failure when using &#x27;if&#x27; suffix aggregate function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16574" target="_blank" rel="noopener noreferrer">#16574</a> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16231" target="_blank" rel="noopener noreferrer">#16231</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/16610" target="_blank" rel="noopener noreferrer">#16610</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix inconsistent behavior caused by <code>select_sequential_consistency</code> for optimized trivial count query and system.tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/16309" target="_blank" rel="noopener noreferrer">#16309</a> (<a href="https://github.com/haoch" target="_blank" rel="noopener noreferrer">Hao Chen</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement">Improvement<a class="hash-link" href="#improvement" title="Direct link to heading">​</a></h4><ul><li>Remove empty parts after they were pruned by TTL, mutation, or collapsing merge algorithm. <a href="https://github.com/ClickHouse/ClickHouse/pull/16895" target="_blank" rel="noopener noreferrer">#16895</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Enable compact format of directories for asynchronous sends in Distributed tables: <code>use_compact_format_in_distributed_parts_names</code> is set to 1 by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/16788" target="_blank" rel="noopener noreferrer">#16788</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Abort multipart upload if no data was written to S3. <a href="https://github.com/ClickHouse/ClickHouse/pull/16840" target="_blank" rel="noopener noreferrer">#16840</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Reresolve the IP of the <code>format_avro_schema_registry_url</code> in case of errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16985" target="_blank" rel="noopener noreferrer">#16985</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Mask password in data_path in the system.distribution_queue. <a href="https://github.com/ClickHouse/ClickHouse/pull/16727" target="_blank" rel="noopener noreferrer">#16727</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Throw error when use column transformer replaces non existing column. <a href="https://github.com/ClickHouse/ClickHouse/pull/16183" target="_blank" rel="noopener noreferrer">#16183</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Turn off parallel parsing when there is no enough memory for all threads to work simultaneously. Also there could be exceptions like &quot;Memory limit exceeded&quot; when somebody will try to insert extremely huge rows (&gt; min_chunk_bytes_for_parallel_parsing), because each piece to parse has to be independent set of strings (one or more). <a href="https://github.com/ClickHouse/ClickHouse/pull/16721" target="_blank" rel="noopener noreferrer">#16721</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Install script should always create subdirs in config folders. This is only relevant for Docker build with custom config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16936" target="_blank" rel="noopener noreferrer">#16936</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Correct grammar in error message in JSONEachRow, JSONCompactEachRow, and RegexpRow input formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/17205" target="_blank" rel="noopener noreferrer">#17205</a> (<a href="https://github.com/sneako" target="_blank" rel="noopener noreferrer">nico piderman</a>).</li><li>Set default <code>host</code> and <code>port</code> parameters for <code>SOURCE(CLICKHOUSE(...))</code> to current instance and set default <code>user</code> value to <code>&#x27;default&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16997" target="_blank" rel="noopener noreferrer">#16997</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li><li>Throw an informative error message when doing <code>ATTACH/DETACH TABLE &lt;DICTIONARY&gt;</code>. Before this PR, <code>detach table &lt;dict&gt;</code> works but leads to an ill-formed in-memory metadata. <a href="https://github.com/ClickHouse/ClickHouse/pull/16885" target="_blank" rel="noopener noreferrer">#16885</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add cutToFirstSignificantSubdomainWithWWW(). <a href="https://github.com/ClickHouse/ClickHouse/pull/16845" target="_blank" rel="noopener noreferrer">#16845</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Server refused to startup with exception message if wrong config is given (<code>metric_log</code>.<code>collect_interval_milliseconds</code> is missing). <a href="https://github.com/ClickHouse/ClickHouse/pull/16815" target="_blank" rel="noopener noreferrer">#16815</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Better exception message when configuration for distributed DDL is absent. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5075" target="_blank" rel="noopener noreferrer">#5075</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16769" target="_blank" rel="noopener noreferrer">#16769</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Usability improvement: better suggestions in syntax error message when <code>CODEC</code> expression is misplaced in <code>CREATE TABLE</code> query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12493" target="_blank" rel="noopener noreferrer">#12493</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16768" target="_blank" rel="noopener noreferrer">#16768</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove empty directories for async INSERT at start of Distributed engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/16729" target="_blank" rel="noopener noreferrer">#16729</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Workaround for use S3 with nginx server as proxy. Nginx currenty does not accept urls with empty path like <code>http://domain.com?delete</code>, but vanilla aws-sdk-cpp produces this kind of urls. This commit uses patched aws-sdk-cpp version, which makes urls with &quot;/&quot; as path in this cases, like <code>http://domain.com/?delete</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16709" target="_blank" rel="noopener noreferrer">#16709</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Allow <code>reinterpretAs*</code> functions to work for integers and floats of the same size. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/16640" target="_blank" rel="noopener noreferrer">16640</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16657" target="_blank" rel="noopener noreferrer">#16657</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Now, <code>&lt;auxiliary_zookeepers&gt;</code> configuration can be changed in <code>config.xml</code> and reloaded without server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/16627" target="_blank" rel="noopener noreferrer">#16627</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support SNI in https connections to remote resources. This will allow to connect to Cloudflare servers that require SNI. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10055" target="_blank" rel="noopener noreferrer">#10055</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16252" target="_blank" rel="noopener noreferrer">#16252</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make it possible to connect to <code>clickhouse-server</code> secure endpoint which requires SNI. This is possible when <code>clickhouse-server</code> is hosted behind TLS proxy. <a href="https://github.com/ClickHouse/ClickHouse/pull/16938" target="_blank" rel="noopener noreferrer">#16938</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix possible stack overflow if a loop of materialized views is created. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15732" target="_blank" rel="noopener noreferrer">#15732</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16048" target="_blank" rel="noopener noreferrer">#16048</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Simplify the implementation of background tasks processing for the MergeTree table engines family. There should be no visible changes for user. <a href="https://github.com/ClickHouse/ClickHouse/pull/15983" target="_blank" rel="noopener noreferrer">#15983</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Improvement for MaterializeMySQL (experimental feature). Throw exception about right sync privileges when MySQL sync user has error privileges. <a href="https://github.com/ClickHouse/ClickHouse/pull/15977" target="_blank" rel="noopener noreferrer">#15977</a> (<a href="https://github.com/TCeason" target="_blank" rel="noopener noreferrer">TCeason</a>).</li><li>Made <code>indexOf()</code> use BloomFilter. <a href="https://github.com/ClickHouse/ClickHouse/pull/14977" target="_blank" rel="noopener noreferrer">#14977</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement">Performance Improvement<a class="hash-link" href="#performance-improvement" title="Direct link to heading">​</a></h4><ul><li>Use Floyd-Rivest algorithm, it is the best for the ClickHouse use case of partial sorting. Bechmarks are in <a href="https://github.com/danlark1/miniselect" target="_blank" rel="noopener noreferrer">https://github.com/danlark1/miniselect</a> and <a href="https://drive.google.com/drive/folders/1DHEaeXgZuX6AJ9eByeZ8iQVQv0ueP8XM" target="_blank" rel="noopener noreferrer">here</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16825" target="_blank" rel="noopener noreferrer">#16825</a> (<a href="https://github.com/danlark1" target="_blank" rel="noopener noreferrer">Danila Kutenin</a>).</li><li>Now <code>ReplicatedMergeTree</code> tree engines family uses a separate thread pool for replicated fetches. Size of the pool limited by setting <code>background_fetches_pool_size</code> which can be tuned with a server restart. The default value of the setting is 3 and it means that the maximum amount of parallel fetches is equal to 3 (and it allows to utilize 10G network). Fixes #520. <a href="https://github.com/ClickHouse/ClickHouse/pull/16390" target="_blank" rel="noopener noreferrer">#16390</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed uncontrolled growth of the state of <code>quantileTDigest</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16680" target="_blank" rel="noopener noreferrer">#16680</a> (<a href="https://github.com/hrissan" target="_blank" rel="noopener noreferrer">hrissan</a>).</li><li>Add <code>VIEW</code> subquery description to <code>EXPLAIN</code>. Limit push down optimisation for <code>VIEW</code>. Add local replicas of <code>Distributed</code> to query plan. <a href="https://github.com/ClickHouse/ClickHouse/pull/14936" target="_blank" rel="noopener noreferrer">#14936</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix optimize_read_in_order/optimize_aggregation_in_order with max_threads &gt; 0 and expression in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/16637" target="_blank" rel="noopener noreferrer">#16637</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix performance of reading from <code>Merge</code> tables over huge number of <code>MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7748" target="_blank" rel="noopener noreferrer">#7748</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16988" target="_blank" rel="noopener noreferrer">#16988</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Now we can safely prune partitions with exact match. Useful case: Suppose table is partitioned by <code>intHash64(x) % 100</code> and the query has condition on <code>intHash64(x) % 100</code> verbatim, not on x. <a href="https://github.com/ClickHouse/ClickHouse/pull/16253" target="_blank" rel="noopener noreferrer">#16253</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature">Experimental Feature<a class="hash-link" href="#experimental-feature" title="Direct link to heading">​</a></h4><ul><li>Add <code>EmbeddedRocksDB</code> table engine (can be used for dictionaries). <a href="https://github.com/ClickHouse/ClickHouse/pull/15073" target="_blank" rel="noopener noreferrer">#15073</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-1">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-1" title="Direct link to heading">​</a></h4><ul><li>Improvements in test coverage building images. <a href="https://github.com/ClickHouse/ClickHouse/pull/17233" target="_blank" rel="noopener noreferrer">#17233</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Update embedded timezone data to version 2020d (also update cctz to the latest master). <a href="https://github.com/ClickHouse/ClickHouse/pull/17204" target="_blank" rel="noopener noreferrer">#17204</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix UBSan report in Poco. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12719" target="_blank" rel="noopener noreferrer">#12719</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16765" target="_blank" rel="noopener noreferrer">#16765</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Do not instrument 3rd-party libraries with UBSan. <a href="https://github.com/ClickHouse/ClickHouse/pull/16764" target="_blank" rel="noopener noreferrer">#16764</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix UBSan report in cache dictionaries. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12641" target="_blank" rel="noopener noreferrer">#12641</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16763" target="_blank" rel="noopener noreferrer">#16763</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix UBSan report when trying to convert infinite floating point number to integer. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14190" target="_blank" rel="noopener noreferrer">#14190</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16677" target="_blank" rel="noopener noreferrer">#16677</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-2011">ClickHouse release 20.11<a class="hash-link" href="#clickhouse-release-2011" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2011716-stable-2021-03-02">ClickHouse release v20.11.7.16-stable, 2021-03-02<a class="hash-link" href="#clickhouse-release-v2011716-stable-2021-03-02" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-1">Improvement<a class="hash-link" href="#improvement-1" title="Direct link to heading">​</a></h4><ul><li>Explicitly set uid / gid of clickhouse user &amp; group to the fixed values (101) in clickhouse-server images. <a href="https://github.com/ClickHouse/ClickHouse/pull/19096" target="_blank" rel="noopener noreferrer">#19096</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-3">Bug Fix<a class="hash-link" href="#bug-fix-3" title="Direct link to heading">​</a></h4><ul><li>BloomFilter index crash fix. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19757" target="_blank" rel="noopener noreferrer">#19757</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19884" target="_blank" rel="noopener noreferrer">#19884</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Deadlock was possible if system.text_log is enabled. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19874" target="_blank" rel="noopener noreferrer">#19874</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19875" target="_blank" rel="noopener noreferrer">#19875</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>In previous versions, unusual arguments for function arrayEnumerateUniq may cause crash or infinite loop. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19787" target="_blank" rel="noopener noreferrer">#19787</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19788" target="_blank" rel="noopener noreferrer">#19788</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed stack overflow when using accurate comparison of arithmetic type with string type. <a href="https://github.com/ClickHouse/ClickHouse/pull/19773" target="_blank" rel="noopener noreferrer">#19773</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix a segmentation fault in <code>bitmapAndnot</code> function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19668" target="_blank" rel="noopener noreferrer">#19668</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19713" target="_blank" rel="noopener noreferrer">#19713</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Some functions with big integers may cause segfault. Big integers is experimental feature. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19667" target="_blank" rel="noopener noreferrer">#19667</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19672" target="_blank" rel="noopener noreferrer">#19672</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix wrong result of function <code>neighbor</code> for <code>LowCardinality</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10333" target="_blank" rel="noopener noreferrer">#10333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19617" target="_blank" rel="noopener noreferrer">#19617</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix use-after-free of the CompressedWriteBuffer in Connection after disconnect. <a href="https://github.com/ClickHouse/ClickHouse/pull/19599" target="_blank" rel="noopener noreferrer">#19599</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li><code>DROP/DETACH TABLE table ON CLUSTER cluster SYNC</code> query might hang, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19568" target="_blank" rel="noopener noreferrer">#19568</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19572" target="_blank" rel="noopener noreferrer">#19572</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Query CREATE DICTIONARY id expression fix. <a href="https://github.com/ClickHouse/ClickHouse/pull/19571" target="_blank" rel="noopener noreferrer">#19571</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Fix SIGSEGV with merge_tree_min_rows_for_concurrent_read/merge_tree_min_bytes_for_concurrent_read=0/UINT64_MAX. <a href="https://github.com/ClickHouse/ClickHouse/pull/19528" target="_blank" rel="noopener noreferrer">#19528</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Buffer overflow (on memory read) was possible if <code>addMonth</code> function was called with specifically crafted arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19441" target="_blank" rel="noopener noreferrer">#19441</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19413" target="_blank" rel="noopener noreferrer">#19413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19472" target="_blank" rel="noopener noreferrer">#19472</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Mark distributed batch as broken in case of empty data block in one of files. <a href="https://github.com/ClickHouse/ClickHouse/pull/19449" target="_blank" rel="noopener noreferrer">#19449</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible buffer overflow in Uber H3 library. See <a href="https://github.com/uber/h3/issues/392" target="_blank" rel="noopener noreferrer">https://github.com/uber/h3/issues/392</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/19219" target="_blank" rel="noopener noreferrer">#19219</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19383" target="_blank" rel="noopener noreferrer">#19383</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix system.parts _state column (LOGICAL_ERROR when querying this column, due to incorrect order). <a href="https://github.com/ClickHouse/ClickHouse/pull/19346" target="_blank" rel="noopener noreferrer">#19346</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix error <code>Cannot convert column now64() because it is constant but values of constants are different in source and result</code>. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/7156" target="_blank" rel="noopener noreferrer">#7156</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19316" target="_blank" rel="noopener noreferrer">#19316</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bug when concurrent <code>ALTER</code> and <code>DROP</code> queries may hang while processing ReplicatedMergeTree table. <a href="https://github.com/ClickHouse/ClickHouse/pull/19237" target="_blank" rel="noopener noreferrer">#19237</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix infinite reading from file in <code>ORC</code> format (was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/10580" target="_blank" rel="noopener noreferrer">#10580</a>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19095" target="_blank" rel="noopener noreferrer">#19095</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19134" target="_blank" rel="noopener noreferrer">#19134</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix startup bug when clickhouse was not able to read compression codec from <code>LowCardinality(Nullable(...))</code> and throws exception <code>Attempt to read after EOF</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18340" target="_blank" rel="noopener noreferrer">#18340</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19101" target="_blank" rel="noopener noreferrer">#19101</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>There is no checkpoint</code> error when inserting data through http interface using <code>Template</code> or <code>CustomSeparated</code> format. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/19021" target="_blank" rel="noopener noreferrer">#19021</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19072" target="_blank" rel="noopener noreferrer">#19072</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Restrict <code>MODIFY TTL</code> queries for <code>MergeTree</code> tables created in old syntax. Previously the query succeeded, but actually it had no effect. <a href="https://github.com/ClickHouse/ClickHouse/pull/19064" target="_blank" rel="noopener noreferrer">#19064</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Make sure <code>groupUniqArray</code> returns correct type for argument of Enum type. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17875" target="_blank" rel="noopener noreferrer">#17875</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19019" target="_blank" rel="noopener noreferrer">#19019</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix possible error <code>Expected single dictionary argument for function</code> if use function <code>ignore</code> with <code>LowCardinality</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14275" target="_blank" rel="noopener noreferrer">#14275</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19016" target="_blank" rel="noopener noreferrer">#19016</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix inserting of <code>LowCardinality</code> column to table with <code>TinyLog</code> engine. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18629" target="_blank" rel="noopener noreferrer">#18629</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/19010" target="_blank" rel="noopener noreferrer">#19010</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Disable <code>optimize_move_functions_out_of_any</code> because optimization is not always correct. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18051" target="_blank" rel="noopener noreferrer">#18051</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/18973" target="_blank" rel="noopener noreferrer">#18973</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18981" target="_blank" rel="noopener noreferrer">#18981</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed very rare deadlock at shutdown. <a href="https://github.com/ClickHouse/ClickHouse/pull/18977" target="_blank" rel="noopener noreferrer">#18977</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix bug when mutation with some escaped text (like <code>ALTER ... UPDATE e = CAST(&#x27;foo&#x27;, &#x27;Enum8(\&#x27;foo\&#x27; = 1&#x27;)</code> serialized incorrectly. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18878" target="_blank" rel="noopener noreferrer">#18878</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18944" target="_blank" rel="noopener noreferrer">#18944</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Attach partition should reset the mutation. <a href="https://github.com/ClickHouse/ClickHouse/issues/18804" target="_blank" rel="noopener noreferrer">#18804</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18935" target="_blank" rel="noopener noreferrer">#18935</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Fix possible hang at shutdown in clickhouse-local. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18891" target="_blank" rel="noopener noreferrer">#18891</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18893" target="_blank" rel="noopener noreferrer">#18893</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix *If combinator with unary function and Nullable types. <a href="https://github.com/ClickHouse/ClickHouse/pull/18806" target="_blank" rel="noopener noreferrer">#18806</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Asynchronous distributed INSERTs can be rejected by the server if the setting <code>network_compression_method</code> is globally set to non-default value. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18741" target="_blank" rel="noopener noreferrer">#18741</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18776" target="_blank" rel="noopener noreferrer">#18776</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>Attempt to read after eof</code> error when trying to <code>CAST</code> <code>NULL</code> from <code>Nullable(String)</code> to <code>Nullable(Decimal(P, S))</code>. Now function <code>CAST</code> returns <code>NULL</code> when it cannot parse decimal from nullable string. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7690" target="_blank" rel="noopener noreferrer">#7690</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18718" target="_blank" rel="noopener noreferrer">#18718</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix Logger with unmatched arg size. <a href="https://github.com/ClickHouse/ClickHouse/pull/18717" target="_blank" rel="noopener noreferrer">#18717</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Add FixedString Data type support. I&#x27;ll get this exception &quot;Code: 50, e.displayText() = DB::Exception: Unsupported type FixedString(1)&quot; when replicating data from MySQL to ClickHouse. This patch fixes bug <a href="https://github.com/ClickHouse/ClickHouse/issues/18450" target="_blank" rel="noopener noreferrer">#18450</a> Also fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6556" target="_blank" rel="noopener noreferrer">#6556</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18553" target="_blank" rel="noopener noreferrer">#18553</a> (<a href="https://github.com/awesomeleo" target="_blank" rel="noopener noreferrer">awesomeleo</a>).</li><li>Fix possible <code>Pipeline stuck</code> error while using <code>ORDER BY</code> after subquery with <code>RIGHT</code> or <code>FULL</code> join. <a href="https://github.com/ClickHouse/ClickHouse/pull/18550" target="_blank" rel="noopener noreferrer">#18550</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bug which may lead to <code>ALTER</code> queries hung after corresponding mutation kill. Found by thread fuzzer. <a href="https://github.com/ClickHouse/ClickHouse/pull/18518" target="_blank" rel="noopener noreferrer">#18518</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Disable write with AIO during merges because it can lead to extremely rare data corruption of primary key columns during merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/18481" target="_blank" rel="noopener noreferrer">#18481</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Disable constant folding for subqueries on the analysis stage, when the result cannot be calculated. <a href="https://github.com/ClickHouse/ClickHouse/pull/18446" target="_blank" rel="noopener noreferrer">#18446</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <code>value is too short</code> error when executing <code>toType(...)</code> functions (<code>toDate</code>, <code>toUInt32</code>, etc) with argument of type <code>Nullable(String)</code>. Now such functions return <code>NULL</code> on parsing errors instead of throwing exception. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7673" target="_blank" rel="noopener noreferrer">#7673</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18445" target="_blank" rel="noopener noreferrer">#18445</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Restrict merges from wide to compact parts. In case of vertical merge it led to broken result part. <a href="https://github.com/ClickHouse/ClickHouse/pull/18381" target="_blank" rel="noopener noreferrer">#18381</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix filling table <code>system.settings_profile_elements</code>. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18231" target="_blank" rel="noopener noreferrer">#18231</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18379" target="_blank" rel="noopener noreferrer">#18379</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix index analysis of binary functions with constant argument which leads to wrong query results. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18364" target="_blank" rel="noopener noreferrer">#18364</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18373" target="_blank" rel="noopener noreferrer">#18373</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix possible crashes in aggregate functions with combinator <code>Distinct</code>, while using two-level aggregation. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17682" target="_blank" rel="noopener noreferrer">#17682</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18365" target="_blank" rel="noopener noreferrer">#18365</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li><code>SELECT count() FROM table</code> now can be executed if only one any column can be selected from the <code>table</code>. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10639" target="_blank" rel="noopener noreferrer">#10639</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18233" target="_blank" rel="noopener noreferrer">#18233</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li><code>SELECT JOIN</code> now requires the <code>SELECT</code> privilege on each of the joined tables. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17654" target="_blank" rel="noopener noreferrer">#17654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18232" target="_blank" rel="noopener noreferrer">#18232</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix possible incomplete query result while reading from <code>MergeTree*</code> in case of read backoff (message <code>&lt;Debug&gt; MergeTreeReadPool: Will lower number of threads</code> in logs). Was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/16423" target="_blank" rel="noopener noreferrer">#16423</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18137" target="_blank" rel="noopener noreferrer">#18137</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18216" target="_blank" rel="noopener noreferrer">#18216</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix error when query <code>MODIFY COLUMN ... REMOVE TTL</code> does not actually remove column TTL. <a href="https://github.com/ClickHouse/ClickHouse/pull/18130" target="_blank" rel="noopener noreferrer">#18130</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix indeterministic functions with predicate optimizer. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17244" target="_blank" rel="noopener noreferrer">#17244</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17273" target="_blank" rel="noopener noreferrer">#17273</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Mutation might hang waiting for some non-existent part after <code>MOVE</code> or <code>REPLACE PARTITION</code> or, in rare cases, after <code>DETACH</code> or <code>DROP PARTITION</code>. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" target="_blank" rel="noopener noreferrer">#15537</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-2">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-2" title="Direct link to heading">​</a></h4><ul><li>Update timezones info to 2020e. <a href="https://github.com/ClickHouse/ClickHouse/pull/18531" target="_blank" rel="noopener noreferrer">#18531</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201166-stable-2020-12-24">ClickHouse release v20.11.6.6-stable, 2020-12-24<a class="hash-link" href="#clickhouse-release-v201166-stable-2020-12-24" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-4">Bug Fix<a class="hash-link" href="#bug-fix-4" title="Direct link to heading">​</a></h4><ul><li>Fixed issue when <code>clickhouse-odbc-bridge</code> process is unreachable by server on machines with dual <code>IPv4/IPv6 stack</code> and fixed issue when ODBC dictionary updates are performed using malformed queries and/or cause crashes. This possibly closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14489" target="_blank" rel="noopener noreferrer">#14489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18278" target="_blank" rel="noopener noreferrer">#18278</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>Fixed key comparison between Enum and Int types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17989" target="_blank" rel="noopener noreferrer">#17989</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18214" target="_blank" rel="noopener noreferrer">#18214</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed unique key convert crash in <code>MaterializeMySQL</code> database engine. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18186" target="_blank" rel="noopener noreferrer">#18186</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16372" target="_blank" rel="noopener noreferrer">#16372</a>  <a href="https://github.com/ClickHouse/ClickHouse/pull/18211" target="_blank" rel="noopener noreferrer">#18211</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <code>std::out_of_range: basic_string</code> in S3 URL parsing. <a href="https://github.com/ClickHouse/ClickHouse/pull/18059" target="_blank" rel="noopener noreferrer">#18059</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fixed the issue when some tables not synchronized to ClickHouse from MySQL caused by the fact that convertion MySQL prefix index wasn&#x27;t supported for MaterializeMySQL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15187" target="_blank" rel="noopener noreferrer">#15187</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17912" target="_blank" rel="noopener noreferrer">#17912</a>  <a href="https://github.com/ClickHouse/ClickHouse/pull/17944" target="_blank" rel="noopener noreferrer">#17944</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed the issue when query optimization was producing wrong result if query contains <code>ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17887" target="_blank" rel="noopener noreferrer">#17887</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Fix possible segfault in <code>topK</code> aggregate function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17404" target="_blank" rel="noopener noreferrer">#17404</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17845" target="_blank" rel="noopener noreferrer">#17845</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Do not restore parts from WAL if <code>in_memory_parts_enable_wal</code> is disabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/17802" target="_blank" rel="noopener noreferrer">#17802</a> (<a href="https://github.com/detailyang" target="_blank" rel="noopener noreferrer">detailyang</a>).</li><li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" target="_blank" rel="noopener noreferrer">#17681</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Fixed inconsistent behaviour of <code>optimize_trivial_count_query</code> with partition predicate. <a href="https://github.com/ClickHouse/ClickHouse/pull/17644" target="_blank" rel="noopener noreferrer">#17644</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed empty <code>system.stack_trace</code> table when server is running in daemon mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/17630" target="_blank" rel="noopener noreferrer">#17630</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed the behaviour when xxception <code>fmt::v7::format_error</code> can be logged in background for MergeTree tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17613" target="_blank" rel="noopener noreferrer">#17613</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17615" target="_blank" rel="noopener noreferrer">#17615</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the behaviour when clickhouse-client is used in interactive mode with multiline queries and single line comment was erronously extended till the end of query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13654" target="_blank" rel="noopener noreferrer">#13654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17565" target="_blank" rel="noopener noreferrer">#17565</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the issue when server can stop accepting connections in very rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/17542" target="_blank" rel="noopener noreferrer">#17542</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed alter query hang when the corresponding mutation was killed on the different replica. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" target="_blank" rel="noopener noreferrer">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" target="_blank" rel="noopener noreferrer">#17499</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed bug when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" target="_blank" rel="noopener noreferrer">#17496</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>ORDER BY</code> with enabled setting <code>optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" target="_blank" rel="noopener noreferrer">#17471</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed duplicates after <code>DISTINCT</code> which were possible because of incorrect optimization. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17294" target="_blank" rel="noopener noreferrer">#17294</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17296" target="_blank" rel="noopener noreferrer">#17296</a> (<a href="https://github.com/chengxianglibra" target="_blank" rel="noopener noreferrer">li chengxiang</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17439" target="_blank" rel="noopener noreferrer">#17439</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed crash while reading from <code>JOIN</code> table with <code>LowCardinality</code> types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17228" target="_blank" rel="noopener noreferrer">#17228</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17397" target="_blank" rel="noopener noreferrer">#17397</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed set index invalidation when there are const columns in the subquery. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17246" target="_blank" rel="noopener noreferrer">#17246</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17249" target="_blank" rel="noopener noreferrer">#17249</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed possible wrong index analysis when the types of the index comparison are different. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17122" target="_blank" rel="noopener noreferrer">#17122</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17145" target="_blank" rel="noopener noreferrer">#17145</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed <code>ColumnConst</code> comparison which leads to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17088" target="_blank" rel="noopener noreferrer">#17088</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17135" target="_blank" rel="noopener noreferrer">#17135</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed bug when <code>ON CLUSTER</code> queries may hang forever for non-leader <code>ReplicatedMergeTreeTables</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17089" target="_blank" rel="noopener noreferrer">#17089</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed fuzzer-found bug in funciton <code>fuzzBits</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16980" target="_blank" rel="noopener noreferrer">#16980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17051" target="_blank" rel="noopener noreferrer">#17051</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Avoid unnecessary network errors for remote queries which may be cancelled while execution, like queries with <code>LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17006" target="_blank" rel="noopener noreferrer">#17006</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed wrong result in big integers (128, 256 bit) when casting from double. <a href="https://github.com/ClickHouse/ClickHouse/pull/16986" target="_blank" rel="noopener noreferrer">#16986</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Reresolve the IP of the <code>format_avro_schema_registry_url</code> in case of errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16985" target="_blank" rel="noopener noreferrer">#16985</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed possible server crash after <code>ALTER TABLE ... MODIFY COLUMN ... NewType</code> when <code>SELECT</code> have <code>WHERE</code> expression on altering column and alter does not finished yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/16968" target="_blank" rel="noopener noreferrer">#16968</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Blame info was not calculated correctly in <code>clickhouse-git-import</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16959" target="_blank" rel="noopener noreferrer">#16959</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed order by optimization with monotonous functions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16107" target="_blank" rel="noopener noreferrer">#16107</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16956" target="_blank" rel="noopener noreferrer">#16956</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed optimization of group by with enabled setting <code>optimize_aggregators_of_group_by_keys</code> and joins. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12604" target="_blank" rel="noopener noreferrer">#12604</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16951" target="_blank" rel="noopener noreferrer">#16951</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Install script should always create subdirs in config folders. This is only relevant for Docker build with custom config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16936" target="_blank" rel="noopener noreferrer">#16936</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed possible error <code>Illegal type of argument</code> for queries with <code>ORDER BY</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16580" target="_blank" rel="noopener noreferrer">#16580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16928" target="_blank" rel="noopener noreferrer">#16928</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Abort multipart upload if no data was written to WriteBufferFromS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/16840" target="_blank" rel="noopener noreferrer">#16840</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fixed crash when using <code>any</code> without any arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16803" target="_blank" rel="noopener noreferrer">#16803</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16826" target="_blank" rel="noopener noreferrer">#16826</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed the behaviour when ClickHouse used to always return 0 insted of a number of affected rows for <code>INSERT</code> queries via MySQL protocol. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16605" target="_blank" rel="noopener noreferrer">#16605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16715" target="_blank" rel="noopener noreferrer">#16715</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed uncontrolled growth of TDigest. <a href="https://github.com/ClickHouse/ClickHouse/pull/16680" target="_blank" rel="noopener noreferrer">#16680</a> (<a href="https://github.com/hrissan" target="_blank" rel="noopener noreferrer">hrissan</a>).</li><li>Fixed remote query failure when using suffix <code>if</code> in Aggregate function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16574" target="_blank" rel="noopener noreferrer">#16574</a> fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16231" target="_blank" rel="noopener noreferrer">#16231</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/16610" target="_blank" rel="noopener noreferrer">#16610</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed inconsistent behavior caused by <code>select_sequential_consistency</code> for optimized trivial count query and system.tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/16309" target="_blank" rel="noopener noreferrer">#16309</a> (<a href="https://github.com/haoch" target="_blank" rel="noopener noreferrer">Hao Chen</a>).</li><li>Throw error when use ColumnTransformer replace non exist column. <a href="https://github.com/ClickHouse/ClickHouse/pull/16183" target="_blank" rel="noopener noreferrer">#16183</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201133-stable-2020-11-13">ClickHouse release v20.11.3.3-stable, 2020-11-13<a class="hash-link" href="#clickhouse-release-v201133-stable-2020-11-13" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-5">Bug Fix<a class="hash-link" href="#bug-fix-5" title="Direct link to heading">​</a></h4><ul><li>Fix rare silent crashes when query profiler is on and ClickHouse is installed on OS with glibc version that has (supposedly) broken asynchronous unwind tables for some functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15301" target="_blank" rel="noopener noreferrer">#15301</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13098" target="_blank" rel="noopener noreferrer">#13098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16846" target="_blank" rel="noopener noreferrer">#16846</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201121-2020-11-11">ClickHouse release v20.11.2.1, 2020-11-11<a class="hash-link" href="#clickhouse-release-v201121-2020-11-11" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-1">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-1" title="Direct link to heading">​</a></h4><ul><li>If some <code>profile</code> was specified in <code>distributed_ddl</code> config section, then this profile could overwrite settings of <code>default</code> profile on server startup. It&#x27;s fixed, now settings of distributed DDL queries should not affect global server settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/16635" target="_blank" rel="noopener noreferrer">#16635</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Restrict to use of non-comparable data types (like <code>AggregateFunction</code>) in keys (Sorting key, Primary key, Partition key, and so on). <a href="https://github.com/ClickHouse/ClickHouse/pull/16601" target="_blank" rel="noopener noreferrer">#16601</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Remove <code>ANALYZE</code> and <code>AST</code> queries, and make the setting <code>enable_debug_queries</code> obsolete since now it is the part of full featured <code>EXPLAIN</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/16536" target="_blank" rel="noopener noreferrer">#16536</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Aggregate functions <code>boundingRatio</code>, <code>rankCorr</code>, <code>retention</code>, <code>timeSeriesGroupSum</code>, <code>timeSeriesGroupRateSum</code>, <code>windowFunnel</code> were erroneously made case-insensitive. Now their names are made case sensitive as designed. Only functions that are specified in SQL standard or made for compatibility with other DBMS or functions similar to those should be case-insensitive. <a href="https://github.com/ClickHouse/ClickHouse/pull/16407" target="_blank" rel="noopener noreferrer">#16407</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make <code>rankCorr</code> function return nan on insufficient data <a href="https://github.com/ClickHouse/ClickHouse/issues/16124" target="_blank" rel="noopener noreferrer">#16124</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16135" target="_blank" rel="noopener noreferrer">#16135</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code>Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-1">New Feature<a class="hash-link" href="#new-feature-1" title="Direct link to heading">​</a></h4><ul><li>Added support of LDAP as a user directory for locally non-existent users. <a href="https://github.com/ClickHouse/ClickHouse/pull/12736" target="_blank" rel="noopener noreferrer">#12736</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>Add <code>system.replicated_fetches</code> table which shows currently running background fetches. <a href="https://github.com/ClickHouse/ClickHouse/pull/16428" target="_blank" rel="noopener noreferrer">#16428</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Added setting <code>date_time_output_format</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15845" target="_blank" rel="noopener noreferrer">#15845</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Added minimal web UI to ClickHouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/16158" target="_blank" rel="noopener noreferrer">#16158</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allows to read/write Single protobuf message at once (w/o length-delimiters). <a href="https://github.com/ClickHouse/ClickHouse/pull/15199" target="_blank" rel="noopener noreferrer">#15199</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Added initial OpenTelemetry support. ClickHouse now accepts OpenTelemetry traceparent headers over Native and HTTP protocols, and passes them downstream in some cases. The trace spans for executed queries are saved into the <code>system.opentelemetry_span_log</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/14195" target="_blank" rel="noopener noreferrer">#14195</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Allow specify primary key in column list of <code>CREATE TABLE</code> query. This is needed for compatibility with other SQL dialects. <a href="https://github.com/ClickHouse/ClickHouse/pull/15823" target="_blank" rel="noopener noreferrer">#15823</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Implement <code>OFFSET offset_row_count {ROW | ROWS} FETCH {FIRST | NEXT} fetch_row_count {ROW | ROWS} {ONLY | WITH TIES}</code> in SELECT query with ORDER BY. This is the SQL-standard way to specify <code>LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15855" target="_blank" rel="noopener noreferrer">#15855</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li><code>errorCodeToName</code> function - return variable name of the error (useful for analyzing query_log and similar). <code>system.errors</code> table - shows how many times errors has been happened (respects <code>system_events_show_zero_values</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/16438" target="_blank" rel="noopener noreferrer">#16438</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added function <code>untuple</code> which is a special function which can introduce new columns to the SELECT list by expanding a named tuple. <a href="https://github.com/ClickHouse/ClickHouse/pull/16242" target="_blank" rel="noopener noreferrer">#16242</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>, <a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Now we can provide identifiers via query parameters. And these parameters can be used as table objects or columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/16594" target="_blank" rel="noopener noreferrer">#16594</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added big integers (UInt256, Int128, Int256) and UUID data types support for MergeTree BloomFilter index. Big integers is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/16642" target="_blank" rel="noopener noreferrer">#16642</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add <code>farmFingerprint64</code> function (non-cryptographic string hashing). <a href="https://github.com/ClickHouse/ClickHouse/pull/16570" target="_blank" rel="noopener noreferrer">#16570</a> (<a href="https://github.com/JacobHayes" target="_blank" rel="noopener noreferrer">Jacob Hayes</a>).</li><li>Add <code>log_queries_min_query_duration_ms</code>, only queries slower than the value of this setting will go to <code>query_log</code>/<code>query_thread_log</code> (i.e. something like <code>slow_query_log</code> in mysql). <a href="https://github.com/ClickHouse/ClickHouse/pull/16529" target="_blank" rel="noopener noreferrer">#16529</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Ability to create a docker image on the top of <code>Alpine</code>. Uses precompiled binary and glibc components from ubuntu 20.04. <a href="https://github.com/ClickHouse/ClickHouse/pull/16479" target="_blank" rel="noopener noreferrer">#16479</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Added <code>toUUIDOrNull</code>, <code>toUUIDOrZero</code> cast functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/16337" target="_blank" rel="noopener noreferrer">#16337</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Add <code>max_concurrent_queries_for_all_users</code> setting, see <a href="https://github.com/ClickHouse/ClickHouse/issues/6636" target="_blank" rel="noopener noreferrer">#6636</a> for use cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/16154" target="_blank" rel="noopener noreferrer">#16154</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Add a new option <code>print_query_id</code> to clickhouse-client. It helps generate arbitrary strings with the current query id generated by the client. Also print query id in clickhouse-client by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/15809" target="_blank" rel="noopener noreferrer">#15809</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add <code>tid</code> and <code>logTrace</code> functions. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9434" target="_blank" rel="noopener noreferrer">#9434</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15803" target="_blank" rel="noopener noreferrer">#15803</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Add function <code>formatReadableTimeDelta</code> that format time delta to human readable string ... <a href="https://github.com/ClickHouse/ClickHouse/pull/15497" target="_blank" rel="noopener noreferrer">#15497</a> (<a href="https://github.com/filipecaixeta" target="_blank" rel="noopener noreferrer">Filipe Caixeta</a>).</li><li>Added <code>disable_merges</code> option for volumes in multi-disk configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/13956" target="_blank" rel="noopener noreferrer">#13956</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-1">Experimental Feature<a class="hash-link" href="#experimental-feature-1" title="Direct link to heading">​</a></h4><ul><li>New functions <code>encrypt</code>, <code>aes_encrypt_mysql</code>, <code>decrypt</code>, <code>aes_decrypt_mysql</code>. These functions are working slowly, so we consider it as an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/11844" target="_blank" rel="noopener noreferrer">#11844</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-6">Bug Fix<a class="hash-link" href="#bug-fix-6" title="Direct link to heading">​</a></h4><ul><li>Mask password in data_path in the <code>system.distribution_queue</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16727" target="_blank" rel="noopener noreferrer">#16727</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>IN</code> operator over several columns and tuples with enabled <code>transform_null_in</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15310" target="_blank" rel="noopener noreferrer">#15310</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16722" target="_blank" rel="noopener noreferrer">#16722</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>The setting <code>max_parallel_replicas</code> worked incorrectly if the queried table has no sampling. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5733" target="_blank" rel="noopener noreferrer">#5733</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16675" target="_blank" rel="noopener noreferrer">#16675</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix optimize_read_in_order/optimize_aggregation_in_order with max_threads &gt; 0 and expression in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/16637" target="_blank" rel="noopener noreferrer">#16637</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Calculation of <code>DEFAULT</code> expressions was involving possible name collisions (that was very unlikely to encounter). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9359" target="_blank" rel="noopener noreferrer">#9359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16612" target="_blank" rel="noopener noreferrer">#16612</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>query_thread_log.query_duration_ms</code> unit. <a href="https://github.com/ClickHouse/ClickHouse/pull/16563" target="_blank" rel="noopener noreferrer">#16563</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix a bug when using MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine. <code>MaterializeMySQL</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/16504" target="_blank" rel="noopener noreferrer">#16504</a> (<a href="https://github.com/TCeason" target="_blank" rel="noopener noreferrer">TCeason</a>).</li><li>Specifically crafted argument of <code>round</code> function with <code>Decimal</code> was leading to integer division by zero. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13338" target="_blank" rel="noopener noreferrer">#13338</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16451" target="_blank" rel="noopener noreferrer">#16451</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix DROP TABLE for Distributed (racy with INSERT). <a href="https://github.com/ClickHouse/ClickHouse/pull/16409" target="_blank" rel="noopener noreferrer">#16409</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix processing of very large entries in replication queue. Very large entries may appear in ALTER queries if table structure is extremely large (near 1 MB). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16307" target="_blank" rel="noopener noreferrer">#16307</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16332" target="_blank" rel="noopener noreferrer">#16332</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the inconsistent behaviour when a part of return data could be dropped because the set for its filtration wasn&#x27;t created. <a href="https://github.com/ClickHouse/ClickHouse/pull/16308" target="_blank" rel="noopener noreferrer">#16308</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix dictGet in sharding_key (and similar places, i.e. when the function context is stored permanently). <a href="https://github.com/ClickHouse/ClickHouse/pull/16205" target="_blank" rel="noopener noreferrer">#16205</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix the exception thrown in <code>clickhouse-local</code> when trying to execute <code>OPTIMIZE</code> command. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16076" target="_blank" rel="noopener noreferrer">#16076</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16192" target="_blank" rel="noopener noreferrer">#16192</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15780" target="_blank" rel="noopener noreferrer">#15780</a> regression, e.g. <code>indexOf([1, 2, 3], toLowCardinality(1))</code> now is prohibited but it should not be. <a href="https://github.com/ClickHouse/ClickHouse/pull/16038" target="_blank" rel="noopener noreferrer">#16038</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Fix bug with MySQL database. When MySQL server used as database engine is down some queries raise Exception, because they try to get tables from disabled server, while it&#x27;s unnecessary. For example, query <code>SELECT ... FROM system.parts</code> should work only with MergeTree tables and don&#x27;t touch MySQL database at all. <a href="https://github.com/ClickHouse/ClickHouse/pull/16032" target="_blank" rel="noopener noreferrer">#16032</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Now exception will be thrown when <code>ALTER MODIFY COLUMN ... DEFAULT ...</code> has incompatible default with column type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15854" target="_blank" rel="noopener noreferrer">#15854</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15858" target="_blank" rel="noopener noreferrer">#15858</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed IPv4CIDRToRange/IPv6CIDRToRange functions to accept const IP-column values. <a href="https://github.com/ClickHouse/ClickHouse/pull/15856" target="_blank" rel="noopener noreferrer">#15856</a> (<a href="https://github.com/vladimir-golovchenko" target="_blank" rel="noopener noreferrer">vladimir-golovchenko</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-2">Improvement<a class="hash-link" href="#improvement-2" title="Direct link to heading">​</a></h4><ul><li>Treat <code>INTERVAL &#x27;1 hour&#x27;</code> as equivalent to <code>INTERVAL 1 HOUR</code>, to be compatible with Postgres and similar. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15637" target="_blank" rel="noopener noreferrer">#15637</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15978" target="_blank" rel="noopener noreferrer">#15978</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Enable parsing enum values by their numeric ids for CSV, TSV and JSON input formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/15685" target="_blank" rel="noopener noreferrer">#15685</a> (<a href="https://github.com/vivarum" target="_blank" rel="noopener noreferrer">vivarum</a>).</li><li>Better read task scheduling for JBOD architecture and <code>MergeTree</code> storage. New setting <code>read_backoff_min_concurrency</code> which serves as the lower limit to the number of reading threads. <a href="https://github.com/ClickHouse/ClickHouse/pull/16423" target="_blank" rel="noopener noreferrer">#16423</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add missing support for <code>LowCardinality</code> in <code>Avro</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/16521" target="_blank" rel="noopener noreferrer">#16521</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Workaround for use <code>S3</code> with nginx server as proxy. Nginx currenty does not accept urls with empty path like <code>http://domain.com?delete</code>, but vanilla aws-sdk-cpp produces this kind of urls. This commit uses patched aws-sdk-cpp version, which makes urls with &quot;/&quot; as path in this cases, like <code>http://domain.com/?delete</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16814" target="_blank" rel="noopener noreferrer">#16814</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Better diagnostics on parse errors in input data. Provide row number on <code>Cannot read all data</code> errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16644" target="_blank" rel="noopener noreferrer">#16644</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make the behaviour of <code>minMap</code> and <code>maxMap</code> more desireable. It will not skip zero values in the result. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16087" target="_blank" rel="noopener noreferrer">#16087</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16631" target="_blank" rel="noopener noreferrer">#16631</a> (<a href="https://github.com/ildus" target="_blank" rel="noopener noreferrer">Ildus Kurbangaliev</a>).</li><li>Better update of ZooKeeper configuration in runtime. <a href="https://github.com/ClickHouse/ClickHouse/pull/16630" target="_blank" rel="noopener noreferrer">#16630</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Apply SETTINGS clause as early as possible. It allows to modify more settings in the query. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3178" target="_blank" rel="noopener noreferrer">#3178</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16619" target="_blank" rel="noopener noreferrer">#16619</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now <code>event_time_microseconds</code> field stores in Decimal64, not UInt64. <a href="https://github.com/ClickHouse/ClickHouse/pull/16617" target="_blank" rel="noopener noreferrer">#16617</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Now paratmeterized functions can be used in <code>APPLY</code> column transformer. <a href="https://github.com/ClickHouse/ClickHouse/pull/16589" target="_blank" rel="noopener noreferrer">#16589</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Improve scheduling of background task which removes data of dropped tables in <code>Atomic</code> databases. <code>Atomic</code> databases do not create broken symlink to table data directory if table actually has no data directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/16584" target="_blank" rel="noopener noreferrer">#16584</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Subqueries in <code>WITH</code> section (CTE) can reference previous subqueries in <code>WITH</code> section by their name. <a href="https://github.com/ClickHouse/ClickHouse/pull/16575" target="_blank" rel="noopener noreferrer">#16575</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add current_database into <code>system.query_thread_log</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16558" target="_blank" rel="noopener noreferrer">#16558</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Allow to fetch parts that are already committed or outdated in the current instance into the detached directory. It&#x27;s useful when migrating tables from another cluster and having N to 1 shards mapping. It&#x27;s also consistent with the current fetchPartition implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/16538" target="_blank" rel="noopener noreferrer">#16538</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Multiple improvements for <code>RabbitMQ</code>: Fixed bug for <a href="https://github.com/ClickHouse/ClickHouse/issues/16263" target="_blank" rel="noopener noreferrer">#16263</a>. Also minimized event loop lifetime. Added more efficient queues setup. <a href="https://github.com/ClickHouse/ClickHouse/pull/16426" target="_blank" rel="noopener noreferrer">#16426</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Fix debug assertion in <code>quantileDeterministic</code> function. In previous version it may also transfer up to two times more data over the network. Although no bug existed. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15683" target="_blank" rel="noopener noreferrer">#15683</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16410" target="_blank" rel="noopener noreferrer">#16410</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add <code>TablesToDropQueueSize</code> metric. It&#x27;s equal to number of dropped tables, that are waiting for background data removal. <a href="https://github.com/ClickHouse/ClickHouse/pull/16364" target="_blank" rel="noopener noreferrer">#16364</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Better diagnostics when client has dropped connection. In previous versions, <code>Attempt to read after EOF</code> and <code>Broken pipe</code> exceptions were logged in server. In new version, it&#x27;s information message <code>Client has dropped the connection, cancel the query.</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16329" target="_blank" rel="noopener noreferrer">#16329</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add total_rows/total_bytes (from system.tables) support for Set/Join table engines. <a href="https://github.com/ClickHouse/ClickHouse/pull/16306" target="_blank" rel="noopener noreferrer">#16306</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Now it&#x27;s possible to specify <code>PRIMARY KEY</code> without <code>ORDER BY</code> for MergeTree table engines family. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15591" target="_blank" rel="noopener noreferrer">#15591</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16284" target="_blank" rel="noopener noreferrer">#16284</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>If there is no tmp folder in the system (chroot, misconfigutation etc) <code>clickhouse-local</code> will create temporary subfolder in the current directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/16280" target="_blank" rel="noopener noreferrer">#16280</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Add support for nested data types (like named tuple) as sub-types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15587" target="_blank" rel="noopener noreferrer">#15587</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16262" target="_blank" rel="noopener noreferrer">#16262</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Support for <code>database_atomic_wait_for_drop_and_detach_synchronously</code>/<code>NO DELAY</code>/<code>SYNC</code> for <code>DROP DATABASE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16127" target="_blank" rel="noopener noreferrer">#16127</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add <code>allow_nondeterministic_optimize_skip_unused_shards</code> (to allow non deterministic like <code>rand()</code> or <code>dictGet()</code> in sharding key). <a href="https://github.com/ClickHouse/ClickHouse/pull/16105" target="_blank" rel="noopener noreferrer">#16105</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>memory_profiler_step</code>/<code>max_untracked_memory</code> for queries via HTTP (test included). Fix the issue that adjusting this value globally in xml config does not help either, since those settings are not applied anyway, only default (4MB) value is <a href="https://github.com/ClickHouse/ClickHouse/blob/17731245336d8c84f75e4c0894c5797ed7732190/src/Common/ThreadStatus.h#L104" target="_blank" rel="noopener noreferrer">used</a>. Fix <code>query_id</code> for the most root ThreadStatus of the http query (by initializing QueryScope after reading query_id). <a href="https://github.com/ClickHouse/ClickHouse/pull/16101" target="_blank" rel="noopener noreferrer">#16101</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Now it&#x27;s allowed to execute <code>ALTER ... ON CLUSTER</code> queries regardless of the <code>&lt;internal_replication&gt;</code> setting in cluster config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16075" target="_blank" rel="noopener noreferrer">#16075</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix rare issue when <code>clickhouse-client</code> may abort on exit due to loading of suggestions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16035" target="_blank" rel="noopener noreferrer">#16035</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16047" target="_blank" rel="noopener noreferrer">#16047</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add support of <code>cache</code> layout for <code>Redis</code> dictionaries with complex key. <a href="https://github.com/ClickHouse/ClickHouse/pull/15985" target="_blank" rel="noopener noreferrer">#15985</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix query hang (endless loop) in case of misconfiguration (<code>connections_with_failover_max_tries</code> set to 0). <a href="https://github.com/ClickHouse/ClickHouse/pull/15876" target="_blank" rel="noopener noreferrer">#15876</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Change level of some log messages from information to debug, so information messages will not appear for every query. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/5293" target="_blank" rel="noopener noreferrer">#5293</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15816" target="_blank" rel="noopener noreferrer">#15816</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove <code>MemoryTrackingInBackground*</code> metrics to avoid potentially misleading results. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15684" target="_blank" rel="noopener noreferrer">#15684</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15813" target="_blank" rel="noopener noreferrer">#15813</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add reconnects to <code>zookeeper-dump-tree</code> tool. <a href="https://github.com/ClickHouse/ClickHouse/pull/15711" target="_blank" rel="noopener noreferrer">#15711</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow explicitly specify columns list in <code>CREATE TABLE table AS table_function(...)</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9249" target="_blank" rel="noopener noreferrer">#9249</a> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14214" target="_blank" rel="noopener noreferrer">#14214</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14295" target="_blank" rel="noopener noreferrer">#14295</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-1">Performance Improvement<a class="hash-link" href="#performance-improvement-1" title="Direct link to heading">​</a></h4><ul><li>Do not merge parts across partitions in SELECT FINAL. <a href="https://github.com/ClickHouse/ClickHouse/pull/15938" target="_blank" rel="noopener noreferrer">#15938</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Improve performance of <code>-OrNull</code> and <code>-OrDefault</code> aggregate functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/16661" target="_blank" rel="noopener noreferrer">#16661</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve performance of <code>quantileMerge</code>. In previous versions it was obnoxiously slow. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/1463" target="_blank" rel="noopener noreferrer">#1463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16643" target="_blank" rel="noopener noreferrer">#16643</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve performance of logical functions a little. <a href="https://github.com/ClickHouse/ClickHouse/pull/16347" target="_blank" rel="noopener noreferrer">#16347</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improved performance of merges assignment in MergeTree table engines. Shouldn&#x27;t be visible for the user. <a href="https://github.com/ClickHouse/ClickHouse/pull/16191" target="_blank" rel="noopener noreferrer">#16191</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Speedup hashed/sparse_hashed dictionary loading by preallocating the hash table. <a href="https://github.com/ClickHouse/ClickHouse/pull/15454" target="_blank" rel="noopener noreferrer">#15454</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Now trivial count optimization becomes slightly non-trivial. Predicates that contain exact partition expr can be optimized too. This also fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11092" target="_blank" rel="noopener noreferrer">#11092</a> which returns wrong count when <code>max_parallel_replicas &gt; 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15074" target="_blank" rel="noopener noreferrer">#15074</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-3">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-3" title="Direct link to heading">​</a></h4><ul><li>Add flaky check for stateless tests. It will detect potentially flaky functional tests in advance, before they are merged. <a href="https://github.com/ClickHouse/ClickHouse/pull/16238" target="_blank" rel="noopener noreferrer">#16238</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Use proper version for <code>croaring</code> instead of amalgamation. <a href="https://github.com/ClickHouse/ClickHouse/pull/16285" target="_blank" rel="noopener noreferrer">#16285</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Improve generation of build files for <code>ya.make</code> build system (Arcadia). <a href="https://github.com/ClickHouse/ClickHouse/pull/16700" target="_blank" rel="noopener noreferrer">#16700</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add MySQL BinLog file check tool for <code>MaterializeMySQL</code> database engine. <code>MaterializeMySQL</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/16223" target="_blank" rel="noopener noreferrer">#16223</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Check for executable bit on non-executable files. People often accidentially commit executable files from Windows. <a href="https://github.com/ClickHouse/ClickHouse/pull/15843" target="_blank" rel="noopener noreferrer">#15843</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Check for <code>#pragma once</code> in headers. <a href="https://github.com/ClickHouse/ClickHouse/pull/15818" target="_blank" rel="noopener noreferrer">#15818</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix illegal code style <code>&amp;vector[idx]</code> in libhdfs3. This fixes libcxx debug build. See also <a href="https://github.com/ClickHouse-Extras/libhdfs3/pull/8" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse-Extras/libhdfs3/pull/8</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/15815" target="_blank" rel="noopener noreferrer">#15815</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix build of one miscellaneous example tool on Mac OS. Note that we don&#x27;t build examples on Mac OS in our CI (we build only ClickHouse binary), so there is zero chance it will not break again. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15804" target="_blank" rel="noopener noreferrer">#15804</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15808" target="_blank" rel="noopener noreferrer">#15808</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Simplify Sys/V init script. <a href="https://github.com/ClickHouse/ClickHouse/pull/14135" target="_blank" rel="noopener noreferrer">#14135</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added <code>boost::program_options</code> to <code>db_generator</code> in order to increase its usability. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15940" target="_blank" rel="noopener noreferrer">#15940</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15973" target="_blank" rel="noopener noreferrer">#15973</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-2010">ClickHouse release 20.10<a class="hash-link" href="#clickhouse-release-2010" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201074-stable-2020-12-24">ClickHouse release v20.10.7.4-stable, 2020-12-24<a class="hash-link" href="#clickhouse-release-v201074-stable-2020-12-24" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-7">Bug Fix<a class="hash-link" href="#bug-fix-7" title="Direct link to heading">​</a></h4><ul><li>Fixed issue when <code>clickhouse-odbc-bridge</code> process is unreachable by server on machines with dual <code>IPv4/IPv6</code> stack and fixed issue when ODBC dictionary updates are performed using malformed queries and/or cause crashes. This possibly closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14489" target="_blank" rel="noopener noreferrer">#14489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18278" target="_blank" rel="noopener noreferrer">#18278</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>Fix key comparison between Enum and Int types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17989" target="_blank" rel="noopener noreferrer">#17989</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18214" target="_blank" rel="noopener noreferrer">#18214</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed unique key convert crash in <code>MaterializeMySQL</code> database engine. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/18186" target="_blank" rel="noopener noreferrer">#18186</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16372" target="_blank" rel="noopener noreferrer">#16372</a>  <a href="https://github.com/ClickHouse/ClickHouse/pull/18211" target="_blank" rel="noopener noreferrer">#18211</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <code>std::out_of_range: basic_string</code> in S3 URL parsing. <a href="https://github.com/ClickHouse/ClickHouse/pull/18059" target="_blank" rel="noopener noreferrer">#18059</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fixed the issue when some tables not synchronized to ClickHouse from MySQL caused by the fact that convertion MySQL prefix index wasn&#x27;t supported for MaterializeMySQL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15187" target="_blank" rel="noopener noreferrer">#15187</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17912" target="_blank" rel="noopener noreferrer">#17912</a>  <a href="https://github.com/ClickHouse/ClickHouse/pull/17944" target="_blank" rel="noopener noreferrer">#17944</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix possible segfault in <code>topK</code> aggregate function. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/17404" target="_blank" rel="noopener noreferrer">#17404</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17845" target="_blank" rel="noopener noreferrer">#17845</a> (<a href="https://github.com/kitaisreal" target="_blank" rel="noopener noreferrer">Maksim Kita</a>).</li><li>Do not restore parts from <code>WAL</code> if <code>in_memory_parts_enable_wal</code> is disabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/17802" target="_blank" rel="noopener noreferrer">#17802</a> (<a href="https://github.com/detailyang" target="_blank" rel="noopener noreferrer">detailyang</a>).</li><li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" target="_blank" rel="noopener noreferrer">#17681</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Fixed empty <code>system.stack_trace</code> table when server is running in daemon mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/17630" target="_blank" rel="noopener noreferrer">#17630</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed the behaviour when <code>clickhouse-client</code> is used in interactive mode with multiline queries and single line comment was erronously extended till the end of query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13654" target="_blank" rel="noopener noreferrer">#13654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17565" target="_blank" rel="noopener noreferrer">#17565</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the issue when server can stop accepting connections in very rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/17542" target="_blank" rel="noopener noreferrer">#17542</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>ALTER</code> query hang when the corresponding mutation was killed on the different replica. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" target="_blank" rel="noopener noreferrer">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" target="_blank" rel="noopener noreferrer">#17499</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed bug when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" target="_blank" rel="noopener noreferrer">#17496</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>ORDER BY</code> with enabled setting <code>optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" target="_blank" rel="noopener noreferrer">#17471</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed duplicates after <code>DISTINCT</code> which were possible because of incorrect optimization. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17294" target="_blank" rel="noopener noreferrer">#17294</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17296" target="_blank" rel="noopener noreferrer">#17296</a> (<a href="https://github.com/chengxianglibra" target="_blank" rel="noopener noreferrer">li chengxiang</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17439" target="_blank" rel="noopener noreferrer">#17439</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed crash while reading from <code>JOIN</code> table with <code>LowCardinality</code> types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17228" target="_blank" rel="noopener noreferrer">#17228</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17397" target="_blank" rel="noopener noreferrer">#17397</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed set index invalidation when there are const columns in the subquery. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17246" target="_blank" rel="noopener noreferrer">#17246</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17249" target="_blank" rel="noopener noreferrer">#17249</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed <code>ColumnConst</code> comparison which leads to crash. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/17088" target="_blank" rel="noopener noreferrer">#17088</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17135" target="_blank" rel="noopener noreferrer">#17135</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed bug when <code>ON CLUSTER</code> queries may hang forever for non-leader <code>ReplicatedMergeTreeTables</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17089" target="_blank" rel="noopener noreferrer">#17089</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed fuzzer-found bug in function <code>fuzzBits</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16980" target="_blank" rel="noopener noreferrer">#16980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17051" target="_blank" rel="noopener noreferrer">#17051</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Avoid unnecessary network errors for remote queries which may be cancelled while execution, like queries with <code>LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17006" target="_blank" rel="noopener noreferrer">#17006</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed wrong result in big integers (128, 256 bit) when casting from double. <a href="https://github.com/ClickHouse/ClickHouse/pull/16986" target="_blank" rel="noopener noreferrer">#16986</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Reresolve the IP of the <code>format_avro_schema_registry_url</code> in case of errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16985" target="_blank" rel="noopener noreferrer">#16985</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed possible server crash after <code>ALTER TABLE ... MODIFY COLUMN ... NewType</code> when <code>SELECT</code> have <code>WHERE</code> expression on altering column and alter does not finished yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/16968" target="_blank" rel="noopener noreferrer">#16968</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Blame info was not calculated correctly in <code>clickhouse-git-import</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16959" target="_blank" rel="noopener noreferrer">#16959</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed order by optimization with monotonous functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16107" target="_blank" rel="noopener noreferrer">#16107</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16956" target="_blank" rel="noopener noreferrer">#16956</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixrf optimization of group by with enabled setting <code>optimize_aggregators_of_group_by_keys</code> and joins. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12604" target="_blank" rel="noopener noreferrer">#12604</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16951" target="_blank" rel="noopener noreferrer">#16951</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Install script should always create subdirs in config folders. This is only relevant for Docker build with custom config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16936" target="_blank" rel="noopener noreferrer">#16936</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixrf possible error <code>Illegal type of argument</code> for queries with <code>ORDER BY</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16580" target="_blank" rel="noopener noreferrer">#16580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16928" target="_blank" rel="noopener noreferrer">#16928</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Abort multipart upload if no data was written to <code>WriteBufferFromS3</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16840" target="_blank" rel="noopener noreferrer">#16840</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fixed crash when using <code>any</code> without any arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16803" target="_blank" rel="noopener noreferrer">#16803</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16826" target="_blank" rel="noopener noreferrer">#16826</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed the behaviour when ClickHouse used to always return 0 insted of a number of affected rows for <code>INSERT</code> queries via MySQL protocol. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16605" target="_blank" rel="noopener noreferrer">#16605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16715" target="_blank" rel="noopener noreferrer">#16715</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed uncontrolled growth of <code>TDigest</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16680" target="_blank" rel="noopener noreferrer">#16680</a> (<a href="https://github.com/hrissan" target="_blank" rel="noopener noreferrer">hrissan</a>).</li><li>Fixed remote query failure when using suffix <code>if</code> in Aggregate function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16574" target="_blank" rel="noopener noreferrer">#16574</a> fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16231" target="_blank" rel="noopener noreferrer">#16231</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/16610" target="_blank" rel="noopener noreferrer">#16610</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201041-stable-2020-11-13">ClickHouse release v20.10.4.1-stable, 2020-11-13<a class="hash-link" href="#clickhouse-release-v201041-stable-2020-11-13" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-8">Bug Fix<a class="hash-link" href="#bug-fix-8" title="Direct link to heading">​</a></h4><ul><li>Fix rare silent crashes when query profiler is on and ClickHouse is installed on OS with glibc version that has (supposedly) broken asynchronous unwind tables for some functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15301" target="_blank" rel="noopener noreferrer">#15301</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13098" target="_blank" rel="noopener noreferrer">#13098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16846" target="_blank" rel="noopener noreferrer">#16846</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>IN</code> operator over several columns and tuples with enabled <code>transform_null_in</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15310" target="_blank" rel="noopener noreferrer">#15310</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16722" target="_blank" rel="noopener noreferrer">#16722</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>This will fix optimize_read_in_order/optimize_aggregation_in_order with max_threads&gt;0 and expression in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/16637" target="_blank" rel="noopener noreferrer">#16637</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Now when parsing AVRO from input the LowCardinality is removed from type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16188" target="_blank" rel="noopener noreferrer">#16188</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16521" target="_blank" rel="noopener noreferrer">#16521</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Fix rapid growth of metadata when using MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine, and <code>slave_parallel_worker</code> enabled on MySQL Slave, by properly shrinking GTID sets. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15951" target="_blank" rel="noopener noreferrer">#15951</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16504" target="_blank" rel="noopener noreferrer">#16504</a> (<a href="https://github.com/TCeason" target="_blank" rel="noopener noreferrer">TCeason</a>).</li><li>Fix DROP TABLE for Distributed (racy with INSERT). <a href="https://github.com/ClickHouse/ClickHouse/pull/16409" target="_blank" rel="noopener noreferrer">#16409</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix processing of very large entries in replication queue. Very large entries may appear in ALTER queries if table structure is extremely large (near 1 MB). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16307" target="_blank" rel="noopener noreferrer">#16307</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16332" target="_blank" rel="noopener noreferrer">#16332</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bug with MySQL database. When MySQL server used as database engine is down some queries raise Exception, because they try to get tables from disabled server, while it&#x27;s unnecessary. For example, query <code>SELECT ... FROM system.parts</code> should work only with MergeTree tables and don&#x27;t touch MySQL database at all. <a href="https://github.com/ClickHouse/ClickHouse/pull/16032" target="_blank" rel="noopener noreferrer">#16032</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-3">Improvement<a class="hash-link" href="#improvement-3" title="Direct link to heading">​</a></h4><ul><li>Workaround for use S3 with nginx server as proxy. Nginx currenty does not accept urls with empty path like <a href="http://domain.com?delete" target="_blank" rel="noopener noreferrer">http://domain.com?delete</a>, but vanilla aws-sdk-cpp produces this kind of urls. This commit uses patched aws-sdk-cpp version, which makes urls with &quot;/&quot; as path in this cases, like <a href="http://domain.com/?delete" target="_blank" rel="noopener noreferrer">http://domain.com/?delete</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16813" target="_blank" rel="noopener noreferrer">#16813</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2010330-2020-10-28">ClickHouse release v20.10.3.30, 2020-10-28<a class="hash-link" href="#clickhouse-release-v2010330-2020-10-28" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-2">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-2" title="Direct link to heading">​</a></h4><ul><li>Make <code>multiple_joins_rewriter_version</code> obsolete. Remove first version of joins rewriter. <a href="https://github.com/ClickHouse/ClickHouse/pull/15472" target="_blank" rel="noopener noreferrer">#15472</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Change default value of <code>format_regexp_escaping_rule</code> setting (it&#x27;s related to <code>Regexp</code> format) to <code>Raw</code> (it means - read whole subpattern as a value) to make the behaviour more like to what users expect. <a href="https://github.com/ClickHouse/ClickHouse/pull/15426" target="_blank" rel="noopener noreferrer">#15426</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add support for nested multiline comments <code>/* comment /* comment */ */</code> in SQL. This conforms to the SQL standard. <a href="https://github.com/ClickHouse/ClickHouse/pull/14655" target="_blank" rel="noopener noreferrer">#14655</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added MergeTree settings (<code>max_replicated_merges_with_ttl_in_queue</code> and <code>max_number_of_merges_with_ttl_in_pool</code>) to control the number of merges with TTL in the background pool and replicated queue. This change breaks compatibility with older versions only if you use delete TTL. Otherwise, replication will stay compatible. You can avoid incompatibility issues if you update all shard replicas at once or execute <code>SYSTEM STOP TTL MERGES</code> until you finish the update of all replicas. If you&#x27;ll get an incompatible entry in the replication queue, first of all, execute <code>SYSTEM STOP TTL MERGES</code> and after <code>ALTER TABLE ... DETACH PARTITION ...</code> the partition where incompatible TTL merge was assigned. Attach it back on a single replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/14490" target="_blank" rel="noopener noreferrer">#14490</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code>Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-2">New Feature<a class="hash-link" href="#new-feature-2" title="Direct link to heading">​</a></h4><ul><li>Background data recompression. Add the ability to specify <code>TTL ... RECOMPRESS codec_name</code> for MergeTree table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/14494" target="_blank" rel="noopener noreferrer">#14494</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add parallel quorum inserts. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15601" target="_blank" rel="noopener noreferrer">#15601</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15601" target="_blank" rel="noopener noreferrer">#15601</a> (<a href="https://github.com/alexelex" target="_blank" rel="noopener noreferrer">Latysheva Alexandra</a>).</li><li>Settings for additional enforcement of data durability. Useful for non-replicated setups. <a href="https://github.com/ClickHouse/ClickHouse/pull/11948" target="_blank" rel="noopener noreferrer">#11948</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>When duplicate block is written to replica where it does not exist locally (has not been fetched from replicas), don&#x27;t ignore it and write locally to achieve the same effect as if it was successfully replicated. <a href="https://github.com/ClickHouse/ClickHouse/pull/11684" target="_blank" rel="noopener noreferrer">#11684</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now we support <code>WITH &lt;identifier&gt; AS (subquery) ... </code> to introduce named subqueries in the query context. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/2416" target="_blank" rel="noopener noreferrer">#2416</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/4967" target="_blank" rel="noopener noreferrer">#4967</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14771" target="_blank" rel="noopener noreferrer">#14771</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Introduce <code>enable_global_with_statement</code> setting which propagates the first select&#x27;s <code>WITH</code> statements to other select queries at the same level, and makes aliases in <code>WITH</code> statements visible to subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/15451" target="_blank" rel="noopener noreferrer">#15451</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Secure inter-cluster query execution (with initial_user as current query user). <a href="https://github.com/ClickHouse/ClickHouse/pull/13156" target="_blank" rel="noopener noreferrer">#13156</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/15551" target="_blank" rel="noopener noreferrer">#15551</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add the ability to remove column properties and table TTLs. Introduced queries <code>ALTER TABLE MODIFY COLUMN col_name REMOVE what_to_remove</code> and <code>ALTER TABLE REMOVE TTL</code>. Both operations are lightweight and executed at the metadata level. <a href="https://github.com/ClickHouse/ClickHouse/pull/14742" target="_blank" rel="noopener noreferrer">#14742</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Added format <code>RawBLOB</code>. It is intended for input or output a single value without any escaping and delimiters. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15349" target="_blank" rel="noopener noreferrer">#15349</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15364" target="_blank" rel="noopener noreferrer">#15364</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add the <code>reinterpretAsUUID</code> function that allows to convert a big-endian byte string to UUID. <a href="https://github.com/ClickHouse/ClickHouse/pull/15480" target="_blank" rel="noopener noreferrer">#15480</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Implement <code>force_data_skipping_indices</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/15642" target="_blank" rel="noopener noreferrer">#15642</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add a setting <code>output_format_pretty_row_numbers</code> to numerate the result in Pretty formats. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15350" target="_blank" rel="noopener noreferrer">#15350</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15443" target="_blank" rel="noopener noreferrer">#15443</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Added query obfuscation tool. It allows to share more queries for better testing. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15268" target="_blank" rel="noopener noreferrer">#15268</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15321" target="_blank" rel="noopener noreferrer">#15321</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add table function <code>null(&#x27;structure&#x27;)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14797" target="_blank" rel="noopener noreferrer">#14797</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Added <code>formatReadableQuantity</code> function. It is useful for reading big numbers by human. <a href="https://github.com/ClickHouse/ClickHouse/pull/14725" target="_blank" rel="noopener noreferrer">#14725</a> (<a href="https://github.com/BooBSD" target="_blank" rel="noopener noreferrer">Artem Hnilov</a>).</li><li>Add format <code>LineAsString</code> that accepts a sequence of lines separated by newlines, every line is parsed as a whole as a single String field. <a href="https://github.com/ClickHouse/ClickHouse/pull/14703" target="_blank" rel="noopener noreferrer">#14703</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>), <a href="https://github.com/ClickHouse/ClickHouse/pull/13846" target="_blank" rel="noopener noreferrer">#13846</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Add <code>JSONStrings</code> format which output data in arrays of strings. <a href="https://github.com/ClickHouse/ClickHouse/pull/14333" target="_blank" rel="noopener noreferrer">#14333</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Add support for &quot;Raw&quot; column format for <code>Regexp</code> format. It allows to simply extract subpatterns as a whole without any escaping rules. <a href="https://github.com/ClickHouse/ClickHouse/pull/15363" target="_blank" rel="noopener noreferrer">#15363</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow configurable <code>NULL</code> representation for <code>TSV</code> output format. It is controlled by the setting <code>output_format_tsv_null_representation</code> which is <code>\N</code> by default. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9375" target="_blank" rel="noopener noreferrer">#9375</a>. Note that the setting only controls output format and <code>\N</code> is the only supported <code>NULL</code> representation for <code>TSV</code> input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/14586" target="_blank" rel="noopener noreferrer">#14586</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Support Decimal data type for <code>MaterializeMySQL</code>. <code>MaterializeMySQL</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/14535" target="_blank" rel="noopener noreferrer">#14535</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Add new feature: <code>SHOW DATABASES LIKE &#x27;xxx&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14521" target="_blank" rel="noopener noreferrer">#14521</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Added a script to import (arbitrary) git repository to ClickHouse as a sample dataset. <a href="https://github.com/ClickHouse/ClickHouse/pull/14471" target="_blank" rel="noopener noreferrer">#14471</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now insert statements can have asterisk (or variants) with column transformers in the column list. <a href="https://github.com/ClickHouse/ClickHouse/pull/14453" target="_blank" rel="noopener noreferrer">#14453</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>New query complexity limit settings <code>max_rows_to_read_leaf</code>, <code>max_bytes_to_read_leaf</code> for distributed queries to limit max rows/bytes read on the leaf nodes. Limit is applied for local reads only, <em>excluding</em> the final merge stage on the root node. <a href="https://github.com/ClickHouse/ClickHouse/pull/14221" target="_blank" rel="noopener noreferrer">#14221</a> (<a href="https://github.com/hagen1778" target="_blank" rel="noopener noreferrer">Roman Khavronenko</a>).</li><li>Allow user to specify settings for <code>ReplicatedMergeTree*</code> storage in <code>&lt;replicated_merge_tree&gt;</code> section of config file. It works similarly to <code>&lt;merge_tree&gt;</code> section. For <code>ReplicatedMergeTree*</code> storages settings from <code>&lt;merge_tree&gt;</code> and <code>&lt;replicated_merge_tree&gt;</code> are applied together, but settings from <code>&lt;replicated_merge_tree&gt;</code> has higher priority. Added <code>system.replicated_merge_tree_settings</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/13573" target="_blank" rel="noopener noreferrer">#13573</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add <code>mapPopulateSeries</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/13166" target="_blank" rel="noopener noreferrer">#13166</a> (<a href="https://github.com/ildus" target="_blank" rel="noopener noreferrer">Ildus Kurbangaliev</a>).</li><li>Supporting MySQL types: <code>decimal</code> (as ClickHouse <code>Decimal</code>) and <code>datetime</code> with sub-second precision (as <code>DateTime64</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11512" target="_blank" rel="noopener noreferrer">#11512</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Introduce <code>event_time_microseconds</code> field to <code>system.text_log</code>, <code>system.trace_log</code>, <code>system.query_log</code> and <code>system.query_thread_log</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/14760" target="_blank" rel="noopener noreferrer">#14760</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add <code>event_time_microseconds</code> to <code>system.asynchronous_metric_log</code> &amp; <code>system.metric_log</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/14514" target="_blank" rel="noopener noreferrer">#14514</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add <code>query_start_time_microseconds</code> field to <code>system.query_log</code> &amp; <code>system.query_thread_log</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/14252" target="_blank" rel="noopener noreferrer">#14252</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-9">Bug Fix<a class="hash-link" href="#bug-fix-9" title="Direct link to heading">​</a></h4><ul><li>Fix the case when memory can be overallocated regardless to the limit. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14560" target="_blank" rel="noopener noreferrer">#14560</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16206" target="_blank" rel="noopener noreferrer">#16206</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>executable</code> dictionary source hang. In previous versions, when using some formats (e.g. <code>JSONEachRow</code>) data was not feed to a child process before it outputs at least something. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/1697" target="_blank" rel="noopener noreferrer">#1697</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/2455" target="_blank" rel="noopener noreferrer">#2455</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14525" target="_blank" rel="noopener noreferrer">#14525</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix double free in case of exception in function <code>dictGet</code>. It could have happened if dictionary was loaded with error. <a href="https://github.com/ClickHouse/ClickHouse/pull/16429" target="_blank" rel="noopener noreferrer">#16429</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix group by with totals/rollup/cube modifers and min/max functions over group by keys. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16393" target="_blank" rel="noopener noreferrer">#16393</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16397" target="_blank" rel="noopener noreferrer">#16397</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix async Distributed INSERT with prefer_localhost_replica=0 and internal_replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/16358" target="_blank" rel="noopener noreferrer">#16358</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix a very wrong code in TwoLevelStringHashTable implementation, which might lead to memory leak. <a href="https://github.com/ClickHouse/ClickHouse/pull/16264" target="_blank" rel="noopener noreferrer">#16264</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix segfault in some cases of wrong aggregation in lambdas. <a href="https://github.com/ClickHouse/ClickHouse/pull/16082" target="_blank" rel="noopener noreferrer">#16082</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix <code>ALTER MODIFY ... ORDER BY</code> query hang for <code>ReplicatedVersionedCollapsingMergeTree</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15980" target="_blank" rel="noopener noreferrer">#15980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16011" target="_blank" rel="noopener noreferrer">#16011</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li><code>MaterializeMySQL</code> (experimental feature): Fix collate name &amp; charset name parser and support <code>length = 0</code> for string type. <a href="https://github.com/ClickHouse/ClickHouse/pull/16008" target="_blank" rel="noopener noreferrer">#16008</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Allow to use <code>direct</code> layout for dictionaries with complex keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/16007" target="_blank" rel="noopener noreferrer">#16007</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Prevent replica hang for 5-10 mins when replication error happens after a period of inactivity. <a href="https://github.com/ClickHouse/ClickHouse/pull/15987" target="_blank" rel="noopener noreferrer">#15987</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix rare segfaults when inserting into or selecting from MaterializedView and concurrently dropping target table (for Atomic database engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/15984" target="_blank" rel="noopener noreferrer">#15984</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix ambiguity in parsing of settings profiles: <code>CREATE USER ... SETTINGS profile readonly</code> is now considered as using a profile named <code>readonly</code>, not a setting named <code>profile</code> with the readonly constraint. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15628" target="_blank" rel="noopener noreferrer">#15628</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15982" target="_blank" rel="noopener noreferrer">#15982</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li><code>MaterializeMySQL</code> (experimental feature): Fix crash on create database failure. <a href="https://github.com/ClickHouse/ClickHouse/pull/15954" target="_blank" rel="noopener noreferrer">#15954</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <code>DROP TABLE IF EXISTS</code> failure with <code>Table ... does not exist</code> error when table is concurrently renamed (for Atomic database engine). Fixed rare deadlock when concurrently executing some DDL queries with multiple tables (like <code>DROP DATABASE</code> and <code>RENAME TABLE</code>) - Fixed <code>DROP/DETACH DATABASE</code> failure with <code>Table ... does not exist</code> when concurrently executing <code>DROP/DETACH TABLE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15934" target="_blank" rel="noopener noreferrer">#15934</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix incorrect empty result for query from <code>Distributed</code> table if query has <code>WHERE</code>, <code>PREWHERE</code> and <code>GLOBAL IN</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15792" target="_blank" rel="noopener noreferrer">#15792</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15933" target="_blank" rel="noopener noreferrer">#15933</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12513" target="_blank" rel="noopener noreferrer">#12513</a>: difference expressions with same alias when query is reanalyzed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15886" target="_blank" rel="noopener noreferrer">#15886</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix possible very rare deadlocks in RBAC implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/15875" target="_blank" rel="noopener noreferrer">#15875</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix exception <code>Block structure mismatch</code> in <code>SELECT ... ORDER BY DESC</code> queries which were executed after <code>ALTER MODIFY COLUMN</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15800" target="_blank" rel="noopener noreferrer">#15800</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15852" target="_blank" rel="noopener noreferrer">#15852</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li><code>MaterializeMySQL</code> (experimental feature): Fix <code>select count()</code> inaccuracy. <a href="https://github.com/ClickHouse/ClickHouse/pull/15767" target="_blank" rel="noopener noreferrer">#15767</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix some cases of queries, in which only virtual columns are selected. Previously <code>Not found column _nothing in block</code> exception may be thrown. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12298" target="_blank" rel="noopener noreferrer">#12298</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15756" target="_blank" rel="noopener noreferrer">#15756</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix drop of materialized view with inner table in Atomic database (hangs all subsequent DROP TABLE due to hang of the worker thread, due to recursive DROP TABLE for inner table of MV). <a href="https://github.com/ClickHouse/ClickHouse/pull/15743" target="_blank" rel="noopener noreferrer">#15743</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Possibility to move part to another disk/volume if the first attempt was failed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15723" target="_blank" rel="noopener noreferrer">#15723</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fix error <code>Cannot find column</code> which may happen at insertion into <code>MATERIALIZED VIEW</code> in case if query for <code>MV</code> containes <code>ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15717" target="_blank" rel="noopener noreferrer">#15717</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed too low default value of <code>max_replicated_logs_to_keep</code> setting, which might cause replicas to become lost too often. Improve lost replica recovery process by choosing the most up-to-date replica to clone. Also do not remove old parts from lost replica, detach them instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/15701" target="_blank" rel="noopener noreferrer">#15701</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix rare race condition in dictionaries and tables from MySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/15686" target="_blank" rel="noopener noreferrer">#15686</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix (benign) race condition in AMQP-CPP. <a href="https://github.com/ClickHouse/ClickHouse/pull/15667" target="_blank" rel="noopener noreferrer">#15667</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix error <code>Cannot add simple transform to empty Pipe</code> which happened while reading from <code>Buffer</code> table which has different structure than destination table. It was possible if destination table returned empty result for query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15529" target="_blank" rel="noopener noreferrer">#15529</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15662" target="_blank" rel="noopener noreferrer">#15662</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Proper error handling during insert into MergeTree with S3. MergeTree over S3 is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/15657" target="_blank" rel="noopener noreferrer">#15657</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fixed bug with S3 table function: region from URL was not applied to S3 client configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/15646" target="_blank" rel="noopener noreferrer">#15646</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fix the order of destruction for resources in <code>ReadFromStorage</code> step of query plan. It might cause crashes in rare cases. Possibly connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/15610" target="_blank" rel="noopener noreferrer">#15610</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15645" target="_blank" rel="noopener noreferrer">#15645</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Subtract <code>ReadonlyReplica</code> metric when detach readonly tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/15592" target="_blank" rel="noopener noreferrer">#15592</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Fixed <code>Element ... is not a constant expression</code> error when using <code>JSON*</code> function result in <code>VALUES</code>, <code>LIMIT</code> or right side of <code>IN</code> operator. <a href="https://github.com/ClickHouse/ClickHouse/pull/15589" target="_blank" rel="noopener noreferrer">#15589</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Query will finish faster in case of exception. Cancel execution on remote replicas if exception happens. <a href="https://github.com/ClickHouse/ClickHouse/pull/15578" target="_blank" rel="noopener noreferrer">#15578</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Prevent the possibility of error message <code>Could not calculate available disk space (statvfs), errno: 4, strerror: Interrupted system call</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15541" target="_blank" rel="noopener noreferrer">#15541</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15557" target="_blank" rel="noopener noreferrer">#15557</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>Database &lt;db&gt; does not exist.</code> in queries with IN and Distributed table when there&#x27;s no database on initiator. <a href="https://github.com/ClickHouse/ClickHouse/pull/15538" target="_blank" rel="noopener noreferrer">#15538</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Mutation might hang waiting for some non-existent part after <code>MOVE</code> or <code>REPLACE PARTITION</code> or, in rare cases, after <code>DETACH</code> or <code>DROP PARTITION</code>. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" target="_blank" rel="noopener noreferrer">#15537</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix bug when <code>ILIKE</code> operator stops being case insensitive if <code>LIKE</code> with the same pattern was executed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15536" target="_blank" rel="noopener noreferrer">#15536</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix <code>Missing columns</code> errors when selecting columns which absent in data, but depend on other columns which also absent in data. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15530" target="_blank" rel="noopener noreferrer">#15530</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15532" target="_blank" rel="noopener noreferrer">#15532</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Throw an error when a single parameter is passed to ReplicatedMergeTree instead of ignoring it. <a href="https://github.com/ClickHouse/ClickHouse/pull/15516" target="_blank" rel="noopener noreferrer">#15516</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Fix bug with event subscription in DDLWorker which rarely may lead to query hangs in <code>ON CLUSTER</code>. Introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/13450" target="_blank" rel="noopener noreferrer">#13450</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15477" target="_blank" rel="noopener noreferrer">#15477</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Report proper error when the second argument of <code>boundingRatio</code> aggregate function has a wrong type. <a href="https://github.com/ClickHouse/ClickHouse/pull/15407" target="_blank" rel="noopener noreferrer">#15407</a> (<a href="https://github.com/detailyang" target="_blank" rel="noopener noreferrer">detailyang</a>).</li><li>Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15365" target="_blank" rel="noopener noreferrer">#15365</a>: attach a database with MySQL engine throws exception (no query context). <a href="https://github.com/ClickHouse/ClickHouse/pull/15384" target="_blank" rel="noopener noreferrer">#15384</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix the case of multiple occurrences of column transformers in a select query. <a href="https://github.com/ClickHouse/ClickHouse/pull/15378" target="_blank" rel="noopener noreferrer">#15378</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed compression in <code>S3</code> storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/15376" target="_blank" rel="noopener noreferrer">#15376</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fix bug where queries like <code>SELECT toStartOfDay(today())</code> fail complaining about empty time_zone argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/15319" target="_blank" rel="noopener noreferrer">#15319</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix race condition during MergeTree table rename and background cleanup. <a href="https://github.com/ClickHouse/ClickHouse/pull/15304" target="_blank" rel="noopener noreferrer">#15304</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix rare race condition on server startup when system logs are enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/15300" target="_blank" rel="noopener noreferrer">#15300</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix hang of queries with a lot of subqueries to same table of <code>MySQL</code> engine. Previously, if there were more than 16 subqueries to same <code>MySQL</code> table in query, it hang forever. <a href="https://github.com/ClickHouse/ClickHouse/pull/15299" target="_blank" rel="noopener noreferrer">#15299</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix MSan report in QueryLog. Uninitialized memory can be used for the field <code>memory_usage</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15258" target="_blank" rel="noopener noreferrer">#15258</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix &#x27;Unknown identifier&#x27; in GROUP BY when query has JOIN over Merge table. <a href="https://github.com/ClickHouse/ClickHouse/pull/15242" target="_blank" rel="noopener noreferrer">#15242</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix instance crash when using <code>joinGet</code> with <code>LowCardinality</code> types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15214" target="_blank" rel="noopener noreferrer">#15214</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15220" target="_blank" rel="noopener noreferrer">#15220</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix bug in table engine <code>Buffer</code> which does not allow to insert data of new structure into <code>Buffer</code> after <code>ALTER</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15117" target="_blank" rel="noopener noreferrer">#15117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15192" target="_blank" rel="noopener noreferrer">#15192</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Adjust Decimal field size in MySQL column definition packet. <a href="https://github.com/ClickHouse/ClickHouse/pull/15152" target="_blank" rel="noopener noreferrer">#15152</a> (<a href="https://github.com/maqroll" target="_blank" rel="noopener noreferrer">maqroll</a>).</li><li>Fixes <code>Data compressed with different methods</code> in <code>join_algorithm=&#x27;auto&#x27;</code>. Keep LowCardinality as type for left table join key in <code>join_algorithm=&#x27;partial_merge&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15088" target="_blank" rel="noopener noreferrer">#15088</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Update <code>jemalloc</code> to fix <code>percpu_arena</code> with affinity mask. <a href="https://github.com/ClickHouse/ClickHouse/pull/15035" target="_blank" rel="noopener noreferrer">#15035</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/14957" target="_blank" rel="noopener noreferrer">#14957</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>We already use padded comparison between String and FixedString (<a href="https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333</a>). This PR applies the same logic to field comparison which corrects the usage of FixedString as primary keys. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14908" target="_blank" rel="noopener noreferrer">#14908</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15033" target="_blank" rel="noopener noreferrer">#15033</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>If function <code>bar</code> was called with specifically crafted arguments, buffer overflow was possible. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13926" target="_blank" rel="noopener noreferrer">#13926</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15028" target="_blank" rel="noopener noreferrer">#15028</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>Cannot rename ... errno: 22, strerror: Invalid argument</code> error on DDL query execution in Atomic database when running clickhouse-server in Docker on Mac OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/15024" target="_blank" rel="noopener noreferrer">#15024</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix crash in RIGHT or FULL JOIN with join_algorith=&#x27;auto&#x27; when memory limit exceeded and we should change HashJoin with MergeJoin. <a href="https://github.com/ClickHouse/ClickHouse/pull/15002" target="_blank" rel="noopener noreferrer">#15002</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Now settings <code>number_of_free_entries_in_pool_to_execute_mutation</code> and <code>number_of_free_entries_in_pool_to_lower_max_size_of_merge</code> can be equal to <code>background_pool_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14975" target="_blank" rel="noopener noreferrer">#14975</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix to make predicate push down work when subquery contains <code>finalizeAggregation</code> function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14847" target="_blank" rel="noopener noreferrer">#14847</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14937" target="_blank" rel="noopener noreferrer">#14937</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Publish CPU frequencies per logical core in <code>system.asynchronous_metrics</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14923" target="_blank" rel="noopener noreferrer">#14923</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14924" target="_blank" rel="noopener noreferrer">#14924</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li><code>MaterializeMySQL</code> (experimental feature): Fixed <code>.metadata.tmp File exists</code> error. <a href="https://github.com/ClickHouse/ClickHouse/pull/14898" target="_blank" rel="noopener noreferrer">#14898</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix the issue when some invocations of <code>extractAllGroups</code> function may trigger &quot;Memory limit exceeded&quot; error. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13383" target="_blank" rel="noopener noreferrer">#13383</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14889" target="_blank" rel="noopener noreferrer">#14889</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix SIGSEGV for an attempt to INSERT into StorageFile with file descriptor. <a href="https://github.com/ClickHouse/ClickHouse/pull/14887" target="_blank" rel="noopener noreferrer">#14887</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed segfault in <code>cache</code> dictionary <a href="https://github.com/ClickHouse/ClickHouse/issues/14837" target="_blank" rel="noopener noreferrer">#14837</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14879" target="_blank" rel="noopener noreferrer">#14879</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li><code>MaterializeMySQL</code> (experimental feature): Fixed bug in parsing MySQL binlog events, which causes <code>Attempt to read after eof</code> and <code>Packet payload is not fully read</code> in <code>MaterializeMySQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14852" target="_blank" rel="noopener noreferrer">#14852</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix rare error in <code>SELECT</code> queries when the queried column has <code>DEFAULT</code> expression which depends on the other column which also has <code>DEFAULT</code> and not present in select query and not exists on disk. Partially fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14531" target="_blank" rel="noopener noreferrer">#14531</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14845" target="_blank" rel="noopener noreferrer">#14845</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix a problem where the server may get stuck on startup while talking to ZooKeeper, if the configuration files have to be fetched from ZK (using the <code>from_zk</code> include option). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14814" target="_blank" rel="noopener noreferrer">#14814</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14843" target="_blank" rel="noopener noreferrer">#14843</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fix wrong monotonicity detection for shrunk <code>Int -&gt; Int</code> cast of signed types. It might lead to incorrect query result. This bug is unveiled in <a href="https://github.com/ClickHouse/ClickHouse/issues/14513" target="_blank" rel="noopener noreferrer">#14513</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14783" target="_blank" rel="noopener noreferrer">#14783</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li><code>Replace</code> column transformer should replace identifiers with cloned ASTs. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14695" target="_blank" rel="noopener noreferrer">#14695</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/14734" target="_blank" rel="noopener noreferrer">#14734</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed missed default database name in metadata of materialized view when executing <code>ALTER ... MODIFY QUERY</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14664" target="_blank" rel="noopener noreferrer">#14664</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix bug when <code>ALTER UPDATE</code> mutation with <code>Nullable</code> column in assignment expression and constant value (like <code>UPDATE x = 42</code>) leads to incorrect value in column or segfault. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13634" target="_blank" rel="noopener noreferrer">#13634</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/14045" target="_blank" rel="noopener noreferrer">#14045</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14646" target="_blank" rel="noopener noreferrer">#14646</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix wrong Decimal multiplication result caused wrong decimal scale of result column. <a href="https://github.com/ClickHouse/ClickHouse/pull/14603" target="_blank" rel="noopener noreferrer">#14603</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix function <code>has</code> with <code>LowCardinality</code> of <code>Nullable</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14591" target="_blank" rel="noopener noreferrer">#14591</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Cleanup data directory after Zookeeper exceptions during CreateQuery for StorageReplicatedMergeTree Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14563" target="_blank" rel="noopener noreferrer">#14563</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix rare segfaults in functions with combinator <code>-Resample</code>, which could appear in result of overflow with very large parameters. <a href="https://github.com/ClickHouse/ClickHouse/pull/14562" target="_blank" rel="noopener noreferrer">#14562</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix a bug when converting <code>Nullable(String)</code> to Enum. Introduced by <a href="https://github.com/ClickHouse/ClickHouse/pull/12745" target="_blank" rel="noopener noreferrer">#12745</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14435" target="_blank" rel="noopener noreferrer">#14435</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14530" target="_blank" rel="noopener noreferrer">#14530</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed the incorrect sorting order of <code>Nullable</code> column. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14344" target="_blank" rel="noopener noreferrer">#14344</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14495" target="_blank" rel="noopener noreferrer">#14495</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix <code>currentDatabase()</code> function cannot be used in <code>ON CLUSTER</code> ddl query. <a href="https://github.com/ClickHouse/ClickHouse/pull/14211" target="_blank" rel="noopener noreferrer">#14211</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li><code>MaterializeMySQL</code> (experimental feature): Fixed <code>Packet payload is not fully read</code> error in <code>MaterializeMySQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14696" target="_blank" rel="noopener noreferrer">#14696</a> (<a href="https://github.com/BohuTANG" target="_blank" rel="noopener noreferrer">BohuTANG</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-4">Improvement<a class="hash-link" href="#improvement-4" title="Direct link to heading">​</a></h4><ul><li>Enable <code>Atomic</code> database engine by default for newly created databases. <a href="https://github.com/ClickHouse/ClickHouse/pull/15003" target="_blank" rel="noopener noreferrer">#15003</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Add the ability to specify specialized codecs like <code>Delta</code>, <code>T64</code>, etc. for columns with subtypes. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/12551" target="_blank" rel="noopener noreferrer">#12551</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11397" target="_blank" rel="noopener noreferrer">#11397</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4609" target="_blank" rel="noopener noreferrer">#4609</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15089" target="_blank" rel="noopener noreferrer">#15089</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Dynamic reload of zookeeper config. <a href="https://github.com/ClickHouse/ClickHouse/pull/14678" target="_blank" rel="noopener noreferrer">#14678</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Now it&#x27;s allowed to execute <code>ALTER ... ON CLUSTER</code> queries regardless of the <code>&lt;internal_replication&gt;</code> setting in cluster config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16075" target="_blank" rel="noopener noreferrer">#16075</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now <code>joinGet</code> supports multi-key lookup. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/12418" target="_blank" rel="noopener noreferrer">#12418</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13015" target="_blank" rel="noopener noreferrer">#13015</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Wait for <code>DROP/DETACH TABLE</code> to actually finish if <code>NO DELAY</code> or <code>SYNC</code> is specified for <code>Atomic</code> database. <a href="https://github.com/ClickHouse/ClickHouse/pull/15448" target="_blank" rel="noopener noreferrer">#15448</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Now it&#x27;s possible to change the type of version column for <code>VersionedCollapsingMergeTree</code> with <code>ALTER</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/15442" target="_blank" rel="noopener noreferrer">#15442</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Unfold <code>{database}</code>, <code>{table}</code> and <code>{uuid}</code> macros in <code>zookeeper_path</code> on replicated table creation. Do not allow <code>RENAME TABLE</code> if it may break <code>zookeeper_path</code> after server restart. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6917" target="_blank" rel="noopener noreferrer">#6917</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15348" target="_blank" rel="noopener noreferrer">#15348</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>The function <code>now</code> allows an argument with timezone. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15264" target="_blank" rel="noopener noreferrer">15264</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15285" target="_blank" rel="noopener noreferrer">#15285</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Do not allow connections to ClickHouse server until all scripts in <code>/docker-entrypoint-initdb.d/</code> are executed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15244" target="_blank" rel="noopener noreferrer">#15244</a> (<a href="https://github.com/alekseik1" target="_blank" rel="noopener noreferrer">Aleksei Kozharin</a>).</li><li>Added <code>optimize</code> setting to <code>EXPLAIN PLAN</code> query. If enabled, query plan level optimisations are applied. Enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/15201" target="_blank" rel="noopener noreferrer">#15201</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Proper exception message for wrong number of arguments of CAST. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13992" target="_blank" rel="noopener noreferrer">#13992</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15029" target="_blank" rel="noopener noreferrer">#15029</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add option to disable TTL move on data part insert. <a href="https://github.com/ClickHouse/ClickHouse/pull/15000" target="_blank" rel="noopener noreferrer">#15000</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Ignore key constraints when doing mutations. Without this pull request, it&#x27;s not possible to do mutations when <code>force_index_by_date = 1</code> or <code>force_primary_key = 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14973" target="_blank" rel="noopener noreferrer">#14973</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Allow to drop Replicated table if previous drop attempt was failed due to ZooKeeper session expiration. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11891" target="_blank" rel="noopener noreferrer">#11891</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14926" target="_blank" rel="noopener noreferrer">#14926</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed excessive settings constraint violation when running SELECT with SETTINGS from a distributed table. <a href="https://github.com/ClickHouse/ClickHouse/pull/14876" target="_blank" rel="noopener noreferrer">#14876</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Provide a <code>load_balancing_first_offset</code> query setting to explicitly state what the first replica is. It&#x27;s used together with <code>FIRST_OR_RANDOM</code> load balancing strategy, which allows to control replicas workload. <a href="https://github.com/ClickHouse/ClickHouse/pull/14867" target="_blank" rel="noopener noreferrer">#14867</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Show subqueries for <code>SET</code> and <code>JOIN</code> in <code>EXPLAIN</code> result. <a href="https://github.com/ClickHouse/ClickHouse/pull/14856" target="_blank" rel="noopener noreferrer">#14856</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Allow using multi-volume storage configuration in storage <code>Distributed</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14839" target="_blank" rel="noopener noreferrer">#14839</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Construct <code>query_start_time</code> and <code>query_start_time_microseconds</code> from the same timespec. <a href="https://github.com/ClickHouse/ClickHouse/pull/14831" target="_blank" rel="noopener noreferrer">#14831</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Support for disabling persistency for <code>StorageJoin</code> and <code>StorageSet</code>, this feature is controlled by setting <code>disable_set_and_join_persistency</code>. And this PR solved issue <a href="https://github.com/ClickHouse/ClickHouse/issues/6318" target="_blank" rel="noopener noreferrer">#6318</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14776" target="_blank" rel="noopener noreferrer">#14776</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>).</li><li>Now <code>COLUMNS</code> can be used to wrap over a list of columns and apply column transformers afterwards. <a href="https://github.com/ClickHouse/ClickHouse/pull/14775" target="_blank" rel="noopener noreferrer">#14775</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add <code>merge_algorithm</code> to <code>system.merges</code> table to improve merging inspections. <a href="https://github.com/ClickHouse/ClickHouse/pull/14705" target="_blank" rel="noopener noreferrer">#14705</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix potential memory leak caused by zookeeper exists watch. <a href="https://github.com/ClickHouse/ClickHouse/pull/14693" target="_blank" rel="noopener noreferrer">#14693</a> (<a href="https://github.com/hustnn" target="_blank" rel="noopener noreferrer">hustnn</a>).</li><li>Allow parallel execution of distributed DDL. <a href="https://github.com/ClickHouse/ClickHouse/pull/14684" target="_blank" rel="noopener noreferrer">#14684</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add <code>QueryMemoryLimitExceeded</code> event counter. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14589" target="_blank" rel="noopener noreferrer">#14589</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14647" target="_blank" rel="noopener noreferrer">#14647</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Fix some trailing whitespaces in query formatting. <a href="https://github.com/ClickHouse/ClickHouse/pull/14595" target="_blank" rel="noopener noreferrer">#14595</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>ClickHouse treats partition expr and key expr differently. Partition expr is used to construct an minmax index containing related columns, while primary key expr is stored as an expr. Sometimes user might partition a table at coarser levels, such as <code>partition by i / 1000</code>. However, binary operators are not monotonic and this PR tries to fix that. It might also benifit other use cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/14513" target="_blank" rel="noopener noreferrer">#14513</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add an option to skip access checks for <code>DiskS3</code>. <code>s3</code> disk is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/14497" target="_blank" rel="noopener noreferrer">#14497</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Speed up server shutdown process if there are ongoing S3 requests. <a href="https://github.com/ClickHouse/ClickHouse/pull/14496" target="_blank" rel="noopener noreferrer">#14496</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li><code>SYSTEM RELOAD CONFIG</code> now throws an exception if failed to reload and continues using the previous users.xml. The background periodic reloading also continues using the previous users.xml if failed to reload. <a href="https://github.com/ClickHouse/ClickHouse/pull/14492" target="_blank" rel="noopener noreferrer">#14492</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>For INSERTs with inline data in VALUES format in the script mode of <code>clickhouse-client</code>, support semicolon as the data terminator, in addition to the new line. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12288" target="_blank" rel="noopener noreferrer">#12288</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13192" target="_blank" rel="noopener noreferrer">#13192</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Support custom codecs in compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12183" target="_blank" rel="noopener noreferrer">#12183</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-2">Performance Improvement<a class="hash-link" href="#performance-improvement-2" title="Direct link to heading">​</a></h4><ul><li>Enable compact parts by default for small parts. This will allow to process frequent inserts slightly more efficiently (4..100 times). <a href="https://github.com/ClickHouse/ClickHouse/pull/11913" target="_blank" rel="noopener noreferrer">#11913</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve <code>quantileTDigest</code> performance. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/2668" target="_blank" rel="noopener noreferrer">#2668</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15542" target="_blank" rel="noopener noreferrer">#15542</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Significantly reduce memory usage in AggregatingInOrderTransform/optimize_aggregation_in_order. <a href="https://github.com/ClickHouse/ClickHouse/pull/15543" target="_blank" rel="noopener noreferrer">#15543</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Faster 256-bit multiplication. <a href="https://github.com/ClickHouse/ClickHouse/pull/15418" target="_blank" rel="noopener noreferrer">#15418</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Improve performance of 256-bit types using (u)int64_t as base type for wide integers. Original wide integers use 8-bit types as base. <a href="https://github.com/ClickHouse/ClickHouse/pull/14859" target="_blank" rel="noopener noreferrer">#14859</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Explicitly use a temporary disk to store vertical merge temporary data. <a href="https://github.com/ClickHouse/ClickHouse/pull/15639" target="_blank" rel="noopener noreferrer">#15639</a> (<a href="https://github.com/GrigoryPervakov" target="_blank" rel="noopener noreferrer">Grigory Pervakov</a>).</li><li>Use one S3 DeleteObjects request instead of multiple DeleteObject in a loop. No any functionality changes, so covered by existing tests like integration/test_log_family_s3. <a href="https://github.com/ClickHouse/ClickHouse/pull/15238" target="_blank" rel="noopener noreferrer">#15238</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Fix <code>DateTime &lt;op&gt; DateTime</code> mistakenly choosing the slow generic implementation. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15153" target="_blank" rel="noopener noreferrer">#15153</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15178" target="_blank" rel="noopener noreferrer">#15178</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Improve performance of GROUP BY key of type <code>FixedString</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15034" target="_blank" rel="noopener noreferrer">#15034</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Only <code>mlock</code> code segment when starting clickhouse-server. In previous versions, all mapped regions were locked in memory, including debug info. Debug info is usually splitted to a separate file but if it isn&#x27;t, it led to +2..3 GiB memory usage. <a href="https://github.com/ClickHouse/ClickHouse/pull/14929" target="_blank" rel="noopener noreferrer">#14929</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>ClickHouse binary become smaller due to link time optimization.</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-4">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-4" title="Direct link to heading">​</a></h4><ul><li>Now we use clang-11 for production ClickHouse build. <a href="https://github.com/ClickHouse/ClickHouse/pull/15239" target="_blank" rel="noopener noreferrer">#15239</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now we use clang-11 to build ClickHouse in CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/14846" target="_blank" rel="noopener noreferrer">#14846</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Switch binary builds (Linux, Darwin, AArch64, FreeDSD) to clang-11. <a href="https://github.com/ClickHouse/ClickHouse/pull/15622" target="_blank" rel="noopener noreferrer">#15622</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Now all test images use <code>llvm-symbolizer-11</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15069" target="_blank" rel="noopener noreferrer">#15069</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Allow to build with llvm-11. <a href="https://github.com/ClickHouse/ClickHouse/pull/15366" target="_blank" rel="noopener noreferrer">#15366</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Switch from <code>clang-tidy-10</code> to <code>clang-tidy-11</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14922" target="_blank" rel="noopener noreferrer">#14922</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Use LLVM&#x27;s experimental pass manager by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/15608" target="_blank" rel="noopener noreferrer">#15608</a> (<a href="https://github.com/danlark1" target="_blank" rel="noopener noreferrer">Danila Kutenin</a>).</li><li>Don&#x27;t allow any C++ translation unit to build more than 10 minutes or to use more than 10 GB or memory. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14925" target="_blank" rel="noopener noreferrer">#14925</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15060" target="_blank" rel="noopener noreferrer">#15060</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make performance test more stable and representative by splitting test runs and profile runs. <a href="https://github.com/ClickHouse/ClickHouse/pull/15027" target="_blank" rel="noopener noreferrer">#15027</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Attempt to make performance test more reliable. It is done by remapping the executable memory of the process on the fly with <code>madvise</code> to use transparent huge pages - it can lower the number of iTLB misses which is the main source of instabilities in performance tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/14685" target="_blank" rel="noopener noreferrer">#14685</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Convert to python3. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14886" target="_blank" rel="noopener noreferrer">#14886</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15007" target="_blank" rel="noopener noreferrer">#15007</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fail early in functional tests if server failed to respond. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/15262" target="_blank" rel="noopener noreferrer">#15262</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15267" target="_blank" rel="noopener noreferrer">#15267</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow to run AArch64 version of clickhouse-server without configs. This facilitates <a href="https://github.com/ClickHouse/ClickHouse/issues/15174" target="_blank" rel="noopener noreferrer">#15174</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15266" target="_blank" rel="noopener noreferrer">#15266</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improvements in CI docker images: get rid of ZooKeeper and single script for test configs installation. <a href="https://github.com/ClickHouse/ClickHouse/pull/15215" target="_blank" rel="noopener noreferrer">#15215</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix CMake options forwarding in fast test script. Fixes error in <a href="https://github.com/ClickHouse/ClickHouse/issues/14711" target="_blank" rel="noopener noreferrer">#14711</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15155" target="_blank" rel="noopener noreferrer">#15155</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Added a script to perform hardware benchmark in a single command. <a href="https://github.com/ClickHouse/ClickHouse/pull/15115" target="_blank" rel="noopener noreferrer">#15115</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Splitted huge test <code>test_dictionaries_all_layouts_and_sources</code> into smaller ones. <a href="https://github.com/ClickHouse/ClickHouse/pull/15110" target="_blank" rel="noopener noreferrer">#15110</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Maybe fix MSan report in base64 (on servers with AVX-512). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14006" target="_blank" rel="noopener noreferrer">#14006</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15030" target="_blank" rel="noopener noreferrer">#15030</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Reformat and cleanup code in all integration test *.py files. <a href="https://github.com/ClickHouse/ClickHouse/pull/14864" target="_blank" rel="noopener noreferrer">#14864</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix MaterializeMySQL empty transaction unstable test case found in CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/14854" target="_blank" rel="noopener noreferrer">#14854</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Attempt to speed up build a little. <a href="https://github.com/ClickHouse/ClickHouse/pull/14808" target="_blank" rel="noopener noreferrer">#14808</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Speed up build a little by removing unused headers. <a href="https://github.com/ClickHouse/ClickHouse/pull/14714" target="_blank" rel="noopener noreferrer">#14714</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix build failure in OSX. <a href="https://github.com/ClickHouse/ClickHouse/pull/14761" target="_blank" rel="noopener noreferrer">#14761</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Enable ccache by default in cmake if it&#x27;s found in OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/14575" target="_blank" rel="noopener noreferrer">#14575</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Control CI builds configuration from the ClickHouse repository. <a href="https://github.com/ClickHouse/ClickHouse/pull/14547" target="_blank" rel="noopener noreferrer">#14547</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>In CMake files: - Moved some options&#x27; descriptions&#x27; parts to comments above. - Replace 0 -&gt; <code>OFF</code>, 1 -&gt; <code>ON</code> in <code>option</code>s default values. - Added some descriptions and links to docs to the options. - Replaced <code>FUZZER</code> option (there is another option <code>ENABLE_FUZZING</code> which also enables same functionality). - Removed <code>ENABLE_GTEST_LIBRARY</code> option as there is <code>ENABLE_TESTS</code>. See the full description in PR: <a href="https://github.com/ClickHouse/ClickHouse/pull/14711" target="_blank" rel="noopener noreferrer">#14711</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Make binary a bit smaller (~50 Mb for debug version). <a href="https://github.com/ClickHouse/ClickHouse/pull/14555" target="_blank" rel="noopener noreferrer">#14555</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Use std::filesystem::path in ConfigProcessor for concatenating file paths. <a href="https://github.com/ClickHouse/ClickHouse/pull/14558" target="_blank" rel="noopener noreferrer">#14558</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix debug assertion in <code>bitShiftLeft()</code> when called with negative big integer. <a href="https://github.com/ClickHouse/ClickHouse/pull/14697" target="_blank" rel="noopener noreferrer">#14697</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-209">ClickHouse release 20.9<a class="hash-link" href="#clickhouse-release-209" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v209711-stable-2020-12-07">ClickHouse release v20.9.7.11-stable, 2020-12-07<a class="hash-link" href="#clickhouse-release-v209711-stable-2020-12-07" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-3">Performance Improvement<a class="hash-link" href="#performance-improvement-3" title="Direct link to heading">​</a></h4><ul><li>Fix performance of reading from <code>Merge</code> tables over huge number of <code>MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7748" target="_blank" rel="noopener noreferrer">#7748</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16988" target="_blank" rel="noopener noreferrer">#16988</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-10">Bug Fix<a class="hash-link" href="#bug-fix-10" title="Direct link to heading">​</a></h4><ul><li>Do not restore parts from WAL if <code>in_memory_parts_enable_wal</code> is disabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/17802" target="_blank" rel="noopener noreferrer">#17802</a> (<a href="https://github.com/detailyang" target="_blank" rel="noopener noreferrer">detailyang</a>).</li><li>Fixed segfault when there is not enough space when inserting into <code>Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/17737" target="_blank" rel="noopener noreferrer">#17737</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" target="_blank" rel="noopener noreferrer">#17681</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Fixed <code>Function not implemented</code> error when executing <code>RENAME</code> query in <code>Atomic</code> database with ClickHouse running on Windows Subsystem for Linux. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17661" target="_blank" rel="noopener noreferrer">#17661</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17664" target="_blank" rel="noopener noreferrer">#17664</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>When clickhouse-client is used in interactive mode with multiline queries, single line comment was erronously extended till the end of query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13654" target="_blank" rel="noopener noreferrer">#13654</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17565" target="_blank" rel="noopener noreferrer">#17565</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix the issue when server can stop accepting connections in very rare cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/17542" target="_blank" rel="noopener noreferrer">#17542</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix alter query hang when the corresponding mutation was killed on the different replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" target="_blank" rel="noopener noreferrer">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" target="_blank" rel="noopener noreferrer">#17499</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug when mark cache size was underestimated by clickhouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" target="_blank" rel="noopener noreferrer">#17496</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix <code>ORDER BY</code> with enabled setting <code>optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" target="_blank" rel="noopener noreferrer">#17471</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix duplicates after <code>DISTINCT</code> which were possible because of incorrect optimization. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17294" target="_blank" rel="noopener noreferrer">#17294</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17296" target="_blank" rel="noopener noreferrer">#17296</a> (<a href="https://github.com/chengxianglibra" target="_blank" rel="noopener noreferrer">li chengxiang</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/17439" target="_blank" rel="noopener noreferrer">#17439</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix crash while reading from <code>JOIN</code> table with <code>LowCardinality</code> types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17228" target="_blank" rel="noopener noreferrer">#17228</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17397" target="_blank" rel="noopener noreferrer">#17397</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix set index invalidation when there are const columns in the subquery. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17246" target="_blank" rel="noopener noreferrer">#17246</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17249" target="_blank" rel="noopener noreferrer">#17249</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix ColumnConst comparison which leads to crash. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/17088" target="_blank" rel="noopener noreferrer">#17088</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17135" target="_blank" rel="noopener noreferrer">#17135</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed crash on <code>CREATE TABLE ... AS some_table</code> query when <code>some_table</code> was created <code>AS table_function()</code> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16944" target="_blank" rel="noopener noreferrer">#16944</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17072" target="_blank" rel="noopener noreferrer">#17072</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Bug fix for funciton fuzzBits, related issue: <a href="https://github.com/ClickHouse/ClickHouse/issues/16980" target="_blank" rel="noopener noreferrer">#16980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17051" target="_blank" rel="noopener noreferrer">#17051</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Avoid unnecessary network errors for remote queries which may be cancelled while execution, like queries with <code>LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17006" target="_blank" rel="noopener noreferrer">#17006</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>TODO. <a href="https://github.com/ClickHouse/ClickHouse/pull/16866" target="_blank" rel="noopener noreferrer">#16866</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Return number of affected rows for INSERT queries via MySQL protocol. Previously ClickHouse used to always return 0, it&#x27;s fixed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16605" target="_blank" rel="noopener noreferrer">#16605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16715" target="_blank" rel="noopener noreferrer">#16715</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-5">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-5" title="Direct link to heading">​</a></h4><ul><li>Update embedded timezone data to version 2020d (also update cctz to the latest master). <a href="https://github.com/ClickHouse/ClickHouse/pull/17204" target="_blank" rel="noopener noreferrer">#17204</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v209614-stable-2020-11-20">ClickHouse release v20.9.6.14-stable, 2020-11-20<a class="hash-link" href="#clickhouse-release-v209614-stable-2020-11-20" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-5">Improvement<a class="hash-link" href="#improvement-5" title="Direct link to heading">​</a></h4><ul><li>Make it possible to connect to <code>clickhouse-server</code> secure endpoint which requires SNI. This is possible when <code>clickhouse-server</code> is hosted behind TLS proxy. <a href="https://github.com/ClickHouse/ClickHouse/pull/16938" target="_blank" rel="noopener noreferrer">#16938</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Conditional aggregate functions (for example: <code>avgIf</code>, <code>sumIf</code>, <code>maxIf</code>) should return <code>NULL</code> when miss rows and use nullable arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/13964" target="_blank" rel="noopener noreferrer">#13964</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-11">Bug Fix<a class="hash-link" href="#bug-fix-11" title="Direct link to heading">​</a></h4><ul><li>Fix bug when <code>ON CLUSTER</code> queries may hang forever for non-leader ReplicatedMergeTreeTables. <a href="https://github.com/ClickHouse/ClickHouse/pull/17089" target="_blank" rel="noopener noreferrer">#17089</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Reresolve the IP of the <code>format_avro_schema_registry_url</code> in case of errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16985" target="_blank" rel="noopener noreferrer">#16985</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix possible server crash after <code>ALTER TABLE ... MODIFY COLUMN ... NewType</code> when <code>SELECT</code> have <code>WHERE</code> expression on altering column and alter does not finished yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/16968" target="_blank" rel="noopener noreferrer">#16968</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Install script should always create subdirs in config folders. This is only relevant for Docker build with custom config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16936" target="_blank" rel="noopener noreferrer">#16936</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix possible error <code>Illegal type of argument</code> for queries with <code>ORDER BY</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16580" target="_blank" rel="noopener noreferrer">#16580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16928" target="_blank" rel="noopener noreferrer">#16928</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Abort multipart upload if no data was written to WriteBufferFromS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/16840" target="_blank" rel="noopener noreferrer">#16840</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fix crash when using <code>any</code> without any arguments. This is for <a href="https://github.com/ClickHouse/ClickHouse/issues/16803" target="_blank" rel="noopener noreferrer">#16803</a> . cc @azat. <a href="https://github.com/ClickHouse/ClickHouse/pull/16826" target="_blank" rel="noopener noreferrer">#16826</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix <code>IN</code> operator over several columns and tuples with enabled <code>transform_null_in</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15310" target="_blank" rel="noopener noreferrer">#15310</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16722" target="_blank" rel="noopener noreferrer">#16722</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>This will fix optimize_read_in_order/optimize_aggregation_in_order with max_threads&gt;0 and expression in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/16637" target="_blank" rel="noopener noreferrer">#16637</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16574" target="_blank" rel="noopener noreferrer">#16574</a> fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16231" target="_blank" rel="noopener noreferrer">#16231</a> fix remote query failure when using &#x27;if&#x27; suffix aggregate function. <a href="https://github.com/ClickHouse/ClickHouse/pull/16610" target="_blank" rel="noopener noreferrer">#16610</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Query is finished faster in case of exception. Cancel execution on remote replicas if exception happens. <a href="https://github.com/ClickHouse/ClickHouse/pull/15578" target="_blank" rel="noopener noreferrer">#15578</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20955-stable-2020-11-13">ClickHouse release v20.9.5.5-stable, 2020-11-13<a class="hash-link" href="#clickhouse-release-v20955-stable-2020-11-13" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-12">Bug Fix<a class="hash-link" href="#bug-fix-12" title="Direct link to heading">​</a></h4><ul><li>Fix rare silent crashes when query profiler is on and ClickHouse is installed on OS with glibc version that has (supposedly) broken asynchronous unwind tables for some functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15301" target="_blank" rel="noopener noreferrer">#15301</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13098" target="_blank" rel="noopener noreferrer">#13098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16846" target="_blank" rel="noopener noreferrer">#16846</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now when parsing AVRO from input the LowCardinality is removed from type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16188" target="_blank" rel="noopener noreferrer">#16188</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16521" target="_blank" rel="noopener noreferrer">#16521</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Fix rapid growth of metadata when using MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine, and <code>slave_parallel_worker</code> enabled on MySQL Slave, by properly shrinking GTID sets. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15951" target="_blank" rel="noopener noreferrer">#15951</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16504" target="_blank" rel="noopener noreferrer">#16504</a> (<a href="https://github.com/TCeason" target="_blank" rel="noopener noreferrer">TCeason</a>).</li><li>Fix DROP TABLE for Distributed (racy with INSERT). <a href="https://github.com/ClickHouse/ClickHouse/pull/16409" target="_blank" rel="noopener noreferrer">#16409</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix processing of very large entries in replication queue. Very large entries may appear in ALTER queries if table structure is extremely large (near 1 MB). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16307" target="_blank" rel="noopener noreferrer">#16307</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16332" target="_blank" rel="noopener noreferrer">#16332</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the inconsistent behaviour when a part of return data could be dropped because the set for its filtration wasn&#x27;t created. <a href="https://github.com/ClickHouse/ClickHouse/pull/16308" target="_blank" rel="noopener noreferrer">#16308</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix bug with MySQL database. When MySQL server used as database engine is down some queries raise Exception, because they try to get tables from disabled server, while it&#x27;s unnecessary. For example, query <code>SELECT ... FROM system.parts</code> should work only with MergeTree tables and don&#x27;t touch MySQL database at all. <a href="https://github.com/ClickHouse/ClickHouse/pull/16032" target="_blank" rel="noopener noreferrer">#16032</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v209476-stable-2020-10-29">ClickHouse release v20.9.4.76-stable (2020-10-29)<a class="hash-link" href="#clickhouse-release-v209476-stable-2020-10-29" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-13">Bug Fix<a class="hash-link" href="#bug-fix-13" title="Direct link to heading">​</a></h4><ul><li>Fix double free in case of exception in function <code>dictGet</code>. It could have happened if dictionary was loaded with error. <a href="https://github.com/ClickHouse/ClickHouse/pull/16429" target="_blank" rel="noopener noreferrer">#16429</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix group by with totals/rollup/cube modifers and min/max functions over group by keys. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16393" target="_blank" rel="noopener noreferrer">#16393</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16397" target="_blank" rel="noopener noreferrer">#16397</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix async Distributed INSERT w/ prefer_localhost_replica=0 and internal_replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/16358" target="_blank" rel="noopener noreferrer">#16358</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix a very wrong code in TwoLevelStringHashTable implementation, which might lead to memory leak. I&#x27;m suprised how this bug can lurk for so long.... <a href="https://github.com/ClickHouse/ClickHouse/pull/16264" target="_blank" rel="noopener noreferrer">#16264</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix the case when memory can be overallocated regardless to the limit. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14560" target="_blank" rel="noopener noreferrer">#14560</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16206" target="_blank" rel="noopener noreferrer">#16206</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>ALTER MODIFY ... ORDER BY</code> query hang for <code>ReplicatedVersionedCollapsingMergeTree</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15980" target="_blank" rel="noopener noreferrer">#15980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16011" target="_blank" rel="noopener noreferrer">#16011</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix collate name &amp; charset name parser and support <code>length = 0</code> for string type. <a href="https://github.com/ClickHouse/ClickHouse/pull/16008" target="_blank" rel="noopener noreferrer">#16008</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Allow to use direct layout for dictionaries with complex keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/16007" target="_blank" rel="noopener noreferrer">#16007</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Prevent replica hang for 5-10 mins when replication error happens after a period of inactivity. <a href="https://github.com/ClickHouse/ClickHouse/pull/15987" target="_blank" rel="noopener noreferrer">#15987</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix rare segfaults when inserting into or selecting from MaterializedView and concurrently dropping target table (for Atomic database engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/15984" target="_blank" rel="noopener noreferrer">#15984</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix ambiguity in parsing of settings profiles: <code>CREATE USER ... SETTINGS profile readonly</code> is now considered as using a profile named <code>readonly</code>, not a setting named <code>profile</code> with the readonly constraint. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15628" target="_blank" rel="noopener noreferrer">#15628</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15982" target="_blank" rel="noopener noreferrer">#15982</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix a crash when database creation fails. <a href="https://github.com/ClickHouse/ClickHouse/pull/15954" target="_blank" rel="noopener noreferrer">#15954</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <code>DROP TABLE IF EXISTS</code> failure with <code>Table ... does not exist</code> error when table is concurrently renamed (for Atomic database engine). Fixed rare deadlock when concurrently executing some DDL queries with multiple tables (like <code>DROP DATABASE</code> and <code>RENAME TABLE</code>) Fixed <code>DROP/DETACH DATABASE</code> failure with <code>Table ... does not exist</code> when concurrently executing <code>DROP/DETACH TABLE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15934" target="_blank" rel="noopener noreferrer">#15934</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix incorrect empty result for query from <code>Distributed</code> table if query has <code>WHERE</code>, <code>PREWHERE</code> and <code>GLOBAL IN</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15792" target="_blank" rel="noopener noreferrer">#15792</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15933" target="_blank" rel="noopener noreferrer">#15933</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix possible deadlocks in RBAC. <a href="https://github.com/ClickHouse/ClickHouse/pull/15875" target="_blank" rel="noopener noreferrer">#15875</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix exception <code>Block structure mismatch</code> in <code>SELECT ... ORDER BY DESC</code> queries which were executed after <code>ALTER MODIFY COLUMN</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15800" target="_blank" rel="noopener noreferrer">#15800</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15852" target="_blank" rel="noopener noreferrer">#15852</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix <code>select count()</code> inaccuracy for MaterializeMySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/15767" target="_blank" rel="noopener noreferrer">#15767</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix some cases of queries, in which only virtual columns are selected. Previously <code>Not found column _nothing in block</code> exception may be thrown. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12298" target="_blank" rel="noopener noreferrer">#12298</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15756" target="_blank" rel="noopener noreferrer">#15756</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed too low default value of <code>max_replicated_logs_to_keep</code> setting, which might cause replicas to become lost too often. Improve lost replica recovery process by choosing the most up-to-date replica to clone. Also do not remove old parts from lost replica, detach them instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/15701" target="_blank" rel="noopener noreferrer">#15701</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix error <code>Cannot add simple transform to empty Pipe</code> which happened while reading from <code>Buffer</code> table which has different structure than destination table. It was possible if destination table returned empty result for query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15529" target="_blank" rel="noopener noreferrer">#15529</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15662" target="_blank" rel="noopener noreferrer">#15662</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed bug with globs in S3 table function, region from URL was not applied to S3 client configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/15646" target="_blank" rel="noopener noreferrer">#15646</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Decrement the <code>ReadonlyReplica</code> metric when detaching read-only tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15598" target="_blank" rel="noopener noreferrer">#15598</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15592" target="_blank" rel="noopener noreferrer">#15592</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Throw an error when a single parameter is passed to ReplicatedMergeTree instead of ignoring it. <a href="https://github.com/ClickHouse/ClickHouse/pull/15516" target="_blank" rel="noopener noreferrer">#15516</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-6">Improvement<a class="hash-link" href="#improvement-6" title="Direct link to heading">​</a></h4><ul><li>Now it&#x27;s allowed to execute <code>ALTER ... ON CLUSTER</code> queries regardless of the <code>&lt;internal_replication&gt;</code> setting in cluster config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16075" target="_blank" rel="noopener noreferrer">#16075</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Unfold <code>{database}</code>, <code>{table}</code> and <code>{uuid}</code> macros in <code>ReplicatedMergeTree</code> arguments on table creation. <a href="https://github.com/ClickHouse/ClickHouse/pull/16160" target="_blank" rel="noopener noreferrer">#16160</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v209345-stable-2020-10-09">ClickHouse release v20.9.3.45-stable (2020-10-09)<a class="hash-link" href="#clickhouse-release-v209345-stable-2020-10-09" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-14">Bug Fix<a class="hash-link" href="#bug-fix-14" title="Direct link to heading">​</a></h4><ul><li>Fix error <code>Cannot find column</code> which may happen at insertion into <code>MATERIALIZED VIEW</code> in case if query for <code>MV</code> containes <code>ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15717" target="_blank" rel="noopener noreferrer">#15717</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix race condition in AMQP-CPP. <a href="https://github.com/ClickHouse/ClickHouse/pull/15667" target="_blank" rel="noopener noreferrer">#15667</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix the order of destruction for resources in <code>ReadFromStorage</code> step of query plan. It might cause crashes in rare cases. Possibly connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/15610" target="_blank" rel="noopener noreferrer">#15610</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15645" target="_blank" rel="noopener noreferrer">#15645</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed <code>Element ... is not a constant expression</code> error when using <code>JSON*</code> function result in <code>VALUES</code>, <code>LIMIT</code> or right side of <code>IN</code> operator. <a href="https://github.com/ClickHouse/ClickHouse/pull/15589" target="_blank" rel="noopener noreferrer">#15589</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Prevent the possibility of error message <code>Could not calculate available disk space (statvfs), errno: 4, strerror: Interrupted system call</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15541" target="_blank" rel="noopener noreferrer">#15541</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15557" target="_blank" rel="noopener noreferrer">#15557</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Significantly reduce memory usage in AggregatingInOrderTransform/optimize_aggregation_in_order. <a href="https://github.com/ClickHouse/ClickHouse/pull/15543" target="_blank" rel="noopener noreferrer">#15543</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Mutation might hang waiting for some non-existent part after <code>MOVE</code> or <code>REPLACE PARTITION</code> or, in rare cases, after <code>DETACH</code> or <code>DROP PARTITION</code>. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" target="_blank" rel="noopener noreferrer">#15537</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix bug when <code>ILIKE</code> operator stops being case insensitive if <code>LIKE</code> with the same pattern was executed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15536" target="_blank" rel="noopener noreferrer">#15536</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix <code>Missing columns</code> errors when selecting columns which absent in data, but depend on other columns which also absent in data. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15530" target="_blank" rel="noopener noreferrer">#15530</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15532" target="_blank" rel="noopener noreferrer">#15532</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug with event subscription in DDLWorker which rarely may lead to query hangs in <code>ON CLUSTER</code>. Introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/13450" target="_blank" rel="noopener noreferrer">#13450</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15477" target="_blank" rel="noopener noreferrer">#15477</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Report proper error when the second argument of <code>boundingRatio</code> aggregate function has a wrong type. <a href="https://github.com/ClickHouse/ClickHouse/pull/15407" target="_blank" rel="noopener noreferrer">#15407</a> (<a href="https://github.com/detailyang" target="_blank" rel="noopener noreferrer">detailyang</a>).</li><li>Fix bug where queries like <code>SELECT toStartOfDay(today())</code> fail complaining about empty time_zone argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/15319" target="_blank" rel="noopener noreferrer">#15319</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix race condition during MergeTree table rename and background cleanup. <a href="https://github.com/ClickHouse/ClickHouse/pull/15304" target="_blank" rel="noopener noreferrer">#15304</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix rare race condition on server startup when system.logs are enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/15300" target="_blank" rel="noopener noreferrer">#15300</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix MSan report in QueryLog. Uninitialized memory can be used for the field <code>memory_usage</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15258" target="_blank" rel="noopener noreferrer">#15258</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix instance crash when using joinGet with LowCardinality types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15214" target="_blank" rel="noopener noreferrer">#15214</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15220" target="_blank" rel="noopener noreferrer">#15220</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix bug in table engine <code>Buffer</code> which does not allow to insert data of new structure into <code>Buffer</code> after <code>ALTER</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15117" target="_blank" rel="noopener noreferrer">#15117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15192" target="_blank" rel="noopener noreferrer">#15192</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Adjust decimals field size in mysql column definition packet. <a href="https://github.com/ClickHouse/ClickHouse/pull/15152" target="_blank" rel="noopener noreferrer">#15152</a> (<a href="https://github.com/maqroll" target="_blank" rel="noopener noreferrer">maqroll</a>).</li><li>Fixed <code>Cannot rename ... errno: 22, strerror: Invalid argument</code> error on DDL query execution in Atomic database when running clickhouse-server in docker on Mac OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/15024" target="_blank" rel="noopener noreferrer">#15024</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix to make predicate push down work when subquery contains finalizeAggregation function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14847" target="_blank" rel="noopener noreferrer">#14847</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14937" target="_blank" rel="noopener noreferrer">#14937</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix a problem where the server may get stuck on startup while talking to ZooKeeper, if the configuration files have to be fetched from ZK (using the <code>from_zk</code> include option). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14814" target="_blank" rel="noopener noreferrer">#14814</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14843" target="_blank" rel="noopener noreferrer">#14843</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-7">Improvement<a class="hash-link" href="#improvement-7" title="Direct link to heading">​</a></h4><ul><li>Now it&#x27;s possible to change the type of version column for <code>VersionedCollapsingMergeTree</code> with <code>ALTER</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/15442" target="_blank" rel="noopener noreferrer">#15442</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v209220-2020-09-22">ClickHouse release v20.9.2.20, 2020-09-22<a class="hash-link" href="#clickhouse-release-v209220-2020-09-22" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-3">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-3" title="Direct link to heading">​</a></h4><ul><li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code>Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-3">New Feature<a class="hash-link" href="#new-feature-3" title="Direct link to heading">​</a></h4><ul><li>Added column transformers <code>EXCEPT</code>, <code>REPLACE</code>, <code>APPLY</code>, which can be applied to the list of selected columns (after <code>*</code> or <code>COLUMNS(...)</code>). For example, you can write <code>SELECT * EXCEPT(URL) REPLACE(number + 1 AS number)</code>. Another example: <code>select * apply(length) apply(max) from wide_string_table</code> to find out the maxium length of all string columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/14233" target="_blank" rel="noopener noreferrer">#14233</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added an aggregate function <code>rankCorr</code> which computes a rank correlation coefficient. <a href="https://github.com/ClickHouse/ClickHouse/pull/11769" target="_blank" rel="noopener noreferrer">#11769</a> (<a href="https://github.com/antikvist" target="_blank" rel="noopener noreferrer">antikvist</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/14411" target="_blank" rel="noopener noreferrer">#14411</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Added table function <code>view</code> which turns a subquery into a table object. This helps passing queries around. For instance, it can be used in remote/cluster table functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/12567" target="_blank" rel="noopener noreferrer">#12567</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-15">Bug Fix<a class="hash-link" href="#bug-fix-15" title="Direct link to heading">​</a></h4><ul><li>Fix bug when <code>ALTER UPDATE</code> mutation with Nullable column in assignment expression and constant value (like <code>UPDATE x = 42</code>) leads to incorrect value in column or segfault. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13634" target="_blank" rel="noopener noreferrer">#13634</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/14045" target="_blank" rel="noopener noreferrer">#14045</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14646" target="_blank" rel="noopener noreferrer">#14646</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix wrong Decimal multiplication result caused wrong decimal scale of result column. <a href="https://github.com/ClickHouse/ClickHouse/pull/14603" target="_blank" rel="noopener noreferrer">#14603</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fixed the incorrect sorting order of <code>Nullable</code> column. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14344" target="_blank" rel="noopener noreferrer">#14344</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14495" target="_blank" rel="noopener noreferrer">#14495</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed inconsistent comparison with primary key of type <code>FixedString</code> on index analysis if they&#x27;re compered with a string of less size. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14908" target="_blank" rel="noopener noreferrer">#14908</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15033" target="_blank" rel="noopener noreferrer">#15033</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix bug which leads to wrong merges assignment if table has partitions with a single part. <a href="https://github.com/ClickHouse/ClickHouse/pull/14444" target="_blank" rel="noopener noreferrer">#14444</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>If function <code>bar</code> was called with specifically crafted arguments, buffer overflow was possible. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13926" target="_blank" rel="noopener noreferrer">#13926</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15028" target="_blank" rel="noopener noreferrer">#15028</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Publish CPU frequencies per logical core in <code>system.asynchronous_metrics</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14923" target="_blank" rel="noopener noreferrer">#14923</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14924" target="_blank" rel="noopener noreferrer">#14924</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fixed <code>.metadata.tmp File exists</code> error when using <code>MaterializeMySQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14898" target="_blank" rel="noopener noreferrer">#14898</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix the issue when some invocations of <code>extractAllGroups</code> function may trigger &quot;Memory limit exceeded&quot; error. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13383" target="_blank" rel="noopener noreferrer">#13383</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14889" target="_blank" rel="noopener noreferrer">#14889</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix SIGSEGV for an attempt to INSERT into StorageFile(fd). <a href="https://github.com/ClickHouse/ClickHouse/pull/14887" target="_blank" rel="noopener noreferrer">#14887</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix rare error in <code>SELECT</code> queries when the queried column has <code>DEFAULT</code> expression which depends on the other column which also has <code>DEFAULT</code> and not present in select query and not exists on disk. Partially fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14531" target="_blank" rel="noopener noreferrer">#14531</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14845" target="_blank" rel="noopener noreferrer">#14845</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix wrong monotonicity detection for shrunk <code>Int -&gt; Int</code> cast of signed types. It might lead to incorrect query result. This bug is unveiled in <a href="https://github.com/ClickHouse/ClickHouse/issues/14513" target="_blank" rel="noopener noreferrer">#14513</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14783" target="_blank" rel="noopener noreferrer">#14783</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed missed default database name in metadata of materialized view when executing <code>ALTER ... MODIFY QUERY</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14664" target="_blank" rel="noopener noreferrer">#14664</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix possibly incorrect result of function <code>has</code> when LowCardinality and Nullable types are involved. <a href="https://github.com/ClickHouse/ClickHouse/pull/14591" target="_blank" rel="noopener noreferrer">#14591</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Cleanup data directory after Zookeeper exceptions during CREATE query for tables with ReplicatedMergeTree Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14563" target="_blank" rel="noopener noreferrer">#14563</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix rare segfaults in functions with combinator <code>-Resample</code>, which could appear in result of overflow with very large parameters. <a href="https://github.com/ClickHouse/ClickHouse/pull/14562" target="_blank" rel="noopener noreferrer">#14562</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Check for array size overflow in <code>topK</code> aggregate function. Without this check the user may send a query with carefully crafted parameters that will lead to server crash. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14452" target="_blank" rel="noopener noreferrer">#14452</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14467" target="_blank" rel="noopener noreferrer">#14467</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Proxy restart/start/stop/reload of SysVinit to systemd (if it is used). <a href="https://github.com/ClickHouse/ClickHouse/pull/14460" target="_blank" rel="noopener noreferrer">#14460</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Stop query execution if exception happened in <code>PipelineExecutor</code> itself. This could prevent rare possible query hung. <a href="https://github.com/ClickHouse/ClickHouse/pull/14334" target="_blank" rel="noopener noreferrer">#14334</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/14402" target="_blank" rel="noopener noreferrer">#14402</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix crash during <code>ALTER</code> query for table which was created <code>AS table_function</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14212" target="_blank" rel="noopener noreferrer">#14212</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14326" target="_blank" rel="noopener noreferrer">#14326</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix exception during ALTER LIVE VIEW query with REFRESH command. LIVE VIEW is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/14320" target="_blank" rel="noopener noreferrer">#14320</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix QueryPlan lifetime (for EXPLAIN PIPELINE graph=1) for queries with nested interpreter. <a href="https://github.com/ClickHouse/ClickHouse/pull/14315" target="_blank" rel="noopener noreferrer">#14315</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Better check for tuple size in SSD cache complex key external dictionaries. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13981" target="_blank" rel="noopener noreferrer">#13981</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14313" target="_blank" rel="noopener noreferrer">#14313</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Disallows <code>CODEC</code> on <code>ALIAS</code> column type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13911" target="_blank" rel="noopener noreferrer">#13911</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14263" target="_blank" rel="noopener noreferrer">#14263</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix GRANT ALL statement when executed on a non-global level. <a href="https://github.com/ClickHouse/ClickHouse/pull/13987" target="_blank" rel="noopener noreferrer">#13987</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix arrayJoin() capturing in lambda (exception with logical error message was thrown). <a href="https://github.com/ClickHouse/ClickHouse/pull/13792" target="_blank" rel="noopener noreferrer">#13792</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-2">Experimental Feature<a class="hash-link" href="#experimental-feature-2" title="Direct link to heading">​</a></h4><ul><li>Added <code>db-generator</code> tool for random database generation by given SELECT queries. It may faciliate reproducing issues when there is only incomplete bug report from the user. <a href="https://github.com/ClickHouse/ClickHouse/pull/14442" target="_blank" rel="noopener noreferrer">#14442</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>) <a href="https://github.com/ClickHouse/ClickHouse/issues/10973" target="_blank" rel="noopener noreferrer">#10973</a> (<a href="https://github.com/ZeDRoman" target="_blank" rel="noopener noreferrer">ZeDRoman</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-8">Improvement<a class="hash-link" href="#improvement-8" title="Direct link to heading">​</a></h4><ul><li>Allow using multi-volume storage configuration in storage Distributed. <a href="https://github.com/ClickHouse/ClickHouse/pull/14839" target="_blank" rel="noopener noreferrer">#14839</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Disallow empty time_zone argument in <code>toStartOf*</code> type of functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/14509" target="_blank" rel="noopener noreferrer">#14509</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>MySQL handler returns <code>OK</code> for queries like <code>SET @@var = value</code>. Such statement is ignored. It is needed because some MySQL drivers send <code>SET @@</code> query for setup after handshake <a href="https://github.com/ClickHouse/ClickHouse/issues/9336#issuecomment-686222422" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/issues/9336#issuecomment-686222422</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/14469" target="_blank" rel="noopener noreferrer">#14469</a> (<a href="https://github.com/BohuTANG" target="_blank" rel="noopener noreferrer">BohuTANG</a>).</li><li>Now TTLs will be applied during merge if they were not previously materialized. <a href="https://github.com/ClickHouse/ClickHouse/pull/14438" target="_blank" rel="noopener noreferrer">#14438</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now <code>clickhouse-obfuscator</code> supports UUID type as proposed in <a href="https://github.com/ClickHouse/ClickHouse/issues/13163" target="_blank" rel="noopener noreferrer">#13163</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14409" target="_blank" rel="noopener noreferrer">#14409</a> (<a href="https://github.com/dimarub2000" target="_blank" rel="noopener noreferrer">dimarub2000</a>).</li><li>Added new setting <code>system_events_show_zero_values</code> as proposed in <a href="https://github.com/ClickHouse/ClickHouse/issues/11384" target="_blank" rel="noopener noreferrer">#11384</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14404" target="_blank" rel="noopener noreferrer">#14404</a> (<a href="https://github.com/dimarub2000" target="_blank" rel="noopener noreferrer">dimarub2000</a>).</li><li>Implicitly convert primary key to not null in <code>MaterializeMySQL</code> (Same as <code>MySQL</code>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14114" target="_blank" rel="noopener noreferrer">#14114</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14397" target="_blank" rel="noopener noreferrer">#14397</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Replace wide integers (256 bit) from boost multiprecision with implementation from <a href="https://github.com/cerevra/int" target="_blank" rel="noopener noreferrer">https://github.com/cerevra/int</a>. 256bit integers are experimental. <a href="https://github.com/ClickHouse/ClickHouse/pull/14229" target="_blank" rel="noopener noreferrer">#14229</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Add default compression codec for parts in <code>system.part_log</code> with the name <code>default_compression_codec</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14116" target="_blank" rel="noopener noreferrer">#14116</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add precision argument for <code>DateTime</code> type. It allows to use <code>DateTime</code> name instead of <code>DateTime64</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13761" target="_blank" rel="noopener noreferrer">#13761</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Added requirepass authorization for <code>Redis</code> external dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/13688" target="_blank" rel="noopener noreferrer">#13688</a> (<a href="https://github.com/it1804" target="_blank" rel="noopener noreferrer">Ivan Torgashov</a>).</li><li>Improvements in <code>RabbitMQ</code> engine: added connection and channels failure handling, proper commits, insert failures handling, better exchanges, queue durability and queue resume opportunity, new queue settings. Fixed tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/12761" target="_blank" rel="noopener noreferrer">#12761</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Support custom codecs in compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12183" target="_blank" rel="noopener noreferrer">#12183</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-4">Performance Improvement<a class="hash-link" href="#performance-improvement-4" title="Direct link to heading">​</a></h4><ul><li>Optimize queries with LIMIT/LIMIT BY/ORDER BY for distributed with GROUP BY sharding_key (under <code>optimize_skip_unused_shards</code> and <code>optimize_distributed_group_by_sharding_key</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10373" target="_blank" rel="noopener noreferrer">#10373</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Creating sets for multiple <code>JOIN</code> and <code>IN</code> in parallel. It may slightly improve performance for queries with several different <code>IN subquery</code> expressions. <a href="https://github.com/ClickHouse/ClickHouse/pull/14412" target="_blank" rel="noopener noreferrer">#14412</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Improve Kafka engine performance by providing independent thread for each consumer. Separate thread pool for streaming engines (like Kafka). <a href="https://github.com/ClickHouse/ClickHouse/pull/13939" target="_blank" rel="noopener noreferrer">#13939</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-6">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-6" title="Direct link to heading">​</a></h4><ul><li>Lower binary size in debug build by removing debug info from <code>Functions</code>. This is needed only for one internal project in Yandex who is using very old linker. <a href="https://github.com/ClickHouse/ClickHouse/pull/14549" target="_blank" rel="noopener noreferrer">#14549</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Prepare for build with clang 11. <a href="https://github.com/ClickHouse/ClickHouse/pull/14455" target="_blank" rel="noopener noreferrer">#14455</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix the logic in backport script. In previous versions it was triggered for any labels of 100% red color. It was strange. <a href="https://github.com/ClickHouse/ClickHouse/pull/14433" target="_blank" rel="noopener noreferrer">#14433</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Integration tests use default base config. All config changes are explicit with main_configs, user_configs and dictionaries parameters for instance. <a href="https://github.com/ClickHouse/ClickHouse/pull/13647" target="_blank" rel="noopener noreferrer">#13647</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-208">ClickHouse release 20.8<a class="hash-link" href="#clickhouse-release-208" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v208122-lts-2021-01-16">ClickHouse release v20.8.12.2-lts, 2021-01-16<a class="hash-link" href="#clickhouse-release-v208122-lts-2021-01-16" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-16">Bug Fix<a class="hash-link" href="#bug-fix-16" title="Direct link to heading">​</a></h4><ul><li>Fix *If combinator with unary function and Nullable types. <a href="https://github.com/ClickHouse/ClickHouse/pull/18806" target="_blank" rel="noopener noreferrer">#18806</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Restrict merges from wide to compact parts. In case of vertical merge it led to broken result part. <a href="https://github.com/ClickHouse/ClickHouse/pull/18381" target="_blank" rel="noopener noreferrer">#18381</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2081117-lts-2020-12-25">ClickHouse release v20.8.11.17-lts, 2020-12-25<a class="hash-link" href="#clickhouse-release-v2081117-lts-2020-12-25" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-17">Bug Fix<a class="hash-link" href="#bug-fix-17" title="Direct link to heading">​</a></h4><ul><li>Disable write with AIO during merges because it can lead to extremely rare data corruption of primary key columns during merge. <a href="https://github.com/ClickHouse/ClickHouse/pull/18481" target="_blank" rel="noopener noreferrer">#18481</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>value is too short</code> error when executing <code>toType(...)</code> functions (<code>toDate</code>, <code>toUInt32</code>, etc) with argument of type <code>Nullable(String)</code>. Now such functions return <code>NULL</code> on parsing errors instead of throwing exception. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7673" target="_blank" rel="noopener noreferrer">#7673</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18445" target="_blank" rel="noopener noreferrer">#18445</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix possible crashes in aggregate functions with combinator <code>Distinct</code>, while using two-level aggregation. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/17682" target="_blank" rel="noopener noreferrer">#17682</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/18365" target="_blank" rel="noopener noreferrer">#18365</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2081013-lts-2020-12-24">ClickHouse release v20.8.10.13-lts, 2020-12-24<a class="hash-link" href="#clickhouse-release-v2081013-lts-2020-12-24" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-18">Bug Fix<a class="hash-link" href="#bug-fix-18" title="Direct link to heading">​</a></h4><ul><li>When server log rotation was configured using <code>logger.size</code> parameter with numeric value larger than 2^32, the logs were not rotated properly. <a href="https://github.com/ClickHouse/ClickHouse/pull/17905" target="_blank" rel="noopener noreferrer">#17905</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fixed incorrect initialization of <code>max_compress_block_size</code> in MergeTreeWriterSettings with <code>min_compress_block_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17833" target="_blank" rel="noopener noreferrer">#17833</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Fixed problem when ClickHouse fails to resume connection to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/17681" target="_blank" rel="noopener noreferrer">#17681</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Fixed <code>ALTER</code> query hang when the corresponding mutation was killed on the different replica. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16953" target="_blank" rel="noopener noreferrer">#16953</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17499" target="_blank" rel="noopener noreferrer">#17499</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed a bug when mark cache size was underestimated by ClickHouse. It may happen when there are a lot of tiny files with marks. <a href="https://github.com/ClickHouse/ClickHouse/pull/17496" target="_blank" rel="noopener noreferrer">#17496</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>ORDER BY</code> with enabled setting <code>optimize_redundant_functions_in_order_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17471" target="_blank" rel="noopener noreferrer">#17471</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed <code>ColumnConst</code> comparison which leads to crash. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/17088" target="_blank" rel="noopener noreferrer">#17088</a> . <a href="https://github.com/ClickHouse/ClickHouse/pull/17135" target="_blank" rel="noopener noreferrer">#17135</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed bug when <code>ON CLUSTER</code> queries may hang forever for non-leader ReplicatedMergeTreeTables. <a href="https://github.com/ClickHouse/ClickHouse/pull/17089" target="_blank" rel="noopener noreferrer">#17089</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Avoid unnecessary network errors for remote queries which may be cancelled while execution, like queries with <code>LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17006" target="_blank" rel="noopener noreferrer">#17006</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Reresolve the IP of the <code>format_avro_schema_registry_url</code> in case of errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/16985" target="_blank" rel="noopener noreferrer">#16985</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed possible server crash after <code>ALTER TABLE ... MODIFY COLUMN ... NewType</code> when <code>SELECT</code> have <code>WHERE</code> expression on altering column and alter does not finished yet. <a href="https://github.com/ClickHouse/ClickHouse/pull/16968" target="_blank" rel="noopener noreferrer">#16968</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Install script should always create subdirs in config folders. This is only relevant for Docker build with custom config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16936" target="_blank" rel="noopener noreferrer">#16936</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed possible error <code>Illegal type of argument</code> for queries with <code>ORDER BY</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16580" target="_blank" rel="noopener noreferrer">#16580</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16928" target="_blank" rel="noopener noreferrer">#16928</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Abort multipart upload if no data was written to WriteBufferFromS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/16840" target="_blank" rel="noopener noreferrer">#16840</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fixed crash when using <code>any</code> without any arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16803" target="_blank" rel="noopener noreferrer">#16803</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16826" target="_blank" rel="noopener noreferrer">#16826</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed <code>IN</code> operator over several columns and tuples with enabled <code>transform_null_in</code> setting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15310" target="_blank" rel="noopener noreferrer">#15310</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16722" target="_blank" rel="noopener noreferrer">#16722</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed inconsistent behaviour of <code>optimize_read_in_order/optimize_aggregation_in_order</code> with max_threads &gt; 0 and expression in ORDER BY. <a href="https://github.com/ClickHouse/ClickHouse/pull/16637" target="_blank" rel="noopener noreferrer">#16637</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed the issue when query optimization was producing wrong result if query contains <code>ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/17887" target="_blank" rel="noopener noreferrer">#17887</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Query is finished faster in case of exception. Cancel execution on remote replicas if exception happens. <a href="https://github.com/ClickHouse/ClickHouse/pull/15578" target="_blank" rel="noopener noreferrer">#15578</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20866-lts-2020-11-13">ClickHouse release v20.8.6.6-lts, 2020-11-13<a class="hash-link" href="#clickhouse-release-v20866-lts-2020-11-13" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-19">Bug Fix<a class="hash-link" href="#bug-fix-19" title="Direct link to heading">​</a></h4><ul><li>Fix rare silent crashes when query profiler is on and ClickHouse is installed on OS with glibc version that has (supposedly) broken asynchronous unwind tables for some functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15301" target="_blank" rel="noopener noreferrer">#15301</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13098" target="_blank" rel="noopener noreferrer">#13098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16846" target="_blank" rel="noopener noreferrer">#16846</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now when parsing AVRO from input the LowCardinality is removed from type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16188" target="_blank" rel="noopener noreferrer">#16188</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16521" target="_blank" rel="noopener noreferrer">#16521</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Fix rapid growth of metadata when using MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine, and <code>slave_parallel_worker</code> enabled on MySQL Slave, by properly shrinking GTID sets. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15951" target="_blank" rel="noopener noreferrer">#15951</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16504" target="_blank" rel="noopener noreferrer">#16504</a> (<a href="https://github.com/TCeason" target="_blank" rel="noopener noreferrer">TCeason</a>).</li><li>Fix DROP TABLE for Distributed (racy with INSERT). <a href="https://github.com/ClickHouse/ClickHouse/pull/16409" target="_blank" rel="noopener noreferrer">#16409</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix processing of very large entries in replication queue. Very large entries may appear in ALTER queries if table structure is extremely large (near 1 MB). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16307" target="_blank" rel="noopener noreferrer">#16307</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16332" target="_blank" rel="noopener noreferrer">#16332</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the inconsistent behaviour when a part of return data could be dropped because the set for its filtration wasn&#x27;t created. <a href="https://github.com/ClickHouse/ClickHouse/pull/16308" target="_blank" rel="noopener noreferrer">#16308</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix bug with MySQL database. When MySQL server used as database engine is down some queries raise Exception, because they try to get tables from disabled server, while it&#x27;s unnecessary. For example, query <code>SELECT ... FROM system.parts</code> should work only with MergeTree tables and don&#x27;t touch MySQL database at all. <a href="https://github.com/ClickHouse/ClickHouse/pull/16032" target="_blank" rel="noopener noreferrer">#16032</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v208545-lts-2020-10-29">ClickHouse release v20.8.5.45-lts, 2020-10-29<a class="hash-link" href="#clickhouse-release-v208545-lts-2020-10-29" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-20">Bug Fix<a class="hash-link" href="#bug-fix-20" title="Direct link to heading">​</a></h4><ul><li>Fix double free in case of exception in function <code>dictGet</code>. It could have happened if dictionary was loaded with error. <a href="https://github.com/ClickHouse/ClickHouse/pull/16429" target="_blank" rel="noopener noreferrer">#16429</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix group by with totals/rollup/cube modifers and min/max functions over group by keys. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/16393" target="_blank" rel="noopener noreferrer">#16393</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16397" target="_blank" rel="noopener noreferrer">#16397</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix async Distributed INSERT w/ prefer_localhost_replica=0 and internal_replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/16358" target="_blank" rel="noopener noreferrer">#16358</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix a possible memory leak during <code>GROUP BY</code> with string keys, caused by an error in <code>TwoLevelStringHashTable</code> implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/16264" target="_blank" rel="noopener noreferrer">#16264</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix the case when memory can be overallocated regardless to the limit. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14560" target="_blank" rel="noopener noreferrer">#14560</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16206" target="_blank" rel="noopener noreferrer">#16206</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>ALTER MODIFY ... ORDER BY</code> query hang for <code>ReplicatedVersionedCollapsingMergeTree</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15980" target="_blank" rel="noopener noreferrer">#15980</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/16011" target="_blank" rel="noopener noreferrer">#16011</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix collate name &amp; charset name parser and support <code>length = 0</code> for string type. <a href="https://github.com/ClickHouse/ClickHouse/pull/16008" target="_blank" rel="noopener noreferrer">#16008</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Allow to use direct layout for dictionaries with complex keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/16007" target="_blank" rel="noopener noreferrer">#16007</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Prevent replica hang for 5-10 mins when replication error happens after a period of inactivity. <a href="https://github.com/ClickHouse/ClickHouse/pull/15987" target="_blank" rel="noopener noreferrer">#15987</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix rare segfaults when inserting into or selecting from MaterializedView and concurrently dropping target table (for Atomic database engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/15984" target="_blank" rel="noopener noreferrer">#15984</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix ambiguity in parsing of settings profiles: <code>CREATE USER ... SETTINGS profile readonly</code> is now considered as using a profile named <code>readonly</code>, not a setting named <code>profile</code> with the readonly constraint. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15628" target="_blank" rel="noopener noreferrer">#15628</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15982" target="_blank" rel="noopener noreferrer">#15982</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix a crash when database creation fails. <a href="https://github.com/ClickHouse/ClickHouse/pull/15954" target="_blank" rel="noopener noreferrer">#15954</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <code>DROP TABLE IF EXISTS</code> failure with <code>Table ... does not exist</code> error when table is concurrently renamed (for Atomic database engine). Fixed rare deadlock when concurrently executing some DDL queries with multiple tables (like <code>DROP DATABASE</code> and <code>RENAME TABLE</code>) Fixed <code>DROP/DETACH DATABASE</code> failure with <code>Table ... does not exist</code> when concurrently executing <code>DROP/DETACH TABLE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15934" target="_blank" rel="noopener noreferrer">#15934</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix incorrect empty result for query from <code>Distributed</code> table if query has <code>WHERE</code>, <code>PREWHERE</code> and <code>GLOBAL IN</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15792" target="_blank" rel="noopener noreferrer">#15792</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15933" target="_blank" rel="noopener noreferrer">#15933</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix possible deadlocks in RBAC. <a href="https://github.com/ClickHouse/ClickHouse/pull/15875" target="_blank" rel="noopener noreferrer">#15875</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix exception <code>Block structure mismatch</code> in <code>SELECT ... ORDER BY DESC</code> queries which were executed after <code>ALTER MODIFY COLUMN</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15800" target="_blank" rel="noopener noreferrer">#15800</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15852" target="_blank" rel="noopener noreferrer">#15852</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix some cases of queries, in which only virtual columns are selected. Previously <code>Not found column _nothing in block</code> exception may be thrown. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12298" target="_blank" rel="noopener noreferrer">#12298</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15756" target="_blank" rel="noopener noreferrer">#15756</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix error <code>Cannot find column</code> which may happen at insertion into <code>MATERIALIZED VIEW</code> in case if query for <code>MV</code> containes <code>ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15717" target="_blank" rel="noopener noreferrer">#15717</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed too low default value of <code>max_replicated_logs_to_keep</code> setting, which might cause replicas to become lost too often. Improve lost replica recovery process by choosing the most up-to-date replica to clone. Also do not remove old parts from lost replica, detach them instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/15701" target="_blank" rel="noopener noreferrer">#15701</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix error <code>Cannot add simple transform to empty Pipe</code> which happened while reading from <code>Buffer</code> table which has different structure than destination table. It was possible if destination table returned empty result for query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15529" target="_blank" rel="noopener noreferrer">#15529</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15662" target="_blank" rel="noopener noreferrer">#15662</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed bug with globs in S3 table function, region from URL was not applied to S3 client configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/15646" target="_blank" rel="noopener noreferrer">#15646</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Decrement the <code>ReadonlyReplica</code> metric when detaching read-only tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15598" target="_blank" rel="noopener noreferrer">#15598</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15592" target="_blank" rel="noopener noreferrer">#15592</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Throw an error when a single parameter is passed to ReplicatedMergeTree instead of ignoring it. <a href="https://github.com/ClickHouse/ClickHouse/pull/15516" target="_blank" rel="noopener noreferrer">#15516</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-9">Improvement<a class="hash-link" href="#improvement-9" title="Direct link to heading">​</a></h4><ul><li>Now it&#x27;s allowed to execute <code>ALTER ... ON CLUSTER</code> queries regardless of the <code>&lt;internal_replication&gt;</code> setting in cluster config. <a href="https://github.com/ClickHouse/ClickHouse/pull/16075" target="_blank" rel="noopener noreferrer">#16075</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Unfold <code>{database}</code>, <code>{table}</code> and <code>{uuid}</code> macros in <code>ReplicatedMergeTree</code> arguments on table creation. <a href="https://github.com/ClickHouse/ClickHouse/pull/16159" target="_blank" rel="noopener noreferrer">#16159</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v208411-lts-2020-10-09">ClickHouse release v20.8.4.11-lts, 2020-10-09<a class="hash-link" href="#clickhouse-release-v208411-lts-2020-10-09" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-21">Bug Fix<a class="hash-link" href="#bug-fix-21" title="Direct link to heading">​</a></h4><ul><li>Fix the order of destruction for resources in <code>ReadFromStorage</code> step of query plan. It might cause crashes in rare cases. Possibly connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/15610" target="_blank" rel="noopener noreferrer">#15610</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15645" target="_blank" rel="noopener noreferrer">#15645</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed <code>Element ... is not a constant expression</code> error when using <code>JSON*</code> function result in <code>VALUES</code>, <code>LIMIT</code> or right side of <code>IN</code> operator. <a href="https://github.com/ClickHouse/ClickHouse/pull/15589" target="_blank" rel="noopener noreferrer">#15589</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Prevent the possibility of error message <code>Could not calculate available disk space (statvfs), errno: 4, strerror: Interrupted system call</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15541" target="_blank" rel="noopener noreferrer">#15541</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15557" target="_blank" rel="noopener noreferrer">#15557</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Significantly reduce memory usage in AggregatingInOrderTransform/optimize_aggregation_in_order. <a href="https://github.com/ClickHouse/ClickHouse/pull/15543" target="_blank" rel="noopener noreferrer">#15543</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Mutation might hang waiting for some non-existent part after <code>MOVE</code> or <code>REPLACE PARTITION</code> or, in rare cases, after <code>DETACH</code> or <code>DROP PARTITION</code>. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" target="_blank" rel="noopener noreferrer">#15537</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix bug when <code>ILIKE</code> operator stops being case insensitive if <code>LIKE</code> with the same pattern was executed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15536" target="_blank" rel="noopener noreferrer">#15536</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix <code>Missing columns</code> errors when selecting columns which absent in data, but depend on other columns which also absent in data. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15530" target="_blank" rel="noopener noreferrer">#15530</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15532" target="_blank" rel="noopener noreferrer">#15532</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug with event subscription in DDLWorker which rarely may lead to query hangs in <code>ON CLUSTER</code>. Introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/13450" target="_blank" rel="noopener noreferrer">#13450</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15477" target="_blank" rel="noopener noreferrer">#15477</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Report proper error when the second argument of <code>boundingRatio</code> aggregate function has a wrong type. <a href="https://github.com/ClickHouse/ClickHouse/pull/15407" target="_blank" rel="noopener noreferrer">#15407</a> (<a href="https://github.com/detailyang" target="_blank" rel="noopener noreferrer">detailyang</a>).</li><li>Fix race condition during MergeTree table rename and background cleanup. <a href="https://github.com/ClickHouse/ClickHouse/pull/15304" target="_blank" rel="noopener noreferrer">#15304</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix rare race condition on server startup when system.logs are enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/15300" target="_blank" rel="noopener noreferrer">#15300</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix MSan report in QueryLog. Uninitialized memory can be used for the field <code>memory_usage</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15258" target="_blank" rel="noopener noreferrer">#15258</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix instance crash when using joinGet with LowCardinality types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15214" target="_blank" rel="noopener noreferrer">#15214</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15220" target="_blank" rel="noopener noreferrer">#15220</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix bug in table engine <code>Buffer</code> which does not allow to insert data of new structure into <code>Buffer</code> after <code>ALTER</code> query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15117" target="_blank" rel="noopener noreferrer">#15117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15192" target="_blank" rel="noopener noreferrer">#15192</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Adjust decimals field size in mysql column definition packet. <a href="https://github.com/ClickHouse/ClickHouse/pull/15152" target="_blank" rel="noopener noreferrer">#15152</a> (<a href="https://github.com/maqroll" target="_blank" rel="noopener noreferrer">maqroll</a>).</li><li>We already use padded comparison between String and FixedString (<a href="https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333</a>). This PR applies the same logic to field comparison which corrects the usage of FixedString as primary keys. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14908" target="_blank" rel="noopener noreferrer">#14908</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15033" target="_blank" rel="noopener noreferrer">#15033</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>If function <code>bar</code> was called with specifically crafted arguments, buffer overflow was possible. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13926" target="_blank" rel="noopener noreferrer">#13926</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15028" target="_blank" rel="noopener noreferrer">#15028</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>Cannot rename ... errno: 22, strerror: Invalid argument</code> error on DDL query execution in Atomic database when running clickhouse-server in docker on Mac OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/15024" target="_blank" rel="noopener noreferrer">#15024</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Now settings <code>number_of_free_entries_in_pool_to_execute_mutation</code> and <code>number_of_free_entries_in_pool_to_lower_max_size_of_merge</code> can be equal to <code>background_pool_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14975" target="_blank" rel="noopener noreferrer">#14975</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix to make predicate push down work when subquery contains finalizeAggregation function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14847" target="_blank" rel="noopener noreferrer">#14847</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14937" target="_blank" rel="noopener noreferrer">#14937</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Publish CPU frequencies per logical core in <code>system.asynchronous_metrics</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14923" target="_blank" rel="noopener noreferrer">#14923</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14924" target="_blank" rel="noopener noreferrer">#14924</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fixed <code>.metadata.tmp File exists</code> error when using <code>MaterializeMySQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14898" target="_blank" rel="noopener noreferrer">#14898</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix a problem where the server may get stuck on startup while talking to ZooKeeper, if the configuration files have to be fetched from ZK (using the <code>from_zk</code> include option). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14814" target="_blank" rel="noopener noreferrer">#14814</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14843" target="_blank" rel="noopener noreferrer">#14843</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fix wrong monotonicity detection for shrunk <code>Int -&gt; Int</code> cast of signed types. It might lead to incorrect query result. This bug is unveiled in <a href="https://github.com/ClickHouse/ClickHouse/issues/14513" target="_blank" rel="noopener noreferrer">#14513</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14783" target="_blank" rel="noopener noreferrer">#14783</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fixed the incorrect sorting order of <code>Nullable</code> column. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14344" target="_blank" rel="noopener noreferrer">#14344</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14495" target="_blank" rel="noopener noreferrer">#14495</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-10">Improvement<a class="hash-link" href="#improvement-10" title="Direct link to heading">​</a></h4><ul><li>Now it&#x27;s possible to change the type of version column for <code>VersionedCollapsingMergeTree</code> with <code>ALTER</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/15442" target="_blank" rel="noopener noreferrer">#15442</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v208318-stable-2020-09-18">ClickHouse release v20.8.3.18-stable, 2020-09-18<a class="hash-link" href="#clickhouse-release-v208318-stable-2020-09-18" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-22">Bug Fix<a class="hash-link" href="#bug-fix-22" title="Direct link to heading">​</a></h4><ul><li>Fix the issue when some invocations of <code>extractAllGroups</code> function may trigger &quot;Memory limit exceeded&quot; error. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13383" target="_blank" rel="noopener noreferrer">#13383</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14889" target="_blank" rel="noopener noreferrer">#14889</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix SIGSEGV for an attempt to INSERT into StorageFile(fd). <a href="https://github.com/ClickHouse/ClickHouse/pull/14887" target="_blank" rel="noopener noreferrer">#14887</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix rare error in <code>SELECT</code> queries when the queried column has <code>DEFAULT</code> expression which depends on the other column which also has <code>DEFAULT</code> and not present in select query and not exists on disk. Partially fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14531" target="_blank" rel="noopener noreferrer">#14531</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14845" target="_blank" rel="noopener noreferrer">#14845</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed missed default database name in metadata of materialized view when executing <code>ALTER ... MODIFY QUERY</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14664" target="_blank" rel="noopener noreferrer">#14664</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix bug when <code>ALTER UPDATE</code> mutation with Nullable column in assignment expression and constant value (like <code>UPDATE x = 42</code>) leads to incorrect value in column or segfault. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13634" target="_blank" rel="noopener noreferrer">#13634</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/14045" target="_blank" rel="noopener noreferrer">#14045</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14646" target="_blank" rel="noopener noreferrer">#14646</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix wrong Decimal multiplication result caused wrong decimal scale of result column. <a href="https://github.com/ClickHouse/ClickHouse/pull/14603" target="_blank" rel="noopener noreferrer">#14603</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Added the checker as neither calling <code>lc-&gt;isNullable()</code> nor calling <code>ls-&gt;getDictionaryPtr()-&gt;isNullable()</code> would return the correct result. <a href="https://github.com/ClickHouse/ClickHouse/pull/14591" target="_blank" rel="noopener noreferrer">#14591</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">myrrc</a>).</li><li>Cleanup data directory after Zookeeper exceptions during CreateQuery for StorageReplicatedMergeTree Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/14563" target="_blank" rel="noopener noreferrer">#14563</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix rare segfaults in functions with combinator -Resample, which could appear in result of overflow with very large parameters. <a href="https://github.com/ClickHouse/ClickHouse/pull/14562" target="_blank" rel="noopener noreferrer">#14562</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-11">Improvement<a class="hash-link" href="#improvement-11" title="Direct link to heading">​</a></h4><ul><li>Speed up server shutdown process if there are ongoing S3 requests. <a href="https://github.com/ClickHouse/ClickHouse/pull/14858" target="_blank" rel="noopener noreferrer">#14858</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Allow using multi-volume storage configuration in storage Distributed. <a href="https://github.com/ClickHouse/ClickHouse/pull/14839" target="_blank" rel="noopener noreferrer">#14839</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Speed up server shutdown process if there are ongoing S3 requests. <a href="https://github.com/ClickHouse/ClickHouse/pull/14496" target="_blank" rel="noopener noreferrer">#14496</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Support custom codecs in compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12183" target="_blank" rel="noopener noreferrer">#12183</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20823-stable-2020-09-08">ClickHouse release v20.8.2.3-stable, 2020-09-08<a class="hash-link" href="#clickhouse-release-v20823-stable-2020-09-08" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-4">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-4" title="Direct link to heading">​</a></h4><ul><li>Now <code>OPTIMIZE FINAL</code> query does not recalculate TTL for parts that were added before TTL was created. Use <code>ALTER TABLE ... MATERIALIZE TTL</code> once to calculate them, after that <code>OPTIMIZE FINAL</code> will evaluate TTL&#x27;s properly. This behavior never worked for replicated tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/14220" target="_blank" rel="noopener noreferrer">#14220</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Extend <code>parallel_distributed_insert_select</code> setting, adding an option to run <code>INSERT</code> into local table. The setting changes type from <code>Bool</code> to <code>UInt64</code>, so the values <code>false</code> and <code>true</code> are no longer supported. If you have these values in server configuration, the server will not start. Please replace them with <code>0</code> and <code>1</code>, respectively. <a href="https://github.com/ClickHouse/ClickHouse/pull/14060" target="_blank" rel="noopener noreferrer">#14060</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Remove support for the <code>ODBCDriver</code> input/output format. This was a deprecated format once used for communication with the ClickHouse ODBC driver, now long superseded by the <code>ODBCDriver2</code> format. Resolves <a href="https://github.com/ClickHouse/ClickHouse/issues/13629" target="_blank" rel="noopener noreferrer">#13629</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13847" target="_blank" rel="noopener noreferrer">#13847</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code>Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-4">New Feature<a class="hash-link" href="#new-feature-4" title="Direct link to heading">​</a></h4><ul><li>Add the ability to specify <code>Default</code> compression codec for columns that correspond to settings specified in <code>config.xml</code>. Implements: <a href="https://github.com/ClickHouse/ClickHouse/issues/9074" target="_blank" rel="noopener noreferrer">#9074</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14049" target="_blank" rel="noopener noreferrer">#14049</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Support Kerberos authentication in Kafka, using <code>krb5</code> and <code>cyrus-sasl</code> libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/12771" target="_blank" rel="noopener noreferrer">#12771</a> (<a href="https://github.com/ilejn" target="_blank" rel="noopener noreferrer">Ilya Golshtein</a>).</li><li>Add function <code>normalizeQuery</code> that replaces literals, sequences of literals and complex aliases with placeholders. Add function <code>normalizedQueryHash</code> that returns identical 64bit hash values for similar queries. It helps to analyze query log. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11271" target="_blank" rel="noopener noreferrer">#11271</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13816" target="_blank" rel="noopener noreferrer">#13816</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add <code>time_zones</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/13880" target="_blank" rel="noopener noreferrer">#13880</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Add function <code>defaultValueOfTypeName</code> that returns the default value for a given type. <a href="https://github.com/ClickHouse/ClickHouse/pull/13877" target="_blank" rel="noopener noreferrer">#13877</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Add <code>countDigits(x)</code> function that count number of decimal digits in integer or decimal column. Add <code>isDecimalOverflow(d, [p])</code> function that checks if the value in Decimal column is out of its (or specified) precision. <a href="https://github.com/ClickHouse/ClickHouse/pull/14151" target="_blank" rel="noopener noreferrer">#14151</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Add <code>quantileExactLow</code> and <code>quantileExactHigh</code> implementations with respective aliases for <code>medianExactLow</code> and <code>medianExactHigh</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13818" target="_blank" rel="noopener noreferrer">#13818</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Added <code>date_trunc</code> function that truncates a date/time value to a specified date/time part. <a href="https://github.com/ClickHouse/ClickHouse/pull/13888" target="_blank" rel="noopener noreferrer">#13888</a> (<a href="https://github.com/vladimir-golovchenko" target="_blank" rel="noopener noreferrer">Vladimir Golovchenko</a>).</li><li>Add new optional section <code>&lt;user_directories&gt;</code> to the main config. <a href="https://github.com/ClickHouse/ClickHouse/pull/13425" target="_blank" rel="noopener noreferrer">#13425</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Add <code>ALTER SAMPLE BY</code> statement that allows to change table sample clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/13280" target="_blank" rel="noopener noreferrer">#13280</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Function <code>position</code> now supports optional <code>start_pos</code> argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/13237" target="_blank" rel="noopener noreferrer">#13237</a> (<a href="https://github.com/vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-23">Bug Fix<a class="hash-link" href="#bug-fix-23" title="Direct link to heading">​</a></h4><ul><li>Fix visible data clobbering by progress bar in client in interactive mode. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12562" target="_blank" rel="noopener noreferrer">#12562</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/13369" target="_blank" rel="noopener noreferrer">#13369</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/13584" target="_blank" rel="noopener noreferrer">#13584</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12964" target="_blank" rel="noopener noreferrer">#12964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13691" target="_blank" rel="noopener noreferrer">#13691</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed incorrect sorting order if <code>LowCardinality</code> column when sorting by multiple columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13958" target="_blank" rel="noopener noreferrer">#13958</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14223" target="_blank" rel="noopener noreferrer">#14223</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Check for array size overflow in <code>topK</code> aggregate function. Without this check the user may send a query with carefully crafted parameters that will lead to server crash. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14452" target="_blank" rel="noopener noreferrer">#14452</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14467" target="_blank" rel="noopener noreferrer">#14467</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bug which can lead to wrong merges assignment if table has partitions with a single part. <a href="https://github.com/ClickHouse/ClickHouse/pull/14444" target="_blank" rel="noopener noreferrer">#14444</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Stop query execution if exception happened in <code>PipelineExecutor</code> itself. This could prevent rare possible query hung. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/14334" target="_blank" rel="noopener noreferrer">#14334</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14402" target="_blank" rel="noopener noreferrer">#14402</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/14334" target="_blank" rel="noopener noreferrer">#14334</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix crash during <code>ALTER</code> query for table which was created <code>AS table_function</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14212" target="_blank" rel="noopener noreferrer">#14212</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14326" target="_blank" rel="noopener noreferrer">#14326</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix exception during ALTER LIVE VIEW query with REFRESH command. Live view is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/14320" target="_blank" rel="noopener noreferrer">#14320</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Fix QueryPlan lifetime (for EXPLAIN PIPELINE graph=1) for queries with nested interpreter. <a href="https://github.com/ClickHouse/ClickHouse/pull/14315" target="_blank" rel="noopener noreferrer">#14315</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix segfault in <code>clickhouse-odbc-bridge</code> during schema fetch from some external sources. This PR fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13861" target="_blank" rel="noopener noreferrer">#13861</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14267" target="_blank" rel="noopener noreferrer">#14267</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix crash in mark inclusion search introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/12277" target="_blank" rel="noopener noreferrer">#12277</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14225" target="_blank" rel="noopener noreferrer">#14225</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix creation of tables with named tuples. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13027" target="_blank" rel="noopener noreferrer">#13027</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14143" target="_blank" rel="noopener noreferrer">#14143</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix formatting of minimal negative decimal numbers. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14111" target="_blank" rel="noopener noreferrer">#14111</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14119" target="_blank" rel="noopener noreferrer">#14119</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fix <code>DistributedFilesToInsert</code> metric (zeroed when it should not). <a href="https://github.com/ClickHouse/ClickHouse/pull/14095" target="_blank" rel="noopener noreferrer">#14095</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>pointInPolygon</code> with const 2d array as polygon. <a href="https://github.com/ClickHouse/ClickHouse/pull/14079" target="_blank" rel="noopener noreferrer">#14079</a> (<a href="https://github.com/livace" target="_blank" rel="noopener noreferrer">Alexey Ilyukhov</a>).</li><li>Fixed wrong mount point in extra info for <code>Poco::Exception: no space left on device</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14050" target="_blank" rel="noopener noreferrer">#14050</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix GRANT ALL statement when executed on a non-global level. <a href="https://github.com/ClickHouse/ClickHouse/pull/13987" target="_blank" rel="noopener noreferrer">#13987</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix parser to reject create table as table function with engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/13940" target="_blank" rel="noopener noreferrer">#13940</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Fix wrong results in select queries with <code>DISTINCT</code> keyword and subqueries with UNION ALL in case <code>optimize_duplicate_order_by_and_distinct</code> setting is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/13925" target="_blank" rel="noopener noreferrer">#13925</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fixed potential deadlock when renaming <code>Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/13922" target="_blank" rel="noopener noreferrer">#13922</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix incorrect sorting for <code>FixedString</code> columns when sorting by multiple columns. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13182" target="_blank" rel="noopener noreferrer">#13182</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13887" target="_blank" rel="noopener noreferrer">#13887</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix potentially imprecise result of <code>topK</code>/<code>topKWeighted</code> merge (with non-default parameters). <a href="https://github.com/ClickHouse/ClickHouse/pull/13817" target="_blank" rel="noopener noreferrer">#13817</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix reading from MergeTree table with INDEX of type SET fails when comparing against NULL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13686" target="_blank" rel="noopener noreferrer">#13686</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13793" target="_blank" rel="noopener noreferrer">#13793</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix <code>arrayJoin</code> capturing in lambda (LOGICAL_ERROR). <a href="https://github.com/ClickHouse/ClickHouse/pull/13792" target="_blank" rel="noopener noreferrer">#13792</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add step overflow check in function <code>range</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13790" target="_blank" rel="noopener noreferrer">#13790</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <code>Directory not empty</code> error when concurrently executing <code>DROP DATABASE</code> and <code>CREATE TABLE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13756" target="_blank" rel="noopener noreferrer">#13756</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add range check for <code>h3KRing</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13633" target="_blank" rel="noopener noreferrer">#13633</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13752" target="_blank" rel="noopener noreferrer">#13752</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix race condition between DETACH and background merges. Parts may revive after detach. This is continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/8602" target="_blank" rel="noopener noreferrer">#8602</a> that did not fix the issue but introduced a test that started to fail in very rare cases, demonstrating the issue. <a href="https://github.com/ClickHouse/ClickHouse/pull/13746" target="_blank" rel="noopener noreferrer">#13746</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix logging Settings.Names/Values when log_queries_min_type &gt; QUERY_START. <a href="https://github.com/ClickHouse/ClickHouse/pull/13737" target="_blank" rel="noopener noreferrer">#13737</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixes <code>/replicas_status</code> endpoint response status code when verbose=1. <a href="https://github.com/ClickHouse/ClickHouse/pull/13722" target="_blank" rel="noopener noreferrer">#13722</a> (<a href="https://github.com/javisantana" target="_blank" rel="noopener noreferrer">javi santana</a>).</li><li>Fix incorrect message in <code>clickhouse-server.init</code> while checking user and group. <a href="https://github.com/ClickHouse/ClickHouse/pull/13711" target="_blank" rel="noopener noreferrer">#13711</a> (<a href="https://github.com/ylchou" target="_blank" rel="noopener noreferrer">ylchou</a>).</li><li>Do not optimize any(arrayJoin()) -&gt; arrayJoin() under <code>optimize_move_functions_out_of_any</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/13681" target="_blank" rel="noopener noreferrer">#13681</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix crash in JOIN with StorageMerge and <code>set enable_optimize_predicate_expression=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13679" target="_blank" rel="noopener noreferrer">#13679</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix typo in error message about <code>The value of &#x27;number_of_free_entries_in_pool_to_lower_max_size_of_merge&#x27; setting</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13678" target="_blank" rel="noopener noreferrer">#13678</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Concurrent <code>ALTER ... REPLACE/MOVE PARTITION ...</code> queries might cause deadlock. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/13626" target="_blank" rel="noopener noreferrer">#13626</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed the behaviour when sometimes cache-dictionary returned default value instead of present value from source. <a href="https://github.com/ClickHouse/ClickHouse/pull/13624" target="_blank" rel="noopener noreferrer">#13624</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix secondary indices corruption in compact parts. Compact parts are experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13538" target="_blank" rel="noopener noreferrer">#13538</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix premature <code>ON CLUSTER</code> timeouts for queries that must be executed on a single replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6704" target="_blank" rel="noopener noreferrer">#6704</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7228" target="_blank" rel="noopener noreferrer">#7228</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/13361" target="_blank" rel="noopener noreferrer">#13361</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11884" target="_blank" rel="noopener noreferrer">#11884</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13450" target="_blank" rel="noopener noreferrer">#13450</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix wrong code in function <code>netloc</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13335" target="_blank" rel="noopener noreferrer">#13335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13446" target="_blank" rel="noopener noreferrer">#13446</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix possible race in <code>StorageMemory</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13416" target="_blank" rel="noopener noreferrer">#13416</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix missing or excessive headers in <code>TSV/CSVWithNames</code> formats in HTTP protocol. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12504" target="_blank" rel="noopener noreferrer">#12504</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13343" target="_blank" rel="noopener noreferrer">#13343</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix parsing row policies from users.xml when names of databases or tables contain dots. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5779" target="_blank" rel="noopener noreferrer">#5779</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12527" target="_blank" rel="noopener noreferrer">#12527</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13199" target="_blank" rel="noopener noreferrer">#13199</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix access to <code>redis</code> dictionary after connection was dropped once. It may happen with <code>cache</code> and <code>direct</code> dictionary layouts. <a href="https://github.com/ClickHouse/ClickHouse/pull/13082" target="_blank" rel="noopener noreferrer">#13082</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Removed wrong auth access check when using ClickHouseDictionarySource to query remote tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/12756" target="_blank" rel="noopener noreferrer">#12756</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Properly distinguish subqueries in some cases for common subexpression elimination. <a href="https://github.com/ClickHouse/ClickHouse/issues/8333" target="_blank" rel="noopener noreferrer">#8333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8367" target="_blank" rel="noopener noreferrer">#8367</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-12">Improvement<a class="hash-link" href="#improvement-12" title="Direct link to heading">​</a></h4><ul><li>Disallows <code>CODEC</code> on <code>ALIAS</code> column type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13911" target="_blank" rel="noopener noreferrer">#13911</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14263" target="_blank" rel="noopener noreferrer">#14263</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>When waiting for a dictionary update to complete, use the timeout specified by <code>query_wait_timeout_milliseconds</code> setting instead of a hard-coded value. <a href="https://github.com/ClickHouse/ClickHouse/pull/14105" target="_blank" rel="noopener noreferrer">#14105</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Add setting <code>min_index_granularity_bytes</code> that protects against accidentally creating a table with very low <code>index_granularity_bytes</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/14139" target="_blank" rel="noopener noreferrer">#14139</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Now it&#x27;s possible to fetch partitions from clusters that use different ZooKeeper: <code>ALTER TABLE table_name FETCH PARTITION partition_expr FROM &#x27;zk-name:/path-in-zookeeper&#x27;</code>. It&#x27;s useful for shipping data to new clusters. <a href="https://github.com/ClickHouse/ClickHouse/pull/14155" target="_blank" rel="noopener noreferrer">#14155</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Slightly better performance of Memory table if it was constructed from a huge number of very small blocks (that&#x27;s unlikely). Author of the idea: <a href="https://github.com/markpapadakis" target="_blank" rel="noopener noreferrer">Mark Papadakis</a>. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14043" target="_blank" rel="noopener noreferrer">#14043</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14056" target="_blank" rel="noopener noreferrer">#14056</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Conditional aggregate functions (for example: <code>avgIf</code>, <code>sumIf</code>, <code>maxIf</code>) should return <code>NULL</code> when miss rows and use nullable arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/13964" target="_blank" rel="noopener noreferrer">#13964</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Increase limit in -Resample combinator to 1M. <a href="https://github.com/ClickHouse/ClickHouse/pull/13947" target="_blank" rel="noopener noreferrer">#13947</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>).</li><li>Corrected an error in AvroConfluent format that caused the Kafka table engine to stop processing messages when an abnormally small, malformed, message was received. <a href="https://github.com/ClickHouse/ClickHouse/pull/13941" target="_blank" rel="noopener noreferrer">#13941</a> (<a href="https://github.com/gervarela" target="_blank" rel="noopener noreferrer">Gervasio Varela</a>).</li><li>Fix wrong error for long queries. It was possible to get syntax error other than <code>Max query size exceeded</code> for correct query. <a href="https://github.com/ClickHouse/ClickHouse/pull/13928" target="_blank" rel="noopener noreferrer">#13928</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Better error message for null value of <code>TabSeparated</code> format. <a href="https://github.com/ClickHouse/ClickHouse/pull/13906" target="_blank" rel="noopener noreferrer">#13906</a> (<a href="https://github.com/tomjiang1987" target="_blank" rel="noopener noreferrer">jiang tao</a>).</li><li>Function <code>arrayCompact</code> will compare NaNs bitwise if the type of array elements is Float32/Float64. In previous versions NaNs were always not equal if the type of array elements is Float32/Float64 and were always equal if the type is more complex, like Nullable(Float64). This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13857" target="_blank" rel="noopener noreferrer">#13857</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13868" target="_blank" rel="noopener noreferrer">#13868</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix data race in <code>lgamma</code> function. This race was caught only in <code>tsan</code>, no side effects a really happened. <a href="https://github.com/ClickHouse/ClickHouse/pull/13842" target="_blank" rel="noopener noreferrer">#13842</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Avoid too slow queries when arrays are manipulated as fields. Throw exception instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/13753" target="_blank" rel="noopener noreferrer">#13753</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added Redis requirepass authorization (for redis dictionary source). <a href="https://github.com/ClickHouse/ClickHouse/pull/13688" target="_blank" rel="noopener noreferrer">#13688</a> (<a href="https://github.com/it1804" target="_blank" rel="noopener noreferrer">Ivan Torgashov</a>).</li><li>Add MergeTree Write-Ahead-Log (WAL) dump tool. WAL is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13640" target="_blank" rel="noopener noreferrer">#13640</a> (<a href="https://github.com/BohuTANG" target="_blank" rel="noopener noreferrer">BohuTANG</a>).</li><li>In previous versions <code>lcm</code> function may produce assertion violation in debug build if called with specifically crafted arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13368" target="_blank" rel="noopener noreferrer">#13368</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13510" target="_blank" rel="noopener noreferrer">#13510</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Provide monotonicity for <code>toDate/toDateTime</code> functions in more cases. Monotonicity information is used for index analysis (more complex queries will be able to use index). Now the input arguments are saturated more naturally and provides better monotonicity. <a href="https://github.com/ClickHouse/ClickHouse/pull/13497" target="_blank" rel="noopener noreferrer">#13497</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Support compound identifiers for custom settings. Custom settings is an integration point of ClickHouse codebase with other codebases (no benefits for ClickHouse itself) <a href="https://github.com/ClickHouse/ClickHouse/pull/13496" target="_blank" rel="noopener noreferrer">#13496</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Move parts from DiskLocal to DiskS3 in parallel. <code>DiskS3</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13459" target="_blank" rel="noopener noreferrer">#13459</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Enable mixed granularity parts by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/13449" target="_blank" rel="noopener noreferrer">#13449</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Proper remote host checking in S3 redirects (security-related thing). <a href="https://github.com/ClickHouse/ClickHouse/pull/13404" target="_blank" rel="noopener noreferrer">#13404</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Add <code>QueryTimeMicroseconds</code>, <code>SelectQueryTimeMicroseconds</code> and <code>InsertQueryTimeMicroseconds</code> to system.events. <a href="https://github.com/ClickHouse/ClickHouse/pull/13336" target="_blank" rel="noopener noreferrer">#13336</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Fix debug assertion when Decimal has too large negative exponent. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13188" target="_blank" rel="noopener noreferrer">#13188</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13228" target="_blank" rel="noopener noreferrer">#13228</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added cache layer for DiskS3 (cache to local disk mark and index files). <code>DiskS3</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13076" target="_blank" rel="noopener noreferrer">#13076</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fix readline so it dumps history to file now. <a href="https://github.com/ClickHouse/ClickHouse/pull/13600" target="_blank" rel="noopener noreferrer">#13600</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Create <code>system</code> database with <code>Atomic</code> engine by default (a preparation to enable <code>Atomic</code> database engine by default everywhere). <a href="https://github.com/ClickHouse/ClickHouse/pull/13680" target="_blank" rel="noopener noreferrer">#13680</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-5">Performance Improvement<a class="hash-link" href="#performance-improvement-5" title="Direct link to heading">​</a></h4><ul><li>Slightly optimize very short queries with <code>LowCardinality</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14129" target="_blank" rel="noopener noreferrer">#14129</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Enable parallel INSERTs for table engines <code>Null</code>, <code>Memory</code>, <code>Distributed</code> and <code>Buffer</code> when the setting <code>max_insert_threads</code> is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/14120" target="_blank" rel="noopener noreferrer">#14120</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fail fast if <code>max_rows_to_read</code> limit is exceeded on parts scan. The motivation behind this change is to skip ranges scan for all selected parts if it is clear that <code>max_rows_to_read</code> is already exceeded. The change is quite noticeable for queries over big number of parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/13677" target="_blank" rel="noopener noreferrer">#13677</a> (<a href="https://github.com/hagen1778" target="_blank" rel="noopener noreferrer">Roman Khavronenko</a>).</li><li>Slightly improve performance of aggregation by UInt8/UInt16 keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/13099" target="_blank" rel="noopener noreferrer">#13099</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Optimize <code>has()</code>, <code>indexOf()</code> and <code>countEqual()</code> functions for <code>Array(LowCardinality(T))</code> and constant right arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12550" target="_blank" rel="noopener noreferrer">#12550</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">myrrc</a>).</li><li>When performing trivial <code>INSERT SELECT</code> queries, automatically set <code>max_threads</code> to 1 or <code>max_insert_threads</code>, and set <code>max_block_size</code> to <code>min_insert_block_size_rows</code>. Related to <a href="https://github.com/ClickHouse/ClickHouse/issues/5907" target="_blank" rel="noopener noreferrer">#5907</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12195" target="_blank" rel="noopener noreferrer">#12195</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-3">Experimental Feature<a class="hash-link" href="#experimental-feature-3" title="Direct link to heading">​</a></h4><ul><li>ClickHouse can work as MySQL replica - it is implemented by <code>MaterializeMySQL</code> database engine. Implements <a href="https://github.com/ClickHouse/ClickHouse/issues/4006" target="_blank" rel="noopener noreferrer">#4006</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10851" target="_blank" rel="noopener noreferrer">#10851</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Add types <code>Int128</code>, <code>Int256</code>, <code>UInt256</code> and related functions for them. Extend Decimals with Decimal256 (precision up to 76 digits). New types are under the setting <code>allow_experimental_bigint_types</code>. It is working extremely slow and bad. The implementation is incomplete. Please don&#x27;t use this feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13097" target="_blank" rel="noopener noreferrer">#13097</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-7">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-7" title="Direct link to heading">​</a></h4><ul><li>Added <code>clickhouse install</code> script, that is useful if you only have a single binary. <a href="https://github.com/ClickHouse/ClickHouse/pull/13528" target="_blank" rel="noopener noreferrer">#13528</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow to run <code>clickhouse</code> binary without configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/13515" target="_blank" rel="noopener noreferrer">#13515</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Enable check for typos in code with <code>codespell</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13513" target="_blank" rel="noopener noreferrer">#13513</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/13511" target="_blank" rel="noopener noreferrer">#13511</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Enable Shellcheck in CI as a linter of .sh tests. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/13168" target="_blank" rel="noopener noreferrer">#13168</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13530" target="_blank" rel="noopener noreferrer">#13530</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/13529" target="_blank" rel="noopener noreferrer">#13529</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add a CMake option to fail configuration instead of auto-reconfiguration, enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/13687" target="_blank" rel="noopener noreferrer">#13687</a> (<a href="https://github.com/podshumok" target="_blank" rel="noopener noreferrer">Konstantin</a>).</li><li>Expose version of embedded tzdata via TZDATA_VERSION in system.build_options. <a href="https://github.com/ClickHouse/ClickHouse/pull/13648" target="_blank" rel="noopener noreferrer">#13648</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Improve generation of system.time_zones table during build. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/14209" target="_blank" rel="noopener noreferrer">#14209</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14215" target="_blank" rel="noopener noreferrer">#14215</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Build ClickHouse with the most fresh tzdata from package repository. <a href="https://github.com/ClickHouse/ClickHouse/pull/13623" target="_blank" rel="noopener noreferrer">#13623</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add the ability to write js-style comments in skip_list.json. <a href="https://github.com/ClickHouse/ClickHouse/pull/14159" target="_blank" rel="noopener noreferrer">#14159</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Ensure that there is no copy-pasted GPL code. <a href="https://github.com/ClickHouse/ClickHouse/pull/13514" target="_blank" rel="noopener noreferrer">#13514</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Switch tests docker images to use test-base parent. <a href="https://github.com/ClickHouse/ClickHouse/pull/14167" target="_blank" rel="noopener noreferrer">#14167</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Adding retry logic when bringing up docker-compose cluster; Increasing COMPOSE_HTTP_TIMEOUT. <a href="https://github.com/ClickHouse/ClickHouse/pull/14112" target="_blank" rel="noopener noreferrer">#14112</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Enabled <code>system.text_log</code> in stress test to find more bugs. <a href="https://github.com/ClickHouse/ClickHouse/pull/13855" target="_blank" rel="noopener noreferrer">#13855</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Testflows LDAP module: adding missing certificates and dhparam.pem for openldap4. <a href="https://github.com/ClickHouse/ClickHouse/pull/13780" target="_blank" rel="noopener noreferrer">#13780</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>ZooKeeper cannot work reliably in unit tests in CI infrastructure. Using unit tests for ZooKeeper interaction with real ZooKeeper is bad idea from the start (unit tests are not supposed to verify complex distributed systems). We already using integration tests for this purpose and they are better suited. <a href="https://github.com/ClickHouse/ClickHouse/pull/13745" target="_blank" rel="noopener noreferrer">#13745</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added docker image for style check. Added style check that all docker and docker compose files are located in docker directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/13724" target="_blank" rel="noopener noreferrer">#13724</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Fix cassandra build on Mac OS. <a href="https://github.com/ClickHouse/ClickHouse/pull/13708" target="_blank" rel="noopener noreferrer">#13708</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Fix link error in shared build. <a href="https://github.com/ClickHouse/ClickHouse/pull/13700" target="_blank" rel="noopener noreferrer">#13700</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Updating LDAP user authentication suite to check that it works with RBAC. <a href="https://github.com/ClickHouse/ClickHouse/pull/13656" target="_blank" rel="noopener noreferrer">#13656</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Removed <code>-DENABLE_CURL_CLIENT</code> for <code>contrib/aws</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13628" target="_blank" rel="noopener noreferrer">#13628</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Increasing health-check timeouts for ClickHouse nodes and adding support to dump docker-compose logs if unhealthy containers found. <a href="https://github.com/ClickHouse/ClickHouse/pull/13612" target="_blank" rel="noopener noreferrer">#13612</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Make sure <a href="https://github.com/ClickHouse/ClickHouse/issues/10977" target="_blank" rel="noopener noreferrer">#10977</a> is invalid. <a href="https://github.com/ClickHouse/ClickHouse/pull/13539" target="_blank" rel="noopener noreferrer">#13539</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Skip PR&#x27;s from robot-clickhouse. <a href="https://github.com/ClickHouse/ClickHouse/pull/13489" target="_blank" rel="noopener noreferrer">#13489</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Move Dockerfiles from integration tests to <code>docker/test</code> directory. docker_compose files are available in <code>runner</code> docker container. Docker images are built in CI and not in integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/13448" target="_blank" rel="noopener noreferrer">#13448</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-207">ClickHouse release 20.7<a class="hash-link" href="#clickhouse-release-207" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v207230-stable-2020-08-31">ClickHouse release v20.7.2.30-stable, 2020-08-31<a class="hash-link" href="#clickhouse-release-v207230-stable-2020-08-31" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-5">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-5" title="Direct link to heading">​</a></h4><ul><li>Function <code>modulo</code> (operator <code>%</code>) with at least one floating point number as argument will calculate remainder of division directly on floating point numbers without converting both arguments to integers. It makes behaviour compatible with most of DBMS. This also applicable for Date and DateTime data types. Added alias <code>mod</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7323" target="_blank" rel="noopener noreferrer">#7323</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12585" target="_blank" rel="noopener noreferrer">#12585</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Deprecate special printing of zero Date/DateTime values as <code>0000-00-00</code> and <code>0000-00-00 00:00:00</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12442" target="_blank" rel="noopener noreferrer">#12442</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>The function <code>groupArrayMoving*</code> was not working for distributed queries. It&#x27;s result was calculated within incorrect data type (without promotion to the largest type). The function <code>groupArrayMovingAvg</code> was returning integer number that was inconsistent with the <code>avg</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12568" target="_blank" rel="noopener noreferrer">#12568</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12622" target="_blank" rel="noopener noreferrer">#12622</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add sanity check for MergeTree settings. If the settings are incorrect, the server will refuse to start or to create a table, printing detailed explanation to the user. <a href="https://github.com/ClickHouse/ClickHouse/pull/13153" target="_blank" rel="noopener noreferrer">#13153</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Protect from the cases when user may set <code>background_pool_size</code> to value lower than <code>number_of_free_entries_in_pool_to_execute_mutation</code> or <code>number_of_free_entries_in_pool_to_lower_max_size_of_merge</code>. In these cases ALTERs won&#x27;t work or the maximum size of merge will be too limited. It will throw exception explaining what to do. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10897" target="_blank" rel="noopener noreferrer">#10897</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12728" target="_blank" rel="noopener noreferrer">#12728</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code>Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-5">New Feature<a class="hash-link" href="#new-feature-5" title="Direct link to heading">​</a></h4><ul><li>Polygon dictionary type that provides efficient &quot;reverse geocoding&quot; lookups - to find the region by coordinates in a dictionary of many polygons (world map). It is using carefully optimized algorithm with recursive grids to maintain low CPU and memory usage. <a href="https://github.com/ClickHouse/ClickHouse/pull/9278" target="_blank" rel="noopener noreferrer">#9278</a> (<a href="https://github.com/achulkov2" target="_blank" rel="noopener noreferrer">achulkov2</a>).</li><li>Added support of LDAP authentication for preconfigured users (&quot;Simple Bind&quot; method). <a href="https://github.com/ClickHouse/ClickHouse/pull/11234" target="_blank" rel="noopener noreferrer">#11234</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>).</li><li>Introduce setting <code>alter_partition_verbose_result</code> which outputs information about touched parts for some types of <code>ALTER TABLE ... PARTITION ...</code> queries (currently <code>ATTACH</code> and <code>FREEZE</code>). Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8076" target="_blank" rel="noopener noreferrer">#8076</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13017" target="_blank" rel="noopener noreferrer">#13017</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add <code>bayesAB</code> function for bayesian-ab-testing. <a href="https://github.com/ClickHouse/ClickHouse/pull/12327" target="_blank" rel="noopener noreferrer">#12327</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>).</li><li>Added <code>system.crash_log</code> table into which stack traces for fatal errors are collected. This table should be empty. <a href="https://github.com/ClickHouse/ClickHouse/pull/12316" target="_blank" rel="noopener noreferrer">#12316</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added http headers <code>X-ClickHouse-Database</code> and <code>X-ClickHouse-Format</code> which may be used to set default database and output format. <a href="https://github.com/ClickHouse/ClickHouse/pull/12981" target="_blank" rel="noopener noreferrer">#12981</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Add <code>minMap</code> and <code>maxMap</code> functions support to <code>SimpleAggregateFunction</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12662" target="_blank" rel="noopener noreferrer">#12662</a> (<a href="https://github.com/ildus" target="_blank" rel="noopener noreferrer">Ildus Kurbangaliev</a>).</li><li>Add setting <code>allow_non_metadata_alters</code> which restricts to execute <code>ALTER</code> queries which modify data on disk. Disabled be default. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11547" target="_blank" rel="noopener noreferrer">#11547</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12635" target="_blank" rel="noopener noreferrer">#12635</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>A function <code>formatRow</code> is added to support turning arbitrary expressions into a string via given format. It&#x27;s useful for manipulating SQL outputs and is quite versatile combined with the <code>columns</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/12574" target="_blank" rel="noopener noreferrer">#12574</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Add <code>FROM_UNIXTIME</code> function for compatibility with MySQL, related to <a href="https://github.com/ClickHouse/ClickHouse/issues/12149" target="_blank" rel="noopener noreferrer">12149</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12484" target="_blank" rel="noopener noreferrer">#12484</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Allow Nullable types as keys in MergeTree tables if <code>allow_nullable_key</code> table setting is enabled. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/5319" target="_blank" rel="noopener noreferrer">#5319</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12433" target="_blank" rel="noopener noreferrer">#12433</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Integration with <a href="https://intl.cloud.tencent.com/product/cos" target="_blank" rel="noopener noreferrer">COS</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12386" target="_blank" rel="noopener noreferrer">#12386</a> (<a href="https://github.com/fastio" target="_blank" rel="noopener noreferrer">fastio</a>).</li><li>Add <code>mapAdd</code> and <code>mapSubtract</code> functions for adding/subtracting key-mapped values. <a href="https://github.com/ClickHouse/ClickHouse/pull/11735" target="_blank" rel="noopener noreferrer">#11735</a> (<a href="https://github.com/ildus" target="_blank" rel="noopener noreferrer">Ildus Kurbangaliev</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-24">Bug Fix<a class="hash-link" href="#bug-fix-24" title="Direct link to heading">​</a></h4><ul><li>Fix premature <code>ON CLUSTER</code> timeouts for queries that must be executed on a single replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6704" target="_blank" rel="noopener noreferrer">#6704</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7228" target="_blank" rel="noopener noreferrer">#7228</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/13361" target="_blank" rel="noopener noreferrer">#13361</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11884" target="_blank" rel="noopener noreferrer">#11884</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13450" target="_blank" rel="noopener noreferrer">#13450</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix crash in mark inclusion search introduced in <a href="https://github.com/ClickHouse/ClickHouse/pull/12277" target="_blank" rel="noopener noreferrer">#12277</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14225" target="_blank" rel="noopener noreferrer">#14225</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix race condition in external dictionaries with cache layout which can lead server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/12566" target="_blank" rel="noopener noreferrer">#12566</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix visible data clobbering by progress bar in client in interactive mode. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12562" target="_blank" rel="noopener noreferrer">#12562</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/13369" target="_blank" rel="noopener noreferrer">#13369</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/13584" target="_blank" rel="noopener noreferrer">#13584</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12964" target="_blank" rel="noopener noreferrer">#12964</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13691" target="_blank" rel="noopener noreferrer">#13691</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed incorrect sorting order for <code>LowCardinality</code> columns when ORDER BY multiple columns is used. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13958" target="_blank" rel="noopener noreferrer">#13958</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14223" target="_blank" rel="noopener noreferrer">#14223</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Removed hardcoded timeout, which wrongly overruled <code>query_wait_timeout_milliseconds</code> setting for cache-dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/14105" target="_blank" rel="noopener noreferrer">#14105</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed wrong mount point in extra info for <code>Poco::Exception: no space left on device</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14050" target="_blank" rel="noopener noreferrer">#14050</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix wrong query optimization of select queries with <code>DISTINCT</code> keyword when subqueries also have <code>DISTINCT</code> in case <code>optimize_duplicate_order_by_and_distinct</code> setting is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/13925" target="_blank" rel="noopener noreferrer">#13925</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fixed potential deadlock when renaming <code>Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/13922" target="_blank" rel="noopener noreferrer">#13922</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix incorrect sorting for <code>FixedString</code> columns when ORDER BY multiple columns is used. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13182" target="_blank" rel="noopener noreferrer">#13182</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13887" target="_blank" rel="noopener noreferrer">#13887</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix potentially lower precision of <code>topK</code>/<code>topKWeighted</code> aggregations (with non-default parameters). <a href="https://github.com/ClickHouse/ClickHouse/pull/13817" target="_blank" rel="noopener noreferrer">#13817</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix reading from MergeTree table with INDEX of type SET fails when compared against NULL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13686" target="_blank" rel="noopener noreferrer">#13686</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13793" target="_blank" rel="noopener noreferrer">#13793</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix step overflow in function <code>range()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13790" target="_blank" rel="noopener noreferrer">#13790</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <code>Directory not empty</code> error when concurrently executing <code>DROP DATABASE</code> and <code>CREATE TABLE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13756" target="_blank" rel="noopener noreferrer">#13756</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add range check for <code>h3KRing</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13633" target="_blank" rel="noopener noreferrer">#13633</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13752" target="_blank" rel="noopener noreferrer">#13752</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix race condition between DETACH and background merges. Parts may revive after detach. This is continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/8602" target="_blank" rel="noopener noreferrer">#8602</a> that did not fix the issue but introduced a test that started to fail in very rare cases, demonstrating the issue. <a href="https://github.com/ClickHouse/ClickHouse/pull/13746" target="_blank" rel="noopener noreferrer">#13746</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix logging Settings.Names/Values when <code>log_queries_min_type</code> greater than <code>QUERY_START</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13737" target="_blank" rel="noopener noreferrer">#13737</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix incorrect message in <code>clickhouse-server.init</code> while checking user and group. <a href="https://github.com/ClickHouse/ClickHouse/pull/13711" target="_blank" rel="noopener noreferrer">#13711</a> (<a href="https://github.com/ylchou" target="_blank" rel="noopener noreferrer">ylchou</a>).</li><li>Do not optimize <code>any(arrayJoin())</code> to <code>arrayJoin()</code> under <code>optimize_move_functions_out_of_any</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13681" target="_blank" rel="noopener noreferrer">#13681</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed possible deadlock in concurrent <code>ALTER ... REPLACE/MOVE PARTITION ...</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/13626" target="_blank" rel="noopener noreferrer">#13626</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed the behaviour when sometimes cache-dictionary returned default value instead of present value from source. <a href="https://github.com/ClickHouse/ClickHouse/pull/13624" target="_blank" rel="noopener noreferrer">#13624</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix secondary indices corruption in compact parts (compact parts is an experimental feature). <a href="https://github.com/ClickHouse/ClickHouse/pull/13538" target="_blank" rel="noopener noreferrer">#13538</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix wrong code in function <code>netloc</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13335" target="_blank" rel="noopener noreferrer">#13335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13446" target="_blank" rel="noopener noreferrer">#13446</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix error in <code>parseDateTimeBestEffort</code> function when unix timestamp was passed as an argument. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13362" target="_blank" rel="noopener noreferrer">#13362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13441" target="_blank" rel="noopener noreferrer">#13441</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix invalid return type for comparison of tuples with <code>NULL</code> elements. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12461" target="_blank" rel="noopener noreferrer">#12461</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13420" target="_blank" rel="noopener noreferrer">#13420</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix wrong optimization caused <code>aggregate function any(x) is found inside another aggregate function in query</code> error with <code>SET optimize_move_functions_out_of_any = 1</code> and aliases inside <code>any()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13419" target="_blank" rel="noopener noreferrer">#13419</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix possible race in <code>StorageMemory</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13416" target="_blank" rel="noopener noreferrer">#13416</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix empty output for <code>Arrow</code> and <code>Parquet</code> formats in case if query return zero rows. It was done because empty output is not valid for this formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/13399" target="_blank" rel="noopener noreferrer">#13399</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Fix select queries with constant columns and prefix of primary key in <code>ORDER BY</code> clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/13396" target="_blank" rel="noopener noreferrer">#13396</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix <code>PrettyCompactMonoBlock</code> for clickhouse-local. Fix extremes/totals with <code>PrettyCompactMonoBlock</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7746" target="_blank" rel="noopener noreferrer">#7746</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13394" target="_blank" rel="noopener noreferrer">#13394</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed deadlock in system.text_log. <a href="https://github.com/ClickHouse/ClickHouse/pull/12452" target="_blank" rel="noopener noreferrer">#12452</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>). It is a part of <a href="https://github.com/ClickHouse/ClickHouse/issues/12339" target="_blank" rel="noopener noreferrer">#12339</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12325" target="_blank" rel="noopener noreferrer">#12325</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13386" target="_blank" rel="noopener noreferrer">#13386</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed <code>File(TSVWithNames*)</code> (header was written multiple times), fixed <code>clickhouse-local --format CSVWithNames*</code> (lacks header, broken after <a href="https://github.com/ClickHouse/ClickHouse/issues/12197" target="_blank" rel="noopener noreferrer">#12197</a>), fixed <code>clickhouse-local --format CSVWithNames*</code> with zero rows (lacks header). <a href="https://github.com/ClickHouse/ClickHouse/pull/13343" target="_blank" rel="noopener noreferrer">#13343</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix segfault when function <code>groupArrayMovingSum</code> deserializes empty state. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13339" target="_blank" rel="noopener noreferrer">#13339</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13341" target="_blank" rel="noopener noreferrer">#13341</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Throw error on <code>arrayJoin()</code> function in <code>JOIN ON</code> section. <a href="https://github.com/ClickHouse/ClickHouse/pull/13330" target="_blank" rel="noopener noreferrer">#13330</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix crash in <code>LEFT ASOF JOIN</code> with <code>join_use_nulls=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13291" target="_blank" rel="noopener noreferrer">#13291</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix possible error <code>Totals having transform was already added to pipeline</code> in case of a query from delayed replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/13290" target="_blank" rel="noopener noreferrer">#13290</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>The server may crash if user passed specifically crafted arguments to the function <code>h3ToChildren</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13275" target="_blank" rel="noopener noreferrer">#13275</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13277" target="_blank" rel="noopener noreferrer">#13277</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potentially low performance and slightly incorrect result for <code>uniqExact</code>, <code>topK</code>, <code>sumDistinct</code> and similar aggregate functions called on Float types with <code>NaN</code> values. It also triggered assert in debug build. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12491" target="_blank" rel="noopener noreferrer">#12491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13254" target="_blank" rel="noopener noreferrer">#13254</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix assertion in KeyCondition when primary key contains expression with monotonic function and query contains comparison with constant whose type is different. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12465" target="_blank" rel="noopener noreferrer">#12465</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13251" target="_blank" rel="noopener noreferrer">#13251</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Return passed number for numbers with MSB set in function roundUpToPowerOfTwoOrZero(). It prevents potential errors in case of overflow of array sizes. <a href="https://github.com/ClickHouse/ClickHouse/pull/13234" target="_blank" rel="noopener noreferrer">#13234</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix function if with nullable constexpr as cond that is not literal NULL. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12463" target="_blank" rel="noopener noreferrer">#12463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13226" target="_blank" rel="noopener noreferrer">#13226</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix assert in <code>arrayElement</code> function in case of array elements are Nullable and array subscript is also Nullable. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12172" target="_blank" rel="noopener noreferrer">#12172</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13224" target="_blank" rel="noopener noreferrer">#13224</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix DateTime64 conversion functions with constant argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/13205" target="_blank" rel="noopener noreferrer">#13205</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix parsing row policies from users.xml when names of databases or tables contain dots. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5779" target="_blank" rel="noopener noreferrer">#5779</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12527" target="_blank" rel="noopener noreferrer">#12527</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13199" target="_blank" rel="noopener noreferrer">#13199</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix access to <code>redis</code> dictionary after connection was dropped once. It may happen with <code>cache</code> and <code>direct</code> dictionary layouts. <a href="https://github.com/ClickHouse/ClickHouse/pull/13082" target="_blank" rel="noopener noreferrer">#13082</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix wrong index analysis with functions. It could lead to some data parts being skipped when reading from <code>MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13060" target="_blank" rel="noopener noreferrer">#13060</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12406" target="_blank" rel="noopener noreferrer">#12406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13081" target="_blank" rel="noopener noreferrer">#13081</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix error <code>Cannot convert column because it is constant but values of constants are different in source and result</code> for remote queries which use deterministic functions in scope of query, but not deterministic between queries, like <code>now()</code>, <code>now64()</code>, <code>randConstant()</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11327" target="_blank" rel="noopener noreferrer">#11327</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13075" target="_blank" rel="noopener noreferrer">#13075</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix crash which was possible for queries with <code>ORDER BY</code> tuple and small <code>LIMIT</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12623" target="_blank" rel="noopener noreferrer">#12623</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13009" target="_blank" rel="noopener noreferrer">#13009</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix <code>Block structure mismatch</code> error for queries with <code>UNION</code> and <code>JOIN</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12602" target="_blank" rel="noopener noreferrer">#12602</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12989" target="_blank" rel="noopener noreferrer">#12989</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Corrected <code>merge_with_ttl_timeout</code> logic which did not work well when expiration affected more than one partition over one time interval. (Authored by @excitoon). <a href="https://github.com/ClickHouse/ClickHouse/pull/12982" target="_blank" rel="noopener noreferrer">#12982</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Fix columns duplication for range hashed dictionary created from DDL query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10605" target="_blank" rel="noopener noreferrer">#10605</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12857" target="_blank" rel="noopener noreferrer">#12857</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix unnecessary limiting for the number of threads for selects from local replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/12840" target="_blank" rel="noopener noreferrer">#12840</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix rare bug when <code>ALTER DELETE</code> and <code>ALTER MODIFY COLUMN</code> queries executed simultaneously as a single mutation. Bug leads to an incorrect amount of rows in <code>count.txt</code> and as a consequence incorrect data in part. Also, fix a small bug with simultaneous <code>ALTER RENAME COLUMN</code> and <code>ALTER ADD COLUMN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12760" target="_blank" rel="noopener noreferrer">#12760</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Wrong credentials being used when using <code>clickhouse</code> dictionary source to query remote tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/12756" target="_blank" rel="noopener noreferrer">#12756</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>).</li><li>Fix <code>CAST(Nullable(String), Enum())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12745" target="_blank" rel="noopener noreferrer">#12745</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix performance with large tuples, which are interpreted as functions in <code>IN</code> section. The case when user writes <code>WHERE x IN tuple(1, 2, ...)</code> instead of <code>WHERE x IN (1, 2, ...)</code> for some obscure reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/12700" target="_blank" rel="noopener noreferrer">#12700</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix memory tracking for input_format_parallel_parsing (by attaching thread to group). <a href="https://github.com/ClickHouse/ClickHouse/pull/12672" target="_blank" rel="noopener noreferrer">#12672</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix wrong optimization <code>optimize_move_functions_out_of_any=1</code> in case of <code>any(func(&lt;lambda&gt;))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12664" target="_blank" rel="noopener noreferrer">#12664</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/10572" target="_blank" rel="noopener noreferrer">#10572</a> fix bloom filter index with const expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/12659" target="_blank" rel="noopener noreferrer">#12659</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix SIGSEGV in StorageKafka when broker is unavailable (and not only). <a href="https://github.com/ClickHouse/ClickHouse/pull/12658" target="_blank" rel="noopener noreferrer">#12658</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add support for function <code>if</code> with <code>Array(UUID)</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11066" target="_blank" rel="noopener noreferrer">#11066</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12648" target="_blank" rel="noopener noreferrer">#12648</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>CREATE USER IF NOT EXISTS now does not throw exception if the user exists. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12507" target="_blank" rel="noopener noreferrer">#12507</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12646" target="_blank" rel="noopener noreferrer">#12646</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Exception <code>There is no supertype...</code> can be thrown during <code>ALTER ... UPDATE</code> in unexpected cases (e.g. when subtracting from UInt64 column). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7306" target="_blank" rel="noopener noreferrer">#7306</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4165" target="_blank" rel="noopener noreferrer">#4165</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12633" target="_blank" rel="noopener noreferrer">#12633</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix possible <code>Pipeline stuck</code> error for queries with external sorting. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12617" target="_blank" rel="noopener noreferrer">#12617</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12618" target="_blank" rel="noopener noreferrer">#12618</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix error <code>Output of TreeExecutor is not sorted</code> for <code>OPTIMIZE DEDUPLICATE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11572" target="_blank" rel="noopener noreferrer">#11572</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12613" target="_blank" rel="noopener noreferrer">#12613</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix the issue when alias on result of function <code>any</code> can be lost during query optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/12593" target="_blank" rel="noopener noreferrer">#12593</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Remove data for Distributed tables (blocks from async INSERTs) on DROP TABLE. <a href="https://github.com/ClickHouse/ClickHouse/pull/12556" target="_blank" rel="noopener noreferrer">#12556</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Now ClickHouse will recalculate checksums for parts when file <code>checksums.txt</code> is absent. Broken since <a href="https://github.com/ClickHouse/ClickHouse/issues/9827" target="_blank" rel="noopener noreferrer">#9827</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12545" target="_blank" rel="noopener noreferrer">#12545</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug which lead to broken old parts after <code>ALTER DELETE</code> query when <code>enable_mixed_granularity_parts=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12536" target="_blank" rel="noopener noreferrer">#12536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12543" target="_blank" rel="noopener noreferrer">#12543</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixing race condition in live view tables which could cause data duplication. LIVE VIEW is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/12519" target="_blank" rel="noopener noreferrer">#12519</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Fix backwards compatibility in binary format of <code>AggregateFunction(avg, ...)</code> values. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12342" target="_blank" rel="noopener noreferrer">#12342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12486" target="_blank" rel="noopener noreferrer">#12486</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash in JOIN with dictionary when we are joining over expression of dictionary key: <code>t JOIN dict ON expr(dict.id) = t.id</code>. Disable dictionary join optimisation for this case. <a href="https://github.com/ClickHouse/ClickHouse/pull/12458" target="_blank" rel="noopener noreferrer">#12458</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix overflow when very large LIMIT or OFFSET is specified. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10470" target="_blank" rel="noopener noreferrer">#10470</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11372" target="_blank" rel="noopener noreferrer">#11372</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12427" target="_blank" rel="noopener noreferrer">#12427</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>kafka: fix SIGSEGV if there is a message with error in the middle of the batch. <a href="https://github.com/ClickHouse/ClickHouse/pull/12302" target="_blank" rel="noopener noreferrer">#12302</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-13">Improvement<a class="hash-link" href="#improvement-13" title="Direct link to heading">​</a></h4><ul><li>Keep smaller amount of logs in ZooKeeper. Avoid excessive growing of ZooKeeper nodes in case of offline replicas when having many servers/tables/inserts. <a href="https://github.com/ClickHouse/ClickHouse/pull/13100" target="_blank" rel="noopener noreferrer">#13100</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now exceptions forwarded to the client if an error happened during ALTER or mutation. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11329" target="_blank" rel="noopener noreferrer">#11329</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12666" target="_blank" rel="noopener noreferrer">#12666</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add <code>QueryTimeMicroseconds</code>, <code>SelectQueryTimeMicroseconds</code> and <code>InsertQueryTimeMicroseconds</code> to <code>system.events</code>, along with system.metrics, processes, query_log, etc. <a href="https://github.com/ClickHouse/ClickHouse/pull/13028" target="_blank" rel="noopener noreferrer">#13028</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Added <code>SelectedRows</code> and <code>SelectedBytes</code> to <code>system.events</code>, along with system.metrics, processes, query_log, etc. <a href="https://github.com/ClickHouse/ClickHouse/pull/12638" target="_blank" rel="noopener noreferrer">#12638</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Added <code>current_database</code> information to <code>system.query_log</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12652" target="_blank" rel="noopener noreferrer">#12652</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Allow <code>TabSeparatedRaw</code> as input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/12009" target="_blank" rel="noopener noreferrer">#12009</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Now <code>joinGet</code> supports multi-key lookup. <a href="https://github.com/ClickHouse/ClickHouse/pull/12418" target="_blank" rel="noopener noreferrer">#12418</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Allow <code>*Map</code> aggregate functions to work on Arrays with NULLs. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13157" target="_blank" rel="noopener noreferrer">#13157</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13225" target="_blank" rel="noopener noreferrer">#13225</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Avoid overflow in parsing of DateTime values that will lead to negative unix timestamp in their timezone (for example, <code>1970-01-01 00:00:00</code> in Moscow). Saturate to zero instead. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3470" target="_blank" rel="noopener noreferrer">#3470</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4172" target="_blank" rel="noopener noreferrer">#4172</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12443" target="_blank" rel="noopener noreferrer">#12443</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>AvroConfluent: Skip Kafka tombstone records - Support skipping broken records <a href="https://github.com/ClickHouse/ClickHouse/pull/13203" target="_blank" rel="noopener noreferrer">#13203</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>).</li><li>Fix wrong error for long queries. It was possible to get syntax error other than <code>Max query size exceeded</code> for correct query. <a href="https://github.com/ClickHouse/ClickHouse/pull/13928" target="_blank" rel="noopener noreferrer">#13928</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix data race in <code>lgamma</code> function. This race was caught only in <code>tsan</code>, no side effects really happened. <a href="https://github.com/ClickHouse/ClickHouse/pull/13842" target="_blank" rel="noopener noreferrer">#13842</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix a &#x27;Week&#x27;-interval formatting for ATTACH/ALTER/CREATE QUOTA-statements. <a href="https://github.com/ClickHouse/ClickHouse/pull/13417" target="_blank" rel="noopener noreferrer">#13417</a> (<a href="https://github.com/vladimir-golovchenko" target="_blank" rel="noopener noreferrer">vladimir-golovchenko</a>).</li><li>Now broken parts are also reported when encountered in compact part processing. Compact parts is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/13282" target="_blank" rel="noopener noreferrer">#13282</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix assert in <code>geohashesInBox</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12554" target="_blank" rel="noopener noreferrer">#12554</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13229" target="_blank" rel="noopener noreferrer">#13229</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix assert in <code>parseDateTimeBestEffort</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12649" target="_blank" rel="noopener noreferrer">#12649</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13227" target="_blank" rel="noopener noreferrer">#13227</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Minor optimization in Processors/PipelineExecutor: breaking out of a loop because it makes sense to do so. <a href="https://github.com/ClickHouse/ClickHouse/pull/13058" target="_blank" rel="noopener noreferrer">#13058</a> (<a href="https://github.com/markpapadakis" target="_blank" rel="noopener noreferrer">Mark Papadakis</a>).</li><li>Support TRUNCATE table without TABLE keyword. <a href="https://github.com/ClickHouse/ClickHouse/pull/12653" target="_blank" rel="noopener noreferrer">#12653</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix explain query format overwrite by default. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12432" target="_blank" rel="noopener noreferrer">#12541</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12541" target="_blank" rel="noopener noreferrer">#12541</a> (<a href="https://github.com/BohuTANG" target="_blank" rel="noopener noreferrer">BohuTANG</a>).</li><li>Allow to set JOIN kind and type in more standad way: <code>LEFT SEMI JOIN</code> instead of <code>SEMI LEFT JOIN</code>. For now both are correct. <a href="https://github.com/ClickHouse/ClickHouse/pull/12520" target="_blank" rel="noopener noreferrer">#12520</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Changes default value for <code>multiple_joins_rewriter_version</code> to 2. It enables new multiple joins rewriter that knows about column names. <a href="https://github.com/ClickHouse/ClickHouse/pull/12469" target="_blank" rel="noopener noreferrer">#12469</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Add several metrics for requests to S3 storages. <a href="https://github.com/ClickHouse/ClickHouse/pull/12464" target="_blank" rel="noopener noreferrer">#12464</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Use correct default secure port for clickhouse-benchmark with <code>--secure</code> argument. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11044" target="_blank" rel="noopener noreferrer">#11044</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12440" target="_blank" rel="noopener noreferrer">#12440</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Rollback insertion errors in <code>Log</code>, <code>TinyLog</code>, <code>StripeLog</code> engines. In previous versions insertion error lead to inconsisent table state (this works as documented and it is normal for these table engines). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12402" target="_blank" rel="noopener noreferrer">#12402</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12426" target="_blank" rel="noopener noreferrer">#12426</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Implement <code>RENAME DATABASE</code> and <code>RENAME DICTIONARY</code> for <code>Atomic</code> database engine - Add implicit <code>{uuid}</code> macro, which can be used in ZooKeeper path for <code>ReplicatedMergeTree</code>. It works with <code>CREATE ... ON CLUSTER ...</code> queries. Set <code>show_table_uuid_in_table_create_query_if_not_nil</code> to <code>true</code> to use it. - Make <code>ReplicatedMergeTree</code> engine arguments optional, <code>/clickhouse/tables/{uuid}/{shard}/</code> and <code>{replica}</code> are used by default. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12135" target="_blank" rel="noopener noreferrer">#12135</a>. - Minor fixes. - These changes break backward compatibility of <code>Atomic</code> database engine. Previously created <code>Atomic</code> databases must be manually converted to new format. Atomic database is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/12343" target="_blank" rel="noopener noreferrer">#12343</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Separated <code>AWSAuthV4Signer</code> into different logger, removed excessive <code>AWSClient: AWSClient</code> from log messages. <a href="https://github.com/ClickHouse/ClickHouse/pull/12320" target="_blank" rel="noopener noreferrer">#12320</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Better exception message in disk access storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/12625" target="_blank" rel="noopener noreferrer">#12625</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Better exception for function <code>in</code> with invalid number of arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12529" target="_blank" rel="noopener noreferrer">#12529</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix error message about adaptive granularity. <a href="https://github.com/ClickHouse/ClickHouse/pull/12624" target="_blank" rel="noopener noreferrer">#12624</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix SETTINGS parse after FORMAT. <a href="https://github.com/ClickHouse/ClickHouse/pull/12480" target="_blank" rel="noopener noreferrer">#12480</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>If MergeTree table does not contain ORDER BY or PARTITION BY, it was possible to request ALTER to CLEAR all the columns and ALTER will stuck. Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/7941" target="_blank" rel="noopener noreferrer">#7941</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12382" target="_blank" rel="noopener noreferrer">#12382</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Avoid re-loading completion from the history file after each query (to avoid history overlaps with other client sessions). <a href="https://github.com/ClickHouse/ClickHouse/pull/13086" target="_blank" rel="noopener noreferrer">#13086</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-6">Performance Improvement<a class="hash-link" href="#performance-improvement-6" title="Direct link to heading">​</a></h4><ul><li>Lower memory usage for some operations up to 2 times. <a href="https://github.com/ClickHouse/ClickHouse/pull/12424" target="_blank" rel="noopener noreferrer">#12424</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Optimize PK lookup for queries that match exact PK range. <a href="https://github.com/ClickHouse/ClickHouse/pull/12277" target="_blank" rel="noopener noreferrer">#12277</a> (<a href="https://github.com/bobrik" target="_blank" rel="noopener noreferrer">Ivan Babrou</a>).</li><li>Slightly optimize very short queries with <code>LowCardinality</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14129" target="_blank" rel="noopener noreferrer">#14129</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Slightly improve performance of aggregation by UInt8/UInt16 keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/13091" target="_blank" rel="noopener noreferrer">#13091</a> and <a href="https://github.com/ClickHouse/ClickHouse/pull/13055" target="_blank" rel="noopener noreferrer">#13055</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Push down <code>LIMIT</code> step for query plan (inside subqueries). <a href="https://github.com/ClickHouse/ClickHouse/pull/13016" target="_blank" rel="noopener noreferrer">#13016</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Parallel primary key lookup and skipping index stages on parts, as described in <a href="https://github.com/ClickHouse/ClickHouse/issues/11564" target="_blank" rel="noopener noreferrer">#11564</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12589" target="_blank" rel="noopener noreferrer">#12589</a> (<a href="https://github.com/bobrik" target="_blank" rel="noopener noreferrer">Ivan Babrou</a>).</li><li>Converting String-type arguments of function &quot;if&quot; and &quot;transform&quot; into enum if <code>set optimize_if_transform_strings_to_enum = 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12515" target="_blank" rel="noopener noreferrer">#12515</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Replaces monotonic functions with its argument in <code>ORDER BY</code> if <code>set optimize_monotonous_functions_in_order_by=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12467" target="_blank" rel="noopener noreferrer">#12467</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Add order by optimization that rewrites <code>ORDER BY x, f(x)</code> with <code>ORDER by x</code> if <code>set optimize_redundant_functions_in_order_by = 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12404" target="_blank" rel="noopener noreferrer">#12404</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Allow pushdown predicate when subquery contains <code>WITH</code> clause. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12293" target="_blank" rel="noopener noreferrer">#12293</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/12663" target="_blank" rel="noopener noreferrer">#12663</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Improve performance of reading from compact parts. Compact parts is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/12492" target="_blank" rel="noopener noreferrer">#12492</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Attempt to implement streaming optimization in <code>DiskS3</code>. DiskS3 is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/12434" target="_blank" rel="noopener noreferrer">#12434</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-8">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-8" title="Direct link to heading">​</a></h4><ul><li>Use <code>shellcheck</code> for sh tests linting. <a href="https://github.com/ClickHouse/ClickHouse/pull/13200" target="_blank" rel="noopener noreferrer">#13200</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/13207" target="_blank" rel="noopener noreferrer">#13207</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add script which set labels for pull requests in GitHub hook. <a href="https://github.com/ClickHouse/ClickHouse/pull/13183" target="_blank" rel="noopener noreferrer">#13183</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Remove some of recursive submodules. See <a href="https://github.com/ClickHouse/ClickHouse/issues/13378" target="_blank" rel="noopener noreferrer">#13378</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13379" target="_blank" rel="noopener noreferrer">#13379</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Ensure that all the submodules are from proper URLs. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/13379" target="_blank" rel="noopener noreferrer">#13379</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13378" target="_blank" rel="noopener noreferrer">#13378</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13397" target="_blank" rel="noopener noreferrer">#13397</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added support for user-declared settings, which can be accessed from inside queries. This is needed when ClickHouse engine is used as a component of another system. <a href="https://github.com/ClickHouse/ClickHouse/pull/13013" target="_blank" rel="noopener noreferrer">#13013</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Added testing for RBAC functionality of INSERT privilege in TestFlows. Expanded tables on which SELECT is being tested. Added Requirements to match new table engine tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/13340" target="_blank" rel="noopener noreferrer">#13340</a> (<a href="https://github.com/MyroTk" target="_blank" rel="noopener noreferrer">MyroTk</a>).</li><li>Fix timeout error during server restart in the stress test. <a href="https://github.com/ClickHouse/ClickHouse/pull/13321" target="_blank" rel="noopener noreferrer">#13321</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now fast test will wait server with retries. <a href="https://github.com/ClickHouse/ClickHouse/pull/13284" target="_blank" rel="noopener noreferrer">#13284</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Function <code>materialize()</code> (the function for ClickHouse testing) will work for NULL as expected - by transforming it to non-constant column. <a href="https://github.com/ClickHouse/ClickHouse/pull/13212" target="_blank" rel="noopener noreferrer">#13212</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix libunwind build in AArch64. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13204" target="_blank" rel="noopener noreferrer">#13204</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13208" target="_blank" rel="noopener noreferrer">#13208</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Even more retries in zkutil gtest to prevent test flakiness. <a href="https://github.com/ClickHouse/ClickHouse/pull/13165" target="_blank" rel="noopener noreferrer">#13165</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Small fixes to the RBAC TestFlows. <a href="https://github.com/ClickHouse/ClickHouse/pull/13152" target="_blank" rel="noopener noreferrer">#13152</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Fixing <code>00960_live_view_watch_events_live.py</code> test. <a href="https://github.com/ClickHouse/ClickHouse/pull/13108" target="_blank" rel="noopener noreferrer">#13108</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Improve cache purge in documentation deploy script. <a href="https://github.com/ClickHouse/ClickHouse/pull/13107" target="_blank" rel="noopener noreferrer">#13107</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Rewrote some orphan tests to gtest. Removed useless includes from tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/13073" target="_blank" rel="noopener noreferrer">#13073</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Added tests for RBAC functionality of <code>SELECT</code> privilege in TestFlows. <a href="https://github.com/ClickHouse/ClickHouse/pull/13061" target="_blank" rel="noopener noreferrer">#13061</a> (<a href="https://github.com/ritaank" target="_blank" rel="noopener noreferrer">Ritaank Tiwari</a>).</li><li>Rerun some tests in fast test check. <a href="https://github.com/ClickHouse/ClickHouse/pull/12992" target="_blank" rel="noopener noreferrer">#12992</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix MSan error in &quot;rdkafka&quot; library. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12990" target="_blank" rel="noopener noreferrer">#12990</a>. Updated <code>rdkafka</code> to version 1.5 (master). <a href="https://github.com/ClickHouse/ClickHouse/pull/12991" target="_blank" rel="noopener noreferrer">#12991</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix UBSan report in base64 if tests were run on server with AVX-512. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12318" target="_blank" rel="noopener noreferrer">#12318</a>. Author: @qoega. <a href="https://github.com/ClickHouse/ClickHouse/pull/12441" target="_blank" rel="noopener noreferrer">#12441</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix UBSan report in HDFS library. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12330" target="_blank" rel="noopener noreferrer">#12330</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12453" target="_blank" rel="noopener noreferrer">#12453</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Check an ability that we able to restore the backup from an old version to the new version. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/8979" target="_blank" rel="noopener noreferrer">#8979</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12959" target="_blank" rel="noopener noreferrer">#12959</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Do not build helper_container image inside integrational tests. Build docker container in CI and use pre-built helper_container in integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/12953" target="_blank" rel="noopener noreferrer">#12953</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Add a test for <code>ALTER TABLE CLEAR COLUMN</code> query for primary key columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/12951" target="_blank" rel="noopener noreferrer">#12951</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Increased timeouts in testflows tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/12949" target="_blank" rel="noopener noreferrer">#12949</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Fix build of test under Mac OS X. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12767" target="_blank" rel="noopener noreferrer">#12767</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12772" target="_blank" rel="noopener noreferrer">#12772</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Connector-ODBC updated to mysql-connector-odbc-8.0.21. <a href="https://github.com/ClickHouse/ClickHouse/pull/12739" target="_blank" rel="noopener noreferrer">#12739</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Adding RBAC syntax tests in TestFlows. <a href="https://github.com/ClickHouse/ClickHouse/pull/12642" target="_blank" rel="noopener noreferrer">#12642</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Improve performance of TestKeeper. This will speedup tests with heavy usage of Replicated tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/12505" target="_blank" rel="noopener noreferrer">#12505</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now we check that server is able to start after stress tests run. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12473" target="_blank" rel="noopener noreferrer">#12473</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12496" target="_blank" rel="noopener noreferrer">#12496</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Update fmtlib to master (7.0.1). <a href="https://github.com/ClickHouse/ClickHouse/pull/12446" target="_blank" rel="noopener noreferrer">#12446</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add docker image for fast tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/12294" target="_blank" rel="noopener noreferrer">#12294</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Rework configuration paths for integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/12285" target="_blank" rel="noopener noreferrer">#12285</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Add compiler option to control that stack frames are not too large. This will help to run the code in fibers with small stack size. <a href="https://github.com/ClickHouse/ClickHouse/pull/11524" target="_blank" rel="noopener noreferrer">#11524</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Update gitignore-files. <a href="https://github.com/ClickHouse/ClickHouse/pull/13447" target="_blank" rel="noopener noreferrer">#13447</a> (<a href="https://github.com/vladimir-golovchenko" target="_blank" rel="noopener noreferrer">vladimir-golovchenko</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-206">ClickHouse release 20.6<a class="hash-link" href="#clickhouse-release-206" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v206328-stable">ClickHouse release v20.6.3.28-stable<a class="hash-link" href="#clickhouse-release-v206328-stable" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-6">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-6" title="Direct link to heading">​</a></h4><ul><li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code>Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-6">New Feature<a class="hash-link" href="#new-feature-6" title="Direct link to heading">​</a></h4><ul><li>Added an initial implementation of <code>EXPLAIN</code> query. Syntax: <code>EXPLAIN SELECT ...</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/1118" target="_blank" rel="noopener noreferrer">#1118</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11873" target="_blank" rel="noopener noreferrer">#11873</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Added storage <code>RabbitMQ</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11069" target="_blank" rel="noopener noreferrer">#11069</a> (<a href="https://github.com/kssenii" target="_blank" rel="noopener noreferrer">Kseniia Sumarokova</a>).</li><li>Implemented PostgreSQL-like <code>ILIKE</code> operator for <a href="https://github.com/ClickHouse/ClickHouse/issues/11710" target="_blank" rel="noopener noreferrer">#11710</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12125" target="_blank" rel="noopener noreferrer">#12125</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Supported RIGHT and FULL JOIN with <code>SET join_algorithm = &#x27;partial_merge&#x27;</code>. Only ALL strictness is allowed (ANY, SEMI, ANTI, ASOF are not). <a href="https://github.com/ClickHouse/ClickHouse/pull/12118" target="_blank" rel="noopener noreferrer">#12118</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Added a function <code>initializeAggregation</code> to initialize an aggregation based on a single value. <a href="https://github.com/ClickHouse/ClickHouse/pull/12109" target="_blank" rel="noopener noreferrer">#12109</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>).</li><li>Supported <code>ALTER TABLE ... [ADD|MODIFY] COLUMN ... FIRST</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/4006" target="_blank" rel="noopener noreferrer">#4006</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12073" target="_blank" rel="noopener noreferrer">#12073</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Added function <code>parseDateTimeBestEffortUS</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12028" target="_blank" rel="noopener noreferrer">#12028</a> (<a href="https://github.com/ucasFL" target="_blank" rel="noopener noreferrer">flynn</a>).</li><li>Support format <code>ORC</code> for output (was supported only for input). <a href="https://github.com/ClickHouse/ClickHouse/pull/11662" target="_blank" rel="noopener noreferrer">#11662</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-25">Bug Fix<a class="hash-link" href="#bug-fix-25" title="Direct link to heading">​</a></h4><ul><li>Fixed <code>aggregate function any(x) is found inside another aggregate function in query</code> error with <code>SET optimize_move_functions_out_of_any = 1</code> and aliases inside <code>any()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13419" target="_blank" rel="noopener noreferrer">#13419</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fixed <code>PrettyCompactMonoBlock</code> for clickhouse-local. Fixed extremes/totals with <code>PrettyCompactMonoBlock</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7746" target="_blank" rel="noopener noreferrer">#7746</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13394" target="_blank" rel="noopener noreferrer">#13394</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed possible error <code>Totals having transform was already added to pipeline</code> in case of a query from delayed replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/13290" target="_blank" rel="noopener noreferrer">#13290</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>The server may crash if user passed specifically crafted arguments to the function <code>h3ToChildren</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13275" target="_blank" rel="noopener noreferrer">#13275</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13277" target="_blank" rel="noopener noreferrer">#13277</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potentially low performance and slightly incorrect result for <code>uniqExact</code>, <code>topK</code>, <code>sumDistinct</code> and similar aggregate functions called on Float types with NaN values. It also triggered assert in debug build. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12491" target="_blank" rel="noopener noreferrer">#12491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13254" target="_blank" rel="noopener noreferrer">#13254</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed function if with nullable constexpr as cond that is not literal NULL. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12463" target="_blank" rel="noopener noreferrer">#12463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13226" target="_blank" rel="noopener noreferrer">#13226</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed assert in <code>arrayElement</code> function in case of array elements are Nullable and array subscript is also Nullable. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12172" target="_blank" rel="noopener noreferrer">#12172</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13224" target="_blank" rel="noopener noreferrer">#13224</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>DateTime64</code> conversion functions with constant argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/13205" target="_blank" rel="noopener noreferrer">#13205</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed wrong index analysis with functions. It could lead to pruning wrong parts, while reading from <code>MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13060" target="_blank" rel="noopener noreferrer">#13060</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12406" target="_blank" rel="noopener noreferrer">#12406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13081" target="_blank" rel="noopener noreferrer">#13081</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed error <code>Cannot convert column because it is constant but values of constants are different in source and result</code> for remote queries which use deterministic functions in scope of query, but not deterministic between queries, like <code>now()</code>, <code>now64()</code>, <code>randConstant()</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11327" target="_blank" rel="noopener noreferrer">#11327</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13075" target="_blank" rel="noopener noreferrer">#13075</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed unnecessary limiting for the number of threads for selects from local replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/12840" target="_blank" rel="noopener noreferrer">#12840</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed rare bug when <code>ALTER DELETE</code> and <code>ALTER MODIFY COLUMN</code> queries executed simultaneously as a single mutation. Bug leads to an incorrect amount of rows in <code>count.txt</code> and as a consequence incorrect data in part. Also, fix a small bug with simultaneous <code>ALTER RENAME COLUMN</code> and <code>ALTER ADD COLUMN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12760" target="_blank" rel="noopener noreferrer">#12760</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>CAST(Nullable(String), Enum())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12745" target="_blank" rel="noopener noreferrer">#12745</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed a performance with large tuples, which are interpreted as functions in <code>IN</code> section. The case when user write <code>WHERE x IN tuple(1, 2, ...)</code> instead of <code>WHERE x IN (1, 2, ...)</code> for some obscure reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/12700" target="_blank" rel="noopener noreferrer">#12700</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed memory tracking for <code>input_format_parallel_parsing</code> (by attaching thread to group). <a href="https://github.com/ClickHouse/ClickHouse/pull/12672" target="_blank" rel="noopener noreferrer">#12672</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed bloom filter index with const expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10572" target="_blank" rel="noopener noreferrer">#10572</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12659" target="_blank" rel="noopener noreferrer">#12659</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <code>SIGSEGV</code> in <code>StorageKafka</code> when broker is unavailable (and not only). <a href="https://github.com/ClickHouse/ClickHouse/pull/12658" target="_blank" rel="noopener noreferrer">#12658</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added support for function <code>if</code> with <code>Array(UUID)</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11066" target="_blank" rel="noopener noreferrer">#11066</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12648" target="_blank" rel="noopener noreferrer">#12648</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li><code>CREATE USER IF NOT EXISTS</code> now does not throw exception if the user exists. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12507" target="_blank" rel="noopener noreferrer">#12507</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12646" target="_blank" rel="noopener noreferrer">#12646</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Better exception message in disk access storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/12625" target="_blank" rel="noopener noreferrer">#12625</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>The function <code>groupArrayMoving*</code> was not working for distributed queries. It&#x27;s result was calculated within incorrect data type (without promotion to the largest type). The function <code>groupArrayMovingAvg</code> was returning integer number that was inconsistent with the <code>avg</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12568" target="_blank" rel="noopener noreferrer">#12568</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12622" target="_blank" rel="noopener noreferrer">#12622</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed lack of aliases with function <code>any</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12593" target="_blank" rel="noopener noreferrer">#12593</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed race condition in external dictionaries with cache layout which can lead server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/12566" target="_blank" rel="noopener noreferrer">#12566</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Remove data for Distributed tables (blocks from async INSERTs) on DROP TABLE. <a href="https://github.com/ClickHouse/ClickHouse/pull/12556" target="_blank" rel="noopener noreferrer">#12556</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed bug which lead to broken old parts after <code>ALTER DELETE</code> query when <code>enable_mixed_granularity_parts=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12536" target="_blank" rel="noopener noreferrer">#12536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12543" target="_blank" rel="noopener noreferrer">#12543</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Better exception for function <code>in</code> with invalid number of arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12529" target="_blank" rel="noopener noreferrer">#12529</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixing race condition in live view tables which could cause data duplication. <a href="https://github.com/ClickHouse/ClickHouse/pull/12519" target="_blank" rel="noopener noreferrer">#12519</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Fixed performance issue, while reading from compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12492" target="_blank" rel="noopener noreferrer">#12492</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed backwards compatibility in binary format of <code>AggregateFunction(avg, ...)</code> values. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12342" target="_blank" rel="noopener noreferrer">#12342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12486" target="_blank" rel="noopener noreferrer">#12486</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed SETTINGS parse after FORMAT. <a href="https://github.com/ClickHouse/ClickHouse/pull/12480" target="_blank" rel="noopener noreferrer">#12480</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed the deadlock if <code>text_log</code> is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/12452" target="_blank" rel="noopener noreferrer">#12452</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed overflow when very large <code>LIMIT</code> or <code>OFFSET</code> is specified. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10470" target="_blank" rel="noopener noreferrer">#10470</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11372" target="_blank" rel="noopener noreferrer">#11372</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12427" target="_blank" rel="noopener noreferrer">#12427</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed possible segfault if <code>StorageMerge</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12054" target="_blank" rel="noopener noreferrer">#12054</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12401" target="_blank" rel="noopener noreferrer">#12401</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Reverted change introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/11079" target="_blank" rel="noopener noreferrer">#11079</a> to resolve <a href="https://github.com/ClickHouse/ClickHouse/issues/12098" target="_blank" rel="noopener noreferrer">#12098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12397" target="_blank" rel="noopener noreferrer">#12397</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Additional check for arguments of bloom filter index. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11408" target="_blank" rel="noopener noreferrer">#11408</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12388" target="_blank" rel="noopener noreferrer">#12388</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Avoid exception when negative or floating point constant is used in WHERE condition for indexed tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11905" target="_blank" rel="noopener noreferrer">#11905</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12384" target="_blank" rel="noopener noreferrer">#12384</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allowed to <code>CLEAR</code> column even if there are depending <code>DEFAULT</code> expressions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12333" target="_blank" rel="noopener noreferrer">#12333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12378" target="_blank" rel="noopener noreferrer">#12378</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>TOTALS/ROLLUP/CUBE</code> for aggregate functions with <code>-State</code> and <code>Nullable</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12163" target="_blank" rel="noopener noreferrer">#12163</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12376" target="_blank" rel="noopener noreferrer">#12376</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed error message and exit codes for <code>ALTER RENAME COLUMN</code> queries, when <code>RENAME</code> is not allowed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12301" target="_blank" rel="noopener noreferrer">#12301</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/12303" target="_blank" rel="noopener noreferrer">#12303</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12335" target="_blank" rel="noopener noreferrer">#12335</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed very rare race condition in <code>ReplicatedMergeTreeQueue</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12315" target="_blank" rel="noopener noreferrer">#12315</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>When using codec <code>Delta</code> or <code>DoubleDelta</code> with non fixed width types, exception with code <code>LOGICAL_ERROR</code> was returned instead of exception with code <code>BAD_ARGUMENTS</code> (we ensure that exceptions with code logical error never happen). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12110" target="_blank" rel="noopener noreferrer">#12110</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12308" target="_blank" rel="noopener noreferrer">#12308</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed order of columns in <code>WITH FILL</code> modifier. Previously order of columns of <code>ORDER BY</code> statement wasn&#x27;t respected. <a href="https://github.com/ClickHouse/ClickHouse/pull/12306" target="_blank" rel="noopener noreferrer">#12306</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Avoid &quot;bad cast&quot; exception when there is an expression that filters data by virtual columns (like <code>_table</code> in <code>Merge</code> tables) or by &quot;index&quot; columns in system tables such as filtering by database name when querying from <code>system.tables</code>, and this expression returns <code>Nullable</code> type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12166" target="_blank" rel="noopener noreferrer">#12166</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12305" target="_blank" rel="noopener noreferrer">#12305</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>TTL</code> after renaming column, on which depends TTL expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/12304" target="_blank" rel="noopener noreferrer">#12304</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed SIGSEGV if there is an message with error in the middle of the batch in <code>Kafka</code> Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/12302" target="_blank" rel="noopener noreferrer">#12302</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed the situation when some threads might randomly hang for a few seconds during <code>DNS</code> cache updating. <a href="https://github.com/ClickHouse/ClickHouse/pull/12296" target="_blank" rel="noopener noreferrer">#12296</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed typo in setting name. <a href="https://github.com/ClickHouse/ClickHouse/pull/12292" target="_blank" rel="noopener noreferrer">#12292</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Show error after <code>TrieDictionary</code> failed to load. <a href="https://github.com/ClickHouse/ClickHouse/pull/12290" target="_blank" rel="noopener noreferrer">#12290</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>The function <code>arrayFill</code> worked incorrectly for empty arrays that may lead to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12263" target="_blank" rel="noopener noreferrer">#12263</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12279" target="_blank" rel="noopener noreferrer">#12279</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Implement conversions to the common type for <code>LowCardinality</code> types. This allows to execute UNION ALL of tables with columns of LowCardinality and other columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8212" target="_blank" rel="noopener noreferrer">#8212</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4342" target="_blank" rel="noopener noreferrer">#4342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12275" target="_blank" rel="noopener noreferrer">#12275</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the behaviour on reaching redirect limit in request to <code>S3</code> storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/12256" target="_blank" rel="noopener noreferrer">#12256</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Fixed the behaviour when during multiple sequential inserts in <code>StorageFile</code> header for some special types was written more than once. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/6155" target="_blank" rel="noopener noreferrer">#6155</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12197" target="_blank" rel="noopener noreferrer">#12197</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed logical functions for UInt8 values when they are not equal to 0 or 1. <a href="https://github.com/ClickHouse/ClickHouse/pull/12196" target="_blank" rel="noopener noreferrer">#12196</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Cap max_memory_usage* limits to the process resident memory. <a href="https://github.com/ClickHouse/ClickHouse/pull/12182" target="_blank" rel="noopener noreferrer">#12182</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix dictGet arguments check during <code>GROUP BY</code> injective functions elimination. <a href="https://github.com/ClickHouse/ClickHouse/pull/12179" target="_blank" rel="noopener noreferrer">#12179</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed the behaviour when <code>SummingMergeTree</code> engine sums up columns from partition key. Added an exception in case of explicit definition of columns to sum which intersects with partition key columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7867" target="_blank" rel="noopener noreferrer">#7867</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12173" target="_blank" rel="noopener noreferrer">#12173</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Don&#x27;t split the dictionary source&#x27;s table name into schema and table name itself if ODBC connection does not support schema. <a href="https://github.com/ClickHouse/ClickHouse/pull/12165" target="_blank" rel="noopener noreferrer">#12165</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed wrong logic in <code>ALTER DELETE</code> that leads to deleting of records when condition evaluates to NULL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9088" target="_blank" rel="noopener noreferrer">#9088</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12106" target="_blank" rel="noopener noreferrer">#12106</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12153" target="_blank" rel="noopener noreferrer">#12153</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed transform of query to send to external DBMS (e.g. MySQL, ODBC) in presense of aliases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12032" target="_blank" rel="noopener noreferrer">#12032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12151" target="_blank" rel="noopener noreferrer">#12151</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed bad code in redundant ORDER BY optimization. The bug was introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/10067" target="_blank" rel="noopener noreferrer">#10067</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12148" target="_blank" rel="noopener noreferrer">#12148</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potential overflow in integer division. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12119" target="_blank" rel="noopener noreferrer">#12119</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12140" target="_blank" rel="noopener noreferrer">#12140</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potential infinite loop in <code>greatCircleDistance</code>, <code>geoDistance</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12117" target="_blank" rel="noopener noreferrer">#12117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12137" target="_blank" rel="noopener noreferrer">#12137</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Normalize &quot;pid&quot; file handling. In previous versions the server may refuse to start if it was killed without proper shutdown and if there is another process that has the same pid as previously runned server. Also pid file may be removed in unsuccessful server startup even if there is another server running. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3501" target="_blank" rel="noopener noreferrer">#3501</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12133" target="_blank" rel="noopener noreferrer">#12133</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed bug which leads to incorrect table metadata in ZooKeepeer for ReplicatedVersionedCollapsingMergeTree tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12093" target="_blank" rel="noopener noreferrer">#12093</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12121" target="_blank" rel="noopener noreferrer">#12121</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Avoid &quot;There is no query&quot; exception for materialized views with joins or with subqueries attached to system logs (system.query_log, metric_log, etc) or to engine=Buffer underlying table. <a href="https://github.com/ClickHouse/ClickHouse/pull/12120" target="_blank" rel="noopener noreferrer">#12120</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed handling dependency of table with ENGINE=Dictionary on dictionary. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10994" target="_blank" rel="noopener noreferrer">#10994</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10397" target="_blank" rel="noopener noreferrer">#10397</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12116" target="_blank" rel="noopener noreferrer">#12116</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Format <code>Parquet</code> now properly works with <code>LowCardinality</code> and <code>LowCardinality(Nullable)</code> types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12086" target="_blank" rel="noopener noreferrer">#12086</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/8406" target="_blank" rel="noopener noreferrer">#8406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12108" target="_blank" rel="noopener noreferrer">#12108</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed performance for selects with <code>UNION</code> caused by wrong limit for the total number of threads. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12030" target="_blank" rel="noopener noreferrer">#12030</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12103" target="_blank" rel="noopener noreferrer">#12103</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed segfault with <code>-StateResample</code> combinators. <a href="https://github.com/ClickHouse/ClickHouse/pull/12092" target="_blank" rel="noopener noreferrer">#12092</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed empty <code>result_rows</code> and <code>result_bytes</code> metrics in <code>system.quey_log</code> for selects. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11595" target="_blank" rel="noopener noreferrer">#11595</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12089" target="_blank" rel="noopener noreferrer">#12089</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed unnecessary limiting the number of threads for selects from <code>VIEW</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11937" target="_blank" rel="noopener noreferrer">#11937</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12085" target="_blank" rel="noopener noreferrer">#12085</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed SIGSEGV in StorageKafka on DROP TABLE. <a href="https://github.com/ClickHouse/ClickHouse/pull/12075" target="_blank" rel="noopener noreferrer">#12075</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed possible crash while using wrong type for <code>PREWHERE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12053" target="_blank" rel="noopener noreferrer">#12053</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12060" target="_blank" rel="noopener noreferrer">#12060</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12060" target="_blank" rel="noopener noreferrer">#12060</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed error <code>Cannot capture column</code> for higher-order functions with <code>Tuple(LowCardinality)</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9766" target="_blank" rel="noopener noreferrer">#9766</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12055" target="_blank" rel="noopener noreferrer">#12055</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed constraints check if constraint is a constant expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11360" target="_blank" rel="noopener noreferrer">#11360</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12042" target="_blank" rel="noopener noreferrer">#12042</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed wrong result and potential crash when invoking function <code>if</code> with arguments of type <code>FixedString</code> with different sizes. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11362" target="_blank" rel="noopener noreferrer">#11362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12021" target="_blank" rel="noopener noreferrer">#12021</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-14">Improvement<a class="hash-link" href="#improvement-14" title="Direct link to heading">​</a></h4><ul><li>Allowed to set <code>JOIN</code> kind and type in more standard way: <code>LEFT SEMI JOIN</code> instead of <code>SEMI LEFT JOIN</code>. For now both are correct. <a href="https://github.com/ClickHouse/ClickHouse/pull/12520" target="_blank" rel="noopener noreferrer">#12520</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>lifetime_rows/lifetime_bytes for Buffer engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/12421" target="_blank" rel="noopener noreferrer">#12421</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Write the detail exception message to the client instead of &#x27;MySQL server has gone away&#x27;. <a href="https://github.com/ClickHouse/ClickHouse/pull/12383" target="_blank" rel="noopener noreferrer">#12383</a> (<a href="https://github.com/BohuTANG" target="_blank" rel="noopener noreferrer">BohuTANG</a>).</li><li>Allows to change a charset which is used for printing grids borders. Available charsets are following: UTF-8, ASCII. Setting <code>output_format_pretty_grid_charset</code> enables this feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/12372" target="_blank" rel="noopener noreferrer">#12372</a> (<a href="https://github.com/s-mx" target="_blank" rel="noopener noreferrer">Sabyanin Maxim</a>).</li><li>Supported MySQL &#x27;SELECT DATABASE()&#x27; <a href="https://github.com/ClickHouse/ClickHouse/issues/9336" target="_blank" rel="noopener noreferrer">#9336</a> 2. Add MySQL replacement query integration test. <a href="https://github.com/ClickHouse/ClickHouse/pull/12314" target="_blank" rel="noopener noreferrer">#12314</a> (<a href="https://github.com/BohuTANG" target="_blank" rel="noopener noreferrer">BohuTANG</a>).</li><li>Added <code>KILL QUERY [connection_id]</code> for the MySQL client/driver to cancel the long query, issue <a href="https://github.com/ClickHouse/ClickHouse/issues/12038" target="_blank" rel="noopener noreferrer">#12038</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12152" target="_blank" rel="noopener noreferrer">#12152</a> (<a href="https://github.com/BohuTANG" target="_blank" rel="noopener noreferrer">BohuTANG</a>).</li><li>Added support for <code>%g</code> (two digit ISO year) and <code>%G</code> (four digit ISO year) substitutions in <code>formatDateTime</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/12136" target="_blank" rel="noopener noreferrer">#12136</a> (<a href="https://github.com/vivarum" target="_blank" rel="noopener noreferrer">vivarum</a>).</li><li>Added &#x27;type&#x27; column in system.disks. <a href="https://github.com/ClickHouse/ClickHouse/pull/12115" target="_blank" rel="noopener noreferrer">#12115</a> (<a href="https://github.com/ianton-ru" target="_blank" rel="noopener noreferrer">ianton-ru</a>).</li><li>Improved <code>REVOKE</code> command: now it requires grant/admin option for only access which will be revoked. For example, to execute <code>REVOKE ALL ON *.* FROM user1</code> now it does not require to have full access rights granted with grant option. Added command <code>REVOKE ALL FROM user1</code> - it revokes all granted roles from <code>user1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12083" target="_blank" rel="noopener noreferrer">#12083</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Added replica priority for load_balancing (for manual prioritization of the load balancing). <a href="https://github.com/ClickHouse/ClickHouse/pull/11995" target="_blank" rel="noopener noreferrer">#11995</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Switched paths in S3 metadata to relative which allows to handle S3 blobs more easily. <a href="https://github.com/ClickHouse/ClickHouse/pull/11892" target="_blank" rel="noopener noreferrer">#11892</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-7">Performance Improvement<a class="hash-link" href="#performance-improvement-7" title="Direct link to heading">​</a></h4><ul><li>Improved performace of &#x27;ORDER BY&#x27; and &#x27;GROUP BY&#x27; by prefix of sorting key (enabled with <code>optimize_aggregation_in_order</code> setting, disabled by default). <a href="https://github.com/ClickHouse/ClickHouse/pull/11696" target="_blank" rel="noopener noreferrer">#11696</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Removed injective functions inside <code>uniq*()</code> if <code>set optimize_injective_functions_inside_uniq=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12337" target="_blank" rel="noopener noreferrer">#12337</a> (<a href="https://github.com/kamalov-ruslan" target="_blank" rel="noopener noreferrer">Ruslan Kamalov</a>).</li><li>Index not used for IN operator with literals, performance regression introduced around v19.3. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10574" target="_blank" rel="noopener noreferrer">#10574</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12062" target="_blank" rel="noopener noreferrer">#12062</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li><li>Implemented single part uploads for DiskS3 (experimental feature). <a href="https://github.com/ClickHouse/ClickHouse/pull/12026" target="_blank" rel="noopener noreferrer">#12026</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-4">Experimental Feature<a class="hash-link" href="#experimental-feature-4" title="Direct link to heading">​</a></h4><ul><li>Added new in-memory format of parts in <code>MergeTree</code>-family tables, which stores data in memory. Parts are written on disk at first merge. Part will be created in in-memory format if its size in rows or bytes is below thresholds <code>min_rows_for_compact_part</code> and <code>min_bytes_for_compact_part</code>. Also optional support of Write-Ahead-Log is available, which is enabled by default and is controlled by setting <code>in_memory_parts_enable_wal</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10697" target="_blank" rel="noopener noreferrer">#10697</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-9">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-9" title="Direct link to heading">​</a></h4><ul><li>Implement AST-based query fuzzing mode for clickhouse-client. See <a href="https://github.com/ClickHouse/ClickHouse/issues?q=label%3Afuzz+is%3Aissue" target="_blank" rel="noopener noreferrer">this label</a> for the list of issues we recently found by fuzzing. Most of them were found by this tool, and a couple by SQLancer and <code>00746_sql_fuzzy.pl</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12111" target="_blank" rel="noopener noreferrer">#12111</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Add new type of tests based on Testflows framework. <a href="https://github.com/ClickHouse/ClickHouse/pull/12090" target="_blank" rel="noopener noreferrer">#12090</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Added S3 HTTPS integration test. <a href="https://github.com/ClickHouse/ClickHouse/pull/12412" target="_blank" rel="noopener noreferrer">#12412</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Log sanitizer trap messages from separate thread. This will prevent possible deadlock under thread sanitizer. <a href="https://github.com/ClickHouse/ClickHouse/pull/12313" target="_blank" rel="noopener noreferrer">#12313</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now functional and stress tests will be able to run with old version of <code>clickhouse-test</code> script. <a href="https://github.com/ClickHouse/ClickHouse/pull/12287" target="_blank" rel="noopener noreferrer">#12287</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Remove strange file creation during build in <code>orc</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12258" target="_blank" rel="noopener noreferrer">#12258</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Place common docker compose files to integration docker container. <a href="https://github.com/ClickHouse/ClickHouse/pull/12168" target="_blank" rel="noopener noreferrer">#12168</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Fix warnings from CodeQL. <code>CodeQL</code> is another static analyzer that we will use along with <code>clang-tidy</code> and <code>PVS-Studio</code> that we use already. <a href="https://github.com/ClickHouse/ClickHouse/pull/12138" target="_blank" rel="noopener noreferrer">#12138</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Minor CMake fixes for UNBUNDLED build. <a href="https://github.com/ClickHouse/ClickHouse/pull/12131" target="_blank" rel="noopener noreferrer">#12131</a> (<a href="https://github.com/matwey" target="_blank" rel="noopener noreferrer">Matwey V. Kornilov</a>).</li><li>Added a showcase of the minimal Docker image without using any Linux distribution. <a href="https://github.com/ClickHouse/ClickHouse/pull/12126" target="_blank" rel="noopener noreferrer">#12126</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Perform an upgrade of system packages in the <code>clickhouse-server</code> docker image. <a href="https://github.com/ClickHouse/ClickHouse/pull/12124" target="_blank" rel="noopener noreferrer">#12124</a> (<a href="https://github.com/blinkov" target="_blank" rel="noopener noreferrer">Ivan Blinkov</a>).</li><li>Add <code>UNBUNDLED</code> flag to <code>system.build_options</code> table. Move skip lists for <code>clickhouse-test</code> to clickhouse repo. <a href="https://github.com/ClickHouse/ClickHouse/pull/12107" target="_blank" rel="noopener noreferrer">#12107</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Regular check by <a href="https://docs.anchore.com" target="_blank" rel="noopener noreferrer">Anchore Container Analysis</a> security analysis tool that looks for <a href="https://cve.mitre.org/" target="_blank" rel="noopener noreferrer">CVE</a> in <code>clickhouse-server</code> Docker image. Also confirms that <code>Dockerfile</code> is buildable. Runs daily on <code>master</code> and on pull-requests to <code>Dockerfile</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12102" target="_blank" rel="noopener noreferrer">#12102</a> (<a href="https://github.com/blinkov" target="_blank" rel="noopener noreferrer">Ivan Blinkov</a>).</li><li>Daily check by <a href="https://securitylab.github.com/tools/codeql" target="_blank" rel="noopener noreferrer">GitHub CodeQL</a> security analysis tool that looks for <a href="https://cwe.mitre.org/" target="_blank" rel="noopener noreferrer">CWE</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12101" target="_blank" rel="noopener noreferrer">#12101</a> (<a href="https://github.com/blinkov" target="_blank" rel="noopener noreferrer">Ivan Blinkov</a>).</li><li>Install <code>ca-certificates</code> before the first <code>apt-get update</code> in Dockerfile. <a href="https://github.com/ClickHouse/ClickHouse/pull/12095" target="_blank" rel="noopener noreferrer">#12095</a> (<a href="https://github.com/blinkov" target="_blank" rel="noopener noreferrer">Ivan Blinkov</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-205">ClickHouse release 20.5<a class="hash-link" href="#clickhouse-release-205" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v205440-stable-2020-08-10">ClickHouse release v20.5.4.40-stable 2020-08-10<a class="hash-link" href="#clickhouse-release-v205440-stable-2020-08-10" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-26">Bug Fix<a class="hash-link" href="#bug-fix-26" title="Direct link to heading">​</a></h4><ul><li>Fixed wrong index analysis with functions. It could lead to pruning wrong parts, while reading from <code>MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13060" target="_blank" rel="noopener noreferrer">#13060</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12406" target="_blank" rel="noopener noreferrer">#12406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13081" target="_blank" rel="noopener noreferrer">#13081</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed unnecessary limiting for the number of threads for selects from local replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/12840" target="_blank" rel="noopener noreferrer">#12840</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed performance with large tuples, which are interpreted as functions in <code>IN</code> section. The case when user write <code>WHERE x IN tuple(1, 2, ...)</code> instead of <code>WHERE x IN (1, 2, ...)</code> for some obscure reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/12700" target="_blank" rel="noopener noreferrer">#12700</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed memory tracking for input_format_parallel_parsing (by attaching thread to group). <a href="https://github.com/ClickHouse/ClickHouse/pull/12672" target="_blank" rel="noopener noreferrer">#12672</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed bloom filter index with const expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10572" target="_blank" rel="noopener noreferrer">#10572</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12659" target="_blank" rel="noopener noreferrer">#12659</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <code>SIGSEGV</code> in <code>StorageKafka</code> when broker is unavailable (and not only). <a href="https://github.com/ClickHouse/ClickHouse/pull/12658" target="_blank" rel="noopener noreferrer">#12658</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added support for function <code>if</code> with <code>Array(UUID)</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11066" target="_blank" rel="noopener noreferrer">#11066</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12648" target="_blank" rel="noopener noreferrer">#12648</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed lack of aliases with function <code>any</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12593" target="_blank" rel="noopener noreferrer">#12593</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed race condition in external dictionaries with cache layout which can lead server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/12566" target="_blank" rel="noopener noreferrer">#12566</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Remove data for Distributed tables (blocks from async INSERTs) on DROP TABLE. <a href="https://github.com/ClickHouse/ClickHouse/pull/12556" target="_blank" rel="noopener noreferrer">#12556</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed bug which lead to broken old parts after <code>ALTER DELETE</code> query when <code>enable_mixed_granularity_parts=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12536" target="_blank" rel="noopener noreferrer">#12536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12543" target="_blank" rel="noopener noreferrer">#12543</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Better exception for function <code>in</code> with invalid number of arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12529" target="_blank" rel="noopener noreferrer">#12529</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed race condition in live view tables which could cause data duplication. <a href="https://github.com/ClickHouse/ClickHouse/pull/12519" target="_blank" rel="noopener noreferrer">#12519</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Fixed performance issue, while reading from compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12492" target="_blank" rel="noopener noreferrer">#12492</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed backwards compatibility in binary format of <code>AggregateFunction(avg, ...)</code> values. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12342" target="_blank" rel="noopener noreferrer">#12342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12486" target="_blank" rel="noopener noreferrer">#12486</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the deadlock if <code>text_log</code> is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/12452" target="_blank" rel="noopener noreferrer">#12452</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed overflow when very large LIMIT or OFFSET is specified. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10470" target="_blank" rel="noopener noreferrer">#10470</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11372" target="_blank" rel="noopener noreferrer">#11372</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12427" target="_blank" rel="noopener noreferrer">#12427</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed possible segfault if StorageMerge. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12054" target="_blank" rel="noopener noreferrer">#12054</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12401" target="_blank" rel="noopener noreferrer">#12401</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Reverts change introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/11079" target="_blank" rel="noopener noreferrer">#11079</a> to resolve <a href="https://github.com/ClickHouse/ClickHouse/issues/12098" target="_blank" rel="noopener noreferrer">#12098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12397" target="_blank" rel="noopener noreferrer">#12397</a> (<a href="https://github.com/myrrc" target="_blank" rel="noopener noreferrer">Mike</a>).</li><li>Avoid exception when negative or floating point constant is used in WHERE condition for indexed tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11905" target="_blank" rel="noopener noreferrer">#11905</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12384" target="_blank" rel="noopener noreferrer">#12384</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow to CLEAR column even if there are depending DEFAULT expressions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12333" target="_blank" rel="noopener noreferrer">#12333</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12378" target="_blank" rel="noopener noreferrer">#12378</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed TOTALS/ROLLUP/CUBE for aggregate functions with <code>-State</code> and <code>Nullable</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12163" target="_blank" rel="noopener noreferrer">#12163</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12376" target="_blank" rel="noopener noreferrer">#12376</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed SIGSEGV if there is an message with error in the middle of the batch in <code>Kafka</code> Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/12302" target="_blank" rel="noopener noreferrer">#12302</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed the behaviour when <code>SummingMergeTree</code> engine sums up columns from partition key. Added an exception in case of explicit definition of columns to sum which intersects with partition key columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7867" target="_blank" rel="noopener noreferrer">#7867</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12173" target="_blank" rel="noopener noreferrer">#12173</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed transform of query to send to external DBMS (e.g. MySQL, ODBC) in presense of aliases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12032" target="_blank" rel="noopener noreferrer">#12032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12151" target="_blank" rel="noopener noreferrer">#12151</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed bug which leads to incorrect table metadata in ZooKeepeer for ReplicatedVersionedCollapsingMergeTree tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12093" target="_blank" rel="noopener noreferrer">#12093</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12121" target="_blank" rel="noopener noreferrer">#12121</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed unnecessary limiting the number of threads for selects from <code>VIEW</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11937" target="_blank" rel="noopener noreferrer">#11937</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12085" target="_blank" rel="noopener noreferrer">#12085</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed crash in JOIN with LowCardinality type with <code>join_algorithm=partial_merge</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12035" target="_blank" rel="noopener noreferrer">#12035</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fixed wrong result for <code>if()</code> with NULLs in condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/11807" target="_blank" rel="noopener noreferrer">#11807</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-8">Performance Improvement<a class="hash-link" href="#performance-improvement-8" title="Direct link to heading">​</a></h4><ul><li>Index not used for IN operator with literals, performance regression introduced around v19.3. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10574" target="_blank" rel="noopener noreferrer">#10574</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12062" target="_blank" rel="noopener noreferrer">#12062</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-10">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-10" title="Direct link to heading">​</a></h4><ul><li>Install <code>ca-certificates</code> before the first <code>apt-get update</code> in Dockerfile. <a href="https://github.com/ClickHouse/ClickHouse/pull/12095" target="_blank" rel="noopener noreferrer">#12095</a> (<a href="https://github.com/blinkov" target="_blank" rel="noopener noreferrer">Ivan Blinkov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20527-stable-2020-07-02">ClickHouse release v20.5.2.7-stable 2020-07-02<a class="hash-link" href="#clickhouse-release-v20527-stable-2020-07-02" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-7">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-7" title="Direct link to heading">​</a></h4><ul><li>Return non-Nullable result from COUNT(DISTINCT), and <code>uniq</code> aggregate functions family. If all passed values are NULL, return zero instead. This improves SQL compatibility. <a href="https://github.com/ClickHouse/ClickHouse/pull/11661" target="_blank" rel="noopener noreferrer">#11661</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added a check for the case when user-level setting is specified in a wrong place. User-level settings should be specified in <code>users.xml</code> inside <code>&lt;profile&gt;</code> section for specific user profile (or in <code>&lt;default&gt;</code> for default settings). The server won&#x27;t start with exception message in log. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9051" target="_blank" rel="noopener noreferrer">#9051</a>. If you want to skip the check, you can either move settings to the appropriate place or add <code>&lt;skip_check_for_incorrect_settings&gt;1&lt;/skip_check_for_incorrect_settings&gt;</code> to config.xml. <a href="https://github.com/ClickHouse/ClickHouse/pull/11449" target="_blank" rel="noopener noreferrer">#11449</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>The setting <code>input_format_with_names_use_header</code> is enabled by default. It will affect parsing of input formats <code>-WithNames</code> and <code>-WithNamesAndTypes</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10937" target="_blank" rel="noopener noreferrer">#10937</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove <code>experimental_use_processors</code> setting. It is enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/10924" target="_blank" rel="noopener noreferrer">#10924</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Update <code>zstd</code> to 1.4.4. It has some minor improvements in performance and compression ratio. If you run replicas with different versions of ClickHouse you may see reasonable error messages <code>Data after merge is not byte-identical to data on another replicas.</code> with explanation. These messages are Ok and you should not worry. This change is backward compatible but we list it here in changelog in case you will wonder about these messages. <a href="https://github.com/ClickHouse/ClickHouse/pull/10663" target="_blank" rel="noopener noreferrer">#10663</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added a check for meaningless codecs and a setting <code>allow_suspicious_codecs</code> to control this check. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/4966" target="_blank" rel="noopener noreferrer">#4966</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10645" target="_blank" rel="noopener noreferrer">#10645</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Several Kafka setting changes their defaults. See <a href="https://github.com/ClickHouse/ClickHouse/pull/11388" target="_blank" rel="noopener noreferrer">#11388</a>.</li><li>When upgrading from versions older than 20.5, if rolling update is performed and cluster contains both versions 20.5 or greater and less than 20.5, if ClickHouse nodes with old versions are restarted and old version has been started up in presence of newer versions, it may lead to <code>Part ... intersects previous part</code> errors. To prevent this error, first install newer clickhouse-server packages on all cluster nodes and then do restarts (so, when clickhouse-server is restarted, it will start up with the new version).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-7">New Feature<a class="hash-link" href="#new-feature-7" title="Direct link to heading">​</a></h4><ul><li><code>TTL DELETE WHERE</code> and <code>TTL GROUP BY</code> for automatic data coarsening and rollup in tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10537" target="_blank" rel="noopener noreferrer">#10537</a> (<a href="https://github.com/expl0si0nn" target="_blank" rel="noopener noreferrer">expl0si0nn</a>).</li><li>Implementation of PostgreSQL wire protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/10242" target="_blank" rel="noopener noreferrer">#10242</a> (<a href="https://github.com/MovElb" target="_blank" rel="noopener noreferrer">Movses</a>).</li><li>Added system tables for users, roles, grants, settings profiles, quotas, row policies; added commands SHOW USER, SHOW <!-- -->[CURRENT|ENABLED]<!-- --> ROLES, SHOW SETTINGS PROFILES. <a href="https://github.com/ClickHouse/ClickHouse/pull/10387" target="_blank" rel="noopener noreferrer">#10387</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Support writes in ODBC Table function <a href="https://github.com/ClickHouse/ClickHouse/pull/10554" target="_blank" rel="noopener noreferrer">#10554</a> (<a href="https://github.com/ageraab" target="_blank" rel="noopener noreferrer">ageraab</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10901" target="_blank" rel="noopener noreferrer">#10901</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Add query performance metrics based on Linux <code>perf_events</code> (these metrics are calculated with hardware CPU counters and OS counters). It is optional and requires <code>CAP_SYS_ADMIN</code> to be set on clickhouse binary. <a href="https://github.com/ClickHouse/ClickHouse/pull/9545" target="_blank" rel="noopener noreferrer">#9545</a> <a href="https://github.com/And42" target="_blank" rel="noopener noreferrer">Andrey Skobtsov</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11226" target="_blank" rel="noopener noreferrer">#11226</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Now support <code>NULL</code> and <code>NOT NULL</code> modifiers for data types in <code>CREATE</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/11057" target="_blank" rel="noopener noreferrer">#11057</a> (<a href="https://github.com/Potya" target="_blank" rel="noopener noreferrer">Павел Потемкин</a>).</li><li>Add <code>ArrowStream</code> input and output format. <a href="https://github.com/ClickHouse/ClickHouse/pull/11088" target="_blank" rel="noopener noreferrer">#11088</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Support Cassandra as external dictionary source. <a href="https://github.com/ClickHouse/ClickHouse/pull/4978" target="_blank" rel="noopener noreferrer">#4978</a> (<a href="https://github.com/favstovol" target="_blank" rel="noopener noreferrer">favstovol</a>).</li><li>Added a new layout <code>direct</code> which loads all the data directly from the source for each query, without storing or caching data. <a href="https://github.com/ClickHouse/ClickHouse/pull/10622" target="_blank" rel="noopener noreferrer">#10622</a> (<a href="https://github.com/kekekekule" target="_blank" rel="noopener noreferrer">Artem Streltsov</a>).</li><li>Added new <code>complex_key_direct</code> layout to dictionaries, that does not store anything locally during query execution. <a href="https://github.com/ClickHouse/ClickHouse/pull/10850" target="_blank" rel="noopener noreferrer">#10850</a> (<a href="https://github.com/kekekekule" target="_blank" rel="noopener noreferrer">Artem Streltsov</a>).</li><li>Added support for MySQL style global variables syntax (stub). This is needed for compatibility of MySQL protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/11832" target="_blank" rel="noopener noreferrer">#11832</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added syntax highligting to <code>clickhouse-client</code> using <code>replxx</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11422" target="_blank" rel="noopener noreferrer">#11422</a> (<a href="https://github.com/kuskarov" target="_blank" rel="noopener noreferrer">Tagir Kuskarov</a>).</li><li><code>minMap</code> and <code>maxMap</code> functions were added. <a href="https://github.com/ClickHouse/ClickHouse/pull/11603" target="_blank" rel="noopener noreferrer">#11603</a> (<a href="https://github.com/ildus" target="_blank" rel="noopener noreferrer">Ildus Kurbangaliev</a>).</li><li>Add the <code>system.asynchronous_metric_log</code> table that logs historical metrics from <code>system.asynchronous_metrics</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11588" target="_blank" rel="noopener noreferrer">#11588</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Add functions <code>extractAllGroupsHorizontal(haystack, re)</code> and <code>extractAllGroupsVertical(haystack, re)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11554" target="_blank" rel="noopener noreferrer">#11554</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Add SHOW CLUSTER(S) queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11467" target="_blank" rel="noopener noreferrer">#11467</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Add <code>netloc</code> function for extracting network location, similar to <code>urlparse(url)</code>, <code>netloc</code> in python. <a href="https://github.com/ClickHouse/ClickHouse/pull/11356" target="_blank" rel="noopener noreferrer">#11356</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>).</li><li>Add 2 more virtual columns for engine=Kafka to access message headers. <a href="https://github.com/ClickHouse/ClickHouse/pull/11283" target="_blank" rel="noopener noreferrer">#11283</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Add <code>_timestamp_ms</code> virtual column for Kafka engine (type is <code>Nullable(DateTime64(3))</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11260" target="_blank" rel="noopener noreferrer">#11260</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Add function <code>randomFixedString</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10866" target="_blank" rel="noopener noreferrer">#10866</a> (<a href="https://github.com/xolm" target="_blank" rel="noopener noreferrer">Andrei Nekrashevich</a>).</li><li>Add function <code>fuzzBits</code> that randomly flips bits in a string with given probability. <a href="https://github.com/ClickHouse/ClickHouse/pull/11237" target="_blank" rel="noopener noreferrer">#11237</a> (<a href="https://github.com/xolm" target="_blank" rel="noopener noreferrer">Andrei Nekrashevich</a>).</li><li>Allow comparison of numbers with constant string in comparison operators, IN and VALUES sections. <a href="https://github.com/ClickHouse/ClickHouse/pull/11647" target="_blank" rel="noopener noreferrer">#11647</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add <code>round_robin</code> load_balancing mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/11645" target="_blank" rel="noopener noreferrer">#11645</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add <code>cast_keep_nullable</code> setting. If set <code>CAST(something_nullable AS Type)</code> return <code>Nullable(Type)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11733" target="_blank" rel="noopener noreferrer">#11733</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Added column <code>position</code> to <code>system.columns</code> table and <code>column_position</code> to <code>system.parts_columns</code> table. It contains ordinal position of a column in a table starting with 1. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/7744" target="_blank" rel="noopener noreferrer">#7744</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11655" target="_blank" rel="noopener noreferrer">#11655</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>ON CLUSTER support for SYSTEM {FLUSH DISTRIBUTED,STOP/START DISTRIBUTED SEND}. <a href="https://github.com/ClickHouse/ClickHouse/pull/11415" target="_blank" rel="noopener noreferrer">#11415</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Add system.distribution_queue table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11394" target="_blank" rel="noopener noreferrer">#11394</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Support for all format settings in Kafka, expose some setting on table level, adjust the defaults for better performance. <a href="https://github.com/ClickHouse/ClickHouse/pull/11388" target="_blank" rel="noopener noreferrer">#11388</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Add <code>port</code> function (to extract port from URL). <a href="https://github.com/ClickHouse/ClickHouse/pull/11120" target="_blank" rel="noopener noreferrer">#11120</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Now <code>dictGet*</code> functions accept table names. <a href="https://github.com/ClickHouse/ClickHouse/pull/11050" target="_blank" rel="noopener noreferrer">#11050</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>The <code>clickhouse-format</code> tool is now able to format multiple queries when the <code>-n</code> argument is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/10852" target="_blank" rel="noopener noreferrer">#10852</a> (<a href="https://github.com/dgrr" target="_blank" rel="noopener noreferrer">Darío</a>).</li><li>Possibility to configure proxy-resolver for DiskS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/10744" target="_blank" rel="noopener noreferrer">#10744</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Make <code>pointInPolygon</code> work with non-constant polygon. PointInPolygon now can take Array(Array(Tuple(..., ...))) as second argument, array of polygon and holes. <a href="https://github.com/ClickHouse/ClickHouse/pull/10623" target="_blank" rel="noopener noreferrer">#10623</a> (<a href="https://github.com/livace" target="_blank" rel="noopener noreferrer">Alexey Ilyukhov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/11421" target="_blank" rel="noopener noreferrer">#11421</a> (<a href="https://github.com/livace" target="_blank" rel="noopener noreferrer">Alexey Ilyukhov</a>).</li><li>Added <code>move_ttl_info</code> to <code>system.parts</code> in order to provide introspection of move TTL functionality. <a href="https://github.com/ClickHouse/ClickHouse/pull/10591" target="_blank" rel="noopener noreferrer">#10591</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Possibility to work with S3 through proxies. <a href="https://github.com/ClickHouse/ClickHouse/pull/10576" target="_blank" rel="noopener noreferrer">#10576</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Add <code>NCHAR</code> and <code>NVARCHAR</code> synonims for data types. <a href="https://github.com/ClickHouse/ClickHouse/pull/11025" target="_blank" rel="noopener noreferrer">#11025</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Resolved <a href="https://github.com/ClickHouse/ClickHouse/issues/7224" target="_blank" rel="noopener noreferrer">#7224</a>: added <code>FailedQuery</code>, <code>FailedSelectQuery</code> and <code>FailedInsertQuery</code> metrics to <code>system.events</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11151" target="_blank" rel="noopener noreferrer">#11151</a> (<a href="https://github.com/naorlov" target="_blank" rel="noopener noreferrer">Nikita Orlov</a>).</li><li>Add more <code>jemalloc</code> statistics to <code>system.asynchronous_metrics</code>, and ensure that we see up-to-date values for them. <a href="https://github.com/ClickHouse/ClickHouse/pull/11748" target="_blank" rel="noopener noreferrer">#11748</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Allow to specify default S3 credentials and custom auth headers. <a href="https://github.com/ClickHouse/ClickHouse/pull/11134" target="_blank" rel="noopener noreferrer">#11134</a> (<a href="https://github.com/GrigoryPervakov" target="_blank" rel="noopener noreferrer">Grigory Pervakov</a>).</li><li>Added new functions to import/export DateTime64 as Int64 with various precision: <code>to-/fromUnixTimestamp64Milli/-Micro/-Nano</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10923" target="_blank" rel="noopener noreferrer">#10923</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Allow specifying <code>mongodb://</code> URI for MongoDB dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/10915" target="_blank" rel="noopener noreferrer">#10915</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>OFFSET keyword can now be used without an affiliated LIMIT clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/10802" target="_blank" rel="noopener noreferrer">#10802</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>).</li><li>Added <code>system.licenses</code> table. This table contains licenses of third-party libraries that are located in <code>contrib</code> directory. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/2890" target="_blank" rel="noopener noreferrer">#2890</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10795" target="_blank" rel="noopener noreferrer">#10795</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>New function function toStartOfSecond(DateTime64) -&gt; DateTime64 that nullifies sub-second part of DateTime64 value. <a href="https://github.com/ClickHouse/ClickHouse/pull/10722" target="_blank" rel="noopener noreferrer">#10722</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Add new input format <code>JSONAsString</code> that accepts a sequence of JSON objects separated by newlines, spaces and/or commas. <a href="https://github.com/ClickHouse/ClickHouse/pull/10607" target="_blank" rel="noopener noreferrer">#10607</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>).</li><li>Allowed to profile memory with finer granularity steps than 4 MiB. Added sampling memory profiler to capture random allocations/deallocations. <a href="https://github.com/ClickHouse/ClickHouse/pull/10598" target="_blank" rel="noopener noreferrer">#10598</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li><code>SimpleAggregateFunction</code> now also supports <code>sumMap</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10000" target="_blank" rel="noopener noreferrer">#10000</a> (<a href="https://github.com/ildus" target="_blank" rel="noopener noreferrer">Ildus Kurbangaliev</a>).</li><li>Support <code>ALTER RENAME COLUMN</code> for the distributed table engine. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/10727" target="_blank" rel="noopener noreferrer">#10727</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10747" target="_blank" rel="noopener noreferrer">#10747</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10887" target="_blank" rel="noopener noreferrer">#10887</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-27">Bug Fix<a class="hash-link" href="#bug-fix-27" title="Direct link to heading">​</a></h4><ul><li>Fix UBSan report in Decimal parse. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7540" target="_blank" rel="noopener noreferrer">#7540</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10512" target="_blank" rel="noopener noreferrer">#10512</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potential floating point exception when parsing DateTime64. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11374" target="_blank" rel="noopener noreferrer">#11374</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11875" target="_blank" rel="noopener noreferrer">#11875</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix rare crash caused by using <code>Nullable</code> column in prewhere condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/11895" target="_blank" rel="noopener noreferrer">#11895</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/11608" target="_blank" rel="noopener noreferrer">#11608</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/11869" target="_blank" rel="noopener noreferrer">#11869</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Don&#x27;t allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3933" target="_blank" rel="noopener noreferrer">#3933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11846" target="_blank" rel="noopener noreferrer">#11846</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix wrong result of comparison of FixedString with constant String. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11393" target="_blank" rel="noopener noreferrer">#11393</a>. This bug appeared in version 20.4. <a href="https://github.com/ClickHouse/ClickHouse/pull/11828" target="_blank" rel="noopener noreferrer">#11828</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix wrong result for <code>if</code> with NULLs in condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/11807" target="_blank" rel="noopener noreferrer">#11807</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix using too many threads for queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11788" target="_blank" rel="noopener noreferrer">#11788</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed <code>Scalar does not exist</code> exception when using <code>WITH &lt;scalar subquery&gt; ...</code> in <code>SELECT ... FROM merge_tree_table ...</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/11621" target="_blank" rel="noopener noreferrer">#11621</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11767" target="_blank" rel="noopener noreferrer">#11767</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix unexpected behaviour of queries like <code>SELECT *, xyz.*</code> which were success while an error expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/11753" target="_blank" rel="noopener noreferrer">#11753</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Now replicated fetches will be cancelled during metadata alter. <a href="https://github.com/ClickHouse/ClickHouse/pull/11744" target="_blank" rel="noopener noreferrer">#11744</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Parse metadata stored in zookeeper before checking for equality. <a href="https://github.com/ClickHouse/ClickHouse/pull/11739" target="_blank" rel="noopener noreferrer">#11739</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/11732" target="_blank" rel="noopener noreferrer">#11732</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix <code>ORDER BY ... WITH FILL</code> over const columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/11697" target="_blank" rel="noopener noreferrer">#11697</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix very rare race condition in SYSTEM SYNC REPLICA. If the replicated table is created and at the same time from the separate connection another client is issuing <code>SYSTEM SYNC REPLICA</code> command on that table (this is unlikely, because another client should be aware that the table is created), it&#x27;s possible to get nullptr dereference. <a href="https://github.com/ClickHouse/ClickHouse/pull/11691" target="_blank" rel="noopener noreferrer">#11691</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href="https://github.com/ClickHouse/ClickHouse/pull/11690" target="_blank" rel="noopener noreferrer">#11690</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>LIMIT n WITH TIES</code> usage together with <code>ORDER BY</code> statement, which contains aliases. <a href="https://github.com/ClickHouse/ClickHouse/pull/11689" target="_blank" rel="noopener noreferrer">#11689</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible <code>Pipeline stuck</code> for selects with parallel <code>FINAL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11636" target="_blank" rel="noopener noreferrer">#11636</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11682" target="_blank" rel="noopener noreferrer">#11682</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix error which leads to an incorrect state of <code>system.mutations</code>. It may show that whole mutation is already done but the server still has <code>MUTATE_PART</code> tasks in the replication queue and tries to execute them. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11611" target="_blank" rel="noopener noreferrer">#11611</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11681" target="_blank" rel="noopener noreferrer">#11681</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix syntax hilite in CREATE USER query. <a href="https://github.com/ClickHouse/ClickHouse/pull/11664" target="_blank" rel="noopener noreferrer">#11664</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add support for regular expressions with case-insensitive flags. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11101" target="_blank" rel="noopener noreferrer">#11101</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11506" target="_blank" rel="noopener noreferrer">#11506</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11649" target="_blank" rel="noopener noreferrer">#11649</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove trivial count query optimization if row-level security is set. In previous versions the user get total count of records in a table instead filtered. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11352" target="_blank" rel="noopener noreferrer">#11352</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11644" target="_blank" rel="noopener noreferrer">#11644</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bloom filters for String (data skipping indices). <a href="https://github.com/ClickHouse/ClickHouse/pull/11638" target="_blank" rel="noopener noreferrer">#11638</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Without <code>-q</code> option the database does not get created at startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/11604" target="_blank" rel="noopener noreferrer">#11604</a> (<a href="https://github.com/giordyb" target="_blank" rel="noopener noreferrer">giordyb</a>).</li><li>Fix error <code>Block structure mismatch</code> for queries with sampling reading from <code>Buffer</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11602" target="_blank" rel="noopener noreferrer">#11602</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix wrong exit code of the clickhouse-client, when <code>exception.code() % 256 == 0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11601" target="_blank" rel="noopener noreferrer">#11601</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix race conditions in CREATE/DROP of different replicas of ReplicatedMergeTree. Continue to work if the table was not removed completely from ZooKeeper or not created successfully. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11432" target="_blank" rel="noopener noreferrer">#11432</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11592" target="_blank" rel="noopener noreferrer">#11592</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix trivial error in log message about &quot;Mark cache size was lowered&quot; at server startup. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11399" target="_blank" rel="noopener noreferrer">#11399</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11589" target="_blank" rel="noopener noreferrer">#11589</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix error <code>Size of offsets does not match size of column</code> for queries with <code>PREWHERE column in (subquery)</code> and <code>ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11580" target="_blank" rel="noopener noreferrer">#11580</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed rare segfault in <code>SHOW CREATE TABLE</code> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11490" target="_blank" rel="noopener noreferrer">#11490</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11579" target="_blank" rel="noopener noreferrer">#11579</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>All queries in HTTP session have had the same query_id. It is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/11578" target="_blank" rel="noopener noreferrer">#11578</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href="https://github.com/ClickHouse/ClickHouse/pull/11550" target="_blank" rel="noopener noreferrer">#11550</a> (<a href="https://github.com/istarkov" target="_blank" rel="noopener noreferrer">Ivan Starkov</a>).</li><li>Fix the error <code>Data compressed with different methods</code> that can happen if <code>min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11539" target="_blank" rel="noopener noreferrer">#11539</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11540" target="_blank" rel="noopener noreferrer">#11540</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix shard_num/replica_num for <code>&lt;node&gt;</code> (breaks use_compact_format_in_distributed_parts_names). <a href="https://github.com/ClickHouse/ClickHouse/pull/11528" target="_blank" rel="noopener noreferrer">#11528</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix async INSERT into Distributed for prefer_localhost_replica=0 and w/o internal_replication. <a href="https://github.com/ClickHouse/ClickHouse/pull/11527" target="_blank" rel="noopener noreferrer">#11527</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix memory leak when exception is thrown in the middle of aggregation with <code>-State</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8995" target="_blank" rel="noopener noreferrer">#8995</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11496" target="_blank" rel="noopener noreferrer">#11496</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>Pipeline stuck</code> exception for <code>INSERT SELECT FINAL</code> where <code>SELECT</code> (<code>max_threads</code>&gt;1) has multiple streams but <code>INSERT</code> has only one (<code>max_insert_threads</code>==0). <a href="https://github.com/ClickHouse/ClickHouse/pull/11455" target="_blank" rel="noopener noreferrer">#11455</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix wrong result in queries like <code>select count() from t, u</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11454" target="_blank" rel="noopener noreferrer">#11454</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix return compressed size for codecs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11448" target="_blank" rel="noopener noreferrer">#11448</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11365" target="_blank" rel="noopener noreferrer">#11365</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11431" target="_blank" rel="noopener noreferrer">#11431</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix potential uninitialized memory read in MergeTree shutdown if table was not created successfully. <a href="https://github.com/ClickHouse/ClickHouse/pull/11420" target="_blank" rel="noopener noreferrer">#11420</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash in JOIN over <code>LowCarinality(T)</code> and <code>Nullable(T)</code>. <a href="https://github.com/ClickHouse/ClickHouse/issues/11380" target="_blank" rel="noopener noreferrer">#11380</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11414" target="_blank" rel="noopener noreferrer">#11414</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix error code for wrong <code>USING</code> key. <a href="https://github.com/ClickHouse/ClickHouse/issues/11373" target="_blank" rel="noopener noreferrer">#11373</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11404" target="_blank" rel="noopener noreferrer">#11404</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fixed <code>geohashesInBox</code> with arguments outside of latitude/longitude range. <a href="https://github.com/ClickHouse/ClickHouse/pull/11403" target="_blank" rel="noopener noreferrer">#11403</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Better errors for <code>joinGet()</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/11389" target="_blank" rel="noopener noreferrer">#11389</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix possible <code>Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11359" target="_blank" rel="noopener noreferrer">#11359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11366" target="_blank" rel="noopener noreferrer">#11366</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Remove redundant lock during parts send in ReplicatedMergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/11354" target="_blank" rel="noopener noreferrer">#11354</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix support for <code>\G</code> (vertical output) in clickhouse-client in multiline mode. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9933" target="_blank" rel="noopener noreferrer">#9933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11350" target="_blank" rel="noopener noreferrer">#11350</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potential segfault when using <code>Lazy</code> database. <a href="https://github.com/ClickHouse/ClickHouse/pull/11348" target="_blank" rel="noopener noreferrer">#11348</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash in direct selects from <code>Join</code> table engine (without JOIN) and wrong nullability. <a href="https://github.com/ClickHouse/ClickHouse/pull/11340" target="_blank" rel="noopener noreferrer">#11340</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix crash in <code>quantilesExactWeightedArray</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11337" target="_blank" rel="noopener noreferrer">#11337</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Now merges stopped before change metadata in <code>ALTER</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11335" target="_blank" rel="noopener noreferrer">#11335</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Make writing to <code>MATERIALIZED VIEW</code> with setting <code>parallel_view_processing = 1</code> parallel again. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" target="_blank" rel="noopener noreferrer">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11330" target="_blank" rel="noopener noreferrer">#11330</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix <code>visitParamExtractRaw</code> when extracted JSON has strings with unbalanced { or [. <a href="https://github.com/ClickHouse/ClickHouse/pull/11318" target="_blank" rel="noopener noreferrer">#11318</a> (<a href="https://github.com/devwout" target="_blank" rel="noopener noreferrer">Ewout</a>).</li><li>Fix very rare race condition in ThreadPool. <a href="https://github.com/ClickHouse/ClickHouse/pull/11314" target="_blank" rel="noopener noreferrer">#11314</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix insignificant data race in <code>clickhouse-copier</code>. Found by integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11313" target="_blank" rel="noopener noreferrer">#11313</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potential uninitialized memory in conversion. Example: <code>SELECT toIntervalSecond(now64())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11311" target="_blank" rel="noopener noreferrer">#11311</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code>empty</code> or <code>notEmpty</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11286" target="_blank" rel="noopener noreferrer">#11286</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11303" target="_blank" rel="noopener noreferrer">#11303</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bug when query speed estimation can be incorrect and the limit of <code>min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code>max_network_bandwidth</code>, <code>max_execution_speed</code> or <code>priority</code> settings. Change the default value of <code>timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code>min_execution_speed</code> and <code>max_execution_speed</code> have no effect. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11297" target="_blank" rel="noopener noreferrer">#11297</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5732" target="_blank" rel="noopener noreferrer">#5732</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6228" target="_blank" rel="noopener noreferrer">#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code>clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11296" target="_blank" rel="noopener noreferrer">#11296</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash when <code>SET DEFAULT ROLE</code> is called with wrong arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10586" target="_blank" rel="noopener noreferrer">#10586</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11278" target="_blank" rel="noopener noreferrer">#11278</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix crash while reading malformed data in <code>Protobuf</code> format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5957" target="_blank" rel="noopener noreferrer">#5957</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11203" target="_blank" rel="noopener noreferrer">#11203</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11258" target="_blank" rel="noopener noreferrer">#11258</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed a bug when <code>cache</code> dictionary could return default value instead of normal (when there are only expired keys). This affects only string fields. <a href="https://github.com/ClickHouse/ClickHouse/pull/11233" target="_blank" rel="noopener noreferrer">#11233</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix error <code>Block structure mismatch in QueryPipeline</code> while reading from <code>VIEW</code> with constants in inner query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11181" target="_blank" rel="noopener noreferrer">#11181</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11205" target="_blank" rel="noopener noreferrer">#11205</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix possible exception <code>Invalid status for associated output</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11200" target="_blank" rel="noopener noreferrer">#11200</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Now <code>primary.idx</code> will be checked if it&#x27;s defined in <code>CREATE</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/11199" target="_blank" rel="noopener noreferrer">#11199</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix possible error <code>Cannot capture column</code> for higher-order functions with <code>Array(Array(LowCardinality))</code> captured argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/11185" target="_blank" rel="noopener noreferrer">#11185</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed <code>S3</code> globbing which could fail in case of more than 1000 keys and some backends. <a href="https://github.com/ClickHouse/ClickHouse/pull/11179" target="_blank" rel="noopener noreferrer">#11179</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href="https://github.com/ClickHouse/ClickHouse/pull/11162" target="_blank" rel="noopener noreferrer">#11162</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix for the hang which was happening sometimes during DROP of table engine=Kafka (or during server restarts). <a href="https://github.com/ClickHouse/ClickHouse/pull/11145" target="_blank" rel="noopener noreferrer">#11145</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix excessive reserving of threads for simple queries (optimization for reducing the number of threads, which was partly broken after changes in pipeline). <a href="https://github.com/ClickHouse/ClickHouse/pull/11114" target="_blank" rel="noopener noreferrer">#11114</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Remove logging from mutation finalization task if nothing was finalized. <a href="https://github.com/ClickHouse/ClickHouse/pull/11109" target="_blank" rel="noopener noreferrer">#11109</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed deadlock during server startup after update with changes in structure of system log tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/11106" target="_blank" rel="noopener noreferrer">#11106</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed memory leak in registerDiskS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/11074" target="_blank" rel="noopener noreferrer">#11074</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fix error <code>No such name in Block::erase()</code> when JOIN appears with PREWHERE or <code>optimize_move_to_prewhere</code> makes PREWHERE from WHERE. <a href="https://github.com/ClickHouse/ClickHouse/pull/11051" target="_blank" rel="noopener noreferrer">#11051</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fixes the potential missed data during termination of Kafka engine table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11048" target="_blank" rel="noopener noreferrer">#11048</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed parseDateTime64BestEffort argument resolution bugs. <a href="https://github.com/ClickHouse/ClickHouse/issues/10925" target="_blank" rel="noopener noreferrer">#10925</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11038" target="_blank" rel="noopener noreferrer">#11038</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Now it&#x27;s possible to <code>ADD/DROP</code> and <code>RENAME</code> the same one column in a single <code>ALTER</code> query. Exception message for simultaneous <code>MODIFY</code> and <code>RENAME</code> became more clear. Partially fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10669" target="_blank" rel="noopener noreferrer">#10669</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11037" target="_blank" rel="noopener noreferrer">#11037</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed parsing of S3 URLs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11036" target="_blank" rel="noopener noreferrer">#11036</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fix memory tracking for two-level <code>GROUP BY</code> when there is a <code>LIMIT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11022" target="_blank" rel="noopener noreferrer">#11022</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix very rare potential use-after-free error in MergeTree if table was not created successfully. <a href="https://github.com/ClickHouse/ClickHouse/pull/10986" target="_blank" rel="noopener noreferrer">#10986</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix metadata (relative path for rename) and data (relative path for symlink) handling for Atomic database. <a href="https://github.com/ClickHouse/ClickHouse/pull/10980" target="_blank" rel="noopener noreferrer">#10980</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix server crash on concurrent <code>ALTER</code> and <code>DROP DATABASE</code> queries with <code>Atomic</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10968" target="_blank" rel="noopener noreferrer">#10968</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix incorrect raw data size in method getRawData(). <a href="https://github.com/ClickHouse/ClickHouse/pull/10964" target="_blank" rel="noopener noreferrer">#10964</a> (<a href="https://github.com/ObjatieGroba" target="_blank" rel="noopener noreferrer">Igr</a>).</li><li>Fix incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of GROUP BY result is large and aggregation is performed by a single String field. It leads to several unmerged rows for a single key in result. <a href="https://github.com/ClickHouse/ClickHouse/pull/10952" target="_blank" rel="noopener noreferrer">#10952</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Avoid sending partially written files by the DistributedBlockOutputStream. <a href="https://github.com/ClickHouse/ClickHouse/pull/10940" target="_blank" rel="noopener noreferrer">#10940</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix crash in <code>SELECT count(notNullIn(NULL, []))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10920" target="_blank" rel="noopener noreferrer">#10920</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix for the hang which was happening sometimes during DROP of table engine=Kafka (or during server restarts). <a href="https://github.com/ClickHouse/ClickHouse/pull/10910" target="_blank" rel="noopener noreferrer">#10910</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Now it&#x27;s possible to execute multiple <code>ALTER RENAME</code> like <code>a TO b, c TO a</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10895" target="_blank" rel="noopener noreferrer">#10895</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix possible race which could happen when you get result from aggregate function state from multiple thread for the same column. The only way (which I found) it can happen is when you use <code>finalizeAggregation</code> function while reading from table with <code>Memory</code> engine which stores <code>AggregateFunction</code> state for <code>quanite*</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/10890" target="_blank" rel="noopener noreferrer">#10890</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix backward compatibility with tuples in Distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10889" target="_blank" rel="noopener noreferrer">#10889</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix SIGSEGV in StringHashTable (if such key does not exist). <a href="https://github.com/ClickHouse/ClickHouse/pull/10870" target="_blank" rel="noopener noreferrer">#10870</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <code>WATCH</code> hangs after <code>LiveView</code> table was dropped from database with <code>Atomic</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10859" target="_blank" rel="noopener noreferrer">#10859</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed bug in <code>ReplicatedMergeTree</code> which might cause some <code>ALTER</code> on <code>OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href="https://github.com/ClickHouse/ClickHouse/pull/10849" target="_blank" rel="noopener noreferrer">#10849</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Now constraints are updated if the column participating in <code>CONSTRAINT</code> expression was renamed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10844" target="_blank" rel="noopener noreferrer">#10844</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10847" target="_blank" rel="noopener noreferrer">#10847</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix potential read of uninitialized memory in cache dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/10834" target="_blank" rel="noopener noreferrer">#10834</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix columns order after Block::sortColumns() (also add a test that shows that it affects some real use case - Buffer engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/10826" target="_blank" rel="noopener noreferrer">#10826</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix the issue with ODBC bridge when no quoting of identifiers is requested. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7984" target="_blank" rel="noopener noreferrer">#7984</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10821" target="_blank" rel="noopener noreferrer">#10821</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix UBSan and MSan report in DateLUT. <a href="https://github.com/ClickHouse/ClickHouse/pull/10798" target="_blank" rel="noopener noreferrer">#10798</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make use of <code>src_type</code> for correct type conversion in key conditions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6287" target="_blank" rel="noopener noreferrer">#6287</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10791" target="_blank" rel="noopener noreferrer">#10791</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>).</li><li>Get rid of old libunwind patches. <a href="https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012</a> This allows to disable <code>-fno-omit-frame-pointer</code> in <code>clang</code> builds that improves performance at least by 1% in average. <a href="https://github.com/ClickHouse/ClickHouse/pull/10761" target="_blank" rel="noopener noreferrer">#10761</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix avgWeighted when using floating-point weight over multiple shards. <a href="https://github.com/ClickHouse/ClickHouse/pull/10758" target="_blank" rel="noopener noreferrer">#10758</a> (<a href="https://github.com/bgiard" target="_blank" rel="noopener noreferrer">Baudouin Giard</a>).</li><li>Fix <code>parallel_view_processing</code> behavior. Now all insertions into <code>MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" target="_blank" rel="noopener noreferrer">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10757" target="_blank" rel="noopener noreferrer">#10757</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix combinator -OrNull and -OrDefault when combined with -State. <a href="https://github.com/ClickHouse/ClickHouse/pull/10741" target="_blank" rel="noopener noreferrer">#10741</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Fix crash in <code>generateRandom</code> with nested types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10583" target="_blank" rel="noopener noreferrer">#10583</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10734" target="_blank" rel="noopener noreferrer">#10734</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix data corruption for <code>LowCardinality(FixedString)</code> key column in <code>SummingMergeTree</code> which could have happened after merge. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10489" target="_blank" rel="noopener noreferrer">#10489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10721" target="_blank" rel="noopener noreferrer">#10721</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix usage of primary key wrapped into a function with &#x27;FINAL&#x27; modifier and &#x27;ORDER BY&#x27; optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/10715" target="_blank" rel="noopener noreferrer">#10715</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix possible buffer overflow in function <code>h3EdgeAngle</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10711" target="_blank" rel="noopener noreferrer">#10711</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix disappearing totals. Totals could have being filtered if query had had join or subquery with external where condition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10674" target="_blank" rel="noopener noreferrer">#10674</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10698" target="_blank" rel="noopener noreferrer">#10698</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix atomicity of HTTP insert. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9666" target="_blank" rel="noopener noreferrer">#9666</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10687" target="_blank" rel="noopener noreferrer">#10687</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>).</li><li>Fix multiple usages of <code>IN</code> operator with the identical set in one query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10686" target="_blank" rel="noopener noreferrer">#10686</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed bug, which causes http requests stuck on client close when <code>readonly=2</code> and <code>cancel_http_readonly_queries_on_client_close=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7939" target="_blank" rel="noopener noreferrer">#7939</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7019" target="_blank" rel="noopener noreferrer">#7019</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7736" target="_blank" rel="noopener noreferrer">#7736</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7091" target="_blank" rel="noopener noreferrer">#7091</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10684" target="_blank" rel="noopener noreferrer">#10684</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix order of parameters in AggregateTransform constructor. <a href="https://github.com/ClickHouse/ClickHouse/pull/10667" target="_blank" rel="noopener noreferrer">#10667</a> (<a href="https://github.com/palasonic1" target="_blank" rel="noopener noreferrer">palasonic1</a>).</li><li>Fix the lack of parallel execution of remote queries with <code>distributed_aggregation_memory_efficient</code> enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10655" target="_blank" rel="noopener noreferrer">#10655</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10664" target="_blank" rel="noopener noreferrer">#10664</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix possible incorrect number of rows for queries with <code>LIMIT</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10566" target="_blank" rel="noopener noreferrer">#10566</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10709" target="_blank" rel="noopener noreferrer">#10709</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10660" target="_blank" rel="noopener noreferrer">#10660</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bug which locks concurrent alters when table has a lot of parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10659" target="_blank" rel="noopener noreferrer">#10659</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix nullptr dereference in StorageBuffer if server was shutdown before table startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/10641" target="_blank" rel="noopener noreferrer">#10641</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix predicates optimization for distributed queries (<code>enable_optimize_predicate_expression=1</code>) for queries with <code>HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10613" target="_blank" rel="noopener noreferrer">#10613</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11413" target="_blank" rel="noopener noreferrer">#11413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10621" target="_blank" rel="noopener noreferrer">#10621</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix optimize_skip_unused_shards with LowCardinality. <a href="https://github.com/ClickHouse/ClickHouse/pull/10611" target="_blank" rel="noopener noreferrer">#10611</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix segfault in StorageBuffer when exception on server startup. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10550" target="_blank" rel="noopener noreferrer">#10550</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10609" target="_blank" rel="noopener noreferrer">#10609</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>On <code>SYSTEM DROP DNS CACHE</code> query also drop caches, which are used to check if user is allowed to connect from some IP addresses. <a href="https://github.com/ClickHouse/ClickHouse/pull/10608" target="_blank" rel="noopener noreferrer">#10608</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed incorrect scalar results inside inner query of <code>MATERIALIZED VIEW</code> in case if this query contained dependent table. <a href="https://github.com/ClickHouse/ClickHouse/pull/10603" target="_blank" rel="noopener noreferrer">#10603</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed handling condition variable for synchronous mutations. In some cases signals to that condition variable could be lost. <a href="https://github.com/ClickHouse/ClickHouse/pull/10588" target="_blank" rel="noopener noreferrer">#10588</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fixes possible crash <code>createDictionary()</code> is called before <code>loadStoredObject()</code> has finished. <a href="https://github.com/ClickHouse/ClickHouse/pull/10587" target="_blank" rel="noopener noreferrer">#10587</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix error <code>the BloomFilter false positive must be a double number between 0 and 1</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/10551" target="_blank" rel="noopener noreferrer">#10551</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10569" target="_blank" rel="noopener noreferrer">#10569</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix SELECT of column ALIAS which default expression type different from column type. <a href="https://github.com/ClickHouse/ClickHouse/pull/10563" target="_blank" rel="noopener noreferrer">#10563</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Implemented comparison between DateTime64 and String values (just like for DateTime). <a href="https://github.com/ClickHouse/ClickHouse/pull/10560" target="_blank" rel="noopener noreferrer">#10560</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fix index corruption, which may occur in some cases after merge compact parts into another compact part. <a href="https://github.com/ClickHouse/ClickHouse/pull/10531" target="_blank" rel="noopener noreferrer">#10531</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Disable GROUP BY sharding_key optimization by default (<code>optimize_distributed_group_by_sharding_key</code> had been introduced and turned of by default, due to trickery of sharding_key analyzing, simple example is <code>if</code> in sharding key) and fix it for WITH ROLLUP/CUBE/TOTALS. <a href="https://github.com/ClickHouse/ClickHouse/pull/10516" target="_blank" rel="noopener noreferrer">#10516</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10263" target="_blank" rel="noopener noreferrer">#10263</a> (after that PR dist send via INSERT had been postponing on each INSERT) Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/8756" target="_blank" rel="noopener noreferrer">#8756</a> (that PR breaks distributed sends with all of the following conditions met (unlikely setup for now I guess): <code>internal_replication == false</code>, multiple local shards (activates the hardlinking code) and <code>distributed_storage_policy</code> (makes <code>link(2)</code> fails on <code>EXDEV</code>)). <a href="https://github.com/ClickHouse/ClickHouse/pull/10486" target="_blank" rel="noopener noreferrer">#10486</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed error with &quot;max_rows_to_sort&quot; limit. <a href="https://github.com/ClickHouse/ClickHouse/pull/10268" target="_blank" rel="noopener noreferrer">#10268</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Get dictionary and check access rights only once per each call of any function reading external dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/10928" target="_blank" rel="noopener noreferrer">#10928</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-15">Improvement<a class="hash-link" href="#improvement-15" title="Direct link to heading">​</a></h4><ul><li>Apply <code>TTL</code> for old data, after <code>ALTER MODIFY TTL</code> query. This behaviour is controlled by setting <code>materialize_ttl_after_modify</code>, which is enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/11042" target="_blank" rel="noopener noreferrer">#11042</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>When parsing C-style backslash escapes in string literals, VALUES and various text formats (this is an extension to SQL standard that is endemic for ClickHouse and MySQL), keep backslash if unknown escape sequence is found (e.g. <code>\%</code> or <code>\w</code>) that will make usage of <code>LIKE</code> and <code>match</code> regular expressions more convenient (it&#x27;s enough to write <code>name LIKE &#x27;used\_cars&#x27;</code> instead of <code>name LIKE &#x27;used\\_cars&#x27;</code>) and more compatible at the same time. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10922" target="_blank" rel="noopener noreferrer">#10922</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11208" target="_blank" rel="noopener noreferrer">#11208</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>When reading Decimal value, cut extra digits after point. This behaviour is more compatible with MySQL and PostgreSQL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10202" target="_blank" rel="noopener noreferrer">#10202</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11831" target="_blank" rel="noopener noreferrer">#11831</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow to DROP replicated table if the metadata in ZooKeeper was already removed and does not exist (this is also the case when using TestKeeper for testing and the server was restarted). Allow to RENAME replicated table even if there is an error communicating with ZooKeeper. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10720" target="_blank" rel="noopener noreferrer">#10720</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11652" target="_blank" rel="noopener noreferrer">#11652</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Slightly improve diagnostic of reading decimal from string. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10202" target="_blank" rel="noopener noreferrer">#10202</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11829" target="_blank" rel="noopener noreferrer">#11829</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix sleep invocation in signal handler. It was sleeping for less amount of time than expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/11825" target="_blank" rel="noopener noreferrer">#11825</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>(Only Linux) OS related performance metrics (for CPU and I/O) will work even without <code>CAP_NET_ADMIN</code> capability. <a href="https://github.com/ClickHouse/ClickHouse/pull/10544" target="_blank" rel="noopener noreferrer">#10544</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Added <code>hostname</code> as an alias to function <code>hostName</code>. This feature was suggested by Victor Tarnavskiy from Yandex.Metrica. <a href="https://github.com/ClickHouse/ClickHouse/pull/11821" target="_blank" rel="noopener noreferrer">#11821</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added support for distributed <code>DDL</code> (update/delete/drop partition) on cross replication clusters. <a href="https://github.com/ClickHouse/ClickHouse/pull/11703" target="_blank" rel="noopener noreferrer">#11703</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Emit warning instead of error in server log at startup if we cannot listen one of the listen addresses (e.g. IPv6 is unavailable inside Docker). Note that if server fails to listen all listed addresses, it will refuse to startup as before. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4406" target="_blank" rel="noopener noreferrer">#4406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11687" target="_blank" rel="noopener noreferrer">#11687</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Default user and database creation on docker image starting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10637" target="_blank" rel="noopener noreferrer">#10637</a> (<a href="https://github.com/tarampampam" target="_blank" rel="noopener noreferrer">Paramtamtam</a>).</li><li>When multiline query is printed to server log, the lines are joined. Make it to work correct in case of multiline string literals, identifiers and single-line comments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3853" target="_blank" rel="noopener noreferrer">#3853</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11686" target="_blank" rel="noopener noreferrer">#11686</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Multiple names are now allowed in commands: CREATE USER, CREATE ROLE, ALTER USER, SHOW CREATE USER, SHOW GRANTS and so on. <a href="https://github.com/ClickHouse/ClickHouse/pull/11670" target="_blank" rel="noopener noreferrer">#11670</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Add support for distributed DDL (<code>UPDATE/DELETE/DROP PARTITION</code>) on cross replication clusters. <a href="https://github.com/ClickHouse/ClickHouse/pull/11508" target="_blank" rel="noopener noreferrer">#11508</a> (<a href="https://github.com/etah000" target="_blank" rel="noopener noreferrer">frank lee</a>).</li><li>Clear password from command line in <code>clickhouse-client</code> and <code>clickhouse-benchmark</code> if the user has specified it with explicit value. This prevents password exposure by <code>ps</code> and similar tools. <a href="https://github.com/ClickHouse/ClickHouse/pull/11665" target="_blank" rel="noopener noreferrer">#11665</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Don&#x27;t use debug info from ELF file if it does not correspond to the running binary. It is needed to avoid printing wrong function names and source locations in stack traces. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7514" target="_blank" rel="noopener noreferrer">#7514</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11657" target="_blank" rel="noopener noreferrer">#11657</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Return NULL/zero when value is not parsed completely in parseDateTimeBestEffortOrNull/Zero functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7876" target="_blank" rel="noopener noreferrer">#7876</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11653" target="_blank" rel="noopener noreferrer">#11653</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Skip empty parameters in requested URL. They may appear when you write <code>http://localhost:8123/?&amp;a=b</code> or <code>http://localhost:8123/?a=b&amp;&amp;c=d</code>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10749" target="_blank" rel="noopener noreferrer">#10749</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11651" target="_blank" rel="noopener noreferrer">#11651</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow using <code>groupArrayArray</code> and <code>groupUniqArrayArray</code> as <code>SimpleAggregateFunction</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11650" target="_blank" rel="noopener noreferrer">#11650</a> (<a href="https://github.com/ksvladimir" target="_blank" rel="noopener noreferrer">Volodymyr Kuznetsov</a>).</li><li>Allow comparison with constant strings by implicit conversions when analysing index conditions on other types. This may close <a href="https://github.com/ClickHouse/ClickHouse/issues/11630" target="_blank" rel="noopener noreferrer">#11630</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11648" target="_blank" rel="noopener noreferrer">#11648</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li><a href="https://github.com/ClickHouse/ClickHouse/pull/7572#issuecomment-642815377" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/7572#issuecomment-642815377</a> Support config default HTTPHandlers. <a href="https://github.com/ClickHouse/ClickHouse/pull/11628" target="_blank" rel="noopener noreferrer">#11628</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Make more input formats to work with Kafka engine. Fix the issue with premature flushes. Fix the performance issue when <code>kafka_num_consumers</code> is greater than number of partitions in topic. <a href="https://github.com/ClickHouse/ClickHouse/pull/11599" target="_blank" rel="noopener noreferrer">#11599</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Improve <code>multiple_joins_rewriter_version=2</code> logic. Fix unknown columns error for lambda aliases. <a href="https://github.com/ClickHouse/ClickHouse/pull/11587" target="_blank" rel="noopener noreferrer">#11587</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Better exception message when cannot parse columns declaration list. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10403" target="_blank" rel="noopener noreferrer">#10403</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11537" target="_blank" rel="noopener noreferrer">#11537</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improve <code>enable_optimize_predicate_expression=1</code> logic for VIEW. <a href="https://github.com/ClickHouse/ClickHouse/pull/11513" target="_blank" rel="noopener noreferrer">#11513</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Adding support for PREWHERE in live view tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/11495" target="_blank" rel="noopener noreferrer">#11495</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Automatically update DNS cache, which is used to check if user is allowed to connect from an address. <a href="https://github.com/ClickHouse/ClickHouse/pull/11487" target="_blank" rel="noopener noreferrer">#11487</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>OPTIMIZE FINAL will force merge even if concurrent merges are performed. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11309" target="_blank" rel="noopener noreferrer">#11309</a> and closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11322" target="_blank" rel="noopener noreferrer">#11322</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11346" target="_blank" rel="noopener noreferrer">#11346</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Suppress output of cancelled queries in clickhouse-client. In previous versions result may continue to print in terminal even after you press Ctrl+C to cancel query. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9473" target="_blank" rel="noopener noreferrer">#9473</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11342" target="_blank" rel="noopener noreferrer">#11342</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now history file is updated after each query and there is no race condition if multiple clients use one history file. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9897" target="_blank" rel="noopener noreferrer">#9897</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11453" target="_blank" rel="noopener noreferrer">#11453</a> (<a href="https://github.com/kuskarov" target="_blank" rel="noopener noreferrer">Tagir Kuskarov</a>).</li><li>Better log messages in while reloading configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/11341" target="_blank" rel="noopener noreferrer">#11341</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove trailing whitespaces from formatted queries in <code>clickhouse-client</code> or <code>clickhouse-format</code> in some cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/11325" target="_blank" rel="noopener noreferrer">#11325</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add setting &quot;output_format_pretty_max_value_width&quot;. If value is longer, it will be cut to avoid output of too large values in terminal. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11140" target="_blank" rel="noopener noreferrer">#11140</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11324" target="_blank" rel="noopener noreferrer">#11324</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Better exception message in case when there is shortage of memory mappings. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11027" target="_blank" rel="noopener noreferrer">#11027</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11316" target="_blank" rel="noopener noreferrer">#11316</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Support (U)Int8, (U)Int16, Date in ASOF JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/11301" target="_blank" rel="noopener noreferrer">#11301</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Support kafka_client_id parameter for Kafka tables. It also changes the default <code>client.id</code> used by ClickHouse when communicating with Kafka to be more verbose and usable. <a href="https://github.com/ClickHouse/ClickHouse/pull/11252" target="_blank" rel="noopener noreferrer">#11252</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Keep the value of <code>DistributedFilesToInsert</code> metric on exceptions. In previous versions, the value was set when we are going to send some files, but it is zero, if there was an exception and some files are still pending. Now it corresponds to the number of pending files in filesystem. <a href="https://github.com/ClickHouse/ClickHouse/pull/11220" target="_blank" rel="noopener noreferrer">#11220</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add support for multi-word data type names (such as <code>DOUBLE PRECISION</code> and <code>CHAR VARYING</code>) for better SQL compatibility. <a href="https://github.com/ClickHouse/ClickHouse/pull/11214" target="_blank" rel="noopener noreferrer">#11214</a> (<a href="https://github.com/Potya" target="_blank" rel="noopener noreferrer">Павел Потемкин</a>).</li><li>Provide synonyms for some data types. <a href="https://github.com/ClickHouse/ClickHouse/pull/10856" target="_blank" rel="noopener noreferrer">#10856</a> (<a href="https://github.com/Potya" target="_blank" rel="noopener noreferrer">Павел Потемкин</a>).</li><li>The query log is now enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/11184" target="_blank" rel="noopener noreferrer">#11184</a> (<a href="https://github.com/blinkov" target="_blank" rel="noopener noreferrer">Ivan Blinkov</a>).</li><li>Show authentication type in table system.users and while executing SHOW CREATE USER query. <a href="https://github.com/ClickHouse/ClickHouse/pull/11080" target="_blank" rel="noopener noreferrer">#11080</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Remove data on explicit <code>DROP DATABASE</code> for <code>Memory</code> database engine. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10557" target="_blank" rel="noopener noreferrer">#10557</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11021" target="_blank" rel="noopener noreferrer">#11021</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Set thread names for internal threads of rdkafka library. Make logs from rdkafka available in server logs. <a href="https://github.com/ClickHouse/ClickHouse/pull/10983" target="_blank" rel="noopener noreferrer">#10983</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Support for unicode whitespaces in queries. This helps when queries are copy-pasted from Word or from web page. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10896" target="_blank" rel="noopener noreferrer">#10896</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10903" target="_blank" rel="noopener noreferrer">#10903</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Allow large UInt types as the index in function <code>tupleElement</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10874" target="_blank" rel="noopener noreferrer">#10874</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Respect prefer_localhost_replica/load_balancing on INSERT into Distributed. <a href="https://github.com/ClickHouse/ClickHouse/pull/10867" target="_blank" rel="noopener noreferrer">#10867</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Introduce <code>min_insert_block_size_rows_for_materialized_views</code>, <code>min_insert_block_size_bytes_for_materialized_views</code> settings. This settings are similar to <code>min_insert_block_size_rows</code> and <code>min_insert_block_size_bytes</code>, but applied only for blocks inserted into <code>MATERIALIZED VIEW</code>. It helps to control blocks squashing while pushing to MVs and avoid excessive memory usage. <a href="https://github.com/ClickHouse/ClickHouse/pull/10858" target="_blank" rel="noopener noreferrer">#10858</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Get rid of exception from replicated queue during server shutdown. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10819" target="_blank" rel="noopener noreferrer">#10819</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10841" target="_blank" rel="noopener noreferrer">#10841</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Ensure that <code>varSamp</code>, <code>varPop</code> cannot return negative results due to numerical errors and that <code>stddevSamp</code>, <code>stddevPop</code> cannot be calculated from negative variance. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10532" target="_blank" rel="noopener noreferrer">#10532</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10829" target="_blank" rel="noopener noreferrer">#10829</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Better DNS exception message. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10813" target="_blank" rel="noopener noreferrer">#10813</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10828" target="_blank" rel="noopener noreferrer">#10828</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Change HTTP response code in case of some parse errors to 400 Bad Request. This fix <a href="https://github.com/ClickHouse/ClickHouse/issues/10636" target="_blank" rel="noopener noreferrer">#10636</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10640" target="_blank" rel="noopener noreferrer">#10640</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Print a message if clickhouse-client is newer than clickhouse-server. <a href="https://github.com/ClickHouse/ClickHouse/pull/10627" target="_blank" rel="noopener noreferrer">#10627</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Adding support for <code>INSERT INTO [db.]table WATCH</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10498" target="_blank" rel="noopener noreferrer">#10498</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Allow to pass quota_key in clickhouse-client. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10227" target="_blank" rel="noopener noreferrer">#10227</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10270" target="_blank" rel="noopener noreferrer">#10270</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-9">Performance Improvement<a class="hash-link" href="#performance-improvement-9" title="Direct link to heading">​</a></h4><ul><li>Allow multiple replicas to assign merges, mutations, partition drop, move and replace concurrently. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10367" target="_blank" rel="noopener noreferrer">#10367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11639" target="_blank" rel="noopener noreferrer">#11639</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/11795" target="_blank" rel="noopener noreferrer">#11795</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Optimization of GROUP BY with respect to table sorting key, enabled with <code>optimize_aggregation_in_order</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/9113" target="_blank" rel="noopener noreferrer">#9113</a> (<a href="https://github.com/dimarub2000" target="_blank" rel="noopener noreferrer">dimarub2000</a>).</li><li>Selects with final are executed in parallel. Added setting <code>max_final_threads</code> to limit the number of threads used. <a href="https://github.com/ClickHouse/ClickHouse/pull/10463" target="_blank" rel="noopener noreferrer">#10463</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Improve performance for INSERT queries via <code>INSERT SELECT</code> or INSERT with clickhouse-client when small blocks are generated (typical case with parallel parsing). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11275" target="_blank" rel="noopener noreferrer">#11275</a>. Fix the issue that CONSTRAINTs were not working for DEFAULT fields. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11273" target="_blank" rel="noopener noreferrer">#11273</a>. Fix the issue that CONSTRAINTS were ignored for TEMPORARY tables. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11274" target="_blank" rel="noopener noreferrer">#11274</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11276" target="_blank" rel="noopener noreferrer">#11276</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Optimization that eliminates min/max/any aggregators of GROUP BY keys in SELECT section, enabled with <code>optimize_aggregators_of_group_by_keys</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/11667" target="_blank" rel="noopener noreferrer">#11667</a> (<a href="https://github.com/xPoSx" target="_blank" rel="noopener noreferrer">xPoSx</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11806" target="_blank" rel="noopener noreferrer">#11806</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>New optimization that takes all operations out of <code>any</code> function, enabled with <code>optimize_move_functions_out_of_any</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/11529" target="_blank" rel="noopener noreferrer">#11529</a> (<a href="https://github.com/kamalov-ruslan" target="_blank" rel="noopener noreferrer">Ruslan</a>).</li><li>Improve performance of <code>clickhouse-client</code> in interactive mode when Pretty formats are used. In previous versions, significant amount of time can be spent calculating visible width of UTF-8 string. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11323" target="_blank" rel="noopener noreferrer">#11323</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11323" target="_blank" rel="noopener noreferrer">#11323</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improved performance for queries with <code>ORDER BY</code> and small <code>LIMIT</code> (less, then <code>max_block_size</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11171" target="_blank" rel="noopener noreferrer">#11171</a> (<a href="https://github.com/Provet" target="_blank" rel="noopener noreferrer">Albert Kidrachev</a>).</li><li>Add runtime CPU detection to select and dispatch the best function implementation. Add support for codegeneration for multiple targets. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/1017" target="_blank" rel="noopener noreferrer">#1017</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10058" target="_blank" rel="noopener noreferrer">#10058</a> (<a href="https://github.com/DimasKovas" target="_blank" rel="noopener noreferrer">DimasKovas</a>).</li><li>Enable <code>mlock</code> of clickhouse binary by default. It will prevent clickhouse executable from being paged out under high IO load. <a href="https://github.com/ClickHouse/ClickHouse/pull/11139" target="_blank" rel="noopener noreferrer">#11139</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Make queries with <code>sum</code> aggregate function and without GROUP BY keys to run multiple times faster. <a href="https://github.com/ClickHouse/ClickHouse/pull/10992" target="_blank" rel="noopener noreferrer">#10992</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Improving radix sort (used in <code>ORDER BY</code> with simple keys) by removing some redundant data moves. <a href="https://github.com/ClickHouse/ClickHouse/pull/10981" target="_blank" rel="noopener noreferrer">#10981</a> (<a href="https://github.com/g-arslan" target="_blank" rel="noopener noreferrer">Arslan Gumerov</a>).</li><li>Sort bigger parts of the left table in MergeJoin. Buffer left blocks in memory. Add <code>partial_merge_join_left_table_buffer_bytes</code> setting to manage the left blocks buffers sizes. <a href="https://github.com/ClickHouse/ClickHouse/pull/10601" target="_blank" rel="noopener noreferrer">#10601</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Remove duplicate ORDER BY and DISTINCT from subqueries, this optimization is enabled with <code>optimize_duplicate_order_by_and_distinct</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/10067" target="_blank" rel="noopener noreferrer">#10067</a> (<a href="https://github.com/demo-99" target="_blank" rel="noopener noreferrer">Mikhail Malafeev</a>).</li><li>This feature eliminates functions of other keys in GROUP BY section, enabled with <code>optimize_group_by_function_keys</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/10051" target="_blank" rel="noopener noreferrer">#10051</a> (<a href="https://github.com/xPoSx" target="_blank" rel="noopener noreferrer">xPoSx</a>).</li><li>New optimization that takes arithmetic operations out of aggregate functions, enabled with <code>optimize_arithmetic_operations_in_aggregate_functions</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/10047" target="_blank" rel="noopener noreferrer">#10047</a> (<a href="https://github.com/kamalov-ruslan" target="_blank" rel="noopener noreferrer">Ruslan</a>).</li><li>Use HTTP client for S3 based on Poco instead of curl. This will improve performance and lower memory usage of s3 storage and table functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/11230" target="_blank" rel="noopener noreferrer">#11230</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fix Kafka performance issue related to reschedules based on limits, which were always applied. <a href="https://github.com/ClickHouse/ClickHouse/pull/11149" target="_blank" rel="noopener noreferrer">#11149</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Enable percpu_arena:percpu for jemalloc (This will reduce memory fragmentation due to thread pool). <a href="https://github.com/ClickHouse/ClickHouse/pull/11084" target="_blank" rel="noopener noreferrer">#11084</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Optimize memory usage when reading a response from an S3 HTTP client. <a href="https://github.com/ClickHouse/ClickHouse/pull/11561" target="_blank" rel="noopener noreferrer">#11561</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Adjust the default Kafka settings for better performance. <a href="https://github.com/ClickHouse/ClickHouse/pull/11388" target="_blank" rel="noopener noreferrer">#11388</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-5">Experimental Feature<a class="hash-link" href="#experimental-feature-5" title="Direct link to heading">​</a></h4><ul><li>Add data type <code>Point</code> (Tuple(Float64, Float64)) and <code>Polygon</code> (Array(Array(Tuple(Float64, Float64))). <a href="https://github.com/ClickHouse/ClickHouse/pull/10678" target="_blank" rel="noopener noreferrer">#10678</a> (<a href="https://github.com/livace" target="_blank" rel="noopener noreferrer">Alexey Ilyukhov</a>).</li><li>Add&#x27;s a <code>hasSubstr</code> function that allows for look for subsequences in arrays. Note: this function is likely to be renamed without further notice. <a href="https://github.com/ClickHouse/ClickHouse/pull/11071" target="_blank" rel="noopener noreferrer">#11071</a> (<a href="https://github.com/r-zenine" target="_blank" rel="noopener noreferrer">Ryad Zenine</a>).</li><li>Added OpenCL support and bitonic sort algorithm, which can be used for sorting integer types of data in single column. Needs to be build with flag <code>-DENABLE_OPENCL=1</code>. For using bitonic sort algorithm instead of others you need to set <code>bitonic_sort</code> for Setting&#x27;s option <code>special_sort</code> and make sure that OpenCL is available. This feature does not improve performance or anything else, it is only provided as an example and for demonstration purposes. It is likely to be removed in near future if there will be no further development in this direction. <a href="https://github.com/ClickHouse/ClickHouse/pull/10232" target="_blank" rel="noopener noreferrer">#10232</a> (<a href="https://github.com/margaritiko" target="_blank" rel="noopener noreferrer">Ri</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-11">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-11" title="Direct link to heading">​</a></h4><ul><li>Enable clang-tidy for programs and utils. <a href="https://github.com/ClickHouse/ClickHouse/pull/10991" target="_blank" rel="noopener noreferrer">#10991</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove dependency on <code>tzdata</code>: do not fail if <code>/usr/share/zoneinfo</code> directory does not exist. Note that all timezones work in ClickHouse even without tzdata installed in system. <a href="https://github.com/ClickHouse/ClickHouse/pull/11827" target="_blank" rel="noopener noreferrer">#11827</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added MSan and UBSan stress tests. Note that we already have MSan, UBSan for functional tests and &quot;stress&quot; test is another kind of tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/10871" target="_blank" rel="noopener noreferrer">#10871</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Print compiler build id in crash messages. It will make us slightly more certain about what binary has crashed. Added new function <code>buildId</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11824" target="_blank" rel="noopener noreferrer">#11824</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added a test to ensure that mutations continue to work after FREEZE query. <a href="https://github.com/ClickHouse/ClickHouse/pull/11820" target="_blank" rel="noopener noreferrer">#11820</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Don&#x27;t allow tests with &quot;fail&quot; substring in their names because it makes looking at the tests results in browser less convenient when you type Ctrl+F and search for &quot;fail&quot;. <a href="https://github.com/ClickHouse/ClickHouse/pull/11817" target="_blank" rel="noopener noreferrer">#11817</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Removes unused imports from HTTPHandlerFactory. <a href="https://github.com/ClickHouse/ClickHouse/pull/11660" target="_blank" rel="noopener noreferrer">#11660</a> (<a href="https://github.com/bharatnc" target="_blank" rel="noopener noreferrer">Bharat Nallan</a>).</li><li>Added a random sampling of instances where copier is executed. It is needed to avoid <code>Too many simultaneous queries</code> error. Also increased timeout and decreased fault probability. <a href="https://github.com/ClickHouse/ClickHouse/pull/11573" target="_blank" rel="noopener noreferrer">#11573</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix missed include. <a href="https://github.com/ClickHouse/ClickHouse/pull/11525" target="_blank" rel="noopener noreferrer">#11525</a> (<a href="https://github.com/matwey" target="_blank" rel="noopener noreferrer">Matwey V. Kornilov</a>).</li><li>Speed up build by removing old example programs. Also found some orphan functional test. <a href="https://github.com/ClickHouse/ClickHouse/pull/11486" target="_blank" rel="noopener noreferrer">#11486</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Increase ccache size for builds in CI. <a href="https://github.com/ClickHouse/ClickHouse/pull/11450" target="_blank" rel="noopener noreferrer">#11450</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Leave only unit_tests_dbms in deb build. <a href="https://github.com/ClickHouse/ClickHouse/pull/11429" target="_blank" rel="noopener noreferrer">#11429</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>).</li><li>Update librdkafka to version <a href="https://github.com/edenhill/librdkafka/releases/tag/v1.4.2" target="_blank" rel="noopener noreferrer">1.4.2</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11256" target="_blank" rel="noopener noreferrer">#11256</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Refactor CMake build files. <a href="https://github.com/ClickHouse/ClickHouse/pull/11390" target="_blank" rel="noopener noreferrer">#11390</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Fix several flaky integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11355" target="_blank" rel="noopener noreferrer">#11355</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add support for unit tests run with UBSan. <a href="https://github.com/ClickHouse/ClickHouse/pull/11345" target="_blank" rel="noopener noreferrer">#11345</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove redundant timeout from integration test <code>test_insertion_sync_fails_with_timeout</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11343" target="_blank" rel="noopener noreferrer">#11343</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Better check for hung queries in clickhouse-test. <a href="https://github.com/ClickHouse/ClickHouse/pull/11321" target="_blank" rel="noopener noreferrer">#11321</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Emit a warning if server was build in debug or with sanitizers. <a href="https://github.com/ClickHouse/ClickHouse/pull/11304" target="_blank" rel="noopener noreferrer">#11304</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now clickhouse-test check the server aliveness before tests run. <a href="https://github.com/ClickHouse/ClickHouse/pull/11285" target="_blank" rel="noopener noreferrer">#11285</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix potentially flacky test <code>00731_long_merge_tree_select_opened_files.sh</code>. It does not fail frequently but we have discovered potential race condition in this test while experimenting with ThreadFuzzer: <a href="https://github.com/ClickHouse/ClickHouse/issues/9814" target="_blank" rel="noopener noreferrer">#9814</a> See <a href="https://clickhouse-test-reports.s3.yandex.net/9814/40e3023e215df22985d275bf85f4d2290897b76b/functional_stateless_tests_(unbundled).html#fail1" target="_blank" rel="noopener noreferrer">link</a> for the example. <a href="https://github.com/ClickHouse/ClickHouse/pull/11270" target="_blank" rel="noopener noreferrer">#11270</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Repeat test in CI if <code>curl</code> invocation was timed out. It is possible due to system hangups for 10+ seconds that are typical in our CI infrastructure. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11267" target="_blank" rel="noopener noreferrer">#11267</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11268" target="_blank" rel="noopener noreferrer">#11268</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add a test for Join table engine from @donmikel. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9158" target="_blank" rel="noopener noreferrer">#9158</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11265" target="_blank" rel="noopener noreferrer">#11265</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix several non significant errors in unit tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11262" target="_blank" rel="noopener noreferrer">#11262</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Now parts of linker command for <code>cctz</code> library will not be shuffled with other libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11213" target="_blank" rel="noopener noreferrer">#11213</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Split /programs/server into actual program and library. <a href="https://github.com/ClickHouse/ClickHouse/pull/11186" target="_blank" rel="noopener noreferrer">#11186</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Improve build scripts for protobuf &amp; gRPC. <a href="https://github.com/ClickHouse/ClickHouse/pull/11172" target="_blank" rel="noopener noreferrer">#11172</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Enable performance test that was not working. <a href="https://github.com/ClickHouse/ClickHouse/pull/11158" target="_blank" rel="noopener noreferrer">#11158</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Create root S3 bucket for tests before any CH instance is started. <a href="https://github.com/ClickHouse/ClickHouse/pull/11142" target="_blank" rel="noopener noreferrer">#11142</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Add performance test for non-constant polygons. <a href="https://github.com/ClickHouse/ClickHouse/pull/11141" target="_blank" rel="noopener noreferrer">#11141</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixing <code>00979_live_view_watch_continuous_aggregates</code> test. <a href="https://github.com/ClickHouse/ClickHouse/pull/11024" target="_blank" rel="noopener noreferrer">#11024</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Add ability to run zookeeper in integration tests over tmpfs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11002" target="_blank" rel="noopener noreferrer">#11002</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Wait for odbc-bridge with exponential backoff. Previous wait time of 200 ms was not enough in our CI environment. <a href="https://github.com/ClickHouse/ClickHouse/pull/10990" target="_blank" rel="noopener noreferrer">#10990</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix non-deterministic test. <a href="https://github.com/ClickHouse/ClickHouse/pull/10989" target="_blank" rel="noopener noreferrer">#10989</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added a test for empty external data. <a href="https://github.com/ClickHouse/ClickHouse/pull/10926" target="_blank" rel="noopener noreferrer">#10926</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Database is recreated for every test. This improves separation of tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/10902" target="_blank" rel="noopener noreferrer">#10902</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added more asserts in columns code. <a href="https://github.com/ClickHouse/ClickHouse/pull/10833" target="_blank" rel="noopener noreferrer">#10833</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Better cooperation with sanitizers. Print information about query_id in the message of sanitizer failure. <a href="https://github.com/ClickHouse/ClickHouse/pull/10832" target="_blank" rel="noopener noreferrer">#10832</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix obvious race condition in &quot;Split build smoke test&quot; check. <a href="https://github.com/ClickHouse/ClickHouse/pull/10820" target="_blank" rel="noopener noreferrer">#10820</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix (false) MSan report in MergeTreeIndexFullText. The issue first appeared in <a href="https://github.com/ClickHouse/ClickHouse/issues/9968" target="_blank" rel="noopener noreferrer">#9968</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10801" target="_blank" rel="noopener noreferrer">#10801</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add MSan suppression for MariaDB Client library. <a href="https://github.com/ClickHouse/ClickHouse/pull/10800" target="_blank" rel="noopener noreferrer">#10800</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>GRPC make couldn&#x27;t find protobuf files, changed make file by adding the right link. <a href="https://github.com/ClickHouse/ClickHouse/pull/10794" target="_blank" rel="noopener noreferrer">#10794</a> (<a href="https://github.com/mnkonkova" target="_blank" rel="noopener noreferrer">mnkonkova</a>).</li><li>Enable extra warnings (<code>-Weverything</code>) for base, utils, programs. Note that we already have it for the most of the code. <a href="https://github.com/ClickHouse/ClickHouse/pull/10779" target="_blank" rel="noopener noreferrer">#10779</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Suppressions of warnings from libraries was mistakenly declared as public in <a href="https://github.com/ClickHouse/ClickHouse/issues/10396" target="_blank" rel="noopener noreferrer">#10396</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10776" target="_blank" rel="noopener noreferrer">#10776</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Restore a patch that was accidentially deleted in <a href="https://github.com/ClickHouse/ClickHouse/issues/10396" target="_blank" rel="noopener noreferrer">#10396</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10774" target="_blank" rel="noopener noreferrer">#10774</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix performance tests errors, part 2. <a href="https://github.com/ClickHouse/ClickHouse/pull/10773" target="_blank" rel="noopener noreferrer">#10773</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix performance test errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/10766" target="_blank" rel="noopener noreferrer">#10766</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Update cross-builds to use clang-10 compiler. <a href="https://github.com/ClickHouse/ClickHouse/pull/10724" target="_blank" rel="noopener noreferrer">#10724</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Update instruction to install RPM packages. This was suggested by Denis (TG login @ldviolet) and implemented by Arkady Shejn. <a href="https://github.com/ClickHouse/ClickHouse/pull/10707" target="_blank" rel="noopener noreferrer">#10707</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Trying to fix <code>tests/queries/0_stateless/01246_insert_into_watch_live_view.py</code> test. <a href="https://github.com/ClickHouse/ClickHouse/pull/10670" target="_blank" rel="noopener noreferrer">#10670</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Fixing and re-enabling 00979_live_view_watch_continuous_aggregates.py test. <a href="https://github.com/ClickHouse/ClickHouse/pull/10658" target="_blank" rel="noopener noreferrer">#10658</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Fix OOM in ASan stress test. <a href="https://github.com/ClickHouse/ClickHouse/pull/10646" target="_blank" rel="noopener noreferrer">#10646</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix UBSan report (adding zero to nullptr) in HashTable that appeared after migration to clang-10. <a href="https://github.com/ClickHouse/ClickHouse/pull/10638" target="_blank" rel="noopener noreferrer">#10638</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove external call to <code>ld</code> (bfd) linker during tzdata processing in compile time. <a href="https://github.com/ClickHouse/ClickHouse/pull/10634" target="_blank" rel="noopener noreferrer">#10634</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Allow to use <code>lld</code> to link blobs (resources). <a href="https://github.com/ClickHouse/ClickHouse/pull/10632" target="_blank" rel="noopener noreferrer">#10632</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix UBSan report in <code>LZ4</code> library. <a href="https://github.com/ClickHouse/ClickHouse/pull/10631" target="_blank" rel="noopener noreferrer">#10631</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>). See also <a href="https://github.com/lz4/lz4/issues/857" target="_blank" rel="noopener noreferrer">https://github.com/lz4/lz4/issues/857</a></li><li>Update LZ4 to the latest dev branch. <a href="https://github.com/ClickHouse/ClickHouse/pull/10630" target="_blank" rel="noopener noreferrer">#10630</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added auto-generated machine-readable file with the list of stable versions. <a href="https://github.com/ClickHouse/ClickHouse/pull/10628" target="_blank" rel="noopener noreferrer">#10628</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>capnproto</code> version check for <code>capnp::UnalignedFlatArrayMessageReader</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10618" target="_blank" rel="noopener noreferrer">#10618</a> (<a href="https://github.com/matwey" target="_blank" rel="noopener noreferrer">Matwey V. Kornilov</a>).</li><li>Lower memory usage in tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/10617" target="_blank" rel="noopener noreferrer">#10617</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixing hard coded timeouts in new live view tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/10604" target="_blank" rel="noopener noreferrer">#10604</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Increasing timeout when opening a client in tests/queries/0_stateless/helpers/client.py. <a href="https://github.com/ClickHouse/ClickHouse/pull/10599" target="_blank" rel="noopener noreferrer">#10599</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>).</li><li>Enable ThinLTO for clang builds, continuation of <a href="https://github.com/ClickHouse/ClickHouse/pull/10435" target="_blank" rel="noopener noreferrer">#10435</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10585" target="_blank" rel="noopener noreferrer">#10585</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Adding fuzzers and preparing for oss-fuzz integration. <a href="https://github.com/ClickHouse/ClickHouse/pull/10546" target="_blank" rel="noopener noreferrer">#10546</a> (<a href="https://github.com/kyprizel" target="_blank" rel="noopener noreferrer">kyprizel</a>).</li><li>Fix FreeBSD build. <a href="https://github.com/ClickHouse/ClickHouse/pull/10150" target="_blank" rel="noopener noreferrer">#10150</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li><li>Add new build for query tests using pytest framework. <a href="https://github.com/ClickHouse/ClickHouse/pull/10039" target="_blank" rel="noopener noreferrer">#10039</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>).</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v204">ClickHouse release v20.4<a class="hash-link" href="#clickhouse-release-v204" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v204899-stable-2020-08-10">ClickHouse release v20.4.8.99-stable 2020-08-10<a class="hash-link" href="#clickhouse-release-v204899-stable-2020-08-10" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-28">Bug Fix<a class="hash-link" href="#bug-fix-28" title="Direct link to heading">​</a></h4><ul><li>Fixed error in <code>parseDateTimeBestEffort</code> function when unix timestamp was passed as an argument. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13362" target="_blank" rel="noopener noreferrer">#13362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13441" target="_blank" rel="noopener noreferrer">#13441</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potentially low performance and slightly incorrect result for <code>uniqExact</code>, <code>topK</code>, <code>sumDistinct</code> and similar aggregate functions called on Float types with NaN values. It also triggered assert in debug build. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12491" target="_blank" rel="noopener noreferrer">#12491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13254" target="_blank" rel="noopener noreferrer">#13254</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed function if with nullable constexpr as cond that is not literal NULL. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12463" target="_blank" rel="noopener noreferrer">#12463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13226" target="_blank" rel="noopener noreferrer">#13226</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed assert in <code>arrayElement</code> function in case of array elements are Nullable and array subscript is also Nullable. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12172" target="_blank" rel="noopener noreferrer">#12172</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13224" target="_blank" rel="noopener noreferrer">#13224</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed wrong index analysis with functions. It could lead to pruning wrong parts, while reading from <code>MergeTree</code> tables. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13060" target="_blank" rel="noopener noreferrer">#13060</a>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12406" target="_blank" rel="noopener noreferrer">#12406</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13081" target="_blank" rel="noopener noreferrer">#13081</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed unnecessary limiting for the number of threads for selects from local replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/12840" target="_blank" rel="noopener noreferrer">#12840</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed possible extra overflow row in data which could appear for queries <code>WITH TOTALS</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12747" target="_blank" rel="noopener noreferrer">#12747</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed performance with large tuples, which are interpreted as functions in <code>IN</code> section. The case when user write <code>WHERE x IN tuple(1, 2, ...)</code> instead of <code>WHERE x IN (1, 2, ...)</code> for some obscure reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/12700" target="_blank" rel="noopener noreferrer">#12700</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed memory tracking for <code>input_format_parallel_parsing</code> (by attaching thread to group). <a href="https://github.com/ClickHouse/ClickHouse/pull/12672" target="_blank" rel="noopener noreferrer">#12672</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/12293" target="_blank" rel="noopener noreferrer">#12293</a> allow push predicate when subquery contains with clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/12663" target="_blank" rel="noopener noreferrer">#12663</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/10572" target="_blank" rel="noopener noreferrer">#10572</a> fix bloom filter index with const expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/12659" target="_blank" rel="noopener noreferrer">#12659</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <code>SIGSEGV</code> in <code>StorageKafka</code> when broker is unavailable (and not only). <a href="https://github.com/ClickHouse/ClickHouse/pull/12658" target="_blank" rel="noopener noreferrer">#12658</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added support for function <code>if</code> with <code>Array(UUID)</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11066" target="_blank" rel="noopener noreferrer">#11066</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12648" target="_blank" rel="noopener noreferrer">#12648</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed race condition in external dictionaries with cache layout which can lead server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/12566" target="_blank" rel="noopener noreferrer">#12566</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Removed data for Distributed tables (blocks from async INSERTs) on DROP TABLE. <a href="https://github.com/ClickHouse/ClickHouse/pull/12556" target="_blank" rel="noopener noreferrer">#12556</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed bug which lead to broken old parts after <code>ALTER DELETE</code> query when <code>enable_mixed_granularity_parts=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12536" target="_blank" rel="noopener noreferrer">#12536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12543" target="_blank" rel="noopener noreferrer">#12543</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Better exception for function <code>in</code> with invalid number of arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12529" target="_blank" rel="noopener noreferrer">#12529</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed performance issue, while reading from compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12492" target="_blank" rel="noopener noreferrer">#12492</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed crash in JOIN with dictionary when we are joining over expression of dictionary key: <code>t JOIN dict ON expr(dict.id) = t.id</code>. Disable dictionary join optimisation for this case. <a href="https://github.com/ClickHouse/ClickHouse/pull/12458" target="_blank" rel="noopener noreferrer">#12458</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fixed possible segfault if StorageMerge. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12054" target="_blank" rel="noopener noreferrer">#12054</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12401" target="_blank" rel="noopener noreferrer">#12401</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed order of columns in <code>WITH FILL</code> modifier. Previously order of columns of <code>ORDER BY</code> statement wasn&#x27;t respected. <a href="https://github.com/ClickHouse/ClickHouse/pull/12306" target="_blank" rel="noopener noreferrer">#12306</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Avoid &quot;bad cast&quot; exception when there is an expression that filters data by virtual columns (like <code>_table</code> in <code>Merge</code> tables) or by &quot;index&quot; columns in system tables such as filtering by database name when querying from <code>system.tables</code>, and this expression returns <code>Nullable</code> type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12166" target="_blank" rel="noopener noreferrer">#12166</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12305" target="_blank" rel="noopener noreferrer">#12305</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Show error after TrieDictionary failed to load. <a href="https://github.com/ClickHouse/ClickHouse/pull/12290" target="_blank" rel="noopener noreferrer">#12290</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>The function <code>arrayFill</code> worked incorrectly for empty arrays that may lead to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12263" target="_blank" rel="noopener noreferrer">#12263</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12279" target="_blank" rel="noopener noreferrer">#12279</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Implemented conversions to the common type for <code>LowCardinality</code> types. This allows to execute UNION ALL of tables with columns of LowCardinality and other columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8212" target="_blank" rel="noopener noreferrer">#8212</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4342" target="_blank" rel="noopener noreferrer">#4342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12275" target="_blank" rel="noopener noreferrer">#12275</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the behaviour when during multiple sequential inserts in <code>StorageFile</code> header for some special types was written more than once. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/6155" target="_blank" rel="noopener noreferrer">#6155</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12197" target="_blank" rel="noopener noreferrer">#12197</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed logical functions for UInt8 values when they are not equal to 0 or 1. <a href="https://github.com/ClickHouse/ClickHouse/pull/12196" target="_blank" rel="noopener noreferrer">#12196</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Cap max_memory_usage* limits to the process resident memory. <a href="https://github.com/ClickHouse/ClickHouse/pull/12182" target="_blank" rel="noopener noreferrer">#12182</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <code>dictGet</code> arguments check during GROUP BY injective functions elimination. <a href="https://github.com/ClickHouse/ClickHouse/pull/12179" target="_blank" rel="noopener noreferrer">#12179</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Don&#x27;t split the dictionary source&#x27;s table name into schema and table name itself if ODBC connection does not support schema. <a href="https://github.com/ClickHouse/ClickHouse/pull/12165" target="_blank" rel="noopener noreferrer">#12165</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed wrong logic in <code>ALTER DELETE</code> that leads to deleting of records when condition evaluates to NULL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9088" target="_blank" rel="noopener noreferrer">#9088</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12106" target="_blank" rel="noopener noreferrer">#12106</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12153" target="_blank" rel="noopener noreferrer">#12153</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed transform of query to send to external DBMS (e.g. MySQL, ODBC) in presense of aliases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12032" target="_blank" rel="noopener noreferrer">#12032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12151" target="_blank" rel="noopener noreferrer">#12151</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potential overflow in integer division. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12119" target="_blank" rel="noopener noreferrer">#12119</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12140" target="_blank" rel="noopener noreferrer">#12140</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potential infinite loop in <code>greatCircleDistance</code>, <code>geoDistance</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12117" target="_blank" rel="noopener noreferrer">#12117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12137" target="_blank" rel="noopener noreferrer">#12137</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Normalize &quot;pid&quot; file handling. In previous versions the server may refuse to start if it was killed without proper shutdown and if there is another process that has the same pid as previously runned server. Also pid file may be removed in unsuccessful server startup even if there is another server running. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3501" target="_blank" rel="noopener noreferrer">#3501</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12133" target="_blank" rel="noopener noreferrer">#12133</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed handling dependency of table with ENGINE=Dictionary on dictionary. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10994" target="_blank" rel="noopener noreferrer">#10994</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10397" target="_blank" rel="noopener noreferrer">#10397</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12116" target="_blank" rel="noopener noreferrer">#12116</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed performance for selects with <code>UNION</code> caused by wrong limit for the total number of threads. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12030" target="_blank" rel="noopener noreferrer">#12030</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12103" target="_blank" rel="noopener noreferrer">#12103</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed segfault with <code>-StateResample</code> combinators. <a href="https://github.com/ClickHouse/ClickHouse/pull/12092" target="_blank" rel="noopener noreferrer">#12092</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed empty <code>result_rows</code> and <code>result_bytes</code> metrics in <code>system.quey_log</code> for selects. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11595" target="_blank" rel="noopener noreferrer">#11595</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12089" target="_blank" rel="noopener noreferrer">#12089</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed unnecessary limiting the number of threads for selects from <code>VIEW</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11937" target="_blank" rel="noopener noreferrer">#11937</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12085" target="_blank" rel="noopener noreferrer">#12085</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed possible crash while using wrong type for <code>PREWHERE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12053" target="_blank" rel="noopener noreferrer">#12053</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12060" target="_blank" rel="noopener noreferrer">#12060</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12060" target="_blank" rel="noopener noreferrer">#12060</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed error <code>Expected single dictionary argument for function</code> for function <code>defaultValueOfArgumentType</code> with <code>LowCardinality</code> type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11808" target="_blank" rel="noopener noreferrer">#11808</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12056" target="_blank" rel="noopener noreferrer">#12056</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed error <code>Cannot capture column</code> for higher-order functions with <code>Tuple(LowCardinality)</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9766" target="_blank" rel="noopener noreferrer">#9766</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12055" target="_blank" rel="noopener noreferrer">#12055</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Parse tables metadata in parallel when loading database. This fixes slow server startup when there are large number of tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/12045" target="_blank" rel="noopener noreferrer">#12045</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Make <code>topK</code> aggregate function return Enum for Enum types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3740" target="_blank" rel="noopener noreferrer">#3740</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12043" target="_blank" rel="noopener noreferrer">#12043</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed constraints check if constraint is a constant expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11360" target="_blank" rel="noopener noreferrer">#11360</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12042" target="_blank" rel="noopener noreferrer">#12042</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed incorrect comparison of tuples with <code>Nullable</code> columns. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11985" target="_blank" rel="noopener noreferrer">#11985</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12039" target="_blank" rel="noopener noreferrer">#12039</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed calculation of access rights when allow_introspection_functions=0. <a href="https://github.com/ClickHouse/ClickHouse/pull/12031" target="_blank" rel="noopener noreferrer">#12031</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed wrong result and potential crash when invoking function <code>if</code> with arguments of type <code>FixedString</code> with different sizes. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11362" target="_blank" rel="noopener noreferrer">#11362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12021" target="_blank" rel="noopener noreferrer">#12021</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>A query with function <code>neighbor</code> as the only returned expression may return empty result if the function is called with offset <code>-9223372036854775808</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11367" target="_blank" rel="noopener noreferrer">#11367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12019" target="_blank" rel="noopener noreferrer">#12019</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed calculation of access rights when allow_ddl=0. <a href="https://github.com/ClickHouse/ClickHouse/pull/12015" target="_blank" rel="noopener noreferrer">#12015</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed potential array size overflow in generateRandom that may lead to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11371" target="_blank" rel="noopener noreferrer">#11371</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12013" target="_blank" rel="noopener noreferrer">#12013</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potential floating point exception. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11378" target="_blank" rel="noopener noreferrer">#11378</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12005" target="_blank" rel="noopener noreferrer">#12005</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed wrong setting name in log message at server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/11997" target="_blank" rel="noopener noreferrer">#11997</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>Query parameter was not set</code> in <code>Values</code> format. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11918" target="_blank" rel="noopener noreferrer">#11918</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11936" target="_blank" rel="noopener noreferrer">#11936</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Keep aliases for substitutions in query (parametrized queries). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11914" target="_blank" rel="noopener noreferrer">#11914</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11916" target="_blank" rel="noopener noreferrer">#11916</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed bug with no moves when changing storage policy from default one. <a href="https://github.com/ClickHouse/ClickHouse/pull/11893" target="_blank" rel="noopener noreferrer">#11893</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fixed potential floating point exception when parsing <code>DateTime64</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11374" target="_blank" rel="noopener noreferrer">#11374</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11875" target="_blank" rel="noopener noreferrer">#11875</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed memory accounting via HTTP interface (can be significant with <code>wait_end_of_query=1</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11840" target="_blank" rel="noopener noreferrer">#11840</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Parse metadata stored in zookeeper before checking for equality. <a href="https://github.com/ClickHouse/ClickHouse/pull/11739" target="_blank" rel="noopener noreferrer">#11739</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-10">Performance Improvement<a class="hash-link" href="#performance-improvement-10" title="Direct link to heading">​</a></h4><ul><li>Index not used for IN operator with literals, performance regression introduced around v19.3. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10574" target="_blank" rel="noopener noreferrer">#10574</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12062" target="_blank" rel="noopener noreferrer">#12062</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-12">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-12" title="Direct link to heading">​</a></h4><ul><li>Install <code>ca-certificates</code> before the first <code>apt-get update</code> in Dockerfile. <a href="https://github.com/ClickHouse/ClickHouse/pull/12095" target="_blank" rel="noopener noreferrer">#12095</a> (<a href="https://github.com/blinkov" target="_blank" rel="noopener noreferrer">Ivan Blinkov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v204653-stable-2020-06-25">ClickHouse release v20.4.6.53-stable 2020-06-25<a class="hash-link" href="#clickhouse-release-v204653-stable-2020-06-25" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-29">Bug Fix<a class="hash-link" href="#bug-fix-29" title="Direct link to heading">​</a></h4><ul><li>Fix rare crash caused by using <code>Nullable</code> column in prewhere condition. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/11608" target="_blank" rel="noopener noreferrer">#11608</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11869" target="_blank" rel="noopener noreferrer">#11869</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Don&#x27;t allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3933" target="_blank" rel="noopener noreferrer">#3933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11846" target="_blank" rel="noopener noreferrer">#11846</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix wrong result of comparison of FixedString with constant String. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11393" target="_blank" rel="noopener noreferrer">#11393</a>. This bug appeared in version 20.4. <a href="https://github.com/ClickHouse/ClickHouse/pull/11828" target="_blank" rel="noopener noreferrer">#11828</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix wrong result for <code>if()</code> with NULLs in condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/11807" target="_blank" rel="noopener noreferrer">#11807</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix using too many threads for queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11788" target="_blank" rel="noopener noreferrer">#11788</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix unexpected behaviour of queries like <code>SELECT *, xyz.*</code> which were success while an error expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/11753" target="_blank" rel="noopener noreferrer">#11753</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Now replicated fetches will be cancelled during metadata alter. <a href="https://github.com/ClickHouse/ClickHouse/pull/11744" target="_blank" rel="noopener noreferrer">#11744</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/11732" target="_blank" rel="noopener noreferrer">#11732</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix <code>ORDER BY ... WITH FILL</code> over const columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/11697" target="_blank" rel="noopener noreferrer">#11697</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href="https://github.com/ClickHouse/ClickHouse/pull/11690" target="_blank" rel="noopener noreferrer">#11690</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>LIMIT n WITH TIES</code> usage together with <code>ORDER BY</code> statement, which contains aliases. <a href="https://github.com/ClickHouse/ClickHouse/pull/11689" target="_blank" rel="noopener noreferrer">#11689</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix error which leads to an incorrect state of <code>system.mutations</code>. It may show that whole mutation is already done but the server still has <code>MUTATE_PART</code> tasks in the replication queue and tries to execute them. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11611" target="_blank" rel="noopener noreferrer">#11611</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11681" target="_blank" rel="noopener noreferrer">#11681</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add support for regular expressions with case-insensitive flags. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11101" target="_blank" rel="noopener noreferrer">#11101</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11506" target="_blank" rel="noopener noreferrer">#11506</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11649" target="_blank" rel="noopener noreferrer">#11649</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove trivial count query optimization if row-level security is set. In previous versions the user get total count of records in a table instead filtered. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11352" target="_blank" rel="noopener noreferrer">#11352</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11644" target="_blank" rel="noopener noreferrer">#11644</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bloom filters for String (data skipping indices). <a href="https://github.com/ClickHouse/ClickHouse/pull/11638" target="_blank" rel="noopener noreferrer">#11638</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix rare crash caused by using <code>Nullable</code> column in prewhere condition. (Probably it is connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/11572" target="_blank" rel="noopener noreferrer">#11572</a> somehow). <a href="https://github.com/ClickHouse/ClickHouse/pull/11608" target="_blank" rel="noopener noreferrer">#11608</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix error <code>Block structure mismatch</code> for queries with sampling reading from <code>Buffer</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11602" target="_blank" rel="noopener noreferrer">#11602</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix wrong exit code of the clickhouse-client, when exception.code() % 256 = 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/11601" target="_blank" rel="noopener noreferrer">#11601</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix trivial error in log message about &quot;Mark cache size was lowered&quot; at server startup. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11399" target="_blank" rel="noopener noreferrer">#11399</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11589" target="_blank" rel="noopener noreferrer">#11589</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix error <code>Size of offsets does not match size of column</code> for queries with <code>PREWHERE column in (subquery)</code> and <code>ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11580" target="_blank" rel="noopener noreferrer">#11580</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed rare segfault in <code>SHOW CREATE TABLE</code> Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11490" target="_blank" rel="noopener noreferrer">#11490</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11579" target="_blank" rel="noopener noreferrer">#11579</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>All queries in HTTP session have had the same query_id. It is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/11578" target="_blank" rel="noopener noreferrer">#11578</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href="https://github.com/ClickHouse/ClickHouse/pull/11550" target="_blank" rel="noopener noreferrer">#11550</a> (<a href="https://github.com/istarkov" target="_blank" rel="noopener noreferrer">Ivan Starkov</a>).</li><li>Fix shard_num/replica_num for <code>&lt;node&gt;</code> (breaks use_compact_format_in_distributed_parts_names). <a href="https://github.com/ClickHouse/ClickHouse/pull/11528" target="_blank" rel="noopener noreferrer">#11528</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix race condition which may lead to an exception during table drop. It&#x27;s a bit tricky and not dangerous at all. If you want an explanation, just notice me in telegram. <a href="https://github.com/ClickHouse/ClickHouse/pull/11523" target="_blank" rel="noopener noreferrer">#11523</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix memory leak when exception is thrown in the middle of aggregation with -State functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8995" target="_blank" rel="noopener noreferrer">#8995</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11496" target="_blank" rel="noopener noreferrer">#11496</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href="https://github.com/ClickHouse/ClickHouse/pull/11162" target="_blank" rel="noopener noreferrer">#11162</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Get rid of old libunwind patches. <a href="https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012</a> This allows to disable <code>-fno-omit-frame-pointer</code> in <code>clang</code> builds that improves performance at least by 1% in average. <a href="https://github.com/ClickHouse/ClickHouse/pull/10761" target="_blank" rel="noopener noreferrer">#10761</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix usage of primary key wrapped into a function with &#x27;FINAL&#x27; modifier and &#x27;ORDER BY&#x27; optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/10715" target="_blank" rel="noopener noreferrer">#10715</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-13">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-13" title="Direct link to heading">​</a></h4><ul><li>Fix several non significant errors in unit tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11262" target="_blank" rel="noopener noreferrer">#11262</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix (false) MSan report in MergeTreeIndexFullText. The issue first appeared in <a href="https://github.com/ClickHouse/ClickHouse/issues/9968" target="_blank" rel="noopener noreferrer">#9968</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10801" target="_blank" rel="noopener noreferrer">#10801</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v204536-stable-2020-06-10">ClickHouse release v20.4.5.36-stable 2020-06-10<a class="hash-link" href="#clickhouse-release-v204536-stable-2020-06-10" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-30">Bug Fix<a class="hash-link" href="#bug-fix-30" title="Direct link to heading">​</a></h4><ul><li>Fix the error <code>Data compressed with different methods</code> that can happen if <code>min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11539" target="_blank" rel="noopener noreferrer">#11539</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11540" target="_blank" rel="noopener noreferrer">#11540</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix return compressed size for codecs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11448" target="_blank" rel="noopener noreferrer">#11448</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11365" target="_blank" rel="noopener noreferrer">#11365</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11431" target="_blank" rel="noopener noreferrer">#11431</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix pointInPolygon with nan as point. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11375" target="_blank" rel="noopener noreferrer">#11375</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11421" target="_blank" rel="noopener noreferrer">#11421</a> (<a href="https://github.com/livace" target="_blank" rel="noopener noreferrer">Alexey Ilyukhov</a>).</li><li>Fix potential uninitialized memory read in MergeTree shutdown if table was not created successfully. <a href="https://github.com/ClickHouse/ClickHouse/pull/11420" target="_blank" rel="noopener noreferrer">#11420</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed geohashesInBox with arguments outside of latitude/longitude range. <a href="https://github.com/ClickHouse/ClickHouse/pull/11403" target="_blank" rel="noopener noreferrer">#11403</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fix possible <code>Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11359" target="_blank" rel="noopener noreferrer">#11359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11366" target="_blank" rel="noopener noreferrer">#11366</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Remove redundant lock during parts send in ReplicatedMergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/11354" target="_blank" rel="noopener noreferrer">#11354</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix support for <code>\G</code> (vertical output) in clickhouse-client in multiline mode. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9933" target="_blank" rel="noopener noreferrer">#9933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11350" target="_blank" rel="noopener noreferrer">#11350</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potential segfault when using <code>Lazy</code> database. <a href="https://github.com/ClickHouse/ClickHouse/pull/11348" target="_blank" rel="noopener noreferrer">#11348</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash in <code>quantilesExactWeightedArray</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11337" target="_blank" rel="noopener noreferrer">#11337</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Now merges stopped before change metadata in <code>ALTER</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11335" target="_blank" rel="noopener noreferrer">#11335</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Make writing to <code>MATERIALIZED VIEW</code> with setting <code>parallel_view_processing = 1</code> parallel again. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" target="_blank" rel="noopener noreferrer">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11330" target="_blank" rel="noopener noreferrer">#11330</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix visitParamExtractRaw when extracted JSON has strings with unbalanced { or [. <a href="https://github.com/ClickHouse/ClickHouse/pull/11318" target="_blank" rel="noopener noreferrer">#11318</a> (<a href="https://github.com/devwout" target="_blank" rel="noopener noreferrer">Ewout</a>).</li><li>Fix very rare race condition in ThreadPool. <a href="https://github.com/ClickHouse/ClickHouse/pull/11314" target="_blank" rel="noopener noreferrer">#11314</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix insignificant data race in clickhouse-copier. Found by integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11313" target="_blank" rel="noopener noreferrer">#11313</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potential uninitialized memory in conversion. Example: <code>SELECT toIntervalSecond(now64())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11311" target="_blank" rel="noopener noreferrer">#11311</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code>empty</code> or <code>notEmpty</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11286" target="_blank" rel="noopener noreferrer">#11286</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11303" target="_blank" rel="noopener noreferrer">#11303</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bug when query speed estimation can be incorrect and the limit of <code>min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code>max_network_bandwidth</code>, <code>max_execution_speed</code> or <code>priority</code> settings. Change the default value of <code>timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code>min_execution_speed</code> and <code>max_execution_speed</code> have no effect. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11297" target="_blank" rel="noopener noreferrer">#11297</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5732" target="_blank" rel="noopener noreferrer">#5732</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6228" target="_blank" rel="noopener noreferrer">#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code>clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11296" target="_blank" rel="noopener noreferrer">#11296</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash when SET DEFAULT ROLE is called with wrong arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10586" target="_blank" rel="noopener noreferrer">#10586</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11278" target="_blank" rel="noopener noreferrer">#11278</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix crash while reading malformed data in Protobuf format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5957" target="_blank" rel="noopener noreferrer">#5957</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11203" target="_blank" rel="noopener noreferrer">#11203</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11258" target="_blank" rel="noopener noreferrer">#11258</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed a bug when cache-dictionary could return default value instead of normal (when there are only expired keys). This affects only string fields. <a href="https://github.com/ClickHouse/ClickHouse/pull/11233" target="_blank" rel="noopener noreferrer">#11233</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix error <code>Block structure mismatch in QueryPipeline</code> while reading from <code>VIEW</code> with constants in inner query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11181" target="_blank" rel="noopener noreferrer">#11181</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11205" target="_blank" rel="noopener noreferrer">#11205</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix possible exception <code>Invalid status for associated output</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11200" target="_blank" rel="noopener noreferrer">#11200</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix possible error <code>Cannot capture column</code> for higher-order functions with <code>Array(Array(LowCardinality))</code> captured argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/11185" target="_blank" rel="noopener noreferrer">#11185</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed S3 globbing which could fail in case of more than 1000 keys and some backends. <a href="https://github.com/ClickHouse/ClickHouse/pull/11179" target="_blank" rel="noopener noreferrer">#11179</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href="https://github.com/ClickHouse/ClickHouse/pull/11162" target="_blank" rel="noopener noreferrer">#11162</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix Kafka performance issue related to reschedules based on limits, which were always applied. <a href="https://github.com/ClickHouse/ClickHouse/pull/11149" target="_blank" rel="noopener noreferrer">#11149</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix for the hang which was happening sometimes during DROP of table engine=Kafka (or during server restarts). <a href="https://github.com/ClickHouse/ClickHouse/pull/11145" target="_blank" rel="noopener noreferrer">#11145</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix excessive reserving of threads for simple queries (optimization for reducing the number of threads, which was partly broken after changes in pipeline). <a href="https://github.com/ClickHouse/ClickHouse/pull/11114" target="_blank" rel="noopener noreferrer">#11114</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix predicates optimization for distributed queries (<code>enable_optimize_predicate_expression=1</code>) for queries with <code>HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10613" target="_blank" rel="noopener noreferrer">#10613</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11413" target="_blank" rel="noopener noreferrer">#11413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10621" target="_blank" rel="noopener noreferrer">#10621</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-14">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-14" title="Direct link to heading">​</a></h4><ul><li>Fix several flaky integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11355" target="_blank" rel="noopener noreferrer">#11355</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v204418-stable-2020-05-26">ClickHouse release v20.4.4.18-stable 2020-05-26<a class="hash-link" href="#clickhouse-release-v204418-stable-2020-05-26" title="Direct link to heading">​</a></h3><p>No changes compared to v20.4.3.16-stable.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v204316-stable-2020-05-23">ClickHouse release v20.4.3.16-stable 2020-05-23<a class="hash-link" href="#clickhouse-release-v204316-stable-2020-05-23" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-31">Bug Fix<a class="hash-link" href="#bug-fix-31" title="Direct link to heading">​</a></h4><ul><li>Removed logging from mutation finalization task if nothing was finalized. <a href="https://github.com/ClickHouse/ClickHouse/pull/11109" target="_blank" rel="noopener noreferrer">#11109</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed memory leak in registerDiskS3. <a href="https://github.com/ClickHouse/ClickHouse/pull/11074" target="_blank" rel="noopener noreferrer">#11074</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>).</li><li>Fixed the potential missed data during termination of Kafka engine table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11048" target="_blank" rel="noopener noreferrer">#11048</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed <code>parseDateTime64BestEffort</code> argument resolution bugs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11038" target="_blank" rel="noopener noreferrer">#11038</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fixed very rare potential use-after-free error in <code>MergeTree</code> if table was not created successfully. <a href="https://github.com/ClickHouse/ClickHouse/pull/10986" target="_blank" rel="noopener noreferrer">#10986</a>, <a href="https://github.com/ClickHouse/ClickHouse/pull/10970" target="_blank" rel="noopener noreferrer">#10970</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed metadata (relative path for rename) and data (relative path for symlink) handling for Atomic database. <a href="https://github.com/ClickHouse/ClickHouse/pull/10980" target="_blank" rel="noopener noreferrer">#10980</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed server crash on concurrent <code>ALTER</code> and <code>DROP DATABASE</code> queries with <code>Atomic</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10968" target="_blank" rel="noopener noreferrer">#10968</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed incorrect raw data size in <code>getRawData()</code> method. <a href="https://github.com/ClickHouse/ClickHouse/pull/10964" target="_blank" rel="noopener noreferrer">#10964</a> (<a href="https://github.com/ObjatieGroba" target="_blank" rel="noopener noreferrer">Igr</a>).</li><li>Fixed incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of GROUP BY result is large and aggregation is performed by a single String field. It leads to several unmerged rows for a single key in result. <a href="https://github.com/ClickHouse/ClickHouse/pull/10952" target="_blank" rel="noopener noreferrer">#10952</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed sending partially written files by the <code>DistributedBlockOutputStream</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10940" target="_blank" rel="noopener noreferrer">#10940</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed crash in <code>SELECT count(notNullIn(NULL, []))</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10920" target="_blank" rel="noopener noreferrer">#10920</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed the hang which was happening sometimes during <code>DROP</code> of <code>Kafka</code> table engine. (or during server restarts). <a href="https://github.com/ClickHouse/ClickHouse/pull/10910" target="_blank" rel="noopener noreferrer">#10910</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed the impossibility of executing multiple <code>ALTER RENAME</code> like <code>a TO b, c TO a</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10895" target="_blank" rel="noopener noreferrer">#10895</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed possible race which could happen when you get result from aggregate function state from multiple thread for the same column. The only way it can happen is when you use <code>finalizeAggregation</code> function while reading from table with <code>Memory</code> engine which stores <code>AggregateFunction</code> state for <code>quantile*</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/10890" target="_blank" rel="noopener noreferrer">#10890</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed backward compatibility with tuples in Distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10889" target="_blank" rel="noopener noreferrer">#10889</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed <code>SIGSEGV</code> in <code>StringHashTable</code> if such a key does not exist. <a href="https://github.com/ClickHouse/ClickHouse/pull/10870" target="_blank" rel="noopener noreferrer">#10870</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <code>WATCH</code> hangs after <code>LiveView</code> table was dropped from database with <code>Atomic</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10859" target="_blank" rel="noopener noreferrer">#10859</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed bug in <code>ReplicatedMergeTree</code> which might cause some <code>ALTER</code> on <code>OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href="https://github.com/ClickHouse/ClickHouse/pull/10849" target="_blank" rel="noopener noreferrer">#10849</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Now constraints are updated if the column participating in <code>CONSTRAINT</code> expression was renamed. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10844" target="_blank" rel="noopener noreferrer">#10844</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10847" target="_blank" rel="noopener noreferrer">#10847</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed potential read of uninitialized memory in cache-dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/10834" target="_blank" rel="noopener noreferrer">#10834</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed columns order after <code>Block::sortColumns()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10826" target="_blank" rel="noopener noreferrer">#10826</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed the issue with <code>ODBC</code> bridge when no quoting of identifiers is requested. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7984" target="_blank" rel="noopener noreferrer">#7984</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10821" target="_blank" rel="noopener noreferrer">#10821</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>UBSan</code> and <code>MSan</code> report in <code>DateLUT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10798" target="_blank" rel="noopener noreferrer">#10798</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed incorrect type conversion in key conditions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6287" target="_blank" rel="noopener noreferrer">#6287</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10791" target="_blank" rel="noopener noreferrer">#10791</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>).</li><li>Fixed <code>parallel_view_processing</code> behavior. Now all insertions into <code>MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" target="_blank" rel="noopener noreferrer">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10757" target="_blank" rel="noopener noreferrer">#10757</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed combinator <code>-OrNull</code> and <code>-OrDefault</code> when combined with <code>-State</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10741" target="_blank" rel="noopener noreferrer">#10741</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Fixed possible buffer overflow in function <code>h3EdgeAngle</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10711" target="_blank" rel="noopener noreferrer">#10711</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed bug which locks concurrent alters when table has a lot of parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10659" target="_blank" rel="noopener noreferrer">#10659</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>nullptr</code> dereference in <code>StorageBuffer</code> if server was shutdown before table startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/10641" target="_blank" rel="noopener noreferrer">#10641</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>optimize_skip_unused_shards</code> with <code>LowCardinality</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10611" target="_blank" rel="noopener noreferrer">#10611</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed handling condition variable for synchronous mutations. In some cases signals to that condition variable could be lost. <a href="https://github.com/ClickHouse/ClickHouse/pull/10588" target="_blank" rel="noopener noreferrer">#10588</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>Fixed possible crash when <code>createDictionary()</code> is called before <code>loadStoredObject()</code> has finished. <a href="https://github.com/ClickHouse/ClickHouse/pull/10587" target="_blank" rel="noopener noreferrer">#10587</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed <code>SELECT</code> of column <code>ALIAS</code> which default expression type different from column type. <a href="https://github.com/ClickHouse/ClickHouse/pull/10563" target="_blank" rel="noopener noreferrer">#10563</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Implemented comparison between DateTime64 and String values. <a href="https://github.com/ClickHouse/ClickHouse/pull/10560" target="_blank" rel="noopener noreferrer">#10560</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Disable <code>GROUP BY</code> sharding_key optimization by default (<code>optimize_distributed_group_by_sharding_key</code> had been introduced and turned of by default, due to trickery of sharding_key analyzing, simple example is <code>if</code> in sharding key) and fix it for <code>WITH ROLLUP/CUBE/TOTALS</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10516" target="_blank" rel="noopener noreferrer">#10516</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/10263" target="_blank" rel="noopener noreferrer">#10263</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10486" target="_blank" rel="noopener noreferrer">#10486</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Added tests about <code>max_rows_to_sort</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10268" target="_blank" rel="noopener noreferrer">#10268</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added backward compatibility for create bloom filter index. <a href="https://github.com/ClickHouse/ClickHouse/issues/10551" target="_blank" rel="noopener noreferrer">#10551</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10569" target="_blank" rel="noopener noreferrer">#10569</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20429-2020-05-12">ClickHouse release v20.4.2.9, 2020-05-12<a class="hash-link" href="#clickhouse-release-v20429-2020-05-12" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-8">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-8" title="Direct link to heading">​</a></h4><ul><li>System tables (e.g. system.query_log, system.trace_log, system.metric_log) are using compact data part format for parts smaller than 10 MiB in size. Compact data part format is supported since version 20.3. If you are going to downgrade to version less than 20.3, you should manually delete table data for system logs in <code>/var/lib/clickhouse/data/system/</code>.</li><li>When string comparison involves FixedString and compared arguments are of different sizes, do comparison as if smaller string is padded to the length of the larger. This is intented for SQL compatibility if we imagine that FixedString data type corresponds to SQL CHAR. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9272" target="_blank" rel="noopener noreferrer">#9272</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10363" target="_blank" rel="noopener noreferrer">#10363</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Make SHOW CREATE TABLE multiline. Now it is more readable and more like MySQL. <a href="https://github.com/ClickHouse/ClickHouse/pull/10049" target="_blank" rel="noopener noreferrer">#10049</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Added a setting <code>validate_polygons</code> that is used in <code>pointInPolygon</code> function and enabled by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/9857" target="_blank" rel="noopener noreferrer">#9857</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-8">New Feature<a class="hash-link" href="#new-feature-8" title="Direct link to heading">​</a></h4><ul><li>Add support for secured connection from ClickHouse to Zookeeper <a href="https://github.com/ClickHouse/ClickHouse/pull/10184" target="_blank" rel="noopener noreferrer">#10184</a> (<a href="https://github.com/xzkostyan" target="_blank" rel="noopener noreferrer">Konstantin Lebedev</a>)</li><li>Support custom HTTP handlers. See <a href="https://github.com/ClickHouse/ClickHouse/issues/5436" target="_blank" rel="noopener noreferrer">#5436</a> for description. <a href="https://github.com/ClickHouse/ClickHouse/pull/7572" target="_blank" rel="noopener noreferrer">#7572</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Add MessagePack Input/Output format. <a href="https://github.com/ClickHouse/ClickHouse/pull/9889" target="_blank" rel="noopener noreferrer">#9889</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>)</li><li>Add Regexp input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/9196" target="_blank" rel="noopener noreferrer">#9196</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>)</li><li>Added output format <code>Markdown</code> for embedding tables in markdown documents. <a href="https://github.com/ClickHouse/ClickHouse/pull/10317" target="_blank" rel="noopener noreferrer">#10317</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>)</li><li>Added support for custom settings section in dictionaries. Also fixes issue <a href="https://github.com/ClickHouse/ClickHouse/issues/2829" target="_blank" rel="noopener noreferrer">#2829</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10137" target="_blank" rel="noopener noreferrer">#10137</a> (<a href="https://github.com/kekekekule" target="_blank" rel="noopener noreferrer">Artem Streltsov</a>)</li><li>Added custom settings support in DDL-queries for <code>CREATE DICTIONARY</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/10465" target="_blank" rel="noopener noreferrer">#10465</a> (<a href="https://github.com/kekekekule" target="_blank" rel="noopener noreferrer">Artem Streltsov</a>)</li><li>Add simple server-wide memory profiler that will collect allocation contexts when server memory usage becomes higher than the next allocation threshold. <a href="https://github.com/ClickHouse/ClickHouse/pull/10444" target="_blank" rel="noopener noreferrer">#10444</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add setting <code>always_fetch_merged_part</code> which restrict replica to merge parts by itself and always prefer dowloading from other replicas. <a href="https://github.com/ClickHouse/ClickHouse/pull/10379" target="_blank" rel="noopener noreferrer">#10379</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Add function <code>JSONExtractKeysAndValuesRaw</code> which extracts raw data from JSON objects <a href="https://github.com/ClickHouse/ClickHouse/pull/10378" target="_blank" rel="noopener noreferrer">#10378</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Add memory usage from OS to <code>system.asynchronous_metrics</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10361" target="_blank" rel="noopener noreferrer">#10361</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added generic variants for functions <code>least</code> and <code>greatest</code>. Now they work with arbitrary number of arguments of arbitrary types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4767" target="_blank" rel="noopener noreferrer">#4767</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10318" target="_blank" rel="noopener noreferrer">#10318</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Now ClickHouse controls timeouts of dictionary sources on its side. Two new settings added to cache dictionary configuration: <code>strict_max_lifetime_seconds</code>, which is <code>max_lifetime</code> by default, and <code>query_wait_timeout_milliseconds</code>, which is one minute by default. The first settings is also useful with <code>allow_read_expired_keys</code> settings (to forbid reading very expired keys). <a href="https://github.com/ClickHouse/ClickHouse/pull/10337" target="_blank" rel="noopener noreferrer">#10337</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Add log_queries_min_type to filter which entries will be written to query_log <a href="https://github.com/ClickHouse/ClickHouse/pull/10053" target="_blank" rel="noopener noreferrer">#10053</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Added function <code>isConstant</code>. This function checks whether its argument is constant expression and returns 1 or 0. It is intended for development, debugging and demonstration purposes. <a href="https://github.com/ClickHouse/ClickHouse/pull/10198" target="_blank" rel="noopener noreferrer">#10198</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>add joinGetOrNull to return NULL when key is missing instead of returning the default value. <a href="https://github.com/ClickHouse/ClickHouse/pull/10094" target="_blank" rel="noopener noreferrer">#10094</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Consider <code>NULL</code> to be equal to <code>NULL</code> in <code>IN</code> operator, if the option <code>transform_null_in</code> is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/10085" target="_blank" rel="noopener noreferrer">#10085</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>)</li><li>Add <code>ALTER TABLE ... RENAME COLUMN</code> for MergeTree table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/9948" target="_blank" rel="noopener noreferrer">#9948</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Support parallel distributed INSERT SELECT. <a href="https://github.com/ClickHouse/ClickHouse/pull/9759" target="_blank" rel="noopener noreferrer">#9759</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>)</li><li>Add ability to query Distributed over Distributed (w/o <code>distributed_group_by_no_merge</code>) ... <a href="https://github.com/ClickHouse/ClickHouse/pull/9923" target="_blank" rel="noopener noreferrer">#9923</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Add function <code>arrayReduceInRanges</code> which aggregates array elements in given ranges. <a href="https://github.com/ClickHouse/ClickHouse/pull/9598" target="_blank" rel="noopener noreferrer">#9598</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Add Dictionary Status on prometheus exporter. <a href="https://github.com/ClickHouse/ClickHouse/pull/9622" target="_blank" rel="noopener noreferrer">#9622</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>)</li><li>Add function <code>arrayAUC</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8698" target="_blank" rel="noopener noreferrer">#8698</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>)</li><li>Support <code>DROP VIEW</code> statement for better TPC-H compatibility. <a href="https://github.com/ClickHouse/ClickHouse/pull/9831" target="_blank" rel="noopener noreferrer">#9831</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Add &#x27;strict_order&#x27; option to windowFunnel() <a href="https://github.com/ClickHouse/ClickHouse/pull/9773" target="_blank" rel="noopener noreferrer">#9773</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>)</li><li>Support <code>DATE</code> and <code>TIMESTAMP</code> SQL operators, e.g. <code>SELECT date &#x27;2001-01-01&#x27;</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9691" target="_blank" rel="noopener noreferrer">#9691</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-6">Experimental Feature<a class="hash-link" href="#experimental-feature-6" title="Direct link to heading">​</a></h4><ul><li>Added experimental database engine Atomic. It supports non-blocking <code>DROP</code> and <code>RENAME TABLE</code> queries and atomic <code>EXCHANGE TABLES t1 AND t2</code> query <a href="https://github.com/ClickHouse/ClickHouse/pull/7512" target="_blank" rel="noopener noreferrer">#7512</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Initial support for ReplicatedMergeTree over S3 (it works in suboptimal way) <a href="https://github.com/ClickHouse/ClickHouse/pull/10126" target="_blank" rel="noopener noreferrer">#10126</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-32">Bug Fix<a class="hash-link" href="#bug-fix-32" title="Direct link to heading">​</a></h4><ul><li>Fixed incorrect scalar results inside inner query of <code>MATERIALIZED VIEW</code> in case if this query contained dependent table <a href="https://github.com/ClickHouse/ClickHouse/pull/10603" target="_blank" rel="noopener noreferrer">#10603</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fixed bug, which caused HTTP requests to get stuck on client closing connection when <code>readonly=2</code> and <code>cancel_http_readonly_queries_on_client_close=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10684" target="_blank" rel="noopener noreferrer">#10684</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix segfault in StorageBuffer when exception is thrown on server startup. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10550" target="_blank" rel="noopener noreferrer">#10550</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10609" target="_blank" rel="noopener noreferrer">#10609</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>The query<code>SYSTEM DROP DNS CACHE</code> now also drops caches used to check if user is allowed to connect from some IP addresses <a href="https://github.com/ClickHouse/ClickHouse/pull/10608" target="_blank" rel="noopener noreferrer">#10608</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix usage of multiple <code>IN</code> operators with an identical set in one query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10539" target="_blank" rel="noopener noreferrer">#10539</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10686" target="_blank" rel="noopener noreferrer">#10686</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fix crash in <code>generateRandom</code> with nested types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10583" target="_blank" rel="noopener noreferrer">#10583</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10734" target="_blank" rel="noopener noreferrer">#10734</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix data corruption for <code>LowCardinality(FixedString)</code> key column in <code>SummingMergeTree</code> which could have happened after merge. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10489" target="_blank" rel="noopener noreferrer">#10489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10721" target="_blank" rel="noopener noreferrer">#10721</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix logic for aggregation_memory_efficient_merge_threads setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10667" target="_blank" rel="noopener noreferrer">#10667</a> (<a href="https://github.com/palasonic1" target="_blank" rel="noopener noreferrer">palasonic1</a>)</li><li>Fix disappearing totals. Totals could have being filtered if query had <code>JOIN</code> or subquery with external <code>WHERE</code> condition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10674" target="_blank" rel="noopener noreferrer">#10674</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10698" target="_blank" rel="noopener noreferrer">#10698</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix the lack of parallel execution of remote queries with <code>distributed_aggregation_memory_efficient</code> enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10655" target="_blank" rel="noopener noreferrer">#10655</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10664" target="_blank" rel="noopener noreferrer">#10664</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix possible incorrect number of rows for queries with <code>LIMIT</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10566" target="_blank" rel="noopener noreferrer">#10566</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10709" target="_blank" rel="noopener noreferrer">#10709</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10660" target="_blank" rel="noopener noreferrer">#10660</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix index corruption, which may occur in some cases after merging compact parts into another compact part. <a href="https://github.com/ClickHouse/ClickHouse/pull/10531" target="_blank" rel="noopener noreferrer">#10531</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fix the situation, when mutation finished all parts, but hung up in <code>is_done=0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10526" target="_blank" rel="noopener noreferrer">#10526</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix overflow at beginning of unix epoch for timezones with fractional offset from UTC. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9335" target="_blank" rel="noopener noreferrer">#9335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10513" target="_blank" rel="noopener noreferrer">#10513</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Better diagnostics for input formats. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10204" target="_blank" rel="noopener noreferrer">#10204</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10418" target="_blank" rel="noopener noreferrer">#10418</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix numeric overflow in <code>simpleLinearRegression()</code> over large integers <a href="https://github.com/ClickHouse/ClickHouse/pull/10474" target="_blank" rel="noopener noreferrer">#10474</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Fix use-after-free in Distributed shutdown, avoid waiting for sending all batches <a href="https://github.com/ClickHouse/ClickHouse/pull/10491" target="_blank" rel="noopener noreferrer">#10491</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Add CA certificates to clickhouse-server docker image <a href="https://github.com/ClickHouse/ClickHouse/pull/10476" target="_blank" rel="noopener noreferrer">#10476</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Fix a rare endless loop that might have occurred when using the <code>addressToLine</code> function or AggregateFunctionState columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/10466" target="_blank" rel="noopener noreferrer">#10466</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Handle zookeeper &quot;no node error&quot; during distributed query <a href="https://github.com/ClickHouse/ClickHouse/pull/10050" target="_blank" rel="noopener noreferrer">#10050</a> (<a href="https://github.com/Phantomape" target="_blank" rel="noopener noreferrer">Daniel Chen</a>)</li><li>Fix bug when server cannot attach table after column&#x27;s default was altered. <a href="https://github.com/ClickHouse/ClickHouse/pull/10441" target="_blank" rel="noopener noreferrer">#10441</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Implicitly cast the default expression type to the column type for the ALIAS columns <a href="https://github.com/ClickHouse/ClickHouse/pull/10563" target="_blank" rel="noopener noreferrer">#10563</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Don&#x27;t remove metadata directory if <code>ATTACH DATABASE</code> fails <a href="https://github.com/ClickHouse/ClickHouse/pull/10442" target="_blank" rel="noopener noreferrer">#10442</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Avoid dependency on system tzdata. Fixes loading of <code>Africa/Casablanca</code> timezone on CentOS 8. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10211" target="_blank" rel="noopener noreferrer">#10211</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10425" target="_blank" rel="noopener noreferrer">#10425</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix some issues if data is inserted with quorum and then gets deleted (DROP PARTITION, TTL, etc.). It led to stuck of INSERTs or false-positive exceptions in SELECTs. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9946" target="_blank" rel="noopener noreferrer">#9946</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10188" target="_blank" rel="noopener noreferrer">#10188</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Check the number and type of arguments when creating BloomFilter index <a href="https://github.com/ClickHouse/ClickHouse/issues/9623" target="_blank" rel="noopener noreferrer">#9623</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10431" target="_blank" rel="noopener noreferrer">#10431</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Prefer <code>fallback_to_stale_replicas</code> over <code>skip_unavailable_shards</code>, otherwise when both settings specified and there are no up-to-date replicas the query will fail (patch from @alex-zaitsev ) <a href="https://github.com/ClickHouse/ClickHouse/pull/10422" target="_blank" rel="noopener noreferrer">#10422</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix the issue when a query with ARRAY JOIN, ORDER BY and LIMIT may return incomplete result. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10226" target="_blank" rel="noopener noreferrer">#10226</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10427" target="_blank" rel="noopener noreferrer">#10427</a> (<a href="https://github.com/VadimPlh" target="_blank" rel="noopener noreferrer">Vadim Plakhtinskiy</a>)</li><li>Add database name to dictionary name after DETACH/ATTACH. Fixes system.dictionaries table and <code>SYSTEM RELOAD</code> query <a href="https://github.com/ClickHouse/ClickHouse/pull/10415" target="_blank" rel="noopener noreferrer">#10415</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix possible incorrect result for extremes in processors pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/10131" target="_blank" rel="noopener noreferrer">#10131</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix possible segfault when the setting <code>distributed_group_by_no_merge</code> is enabled (introduced in 20.3.7.46 by <a href="https://github.com/ClickHouse/ClickHouse/issues/10131" target="_blank" rel="noopener noreferrer">#10131</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10399" target="_blank" rel="noopener noreferrer">#10399</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix wrong flattening of <code>Array(Tuple(...))</code> data types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10259" target="_blank" rel="noopener noreferrer">#10259</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10390" target="_blank" rel="noopener noreferrer">#10390</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix column names of constants inside JOIN that may clash with names of constants outside of JOIN <a href="https://github.com/ClickHouse/ClickHouse/pull/9950" target="_blank" rel="noopener noreferrer">#9950</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Fix order of columns after Block::sortColumns() <a href="https://github.com/ClickHouse/ClickHouse/pull/10826" target="_blank" rel="noopener noreferrer">#10826</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix possible <code>Pipeline stuck</code> error in <code>ConcatProcessor</code> which may happen in remote query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10381" target="_blank" rel="noopener noreferrer">#10381</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Don&#x27;t make disk reservations for aggregations. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9241" target="_blank" rel="noopener noreferrer">#9241</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10375" target="_blank" rel="noopener noreferrer">#10375</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix wrong behaviour of datetime functions for timezones that has altered between positive and negative offsets from UTC (e.g. Pacific/Kiritimati). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7202" target="_blank" rel="noopener noreferrer">#7202</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10369" target="_blank" rel="noopener noreferrer">#10369</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Avoid infinite loop in <code>dictIsIn</code> function. Fixes #515 <a href="https://github.com/ClickHouse/ClickHouse/pull/10365" target="_blank" rel="noopener noreferrer">#10365</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Disable GROUP BY sharding_key optimization by default and fix it for WITH ROLLUP/CUBE/TOTALS <a href="https://github.com/ClickHouse/ClickHouse/pull/10516" target="_blank" rel="noopener noreferrer">#10516</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Check for error code when checking parts and don&#x27;t mark part as broken if the error is like &quot;not enough memory&quot;. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6269" target="_blank" rel="noopener noreferrer">#6269</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10364" target="_blank" rel="noopener noreferrer">#10364</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Show information about not loaded dictionaries in system tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10234" target="_blank" rel="noopener noreferrer">#10234</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Fix nullptr dereference in StorageBuffer if server was shutdown before table startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/10641" target="_blank" rel="noopener noreferrer">#10641</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed <code>DROP</code> vs <code>OPTIMIZE</code> race in <code>ReplicatedMergeTree</code>. <code>DROP</code> could left some garbage in replica path in ZooKeeper if there was concurrent <code>OPTIMIZE</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10312" target="_blank" rel="noopener noreferrer">#10312</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix &#x27;Logical error: CROSS JOIN has expressions&#x27; error for queries with comma and names joins mix. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9910" target="_blank" rel="noopener noreferrer">#9910</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10311" target="_blank" rel="noopener noreferrer">#10311</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix queries with <code>max_bytes_before_external_group_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10302" target="_blank" rel="noopener noreferrer">#10302</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix the issue with limiting maximum recursion depth in parser in certain cases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10283" target="_blank" rel="noopener noreferrer">#10283</a> This fix may introduce minor incompatibility: long and deep queries via clickhouse-client may refuse to work, and you should adjust settings <code>max_query_size</code> and <code>max_parser_depth</code> accordingly. <a href="https://github.com/ClickHouse/ClickHouse/pull/10295" target="_blank" rel="noopener noreferrer">#10295</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Allow to use <code>count(*)</code> with multiple JOINs. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9853" target="_blank" rel="noopener noreferrer">#9853</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10291" target="_blank" rel="noopener noreferrer">#10291</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix error <code>Pipeline stuck</code> with <code>max_rows_to_group_by</code> and <code>group_by_overflow_mode = &#x27;break&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10279" target="_blank" rel="noopener noreferrer">#10279</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix &#x27;Cannot add column&#x27; error while creating <code>range_hashed</code> dictionary using DDL query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10093" target="_blank" rel="noopener noreferrer">#10093</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10235" target="_blank" rel="noopener noreferrer">#10235</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix rare possible exception <code>Cannot drain connections: cancel first</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10239" target="_blank" rel="noopener noreferrer">#10239</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fixed bug where ClickHouse would throw &quot;Unknown function lambda.&quot; error message when user tries to run ALTER UPDATE/DELETE on tables with ENGINE = Replicated*. Check for nondeterministic functions now handles lambda expressions correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/10237" target="_blank" rel="noopener noreferrer">#10237</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Fixed reasonably rare segfault in StorageSystemTables that happens when SELECT ... FROM system.tables is run on a database with Lazy engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10209" target="_blank" rel="noopener noreferrer">#10209</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Fix possible infinite query execution when the query actually should stop on LIMIT, while reading from infinite source like <code>system.numbers</code> or <code>system.zeros</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10206" target="_blank" rel="noopener noreferrer">#10206</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fixed &quot;generateRandom&quot; function for Date type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9973" target="_blank" rel="noopener noreferrer">#9973</a>. Fix an edge case when dates with year 2106 are inserted to MergeTree tables with old-style partitioning but partitions are named with year 1970. <a href="https://github.com/ClickHouse/ClickHouse/pull/10218" target="_blank" rel="noopener noreferrer">#10218</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Convert types if the table definition of a View does not correspond to the SELECT query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10180" target="_blank" rel="noopener noreferrer">#10180</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/10022" target="_blank" rel="noopener noreferrer">#10022</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10217" target="_blank" rel="noopener noreferrer">#10217</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix <code>parseDateTimeBestEffort</code> for strings in RFC-2822 when day of week is Tuesday or Thursday. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10082" target="_blank" rel="noopener noreferrer">#10082</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10214" target="_blank" rel="noopener noreferrer">#10214</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix column names of constants inside JOIN that may clash with names of constants outside of JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/10207" target="_blank" rel="noopener noreferrer">#10207</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix move-to-prewhere optimization in presense of arrayJoin functions (in certain cases). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10092" target="_blank" rel="noopener noreferrer">#10092</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10195" target="_blank" rel="noopener noreferrer">#10195</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix issue with separator appearing in SCRAMBLE for native mysql-connector-java (JDBC) <a href="https://github.com/ClickHouse/ClickHouse/pull/10140" target="_blank" rel="noopener noreferrer">#10140</a> (<a href="https://github.com/BohuTANG" target="_blank" rel="noopener noreferrer">BohuTANG</a>)</li><li>Fix using the current database for an access checking when the database isn&#x27;t specified. <a href="https://github.com/ClickHouse/ClickHouse/pull/10192" target="_blank" rel="noopener noreferrer">#10192</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Fix ALTER of tables with compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10130" target="_blank" rel="noopener noreferrer">#10130</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Add the ability to relax the restriction on non-deterministic functions usage in mutations with <code>allow_nondeterministic_mutations</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10186" target="_blank" rel="noopener noreferrer">#10186</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Fix <code>DROP TABLE</code> invoked for dictionary <a href="https://github.com/ClickHouse/ClickHouse/pull/10165" target="_blank" rel="noopener noreferrer">#10165</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Convert blocks if structure does not match when doing <code>INSERT</code> into Distributed table <a href="https://github.com/ClickHouse/ClickHouse/pull/10135" target="_blank" rel="noopener noreferrer">#10135</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>The number of rows was logged incorrectly (as sum across all parts) when inserted block is split by parts with partition key. <a href="https://github.com/ClickHouse/ClickHouse/pull/10138" target="_blank" rel="noopener noreferrer">#10138</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add some arguments check and support identifier arguments for MySQL Database Engine <a href="https://github.com/ClickHouse/ClickHouse/pull/10077" target="_blank" rel="noopener noreferrer">#10077</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Fix incorrect <code>index_granularity_bytes</code> check while creating new replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10098" target="_blank" rel="noopener noreferrer">#10098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10121" target="_blank" rel="noopener noreferrer">#10121</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix bug in <code>CHECK TABLE</code> query when table contain skip indices. <a href="https://github.com/ClickHouse/ClickHouse/pull/10068" target="_blank" rel="noopener noreferrer">#10068</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix Distributed-over-Distributed with the only one shard in a nested table <a href="https://github.com/ClickHouse/ClickHouse/pull/9997" target="_blank" rel="noopener noreferrer">#9997</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix possible rows loss for queries with <code>JOIN</code> and <code>UNION ALL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9826" target="_blank" rel="noopener noreferrer">#9826</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10113" target="_blank" rel="noopener noreferrer">#10113</a>. ... <a href="https://github.com/ClickHouse/ClickHouse/pull/10099" target="_blank" rel="noopener noreferrer">#10099</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix bug in dictionary when local clickhouse server is used as source. It may caused memory corruption if types in dictionary and source are not compatible. <a href="https://github.com/ClickHouse/ClickHouse/pull/10071" target="_blank" rel="noopener noreferrer">#10071</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fixed replicated tables startup when updating from an old ClickHouse version where <code>/table/replicas/replica_name/metadata</code> node does not exist. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10037" target="_blank" rel="noopener noreferrer">#10037</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10095" target="_blank" rel="noopener noreferrer">#10095</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix error <code>Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. It happened when setting <code>distributed_aggregation_memory_efficient</code> was enabled, and distributed query read aggregating data with mixed single and two-level aggregation from different shards.  <a href="https://github.com/ClickHouse/ClickHouse/pull/10063" target="_blank" rel="noopener noreferrer">#10063</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix deadlock when database with materialized view failed attach at start <a href="https://github.com/ClickHouse/ClickHouse/pull/10054" target="_blank" rel="noopener noreferrer">#10054</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix a segmentation fault that could occur in GROUP BY over string keys containing trailing zero bytes (<a href="https://github.com/ClickHouse/ClickHouse/issues/8636" target="_blank" rel="noopener noreferrer">#8636</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/8925" target="_blank" rel="noopener noreferrer">#8925</a>). ... <a href="https://github.com/ClickHouse/ClickHouse/pull/10025" target="_blank" rel="noopener noreferrer">#10025</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Fix wrong results of distributed queries when alias could override qualified column name. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9672" target="_blank" rel="noopener noreferrer">#9672</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/9714" target="_blank" rel="noopener noreferrer">#9714</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9972" target="_blank" rel="noopener noreferrer">#9972</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix possible deadlock in <code>SYSTEM RESTART REPLICAS</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9955" target="_blank" rel="noopener noreferrer">#9955</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix the number of threads used for remote query execution (performance regression, since 20.3). This happened when query from <code>Distributed</code> table was executed simultaneously on local and remote shards. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9965" target="_blank" rel="noopener noreferrer">#9965</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9971" target="_blank" rel="noopener noreferrer">#9971</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fixed <code>DeleteOnDestroy</code> logic in <code>ATTACH PART</code> which could lead to automatic removal of attached part and added few tests <a href="https://github.com/ClickHouse/ClickHouse/pull/9410" target="_blank" rel="noopener noreferrer">#9410</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fix a bug with <code>ON CLUSTER</code> DDL queries freezing on server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/9927" target="_blank" rel="noopener noreferrer">#9927</a> (<a href="https://github.com/garneja" target="_blank" rel="noopener noreferrer">Gagan Arneja</a>)</li><li>Fix bug in which the necessary tables weren&#x27;t retrieved at one of the processing stages of queries to some databases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9699" target="_blank" rel="noopener noreferrer">#9699</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9949" target="_blank" rel="noopener noreferrer">#9949</a> (<a href="https://github.com/achulkov2" target="_blank" rel="noopener noreferrer">achulkov2</a>)</li><li>Fix &#x27;Not found column in block&#x27; error when <code>JOIN</code> appears with <code>TOTALS</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9839" target="_blank" rel="noopener noreferrer">#9839</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9939" target="_blank" rel="noopener noreferrer">#9939</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix parsing multiple hosts set in the CREATE USER command <a href="https://github.com/ClickHouse/ClickHouse/pull/9924" target="_blank" rel="noopener noreferrer">#9924</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Fix <code>TRUNCATE</code> for Join table engine (<a href="https://github.com/ClickHouse/ClickHouse/issues/9917" target="_blank" rel="noopener noreferrer">#9917</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9920" target="_blank" rel="noopener noreferrer">#9920</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Fix race condition between drop and optimize in <code>ReplicatedMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9901" target="_blank" rel="noopener noreferrer">#9901</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix <code>DISTINCT</code> for Distributed when <code>optimize_skip_unused_shards</code> is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/9808" target="_blank" rel="noopener noreferrer">#9808</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix &quot;scalar does not exist&quot; error in ALTERs (<a href="https://github.com/ClickHouse/ClickHouse/issues/9878" target="_blank" rel="noopener noreferrer">#9878</a>). ... <a href="https://github.com/ClickHouse/ClickHouse/pull/9904" target="_blank" rel="noopener noreferrer">#9904</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Fix error with qualified names in <code>distributed_product_mode=\&#x27;local\&#x27;</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4756" target="_blank" rel="noopener noreferrer">#4756</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9891" target="_blank" rel="noopener noreferrer">#9891</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>For INSERT queries shards now do clamp the settings from the initiator to their constraints instead of throwing an exception. This fix allows to send INSERT queries to a shard with another constraints. This change improves fix <a href="https://github.com/ClickHouse/ClickHouse/issues/9447" target="_blank" rel="noopener noreferrer">#9447</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9852" target="_blank" rel="noopener noreferrer">#9852</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Add some retries when commiting offsets to Kafka broker, since it can reject commit if during <code>offsets.commit.timeout.ms</code> there were no enough replicas available for the <code>__consumer_offsets</code> topic <a href="https://github.com/ClickHouse/ClickHouse/pull/9884" target="_blank" rel="noopener noreferrer">#9884</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Fix Distributed engine behavior when virtual columns of the underlying table used in <code>WHERE</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9847" target="_blank" rel="noopener noreferrer">#9847</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fixed some cases when timezone of the function argument wasn&#x27;t used properly. <a href="https://github.com/ClickHouse/ClickHouse/pull/9574" target="_blank" rel="noopener noreferrer">#9574</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li>Fix &#x27;Different expressions with the same alias&#x27; error when query has PREWHERE and WHERE on distributed table and <code>SET distributed_product_mode = &#x27;local&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9871" target="_blank" rel="noopener noreferrer">#9871</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix mutations excessive memory consumption for tables with a composite primary key. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9850" target="_blank" rel="noopener noreferrer">#9850</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9860" target="_blank" rel="noopener noreferrer">#9860</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix calculating grants for introspection functions from the setting <code>allow_introspection_functions</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9840" target="_blank" rel="noopener noreferrer">#9840</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Fix max_distributed_connections (w/ and w/o Processors) <a href="https://github.com/ClickHouse/ClickHouse/pull/9673" target="_blank" rel="noopener noreferrer">#9673</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix possible exception <code>Got 0 in totals chunk, expected 1</code> on client. It happened for queries with <code>JOIN</code> in case if right joined table had zero rows. Example: <code>select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9777" target="_blank" rel="noopener noreferrer">#9777</a>. ... <a href="https://github.com/ClickHouse/ClickHouse/pull/9823" target="_blank" rel="noopener noreferrer">#9823</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix &#x27;COMMA to CROSS JOIN rewriter is not enabled or cannot rewrite query&#x27; error in case of subqueries with COMMA JOIN out of tables lists (i.e. in WHERE). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9782" target="_blank" rel="noopener noreferrer">#9782</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9830" target="_blank" rel="noopener noreferrer">#9830</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix server crashing when <code>optimize_skip_unused_shards</code> is set and expression for key can&#x27;t be converted to its field type <a href="https://github.com/ClickHouse/ClickHouse/pull/9804" target="_blank" rel="noopener noreferrer">#9804</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix empty string handling in <code>splitByString</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9767" target="_blank" rel="noopener noreferrer">#9767</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Fix broken <code>ALTER TABLE DELETE COLUMN</code> query for compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/9779" target="_blank" rel="noopener noreferrer">#9779</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fixed missing <code>rows_before_limit_at_least</code> for queries over http (with processors pipeline). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9730" target="_blank" rel="noopener noreferrer">#9730</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9757" target="_blank" rel="noopener noreferrer">#9757</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix excessive memory consumption in <code>ALTER</code> queries (mutations). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9533" target="_blank" rel="noopener noreferrer">#9533</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/9670" target="_blank" rel="noopener noreferrer">#9670</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9754" target="_blank" rel="noopener noreferrer">#9754</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix possible permanent &quot;Cannot schedule a task&quot; error. <a href="https://github.com/ClickHouse/ClickHouse/pull/9154" target="_blank" rel="noopener noreferrer">#9154</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix bug in backquoting in external dictionaries DDL. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9619" target="_blank" rel="noopener noreferrer">#9619</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9734" target="_blank" rel="noopener noreferrer">#9734</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fixed data race in <code>text_log</code>. It does not correspond to any real bug. <a href="https://github.com/ClickHouse/ClickHouse/pull/9726" target="_blank" rel="noopener noreferrer">#9726</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix bug in a replication that does not allow replication to work if the user has executed mutations on the previous version. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9645" target="_blank" rel="noopener noreferrer">#9645</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9652" target="_blank" rel="noopener noreferrer">#9652</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fixed incorrect internal function names for <code>sumKahan</code> and <code>sumWithOverflow</code>. It led to exception while using this functions in remote queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9636" target="_blank" rel="noopener noreferrer">#9636</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Add setting <code>use_compact_format_in_distributed_parts_names</code> which allows to write files for <code>INSERT</code> queries into <code>Distributed</code> table with more compact format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9647" target="_blank" rel="noopener noreferrer">#9647</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9653" target="_blank" rel="noopener noreferrer">#9653</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix RIGHT and FULL JOIN with LowCardinality in JOIN keys. <a href="https://github.com/ClickHouse/ClickHouse/pull/9610" target="_blank" rel="noopener noreferrer">#9610</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix possible exceptions <code>Size of filter does not match size of column</code> and <code>Invalid number of rows in Chunk</code> in <code>MergeTreeRangeReader</code>. They could appear while executing <code>PREWHERE</code> in some cases. <a href="https://github.com/ClickHouse/ClickHouse/pull/9612" target="_blank" rel="noopener noreferrer">#9612</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Allow <code>ALTER ON CLUSTER</code> of Distributed tables with internal replication. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3268" target="_blank" rel="noopener noreferrer">#3268</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9617" target="_blank" rel="noopener noreferrer">#9617</a> (<a href="https://github.com/shinoi2" target="_blank" rel="noopener noreferrer">shinoi2</a>)</li><li>Fix issue when timezone was not preserved if you write a simple arithmetic expression like <code>time + 1</code> (in contrast to an expression like <code>time + INTERVAL 1 SECOND</code>). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5743" target="_blank" rel="noopener noreferrer">#5743</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9323" target="_blank" rel="noopener noreferrer">#9323</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-16">Improvement<a class="hash-link" href="#improvement-16" title="Direct link to heading">​</a></h4><ul><li>Use time zone when comparing DateTime with string literal. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5206" target="_blank" rel="noopener noreferrer">#5206</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10515" target="_blank" rel="noopener noreferrer">#10515</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Print verbose diagnostic info if Decimal value cannot be parsed from text input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/10205" target="_blank" rel="noopener noreferrer">#10205</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add tasks/memory metrics for distributed/buffer schedule pools <a href="https://github.com/ClickHouse/ClickHouse/pull/10449" target="_blank" rel="noopener noreferrer">#10449</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Display result as soon as it&#x27;s ready for SELECT DISTINCT queries in clickhouse-local and HTTP interface. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8951" target="_blank" rel="noopener noreferrer">#8951</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9559" target="_blank" rel="noopener noreferrer">#9559</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Allow to use <code>SAMPLE OFFSET</code> query instead of <code>cityHash64(PRIMARY KEY) % N == n</code> for splitting in <code>clickhouse-copier</code>. To use this feature, pass <code>--experimental-use-sample-offset 1</code> as a command line argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/10414" target="_blank" rel="noopener noreferrer">#10414</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Allow to parse BOM in TSV if the first column cannot contain BOM in its value. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10301" target="_blank" rel="noopener noreferrer">#10301</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10424" target="_blank" rel="noopener noreferrer">#10424</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add Avro nested fields insert support <a href="https://github.com/ClickHouse/ClickHouse/pull/10354" target="_blank" rel="noopener noreferrer">#10354</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>)</li><li>Allowed to alter column in non-modifying data mode when the same type is specified. <a href="https://github.com/ClickHouse/ClickHouse/pull/10382" target="_blank" rel="noopener noreferrer">#10382</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Auto <code>distributed_group_by_no_merge</code> on GROUP BY sharding key (if <code>optimize_skip_unused_shards</code> is set) <a href="https://github.com/ClickHouse/ClickHouse/pull/10341" target="_blank" rel="noopener noreferrer">#10341</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Optimize queries with LIMIT/LIMIT BY/ORDER BY for distributed with GROUP BY sharding_key <a href="https://github.com/ClickHouse/ClickHouse/pull/10373" target="_blank" rel="noopener noreferrer">#10373</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Added a setting <code>max_server_memory_usage</code> to limit total memory usage of the server. The metric <code>MemoryTracking</code> is now calculated without a drift. The setting <code>max_memory_usage_for_all_queries</code> is now obsolete and does nothing. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/10293" target="_blank" rel="noopener noreferrer">#10293</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10362" target="_blank" rel="noopener noreferrer">#10362</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add config option <code>system_tables_lazy_load</code>. If it&#x27;s set to false, then system tables with logs are loaded at the server startup. <a href="https://github.com/Alex-Burmak" target="_blank" rel="noopener noreferrer">Alexander Burmak</a>, <a href="https://github.com/DeifyTheGod" target="_blank" rel="noopener noreferrer">Svyatoslav Tkhon Il Pak</a>, <a href="https://github.com/ClickHouse/ClickHouse/pull/9642" target="_blank" rel="noopener noreferrer">#9642</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10359" target="_blank" rel="noopener noreferrer">#10359</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Use background thread pool (background_schedule_pool_size) for distributed sends <a href="https://github.com/ClickHouse/ClickHouse/pull/10263" target="_blank" rel="noopener noreferrer">#10263</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Use background thread pool for background buffer flushes. <a href="https://github.com/ClickHouse/ClickHouse/pull/10315" target="_blank" rel="noopener noreferrer">#10315</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Support for one special case of removing incompletely written parts. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9940" target="_blank" rel="noopener noreferrer">#9940</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10221" target="_blank" rel="noopener noreferrer">#10221</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Use isInjective() over manual list of such functions for GROUP BY optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/10342" target="_blank" rel="noopener noreferrer">#10342</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Avoid printing error message in log if client sends RST packet immediately on connect. It is typical behaviour of IPVS balancer with keepalived and VRRP. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/1851" target="_blank" rel="noopener noreferrer">#1851</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10274" target="_blank" rel="noopener noreferrer">#10274</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Allow to parse <code>+inf</code> for floating point types. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/1839" target="_blank" rel="noopener noreferrer">#1839</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10272" target="_blank" rel="noopener noreferrer">#10272</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Implemented <code>generateRandom</code> table function for Nested types. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9903" target="_blank" rel="noopener noreferrer">#9903</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10219" target="_blank" rel="noopener noreferrer">#10219</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Provide <code>max_allowed_packed</code> in MySQL compatibility interface that will help some clients to communicate with ClickHouse via MySQL protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/10199" target="_blank" rel="noopener noreferrer">#10199</a> (<a href="https://github.com/BohuTANG" target="_blank" rel="noopener noreferrer">BohuTANG</a>)</li><li>Allow literals for GLOBAL IN (i.e. <code>SELECT * FROM remote(&#x27;localhost&#x27;, system.one) WHERE dummy global in (0)</code>) <a href="https://github.com/ClickHouse/ClickHouse/pull/10196" target="_blank" rel="noopener noreferrer">#10196</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix various small issues in interactive mode of clickhouse-client <a href="https://github.com/ClickHouse/ClickHouse/pull/10194" target="_blank" rel="noopener noreferrer">#10194</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Avoid superfluous dictionaries load (system.tables, DROP/SHOW CREATE TABLE) <a href="https://github.com/ClickHouse/ClickHouse/pull/10164" target="_blank" rel="noopener noreferrer">#10164</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Update to RWLock: timeout parameter for getLock() + implementation reworked to be phase fair <a href="https://github.com/ClickHouse/ClickHouse/pull/10073" target="_blank" rel="noopener noreferrer">#10073</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Enhanced compatibility with native mysql-connector-java(JDBC) <a href="https://github.com/ClickHouse/ClickHouse/pull/10021" target="_blank" rel="noopener noreferrer">#10021</a> (<a href="https://github.com/BohuTANG" target="_blank" rel="noopener noreferrer">BohuTANG</a>)</li><li>The function <code>toString</code> is considered monotonic and can be used for index analysis even when applied in tautological cases with String or LowCardinality(String) argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/10110" target="_blank" rel="noopener noreferrer">#10110</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Add <code>ON CLUSTER</code> clause support to commands <code>{CREATE|DROP} USER/ROLE/ROW POLICY/SETTINGS PROFILE/QUOTA</code>, <code>GRANT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9811" target="_blank" rel="noopener noreferrer">#9811</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Virtual hosted-style support for S3 URI <a href="https://github.com/ClickHouse/ClickHouse/pull/9998" target="_blank" rel="noopener noreferrer">#9998</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>)</li><li>Now layout type for dictionaries with no arguments can be specified without round brackets in dictionaries DDL-queries. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10057" target="_blank" rel="noopener noreferrer">#10057</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10064" target="_blank" rel="noopener noreferrer">#10064</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Add ability to use number ranges with leading zeros in filepath <a href="https://github.com/ClickHouse/ClickHouse/pull/9989" target="_blank" rel="noopener noreferrer">#9989</a> (<a href="https://github.com/stavrolia" target="_blank" rel="noopener noreferrer">Olga Khvostikova</a>)</li><li>Better memory usage in CROSS JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/10029" target="_blank" rel="noopener noreferrer">#10029</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Try to connect to all shards in cluster when getting structure of remote table and skip_unavailable_shards is set. <a href="https://github.com/ClickHouse/ClickHouse/pull/7278" target="_blank" rel="noopener noreferrer">#7278</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>)</li><li>Add <code>total_rows</code>/<code>total_bytes</code> into the <code>system.tables</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/9919" target="_blank" rel="noopener noreferrer">#9919</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>System log tables now use polymorpic parts by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/9905" target="_blank" rel="noopener noreferrer">#9905</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Add type column into system.settings/merge_tree_settings <a href="https://github.com/ClickHouse/ClickHouse/pull/9909" target="_blank" rel="noopener noreferrer">#9909</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Check for available CPU instructions at server startup as early as possible. <a href="https://github.com/ClickHouse/ClickHouse/pull/9888" target="_blank" rel="noopener noreferrer">#9888</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Remove <code>ORDER BY</code> stage from mutations because we read from a single ordered part in a single thread. Also add check that the rows in mutation are ordered by sorting key and this order is not violated. <a href="https://github.com/ClickHouse/ClickHouse/pull/9886" target="_blank" rel="noopener noreferrer">#9886</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Implement operator LIKE for FixedString at left hand side. This is needed to better support TPC-DS queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9890" target="_blank" rel="noopener noreferrer">#9890</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add <code>force_optimize_skip_unused_shards_no_nested</code> that will disable <code>force_optimize_skip_unused_shards</code> for nested Distributed table <a href="https://github.com/ClickHouse/ClickHouse/pull/9812" target="_blank" rel="noopener noreferrer">#9812</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Now columns size is calculated only once for MergeTree data parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/9827" target="_blank" rel="noopener noreferrer">#9827</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Evaluate constant expressions for <code>optimize_skip_unused_shards</code> (i.e. <code>SELECT * FROM foo_dist WHERE key=xxHash32(0)</code>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8846" target="_blank" rel="noopener noreferrer">#8846</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Check for using <code>Date</code> or <code>DateTime</code> column from TTL expressions was removed. <a href="https://github.com/ClickHouse/ClickHouse/pull/9967" target="_blank" rel="noopener noreferrer">#9967</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>DiskS3 hard links optimal implementation. <a href="https://github.com/ClickHouse/ClickHouse/pull/9760" target="_blank" rel="noopener noreferrer">#9760</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>)</li><li>If <code>set multiple_joins_rewriter_version = 2</code> enables second version of multiple JOIN rewrites that keeps not clashed column names as is. It supports multiple JOINs with <code>USING</code> and allow <code>select *</code> for JOINs with subqueries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9739" target="_blank" rel="noopener noreferrer">#9739</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Implementation of &quot;non-blocking&quot; alter for StorageMergeTree <a href="https://github.com/ClickHouse/ClickHouse/pull/9606" target="_blank" rel="noopener noreferrer">#9606</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Add MergeTree full support for DiskS3 <a href="https://github.com/ClickHouse/ClickHouse/pull/9646" target="_blank" rel="noopener noreferrer">#9646</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>)</li><li>Extend <code>splitByString</code> to support empty strings as separators. <a href="https://github.com/ClickHouse/ClickHouse/pull/9742" target="_blank" rel="noopener noreferrer">#9742</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Add a <code>timestamp_ns</code> column to <code>system.trace_log</code>. It contains a high-definition timestamp of the trace event, and allows to build timelines of thread profiles (&quot;flame charts&quot;). <a href="https://github.com/ClickHouse/ClickHouse/pull/9696" target="_blank" rel="noopener noreferrer">#9696</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>When the setting <code>send_logs_level</code> is enabled, avoid intermixing of log messages and query progress. <a href="https://github.com/ClickHouse/ClickHouse/pull/9634" target="_blank" rel="noopener noreferrer">#9634</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Added support of <code>MATERIALIZE TTL IN PARTITION</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9581" target="_blank" rel="noopener noreferrer">#9581</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Support complex types inside Avro nested fields <a href="https://github.com/ClickHouse/ClickHouse/pull/10502" target="_blank" rel="noopener noreferrer">#10502</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-11">Performance Improvement<a class="hash-link" href="#performance-improvement-11" title="Direct link to heading">​</a></h4><ul><li>Better insert logic for right table for Partial MergeJoin. <a href="https://github.com/ClickHouse/ClickHouse/pull/10467" target="_blank" rel="noopener noreferrer">#10467</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Improved performance of row-oriented formats (more than 10% for CSV and more than 35% for Avro in case of narrow tables). <a href="https://github.com/ClickHouse/ClickHouse/pull/10503" target="_blank" rel="noopener noreferrer">#10503</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>)</li><li>Improved performance of queries with explicitly defined sets at right side of IN operator and tuples on the left side. <a href="https://github.com/ClickHouse/ClickHouse/pull/10385" target="_blank" rel="noopener noreferrer">#10385</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Use less memory for hash table in HashJoin. <a href="https://github.com/ClickHouse/ClickHouse/pull/10416" target="_blank" rel="noopener noreferrer">#10416</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Special HashJoin over StorageDictionary. Allow rewrite <code>dictGet()</code> functions with JOINs. It&#x27;s not backward incompatible itself but could uncover <a href="https://github.com/ClickHouse/ClickHouse/issues/8400" target="_blank" rel="noopener noreferrer">#8400</a> on some installations. <a href="https://github.com/ClickHouse/ClickHouse/pull/10133" target="_blank" rel="noopener noreferrer">#10133</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Enable parallel insert of materialized view when its target table supports. <a href="https://github.com/ClickHouse/ClickHouse/pull/10052" target="_blank" rel="noopener noreferrer">#10052</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>)</li><li>Improved performance of index analysis with monotonic functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9607" target="_blank" rel="noopener noreferrer">#9607</a><a href="https://github.com/ClickHouse/ClickHouse/pull/10026" target="_blank" rel="noopener noreferrer">#10026</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Using SSE2 or SSE4.2 SIMD intrinsics to speed up tokenization in bloom filters. <a href="https://github.com/ClickHouse/ClickHouse/pull/9968" target="_blank" rel="noopener noreferrer">#9968</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li>Improved performance of queries with explicitly defined sets at right side of <code>IN</code> operator. This fixes performance regression in version 20.3. <a href="https://github.com/ClickHouse/ClickHouse/pull/9740" target="_blank" rel="noopener noreferrer">#9740</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Now clickhouse-copier splits each partition in number of pieces and copies them independently. <a href="https://github.com/ClickHouse/ClickHouse/pull/9075" target="_blank" rel="noopener noreferrer">#9075</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Adding more aggregation methods. For example TPC-H query 1 will now pick <code>FixedHashMap&lt;UInt16, AggregateDataPtr&gt;</code> and gets 25% performance gain <a href="https://github.com/ClickHouse/ClickHouse/pull/9829" target="_blank" rel="noopener noreferrer">#9829</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Use single row counter for multiple streams in pre-limit transform. This helps to avoid uniting pipeline streams in queries with <code>limit</code> but without <code>order by</code> (like <code>select f(x) from (select x from t limit 1000000000)</code>) and use multiple threads for further processing. <a href="https://github.com/ClickHouse/ClickHouse/pull/9602" target="_blank" rel="noopener noreferrer">#9602</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-15">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-15" title="Direct link to heading">​</a></h4><ul><li>Use a fork of AWS SDK libraries from ClickHouse-Extras <a href="https://github.com/ClickHouse/ClickHouse/pull/10527" target="_blank" rel="noopener noreferrer">#10527</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>)</li><li>Add integration tests for new ALTER RENAME COLUMN query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10654" target="_blank" rel="noopener noreferrer">#10654</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>)</li><li>Fix possible signed integer overflow in invocation of function <code>now64</code> with wrong arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8973" target="_blank" rel="noopener noreferrer">#8973</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10511" target="_blank" rel="noopener noreferrer">#10511</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Split fuzzer and sanitizer configurations to make build config compatible with Oss-fuzz. <a href="https://github.com/ClickHouse/ClickHouse/pull/10494" target="_blank" rel="noopener noreferrer">#10494</a> (<a href="https://github.com/kyprizel" target="_blank" rel="noopener noreferrer">kyprizel</a>)</li><li>Fixes for clang-tidy on clang-10. <a href="https://github.com/ClickHouse/ClickHouse/pull/10420" target="_blank" rel="noopener noreferrer">#10420</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Display absolute paths in error messages. Otherwise KDevelop fails to navigate to correct file and opens a new file instead. <a href="https://github.com/ClickHouse/ClickHouse/pull/10434" target="_blank" rel="noopener noreferrer">#10434</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added <code>ASAN_OPTIONS</code> environment variable to investigate errors in CI stress tests with Address sanitizer. <a href="https://github.com/ClickHouse/ClickHouse/pull/10440" target="_blank" rel="noopener noreferrer">#10440</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Enable ThinLTO for clang builds (experimental). <a href="https://github.com/ClickHouse/ClickHouse/pull/10435" target="_blank" rel="noopener noreferrer">#10435</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Remove accidential dependency on Z3 that may be introduced if the system has Z3 solver installed. <a href="https://github.com/ClickHouse/ClickHouse/pull/10426" target="_blank" rel="noopener noreferrer">#10426</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Move integration tests docker files to docker/ directory. <a href="https://github.com/ClickHouse/ClickHouse/pull/10335" target="_blank" rel="noopener noreferrer">#10335</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>)</li><li>Allow to use <code>clang-10</code> in CI. It ensures that <a href="https://github.com/ClickHouse/ClickHouse/issues/10238" target="_blank" rel="noopener noreferrer">#10238</a> is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/10384" target="_blank" rel="noopener noreferrer">#10384</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Update OpenSSL to upstream master. Fixed the issue when TLS connections may fail with the message <code>OpenSSL SSL_read: error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error</code> and <code>SSL Exception: error:2400006E:random number generator::error retrieving entropy</code>. The issue was present in version 20.1. <a href="https://github.com/ClickHouse/ClickHouse/pull/8956" target="_blank" rel="noopener noreferrer">#8956</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix clang-10 build. <a href="https://github.com/ClickHouse/ClickHouse/issues/10238" target="_blank" rel="noopener noreferrer">#10238</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10370" target="_blank" rel="noopener noreferrer">#10370</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Add performance test for <a href="https://github.com/ClickHouse/ClickHouse/pull/10052" target="_blank" rel="noopener noreferrer">Parallel INSERT for materialized view</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10345" target="_blank" rel="noopener noreferrer">#10345</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>)</li><li>Fix flaky test <code>test_settings_constraints_distributed.test_insert_clamps_settings</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10346" target="_blank" rel="noopener noreferrer">#10346</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Add util to test results upload in CI ClickHouse <a href="https://github.com/ClickHouse/ClickHouse/pull/10330" target="_blank" rel="noopener noreferrer">#10330</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>)</li><li>Convert test results to JSONEachRow format in junit_to_html tool <a href="https://github.com/ClickHouse/ClickHouse/pull/10323" target="_blank" rel="noopener noreferrer">#10323</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>)</li><li>Update cctz. <a href="https://github.com/ClickHouse/ClickHouse/pull/10215" target="_blank" rel="noopener noreferrer">#10215</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Allow to create HTML report from the purest JUnit XML report. <a href="https://github.com/ClickHouse/ClickHouse/pull/10247" target="_blank" rel="noopener noreferrer">#10247</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>)</li><li>Update the check for minimal compiler version. Fix the root cause of the issue <a href="https://github.com/ClickHouse/ClickHouse/issues/10250" target="_blank" rel="noopener noreferrer">#10250</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10256" target="_blank" rel="noopener noreferrer">#10256</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Initial support for live view tables over distributed <a href="https://github.com/ClickHouse/ClickHouse/pull/10179" target="_blank" rel="noopener noreferrer">#10179</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>)</li><li>Fix (false) MSan report in MergeTreeIndexFullText. The issue first appeared in <a href="https://github.com/ClickHouse/ClickHouse/issues/9968" target="_blank" rel="noopener noreferrer">#9968</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10801" target="_blank" rel="noopener noreferrer">#10801</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>clickhouse-docker-util <a href="https://github.com/ClickHouse/ClickHouse/pull/10151" target="_blank" rel="noopener noreferrer">#10151</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Update pdqsort to recent version <a href="https://github.com/ClickHouse/ClickHouse/pull/10171" target="_blank" rel="noopener noreferrer">#10171</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Update libdivide to v3.0 <a href="https://github.com/ClickHouse/ClickHouse/pull/10169" target="_blank" rel="noopener noreferrer">#10169</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Add check with enabled polymorphic parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10086" target="_blank" rel="noopener noreferrer">#10086</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Add cross-compile build for FreeBSD. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9465" target="_blank" rel="noopener noreferrer">#9465</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9643" target="_blank" rel="noopener noreferrer">#9643</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Add performance test for <a href="https://github.com/ClickHouse/ClickHouse/issues/6924" target="_blank" rel="noopener noreferrer">#6924</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/6980" target="_blank" rel="noopener noreferrer">#6980</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Add support of <code>/dev/null</code> in the <code>File</code> engine for better performance testing <a href="https://github.com/ClickHouse/ClickHouse/pull/8455" target="_blank" rel="noopener noreferrer">#8455</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Move all folders inside /dbms one level up <a href="https://github.com/ClickHouse/ClickHouse/pull/9974" target="_blank" rel="noopener noreferrer">#9974</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Add a test that checks that read from MergeTree with single thread is performed in order. Addition to <a href="https://github.com/ClickHouse/ClickHouse/issues/9670" target="_blank" rel="noopener noreferrer">#9670</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9762" target="_blank" rel="noopener noreferrer">#9762</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix the <code>00964_live_view_watch_events_heartbeat.py</code> test to avoid race condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/9944" target="_blank" rel="noopener noreferrer">#9944</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>)</li><li>Fix integration test <code>test_settings_constraints</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9962" target="_blank" rel="noopener noreferrer">#9962</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Every function in its own file, part 12. <a href="https://github.com/ClickHouse/ClickHouse/pull/9922" target="_blank" rel="noopener noreferrer">#9922</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added performance test for the case of extremely slow analysis of array of tuples. <a href="https://github.com/ClickHouse/ClickHouse/pull/9872" target="_blank" rel="noopener noreferrer">#9872</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Update zstd to 1.4.4. It has some minor improvements in performance and compression ratio. If you run replicas with different versions of ClickHouse you may see reasonable error messages <code>Data after merge is not byte-identical to data on another replicas.</code> with explanation. These messages are Ok and you should not worry. <a href="https://github.com/ClickHouse/ClickHouse/pull/10663" target="_blank" rel="noopener noreferrer">#10663</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix TSan report in <code>system.stack_trace</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9832" target="_blank" rel="noopener noreferrer">#9832</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Removed dependency on <code>clock_getres</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9833" target="_blank" rel="noopener noreferrer">#9833</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added identifier names check with clang-tidy. <a href="https://github.com/ClickHouse/ClickHouse/pull/9799" target="_blank" rel="noopener noreferrer">#9799</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Update &quot;builder&quot; docker image. This image is not used in CI but is useful for developers. <a href="https://github.com/ClickHouse/ClickHouse/pull/9809" target="_blank" rel="noopener noreferrer">#9809</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Remove old <code>performance-test</code> tool that is no longer used in CI. <code>clickhouse-performance-test</code> is great but now we are using way superior tool that is doing comparison testing with sophisticated statistical formulas to achieve confident results regardless to various changes in environment. <a href="https://github.com/ClickHouse/ClickHouse/pull/9796" target="_blank" rel="noopener noreferrer">#9796</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added most of clang-static-analyzer checks. <a href="https://github.com/ClickHouse/ClickHouse/pull/9765" target="_blank" rel="noopener noreferrer">#9765</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Update Poco to 1.9.3 in preparation for MongoDB URI support. <a href="https://github.com/ClickHouse/ClickHouse/pull/6892" target="_blank" rel="noopener noreferrer">#6892</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Fix build with <code>-DUSE_STATIC_LIBRARIES=0 -DENABLE_JEMALLOC=0</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9651" target="_blank" rel="noopener noreferrer">#9651</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>For change log script, if merge commit was cherry-picked to release branch, take PR name from commit description. <a href="https://github.com/ClickHouse/ClickHouse/pull/9708" target="_blank" rel="noopener noreferrer">#9708</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Support <code>vX.X-conflicts</code> tag in backport script. <a href="https://github.com/ClickHouse/ClickHouse/pull/9705" target="_blank" rel="noopener noreferrer">#9705</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix <code>auto-label</code> for backporting script. <a href="https://github.com/ClickHouse/ClickHouse/pull/9685" target="_blank" rel="noopener noreferrer">#9685</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Use libc++ in Darwin cross-build to make it consistent with native build. <a href="https://github.com/ClickHouse/ClickHouse/pull/9665" target="_blank" rel="noopener noreferrer">#9665</a> (<a href="https://github.com/huiwang" target="_blank" rel="noopener noreferrer">Hui Wang</a>)</li><li>Fix flacky test <code>01017_uniqCombined_memory_usage</code>. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/7236" target="_blank" rel="noopener noreferrer">#7236</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9667" target="_blank" rel="noopener noreferrer">#9667</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix build for native MacOS Clang compiler <a href="https://github.com/ClickHouse/ClickHouse/pull/9649" target="_blank" rel="noopener noreferrer">#9649</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Allow to add various glitches around <code>pthread_mutex_lock</code>, <code>pthread_mutex_unlock</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9635" target="_blank" rel="noopener noreferrer">#9635</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add support for <code>clang-tidy</code> in <code>packager</code> script. <a href="https://github.com/ClickHouse/ClickHouse/pull/9625" target="_blank" rel="noopener noreferrer">#9625</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add ability to use unbundled msgpack. <a href="https://github.com/ClickHouse/ClickHouse/pull/10168" target="_blank" rel="noopener noreferrer">#10168</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v203">ClickHouse release v20.3<a class="hash-link" href="#clickhouse-release-v203" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v203212-lts-2020-11-02">ClickHouse release v20.3.21.2-lts, 2020-11-02<a class="hash-link" href="#clickhouse-release-v203212-lts-2020-11-02" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-33">Bug Fix<a class="hash-link" href="#bug-fix-33" title="Direct link to heading">​</a></h4><ul><li>Fix dictGet in sharding_key (and similar places, i.e. when the function context is stored permanently). <a href="https://github.com/ClickHouse/ClickHouse/pull/16205" target="_blank" rel="noopener noreferrer">#16205</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix incorrect empty result for query from <code>Distributed</code> table if query has <code>WHERE</code>, <code>PREWHERE</code> and <code>GLOBAL IN</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/15792" target="_blank" rel="noopener noreferrer">#15792</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/15933" target="_blank" rel="noopener noreferrer">#15933</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix missing or excessive headers in <code>TSV/CSVWithNames</code> formats. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12504" target="_blank" rel="noopener noreferrer">#12504</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13343" target="_blank" rel="noopener noreferrer">#13343</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v203206-lts-2020-10-09">ClickHouse release v20.3.20.6-lts, 2020-10-09<a class="hash-link" href="#clickhouse-release-v203206-lts-2020-10-09" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-34">Bug Fix<a class="hash-link" href="#bug-fix-34" title="Direct link to heading">​</a></h4><ul><li>Mutation might hang waiting for some non-existent part after <code>MOVE</code> or <code>REPLACE PARTITION</code> or, in rare cases, after <code>DETACH</code> or <code>DROP PARTITION</code>. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/15724" target="_blank" rel="noopener noreferrer">#15724</a>, <a href="https://github.com/ClickHouse/ClickHouse/pull/15537" target="_blank" rel="noopener noreferrer">#15537</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix hang of queries with a lot of subqueries to same table of <code>MySQL</code> engine. Previously, if there were more than 16 subqueries to same <code>MySQL</code> table in query, it hang forever. <a href="https://github.com/ClickHouse/ClickHouse/pull/15299" target="_blank" rel="noopener noreferrer">#15299</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix &#x27;Unknown identifier&#x27; in GROUP BY when query has JOIN over Merge table. <a href="https://github.com/ClickHouse/ClickHouse/pull/15242" target="_blank" rel="noopener noreferrer">#15242</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix to make predicate push down work when subquery contains finalizeAggregation function. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14847" target="_blank" rel="noopener noreferrer">#14847</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14937" target="_blank" rel="noopener noreferrer">#14937</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Concurrent <code>ALTER ... REPLACE/MOVE PARTITION ...</code> queries might cause deadlock. It&#x27;s fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/13626" target="_blank" rel="noopener noreferrer">#13626</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v203194-lts-2020-09-18">ClickHouse release v20.3.19.4-lts, 2020-09-18<a class="hash-link" href="#clickhouse-release-v203194-lts-2020-09-18" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-35">Bug Fix<a class="hash-link" href="#bug-fix-35" title="Direct link to heading">​</a></h4><ul><li>Fix rare error in <code>SELECT</code> queries when the queried column has <code>DEFAULT</code> expression which depends on the other column which also has <code>DEFAULT</code> and not present in select query and not exists on disk. Partially fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/14531" target="_blank" rel="noopener noreferrer">#14531</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14845" target="_blank" rel="noopener noreferrer">#14845</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug when <code>ALTER UPDATE</code> mutation with Nullable column in assignment expression and constant value (like <code>UPDATE x = 42</code>) leads to incorrect value in column or segfault. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13634" target="_blank" rel="noopener noreferrer">#13634</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/14045" target="_blank" rel="noopener noreferrer">#14045</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14646" target="_blank" rel="noopener noreferrer">#14646</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix wrong Decimal multiplication result caused wrong decimal scale of result column. <a href="https://github.com/ClickHouse/ClickHouse/pull/14603" target="_blank" rel="noopener noreferrer">#14603</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-17">Improvement<a class="hash-link" href="#improvement-17" title="Direct link to heading">​</a></h4><ul><li>Support custom codecs in compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12183" target="_blank" rel="noopener noreferrer">#12183</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2031810-lts-2020-09-08">ClickHouse release v20.3.18.10-lts, 2020-09-08<a class="hash-link" href="#clickhouse-release-v2031810-lts-2020-09-08" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-36">Bug Fix<a class="hash-link" href="#bug-fix-36" title="Direct link to heading">​</a></h4><ul><li>Stop query execution if exception happened in <code>PipelineExecutor</code> itself. This could prevent rare possible query hung. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/14334" target="_blank" rel="noopener noreferrer">#14334</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/14402" target="_blank" rel="noopener noreferrer">#14402</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed the behaviour when sometimes cache-dictionary returned default value instead of present value from source. <a href="https://github.com/ClickHouse/ClickHouse/pull/13624" target="_blank" rel="noopener noreferrer">#13624</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix parsing row policies from users.xml when names of databases or tables contain dots. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5779" target="_blank" rel="noopener noreferrer">#5779</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12527" target="_blank" rel="noopener noreferrer">#12527</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13199" target="_blank" rel="noopener noreferrer">#13199</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix CAST(Nullable(String), Enum()). <a href="https://github.com/ClickHouse/ClickHouse/pull/12745" target="_blank" rel="noopener noreferrer">#12745</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed data race in <code>text_log</code>. It does not correspond to any real bug. <a href="https://github.com/ClickHouse/ClickHouse/pull/9726" target="_blank" rel="noopener noreferrer">#9726</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-18">Improvement<a class="hash-link" href="#improvement-18" title="Direct link to heading">​</a></h4><ul><li>Fix wrong error for long queries. It was possible to get syntax error other than <code>Max query size exceeded</code> for correct query. <a href="https://github.com/ClickHouse/ClickHouse/pull/13928" target="_blank" rel="noopener noreferrer">#13928</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Return NULL/zero when value is not parsed completely in parseDateTimeBestEffortOrNull/Zero functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7876" target="_blank" rel="noopener noreferrer">#7876</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11653" target="_blank" rel="noopener noreferrer">#11653</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-12">Performance Improvement<a class="hash-link" href="#performance-improvement-12" title="Direct link to heading">​</a></h4><ul><li>Slightly optimize very short queries with LowCardinality. <a href="https://github.com/ClickHouse/ClickHouse/pull/14129" target="_blank" rel="noopener noreferrer">#14129</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-16">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-16" title="Direct link to heading">​</a></h4><ul><li>Fix UBSan report (adding zero to nullptr) in HashTable that appeared after migration to clang-10. <a href="https://github.com/ClickHouse/ClickHouse/pull/10638" target="_blank" rel="noopener noreferrer">#10638</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20317173-lts-2020-08-15">ClickHouse release v20.3.17.173-lts, 2020-08-15<a class="hash-link" href="#clickhouse-release-v20317173-lts-2020-08-15" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-37">Bug Fix<a class="hash-link" href="#bug-fix-37" title="Direct link to heading">​</a></h4><ul><li>Fix crash in JOIN with StorageMerge and <code>set enable_optimize_predicate_expression=1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13679" target="_blank" rel="noopener noreferrer">#13679</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix invalid return type for comparison of tuples with <code>NULL</code> elements. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12461" target="_blank" rel="noopener noreferrer">#12461</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13420" target="_blank" rel="noopener noreferrer">#13420</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix queries with constant columns and <code>ORDER BY</code> prefix of primary key. <a href="https://github.com/ClickHouse/ClickHouse/pull/13396" target="_blank" rel="noopener noreferrer">#13396</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Return passed number for numbers with MSB set in roundUpToPowerOfTwoOrZero(). <a href="https://github.com/ClickHouse/ClickHouse/pull/13234" target="_blank" rel="noopener noreferrer">#13234</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20316165-lts-2020-08-10">ClickHouse release v20.3.16.165-lts 2020-08-10<a class="hash-link" href="#clickhouse-release-v20316165-lts-2020-08-10" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-38">Bug Fix<a class="hash-link" href="#bug-fix-38" title="Direct link to heading">​</a></h4><ul><li>Fixed error in <code>parseDateTimeBestEffort</code> function when unix timestamp was passed as an argument. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/13362" target="_blank" rel="noopener noreferrer">#13362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13441" target="_blank" rel="noopener noreferrer">#13441</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potentially low performance and slightly incorrect result for <code>uniqExact</code>, <code>topK</code>, <code>sumDistinct</code> and similar aggregate functions called on Float types with <code>NaN</code> values. It also triggered assert in debug build. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12491" target="_blank" rel="noopener noreferrer">#12491</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13254" target="_blank" rel="noopener noreferrer">#13254</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed function if with nullable constexpr as cond that is not literal NULL. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12463" target="_blank" rel="noopener noreferrer">#12463</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13226" target="_blank" rel="noopener noreferrer">#13226</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed assert in <code>arrayElement</code> function in case of array elements are Nullable and array subscript is also Nullable. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12172" target="_blank" rel="noopener noreferrer">#12172</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/13224" target="_blank" rel="noopener noreferrer">#13224</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed unnecessary limiting for the number of threads for selects from local replica. <a href="https://github.com/ClickHouse/ClickHouse/pull/12840" target="_blank" rel="noopener noreferrer">#12840</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed possible extra overflow row in data which could appear for queries <code>WITH TOTALS</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12747" target="_blank" rel="noopener noreferrer">#12747</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed performance with large tuples, which are interpreted as functions in <code>IN</code> section. The case when user write <code>WHERE x IN tuple(1, 2, ...)</code> instead of <code>WHERE x IN (1, 2, ...)</code> for some obscure reason. <a href="https://github.com/ClickHouse/ClickHouse/pull/12700" target="_blank" rel="noopener noreferrer">#12700</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed memory tracking for input_format_parallel_parsing (by attaching thread to group). <a href="https://github.com/ClickHouse/ClickHouse/pull/12672" target="_blank" rel="noopener noreferrer">#12672</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/12293" target="_blank" rel="noopener noreferrer">#12293</a> allow push predicate when subquery contains with clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/12663" target="_blank" rel="noopener noreferrer">#12663</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/10572" target="_blank" rel="noopener noreferrer">#10572</a> fix bloom filter index with const expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/12659" target="_blank" rel="noopener noreferrer">#12659</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed SIGSEGV in StorageKafka when broker is unavailable (and not only). <a href="https://github.com/ClickHouse/ClickHouse/pull/12658" target="_blank" rel="noopener noreferrer">#12658</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed race condition in external dictionaries with cache layout which can lead server crash. <a href="https://github.com/ClickHouse/ClickHouse/pull/12566" target="_blank" rel="noopener noreferrer">#12566</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed bug which lead to broken old parts after <code>ALTER DELETE</code> query when <code>enable_mixed_granularity_parts=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12536" target="_blank" rel="noopener noreferrer">#12536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12543" target="_blank" rel="noopener noreferrer">#12543</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Better exception for function <code>in</code> with invalid number of arguments. <a href="https://github.com/ClickHouse/ClickHouse/pull/12529" target="_blank" rel="noopener noreferrer">#12529</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed performance issue, while reading from compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/12492" target="_blank" rel="noopener noreferrer">#12492</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed the deadlock if <code>text_log</code> is enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/12452" target="_blank" rel="noopener noreferrer">#12452</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed possible segfault if StorageMerge. Closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12054" target="_blank" rel="noopener noreferrer">#12054</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12401" target="_blank" rel="noopener noreferrer">#12401</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed <code>TOTALS/ROLLUP/CUBE</code> for aggregate functions with <code>-State</code> and <code>Nullable</code> arguments. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12163" target="_blank" rel="noopener noreferrer">#12163</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12376" target="_blank" rel="noopener noreferrer">#12376</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed order of columns in <code>WITH FILL</code> modifier. Previously order of columns of <code>ORDER BY</code> statement wasn&#x27;t respected. <a href="https://github.com/ClickHouse/ClickHouse/pull/12306" target="_blank" rel="noopener noreferrer">#12306</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Avoid &quot;bad cast&quot; exception when there is an expression that filters data by virtual columns (like <code>_table</code> in <code>Merge</code> tables) or by &quot;index&quot; columns in system tables such as filtering by database name when querying from <code>system.tables</code>, and this expression returns <code>Nullable</code> type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12166" target="_blank" rel="noopener noreferrer">#12166</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12305" target="_blank" rel="noopener noreferrer">#12305</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Show error after <code>TrieDictionary</code> failed to load. <a href="https://github.com/ClickHouse/ClickHouse/pull/12290" target="_blank" rel="noopener noreferrer">#12290</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>The function <code>arrayFill</code> worked incorrectly for empty arrays that may lead to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12263" target="_blank" rel="noopener noreferrer">#12263</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12279" target="_blank" rel="noopener noreferrer">#12279</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Implement conversions to the common type for <code>LowCardinality</code> types. This allows to execute UNION ALL of tables with columns of LowCardinality and other columns. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8212" target="_blank" rel="noopener noreferrer">#8212</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4342" target="_blank" rel="noopener noreferrer">#4342</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12275" target="_blank" rel="noopener noreferrer">#12275</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed the behaviour when during multiple sequential inserts in <code>StorageFile</code> header for some special types was written more than once. This fixed <a href="https://github.com/ClickHouse/ClickHouse/issues/6155" target="_blank" rel="noopener noreferrer">#6155</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12197" target="_blank" rel="noopener noreferrer">#12197</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed logical functions for UInt8 values when they are not equal to 0 or 1. <a href="https://github.com/ClickHouse/ClickHouse/pull/12196" target="_blank" rel="noopener noreferrer">#12196</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Fixed <code>dictGet</code> arguments check during GROUP BY injective functions elimination. <a href="https://github.com/ClickHouse/ClickHouse/pull/12179" target="_blank" rel="noopener noreferrer">#12179</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed wrong logic in <code>ALTER DELETE</code> that leads to deleting of records when condition evaluates to NULL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9088" target="_blank" rel="noopener noreferrer">#9088</a>. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/12106" target="_blank" rel="noopener noreferrer">#12106</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12153" target="_blank" rel="noopener noreferrer">#12153</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed transform of query to send to external DBMS (e.g. MySQL, ODBC) in presense of aliases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12032" target="_blank" rel="noopener noreferrer">#12032</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12151" target="_blank" rel="noopener noreferrer">#12151</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potential overflow in integer division. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12119" target="_blank" rel="noopener noreferrer">#12119</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12140" target="_blank" rel="noopener noreferrer">#12140</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potential infinite loop in <code>greatCircleDistance</code>, <code>geoDistance</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12117" target="_blank" rel="noopener noreferrer">#12117</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12137" target="_blank" rel="noopener noreferrer">#12137</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Avoid <code>There is no query</code> exception for materialized views with joins or with subqueries attached to system logs (system.query_log, metric_log, etc) or to engine=Buffer underlying table. <a href="https://github.com/ClickHouse/ClickHouse/pull/12120" target="_blank" rel="noopener noreferrer">#12120</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fixed performance for selects with <code>UNION</code> caused by wrong limit for the total number of threads. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12030" target="_blank" rel="noopener noreferrer">#12030</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12103" target="_blank" rel="noopener noreferrer">#12103</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed segfault with <code>-StateResample</code> combinators. <a href="https://github.com/ClickHouse/ClickHouse/pull/12092" target="_blank" rel="noopener noreferrer">#12092</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed unnecessary limiting the number of threads for selects from <code>VIEW</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11937" target="_blank" rel="noopener noreferrer">#11937</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12085" target="_blank" rel="noopener noreferrer">#12085</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed possible crash while using wrong type for <code>PREWHERE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/12053" target="_blank" rel="noopener noreferrer">#12053</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/12060" target="_blank" rel="noopener noreferrer">#12060</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12060" target="_blank" rel="noopener noreferrer">#12060</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed error <code>Expected single dictionary argument for function</code> for function <code>defaultValueOfArgumentType</code> with <code>LowCardinality</code> type. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11808" target="_blank" rel="noopener noreferrer">#11808</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12056" target="_blank" rel="noopener noreferrer">#12056</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed error <code>Cannot capture column</code> for higher-order functions with <code>Tuple(LowCardinality)</code> argument. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9766" target="_blank" rel="noopener noreferrer">#9766</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12055" target="_blank" rel="noopener noreferrer">#12055</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Parse tables metadata in parallel when loading database. This fixes slow server startup when there are large number of tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/12045" target="_blank" rel="noopener noreferrer">#12045</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Make <code>topK</code> aggregate function return Enum for Enum types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3740" target="_blank" rel="noopener noreferrer">#3740</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12043" target="_blank" rel="noopener noreferrer">#12043</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed constraints check if constraint is a constant expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11360" target="_blank" rel="noopener noreferrer">#11360</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12042" target="_blank" rel="noopener noreferrer">#12042</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed incorrect comparison of tuples with <code>Nullable</code> columns. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11985" target="_blank" rel="noopener noreferrer">#11985</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12039" target="_blank" rel="noopener noreferrer">#12039</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed wrong result and potential crash when invoking function <code>if</code> with arguments of type <code>FixedString</code> with different sizes. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11362" target="_blank" rel="noopener noreferrer">#11362</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12021" target="_blank" rel="noopener noreferrer">#12021</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>A query with function <code>neighbor</code> as the only returned expression may return empty result if the function is called with offset <code>-9223372036854775808</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11367" target="_blank" rel="noopener noreferrer">#11367</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12019" target="_blank" rel="noopener noreferrer">#12019</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potential array size overflow in generateRandom that may lead to crash. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11371" target="_blank" rel="noopener noreferrer">#11371</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12013" target="_blank" rel="noopener noreferrer">#12013</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potential floating point exception. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11378" target="_blank" rel="noopener noreferrer">#11378</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12005" target="_blank" rel="noopener noreferrer">#12005</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed wrong setting name in log message at server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/11997" target="_blank" rel="noopener noreferrer">#11997</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>Query parameter was not set</code> in <code>Values</code> format. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11918" target="_blank" rel="noopener noreferrer">#11918</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11936" target="_blank" rel="noopener noreferrer">#11936</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Keep aliases for substitutions in query (parametrized queries). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11914" target="_blank" rel="noopener noreferrer">#11914</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11916" target="_blank" rel="noopener noreferrer">#11916</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed potential floating point exception when parsing DateTime64. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11374" target="_blank" rel="noopener noreferrer">#11374</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11875" target="_blank" rel="noopener noreferrer">#11875</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed memory accounting via <code>HTTP</code> interface (can be significant with <code>wait_end_of_query=1</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/11840" target="_blank" rel="noopener noreferrer">#11840</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed wrong result for <code>if()</code> with NULLs in condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/11807" target="_blank" rel="noopener noreferrer">#11807</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Parse metadata stored in zookeeper before checking for equality. <a href="https://github.com/ClickHouse/ClickHouse/pull/11739" target="_blank" rel="noopener noreferrer">#11739</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed <code>LIMIT n WITH TIES</code> usage together with <code>ORDER BY</code> statement, which contains aliases. <a href="https://github.com/ClickHouse/ClickHouse/pull/11689" target="_blank" rel="noopener noreferrer">#11689</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix potential read of uninitialized memory in cache dictionary. <a href="https://github.com/ClickHouse/ClickHouse/pull/10834" target="_blank" rel="noopener noreferrer">#10834</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-13">Performance Improvement<a class="hash-link" href="#performance-improvement-13" title="Direct link to heading">​</a></h4><ul><li>Index not used for IN operator with literals, performance regression introduced around v19.3. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10574" target="_blank" rel="noopener noreferrer">#10574</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/12062" target="_blank" rel="noopener noreferrer">#12062</a> (<a href="https://github.com/nvartolomei" target="_blank" rel="noopener noreferrer">nvartolomei</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20312112-lts-2020-06-25">ClickHouse release v20.3.12.112-lts 2020-06-25<a class="hash-link" href="#clickhouse-release-v20312112-lts-2020-06-25" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-39">Bug Fix<a class="hash-link" href="#bug-fix-39" title="Direct link to heading">​</a></h4><ul><li>Fix rare crash caused by using <code>Nullable</code> column in prewhere condition. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/11608" target="_blank" rel="noopener noreferrer">#11608</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11869" target="_blank" rel="noopener noreferrer">#11869</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Don&#x27;t allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3933" target="_blank" rel="noopener noreferrer">#3933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11846" target="_blank" rel="noopener noreferrer">#11846</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix using too many threads for queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11788" target="_blank" rel="noopener noreferrer">#11788</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix unexpected behaviour of queries like <code>SELECT *, xyz.*</code> which were success while an error expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/11753" target="_blank" rel="noopener noreferrer">#11753</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Now replicated fetches will be cancelled during metadata alter. <a href="https://github.com/ClickHouse/ClickHouse/pull/11744" target="_blank" rel="noopener noreferrer">#11744</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/11732" target="_blank" rel="noopener noreferrer">#11732</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix <code>ORDER BY ... WITH FILL</code> over const columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/11697" target="_blank" rel="noopener noreferrer">#11697</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href="https://github.com/ClickHouse/ClickHouse/pull/11690" target="_blank" rel="noopener noreferrer">#11690</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix error which leads to an incorrect state of <code>system.mutations</code>. It may show that whole mutation is already done but the server still has <code>MUTATE_PART</code> tasks in the replication queue and tries to execute them. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11611" target="_blank" rel="noopener noreferrer">#11611</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11681" target="_blank" rel="noopener noreferrer">#11681</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add support for regular expressions with case-insensitive flags. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11101" target="_blank" rel="noopener noreferrer">#11101</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11506" target="_blank" rel="noopener noreferrer">#11506</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11649" target="_blank" rel="noopener noreferrer">#11649</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Remove trivial count query optimization if row-level security is set. In previous versions the user get total count of records in a table instead filtered. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11352" target="_blank" rel="noopener noreferrer">#11352</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11644" target="_blank" rel="noopener noreferrer">#11644</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bloom filters for String (data skipping indices). <a href="https://github.com/ClickHouse/ClickHouse/pull/11638" target="_blank" rel="noopener noreferrer">#11638</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix rare crash caused by using <code>Nullable</code> column in prewhere condition. (Probably it is connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/11572" target="_blank" rel="noopener noreferrer">#11572</a> somehow). <a href="https://github.com/ClickHouse/ClickHouse/pull/11608" target="_blank" rel="noopener noreferrer">#11608</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix error <code>Block structure mismatch</code> for queries with sampling reading from <code>Buffer</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/11602" target="_blank" rel="noopener noreferrer">#11602</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix wrong exit code of the clickhouse-client, when exception.code() % 256 = 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/11601" target="_blank" rel="noopener noreferrer">#11601</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix trivial error in log message about &quot;Mark cache size was lowered&quot; at server startup. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11399" target="_blank" rel="noopener noreferrer">#11399</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11589" target="_blank" rel="noopener noreferrer">#11589</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix error <code>Size of offsets does not match size of column</code> for queries with <code>PREWHERE column in (subquery)</code> and <code>ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11580" target="_blank" rel="noopener noreferrer">#11580</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>All queries in HTTP session have had the same query_id. It is fixed. <a href="https://github.com/ClickHouse/ClickHouse/pull/11578" target="_blank" rel="noopener noreferrer">#11578</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href="https://github.com/ClickHouse/ClickHouse/pull/11550" target="_blank" rel="noopener noreferrer">#11550</a> (<a href="https://github.com/istarkov" target="_blank" rel="noopener noreferrer">Ivan Starkov</a>).</li><li>Fix shard_num/replica_num for <code>&lt;node&gt;</code> (breaks use_compact_format_in_distributed_parts_names). <a href="https://github.com/ClickHouse/ClickHouse/pull/11528" target="_blank" rel="noopener noreferrer">#11528</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix memory leak when exception is thrown in the middle of aggregation with -State functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8995" target="_blank" rel="noopener noreferrer">#8995</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11496" target="_blank" rel="noopener noreferrer">#11496</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix wrong results of distributed queries when alias could override qualified column name. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9672" target="_blank" rel="noopener noreferrer">#9672</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/9714" target="_blank" rel="noopener noreferrer">#9714</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9972" target="_blank" rel="noopener noreferrer">#9972</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2031197-lts-2020-06-10">ClickHouse release v20.3.11.97-lts 2020-06-10<a class="hash-link" href="#clickhouse-release-v2031197-lts-2020-06-10" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-9">New Feature<a class="hash-link" href="#new-feature-9" title="Direct link to heading">​</a></h4><ul><li>Now ClickHouse controls timeouts of dictionary sources on its side. Two new settings added to cache dictionary configuration: <code>strict_max_lifetime_seconds</code>, which is <code>max_lifetime</code> by default and <code>query_wait_timeout_milliseconds</code>, which is one minute by default. The first settings is also useful with <code>allow_read_expired_keys</code> settings (to forbid reading very expired keys). <a href="https://github.com/ClickHouse/ClickHouse/pull/10337" target="_blank" rel="noopener noreferrer">#10337</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-40">Bug Fix<a class="hash-link" href="#bug-fix-40" title="Direct link to heading">​</a></h4><ul><li>Fix the error <code>Data compressed with different methods</code> that can happen if <code>min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11539" target="_blank" rel="noopener noreferrer">#11539</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11540" target="_blank" rel="noopener noreferrer">#11540</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix return compressed size for codecs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11448" target="_blank" rel="noopener noreferrer">#11448</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11365" target="_blank" rel="noopener noreferrer">#11365</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11431" target="_blank" rel="noopener noreferrer">#11431</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix pointInPolygon with nan as point. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11375" target="_blank" rel="noopener noreferrer">#11375</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11421" target="_blank" rel="noopener noreferrer">#11421</a> (<a href="https://github.com/livace" target="_blank" rel="noopener noreferrer">Alexey Ilyukhov</a>).</li><li>Fix crash in JOIN over LowCarinality(T) and Nullable(T). <a href="https://github.com/ClickHouse/ClickHouse/issues/11380" target="_blank" rel="noopener noreferrer">#11380</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11414" target="_blank" rel="noopener noreferrer">#11414</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix error code for wrong <code>USING</code> key. <a href="https://github.com/ClickHouse/ClickHouse/issues/11373" target="_blank" rel="noopener noreferrer">#11373</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11404" target="_blank" rel="noopener noreferrer">#11404</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fixed geohashesInBox with arguments outside of latitude/longitude range. <a href="https://github.com/ClickHouse/ClickHouse/pull/11403" target="_blank" rel="noopener noreferrer">#11403</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Better errors for <code>joinGet()</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/11389" target="_blank" rel="noopener noreferrer">#11389</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix possible <code>Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11359" target="_blank" rel="noopener noreferrer">#11359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11366" target="_blank" rel="noopener noreferrer">#11366</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Remove redundant lock during parts send in ReplicatedMergeTree. <a href="https://github.com/ClickHouse/ClickHouse/pull/11354" target="_blank" rel="noopener noreferrer">#11354</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix support for <code>\G</code> (vertical output) in clickhouse-client in multiline mode. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9933" target="_blank" rel="noopener noreferrer">#9933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11350" target="_blank" rel="noopener noreferrer">#11350</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash in direct selects from StorageJoin (without JOIN) and wrong nullability. <a href="https://github.com/ClickHouse/ClickHouse/pull/11340" target="_blank" rel="noopener noreferrer">#11340</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix crash in <code>quantilesExactWeightedArray</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11337" target="_blank" rel="noopener noreferrer">#11337</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Now merges stopped before change metadata in <code>ALTER</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/11335" target="_blank" rel="noopener noreferrer">#11335</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Make writing to <code>MATERIALIZED VIEW</code> with setting <code>parallel_view_processing = 1</code> parallel again. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" target="_blank" rel="noopener noreferrer">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11330" target="_blank" rel="noopener noreferrer">#11330</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix visitParamExtractRaw when extracted JSON has strings with unbalanced { or [. <a href="https://github.com/ClickHouse/ClickHouse/pull/11318" target="_blank" rel="noopener noreferrer">#11318</a> (<a href="https://github.com/devwout" target="_blank" rel="noopener noreferrer">Ewout</a>).</li><li>Fix very rare race condition in ThreadPool. <a href="https://github.com/ClickHouse/ClickHouse/pull/11314" target="_blank" rel="noopener noreferrer">#11314</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potential uninitialized memory in conversion. Example: <code>SELECT toIntervalSecond(now64())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11311" target="_blank" rel="noopener noreferrer">#11311</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code>empty</code> or <code>notEmpty</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11286" target="_blank" rel="noopener noreferrer">#11286</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11303" target="_blank" rel="noopener noreferrer">#11303</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bug when query speed estimation can be incorrect and the limit of <code>min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code>max_network_bandwidth</code>, <code>max_execution_speed</code> or <code>priority</code> settings. Change the default value of <code>timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code>min_execution_speed</code> and <code>max_execution_speed</code> have no effect. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11297" target="_blank" rel="noopener noreferrer">#11297</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5732" target="_blank" rel="noopener noreferrer">#5732</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6228" target="_blank" rel="noopener noreferrer">#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code>clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11296" target="_blank" rel="noopener noreferrer">#11296</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash while reading malformed data in Protobuf format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5957" target="_blank" rel="noopener noreferrer">#5957</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11203" target="_blank" rel="noopener noreferrer">#11203</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11258" target="_blank" rel="noopener noreferrer">#11258</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fixed a bug when cache-dictionary could return default value instead of normal (when there are only expired keys). This affects only string fields. <a href="https://github.com/ClickHouse/ClickHouse/pull/11233" target="_blank" rel="noopener noreferrer">#11233</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fix error <code>Block structure mismatch in QueryPipeline</code> while reading from <code>VIEW</code> with constants in inner query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11181" target="_blank" rel="noopener noreferrer">#11181</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11205" target="_blank" rel="noopener noreferrer">#11205</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix possible exception <code>Invalid status for associated output</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11200" target="_blank" rel="noopener noreferrer">#11200</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix possible error <code>Cannot capture column</code> for higher-order functions with <code>Array(Array(LowCardinality))</code> captured argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/11185" target="_blank" rel="noopener noreferrer">#11185</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed S3 globbing which could fail in case of more than 1000 keys and some backends. <a href="https://github.com/ClickHouse/ClickHouse/pull/11179" target="_blank" rel="noopener noreferrer">#11179</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li><li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href="https://github.com/ClickHouse/ClickHouse/pull/11162" target="_blank" rel="noopener noreferrer">#11162</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix excessive reserving of threads for simple queries (optimization for reducing the number of threads, which was partly broken after changes in pipeline). <a href="https://github.com/ClickHouse/ClickHouse/pull/11114" target="_blank" rel="noopener noreferrer">#11114</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix predicates optimization for distributed queries (<code>enable_optimize_predicate_expression=1</code>) for queries with <code>HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10613" target="_blank" rel="noopener noreferrer">#10613</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11413" target="_blank" rel="noopener noreferrer">#11413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10621" target="_blank" rel="noopener noreferrer">#10621</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Introduce commit retry logic to decrease the possibility of getting duplicates from Kafka in rare cases when offset commit was failed. <a href="https://github.com/ClickHouse/ClickHouse/pull/9884" target="_blank" rel="noopener noreferrer">#9884</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-14">Performance Improvement<a class="hash-link" href="#performance-improvement-14" title="Direct link to heading">​</a></h4><ul><li>Get dictionary and check access rights only once per each call of any function reading external dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/10928" target="_blank" rel="noopener noreferrer">#10928</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-17">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-17" title="Direct link to heading">​</a></h4><ul><li>Fix several flaky integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/11355" target="_blank" rel="noopener noreferrer">#11355</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2031075-lts-2020-05-23">ClickHouse release v20.3.10.75-lts 2020-05-23<a class="hash-link" href="#clickhouse-release-v2031075-lts-2020-05-23" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-41">Bug Fix<a class="hash-link" href="#bug-fix-41" title="Direct link to heading">​</a></h4><ul><li>Removed logging from mutation finalization task if nothing was finalized. <a href="https://github.com/ClickHouse/ClickHouse/pull/11109" target="_blank" rel="noopener noreferrer">#11109</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>parseDateTime64BestEffort</code> argument resolution bugs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11038" target="_blank" rel="noopener noreferrer">#11038</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fixed incorrect raw data size in method <code>getRawData()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10964" target="_blank" rel="noopener noreferrer">#10964</a> (<a href="https://github.com/ObjatieGroba" target="_blank" rel="noopener noreferrer">Igr</a>).</li><li>Fixed incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of <code>GROUP BY</code> result is large and aggregation is performed by a single <code>String</code> field. It leads to several unmerged rows for a single key in result. <a href="https://github.com/ClickHouse/ClickHouse/pull/10952" target="_blank" rel="noopener noreferrer">#10952</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed backward compatibility with tuples in <code>Distributed</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10889" target="_blank" rel="noopener noreferrer">#10889</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed <code>SIGSEGV</code> in <code>StringHashTable</code> if such a key does not exist. <a href="https://github.com/ClickHouse/ClickHouse/pull/10870" target="_blank" rel="noopener noreferrer">#10870</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed bug in <code>ReplicatedMergeTree</code> which might cause some <code>ALTER</code> on <code>OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href="https://github.com/ClickHouse/ClickHouse/pull/10849" target="_blank" rel="noopener noreferrer">#10849</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed columns order after <code>Block::sortColumns()</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10826" target="_blank" rel="noopener noreferrer">#10826</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed the issue with <code>ODBC</code> bridge when no quoting of identifiers is requested. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7984" target="_blank" rel="noopener noreferrer">#7984</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10821" target="_blank" rel="noopener noreferrer">#10821</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed <code>UBSan</code> and <code>MSan</code> report in <code>DateLUT</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10798" target="_blank" rel="noopener noreferrer">#10798</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed incorrect type conversion in key conditions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6287" target="_blank" rel="noopener noreferrer">#6287</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10791" target="_blank" rel="noopener noreferrer">#10791</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>)</li><li>Fixed <code>parallel_view_processing</code> behavior. Now all insertions into <code>MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" target="_blank" rel="noopener noreferrer">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10757" target="_blank" rel="noopener noreferrer">#10757</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed combinator -<code>OrNull</code> and <code>-OrDefault</code> when combined with <code>-State</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10741" target="_blank" rel="noopener noreferrer">#10741</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Fixed crash in <code>generateRandom</code> with nested types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10583" target="_blank" rel="noopener noreferrer">#10583</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10734" target="_blank" rel="noopener noreferrer">#10734</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed data corruption for <code>LowCardinality(FixedString)</code> key column in <code>SummingMergeTree</code> which could have happened after merge. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10489" target="_blank" rel="noopener noreferrer">#10489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10721" target="_blank" rel="noopener noreferrer">#10721</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed possible buffer overflow in function <code>h3EdgeAngle</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10711" target="_blank" rel="noopener noreferrer">#10711</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed disappearing totals. Totals could have being filtered if query had had join or subquery with external where condition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10674" target="_blank" rel="noopener noreferrer">#10674</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10698" target="_blank" rel="noopener noreferrer">#10698</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed multiple usages of <code>IN</code> operator with the identical set in one query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10686" target="_blank" rel="noopener noreferrer">#10686</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed bug, which causes http requests stuck on client close when <code>readonly=2</code> and <code>cancel_http_readonly_queries_on_client_close=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7939" target="_blank" rel="noopener noreferrer">#7939</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7019" target="_blank" rel="noopener noreferrer">#7019</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7736" target="_blank" rel="noopener noreferrer">#7736</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7091" target="_blank" rel="noopener noreferrer">#7091</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10684" target="_blank" rel="noopener noreferrer">#10684</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed order of parameters in <code>AggregateTransform</code> constructor. <a href="https://github.com/ClickHouse/ClickHouse/pull/10667" target="_blank" rel="noopener noreferrer">#10667</a> (<a href="https://github.com/palasonic1" target="_blank" rel="noopener noreferrer">palasonic1</a>).</li><li>Fixed the lack of parallel execution of remote queries with <code>distributed_aggregation_memory_efficient</code> enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10655" target="_blank" rel="noopener noreferrer">#10655</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10664" target="_blank" rel="noopener noreferrer">#10664</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed possible incorrect number of rows for queries with <code>LIMIT</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10566" target="_blank" rel="noopener noreferrer">#10566</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10709" target="_blank" rel="noopener noreferrer">#10709</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10660" target="_blank" rel="noopener noreferrer">#10660</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed a bug which locks concurrent alters when table has a lot of parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10659" target="_blank" rel="noopener noreferrer">#10659</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed a bug when on <code>SYSTEM DROP DNS CACHE</code> query also drop caches, which are used to check if user is allowed to connect from some IP addresses. <a href="https://github.com/ClickHouse/ClickHouse/pull/10608" target="_blank" rel="noopener noreferrer">#10608</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed incorrect scalar results inside inner query of <code>MATERIALIZED VIEW</code> in case if this query contained dependent table. <a href="https://github.com/ClickHouse/ClickHouse/pull/10603" target="_blank" rel="noopener noreferrer">#10603</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed <code>SELECT</code> of column <code>ALIAS</code> which default expression type different from column type. <a href="https://github.com/ClickHouse/ClickHouse/pull/10563" target="_blank" rel="noopener noreferrer">#10563</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Implemented comparison between DateTime64 and String values. <a href="https://github.com/ClickHouse/ClickHouse/pull/10560" target="_blank" rel="noopener noreferrer">#10560</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fixed index corruption, which may occur in some cases after merge compact parts into another compact part. <a href="https://github.com/ClickHouse/ClickHouse/pull/10531" target="_blank" rel="noopener noreferrer">#10531</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fixed the situation, when mutation finished all parts, but hung up in <code>is_done=0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10526" target="_blank" rel="noopener noreferrer">#10526</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed overflow at beginning of unix epoch for timezones with fractional offset from <code>UTC</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9335" target="_blank" rel="noopener noreferrer">#9335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10513" target="_blank" rel="noopener noreferrer">#10513</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed improper shutdown of <code>Distributed</code> storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/10491" target="_blank" rel="noopener noreferrer">#10491</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed numeric overflow in <code>simpleLinearRegression</code> over large integers. <a href="https://github.com/ClickHouse/ClickHouse/pull/10474" target="_blank" rel="noopener noreferrer">#10474</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-18">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-18" title="Direct link to heading">​</a></h4><ul><li>Fix UBSan report in LZ4 library. <a href="https://github.com/ClickHouse/ClickHouse/pull/10631" target="_blank" rel="noopener noreferrer">#10631</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix clang-10 build. <a href="https://github.com/ClickHouse/ClickHouse/issues/10238" target="_blank" rel="noopener noreferrer">#10238</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10370" target="_blank" rel="noopener noreferrer">#10370</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Added failing tests about <code>max_rows_to_sort</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10268" target="_blank" rel="noopener noreferrer">#10268</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Added some improvements in printing diagnostic info in input formats. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10204" target="_blank" rel="noopener noreferrer">#10204</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10418" target="_blank" rel="noopener noreferrer">#10418</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Added CA certificates to clickhouse-server docker image. <a href="https://github.com/ClickHouse/ClickHouse/pull/10476" target="_blank" rel="noopener noreferrer">#10476</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-42">Bug fix<a class="hash-link" href="#bug-fix-42" title="Direct link to heading">​</a></h4><ul><li>Fix error <code>the BloomFilter false positive must be a double number between 0 and 1</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/10551" target="_blank" rel="noopener noreferrer">#10551</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10569" target="_blank" rel="noopener noreferrer">#10569</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v203853-2020-04-23">ClickHouse release v20.3.8.53, 2020-04-23<a class="hash-link" href="#clickhouse-release-v203853-2020-04-23" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-43">Bug Fix<a class="hash-link" href="#bug-fix-43" title="Direct link to heading">​</a></h4><ul><li>Fixed wrong behaviour of datetime functions for timezones that has altered between positive and negative offsets from UTC (e.g. Pacific/Kiritimati). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7202" target="_blank" rel="noopener noreferrer">#7202</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10369" target="_blank" rel="noopener noreferrer">#10369</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix possible segfault with <code>distributed_group_by_no_merge</code> enabled (introduced in 20.3.7.46 by <a href="https://github.com/ClickHouse/ClickHouse/issues/10131" target="_blank" rel="noopener noreferrer">#10131</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10399" target="_blank" rel="noopener noreferrer">#10399</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix wrong flattening of <code>Array(Tuple(...))</code> data types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10259" target="_blank" rel="noopener noreferrer">#10259</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10390" target="_blank" rel="noopener noreferrer">#10390</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Drop disks reservation in Aggregator. This fixes bug in disk space reservation, which may cause big external aggregation to fail even if it could be completed successfully <a href="https://github.com/ClickHouse/ClickHouse/pull/10375" target="_blank" rel="noopener noreferrer">#10375</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fixed <code>DROP</code> vs <code>OPTIMIZE</code> race in <code>ReplicatedMergeTree</code>. <code>DROP</code> could left some garbage in replica path in ZooKeeper if there was concurrent <code>OPTIMIZE</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10312" target="_blank" rel="noopener noreferrer">#10312</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix bug when server cannot attach table after column default was altered. <a href="https://github.com/ClickHouse/ClickHouse/pull/10441" target="_blank" rel="noopener noreferrer">#10441</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Do not remove metadata directory when attach database fails before loading tables.  <a href="https://github.com/ClickHouse/ClickHouse/pull/10442" target="_blank" rel="noopener noreferrer">#10442</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Fixed several bugs when some data was inserted with quorum, then deleted somehow (DROP PARTITION, TTL) and this leaded to the stuck of INSERTs or false-positive exceptions in SELECTs. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9946" target="_blank" rel="noopener noreferrer">#9946</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10188" target="_blank" rel="noopener noreferrer">#10188</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Fix possible <code>Pipeline stuck</code> error in <code>ConcatProcessor</code> which could have happened in remote query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10381" target="_blank" rel="noopener noreferrer">#10381</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fixed wrong behavior in HashTable that caused compilation error when trying to read HashMap from buffer. <a href="https://github.com/ClickHouse/ClickHouse/pull/10386" target="_blank" rel="noopener noreferrer">#10386</a> (<a href="https://github.com/palasonic1" target="_blank" rel="noopener noreferrer">palasonic1</a>)</li><li>Allow to use <code>count(*)</code> with multiple JOINs. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9853" target="_blank" rel="noopener noreferrer">#9853</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10291" target="_blank" rel="noopener noreferrer">#10291</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Prefer <code>fallback_to_stale_replicas</code> over <code>skip_unavailable_shards</code>, otherwise when both settings specified and there are no up-to-date replicas the query will fail (patch from @alex-zaitsev). Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/2564" target="_blank" rel="noopener noreferrer">#2564</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10422" target="_blank" rel="noopener noreferrer">#10422</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix the issue when a query with ARRAY JOIN, ORDER BY and LIMIT may return incomplete result. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10226" target="_blank" rel="noopener noreferrer">#10226</a>. Author: <a href="https://github.com/VadimPlh" target="_blank" rel="noopener noreferrer">Vadim Plakhtinskiy</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10427" target="_blank" rel="noopener noreferrer">#10427</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Check the number and type of arguments when creating BloomFilter index <a href="https://github.com/ClickHouse/ClickHouse/issues/9623" target="_blank" rel="noopener noreferrer">#9623</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/10431" target="_blank" rel="noopener noreferrer">#10431</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-15">Performance Improvement<a class="hash-link" href="#performance-improvement-15" title="Direct link to heading">​</a></h4><ul><li>Improved performance of queries with explicitly defined sets at right side of <code>IN</code> operator and tuples in the left side. This fixes performance regression in version 20.3. <a href="https://github.com/ClickHouse/ClickHouse/pull/9740" target="_blank" rel="noopener noreferrer">#9740</a>, <a href="https://github.com/ClickHouse/ClickHouse/pull/10385" target="_blank" rel="noopener noreferrer">#10385</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v203746-2020-04-17">ClickHouse release v20.3.7.46, 2020-04-17<a class="hash-link" href="#clickhouse-release-v203746-2020-04-17" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-44">Bug Fix<a class="hash-link" href="#bug-fix-44" title="Direct link to heading">​</a></h4><ul><li>Fix <code>Logical error: CROSS JOIN has expressions</code> error for queries with comma and names joins mix. <a href="https://github.com/ClickHouse/ClickHouse/pull/10311" target="_blank" rel="noopener noreferrer">#10311</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix queries with <code>max_bytes_before_external_group_by</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10302" target="_blank" rel="noopener noreferrer">#10302</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix move-to-prewhere optimization in presense of arrayJoin functions (in certain cases). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10092" target="_blank" rel="noopener noreferrer">#10092</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10195" target="_blank" rel="noopener noreferrer">#10195</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add the ability to relax the restriction on non-deterministic functions usage in mutations with <code>allow_nondeterministic_mutations</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10186" target="_blank" rel="noopener noreferrer">#10186</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v203640-2020-04-16">ClickHouse release v20.3.6.40, 2020-04-16<a class="hash-link" href="#clickhouse-release-v203640-2020-04-16" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-10">New Feature<a class="hash-link" href="#new-feature-10" title="Direct link to heading">​</a></h4><ul><li>Added function <code>isConstant</code>. This function checks whether its argument is constant expression and returns 1 or 0. It is intended for development, debugging and demonstration purposes. <a href="https://github.com/ClickHouse/ClickHouse/pull/10198" target="_blank" rel="noopener noreferrer">#10198</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-45">Bug Fix<a class="hash-link" href="#bug-fix-45" title="Direct link to heading">​</a></h4><ul><li>Fix error <code>Pipeline stuck</code> with <code>max_rows_to_group_by</code> and <code>group_by_overflow_mode = &#x27;break&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10279" target="_blank" rel="noopener noreferrer">#10279</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix rare possible exception <code>Cannot drain connections: cancel first</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10239" target="_blank" rel="noopener noreferrer">#10239</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed bug where ClickHouse would throw &quot;Unknown function lambda.&quot; error message when user tries to run ALTER UPDATE/DELETE on tables with ENGINE = Replicated*. Check for nondeterministic functions now handles lambda expressions correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/10237" target="_blank" rel="noopener noreferrer">#10237</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Fixed &quot;generateRandom&quot; function for Date type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9973" target="_blank" rel="noopener noreferrer">#9973</a>. Fix an edge case when dates with year 2106 are inserted to MergeTree tables with old-style partitioning but partitions are named with year 1970. <a href="https://github.com/ClickHouse/ClickHouse/pull/10218" target="_blank" rel="noopener noreferrer">#10218</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Convert types if the table definition of a View does not correspond to the SELECT query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10180" target="_blank" rel="noopener noreferrer">#10180</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/10022" target="_blank" rel="noopener noreferrer">#10022</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10217" target="_blank" rel="noopener noreferrer">#10217</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix <code>parseDateTimeBestEffort</code> for strings in RFC-2822 when day of week is Tuesday or Thursday. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10082" target="_blank" rel="noopener noreferrer">#10082</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10214" target="_blank" rel="noopener noreferrer">#10214</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix column names of constants inside JOIN that may clash with names of constants outside of JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/10207" target="_blank" rel="noopener noreferrer">#10207</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix possible inifinite query execution when the query actually should stop on LIMIT, while reading from infinite source like <code>system.numbers</code> or <code>system.zeros</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10206" target="_blank" rel="noopener noreferrer">#10206</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix using the current database for access checking when the database isn&#x27;t specified. <a href="https://github.com/ClickHouse/ClickHouse/pull/10192" target="_blank" rel="noopener noreferrer">#10192</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Convert blocks if structure does not match on INSERT into Distributed(). <a href="https://github.com/ClickHouse/ClickHouse/pull/10135" target="_blank" rel="noopener noreferrer">#10135</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible incorrect result for extremes in processors pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/10131" target="_blank" rel="noopener noreferrer">#10131</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix some kinds of alters with compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/10130" target="_blank" rel="noopener noreferrer">#10130</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix incorrect <code>index_granularity_bytes</code> check while creating new replica. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10098" target="_blank" rel="noopener noreferrer">#10098</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10121" target="_blank" rel="noopener noreferrer">#10121</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix SIGSEGV on INSERT into Distributed table when its structure differs from the underlying tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10105" target="_blank" rel="noopener noreferrer">#10105</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible rows loss for queries with <code>JOIN</code> and <code>UNION ALL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9826" target="_blank" rel="noopener noreferrer">#9826</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10113" target="_blank" rel="noopener noreferrer">#10113</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10099" target="_blank" rel="noopener noreferrer">#10099</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed replicated tables startup when updating from an old ClickHouse version where <code>/table/replicas/replica_name/metadata</code> node does not exist. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10037" target="_blank" rel="noopener noreferrer">#10037</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10095" target="_blank" rel="noopener noreferrer">#10095</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Add some arguments check and support identifier arguments for MySQL Database Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10077" target="_blank" rel="noopener noreferrer">#10077</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix bug in clickhouse dictionary source from localhost clickhouse server. The bug may lead to memory corruption if types in dictionary and source are not compatible. <a href="https://github.com/ClickHouse/ClickHouse/pull/10071" target="_blank" rel="noopener noreferrer">#10071</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix bug in <code>CHECK TABLE</code> query when table contain skip indices. <a href="https://github.com/ClickHouse/ClickHouse/pull/10068" target="_blank" rel="noopener noreferrer">#10068</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix error <code>Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. It happened when setting <code>distributed_aggregation_memory_efficient</code> was enabled, and distributed query read aggregating data with different level from different shards (mixed single and two level aggregation). <a href="https://github.com/ClickHouse/ClickHouse/pull/10063" target="_blank" rel="noopener noreferrer">#10063</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix a segmentation fault that could occur in GROUP BY over string keys containing trailing zero bytes (<a href="https://github.com/ClickHouse/ClickHouse/issues/8636" target="_blank" rel="noopener noreferrer">#8636</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/8925" target="_blank" rel="noopener noreferrer">#8925</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10025" target="_blank" rel="noopener noreferrer">#10025</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fix the number of threads used for remote query execution (performance regression, since 20.3). This happened when query from <code>Distributed</code> table was executed simultaneously on local and remote shards. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9965" target="_blank" rel="noopener noreferrer">#9965</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9971" target="_blank" rel="noopener noreferrer">#9971</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix bug in which the necessary tables weren&#x27;t retrieved at one of the processing stages of queries to some databases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9699" target="_blank" rel="noopener noreferrer">#9699</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9949" target="_blank" rel="noopener noreferrer">#9949</a> (<a href="https://github.com/achulkov2" target="_blank" rel="noopener noreferrer">achulkov2</a>).</li><li>Fix &#x27;Not found column in block&#x27; error when <code>JOIN</code> appears with <code>TOTALS</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9839" target="_blank" rel="noopener noreferrer">#9839</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9939" target="_blank" rel="noopener noreferrer">#9939</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix a bug with <code>ON CLUSTER</code> DDL queries freezing on server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/9927" target="_blank" rel="noopener noreferrer">#9927</a> (<a href="https://github.com/garneja" target="_blank" rel="noopener noreferrer">Gagan Arneja</a>).</li><li>Fix parsing multiple hosts set in the CREATE USER command, e.g. <code>CREATE USER user6 HOST NAME REGEXP &#x27;lo.?*host&#x27;, NAME REGEXP &#x27;lo*host&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9924" target="_blank" rel="noopener noreferrer">#9924</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix <code>TRUNCATE</code> for Join table engine (<a href="https://github.com/ClickHouse/ClickHouse/issues/9917" target="_blank" rel="noopener noreferrer">#9917</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9920" target="_blank" rel="noopener noreferrer">#9920</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix &quot;scalar does not exist&quot; error in ALTERs (<a href="https://github.com/ClickHouse/ClickHouse/issues/9878" target="_blank" rel="noopener noreferrer">#9878</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9904" target="_blank" rel="noopener noreferrer">#9904</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix race condition between drop and optimize in <code>ReplicatedMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9901" target="_blank" rel="noopener noreferrer">#9901</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix error with qualified names in <code>distributed_product_mode=&#x27;local&#x27;</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4756" target="_blank" rel="noopener noreferrer">#4756</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9891" target="_blank" rel="noopener noreferrer">#9891</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix calculating grants for introspection functions from the setting &#x27;allow_introspection_functions&#x27;. <a href="https://github.com/ClickHouse/ClickHouse/pull/9840" target="_blank" rel="noopener noreferrer">#9840</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-19">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-19" title="Direct link to heading">​</a></h4><ul><li>Fix integration test <code>test_settings_constraints</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9962" target="_blank" rel="noopener noreferrer">#9962</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Removed dependency on <code>clock_getres</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9833" target="_blank" rel="noopener noreferrer">#9833</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v203521-2020-03-27">ClickHouse release v20.3.5.21, 2020-03-27<a class="hash-link" href="#clickhouse-release-v203521-2020-03-27" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-46">Bug Fix<a class="hash-link" href="#bug-fix-46" title="Direct link to heading">​</a></h4><ul><li>Fix &#x27;Different expressions with the same alias&#x27; error when query has PREWHERE and WHERE on distributed table and <code>SET distributed_product_mode = &#x27;local&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9871" target="_blank" rel="noopener noreferrer">#9871</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix mutations excessive memory consumption for tables with a composite primary key. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9850" target="_blank" rel="noopener noreferrer">#9850</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9860" target="_blank" rel="noopener noreferrer">#9860</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>For INSERT queries shard now clamps the settings got from the initiator to the shard&#x27;s constaints instead of throwing an exception. This fix allows to send INSERT queries to a shard with another constraints. This change improves fix <a href="https://github.com/ClickHouse/ClickHouse/issues/9447" target="_blank" rel="noopener noreferrer">#9447</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9852" target="_blank" rel="noopener noreferrer">#9852</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix &#x27;COMMA to CROSS JOIN rewriter is not enabled or cannot rewrite query&#x27; error in case of subqueries with COMMA JOIN out of tables lists (i.e. in WHERE). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9782" target="_blank" rel="noopener noreferrer">#9782</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9830" target="_blank" rel="noopener noreferrer">#9830</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix possible exception <code>Got 0 in totals chunk, expected 1</code> on client. It happened for queries with <code>JOIN</code> in case if right joined table had zero rows. Example: <code>select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9777" target="_blank" rel="noopener noreferrer">#9777</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9823" target="_blank" rel="noopener noreferrer">#9823</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix SIGSEGV with optimize_skip_unused_shards when type cannot be converted. <a href="https://github.com/ClickHouse/ClickHouse/pull/9804" target="_blank" rel="noopener noreferrer">#9804</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix broken <code>ALTER TABLE DELETE COLUMN</code> query for compact parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/9779" target="_blank" rel="noopener noreferrer">#9779</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix max_distributed_connections (w/ and w/o Processors). <a href="https://github.com/ClickHouse/ClickHouse/pull/9673" target="_blank" rel="noopener noreferrer">#9673</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed a few cases when timezone of the function argument wasn&#x27;t used properly. <a href="https://github.com/ClickHouse/ClickHouse/pull/9574" target="_blank" rel="noopener noreferrer">#9574</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-19">Improvement<a class="hash-link" href="#improvement-19" title="Direct link to heading">​</a></h4><ul><li>Remove order by stage from mutations because we read from a single ordered part in a single thread. Also add check that the order of rows in mutation is ordered in sorting key order and this order is not violated. <a href="https://github.com/ClickHouse/ClickHouse/pull/9886" target="_blank" rel="noopener noreferrer">#9886</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v203410-2020-03-20">ClickHouse release v20.3.4.10, 2020-03-20<a class="hash-link" href="#clickhouse-release-v203410-2020-03-20" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-47">Bug Fix<a class="hash-link" href="#bug-fix-47" title="Direct link to heading">​</a></h4><ul><li>This release also contains all bug fixes from 20.1.8.41</li><li>Fix missing <code>rows_before_limit_at_least</code> for queries over http (with processors pipeline). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9730" target="_blank" rel="noopener noreferrer">#9730</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9757" target="_blank" rel="noopener noreferrer">#9757</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20336-2020-03-17">ClickHouse release v20.3.3.6, 2020-03-17<a class="hash-link" href="#clickhouse-release-v20336-2020-03-17" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-48">Bug Fix<a class="hash-link" href="#bug-fix-48" title="Direct link to heading">​</a></h4><ul><li>This release also contains all bug fixes from 20.1.7.38</li><li>Fix bug in a replication that does not allow replication to work if the user has executed mutations on the previous version. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9645" target="_blank" rel="noopener noreferrer">#9645</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9652" target="_blank" rel="noopener noreferrer">#9652</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>). It makes version 20.3 backward compatible again.</li><li>Add setting <code>use_compact_format_in_distributed_parts_names</code> which allows to write files for <code>INSERT</code> queries into <code>Distributed</code> table with more compact format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9647" target="_blank" rel="noopener noreferrer">#9647</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9653" target="_blank" rel="noopener noreferrer">#9653</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>). It makes version 20.3 backward compatible again.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20321-2020-03-12">ClickHouse release v20.3.2.1, 2020-03-12<a class="hash-link" href="#clickhouse-release-v20321-2020-03-12" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-9">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-9" title="Direct link to heading">​</a></h4><ul><li>Fixed the issue <code>file name too long</code> when sending data for <code>Distributed</code> tables for a large number of replicas. Fixed the issue that replica credentials were exposed in the server log. The format of directory name on disk was changed to <code>[shard{shard_index}[_replica{replica_index}]]</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8911" target="_blank" rel="noopener noreferrer">#8911</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>) After you upgrade to the new version, you will not be able to downgrade without manual intervention, because old server version does not recognize the new directory format. If you want to downgrade, you have to manually rename the corresponding directories to the old format. This change is relevant only if you have used asynchronous <code>INSERT</code>s to <code>Distributed</code> tables. In the version 20.3.3 we will introduce a setting that will allow you to enable the new format gradually.</li><li>Changed the format of replication log entries for mutation commands. You have to wait for old mutations to process before installing the new version.</li><li>Implement simple memory profiler that dumps stacktraces to <code>system.trace_log</code> every N bytes over soft allocation limit <a href="https://github.com/ClickHouse/ClickHouse/pull/8765" target="_blank" rel="noopener noreferrer">#8765</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/9472" target="_blank" rel="noopener noreferrer">#9472</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>) The column of <code>system.trace_log</code> was renamed from <code>timer_type</code> to <code>trace_type</code>. This will require changes in third-party performance analysis and flamegraph processing tools.</li><li>Use OS thread id everywhere instead of internal thread number. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7477" target="_blank" rel="noopener noreferrer">#7477</a> Old <code>clickhouse-client</code> cannot receive logs that are send from the server when the setting <code>send_logs_level</code> is enabled, because the names and types of the structured log messages were changed. On the other hand, different server versions can send logs with different types to each other. When you don&#x27;t use the <code>send_logs_level</code> setting, you should not care. <a href="https://github.com/ClickHouse/ClickHouse/pull/8954" target="_blank" rel="noopener noreferrer">#8954</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Remove <code>indexHint</code> function <a href="https://github.com/ClickHouse/ClickHouse/pull/9542" target="_blank" rel="noopener noreferrer">#9542</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Remove <code>findClusterIndex</code>, <code>findClusterValue</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8641" target="_blank" rel="noopener noreferrer">#8641</a>. If you were using these functions, send an email to <code>clickhouse-feedback@yandex-team.com</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9543" target="_blank" rel="noopener noreferrer">#9543</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Now it&#x27;s not allowed to create columns or add columns with <code>SELECT</code> subquery as default expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/9481" target="_blank" rel="noopener noreferrer">#9481</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Require aliases for subqueries in JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/9274" target="_blank" rel="noopener noreferrer">#9274</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Improved <code>ALTER MODIFY/ADD</code> queries logic. Now you cannot <code>ADD</code> column without type, <code>MODIFY</code> default expression does not change type of column and <code>MODIFY</code> type does not loose default expression value. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8669" target="_blank" rel="noopener noreferrer">#8669</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9227" target="_blank" rel="noopener noreferrer">#9227</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Require server to be restarted to apply the changes in logging configuration. This is a temporary workaround to avoid the bug where the server logs to a deleted log file (see <a href="https://github.com/ClickHouse/ClickHouse/issues/8696" target="_blank" rel="noopener noreferrer">#8696</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8707" target="_blank" rel="noopener noreferrer">#8707</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>The setting <code>experimental_use_processors</code> is enabled by default. This setting enables usage of the new query pipeline. This is internal refactoring and we expect no visible changes. If you will see any issues, set it to back zero. <a href="https://github.com/ClickHouse/ClickHouse/pull/8768" target="_blank" rel="noopener noreferrer">#8768</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-11">New Feature<a class="hash-link" href="#new-feature-11" title="Direct link to heading">​</a></h4><ul><li>Add <code>Avro</code> and <code>AvroConfluent</code> input/output formats <a href="https://github.com/ClickHouse/ClickHouse/pull/8571" target="_blank" rel="noopener noreferrer">#8571</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8957" target="_blank" rel="noopener noreferrer">#8957</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8717" target="_blank" rel="noopener noreferrer">#8717</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Multi-threaded and non-blocking updates of expired keys in <code>cache</code> dictionaries (with optional permission to read old ones). <a href="https://github.com/ClickHouse/ClickHouse/pull/8303" target="_blank" rel="noopener noreferrer">#8303</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Add query <code>ALTER ... MATERIALIZE TTL</code>. It runs mutation that forces to remove expired data by TTL and recalculates meta-information about TTL in all parts. <a href="https://github.com/ClickHouse/ClickHouse/pull/8775" target="_blank" rel="noopener noreferrer">#8775</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Switch from HashJoin to MergeJoin (on disk) if needed <a href="https://github.com/ClickHouse/ClickHouse/pull/9082" target="_blank" rel="noopener noreferrer">#9082</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Added <code>MOVE PARTITION</code> command for <code>ALTER TABLE</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/4729" target="_blank" rel="noopener noreferrer">#4729</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/6168" target="_blank" rel="noopener noreferrer">#6168</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>)</li><li>Reloading storage configuration from configuration file on the fly. <a href="https://github.com/ClickHouse/ClickHouse/pull/8594" target="_blank" rel="noopener noreferrer">#8594</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Allowed to change <code>storage_policy</code> to not less rich one. <a href="https://github.com/ClickHouse/ClickHouse/pull/8107" target="_blank" rel="noopener noreferrer">#8107</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Added support for globs/wildcards for S3 storage and table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/8851" target="_blank" rel="noopener noreferrer">#8851</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Implement <code>bitAnd</code>, <code>bitOr</code>, <code>bitXor</code>, <code>bitNot</code> for <code>FixedString(N)</code> datatype. <a href="https://github.com/ClickHouse/ClickHouse/pull/9091" target="_blank" rel="noopener noreferrer">#9091</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>)</li><li>Added function <code>bitCount</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8702" target="_blank" rel="noopener noreferrer">#8702</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8708" target="_blank" rel="noopener noreferrer">#8708</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8749" target="_blank" rel="noopener noreferrer">#8749</a> (<a href="https://github.com/ikopylov" target="_blank" rel="noopener noreferrer">ikopylov</a>)</li><li>Add <code>generateRandom</code> table function to generate random rows with given schema. Allows to populate arbitrary test table with data. <a href="https://github.com/ClickHouse/ClickHouse/pull/8994" target="_blank" rel="noopener noreferrer">#8994</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>)</li><li><code>JSONEachRowFormat</code>: support special case when objects enclosed in top-level array. <a href="https://github.com/ClickHouse/ClickHouse/pull/8860" target="_blank" rel="noopener noreferrer">#8860</a> (<a href="https://github.com/Avogar" target="_blank" rel="noopener noreferrer">Kruglov Pavel</a>)</li><li>Now it&#x27;s possible to create a column with <code>DEFAULT</code> expression which depends on a column with default <code>ALIAS</code> expression. <a href="https://github.com/ClickHouse/ClickHouse/pull/9489" target="_blank" rel="noopener noreferrer">#9489</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Allow to specify <code>--limit</code> more than the source data size in <code>clickhouse-obfuscator</code>. The data will repeat itself with different random seed. <a href="https://github.com/ClickHouse/ClickHouse/pull/9155" target="_blank" rel="noopener noreferrer">#9155</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added <code>groupArraySample</code> function (similar to <code>groupArray</code>) with reservior sampling algorithm. <a href="https://github.com/ClickHouse/ClickHouse/pull/8286" target="_blank" rel="noopener noreferrer">#8286</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Now you can monitor the size of update queue in <code>cache</code>/<code>complex_key_cache</code> dictionaries via system metrics. <a href="https://github.com/ClickHouse/ClickHouse/pull/9413" target="_blank" rel="noopener noreferrer">#9413</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Allow to use CRLF as a line separator in CSV output format with setting <code>output_format_csv_crlf_end_of_line</code> is set to 1 <a href="https://github.com/ClickHouse/ClickHouse/pull/8934" target="_blank" rel="noopener noreferrer">#8934</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8935" target="_blank" rel="noopener noreferrer">#8935</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8963" target="_blank" rel="noopener noreferrer">#8963</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>)</li><li>Implement more functions of the <a href="https://github.com/uber/h3" target="_blank" rel="noopener noreferrer">H3</a> API: <code>h3GetBaseCell</code>, <code>h3HexAreaM2</code>, <code>h3IndexesAreNeighbors</code>, <code>h3ToChildren</code>, <code>h3ToString</code> and <code>stringToH3</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8938" target="_blank" rel="noopener noreferrer">#8938</a> (<a href="https://github.com/nmandery" target="_blank" rel="noopener noreferrer">Nico Mandery</a>)</li><li>New setting introduced: <code>max_parser_depth</code> to control maximum stack size and allow large complex queries. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6681" target="_blank" rel="noopener noreferrer">#6681</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/7668" target="_blank" rel="noopener noreferrer">#7668</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8647" target="_blank" rel="noopener noreferrer">#8647</a> (<a href="https://github.com/qMBQx8GH" target="_blank" rel="noopener noreferrer">Maxim Smirnov</a>)</li><li>Add a setting <code>force_optimize_skip_unused_shards</code> setting to throw if skipping of unused shards is not possible <a href="https://github.com/ClickHouse/ClickHouse/pull/8805" target="_blank" rel="noopener noreferrer">#8805</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Allow to configure multiple disks/volumes for storing data for send in <code>Distributed</code> engine <a href="https://github.com/ClickHouse/ClickHouse/pull/8756" target="_blank" rel="noopener noreferrer">#8756</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Support storage policy (<code>&lt;tmp_policy&gt;</code>) for storing temporary data. <a href="https://github.com/ClickHouse/ClickHouse/pull/8750" target="_blank" rel="noopener noreferrer">#8750</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Added <code>X-ClickHouse-Exception-Code</code> HTTP header that is set if exception was thrown before sending data. This implements <a href="https://github.com/ClickHouse/ClickHouse/issues/4971" target="_blank" rel="noopener noreferrer">#4971</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8786" target="_blank" rel="noopener noreferrer">#8786</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>)</li><li>Added function <code>ifNotFinite</code>. It is just a syntactic sugar: <code>ifNotFinite(x, y) = isFinite(x) ? x : y</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8710" target="_blank" rel="noopener noreferrer">#8710</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added <code>last_successful_update_time</code> column in <code>system.dictionaries</code> table <a href="https://github.com/ClickHouse/ClickHouse/pull/9394" target="_blank" rel="noopener noreferrer">#9394</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Add <code>blockSerializedSize</code> function (size on disk without compression) <a href="https://github.com/ClickHouse/ClickHouse/pull/8952" target="_blank" rel="noopener noreferrer">#8952</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Add function <code>moduloOrZero</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9358" target="_blank" rel="noopener noreferrer">#9358</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Added system tables <code>system.zeros</code> and <code>system.zeros_mt</code> as well as tale functions <code>zeros()</code> and <code>zeros_mt()</code>. Tables (and table functions) contain single column with name <code>zero</code> and type <code>UInt8</code>. This column contains zeros. It is needed for test purposes as the fastest method to generate many rows. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6604" target="_blank" rel="noopener noreferrer">#6604</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9593" target="_blank" rel="noopener noreferrer">#9593</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-7">Experimental Feature<a class="hash-link" href="#experimental-feature-7" title="Direct link to heading">​</a></h4><ul><li>Add new compact format of parts in <code>MergeTree</code>-family tables in which all columns are stored in one file. It helps to increase performance of small and frequent inserts. The old format (one file per column) is now called wide. Data storing format is controlled by settings <code>min_bytes_for_wide_part</code> and <code>min_rows_for_wide_part</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8290" target="_blank" rel="noopener noreferrer">#8290</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Support for S3 storage for <code>Log</code>, <code>TinyLog</code> and <code>StripeLog</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/8862" target="_blank" rel="noopener noreferrer">#8862</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-49">Bug Fix<a class="hash-link" href="#bug-fix-49" title="Direct link to heading">​</a></h4><ul><li>Fixed inconsistent whitespaces in log messages. <a href="https://github.com/ClickHouse/ClickHouse/pull/9322" target="_blank" rel="noopener noreferrer">#9322</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix bug in which arrays of unnamed tuples were flattened as Nested structures on table creation. <a href="https://github.com/ClickHouse/ClickHouse/pull/8866" target="_blank" rel="noopener noreferrer">#8866</a> (<a href="https://github.com/achulkov2" target="_blank" rel="noopener noreferrer">achulkov2</a>)</li><li>Fixed the issue when &quot;Too many open files&quot; error may happen if there are too many files matching glob pattern in <code>File</code> table or <code>file</code> table function. Now files are opened lazily. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8857" target="_blank" rel="noopener noreferrer">#8857</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8861" target="_blank" rel="noopener noreferrer">#8861</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>DROP TEMPORARY TABLE now drops only temporary table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8907" target="_blank" rel="noopener noreferrer">#8907</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Remove outdated partition when we shutdown the server or DETACH/ATTACH a table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8602" target="_blank" rel="noopener noreferrer">#8602</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>)</li><li>For how the default disk calculates the free space from <code>data</code> subdirectory. Fixed the issue when the amount of free space is not calculated correctly if the <code>data</code> directory is mounted to a separate device (rare case). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7441" target="_blank" rel="noopener noreferrer">#7441</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9257" target="_blank" rel="noopener noreferrer">#9257</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>)</li><li>Allow comma (cross) join with IN () inside. <a href="https://github.com/ClickHouse/ClickHouse/pull/9251" target="_blank" rel="noopener noreferrer">#9251</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Allow to rewrite CROSS to INNER JOIN if there&#x27;s <!-- -->[NOT]<!-- --> LIKE operator in WHERE section. <a href="https://github.com/ClickHouse/ClickHouse/pull/9229" target="_blank" rel="noopener noreferrer">#9229</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix possible incorrect result after <code>GROUP BY</code> with enabled setting <code>distributed_aggregation_memory_efficient</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9134" target="_blank" rel="noopener noreferrer">#9134</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9289" target="_blank" rel="noopener noreferrer">#9289</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Found keys were counted as missed in metrics of cache dictionaries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9411" target="_blank" rel="noopener noreferrer">#9411</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Fix replication protocol incompatibility introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/8598" target="_blank" rel="noopener noreferrer">#8598</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9412" target="_blank" rel="noopener noreferrer">#9412</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fixed race condition on <code>queue_task_handle</code> at the startup of <code>ReplicatedMergeTree</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/9552" target="_blank" rel="noopener noreferrer">#9552</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>The token <code>NOT</code> did not work in <code>SHOW TABLES NOT LIKE</code> query <a href="https://github.com/ClickHouse/ClickHouse/issues/8727" target="_blank" rel="noopener noreferrer">#8727</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8940" target="_blank" rel="noopener noreferrer">#8940</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added range check to function <code>h3EdgeLengthM</code>. Without this check, buffer overflow is possible. <a href="https://github.com/ClickHouse/ClickHouse/pull/8945" target="_blank" rel="noopener noreferrer">#8945</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed up a bug in batched calculations of ternary logical OPs on multiple arguments (more than 10). <a href="https://github.com/ClickHouse/ClickHouse/pull/8718" target="_blank" rel="noopener noreferrer">#8718</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Fix error of PREWHERE optimization, which could lead to segfaults or <code>Inconsistent number of columns got from MergeTreeRangeReader</code> exception. <a href="https://github.com/ClickHouse/ClickHouse/pull/9024" target="_blank" rel="noopener noreferrer">#9024</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fix unexpected <code>Timeout exceeded while reading from socket</code> exception, which randomly happens on secure connection before timeout actually exceeded and when query profiler is enabled. Also add <code>connect_timeout_with_failover_secure_ms</code> settings (default 100ms), which is similar to <code>connect_timeout_with_failover_ms</code>, but is used for secure connections (because SSL handshake is slower, than ordinary TCP connection) <a href="https://github.com/ClickHouse/ClickHouse/pull/9026" target="_blank" rel="noopener noreferrer">#9026</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix bug with mutations finalization, when mutation may hang in state with <code>parts_to_do=0</code> and <code>is_done=0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9022" target="_blank" rel="noopener noreferrer">#9022</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Use new ANY JOIN logic with <code>partial_merge_join</code> setting. It&#x27;s possible to make <code>ANY|ALL|SEMI LEFT</code> and <code>ALL INNER</code> joins with <code>partial_merge_join=1</code> now. <a href="https://github.com/ClickHouse/ClickHouse/pull/8932" target="_blank" rel="noopener noreferrer">#8932</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Shard now clamps the settings got from the initiator to the shard&#x27;s constaints instead of throwing an exception. This fix allows to send queries to a shard with another constraints. <a href="https://github.com/ClickHouse/ClickHouse/pull/9447" target="_blank" rel="noopener noreferrer">#9447</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Fixed memory management problem in <code>MergeTreeReadPool</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8791" target="_blank" rel="noopener noreferrer">#8791</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fix <code>toDecimal*OrNull()</code> functions family when called with string <code>e</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8312" target="_blank" rel="noopener noreferrer">#8312</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8764" target="_blank" rel="noopener noreferrer">#8764</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Make sure that <code>FORMAT Null</code> sends no data to the client. <a href="https://github.com/ClickHouse/ClickHouse/pull/8767" target="_blank" rel="noopener noreferrer">#8767</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Fix bug that timestamp in <code>LiveViewBlockInputStream</code> will not updated. <code>LIVE VIEW</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/8644" target="_blank" rel="noopener noreferrer">#8644</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8625" target="_blank" rel="noopener noreferrer">#8625</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>)</li><li>Fixed <code>ALTER MODIFY TTL</code> wrong behavior which did not allow to delete old TTL expressions. <a href="https://github.com/ClickHouse/ClickHouse/pull/8422" target="_blank" rel="noopener noreferrer">#8422</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fixed UBSan report in MergeTreeIndexSet. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9250" target="_blank" rel="noopener noreferrer">#9250</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9365" target="_blank" rel="noopener noreferrer">#9365</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed the behaviour of <code>match</code> and <code>extract</code> functions when haystack has zero bytes. The behaviour was wrong when haystack was constant. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9160" target="_blank" rel="noopener noreferrer">#9160</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9163" target="_blank" rel="noopener noreferrer">#9163</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/9345" target="_blank" rel="noopener noreferrer">#9345</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Avoid throwing from destructor in Apache Avro 3rd-party library. <a href="https://github.com/ClickHouse/ClickHouse/pull/9066" target="_blank" rel="noopener noreferrer">#9066</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>)</li><li>Don&#x27;t commit a batch polled from <code>Kafka</code> partially as it can lead to holes in data. <a href="https://github.com/ClickHouse/ClickHouse/pull/8876" target="_blank" rel="noopener noreferrer">#8876</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Fix <code>joinGet</code> with nullable return types. <a href="https://github.com/ClickHouse/ClickHouse/issues/8919" target="_blank" rel="noopener noreferrer">#8919</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9014" target="_blank" rel="noopener noreferrer">#9014</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Fix data incompatibility when compressed with <code>T64</code> codec. <a href="https://github.com/ClickHouse/ClickHouse/pull/9016" target="_blank" rel="noopener noreferrer">#9016</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>) Fix data type ids in <code>T64</code> compression codec that leads to wrong (de)compression in affected versions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9033" target="_blank" rel="noopener noreferrer">#9033</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Add setting <code>enable_early_constant_folding</code> and disable it in some cases that leads to errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/9010" target="_blank" rel="noopener noreferrer">#9010</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix pushdown predicate optimizer with VIEW and enable the test <a href="https://github.com/ClickHouse/ClickHouse/pull/9011" target="_blank" rel="noopener noreferrer">#9011</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Fix segfault in <code>Merge</code> tables, that can happen when reading from <code>File</code> storages <a href="https://github.com/ClickHouse/ClickHouse/pull/9387" target="_blank" rel="noopener noreferrer">#9387</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Added a check for storage policy in <code>ATTACH PARTITION FROM</code>, <code>REPLACE PARTITION</code>, <code>MOVE TO TABLE</code>. Otherwise it could make data of part inaccessible after restart and prevent ClickHouse to start. <a href="https://github.com/ClickHouse/ClickHouse/pull/9383" target="_blank" rel="noopener noreferrer">#9383</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fix alters if there is TTL set for table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8800" target="_blank" rel="noopener noreferrer">#8800</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fix race condition that can happen when <code>SYSTEM RELOAD ALL DICTIONARIES</code> is executed while some dictionary is being modified/added/removed. <a href="https://github.com/ClickHouse/ClickHouse/pull/8801" target="_blank" rel="noopener noreferrer">#8801</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>In previous versions <code>Memory</code> database engine use empty data path, so tables are created in <code>path</code> directory (e.g. <code>/var/lib/clickhouse/</code>), not in data directory of database (e.g. <code>/var/lib/clickhouse/db_name</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8753" target="_blank" rel="noopener noreferrer">#8753</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fixed wrong log messages about missing default disk or policy. <a href="https://github.com/ClickHouse/ClickHouse/pull/9530" target="_blank" rel="noopener noreferrer">#9530</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fix not(has()) for the bloom_filter index of array types. <a href="https://github.com/ClickHouse/ClickHouse/pull/9407" target="_blank" rel="noopener noreferrer">#9407</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>)</li><li>Allow first column(s) in a table with <code>Log</code> engine be an alias <a href="https://github.com/ClickHouse/ClickHouse/pull/9231" target="_blank" rel="noopener noreferrer">#9231</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Fix order of ranges while reading from <code>MergeTree</code> table in one thread. It could lead to exceptions from <code>MergeTreeRangeReader</code> or wrong query results. <a href="https://github.com/ClickHouse/ClickHouse/pull/9050" target="_blank" rel="noopener noreferrer">#9050</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Make <code>reinterpretAsFixedString</code> to return <code>FixedString</code> instead of <code>String</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9052" target="_blank" rel="noopener noreferrer">#9052</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>)</li><li>Avoid extremely rare cases when the user can get wrong error message (<code>Success</code> instead of detailed error description). <a href="https://github.com/ClickHouse/ClickHouse/pull/9457" target="_blank" rel="noopener noreferrer">#9457</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Do not crash when using <code>Template</code> format with empty row template. <a href="https://github.com/ClickHouse/ClickHouse/pull/8785" target="_blank" rel="noopener noreferrer">#8785</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Metadata files for system tables could be created in wrong place <a href="https://github.com/ClickHouse/ClickHouse/pull/8653" target="_blank" rel="noopener noreferrer">#8653</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>) Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8581" target="_blank" rel="noopener noreferrer">#8581</a>.</li><li>Fix data race on exception_ptr in cache dictionary <a href="https://github.com/ClickHouse/ClickHouse/issues/8303" target="_blank" rel="noopener noreferrer">#8303</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9379" target="_blank" rel="noopener noreferrer">#9379</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Do not throw an exception for query <code>ATTACH TABLE IF NOT EXISTS</code>. Previously it was thrown if table already exists, despite the <code>IF NOT EXISTS</code> clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/8967" target="_blank" rel="noopener noreferrer">#8967</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fixed missing closing paren in exception message. <a href="https://github.com/ClickHouse/ClickHouse/pull/8811" target="_blank" rel="noopener noreferrer">#8811</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Avoid message <code>Possible deadlock avoided</code> at the startup of clickhouse-client in interactive mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/9455" target="_blank" rel="noopener noreferrer">#9455</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed the issue when padding at the end of base64 encoded value can be malformed. Update base64 library. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9491" target="_blank" rel="noopener noreferrer">#9491</a>, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9492" target="_blank" rel="noopener noreferrer">#9492</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9500" target="_blank" rel="noopener noreferrer">#9500</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Prevent losing data in <code>Kafka</code> in rare cases when exception happens after reading suffix but before commit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9378" target="_blank" rel="noopener noreferrer">#9378</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9507" target="_blank" rel="noopener noreferrer">#9507</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Fixed exception in <code>DROP TABLE IF EXISTS</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8663" target="_blank" rel="noopener noreferrer">#8663</a> (<a href="https://github.com/nikvas0" target="_blank" rel="noopener noreferrer">Nikita Vasilev</a>)</li><li>Fix crash when a user tries to <code>ALTER MODIFY SETTING</code> for old-formated <code>MergeTree</code> table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/9435" target="_blank" rel="noopener noreferrer">#9435</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Support for UInt64 numbers that don&#x27;t fit in Int64 in JSON-related functions. Update SIMDJSON to master. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9209" target="_blank" rel="noopener noreferrer">#9209</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9344" target="_blank" rel="noopener noreferrer">#9344</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed execution of inversed predicates when non-strictly monotinic functional index is used. <a href="https://github.com/ClickHouse/ClickHouse/pull/9223" target="_blank" rel="noopener noreferrer">#9223</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Don&#x27;t try to fold <code>IN</code> constant in <code>GROUP BY</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8868" target="_blank" rel="noopener noreferrer">#8868</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Fix bug in <code>ALTER DELETE</code> mutations which leads to index corruption. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9019" target="_blank" rel="noopener noreferrer">#9019</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/8982" target="_blank" rel="noopener noreferrer">#8982</a>. Additionally fix extremely rare race conditions in <code>ReplicatedMergeTree</code> <code>ALTER</code> queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9048" target="_blank" rel="noopener noreferrer">#9048</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>When the setting <code>compile_expressions</code> is enabled, you can get <code>unexpected column</code> in <code>LLVMExecutableFunction</code> when we use <code>Nullable</code> type <a href="https://github.com/ClickHouse/ClickHouse/pull/8910" target="_blank" rel="noopener noreferrer">#8910</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>)</li><li>Multiple fixes for <code>Kafka</code> engine: 1) fix duplicates that were appearing during consumer group rebalance. 2) Fix rare &#x27;holes&#x27; appeared when data were polled from several partitions with one poll and committed partially (now we always process / commit the whole polled block of messages). 3) Fix flushes by block size (before that only flushing by timeout was working properly). 4) better subscription procedure (with assignment feedback). 5) Make tests work faster (with default intervals and timeouts). Due to the fact that data was not flushed by block size before (as it should according to documentation), that PR may lead to some performance degradation with default settings (due to more often &amp; tinier flushes which are less optimal). If you encounter the performance issue after that change - please increase <code>kafka_max_block_size</code> in the table to the bigger value ( for example <code>CREATE TABLE ...Engine=Kafka ... SETTINGS ... kafka_max_block_size=524288</code>). Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7259" target="_blank" rel="noopener noreferrer">#7259</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8917" target="_blank" rel="noopener noreferrer">#8917</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Fix <code>Parameter out of bound</code> exception in some queries after PREWHERE optimizations. <a href="https://github.com/ClickHouse/ClickHouse/pull/8914" target="_blank" rel="noopener noreferrer">#8914</a> (<a href="https://github.com/bgiard" target="_blank" rel="noopener noreferrer">Baudouin Giard</a>)</li><li>Fixed the case of mixed-constness of arguments of function <code>arrayZip</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8705" target="_blank" rel="noopener noreferrer">#8705</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>When executing <code>CREATE</code> query, fold constant expressions in storage engine arguments. Replace empty database name with current database. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6508" target="_blank" rel="noopener noreferrer">#6508</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/3492" target="_blank" rel="noopener noreferrer">#3492</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9262" target="_blank" rel="noopener noreferrer">#9262</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Now it&#x27;s not possible to create or add columns with simple cyclic aliases like <code>a DEFAULT b, b DEFAULT a</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9603" target="_blank" rel="noopener noreferrer">#9603</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fixed a bug with double move which may corrupt original part. This is relevant if you use <code>ALTER TABLE MOVE</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8680" target="_blank" rel="noopener noreferrer">#8680</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Allow <code>interval</code> identifier to correctly parse without backticks. Fixed issue when a query cannot be executed even if the <code>interval</code> identifier is enclosed in backticks or double quotes. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9124" target="_blank" rel="noopener noreferrer">#9124</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9142" target="_blank" rel="noopener noreferrer">#9142</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed fuzz test and incorrect behaviour of <code>bitTestAll</code>/<code>bitTestAny</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9143" target="_blank" rel="noopener noreferrer">#9143</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix possible crash/wrong number of rows in <code>LIMIT n WITH TIES</code> when there are a lot of rows equal to n&#x27;th row. <a href="https://github.com/ClickHouse/ClickHouse/pull/9464" target="_blank" rel="noopener noreferrer">#9464</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix mutations with parts written with enabled <code>insert_quorum</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9463" target="_blank" rel="noopener noreferrer">#9463</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix data race at destruction of <code>Poco::HTTPServer</code>. It could happen when server is started and immediately shut down. <a href="https://github.com/ClickHouse/ClickHouse/pull/9468" target="_blank" rel="noopener noreferrer">#9468</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fix bug in which a misleading error message was shown when running <code>SHOW CREATE TABLE a_table_that_does_not_exist</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8899" target="_blank" rel="noopener noreferrer">#8899</a> (<a href="https://github.com/achulkov2" target="_blank" rel="noopener noreferrer">achulkov2</a>)</li><li>Fixed <code>Parameters are out of bound</code> exception in some rare cases when we have a constant in the <code>SELECT</code> clause when we have an <code>ORDER BY</code> and a <code>LIMIT</code> clause. <a href="https://github.com/ClickHouse/ClickHouse/pull/8892" target="_blank" rel="noopener noreferrer">#8892</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>)</li><li>Fix mutations finalization, when already done mutation can have status <code>is_done=0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9217" target="_blank" rel="noopener noreferrer">#9217</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Prevent from executing <code>ALTER ADD INDEX</code> for MergeTree tables with old syntax, because it does not work. <a href="https://github.com/ClickHouse/ClickHouse/pull/8822" target="_blank" rel="noopener noreferrer">#8822</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>)</li><li>During server startup do not access table, which <code>LIVE VIEW</code> depends on, so server will be able to start. Also remove <code>LIVE VIEW</code> dependencies when detaching <code>LIVE VIEW</code>. <code>LIVE VIEW</code> is an experimental feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/8824" target="_blank" rel="noopener noreferrer">#8824</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix possible segfault in <code>MergeTreeRangeReader</code>, while executing <code>PREWHERE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9106" target="_blank" rel="noopener noreferrer">#9106</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fix possible mismatched checksums with column TTLs. <a href="https://github.com/ClickHouse/ClickHouse/pull/9451" target="_blank" rel="noopener noreferrer">#9451</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fixed a bug when parts were not being moved in background by TTL rules in case when there is only one volume. <a href="https://github.com/ClickHouse/ClickHouse/pull/8672" target="_blank" rel="noopener noreferrer">#8672</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fixed the issue <code>Method createColumn() is not implemented for data type Set</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7799" target="_blank" rel="noopener noreferrer">#7799</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8674" target="_blank" rel="noopener noreferrer">#8674</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Now we will try finalize mutations more frequently. <a href="https://github.com/ClickHouse/ClickHouse/pull/9427" target="_blank" rel="noopener noreferrer">#9427</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix <code>intDiv</code> by minus one constant <a href="https://github.com/ClickHouse/ClickHouse/pull/9351" target="_blank" rel="noopener noreferrer">#9351</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Fix possible race condition in <code>BlockIO</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9356" target="_blank" rel="noopener noreferrer">#9356</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix bug leading to server termination when trying to use / drop <code>Kafka</code> table created with wrong parameters. <a href="https://github.com/ClickHouse/ClickHouse/pull/9513" target="_blank" rel="noopener noreferrer">#9513</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Added workaround if OS returns wrong result for <code>timer_create</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/8837" target="_blank" rel="noopener noreferrer">#8837</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed error in usage of <code>min_marks_for_seek</code> parameter. Fixed the error message when there is no sharding key in Distributed table and we try to skip unused shards. <a href="https://github.com/ClickHouse/ClickHouse/pull/8908" target="_blank" rel="noopener noreferrer">#8908</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-20">Improvement<a class="hash-link" href="#improvement-20" title="Direct link to heading">​</a></h4><ul><li>Implement <code>ALTER MODIFY/DROP</code> queries on top of mutations for <code>ReplicatedMergeTree*</code> engines family. Now <code>ALTERS</code> blocks only at the metadata update stage, and don&#x27;t block after that. <a href="https://github.com/ClickHouse/ClickHouse/pull/8701" target="_blank" rel="noopener noreferrer">#8701</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Add ability to rewrite CROSS to INNER JOINs with <code>WHERE</code> section containing unqialified names. <a href="https://github.com/ClickHouse/ClickHouse/pull/9512" target="_blank" rel="noopener noreferrer">#9512</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Make <code>SHOW TABLES</code> and <code>SHOW DATABASES</code> queries support the <code>WHERE</code> expressions and <code>FROM</code>/<code>IN</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9076" target="_blank" rel="noopener noreferrer">#9076</a> (<a href="https://github.com/sundy-li" target="_blank" rel="noopener noreferrer">sundyli</a>)</li><li>Added a setting <code>deduplicate_blocks_in_dependent_materialized_views</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9070" target="_blank" rel="noopener noreferrer">#9070</a> (<a href="https://github.com/urykhy" target="_blank" rel="noopener noreferrer">urykhy</a>)</li><li>After recent changes MySQL client started to print binary strings in hex thereby making them not readable (<a href="https://github.com/ClickHouse/ClickHouse/issues/9032" target="_blank" rel="noopener noreferrer">#9032</a>). The workaround in ClickHouse is to mark string columns as UTF-8, which is not always, but usually the case. <a href="https://github.com/ClickHouse/ClickHouse/pull/9079" target="_blank" rel="noopener noreferrer">#9079</a> (<a href="https://github.com/yurriy" target="_blank" rel="noopener noreferrer">Yuriy Baranov</a>)</li><li>Add support of String and FixedString keys for <code>sumMap</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8903" target="_blank" rel="noopener noreferrer">#8903</a> (<a href="https://github.com/bgiard" target="_blank" rel="noopener noreferrer">Baudouin Giard</a>)</li><li>Support string keys in SummingMergeTree maps <a href="https://github.com/ClickHouse/ClickHouse/pull/8933" target="_blank" rel="noopener noreferrer">#8933</a> (<a href="https://github.com/bgiard" target="_blank" rel="noopener noreferrer">Baudouin Giard</a>)</li><li>Signal termination of thread to the thread pool even if the thread has thrown exception <a href="https://github.com/ClickHouse/ClickHouse/pull/8736" target="_blank" rel="noopener noreferrer">#8736</a> (<a href="https://github.com/dingxiangfei2009" target="_blank" rel="noopener noreferrer">Ding Xiang Fei</a>)</li><li>Allow to set <code>query_id</code> in <code>clickhouse-benchmark</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9416" target="_blank" rel="noopener noreferrer">#9416</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Don&#x27;t allow strange expressions in <code>ALTER TABLE ... PARTITION partition</code> query. This addresses <a href="https://github.com/ClickHouse/ClickHouse/issues/7192" target="_blank" rel="noopener noreferrer">#7192</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8835" target="_blank" rel="noopener noreferrer">#8835</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>The table <code>system.table_engines</code> now provides information about feature support (like <code>supports_ttl</code> or <code>supports_sort_order</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8830" target="_blank" rel="noopener noreferrer">#8830</a> (<a href="https://github.com/zlobober" target="_blank" rel="noopener noreferrer">Max Akhmedov</a>)</li><li>Enable <code>system.metric_log</code> by default. It will contain rows with values of ProfileEvents, CurrentMetrics collected with &quot;collect_interval_milliseconds&quot; interval (one second by default). The table is very small (usually in order of megabytes) and collecting this data by default is reasonable. <a href="https://github.com/ClickHouse/ClickHouse/pull/9225" target="_blank" rel="noopener noreferrer">#9225</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Initialize query profiler for all threads in a group, e.g. it allows to fully profile insert-queries. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6964" target="_blank" rel="noopener noreferrer">#6964</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8874" target="_blank" rel="noopener noreferrer">#8874</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Now temporary <code>LIVE VIEW</code> is created by <code>CREATE LIVE VIEW name WITH TIMEOUT [42] ...</code> instead of <code>CREATE TEMPORARY LIVE VIEW ...</code>, because the previous syntax was not consistent with <code>CREATE TEMPORARY TABLE ...</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/9131" target="_blank" rel="noopener noreferrer">#9131</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Add text_log.level configuration parameter to limit entries that goes to <code>system.text_log</code> table <a href="https://github.com/ClickHouse/ClickHouse/pull/8809" target="_blank" rel="noopener noreferrer">#8809</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Allow to put downloaded part to a disks/volumes according to TTL rules <a href="https://github.com/ClickHouse/ClickHouse/pull/8598" target="_blank" rel="noopener noreferrer">#8598</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>For external MySQL dictionaries, allow to mutualize MySQL connection pool to &quot;share&quot; them among dictionaries. This option significantly reduces the number of connections to MySQL servers. <a href="https://github.com/ClickHouse/ClickHouse/pull/9409" target="_blank" rel="noopener noreferrer">#9409</a> (<a href="https://github.com/clemrodriguez" target="_blank" rel="noopener noreferrer">Clément Rodriguez</a>)</li><li>Show nearest query execution time for quantiles in <code>clickhouse-benchmark</code> output instead of interpolated values. It&#x27;s better to show values that correspond to the execution time of some queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/8712" target="_blank" rel="noopener noreferrer">#8712</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Possibility to add key &amp; timestamp for the message when inserting data to Kafka. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7198" target="_blank" rel="noopener noreferrer">#7198</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8969" target="_blank" rel="noopener noreferrer">#8969</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>If server is run from terminal, highlight thread number, query id and log priority by colors. This is for improved readability of correlated log messages for developers. <a href="https://github.com/ClickHouse/ClickHouse/pull/8961" target="_blank" rel="noopener noreferrer">#8961</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Better exception message while loading tables for <code>Ordinary</code> database. <a href="https://github.com/ClickHouse/ClickHouse/pull/9527" target="_blank" rel="noopener noreferrer">#9527</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Implement <code>arraySlice</code> for arrays with aggregate function states. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9388" target="_blank" rel="noopener noreferrer">#9388</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9391" target="_blank" rel="noopener noreferrer">#9391</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Allow constant functions and constant arrays to be used on the right side of IN operator. <a href="https://github.com/ClickHouse/ClickHouse/pull/8813" target="_blank" rel="noopener noreferrer">#8813</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>If zookeeper exception has happened while fetching data for system.replicas, display it in a separate column. This implements <a href="https://github.com/ClickHouse/ClickHouse/issues/9137" target="_blank" rel="noopener noreferrer">#9137</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9138" target="_blank" rel="noopener noreferrer">#9138</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Atomically remove MergeTree data parts on destroy. <a href="https://github.com/ClickHouse/ClickHouse/pull/8402" target="_blank" rel="noopener noreferrer">#8402</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Support row-level security for Distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/8926" target="_blank" rel="noopener noreferrer">#8926</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Now we recognize suffix (like KB, KiB...) in settings values. <a href="https://github.com/ClickHouse/ClickHouse/pull/8072" target="_blank" rel="noopener noreferrer">#8072</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>)</li><li>Prevent out of memory while constructing result of a large JOIN. <a href="https://github.com/ClickHouse/ClickHouse/pull/8637" target="_blank" rel="noopener noreferrer">#8637</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Added names of clusters to suggestions in interactive mode in <code>clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8709" target="_blank" rel="noopener noreferrer">#8709</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Initialize query profiler for all threads in a group, e.g. it allows to fully profile insert-queries <a href="https://github.com/ClickHouse/ClickHouse/pull/8820" target="_blank" rel="noopener noreferrer">#8820</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Added column <code>exception_code</code> in <code>system.query_log</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8770" target="_blank" rel="noopener noreferrer">#8770</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>)</li><li>Enabled MySQL compatibility server on port <code>9004</code> in the default server configuration file. Fixed password generation command in the example in configuration. <a href="https://github.com/ClickHouse/ClickHouse/pull/8771" target="_blank" rel="noopener noreferrer">#8771</a> (<a href="https://github.com/yurriy" target="_blank" rel="noopener noreferrer">Yuriy Baranov</a>)</li><li>Prevent abort on shutdown if the filesystem is readonly. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9094" target="_blank" rel="noopener noreferrer">#9094</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9100" target="_blank" rel="noopener noreferrer">#9100</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Better exception message when length is required in HTTP POST query. <a href="https://github.com/ClickHouse/ClickHouse/pull/9453" target="_blank" rel="noopener noreferrer">#9453</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add <code>_path</code> and <code>_file</code> virtual columns to <code>HDFS</code> and <code>File</code> engines and <code>hdfs</code> and <code>file</code> table functions <a href="https://github.com/ClickHouse/ClickHouse/pull/8489" target="_blank" rel="noopener noreferrer">#8489</a> (<a href="https://github.com/stavrolia" target="_blank" rel="noopener noreferrer">Olga Khvostikova</a>)</li><li>Fix error <code>Cannot find column</code> while inserting into <code>MATERIALIZED VIEW</code> in case if new column was added to view&#x27;s internal table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8766" target="_blank" rel="noopener noreferrer">#8766</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8788" target="_blank" rel="noopener noreferrer">#8788</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>) <a href="https://github.com/ClickHouse/ClickHouse/issues/8788" target="_blank" rel="noopener noreferrer">#8788</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8806" target="_blank" rel="noopener noreferrer">#8806</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8803" target="_blank" rel="noopener noreferrer">#8803</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix progress over native client-server protocol, by send progress after final update (like logs). This may be relevant only to some third-party tools that are using native protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/9495" target="_blank" rel="noopener noreferrer">#9495</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Add a system metric tracking the number of client connections using MySQL protocol (<a href="https://github.com/ClickHouse/ClickHouse/issues/9013" target="_blank" rel="noopener noreferrer">#9013</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9015" target="_blank" rel="noopener noreferrer">#9015</a> (<a href="https://github.com/Slach" target="_blank" rel="noopener noreferrer">Eugene Klimov</a>)</li><li>From now on, HTTP responses will have <code>X-ClickHouse-Timezone</code> header set to the same timezone value that <code>SELECT timezone()</code> would report. <a href="https://github.com/ClickHouse/ClickHouse/pull/9493" target="_blank" rel="noopener noreferrer">#9493</a> (<a href="https://github.com/traceon" target="_blank" rel="noopener noreferrer">Denis Glazachev</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-16">Performance Improvement<a class="hash-link" href="#performance-improvement-16" title="Direct link to heading">​</a></h4><ul><li>Improve performance of analysing index with IN <a href="https://github.com/ClickHouse/ClickHouse/pull/9261" target="_blank" rel="noopener noreferrer">#9261</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Simpler and more efficient code in Logical Functions + code cleanups. A followup to <a href="https://github.com/ClickHouse/ClickHouse/issues/8718" target="_blank" rel="noopener noreferrer">#8718</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8728" target="_blank" rel="noopener noreferrer">#8728</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Overall performance improvement (in range of 5%..200% for affected queries) by ensuring even more strict aliasing with C++20 features. <a href="https://github.com/ClickHouse/ClickHouse/pull/9304" target="_blank" rel="noopener noreferrer">#9304</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>More strict aliasing for inner loops of comparison functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9327" target="_blank" rel="noopener noreferrer">#9327</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>More strict aliasing for inner loops of arithmetic functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9325" target="_blank" rel="noopener noreferrer">#9325</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>A ~3 times faster implementation for ColumnVector::replicate(), via which ColumnConst::convertToFullColumn() is implemented. Also will be useful in tests when materializing constants. <a href="https://github.com/ClickHouse/ClickHouse/pull/9293" target="_blank" rel="noopener noreferrer">#9293</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Another minor performance improvement to <code>ColumnVector::replicate()</code> (this speeds up the <code>materialize</code> function and higher order functions) an even further improvement to <a href="https://github.com/ClickHouse/ClickHouse/issues/9293" target="_blank" rel="noopener noreferrer">#9293</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9442" target="_blank" rel="noopener noreferrer">#9442</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Improved performance of <code>stochasticLinearRegression</code> aggregate function. This patch is contributed by Intel. <a href="https://github.com/ClickHouse/ClickHouse/pull/8652" target="_blank" rel="noopener noreferrer">#8652</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Improve performance of <code>reinterpretAsFixedString</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/9342" target="_blank" rel="noopener noreferrer">#9342</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Do not send blocks to client for <code>Null</code> format in processors pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/8797" target="_blank" rel="noopener noreferrer">#8797</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8767" target="_blank" rel="noopener noreferrer">#8767</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-20">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-20" title="Direct link to heading">​</a></h4><ul><li>Exception handling now works correctly on Windows Subsystem for Linux. See <a href="https://github.com/ClickHouse-Extras/libunwind/pull/3" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse-Extras/libunwind/pull/3</a> This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6480" target="_blank" rel="noopener noreferrer">#6480</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9564" target="_blank" rel="noopener noreferrer">#9564</a> (<a href="https://github.com/sobolevsv" target="_blank" rel="noopener noreferrer">sobolevsv</a>)</li><li>Replace <code>readline</code> with <code>replxx</code> for interactive line editing in <code>clickhouse-client</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/8416" target="_blank" rel="noopener noreferrer">#8416</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Better build time and less template instantiations in FunctionsComparison. <a href="https://github.com/ClickHouse/ClickHouse/pull/9324" target="_blank" rel="noopener noreferrer">#9324</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added integration with <code>clang-tidy</code> in CI. See also <a href="https://github.com/ClickHouse/ClickHouse/issues/6044" target="_blank" rel="noopener noreferrer">#6044</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9566" target="_blank" rel="noopener noreferrer">#9566</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Now we link ClickHouse in CI using <code>lld</code> even for <code>gcc</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9049" target="_blank" rel="noopener noreferrer">#9049</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Allow to randomize thread scheduling and insert glitches when <code>THREAD_FUZZER_*</code> environment variables are set. This helps testing. <a href="https://github.com/ClickHouse/ClickHouse/pull/9459" target="_blank" rel="noopener noreferrer">#9459</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Enable secure sockets in stateless tests <a href="https://github.com/ClickHouse/ClickHouse/pull/9288" target="_blank" rel="noopener noreferrer">#9288</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Make SPLIT_SHARED_LIBRARIES=OFF more robust <a href="https://github.com/ClickHouse/ClickHouse/pull/9156" target="_blank" rel="noopener noreferrer">#9156</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Make &quot;performance_introspection_and_logging&quot; test reliable to random server stuck. This may happen in CI environment. See also <a href="https://github.com/ClickHouse/ClickHouse/issues/9515" target="_blank" rel="noopener noreferrer">#9515</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9528" target="_blank" rel="noopener noreferrer">#9528</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Validate XML in style check. <a href="https://github.com/ClickHouse/ClickHouse/pull/9550" target="_blank" rel="noopener noreferrer">#9550</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed race condition in test <code>00738_lock_for_inner_table</code>. This test relied on sleep. <a href="https://github.com/ClickHouse/ClickHouse/pull/9555" target="_blank" rel="noopener noreferrer">#9555</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Remove performance tests of type <code>once</code>. This is needed to run all performance tests in statistical comparison mode (more reliable). <a href="https://github.com/ClickHouse/ClickHouse/pull/9557" target="_blank" rel="noopener noreferrer">#9557</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added performance test for arithmetic functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/9326" target="_blank" rel="noopener noreferrer">#9326</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added performance test for <code>sumMap</code> and <code>sumMapWithOverflow</code> aggregate functions. Follow-up for <a href="https://github.com/ClickHouse/ClickHouse/issues/8933" target="_blank" rel="noopener noreferrer">#8933</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8947" target="_blank" rel="noopener noreferrer">#8947</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Ensure style of ErrorCodes by style check. <a href="https://github.com/ClickHouse/ClickHouse/pull/9370" target="_blank" rel="noopener noreferrer">#9370</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add script for tests history. <a href="https://github.com/ClickHouse/ClickHouse/pull/8796" target="_blank" rel="noopener noreferrer">#8796</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Add GCC warning <code>-Wsuggest-override</code> to locate and fix all places where <code>override</code> keyword must be used. <a href="https://github.com/ClickHouse/ClickHouse/pull/8760" target="_blank" rel="noopener noreferrer">#8760</a> (<a href="https://github.com/kreuzerkrieg" target="_blank" rel="noopener noreferrer">kreuzerkrieg</a>)</li><li>Ignore weak symbol under Mac OS X because it must be defined <a href="https://github.com/ClickHouse/ClickHouse/pull/9538" target="_blank" rel="noopener noreferrer">#9538</a> (<a href="https://github.com/ghost" target="_blank" rel="noopener noreferrer">Deleted user</a>)</li><li>Normalize running time of some queries in performance tests. This is done in preparation to run all the performance tests in comparison mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/9565" target="_blank" rel="noopener noreferrer">#9565</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix some tests to support pytest with query tests <a href="https://github.com/ClickHouse/ClickHouse/pull/9062" target="_blank" rel="noopener noreferrer">#9062</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Enable SSL in build with MSan, so server will not fail at startup when running stateless tests <a href="https://github.com/ClickHouse/ClickHouse/pull/9531" target="_blank" rel="noopener noreferrer">#9531</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix database substitution in test results <a href="https://github.com/ClickHouse/ClickHouse/pull/9384" target="_blank" rel="noopener noreferrer">#9384</a> (<a href="https://github.com/qoega" target="_blank" rel="noopener noreferrer">Ilya Yatsishin</a>)</li><li>Build fixes for miscellaneous platforms <a href="https://github.com/ClickHouse/ClickHouse/pull/9381" target="_blank" rel="noopener noreferrer">#9381</a> (<a href="https://github.com/proller" target="_blank" rel="noopener noreferrer">proller</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8755" target="_blank" rel="noopener noreferrer">#8755</a> (<a href="https://github.com/proller" target="_blank" rel="noopener noreferrer">proller</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8631" target="_blank" rel="noopener noreferrer">#8631</a> (<a href="https://github.com/proller" target="_blank" rel="noopener noreferrer">proller</a>)</li><li>Added disks section to stateless-with-coverage test docker image <a href="https://github.com/ClickHouse/ClickHouse/pull/9213" target="_blank" rel="noopener noreferrer">#9213</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>)</li><li>Get rid of in-source-tree files when building with GRPC <a href="https://github.com/ClickHouse/ClickHouse/pull/9588" target="_blank" rel="noopener noreferrer">#9588</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Slightly faster build time by removing SessionCleaner from Context. Make the code of SessionCleaner more simple. <a href="https://github.com/ClickHouse/ClickHouse/pull/9232" target="_blank" rel="noopener noreferrer">#9232</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Updated checking for hung queries in clickhouse-test script <a href="https://github.com/ClickHouse/ClickHouse/pull/8858" target="_blank" rel="noopener noreferrer">#8858</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Removed some useless files from repository. <a href="https://github.com/ClickHouse/ClickHouse/pull/8843" target="_blank" rel="noopener noreferrer">#8843</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Changed type of math perftests from <code>once</code> to <code>loop</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8783" target="_blank" rel="noopener noreferrer">#8783</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Add docker image which allows to build interactive code browser HTML report for our codebase. <a href="https://github.com/ClickHouse/ClickHouse/pull/8781" target="_blank" rel="noopener noreferrer">#8781</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>) See <a href="https://clickhouse-test-reports.s3.yandex.net/codebrowser/ClickHouse/dbms/index.html" target="_blank" rel="noopener noreferrer">Woboq Code Browser</a></li><li>Suppress some test failures under MSan. <a href="https://github.com/ClickHouse/ClickHouse/pull/8780" target="_blank" rel="noopener noreferrer">#8780</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Speedup &quot;exception while insert&quot; test. This test often time out in debug-with-coverage build. <a href="https://github.com/ClickHouse/ClickHouse/pull/8711" target="_blank" rel="noopener noreferrer">#8711</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Updated <code>libcxx</code> and <code>libcxxabi</code> to master. In preparation to <a href="https://github.com/ClickHouse/ClickHouse/issues/9304" target="_blank" rel="noopener noreferrer">#9304</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9308" target="_blank" rel="noopener noreferrer">#9308</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix flacky test <code>00910_zookeeper_test_alter_compression_codecs</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9525" target="_blank" rel="noopener noreferrer">#9525</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Clean up duplicated linker flags. Make sure the linker won&#x27;t look up an unexpected symbol. <a href="https://github.com/ClickHouse/ClickHouse/pull/9433" target="_blank" rel="noopener noreferrer">#9433</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Add <code>clickhouse-odbc</code> driver into test images. This allows to test interaction of ClickHouse with ClickHouse via its own ODBC driver. <a href="https://github.com/ClickHouse/ClickHouse/pull/9348" target="_blank" rel="noopener noreferrer">#9348</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Fix several bugs in unit tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/9047" target="_blank" rel="noopener noreferrer">#9047</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Enable <code>-Wmissing-include-dirs</code> GCC warning to eliminate all non-existing includes - mostly as a result of CMake scripting errors <a href="https://github.com/ClickHouse/ClickHouse/pull/8704" target="_blank" rel="noopener noreferrer">#8704</a> (<a href="https://github.com/kreuzerkrieg" target="_blank" rel="noopener noreferrer">kreuzerkrieg</a>)</li><li>Describe reasons if query profiler cannot work. This is intended for <a href="https://github.com/ClickHouse/ClickHouse/issues/9049" target="_blank" rel="noopener noreferrer">#9049</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9144" target="_blank" rel="noopener noreferrer">#9144</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Update OpenSSL to upstream master. Fixed the issue when TLS connections may fail with the message <code>OpenSSL SSL_read: error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error</code> and <code>SSL Exception: error:2400006E:random number generator::error retrieving entropy</code>. The issue was present in version 20.1. <a href="https://github.com/ClickHouse/ClickHouse/pull/8956" target="_blank" rel="noopener noreferrer">#8956</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Update Dockerfile for server <a href="https://github.com/ClickHouse/ClickHouse/pull/8893" target="_blank" rel="noopener noreferrer">#8893</a> (<a href="https://github.com/ne-ray" target="_blank" rel="noopener noreferrer">Ilya Mazaev</a>)</li><li>Minor fixes in build-gcc-from-sources script <a href="https://github.com/ClickHouse/ClickHouse/pull/8774" target="_blank" rel="noopener noreferrer">#8774</a> (<a href="https://github.com/mnach" target="_blank" rel="noopener noreferrer">Michael Nacharov</a>)</li><li>Replace <code>numbers</code> to <code>zeros</code> in perftests where <code>number</code> column is not used. This will lead to more clean test results. <a href="https://github.com/ClickHouse/ClickHouse/pull/9600" target="_blank" rel="noopener noreferrer">#9600</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix stack overflow issue when using initializer_list in Column constructors. <a href="https://github.com/ClickHouse/ClickHouse/pull/9367" target="_blank" rel="noopener noreferrer">#9367</a> (<a href="https://github.com/ghost" target="_blank" rel="noopener noreferrer">Deleted user</a>)</li><li>Upgrade librdkafka to v1.3.0. Enable bundled <code>rdkafka</code> and <code>gsasl</code> libraries on Mac OS X. <a href="https://github.com/ClickHouse/ClickHouse/pull/9000" target="_blank" rel="noopener noreferrer">#9000</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>)</li><li>build fix on GCC 9.2.0 <a href="https://github.com/ClickHouse/ClickHouse/pull/9306" target="_blank" rel="noopener noreferrer">#9306</a> (<a href="https://github.com/Vxider" target="_blank" rel="noopener noreferrer">vxider</a>)</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201">ClickHouse release v20.1<a class="hash-link" href="#clickhouse-release-v201" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20116120-stable-2020-60-26">ClickHouse release v20.1.16.120-stable 2020-60-26<a class="hash-link" href="#clickhouse-release-v20116120-stable-2020-60-26" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-50">Bug Fix<a class="hash-link" href="#bug-fix-50" title="Direct link to heading">​</a></h4><ul><li>Fix rare crash caused by using <code>Nullable</code> column in prewhere condition. Continuation of <a href="https://github.com/ClickHouse/ClickHouse/issues/11608" target="_blank" rel="noopener noreferrer">#11608</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11869" target="_blank" rel="noopener noreferrer">#11869</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Don&#x27;t allow arrayJoin inside higher order functions. It was leading to broken protocol synchronization. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/3933" target="_blank" rel="noopener noreferrer">#3933</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11846" target="_blank" rel="noopener noreferrer">#11846</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix unexpected behaviour of queries like <code>SELECT *, xyz.*</code> which were success while an error expected. <a href="https://github.com/ClickHouse/ClickHouse/pull/11753" target="_blank" rel="noopener noreferrer">#11753</a> (<a href="https://github.com/hexiaoting" target="_blank" rel="noopener noreferrer">hexiaoting</a>).</li><li>Fixed LOGICAL_ERROR caused by wrong type deduction of complex literals in Values input format. <a href="https://github.com/ClickHouse/ClickHouse/pull/11732" target="_blank" rel="noopener noreferrer">#11732</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix <code>ORDER BY ... WITH FILL</code> over const columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/11697" target="_blank" rel="noopener noreferrer">#11697</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Pass proper timeouts when communicating with XDBC bridge. Recently timeouts were not respected when checking bridge liveness and receiving meta info. <a href="https://github.com/ClickHouse/ClickHouse/pull/11690" target="_blank" rel="noopener noreferrer">#11690</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add support for regular expressions with case-insensitive flags. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11101" target="_blank" rel="noopener noreferrer">#11101</a> and fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11506" target="_blank" rel="noopener noreferrer">#11506</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11649" target="_blank" rel="noopener noreferrer">#11649</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bloom filters for String (data skipping indices). <a href="https://github.com/ClickHouse/ClickHouse/pull/11638" target="_blank" rel="noopener noreferrer">#11638</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix rare crash caused by using <code>Nullable</code> column in prewhere condition. (Probably it is connected with <a href="https://github.com/ClickHouse/ClickHouse/issues/11572" target="_blank" rel="noopener noreferrer">#11572</a> somehow). <a href="https://github.com/ClickHouse/ClickHouse/pull/11608" target="_blank" rel="noopener noreferrer">#11608</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix wrong exit code of the clickhouse-client, when exception.code() % 256 = 0. <a href="https://github.com/ClickHouse/ClickHouse/pull/11601" target="_blank" rel="noopener noreferrer">#11601</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Fix trivial error in log message about &quot;Mark cache size was lowered&quot; at server startup. This closes <a href="https://github.com/ClickHouse/ClickHouse/issues/11399" target="_blank" rel="noopener noreferrer">#11399</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11589" target="_blank" rel="noopener noreferrer">#11589</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Now clickhouse-server docker container will prefer IPv6 checking server aliveness. <a href="https://github.com/ClickHouse/ClickHouse/pull/11550" target="_blank" rel="noopener noreferrer">#11550</a> (<a href="https://github.com/istarkov" target="_blank" rel="noopener noreferrer">Ivan Starkov</a>).</li><li>Fix memory leak when exception is thrown in the middle of aggregation with -State functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8995" target="_blank" rel="noopener noreferrer">#8995</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11496" target="_blank" rel="noopener noreferrer">#11496</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix usage of primary key wrapped into a function with &#x27;FINAL&#x27; modifier and &#x27;ORDER BY&#x27; optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/10715" target="_blank" rel="noopener noreferrer">#10715</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20115109-stable-2020-06-19">ClickHouse release v20.1.15.109-stable 2020-06-19<a class="hash-link" href="#clickhouse-release-v20115109-stable-2020-06-19" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-51">Bug Fix<a class="hash-link" href="#bug-fix-51" title="Direct link to heading">​</a></h4><ul><li>Fix excess lock for structure during alter. <a href="https://github.com/ClickHouse/ClickHouse/pull/11790" target="_blank" rel="noopener noreferrer">#11790</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20114107-stable-2020-06-11">ClickHouse release v20.1.14.107-stable 2020-06-11<a class="hash-link" href="#clickhouse-release-v20114107-stable-2020-06-11" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-52">Bug Fix<a class="hash-link" href="#bug-fix-52" title="Direct link to heading">​</a></h4><ul><li>Fix error <code>Size of offsets does not match size of column</code> for queries with <code>PREWHERE column in (subquery)</code> and <code>ARRAY JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11580" target="_blank" rel="noopener noreferrer">#11580</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20113105-stable-2020-06-10">ClickHouse release v20.1.13.105-stable 2020-06-10<a class="hash-link" href="#clickhouse-release-v20113105-stable-2020-06-10" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-53">Bug Fix<a class="hash-link" href="#bug-fix-53" title="Direct link to heading">​</a></h4><ul><li>Fix the error <code>Data compressed with different methods</code> that can happen if <code>min_bytes_to_use_direct_io</code> is enabled and PREWHERE is active and using SAMPLE or high number of threads. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11539" target="_blank" rel="noopener noreferrer">#11539</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11540" target="_blank" rel="noopener noreferrer">#11540</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix return compressed size for codecs. <a href="https://github.com/ClickHouse/ClickHouse/pull/11448" target="_blank" rel="noopener noreferrer">#11448</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix server crash when a column has compression codec with non-literal arguments. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11365" target="_blank" rel="noopener noreferrer">#11365</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11431" target="_blank" rel="noopener noreferrer">#11431</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix pointInPolygon with nan as point. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11375" target="_blank" rel="noopener noreferrer">#11375</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11421" target="_blank" rel="noopener noreferrer">#11421</a> (<a href="https://github.com/livace" target="_blank" rel="noopener noreferrer">Alexey Ilyukhov</a>).</li><li>Fixed geohashesInBox with arguments outside of latitude/longitude range. <a href="https://github.com/ClickHouse/ClickHouse/pull/11403" target="_blank" rel="noopener noreferrer">#11403</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fix possible <code>Pipeline stuck</code> error for queries with external sort and limit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11359" target="_blank" rel="noopener noreferrer">#11359</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11366" target="_blank" rel="noopener noreferrer">#11366</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix crash in <code>quantilesExactWeightedArray</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11337" target="_blank" rel="noopener noreferrer">#11337</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Make writing to <code>MATERIALIZED VIEW</code> with setting <code>parallel_view_processing = 1</code> parallel again. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" target="_blank" rel="noopener noreferrer">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11330" target="_blank" rel="noopener noreferrer">#11330</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix visitParamExtractRaw when extracted JSON has strings with unbalanced { or [. <a href="https://github.com/ClickHouse/ClickHouse/pull/11318" target="_blank" rel="noopener noreferrer">#11318</a> (<a href="https://github.com/devwout" target="_blank" rel="noopener noreferrer">Ewout</a>).</li><li>Fix very rare race condition in ThreadPool. <a href="https://github.com/ClickHouse/ClickHouse/pull/11314" target="_blank" rel="noopener noreferrer">#11314</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix potential uninitialized memory in conversion. Example: <code>SELECT toIntervalSecond(now64())</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11311" target="_blank" rel="noopener noreferrer">#11311</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix the issue when index analysis cannot work if a table has Array column in primary key and if a query is filtering by this column with <code>empty</code> or <code>notEmpty</code> functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11286" target="_blank" rel="noopener noreferrer">#11286</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11303" target="_blank" rel="noopener noreferrer">#11303</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix bug when query speed estimation can be incorrect and the limit of <code>min_execution_speed</code> may not work or work incorrectly if the query is throttled by <code>max_network_bandwidth</code>, <code>max_execution_speed</code> or <code>priority</code> settings. Change the default value of <code>timeout_before_checking_execution_speed</code> to non-zero, because otherwise the settings <code>min_execution_speed</code> and <code>max_execution_speed</code> have no effect. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11297" target="_blank" rel="noopener noreferrer">#11297</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5732" target="_blank" rel="noopener noreferrer">#5732</a>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6228" target="_blank" rel="noopener noreferrer">#6228</a>. Usability improvement: avoid concatenation of exception message with progress bar in <code>clickhouse-client</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11296" target="_blank" rel="noopener noreferrer">#11296</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix crash while reading malformed data in Protobuf format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5957" target="_blank" rel="noopener noreferrer">#5957</a>, fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/11203" target="_blank" rel="noopener noreferrer">#11203</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11258" target="_blank" rel="noopener noreferrer">#11258</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix possible error <code>Cannot capture column</code> for higher-order functions with <code>Array(Array(LowCardinality))</code> captured argument. <a href="https://github.com/ClickHouse/ClickHouse/pull/11185" target="_blank" rel="noopener noreferrer">#11185</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>If data skipping index is dependent on columns that are going to be modified during background merge (for SummingMergeTree, AggregatingMergeTree as well as for TTL GROUP BY), it was calculated incorrectly. This issue is fixed by moving index calculation after merge so the index is calculated on merged data. <a href="https://github.com/ClickHouse/ClickHouse/pull/11162" target="_blank" rel="noopener noreferrer">#11162</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Remove logging from mutation finalization task if nothing was finalized. <a href="https://github.com/ClickHouse/ClickHouse/pull/11109" target="_blank" rel="noopener noreferrer">#11109</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed parseDateTime64BestEffort argument resolution bugs. <a href="https://github.com/ClickHouse/ClickHouse/issues/10925" target="_blank" rel="noopener noreferrer">#10925</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/11038" target="_blank" rel="noopener noreferrer">#11038</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li><li>Fix incorrect raw data size in method getRawData(). <a href="https://github.com/ClickHouse/ClickHouse/pull/10964" target="_blank" rel="noopener noreferrer">#10964</a> (<a href="https://github.com/ObjatieGroba" target="_blank" rel="noopener noreferrer">Igr</a>).</li><li>Fix backward compatibility with tuples in Distributed tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10889" target="_blank" rel="noopener noreferrer">#10889</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix SIGSEGV in StringHashTable (if such key does not exist). <a href="https://github.com/ClickHouse/ClickHouse/pull/10870" target="_blank" rel="noopener noreferrer">#10870</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed bug in <code>ReplicatedMergeTree</code> which might cause some <code>ALTER</code> on <code>OPTIMIZE</code> query to hang waiting for some replica after it become inactive. <a href="https://github.com/ClickHouse/ClickHouse/pull/10849" target="_blank" rel="noopener noreferrer">#10849</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fix columns order after Block::sortColumns() (also add a test that shows that it affects some real use case - Buffer engine). <a href="https://github.com/ClickHouse/ClickHouse/pull/10826" target="_blank" rel="noopener noreferrer">#10826</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix the issue with ODBC bridge when no quoting of identifiers is requested. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7984" target="_blank" rel="noopener noreferrer">#7984</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10821" target="_blank" rel="noopener noreferrer">#10821</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix UBSan and MSan report in DateLUT. <a href="https://github.com/ClickHouse/ClickHouse/pull/10798" target="_blank" rel="noopener noreferrer">#10798</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li><ul><li>Make use of <code>src_type</code> for correct type conversion in key conditions. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6287" target="_blank" rel="noopener noreferrer">#6287</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10791" target="_blank" rel="noopener noreferrer">#10791</a> (<a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">Andrew Onyshchuk</a>).</li></ul></li><li>Fix <code>parallel_view_processing</code> behavior. Now all insertions into <code>MATERIALIZED VIEW</code> without exception should be finished if exception happened. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10241" target="_blank" rel="noopener noreferrer">#10241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10757" target="_blank" rel="noopener noreferrer">#10757</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix combinator -OrNull and -OrDefault when combined with -State. <a href="https://github.com/ClickHouse/ClickHouse/pull/10741" target="_blank" rel="noopener noreferrer">#10741</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Fix disappearing totals. Totals could have being filtered if query had had join or subquery with external where condition. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10674" target="_blank" rel="noopener noreferrer">#10674</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10698" target="_blank" rel="noopener noreferrer">#10698</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix multiple usages of <code>IN</code> operator with the identical set in one query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10686" target="_blank" rel="noopener noreferrer">#10686</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>).</li><li>Fix order of parameters in AggregateTransform constructor. <a href="https://github.com/ClickHouse/ClickHouse/pull/10667" target="_blank" rel="noopener noreferrer">#10667</a> (<a href="https://github.com/palasonic1" target="_blank" rel="noopener noreferrer">palasonic1</a>).</li><li>Fix the lack of parallel execution of remote queries with <code>distributed_aggregation_memory_efficient</code> enabled. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10655" target="_blank" rel="noopener noreferrer">#10655</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10664" target="_blank" rel="noopener noreferrer">#10664</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix predicates optimization for distributed queries (<code>enable_optimize_predicate_expression=1</code>) for queries with <code>HAVING</code> section (i.e. when filtering on the server initiator is required), by preserving the order of expressions (and this is enough to fix), and also force aggregator use column names over indexes. Fixes: <a href="https://github.com/ClickHouse/ClickHouse/issues/10613" target="_blank" rel="noopener noreferrer">#10613</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/11413" target="_blank" rel="noopener noreferrer">#11413</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10621" target="_blank" rel="noopener noreferrer">#10621</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix error <code>the BloomFilter false positive must be a double number between 0 and 1</code> <a href="https://github.com/ClickHouse/ClickHouse/issues/10551" target="_blank" rel="noopener noreferrer">#10551</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10569" target="_blank" rel="noopener noreferrer">#10569</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix SELECT of column ALIAS which default expression type different from column type. <a href="https://github.com/ClickHouse/ClickHouse/pull/10563" target="_blank" rel="noopener noreferrer">#10563</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li><ul><li>Implemented comparison between DateTime64 and String values (just like for DateTime). <a href="https://github.com/ClickHouse/ClickHouse/pull/10560" target="_blank" rel="noopener noreferrer">#10560</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2011286-2020-05-26">ClickHouse release v20.1.12.86, 2020-05-26<a class="hash-link" href="#clickhouse-release-v2011286-2020-05-26" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-54">Bug Fix<a class="hash-link" href="#bug-fix-54" title="Direct link to heading">​</a></h4><ul><li>Fixed incompatibility of two-level aggregation between versions 20.1 and earlier. This incompatibility happens when different versions of ClickHouse are used on initiator node and remote nodes and the size of GROUP BY result is large and aggregation is performed by a single String field. It leads to several unmerged rows for a single key in result. <a href="https://github.com/ClickHouse/ClickHouse/pull/10952" target="_blank" rel="noopener noreferrer">#10952</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed data corruption for <code>LowCardinality(FixedString)</code> key column in <code>SummingMergeTree</code> which could have happened after merge. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10489" target="_blank" rel="noopener noreferrer">#10489</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10721" target="_blank" rel="noopener noreferrer">#10721</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed bug, which causes http requests stuck on client close when <code>readonly=2</code> and <code>cancel_http_readonly_queries_on_client_close=1</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7939" target="_blank" rel="noopener noreferrer">#7939</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7019" target="_blank" rel="noopener noreferrer">#7019</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7736" target="_blank" rel="noopener noreferrer">#7736</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7091" target="_blank" rel="noopener noreferrer">#7091</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10684" target="_blank" rel="noopener noreferrer">#10684</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed a bug when on <code>SYSTEM DROP DNS CACHE</code> query also drop caches, which are used to check if user is allowed to connect from some IP addresses. <a href="https://github.com/ClickHouse/ClickHouse/pull/10608" target="_blank" rel="noopener noreferrer">#10608</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>).</li><li>Fixed incorrect scalar results inside inner query of <code>MATERIALIZED VIEW</code> in case if this query contained dependent table. <a href="https://github.com/ClickHouse/ClickHouse/pull/10603" target="_blank" rel="noopener noreferrer">#10603</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed the situation when mutation finished all parts, but hung up in <code>is_done=0</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10526" target="_blank" rel="noopener noreferrer">#10526</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed overflow at beginning of unix epoch for timezones with fractional offset from UTC. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9335" target="_blank" rel="noopener noreferrer">#9335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10513" target="_blank" rel="noopener noreferrer">#10513</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed improper shutdown of Distributed storage. <a href="https://github.com/ClickHouse/ClickHouse/pull/10491" target="_blank" rel="noopener noreferrer">#10491</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed numeric overflow in <code>simpleLinearRegression</code> over large integers. <a href="https://github.com/ClickHouse/ClickHouse/pull/10474" target="_blank" rel="noopener noreferrer">#10474</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>).</li><li>Fixed removing metadata directory when attach database fails. <a href="https://github.com/ClickHouse/ClickHouse/pull/10442" target="_blank" rel="noopener noreferrer">#10442</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Added a check of number and type of arguments when creating <code>BloomFilter</code> index <a href="https://github.com/ClickHouse/ClickHouse/issues/9623" target="_blank" rel="noopener noreferrer">#9623</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10431" target="_blank" rel="noopener noreferrer">#10431</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fixed the issue when a query with <code>ARRAY JOIN</code>, <code>ORDER BY</code> and <code>LIMIT</code> may return incomplete result. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10226" target="_blank" rel="noopener noreferrer">#10226</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10427" target="_blank" rel="noopener noreferrer">#10427</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Prefer <code>fallback_to_stale_replicas</code> over <code>skip_unavailable_shards</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10422" target="_blank" rel="noopener noreferrer">#10422</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed wrong flattening of <code>Array(Tuple(...))</code> data types. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10259" target="_blank" rel="noopener noreferrer">#10259</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10390" target="_blank" rel="noopener noreferrer">#10390</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fixed wrong behavior in <code>HashTable</code> that caused compilation error when trying to read HashMap from buffer. <a href="https://github.com/ClickHouse/ClickHouse/pull/10386" target="_blank" rel="noopener noreferrer">#10386</a> (<a href="https://github.com/palasonic1" target="_blank" rel="noopener noreferrer">palasonic1</a>).</li><li>Fixed possible <code>Pipeline stuck</code> error in <code>ConcatProcessor</code> which could have happened in remote query. <a href="https://github.com/ClickHouse/ClickHouse/pull/10381" target="_blank" rel="noopener noreferrer">#10381</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed error <code>Pipeline stuck</code> with <code>max_rows_to_group_by</code> and <code>group_by_overflow_mode = &#x27;break&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10279" target="_blank" rel="noopener noreferrer">#10279</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed several bugs when some data was inserted with quorum, then deleted somehow (DROP PARTITION, TTL) and this leaded to the stuck of INSERTs or false-positive exceptions in SELECTs. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9946" target="_blank" rel="noopener noreferrer">#9946</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10188" target="_blank" rel="noopener noreferrer">#10188</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>).</li><li>Fixed incompatibility when versions prior to 18.12.17 are used on remote servers and newer is used on initiating server, and GROUP BY both fixed and non-fixed keys, and when two-level group by method is activated. <a href="https://github.com/ClickHouse/ClickHouse/pull/3254" target="_blank" rel="noopener noreferrer">#3254</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-21">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-21" title="Direct link to heading">​</a></h4><ul><li>Added CA certificates to clickhouse-server docker image. <a href="https://github.com/ClickHouse/ClickHouse/pull/10476" target="_blank" rel="noopener noreferrer">#10476</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v2011070-2020-04-17">ClickHouse release v20.1.10.70, 2020-04-17<a class="hash-link" href="#clickhouse-release-v2011070-2020-04-17" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-55">Bug Fix<a class="hash-link" href="#bug-fix-55" title="Direct link to heading">​</a></h4><ul><li>Fix rare possible exception <code>Cannot drain connections: cancel first</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10239" target="_blank" rel="noopener noreferrer">#10239</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fixed bug where ClickHouse would throw <code>&#x27;Unknown function lambda.&#x27;</code> error message when user tries to run <code>ALTER UPDATE/DELETE</code> on tables with <code>ENGINE = Replicated*</code>. Check for nondeterministic functions now handles lambda expressions correctly. <a href="https://github.com/ClickHouse/ClickHouse/pull/10237" target="_blank" rel="noopener noreferrer">#10237</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>).</li><li>Fix <code>parseDateTimeBestEffort</code> for strings in RFC-2822 when day of week is Tuesday or Thursday. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10082" target="_blank" rel="noopener noreferrer">#10082</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10214" target="_blank" rel="noopener noreferrer">#10214</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix column names of constants inside <code>JOIN</code> that may clash with names of constants outside of <code>JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10207" target="_blank" rel="noopener noreferrer">#10207</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Fix possible inifinite query execution when the query actually should stop on LIMIT, while reading from infinite source like <code>system.numbers</code> or <code>system.zeros</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10206" target="_blank" rel="noopener noreferrer">#10206</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix move-to-prewhere optimization in presense of <code>arrayJoin</code> functions (in certain cases). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/10092" target="_blank" rel="noopener noreferrer">#10092</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10195" target="_blank" rel="noopener noreferrer">#10195</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>).</li><li>Add the ability to relax the restriction on non-deterministic functions usage in mutations with <code>allow_nondeterministic_mutations</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/10186" target="_blank" rel="noopener noreferrer">#10186</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>).</li><li>Convert blocks if structure does not match on <code>INSERT</code> into table with <code>Distributed</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10135" target="_blank" rel="noopener noreferrer">#10135</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix <code>SIGSEGV</code> on <code>INSERT</code> into <code>Distributed</code> table when its structure differs from the underlying tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/10105" target="_blank" rel="noopener noreferrer">#10105</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fix possible rows loss for queries with <code>JOIN</code> and <code>UNION ALL</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9826" target="_blank" rel="noopener noreferrer">#9826</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/10113" target="_blank" rel="noopener noreferrer">#10113</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/10099" target="_blank" rel="noopener noreferrer">#10099</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Add arguments check and support identifier arguments for MySQL Database Engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/10077" target="_blank" rel="noopener noreferrer">#10077</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>).</li><li>Fix bug in clickhouse dictionary source from localhost clickhouse server. The bug may lead to memory corruption if types in dictionary and source are not compatible. <a href="https://github.com/ClickHouse/ClickHouse/pull/10071" target="_blank" rel="noopener noreferrer">#10071</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fix error <code>Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. It happened when setting <code>distributed_aggregation_memory_efficient</code> was enabled, and distributed query read aggregating data with different level from different shards (mixed single and two level aggregation). <a href="https://github.com/ClickHouse/ClickHouse/pull/10063" target="_blank" rel="noopener noreferrer">#10063</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix a segmentation fault that could occur in <code>GROUP BY</code> over string keys containing trailing zero bytes (<a href="https://github.com/ClickHouse/ClickHouse/issues/8636" target="_blank" rel="noopener noreferrer">#8636</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/8925" target="_blank" rel="noopener noreferrer">#8925</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/10025" target="_blank" rel="noopener noreferrer">#10025</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>).</li><li>Fix bug in which the necessary tables weren&#x27;t retrieved at one of the processing stages of queries to some databases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9699" target="_blank" rel="noopener noreferrer">#9699</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9949" target="_blank" rel="noopener noreferrer">#9949</a> (<a href="https://github.com/achulkov2" target="_blank" rel="noopener noreferrer">achulkov2</a>).</li><li>Fix <code>&#x27;Not found column in block&#x27;</code> error when <code>JOIN</code> appears with <code>TOTALS</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9839" target="_blank" rel="noopener noreferrer">#9839</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9939" target="_blank" rel="noopener noreferrer">#9939</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix a bug with <code>ON CLUSTER</code> DDL queries freezing on server startup. <a href="https://github.com/ClickHouse/ClickHouse/pull/9927" target="_blank" rel="noopener noreferrer">#9927</a> (<a href="https://github.com/garneja" target="_blank" rel="noopener noreferrer">Gagan Arneja</a>).</li><li>Fix <code>TRUNCATE</code> for Join table engine (<a href="https://github.com/ClickHouse/ClickHouse/issues/9917" target="_blank" rel="noopener noreferrer">#9917</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9920" target="_blank" rel="noopener noreferrer">#9920</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix <code>&#x27;scalar does not exist&#x27;</code> error in ALTER queries (<a href="https://github.com/ClickHouse/ClickHouse/issues/9878" target="_blank" rel="noopener noreferrer">#9878</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/9904" target="_blank" rel="noopener noreferrer">#9904</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li><li>Fix race condition between drop and optimize in <code>ReplicatedMergeTree</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9901" target="_blank" rel="noopener noreferrer">#9901</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>Fixed <code>DeleteOnDestroy</code> logic in <code>ATTACH PART</code> which could lead to automatic removal of attached part and added few tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/9410" target="_blank" rel="noopener noreferrer">#9410</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-22">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-22" title="Direct link to heading">​</a></h4><ul><li>Fix unit test <code>collapsing_sorted_stream</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9367" target="_blank" rel="noopener noreferrer">#9367</a> (<a href="https://github.com/ghost" target="_blank" rel="noopener noreferrer">Deleted user</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201954-2020-03-28">ClickHouse release v20.1.9.54, 2020-03-28<a class="hash-link" href="#clickhouse-release-v201954-2020-03-28" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-56">Bug Fix<a class="hash-link" href="#bug-fix-56" title="Direct link to heading">​</a></h4><ul><li>Fix <code>&#x27;Different expressions with the same alias&#x27;</code> error when query has <code>PREWHERE</code> and <code>WHERE</code> on distributed table and <code>SET distributed_product_mode = &#x27;local&#x27;</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9871" target="_blank" rel="noopener noreferrer">#9871</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>).</li><li>Fix mutations excessive memory consumption for tables with a composite primary key. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9850" target="_blank" rel="noopener noreferrer">#9850</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9860" target="_blank" rel="noopener noreferrer">#9860</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li><li>For INSERT queries shard now clamps the settings got from the initiator to the shard&#x27;s constaints instead of throwing an exception. This fix allows to send <code>INSERT</code> queries to a shard with another constraints. This change improves fix <a href="https://github.com/ClickHouse/ClickHouse/issues/9447" target="_blank" rel="noopener noreferrer">#9447</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9852" target="_blank" rel="noopener noreferrer">#9852</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>).</li><li>Fix possible exception <code>Got 0 in totals chunk, expected 1</code> on client. It happened for queries with <code>JOIN</code> in case if right joined table had zero rows. Example: <code>select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9777" target="_blank" rel="noopener noreferrer">#9777</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9823" target="_blank" rel="noopener noreferrer">#9823</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>).</li><li>Fix <code>SIGSEGV</code> with <code>optimize_skip_unused_shards</code> when type cannot be converted. <a href="https://github.com/ClickHouse/ClickHouse/pull/9804" target="_blank" rel="noopener noreferrer">#9804</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>).</li><li>Fixed a few cases when timezone of the function argument wasn&#x27;t used properly. <a href="https://github.com/ClickHouse/ClickHouse/pull/9574" target="_blank" rel="noopener noreferrer">#9574</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-21">Improvement<a class="hash-link" href="#improvement-21" title="Direct link to heading">​</a></h4><ul><li>Remove <code>ORDER BY</code> stage from mutations because we read from a single ordered part in a single thread. Also add check that the order of rows in mutation is ordered in sorting key order and this order is not violated. <a href="https://github.com/ClickHouse/ClickHouse/pull/9886" target="_blank" rel="noopener noreferrer">#9886</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>).</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-23">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-23" title="Direct link to heading">​</a></h4><ul><li>Clean up duplicated linker flags. Make sure the linker won&#x27;t look up an unexpected symbol. <a href="https://github.com/ClickHouse/ClickHouse/pull/9433" target="_blank" rel="noopener noreferrer">#9433</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>).</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201841-2020-03-20">ClickHouse release v20.1.8.41, 2020-03-20<a class="hash-link" href="#clickhouse-release-v201841-2020-03-20" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-57">Bug Fix<a class="hash-link" href="#bug-fix-57" title="Direct link to heading">​</a></h4><ul><li>Fix possible permanent <code>Cannot schedule a task</code> error (due to unhandled exception in <code>ParallelAggregatingBlockInputStream::Handler::onFinish/onFinishThread</code>). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6833" target="_blank" rel="noopener noreferrer">#6833</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9154" target="_blank" rel="noopener noreferrer">#9154</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix excessive memory consumption in <code>ALTER</code> queries (mutations). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9533" target="_blank" rel="noopener noreferrer">#9533</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/9670" target="_blank" rel="noopener noreferrer">#9670</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9754" target="_blank" rel="noopener noreferrer">#9754</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix bug in backquoting in external dictionaries DDL. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9619" target="_blank" rel="noopener noreferrer">#9619</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9734" target="_blank" rel="noopener noreferrer">#9734</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201738-2020-03-18">ClickHouse release v20.1.7.38, 2020-03-18<a class="hash-link" href="#clickhouse-release-v201738-2020-03-18" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-58">Bug Fix<a class="hash-link" href="#bug-fix-58" title="Direct link to heading">​</a></h4><ul><li>Fixed incorrect internal function names for <code>sumKahan</code> and <code>sumWithOverflow</code>. I lead to exception while using this functions in remote queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/9636" target="_blank" rel="noopener noreferrer">#9636</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>). This issue was in all ClickHouse releases.</li><li>Allow <code>ALTER ON CLUSTER</code> of <code>Distributed</code> tables with internal replication. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/3268" target="_blank" rel="noopener noreferrer">#3268</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9617" target="_blank" rel="noopener noreferrer">#9617</a> (<a href="https://github.com/shinoi2" target="_blank" rel="noopener noreferrer">shinoi2</a>). This issue was in all ClickHouse releases.</li><li>Fix possible exceptions <code>Size of filter does not match size of column</code> and <code>Invalid number of rows in Chunk</code> in <code>MergeTreeRangeReader</code>. They could appear while executing <code>PREWHERE</code> in some cases. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9132" target="_blank" rel="noopener noreferrer">#9132</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9612" target="_blank" rel="noopener noreferrer">#9612</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fixed the issue: timezone was not preserved if you write a simple arithmetic expression like <code>time + 1</code> (in contrast to an expression like <code>time + INTERVAL 1 SECOND</code>). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5743" target="_blank" rel="noopener noreferrer">#5743</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9323" target="_blank" rel="noopener noreferrer">#9323</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>). This issue was in all ClickHouse releases.</li><li>Now it&#x27;s not possible to create or add columns with simple cyclic aliases like <code>a DEFAULT b, b DEFAULT a</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9603" target="_blank" rel="noopener noreferrer">#9603</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fixed the issue when padding at the end of base64 encoded value can be malformed. Update base64 library. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9491" target="_blank" rel="noopener noreferrer">#9491</a>, closes <a href="https://github.com/ClickHouse/ClickHouse/issues/9492" target="_blank" rel="noopener noreferrer">#9492</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9500" target="_blank" rel="noopener noreferrer">#9500</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix data race at destruction of <code>Poco::HTTPServer</code>. It could happen when server is started and immediately shut down. <a href="https://github.com/ClickHouse/ClickHouse/pull/9468" target="_blank" rel="noopener noreferrer">#9468</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fix possible crash/wrong number of rows in <code>LIMIT n WITH TIES</code> when there are a lot of rows equal to n&#x27;th row. <a href="https://github.com/ClickHouse/ClickHouse/pull/9464" target="_blank" rel="noopener noreferrer">#9464</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix possible mismatched checksums with column TTLs. <a href="https://github.com/ClickHouse/ClickHouse/pull/9451" target="_blank" rel="noopener noreferrer">#9451</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Fix crash when a user tries to <code>ALTER MODIFY SETTING</code> for old-formated <code>MergeTree</code> table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/9435" target="_blank" rel="noopener noreferrer">#9435</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Now we will try finalize mutations more frequently. <a href="https://github.com/ClickHouse/ClickHouse/pull/9427" target="_blank" rel="noopener noreferrer">#9427</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix replication protocol incompatibility introduced in <a href="https://github.com/ClickHouse/ClickHouse/issues/8598" target="_blank" rel="noopener noreferrer">#8598</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/9412" target="_blank" rel="noopener noreferrer">#9412</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix not(has()) for the bloom_filter index of array types. <a href="https://github.com/ClickHouse/ClickHouse/pull/9407" target="_blank" rel="noopener noreferrer">#9407</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>)</li><li>Fixed the behaviour of <code>match</code> and <code>extract</code> functions when haystack has zero bytes. The behaviour was wrong when haystack was constant. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9160" target="_blank" rel="noopener noreferrer">#9160</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9163" target="_blank" rel="noopener noreferrer">#9163</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/9345" target="_blank" rel="noopener noreferrer">#9345</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-24">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-24" title="Direct link to heading">​</a></h4><ul><li>Exception handling now works correctly on Windows Subsystem for Linux. See <a href="https://github.com/ClickHouse-Extras/libunwind/pull/3" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse-Extras/libunwind/pull/3</a> This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6480" target="_blank" rel="noopener noreferrer">#6480</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/9564" target="_blank" rel="noopener noreferrer">#9564</a> (<a href="https://github.com/sobolevsv" target="_blank" rel="noopener noreferrer">sobolevsv</a>)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v201630-2020-03-05">ClickHouse release v20.1.6.30, 2020-03-05<a class="hash-link" href="#clickhouse-release-v201630-2020-03-05" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-59">Bug Fix<a class="hash-link" href="#bug-fix-59" title="Direct link to heading">​</a></h4><ul><li>Fix data incompatibility when compressed with <code>T64</code> codec.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9039" target="_blank" rel="noopener noreferrer">#9039</a> <a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">(abyss7)</a></li><li>Fix order of ranges while reading from MergeTree table in one thread. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8964" target="_blank" rel="noopener noreferrer">#8964</a>.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9050" target="_blank" rel="noopener noreferrer">#9050</a> <a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">(CurtizJ)</a></li><li>Fix possible segfault in <code>MergeTreeRangeReader</code>, while executing <code>PREWHERE</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9064" target="_blank" rel="noopener noreferrer">#9064</a>.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9106" target="_blank" rel="noopener noreferrer">#9106</a> <a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">(CurtizJ)</a></li><li>Fix <code>reinterpretAsFixedString</code> to return <code>FixedString</code> instead of <code>String</code>.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9052" target="_blank" rel="noopener noreferrer">#9052</a> <a href="https://github.com/oandrew" target="_blank" rel="noopener noreferrer">(oandrew)</a></li><li>Fix <code>joinGet</code> with nullable return types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8919" target="_blank" rel="noopener noreferrer">#8919</a><a href="https://github.com/ClickHouse/ClickHouse/pull/9014" target="_blank" rel="noopener noreferrer">#9014</a> <a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">(amosbird)</a></li><li>Fix fuzz test and incorrect behaviour of bitTestAll/bitTestAny functions.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9143" target="_blank" rel="noopener noreferrer">#9143</a> <a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">(alexey-milovidov)</a></li><li>Fix the behaviour of match and extract functions when haystack has zero bytes. The behaviour was wrong when haystack was constant. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9160" target="_blank" rel="noopener noreferrer">#9160</a><a href="https://github.com/ClickHouse/ClickHouse/pull/9163" target="_blank" rel="noopener noreferrer">#9163</a> <a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">(alexey-milovidov)</a></li><li>Fixed execution of inversed predicates when non-strictly monotinic functional index is used. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9034" target="_blank" rel="noopener noreferrer">#9034</a><a href="https://github.com/ClickHouse/ClickHouse/pull/9223" target="_blank" rel="noopener noreferrer">#9223</a> <a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">(Akazz)</a></li><li>Allow to rewrite <code>CROSS</code> to <code>INNER JOIN</code> if there&#x27;s <code>[NOT] LIKE</code> operator in <code>WHERE</code> section. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9191" target="_blank" rel="noopener noreferrer">#9191</a><a href="https://github.com/ClickHouse/ClickHouse/pull/9229" target="_blank" rel="noopener noreferrer">#9229</a> <a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">(4ertus2)</a></li><li>Allow first column(s) in a table with Log engine be an alias.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9231" target="_blank" rel="noopener noreferrer">#9231</a> <a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">(abyss7)</a></li><li>Allow comma join with <code>IN()</code> inside. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7314" target="_blank" rel="noopener noreferrer">#7314</a>.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9251" target="_blank" rel="noopener noreferrer">#9251</a> <a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">(4ertus2)</a></li><li>Improve <code>ALTER MODIFY/ADD</code> queries logic. Now you cannot <code>ADD</code> column without type, <code>MODIFY</code> default expression does not change type of column and <code>MODIFY</code> type does not loose default expression value. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8669" target="_blank" rel="noopener noreferrer">#8669</a>.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9227" target="_blank" rel="noopener noreferrer">#9227</a>  <a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">(alesapin)</a></li><li>Fix mutations finalization, when already done mutation can have status is_done=0.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9217" target="_blank" rel="noopener noreferrer">#9217</a> <a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">(alesapin)</a></li><li>Support &quot;Processors&quot; pipeline for system.numbers and system.numbers_mt. This also fixes the bug when <code>max_execution_time</code> is not respected.
<a href="https://github.com/ClickHouse/ClickHouse/pull/7796" target="_blank" rel="noopener noreferrer">#7796</a>  <a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">(KochetovNicolai)</a></li><li>Fix wrong counting of <code>DictCacheKeysRequestedFound</code> metric.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9411" target="_blank" rel="noopener noreferrer">#9411</a> <a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">(nikitamikhaylov)</a></li><li>Added a check for storage policy in <code>ATTACH PARTITION FROM</code>, <code>REPLACE PARTITION</code>, <code>MOVE TO TABLE</code> which otherwise could make data of part inaccessible after restart and prevent ClickHouse to start.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9383" target="_blank" rel="noopener noreferrer">#9383</a> <a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">(excitoon)</a></li><li>Fixed UBSan report in <code>MergeTreeIndexSet</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9250" target="_blank" rel="noopener noreferrer">#9250</a><a href="https://github.com/ClickHouse/ClickHouse/pull/9365" target="_blank" rel="noopener noreferrer">#9365</a> <a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">(alexey-milovidov)</a></li><li>Fix possible datarace in BlockIO.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9356" target="_blank" rel="noopener noreferrer">#9356</a> <a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">(KochetovNicolai)</a></li><li>Support for <code>UInt64</code> numbers that don&#x27;t fit in Int64 in JSON-related functions. Update <code>SIMDJSON</code> to master. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9209" target="_blank" rel="noopener noreferrer">#9209</a><a href="https://github.com/ClickHouse/ClickHouse/pull/9344" target="_blank" rel="noopener noreferrer">#9344</a> <a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">(alexey-milovidov)</a></li><li>Fix the issue when the amount of free space is not calculated correctly if the data directory is mounted to a separate device. For default disk calculate the free space from data subdirectory. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7441" target="_blank" rel="noopener noreferrer">#7441</a><a href="https://github.com/ClickHouse/ClickHouse/pull/9257" target="_blank" rel="noopener noreferrer">#9257</a> <a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">(millb)</a></li><li>Fix the issue when TLS connections may fail with the message <code>OpenSSL SSL_read: error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error and SSL Exception: error:2400006E:random number generator::error retrieving entropy.</code> Update OpenSSL to upstream master.
<a href="https://github.com/ClickHouse/ClickHouse/pull/8956" target="_blank" rel="noopener noreferrer">#8956</a> <a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">(alexey-milovidov)</a></li><li>When executing <code>CREATE</code> query, fold constant expressions in storage engine arguments. Replace empty database name with current database. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6508" target="_blank" rel="noopener noreferrer">#6508</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/3492" target="_blank" rel="noopener noreferrer">#3492</a>. Also fix check for local address in ClickHouseDictionarySource.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9262" target="_blank" rel="noopener noreferrer">#9262</a> <a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">(tabplubix)</a></li><li>Fix segfault in <code>StorageMerge</code>, which can happen when reading from StorageFile.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9387" target="_blank" rel="noopener noreferrer">#9387</a> <a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">(tabplubix)</a></li><li>Prevent losing data in <code>Kafka</code> in rare cases when exception happens after reading suffix but before commit. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9378" target="_blank" rel="noopener noreferrer">#9378</a>. Related: <a href="https://github.com/ClickHouse/ClickHouse/issues/7175" target="_blank" rel="noopener noreferrer">#7175</a><a href="https://github.com/ClickHouse/ClickHouse/pull/9507" target="_blank" rel="noopener noreferrer">#9507</a> <a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">(filimonov)</a></li><li>Fix bug leading to server termination when trying to use / drop <code>Kafka</code> table created with wrong parameters. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/9494" target="_blank" rel="noopener noreferrer">#9494</a>. Incorporates <a href="https://github.com/ClickHouse/ClickHouse/issues/9507" target="_blank" rel="noopener noreferrer">#9507</a>.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9513" target="_blank" rel="noopener noreferrer">#9513</a> <a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">(filimonov)</a></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-12">New Feature<a class="hash-link" href="#new-feature-12" title="Direct link to heading">​</a></h4><ul><li>Add <code>deduplicate_blocks_in_dependent_materialized_views</code> option to control the behaviour of idempotent inserts into tables with materialized views. This new feature was added to the bugfix release by a special request from Altinity.
<a href="https://github.com/ClickHouse/ClickHouse/pull/9070" target="_blank" rel="noopener noreferrer">#9070</a> <a href="https://github.com/urykhy" target="_blank" rel="noopener noreferrer">(urykhy)</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="clickhouse-release-v20124-2020-01-22">ClickHouse release v20.1.2.4, 2020-01-22<a class="hash-link" href="#clickhouse-release-v20124-2020-01-22" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="backward-incompatible-change-10">Backward Incompatible Change<a class="hash-link" href="#backward-incompatible-change-10" title="Direct link to heading">​</a></h4><ul><li>Make the setting <code>merge_tree_uniform_read_distribution</code> obsolete. The server still recognizes this setting but it has no effect. <a href="https://github.com/ClickHouse/ClickHouse/pull/8308" target="_blank" rel="noopener noreferrer">#8308</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Changed return type of the function <code>greatCircleDistance</code> to <code>Float32</code> because now the result of calculation is <code>Float32</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7993" target="_blank" rel="noopener noreferrer">#7993</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Now it&#x27;s expected that query parameters are represented in &quot;escaped&quot; format. For example, to pass string <code>a&lt;tab&gt;b</code> you have to write <code>a\tb</code> or <code>a\&lt;tab&gt;b</code> and respectively, <code>a%5Ctb</code> or <code>a%5C%09b</code> in URL. This is needed to add the possibility to pass NULL as <code>\N</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7488" target="_blank" rel="noopener noreferrer">#7488</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8517" target="_blank" rel="noopener noreferrer">#8517</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Enable <code>use_minimalistic_part_header_in_zookeeper</code> setting for <code>ReplicatedMergeTree</code> by default. This will significantly reduce amount of data stored in ZooKeeper. This setting is supported since version 19.1 and we already use it in production in multiple services without any issues for more than half a year. Disable this setting if you have a chance to downgrade to versions older than 19.1. <a href="https://github.com/ClickHouse/ClickHouse/pull/6850" target="_blank" rel="noopener noreferrer">#6850</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Data skipping indices are production ready and enabled by default. The settings <code>allow_experimental_data_skipping_indices</code>, <code>allow_experimental_cross_to_join_conversion</code> and <code>allow_experimental_multiple_joins_emulation</code> are now obsolete and do nothing. <a href="https://github.com/ClickHouse/ClickHouse/pull/7974" target="_blank" rel="noopener noreferrer">#7974</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add new <code>ANY JOIN</code> logic for <code>StorageJoin</code> consistent with <code>JOIN</code> operation. To upgrade without changes in behaviour you need add <code>SETTINGS any_join_distinct_right_table_keys = 1</code> to Engine Join tables metadata or recreate these tables after upgrade. <a href="https://github.com/ClickHouse/ClickHouse/pull/8400" target="_blank" rel="noopener noreferrer">#8400</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Require server to be restarted to apply the changes in logging configuration. This is a temporary workaround to avoid the bug where the server logs to a deleted log file (see <a href="https://github.com/ClickHouse/ClickHouse/issues/8696" target="_blank" rel="noopener noreferrer">#8696</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8707" target="_blank" rel="noopener noreferrer">#8707</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="new-feature-13">New Feature<a class="hash-link" href="#new-feature-13" title="Direct link to heading">​</a></h4><ul><li>Added information about part paths to <code>system.merges</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8043" target="_blank" rel="noopener noreferrer">#8043</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Add ability to execute <code>SYSTEM RELOAD DICTIONARY</code> query in <code>ON CLUSTER</code> mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/8288" target="_blank" rel="noopener noreferrer">#8288</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>)</li><li>Add ability to execute <code>CREATE DICTIONARY</code> queries in <code>ON CLUSTER</code> mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/8163" target="_blank" rel="noopener noreferrer">#8163</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Now user&#x27;s profile in <code>users.xml</code> can inherit multiple profiles. <a href="https://github.com/ClickHouse/ClickHouse/pull/8343" target="_blank" rel="noopener noreferrer">#8343</a> (<a href="https://github.com/Felixoid" target="_blank" rel="noopener noreferrer">Mikhail f. Shiryaev</a>)</li><li>Added <code>system.stack_trace</code> table that allows to look at stack traces of all server threads. This is useful for developers to introspect server state. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7576" target="_blank" rel="noopener noreferrer">#7576</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8344" target="_blank" rel="noopener noreferrer">#8344</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add <code>DateTime64</code> datatype with configurable sub-second precision. <a href="https://github.com/ClickHouse/ClickHouse/pull/7170" target="_blank" rel="noopener noreferrer">#7170</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li>Add table function <code>clusterAllReplicas</code> which allows to query all the nodes in the cluster. <a href="https://github.com/ClickHouse/ClickHouse/pull/8493" target="_blank" rel="noopener noreferrer">#8493</a> (<a href="https://github.com/kiransunkari" target="_blank" rel="noopener noreferrer">kiran sunkari</a>)</li><li>Add aggregate function <code>categoricalInformationValue</code> which calculates the information value of a discrete feature. <a href="https://github.com/ClickHouse/ClickHouse/pull/8117" target="_blank" rel="noopener noreferrer">#8117</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Speed up parsing of data files in <code>CSV</code>, <code>TSV</code> and <code>JSONEachRow</code> format by doing it in parallel. <a href="https://github.com/ClickHouse/ClickHouse/pull/7780" target="_blank" rel="noopener noreferrer">#7780</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Add function <code>bankerRound</code> which performs banker&#x27;s rounding. <a href="https://github.com/ClickHouse/ClickHouse/pull/8112" target="_blank" rel="noopener noreferrer">#8112</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Support more languages in embedded dictionary for region names: &#x27;ru&#x27;, &#x27;en&#x27;, &#x27;ua&#x27;, &#x27;uk&#x27;, &#x27;by&#x27;, &#x27;kz&#x27;, &#x27;tr&#x27;, &#x27;de&#x27;, &#x27;uz&#x27;, &#x27;lv&#x27;, &#x27;lt&#x27;, &#x27;et&#x27;, &#x27;pt&#x27;, &#x27;he&#x27;, &#x27;vi&#x27;. <a href="https://github.com/ClickHouse/ClickHouse/pull/8189" target="_blank" rel="noopener noreferrer">#8189</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Improvements in consistency of <code>ANY JOIN</code> logic. Now <code>t1 ANY LEFT JOIN t2</code> equals <code>t2 ANY RIGHT JOIN t1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7665" target="_blank" rel="noopener noreferrer">#7665</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Add setting <code>any_join_distinct_right_table_keys</code> which enables old behaviour for <code>ANY INNER JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7665" target="_blank" rel="noopener noreferrer">#7665</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Add new <code>SEMI</code> and <code>ANTI JOIN</code>. Old <code>ANY INNER JOIN</code> behaviour now available as <code>SEMI LEFT JOIN</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7665" target="_blank" rel="noopener noreferrer">#7665</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Added <code>Distributed</code> format for <code>File</code> engine and <code>file</code> table function which allows to read from <code>.bin</code> files generated by asynchronous  inserts into <code>Distributed</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8535" target="_blank" rel="noopener noreferrer">#8535</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Add optional reset column argument for <code>runningAccumulate</code> which allows to reset aggregation results for each new key value. <a href="https://github.com/ClickHouse/ClickHouse/pull/8326" target="_blank" rel="noopener noreferrer">#8326</a> (<a href="https://github.com/kononencheg" target="_blank" rel="noopener noreferrer">Sergey Kononenko</a>)</li><li>Add ability to use ClickHouse as Prometheus endpoint. <a href="https://github.com/ClickHouse/ClickHouse/pull/7900" target="_blank" rel="noopener noreferrer">#7900</a> (<a href="https://github.com/Vdimir" target="_blank" rel="noopener noreferrer">vdimir</a>)</li><li>Add section <code>&lt;remote_url_allow_hosts&gt;</code> in <code>config.xml</code> which restricts allowed hosts for remote table engines and table functions <code>URL</code>, <code>S3</code>, <code>HDFS</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7154" target="_blank" rel="noopener noreferrer">#7154</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>)</li><li>Added function <code>greatCircleAngle</code> which calculates the distance on a sphere in degrees. <a href="https://github.com/ClickHouse/ClickHouse/pull/8105" target="_blank" rel="noopener noreferrer">#8105</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Changed Earth radius to be consistent with H3 library. <a href="https://github.com/ClickHouse/ClickHouse/pull/8105" target="_blank" rel="noopener noreferrer">#8105</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added <code>JSONCompactEachRow</code> and <code>JSONCompactEachRowWithNamesAndTypes</code> formats for input and output. <a href="https://github.com/ClickHouse/ClickHouse/pull/7841" target="_blank" rel="noopener noreferrer">#7841</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>)</li><li>Added feature for file-related table engines and table functions (<code>File</code>, <code>S3</code>, <code>URL</code>, <code>HDFS</code>) which allows to read and write <code>gzip</code> files based on additional engine parameter or file extension. <a href="https://github.com/ClickHouse/ClickHouse/pull/7840" target="_blank" rel="noopener noreferrer">#7840</a> (<a href="https://github.com/apbodrov" target="_blank" rel="noopener noreferrer">Andrey Bodrov</a>)</li><li>Added the <code>randomASCII(length)</code> function, generating a string with a random set of <a href="https://en.wikipedia.org/wiki/ASCII#Printable_characters" target="_blank" rel="noopener noreferrer">ASCII</a> printable characters. <a href="https://github.com/ClickHouse/ClickHouse/pull/8401" target="_blank" rel="noopener noreferrer">#8401</a> (<a href="https://github.com/BayoNet" target="_blank" rel="noopener noreferrer">BayoNet</a>)</li><li>Added function <code>JSONExtractArrayRaw</code> which returns an array on unparsed json array elements from <code>JSON</code> string. <a href="https://github.com/ClickHouse/ClickHouse/pull/8081" target="_blank" rel="noopener noreferrer">#8081</a> (<a href="https://github.com/errx" target="_blank" rel="noopener noreferrer">Oleg Matrokhin</a>)</li><li>Add <code>arrayZip</code> function which allows to combine multiple arrays of equal lengths into one array of tuples. <a href="https://github.com/ClickHouse/ClickHouse/pull/8149" target="_blank" rel="noopener noreferrer">#8149</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Add ability to move data between disks according to configured <code>TTL</code>-expressions for <code>*MergeTree</code> table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/8140" target="_blank" rel="noopener noreferrer">#8140</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Added new aggregate function <code>avgWeighted</code> which allows to calculate weighted average. <a href="https://github.com/ClickHouse/ClickHouse/pull/7898" target="_blank" rel="noopener noreferrer">#7898</a> (<a href="https://github.com/apbodrov" target="_blank" rel="noopener noreferrer">Andrey Bodrov</a>)</li><li>Now parallel parsing is enabled by default for <code>TSV</code>, <code>TSKV</code>, <code>CSV</code> and <code>JSONEachRow</code> formats. <a href="https://github.com/ClickHouse/ClickHouse/pull/7894" target="_blank" rel="noopener noreferrer">#7894</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Add several geo functions from <code>H3</code> library: <code>h3GetResolution</code>, <code>h3EdgeAngle</code>, <code>h3EdgeLength</code>, <code>h3IsValid</code> and <code>h3kRing</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8034" target="_blank" rel="noopener noreferrer">#8034</a> (<a href="https://github.com/hombit" target="_blank" rel="noopener noreferrer">Konstantin Malanchev</a>)</li><li>Added support for brotli (<code>br</code>) compression in file-related storages and table functions. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8156" target="_blank" rel="noopener noreferrer">#8156</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8526" target="_blank" rel="noopener noreferrer">#8526</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add <code>groupBit*</code> functions for the <code>SimpleAggregationFunction</code> type. <a href="https://github.com/ClickHouse/ClickHouse/pull/8485" target="_blank" rel="noopener noreferrer">#8485</a> (<a href="https://github.com/YiuRULE" target="_blank" rel="noopener noreferrer">Guillaume Tassery</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bug-fix-60">Bug Fix<a class="hash-link" href="#bug-fix-60" title="Direct link to heading">​</a></h4><ul><li>Fix rename of tables with <code>Distributed</code> engine. Fixes issue <a href="https://github.com/ClickHouse/ClickHouse/issues/7868" target="_blank" rel="noopener noreferrer">#7868</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8306" target="_blank" rel="noopener noreferrer">#8306</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Now dictionaries support <code>EXPRESSION</code> for attributes in arbitrary string in non-ClickHouse SQL dialect. <a href="https://github.com/ClickHouse/ClickHouse/pull/8098" target="_blank" rel="noopener noreferrer">#8098</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix broken <code>INSERT SELECT FROM mysql(...)</code> query. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8070" target="_blank" rel="noopener noreferrer">#8070</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/7960" target="_blank" rel="noopener noreferrer">#7960</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8234" target="_blank" rel="noopener noreferrer">#8234</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix error &quot;Mismatch column sizes&quot; when inserting default <code>Tuple</code> from <code>JSONEachRow</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5653" target="_blank" rel="noopener noreferrer">#5653</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8606" target="_blank" rel="noopener noreferrer">#8606</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Now an exception will be thrown in case of using <code>WITH TIES</code> alongside <code>LIMIT BY</code>. Also add ability to use <code>TOP</code> with <code>LIMIT BY</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7472" target="_blank" rel="noopener noreferrer">#7472</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7637" target="_blank" rel="noopener noreferrer">#7637</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Fix unintendent dependency from fresh glibc version in <code>clickhouse-odbc-bridge</code> binary. <a href="https://github.com/ClickHouse/ClickHouse/pull/8046" target="_blank" rel="noopener noreferrer">#8046</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Fix bug in check function of <code>*MergeTree</code> engines family. Now it does not fail in case when we have equal amount of rows in last granule and last mark (non-final). <a href="https://github.com/ClickHouse/ClickHouse/pull/8047" target="_blank" rel="noopener noreferrer">#8047</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix insert into <code>Enum*</code> columns after <code>ALTER</code> query, when underlying numeric type is equal to table specified type. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7836" target="_blank" rel="noopener noreferrer">#7836</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7908" target="_blank" rel="noopener noreferrer">#7908</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Allowed non-constant negative &quot;size&quot; argument for function <code>substring</code>. It was not allowed by mistake. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/4832" target="_blank" rel="noopener noreferrer">#4832</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7703" target="_blank" rel="noopener noreferrer">#7703</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix parsing bug when wrong number of arguments passed to <code>(O|J)DBC</code> table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/7709" target="_blank" rel="noopener noreferrer">#7709</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Using command name of the running clickhouse process when sending logs to syslog. In previous versions, empty string was used instead of command name. <a href="https://github.com/ClickHouse/ClickHouse/pull/8460" target="_blank" rel="noopener noreferrer">#8460</a> (<a href="https://github.com/mnach" target="_blank" rel="noopener noreferrer">Michael Nacharov</a>)</li><li>Fix check of allowed hosts for <code>localhost</code>. This PR fixes the solution provided in <a href="https://github.com/ClickHouse/ClickHouse/pull/8241" target="_blank" rel="noopener noreferrer">#8241</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8342" target="_blank" rel="noopener noreferrer">#8342</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Fix rare crash in <code>argMin</code> and <code>argMax</code> functions for long string arguments, when result is used in <code>runningAccumulate</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8325" target="_blank" rel="noopener noreferrer">#8325</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8341" target="_blank" rel="noopener noreferrer">#8341</a> (<a href="https://github.com/769344359" target="_blank" rel="noopener noreferrer">dinosaur</a>)</li><li>Fix memory overcommit for tables with <code>Buffer</code> engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/8345" target="_blank" rel="noopener noreferrer">#8345</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fixed potential bug in functions that can take <code>NULL</code> as one of the arguments and return non-NULL. <a href="https://github.com/ClickHouse/ClickHouse/pull/8196" target="_blank" rel="noopener noreferrer">#8196</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Better metrics calculations in thread pool for background processes for <code>MergeTree</code> table engines. <a href="https://github.com/ClickHouse/ClickHouse/pull/8194" target="_blank" rel="noopener noreferrer">#8194</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fix function <code>IN</code> inside <code>WHERE</code> statement when row-level table filter is present. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6687" target="_blank" rel="noopener noreferrer">#6687</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8357" target="_blank" rel="noopener noreferrer">#8357</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Now an exception is thrown if the integral value is not parsed completely for settings values. <a href="https://github.com/ClickHouse/ClickHouse/pull/7678" target="_blank" rel="noopener noreferrer">#7678</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>)</li><li>Fix exception when aggregate function is used in query to distributed table with more than two local shards. <a href="https://github.com/ClickHouse/ClickHouse/pull/8164" target="_blank" rel="noopener noreferrer">#8164</a> (<a href="https://github.com/nicelulu" target="_blank" rel="noopener noreferrer">小路</a>)</li><li>Now bloom filter can handle zero length arrays and does not perform redundant calculations. <a href="https://github.com/ClickHouse/ClickHouse/pull/8242" target="_blank" rel="noopener noreferrer">#8242</a> (<a href="https://github.com/achimbab" target="_blank" rel="noopener noreferrer">achimbab</a>)</li><li>Fixed checking if a client host is allowed by matching the client host to <code>host_regexp</code> specified in <code>users.xml</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8241" target="_blank" rel="noopener noreferrer">#8241</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Relax ambiguous column check that leads to false positives in multiple <code>JOIN ON</code> section. <a href="https://github.com/ClickHouse/ClickHouse/pull/8385" target="_blank" rel="noopener noreferrer">#8385</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fixed possible server crash (<code>std::terminate</code>) when the server cannot send or write data in <code>JSON</code> or <code>XML</code> format with values of <code>String</code> data type (that require <code>UTF-8</code> validation) or when compressing result data with Brotli algorithm or in some other rare cases. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7603" target="_blank" rel="noopener noreferrer">#7603</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8384" target="_blank" rel="noopener noreferrer">#8384</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix race condition in <code>StorageDistributedDirectoryMonitor</code> found by CI. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8364" target="_blank" rel="noopener noreferrer">#8364</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8383" target="_blank" rel="noopener noreferrer">#8383</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Now background merges in <code>*MergeTree</code> table engines family preserve storage policy volume order more accurately. <a href="https://github.com/ClickHouse/ClickHouse/pull/8549" target="_blank" rel="noopener noreferrer">#8549</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Now table engine <code>Kafka</code> works properly with <code>Native</code> format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6731" target="_blank" rel="noopener noreferrer">#6731</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/7337" target="_blank" rel="noopener noreferrer">#7337</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/8003" target="_blank" rel="noopener noreferrer">#8003</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8016" target="_blank" rel="noopener noreferrer">#8016</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Fixed formats with headers (like <code>CSVWithNames</code>) which were throwing exception about EOF for table engine <code>Kafka</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8016" target="_blank" rel="noopener noreferrer">#8016</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Fixed a bug with making set from subquery in right part of <code>IN</code> section. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5767" target="_blank" rel="noopener noreferrer">#5767</a> and <a href="https://github.com/ClickHouse/ClickHouse/issues/2542" target="_blank" rel="noopener noreferrer">#2542</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7755" target="_blank" rel="noopener noreferrer">#7755</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Fix possible crash while reading from storage <code>File</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7756" target="_blank" rel="noopener noreferrer">#7756</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fixed reading of the files in <code>Parquet</code> format containing columns of type <code>list</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8334" target="_blank" rel="noopener noreferrer">#8334</a> (<a href="https://github.com/maxulan" target="_blank" rel="noopener noreferrer">maxulan</a>)</li><li>Fix error <code>Not found column</code> for distributed queries with <code>PREWHERE</code> condition dependent on sampling key if <code>max_parallel_replicas &gt; 1</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7913" target="_blank" rel="noopener noreferrer">#7913</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix error <code>Not found column</code> if query used <code>PREWHERE</code> dependent on table&#x27;s alias and the result set was empty because of primary key condition. <a href="https://github.com/ClickHouse/ClickHouse/pull/7911" target="_blank" rel="noopener noreferrer">#7911</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fixed return type for functions <code>rand</code> and <code>randConstant</code> in case of <code>Nullable</code> argument. Now functions always return <code>UInt32</code> and never <code>Nullable(UInt32)</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8204" target="_blank" rel="noopener noreferrer">#8204</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Disabled predicate push-down for <code>WITH FILL</code> expression. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7784" target="_blank" rel="noopener noreferrer">#7784</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7789" target="_blank" rel="noopener noreferrer">#7789</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Fixed incorrect <code>count()</code> result for <code>SummingMergeTree</code> when <code>FINAL</code> section is used. <a href="https://github.com/ClickHouse/ClickHouse/issues/3280" target="_blank" rel="noopener noreferrer">#3280</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/7786" target="_blank" rel="noopener noreferrer">#7786</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Fix possible incorrect result for constant functions from remote servers. It happened for queries with functions like <code>version()</code>, <code>uptime()</code>, etc. which returns different constant values for different servers. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7666" target="_blank" rel="noopener noreferrer">#7666</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7689" target="_blank" rel="noopener noreferrer">#7689</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix complicated bug in push-down predicate optimization which leads to wrong results. This fixes a lot of issues on push-down predicate optimization. <a href="https://github.com/ClickHouse/ClickHouse/pull/8503" target="_blank" rel="noopener noreferrer">#8503</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Fix crash in <code>CREATE TABLE .. AS dictionary</code> query. <a href="https://github.com/ClickHouse/ClickHouse/pull/8508" target="_blank" rel="noopener noreferrer">#8508</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Several improvements ClickHouse grammar in <code>.g4</code> file. <a href="https://github.com/ClickHouse/ClickHouse/pull/8294" target="_blank" rel="noopener noreferrer">#8294</a> (<a href="https://github.com/taiyang-li" target="_blank" rel="noopener noreferrer">taiyang-li</a>)</li><li>Fix bug that leads to crashes in <code>JOIN</code>s with tables with engine <code>Join</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7556" target="_blank" rel="noopener noreferrer">#7556</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/8254" target="_blank" rel="noopener noreferrer">#8254</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/7915" target="_blank" rel="noopener noreferrer">#7915</a> <a href="https://github.com/ClickHouse/ClickHouse/issues/8100" target="_blank" rel="noopener noreferrer">#8100</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8298" target="_blank" rel="noopener noreferrer">#8298</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fix redundant dictionaries reload on <code>CREATE DATABASE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7916" target="_blank" rel="noopener noreferrer">#7916</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Limit maximum number of streams for read from <code>StorageFile</code> and <code>StorageHDFS</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7650" target="_blank" rel="noopener noreferrer">#7650</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7981" target="_blank" rel="noopener noreferrer">#7981</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix bug in <code>ALTER ... MODIFY ... CODEC</code> query, when user specify both default expression and codec. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8593" target="_blank" rel="noopener noreferrer">8593</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8614" target="_blank" rel="noopener noreferrer">#8614</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix error in background merge of columns with <code>SimpleAggregateFunction(LowCardinality)</code> type. <a href="https://github.com/ClickHouse/ClickHouse/pull/8613" target="_blank" rel="noopener noreferrer">#8613</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fixed type check in function <code>toDateTime64</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8375" target="_blank" rel="noopener noreferrer">#8375</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li>Now server do not crash on <code>LEFT</code> or <code>FULL JOIN</code> with and Join engine and unsupported <code>join_use_nulls</code> settings. <a href="https://github.com/ClickHouse/ClickHouse/pull/8479" target="_blank" rel="noopener noreferrer">#8479</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Now <code>DROP DICTIONARY IF EXISTS db.dict</code> query does not throw exception if <code>db</code> does not exist. <a href="https://github.com/ClickHouse/ClickHouse/pull/8185" target="_blank" rel="noopener noreferrer">#8185</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Fix possible crashes in table functions (<code>file</code>, <code>mysql</code>, <code>remote</code>) caused by usage of reference to removed <code>IStorage</code> object. Fix incorrect parsing of columns specified at insertion into table function. <a href="https://github.com/ClickHouse/ClickHouse/pull/7762" target="_blank" rel="noopener noreferrer">#7762</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Ensure network be up before starting <code>clickhouse-server</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7507" target="_blank" rel="noopener noreferrer">#7507</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8570" target="_blank" rel="noopener noreferrer">#8570</a> (<a href="https://github.com/yuzhichang" target="_blank" rel="noopener noreferrer">Zhichang Yu</a>)</li><li>Fix timeouts handling for secure connections, so queries does not hang indefenitely. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8126" target="_blank" rel="noopener noreferrer">#8126</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8128" target="_blank" rel="noopener noreferrer">#8128</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix <code>clickhouse-copier</code>&#x27;s redundant contention between concurrent workers. <a href="https://github.com/ClickHouse/ClickHouse/pull/7816" target="_blank" rel="noopener noreferrer">#7816</a> (<a href="https://github.com/dingxiangfei2009" target="_blank" rel="noopener noreferrer">Ding Xiang Fei</a>)</li><li>Now mutations does not skip attached parts, even if their mutation version were larger than current mutation version. <a href="https://github.com/ClickHouse/ClickHouse/pull/7812" target="_blank" rel="noopener noreferrer">#7812</a> (<a href="https://github.com/yuzhichang" target="_blank" rel="noopener noreferrer">Zhichang Yu</a>) <a href="https://github.com/ClickHouse/ClickHouse/pull/8250" target="_blank" rel="noopener noreferrer">#8250</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Ignore redundant copies of <code>*MergeTree</code> data parts after move to another disk and server restart. <a href="https://github.com/ClickHouse/ClickHouse/pull/7810" target="_blank" rel="noopener noreferrer">#7810</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fix crash in <code>FULL JOIN</code> with <code>LowCardinality</code> in <code>JOIN</code> key. <a href="https://github.com/ClickHouse/ClickHouse/pull/8252" target="_blank" rel="noopener noreferrer">#8252</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Forbidden to use column name more than once in insert query like <code>INSERT INTO tbl (x, y, x)</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5465" target="_blank" rel="noopener noreferrer">#5465</a>, <a href="https://github.com/ClickHouse/ClickHouse/issues/7681" target="_blank" rel="noopener noreferrer">#7681</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7685" target="_blank" rel="noopener noreferrer">#7685</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Added fallback for detection the number of physical CPU cores for unknown CPUs (using the number of logical CPU cores). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5239" target="_blank" rel="noopener noreferrer">#5239</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7726" target="_blank" rel="noopener noreferrer">#7726</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix <code>There&#x27;s no column</code> error for materialized and alias columns. <a href="https://github.com/ClickHouse/ClickHouse/pull/8210" target="_blank" rel="noopener noreferrer">#8210</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fixed sever crash when <code>EXISTS</code> query was used without <code>TABLE</code> or <code>DICTIONARY</code> qualifier. Just like <code>EXISTS t</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8172" target="_blank" rel="noopener noreferrer">#8172</a>. This bug was introduced in version 19.17. <a href="https://github.com/ClickHouse/ClickHouse/pull/8213" target="_blank" rel="noopener noreferrer">#8213</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix rare bug with error <code>&quot;Sizes of columns does not match&quot;</code> that might appear when using <code>SimpleAggregateFunction</code> column. <a href="https://github.com/ClickHouse/ClickHouse/pull/7790" target="_blank" rel="noopener noreferrer">#7790</a> (<a href="https://github.com/bgranvea" target="_blank" rel="noopener noreferrer">Boris Granveaud</a>)</li><li>Fix bug where user with empty <code>allow_databases</code> got access to all databases (and same for <code>allow_dictionaries</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/7793" target="_blank" rel="noopener noreferrer">#7793</a> (<a href="https://github.com/DeifyTheGod" target="_blank" rel="noopener noreferrer">DeifyTheGod</a>)</li><li>Fix client crash when server already disconnected from client. <a href="https://github.com/ClickHouse/ClickHouse/pull/8071" target="_blank" rel="noopener noreferrer">#8071</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix <code>ORDER BY</code> behaviour in case of sorting by primary key prefix and non primary key suffix. <a href="https://github.com/ClickHouse/ClickHouse/pull/7759" target="_blank" rel="noopener noreferrer">#7759</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Check if qualified column present in the table. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6836" target="_blank" rel="noopener noreferrer">#6836</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7758" target="_blank" rel="noopener noreferrer">#7758</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Fixed behavior with <code>ALTER MOVE</code> ran immediately after merge finish moves superpart of specified. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8103" target="_blank" rel="noopener noreferrer">#8103</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8104" target="_blank" rel="noopener noreferrer">#8104</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fix possible server crash while using <code>UNION</code> with different number of columns. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7279" target="_blank" rel="noopener noreferrer">#7279</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7929" target="_blank" rel="noopener noreferrer">#7929</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix size of result substring for function <code>substr</code> with negative size. <a href="https://github.com/ClickHouse/ClickHouse/pull/8589" target="_blank" rel="noopener noreferrer">#8589</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Now server does not execute part mutation in <code>MergeTree</code> if there are not enough free threads in background pool.  <a href="https://github.com/ClickHouse/ClickHouse/pull/8588" target="_blank" rel="noopener noreferrer">#8588</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix a minor typo on formatting <code>UNION ALL</code> AST. <a href="https://github.com/ClickHouse/ClickHouse/pull/7999" target="_blank" rel="noopener noreferrer">#7999</a> (<a href="https://github.com/litao91" target="_blank" rel="noopener noreferrer">litao91</a>)</li><li>Fixed incorrect bloom filter results for negative numbers. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8317" target="_blank" rel="noopener noreferrer">#8317</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8566" target="_blank" rel="noopener noreferrer">#8566</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Fixed potential buffer overflow in decompress. Malicious user can pass fabricated compressed data that will cause read after buffer. This issue was found by Eldar Zaitov from Yandex information security team. <a href="https://github.com/ClickHouse/ClickHouse/pull/8404" target="_blank" rel="noopener noreferrer">#8404</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix incorrect result because of integers overflow in <code>arrayIntersect</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7777" target="_blank" rel="noopener noreferrer">#7777</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Now <code>OPTIMIZE TABLE</code> query will not wait for offline replicas to perform the operation. <a href="https://github.com/ClickHouse/ClickHouse/pull/8314" target="_blank" rel="noopener noreferrer">#8314</a> (<a href="https://github.com/javisantana" target="_blank" rel="noopener noreferrer">javi santana</a>)</li><li>Fixed <code>ALTER TTL</code> parser for <code>Replicated*MergeTree</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/8318" target="_blank" rel="noopener noreferrer">#8318</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fix communication between server and client, so server read temporary tables info after query failure. <a href="https://github.com/ClickHouse/ClickHouse/pull/8084" target="_blank" rel="noopener noreferrer">#8084</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fix <code>bitmapAnd</code> function error when intersecting an aggregated bitmap and a scalar bitmap. <a href="https://github.com/ClickHouse/ClickHouse/pull/8082" target="_blank" rel="noopener noreferrer">#8082</a> (<a href="https://github.com/moon03432" target="_blank" rel="noopener noreferrer">Yue Huang</a>)</li><li>Refine the definition of <code>ZXid</code> according to the ZooKeeper Programmer&#x27;s Guide which fixes bug in <code>clickhouse-cluster-copier</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8088" target="_blank" rel="noopener noreferrer">#8088</a> (<a href="https://github.com/dingxiangfei2009" target="_blank" rel="noopener noreferrer">Ding Xiang Fei</a>)</li><li><code>odbc</code> table function now respects <code>external_table_functions_use_nulls</code> setting. <a href="https://github.com/ClickHouse/ClickHouse/pull/7506" target="_blank" rel="noopener noreferrer">#7506</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li>Fixed bug that lead to a rare data race. <a href="https://github.com/ClickHouse/ClickHouse/pull/8143" target="_blank" rel="noopener noreferrer">#8143</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Now <code>SYSTEM RELOAD DICTIONARY</code> reloads a dictionary completely, ignoring <code>update_field</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7440" target="_blank" rel="noopener noreferrer">#7440</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8037" target="_blank" rel="noopener noreferrer">#8037</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Add ability to check if dictionary exists in create query. <a href="https://github.com/ClickHouse/ClickHouse/pull/8032" target="_blank" rel="noopener noreferrer">#8032</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix <code>Float*</code> parsing in <code>Values</code> format. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7817" target="_blank" rel="noopener noreferrer">#7817</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7870" target="_blank" rel="noopener noreferrer">#7870</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fix crash when we cannot reserve space in some background operations of <code>*MergeTree</code> table engines family. <a href="https://github.com/ClickHouse/ClickHouse/pull/7873" target="_blank" rel="noopener noreferrer">#7873</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fix crash of merge operation when table contains <code>SimpleAggregateFunction(LowCardinality)</code> column. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8515" target="_blank" rel="noopener noreferrer">#8515</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8522" target="_blank" rel="noopener noreferrer">#8522</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Restore support of all ICU locales and add the ability to apply collations for constant expressions. Also add language name to <code>system.collations</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8051" target="_blank" rel="noopener noreferrer">#8051</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix bug when external dictionaries with zero minimal lifetime (<code>LIFETIME(MIN 0 MAX N)</code>, <code>LIFETIME(N)</code>) don&#x27;t update in background. <a href="https://github.com/ClickHouse/ClickHouse/pull/7983" target="_blank" rel="noopener noreferrer">#7983</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix crash when external dictionary with ClickHouse source has subquery in query. <a href="https://github.com/ClickHouse/ClickHouse/pull/8351" target="_blank" rel="noopener noreferrer">#8351</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Fix incorrect parsing of file extension in table with engine <code>URL</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8157" target="_blank" rel="noopener noreferrer">#8157</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8419" target="_blank" rel="noopener noreferrer">#8419</a> (<a href="https://github.com/apbodrov" target="_blank" rel="noopener noreferrer">Andrey Bodrov</a>)</li><li>Fix <code>CHECK TABLE</code> query for <code>*MergeTree</code> tables without key. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7543" target="_blank" rel="noopener noreferrer">#7543</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7979" target="_blank" rel="noopener noreferrer">#7979</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fixed conversion of <code>Float64</code> to MySQL type. <a href="https://github.com/ClickHouse/ClickHouse/pull/8079" target="_blank" rel="noopener noreferrer">#8079</a> (<a href="https://github.com/yurriy" target="_blank" rel="noopener noreferrer">Yuriy Baranov</a>)</li><li>Now if table was not completely dropped because of server crash, server will try to restore and load it. <a href="https://github.com/ClickHouse/ClickHouse/pull/8176" target="_blank" rel="noopener noreferrer">#8176</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li><li>Fixed crash in table function <code>file</code> while inserting into file that does not exist. Now in this case file would be created and then insert would be processed. <a href="https://github.com/ClickHouse/ClickHouse/pull/8177" target="_blank" rel="noopener noreferrer">#8177</a> (<a href="https://github.com/stavrolia" target="_blank" rel="noopener noreferrer">Olga Khvostikova</a>)</li><li>Fix rare deadlock which can happen when <code>trace_log</code> is in enabled. <a href="https://github.com/ClickHouse/ClickHouse/pull/7838" target="_blank" rel="noopener noreferrer">#7838</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Add ability to work with different types besides <code>Date</code> in <code>RangeHashed</code> external dictionary created from DDL query. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7899" target="_blank" rel="noopener noreferrer">7899</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8275" target="_blank" rel="noopener noreferrer">#8275</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fixes crash when <code>now64()</code> is called with result of another function. <a href="https://github.com/ClickHouse/ClickHouse/pull/8270" target="_blank" rel="noopener noreferrer">#8270</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li>Fixed bug with detecting client IP for connections through mysql wire protocol. <a href="https://github.com/ClickHouse/ClickHouse/pull/7743" target="_blank" rel="noopener noreferrer">#7743</a> (<a href="https://github.com/dmitriy-myz" target="_blank" rel="noopener noreferrer">Dmitry Muzyka</a>)</li><li>Fix empty array handling in <code>arraySplit</code> function. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7708" target="_blank" rel="noopener noreferrer">#7708</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7747" target="_blank" rel="noopener noreferrer">#7747</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Fixed the issue when <code>pid-file</code> of another running <code>clickhouse-server</code> may be deleted. <a href="https://github.com/ClickHouse/ClickHouse/pull/8487" target="_blank" rel="noopener noreferrer">#8487</a> (<a href="https://github.com/weiqxu" target="_blank" rel="noopener noreferrer">Weiqing Xu</a>)</li><li>Fix dictionary reload if it has <code>invalidate_query</code>, which stopped updates and some exception on previous update tries. <a href="https://github.com/ClickHouse/ClickHouse/pull/8029" target="_blank" rel="noopener noreferrer">#8029</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fixed error in function <code>arrayReduce</code> that may lead to &quot;double free&quot; and error in aggregate function combinator <code>Resample</code> that may lead to memory leak. Added aggregate function <code>aggThrow</code>. This function can be used for testing purposes. <a href="https://github.com/ClickHouse/ClickHouse/pull/8446" target="_blank" rel="noopener noreferrer">#8446</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="improvement-22">Improvement<a class="hash-link" href="#improvement-22" title="Direct link to heading">​</a></h4><ul><li>Improved logging when working with <code>S3</code> table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/8251" target="_blank" rel="noopener noreferrer">#8251</a> (<a href="https://github.com/GrigoryPervakov" target="_blank" rel="noopener noreferrer">Grigory Pervakov</a>)</li><li>Printed help message when no arguments are passed when calling <code>clickhouse-local</code>. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5335" target="_blank" rel="noopener noreferrer">#5335</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8230" target="_blank" rel="noopener noreferrer">#8230</a> (<a href="https://github.com/Melancholic" target="_blank" rel="noopener noreferrer">Andrey Nagorny</a>)</li><li>Add setting <code>mutations_sync</code> which allows to wait <code>ALTER UPDATE/DELETE</code> queries synchronously. <a href="https://github.com/ClickHouse/ClickHouse/pull/8237" target="_blank" rel="noopener noreferrer">#8237</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Allow to set up relative <code>user_files_path</code> in <code>config.xml</code> (in the way similar to <code>format_schema_path</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/7632" target="_blank" rel="noopener noreferrer">#7632</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Add exception for illegal types for conversion functions with <code>-OrZero</code> postfix. <a href="https://github.com/ClickHouse/ClickHouse/pull/7880" target="_blank" rel="noopener noreferrer">#7880</a> (<a href="https://github.com/akonyaev90" target="_blank" rel="noopener noreferrer">Andrey Konyaev</a>)</li><li>Simplify format of the header of data sending to a shard in a distributed query. <a href="https://github.com/ClickHouse/ClickHouse/pull/8044" target="_blank" rel="noopener noreferrer">#8044</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li><code>Live View</code> table engine refactoring. <a href="https://github.com/ClickHouse/ClickHouse/pull/8519" target="_blank" rel="noopener noreferrer">#8519</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>)</li><li>Add additional checks for external dictionaries created from DDL-queries. <a href="https://github.com/ClickHouse/ClickHouse/pull/8127" target="_blank" rel="noopener noreferrer">#8127</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Fix error <code>Column ... already exists</code> while using <code>FINAL</code> and <code>SAMPLE</code> together, e.g. <code>select count() from table final sample 1/2</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5186" target="_blank" rel="noopener noreferrer">#5186</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7907" target="_blank" rel="noopener noreferrer">#7907</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Now table the first argument of <code>joinGet</code> function can be table identifier. <a href="https://github.com/ClickHouse/ClickHouse/pull/7707" target="_blank" rel="noopener noreferrer">#7707</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Allow using <code>MaterializedView</code> with subqueries above <code>Kafka</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/8197" target="_blank" rel="noopener noreferrer">#8197</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Now background moves between disks run it the seprate thread pool. <a href="https://github.com/ClickHouse/ClickHouse/pull/7670" target="_blank" rel="noopener noreferrer">#7670</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li><code>SYSTEM RELOAD DICTIONARY</code> now executes synchronously. <a href="https://github.com/ClickHouse/ClickHouse/pull/8240" target="_blank" rel="noopener noreferrer">#8240</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Stack traces now display physical addresses (offsets in object file) instead of virtual memory addresses (where the object file was loaded). That allows the use of <code>addr2line</code> when binary is position independent and ASLR is active. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8360" target="_blank" rel="noopener noreferrer">#8360</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8387" target="_blank" rel="noopener noreferrer">#8387</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Support new syntax for row-level security filters: <code>&lt;table name=&#x27;table_name&#x27;&gt;…&lt;/table&gt;</code>. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5779" target="_blank" rel="noopener noreferrer">#5779</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8381" target="_blank" rel="noopener noreferrer">#8381</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Now <code>cityHash</code> function can work with <code>Decimal</code> and <code>UUID</code> types. Fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5184" target="_blank" rel="noopener noreferrer">#5184</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7693" target="_blank" rel="noopener noreferrer">#7693</a> (<a href="https://github.com/millb" target="_blank" rel="noopener noreferrer">Mikhail Korotov</a>)</li><li>Removed fixed index granularity (it was 1024) from system logs because it&#x27;s obsolete after implementation of adaptive granularity. <a href="https://github.com/ClickHouse/ClickHouse/pull/7698" target="_blank" rel="noopener noreferrer">#7698</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Enabled MySQL compatibility server when ClickHouse is compiled without SSL. <a href="https://github.com/ClickHouse/ClickHouse/pull/7852" target="_blank" rel="noopener noreferrer">#7852</a> (<a href="https://github.com/yurriy" target="_blank" rel="noopener noreferrer">Yuriy Baranov</a>)</li><li>Now server checksums distributed batches, which gives more verbose errors in case of corrupted data in batch. <a href="https://github.com/ClickHouse/ClickHouse/pull/7914" target="_blank" rel="noopener noreferrer">#7914</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Support <code>DROP DATABASE</code>, <code>DETACH TABLE</code>, <code>DROP TABLE</code> and <code>ATTACH TABLE</code> for <code>MySQL</code> database engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/8202" target="_blank" rel="noopener noreferrer">#8202</a> (<a href="https://github.com/zhang2014" target="_blank" rel="noopener noreferrer">Winter Zhang</a>)</li><li>Add authentication in S3 table function and table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/7623" target="_blank" rel="noopener noreferrer">#7623</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Added check for extra parts of <code>MergeTree</code> at different disks, in order to not allow to miss data parts at undefined disks. <a href="https://github.com/ClickHouse/ClickHouse/pull/8118" target="_blank" rel="noopener noreferrer">#8118</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Enable SSL support for Mac client and server. <a href="https://github.com/ClickHouse/ClickHouse/pull/8297" target="_blank" rel="noopener noreferrer">#8297</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Now ClickHouse can work as MySQL federated server (see <a href="https://dev.mysql.com/doc/refman/5.7/en/federated-create-server.html" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/doc/refman/5.7/en/federated-create-server.html</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/7717" target="_blank" rel="noopener noreferrer">#7717</a> (<a href="https://github.com/MaxFedotov" target="_blank" rel="noopener noreferrer">Maxim Fedotov</a>)</li><li><code>clickhouse-client</code> now only enable <code>bracketed-paste</code> when multiquery is on and multiline is off. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7757" target="_blank" rel="noopener noreferrer">#7757</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7761" target="_blank" rel="noopener noreferrer">#7761</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Support <code>Array(Decimal)</code> in <code>if</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/7721" target="_blank" rel="noopener noreferrer">#7721</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Support Decimals in <code>arrayDifference</code>, <code>arrayCumSum</code> and <code>arrayCumSumNegative</code> functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/7724" target="_blank" rel="noopener noreferrer">#7724</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Added <code>lifetime</code> column to <code>system.dictionaries</code> table. <a href="https://github.com/ClickHouse/ClickHouse/issues/6820" target="_blank" rel="noopener noreferrer">#6820</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/7727" target="_blank" rel="noopener noreferrer">#7727</a> (<a href="https://github.com/kekekekule" target="_blank" rel="noopener noreferrer">kekekekule</a>)</li><li>Improved check for existing parts on different disks for <code>*MergeTree</code> table engines. Addresses <a href="https://github.com/ClickHouse/ClickHouse/issues/7660" target="_blank" rel="noopener noreferrer">#7660</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8440" target="_blank" rel="noopener noreferrer">#8440</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Integration with <code>AWS SDK</code> for <code>S3</code> interactions which allows to use all S3 features out of the box. <a href="https://github.com/ClickHouse/ClickHouse/pull/8011" target="_blank" rel="noopener noreferrer">#8011</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>)</li><li>Added support for subqueries in <code>Live View</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/7792" target="_blank" rel="noopener noreferrer">#7792</a> (<a href="https://github.com/vzakaznikov" target="_blank" rel="noopener noreferrer">vzakaznikov</a>)</li><li>Check for using <code>Date</code> or <code>DateTime</code> column from <code>TTL</code> expressions was removed. <a href="https://github.com/ClickHouse/ClickHouse/pull/7920" target="_blank" rel="noopener noreferrer">#7920</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Information about disk was added to <code>system.detached_parts</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/7833" target="_blank" rel="noopener noreferrer">#7833</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Now settings <code>max_(table|partition)_size_to_drop</code> can be changed without a restart. <a href="https://github.com/ClickHouse/ClickHouse/pull/7779" target="_blank" rel="noopener noreferrer">#7779</a> (<a href="https://github.com/GrigoryPervakov" target="_blank" rel="noopener noreferrer">Grigory Pervakov</a>)</li><li>Slightly better usability of error messages. Ask user not to remove the lines below <code>Stack trace:</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7897" target="_blank" rel="noopener noreferrer">#7897</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Better reading messages from <code>Kafka</code> engine in various formats after <a href="https://github.com/ClickHouse/ClickHouse/issues/7935" target="_blank" rel="noopener noreferrer">#7935</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8035" target="_blank" rel="noopener noreferrer">#8035</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Better compatibility with MySQL clients which don&#x27;t support <code>sha2_password</code> auth plugin. <a href="https://github.com/ClickHouse/ClickHouse/pull/8036" target="_blank" rel="noopener noreferrer">#8036</a> (<a href="https://github.com/yurriy" target="_blank" rel="noopener noreferrer">Yuriy Baranov</a>)</li><li>Support more column types in MySQL compatibility server. <a href="https://github.com/ClickHouse/ClickHouse/pull/7975" target="_blank" rel="noopener noreferrer">#7975</a> (<a href="https://github.com/yurriy" target="_blank" rel="noopener noreferrer">Yuriy Baranov</a>)</li><li>Implement <code>ORDER BY</code> optimization for <code>Merge</code>, <code>Buffer</code> and <code>Materilized View</code> storages with underlying <code>MergeTree</code> tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/8130" target="_blank" rel="noopener noreferrer">#8130</a> (<a href="https://github.com/CurtizJ" target="_blank" rel="noopener noreferrer">Anton Popov</a>)</li><li>Now we always use POSIX implementation of <code>getrandom</code> to have better compatibility with old kernels (&lt; 3.17). <a href="https://github.com/ClickHouse/ClickHouse/pull/7940" target="_blank" rel="noopener noreferrer">#7940</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Better check for valid destination in a move TTL rule. <a href="https://github.com/ClickHouse/ClickHouse/pull/8410" target="_blank" rel="noopener noreferrer">#8410</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Better checks for broken insert batches for <code>Distributed</code> table engine. <a href="https://github.com/ClickHouse/ClickHouse/pull/7933" target="_blank" rel="noopener noreferrer">#7933</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Add column with array of parts name which mutations must process in future to <code>system.mutations</code> table. <a href="https://github.com/ClickHouse/ClickHouse/pull/8179" target="_blank" rel="noopener noreferrer">#8179</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Parallel merge sort optimization for processors. <a href="https://github.com/ClickHouse/ClickHouse/pull/8552" target="_blank" rel="noopener noreferrer">#8552</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>The settings <code>mark_cache_min_lifetime</code> is now obsolete and does nothing. In previous versions, mark cache can grow in memory larger than <code>mark_cache_size</code> to accomodate data within <code>mark_cache_min_lifetime</code> seconds. That was leading to confusion and higher memory usage than expected, that is especially bad on memory constrained systems. If you will see performance degradation after installing this release, you should increase the <code>mark_cache_size</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8484" target="_blank" rel="noopener noreferrer">#8484</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Preparation to use <code>tid</code> everywhere. This is needed for <a href="https://github.com/ClickHouse/ClickHouse/issues/7477" target="_blank" rel="noopener noreferrer">#7477</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8276" target="_blank" rel="noopener noreferrer">#8276</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="performance-improvement-17">Performance Improvement<a class="hash-link" href="#performance-improvement-17" title="Direct link to heading">​</a></h4><ul><li>Performance optimizations in processors pipeline. <a href="https://github.com/ClickHouse/ClickHouse/pull/7988" target="_blank" rel="noopener noreferrer">#7988</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Non-blocking updates of expired keys in cache dictionaries (with permission to read old ones). <a href="https://github.com/ClickHouse/ClickHouse/pull/8303" target="_blank" rel="noopener noreferrer">#8303</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Compile ClickHouse without <code>-fno-omit-frame-pointer</code> globally to spare one more register. <a href="https://github.com/ClickHouse/ClickHouse/pull/8097" target="_blank" rel="noopener noreferrer">#8097</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Speedup <code>greatCircleDistance</code> function and add performance tests for it. <a href="https://github.com/ClickHouse/ClickHouse/pull/7307" target="_blank" rel="noopener noreferrer">#7307</a> (<a href="https://github.com/stavrolia" target="_blank" rel="noopener noreferrer">Olga Khvostikova</a>)</li><li>Improved performance of function <code>roundDown</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8465" target="_blank" rel="noopener noreferrer">#8465</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Improved performance of <code>max</code>, <code>min</code>, <code>argMin</code>, <code>argMax</code> for <code>DateTime64</code> data type. <a href="https://github.com/ClickHouse/ClickHouse/pull/8199" target="_blank" rel="noopener noreferrer">#8199</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li>Improved performance of sorting without a limit or with big limit and external sorting. <a href="https://github.com/ClickHouse/ClickHouse/pull/8545" target="_blank" rel="noopener noreferrer">#8545</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Improved performance of formatting floating point numbers up to 6 times. <a href="https://github.com/ClickHouse/ClickHouse/pull/8542" target="_blank" rel="noopener noreferrer">#8542</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Improved performance of <code>modulo</code> function. <a href="https://github.com/ClickHouse/ClickHouse/pull/7750" target="_blank" rel="noopener noreferrer">#7750</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Optimized <code>ORDER BY</code> and merging with single column key. <a href="https://github.com/ClickHouse/ClickHouse/pull/8335" target="_blank" rel="noopener noreferrer">#8335</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Better implementation for <code>arrayReduce</code>, <code>-Array</code> and <code>-State</code> combinators.  <a href="https://github.com/ClickHouse/ClickHouse/pull/7710" target="_blank" rel="noopener noreferrer">#7710</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Now <code>PREWHERE</code> should be optimized to be at least as efficient as <code>WHERE</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7769" target="_blank" rel="noopener noreferrer">#7769</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Improve the way <code>round</code> and <code>roundBankers</code> handling negative numbers. <a href="https://github.com/ClickHouse/ClickHouse/pull/8229" target="_blank" rel="noopener noreferrer">#8229</a> (<a href="https://github.com/hczhcz" target="_blank" rel="noopener noreferrer">hcz</a>)</li><li>Improved decoding performance of <code>DoubleDelta</code> and <code>Gorilla</code> codecs by roughly 30-40%. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7082" target="_blank" rel="noopener noreferrer">#7082</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8019" target="_blank" rel="noopener noreferrer">#8019</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li>Improved performance of <code>base64</code> related functions. <a href="https://github.com/ClickHouse/ClickHouse/pull/8444" target="_blank" rel="noopener noreferrer">#8444</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Added a function <code>geoDistance</code>. It is similar to <code>greatCircleDistance</code> but uses approximation to WGS-84 ellipsoid model. The performance of both functions are near the same. <a href="https://github.com/ClickHouse/ClickHouse/pull/8086" target="_blank" rel="noopener noreferrer">#8086</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Faster <code>min</code> and <code>max</code> aggregation functions for <code>Decimal</code> data type. <a href="https://github.com/ClickHouse/ClickHouse/pull/8144" target="_blank" rel="noopener noreferrer">#8144</a> (<a href="https://github.com/4ertus2" target="_blank" rel="noopener noreferrer">Artem Zuikov</a>)</li><li>Vectorize processing <code>arrayReduce</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7608" target="_blank" rel="noopener noreferrer">#7608</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li><code>if</code> chains are now optimized as <code>multiIf</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8355" target="_blank" rel="noopener noreferrer">#8355</a> (<a href="https://github.com/kamalov-ruslan" target="_blank" rel="noopener noreferrer">kamalov-ruslan</a>)</li><li>Fix performance regression of <code>Kafka</code> table engine introduced in 19.15. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/7261" target="_blank" rel="noopener noreferrer">#7261</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7935" target="_blank" rel="noopener noreferrer">#7935</a> (<a href="https://github.com/filimonov" target="_blank" rel="noopener noreferrer">filimonov</a>)</li><li>Removed &quot;pie&quot; code generation that <code>gcc</code> from Debian packages occasionally brings by default. <a href="https://github.com/ClickHouse/ClickHouse/pull/8483" target="_blank" rel="noopener noreferrer">#8483</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Parallel parsing data formats <a href="https://github.com/ClickHouse/ClickHouse/pull/6553" target="_blank" rel="noopener noreferrer">#6553</a> (<a href="https://github.com/nikitamikhaylov" target="_blank" rel="noopener noreferrer">Nikita Mikhaylov</a>)</li><li>Enable optimized parser of <code>Values</code> with expressions by default (<code>input_format_values_deduce_templates_of_expressions=1</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8231" target="_blank" rel="noopener noreferrer">#8231</a> (<a href="https://github.com/tavplubix" target="_blank" rel="noopener noreferrer">tavplubix</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildtestingpackaging-improvement-25">Build/Testing/Packaging Improvement<a class="hash-link" href="#buildtestingpackaging-improvement-25" title="Direct link to heading">​</a></h4><ul><li>Build fixes for <code>ARM</code> and in minimal mode. <a href="https://github.com/ClickHouse/ClickHouse/pull/8304" target="_blank" rel="noopener noreferrer">#8304</a> (<a href="https://github.com/proller" target="_blank" rel="noopener noreferrer">proller</a>)</li><li>Add coverage file flush for <code>clickhouse-server</code> when std::atexit is not called. Also slightly improved logging in stateless tests with coverage. <a href="https://github.com/ClickHouse/ClickHouse/pull/8267" target="_blank" rel="noopener noreferrer">#8267</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Update LLVM library in contrib. Avoid using LLVM from OS packages. <a href="https://github.com/ClickHouse/ClickHouse/pull/8258" target="_blank" rel="noopener noreferrer">#8258</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Make bundled <code>curl</code> build fully quiet. <a href="https://github.com/ClickHouse/ClickHouse/pull/8232" target="_blank" rel="noopener noreferrer">#8232</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8203" target="_blank" rel="noopener noreferrer">#8203</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>)</li><li>Fix some <code>MemorySanitizer</code> warnings. <a href="https://github.com/ClickHouse/ClickHouse/pull/8235" target="_blank" rel="noopener noreferrer">#8235</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Use <code>add_warning</code> and <code>no_warning</code> macros in <code>CMakeLists.txt</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8604" target="_blank" rel="noopener noreferrer">#8604</a> (<a href="https://github.com/abyss7" target="_blank" rel="noopener noreferrer">Ivan</a>)</li><li>Add support of Minio S3 Compatible object (<a href="https://min.io/" target="_blank" rel="noopener noreferrer">https://min.io/</a>) for better integration tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/7863" target="_blank" rel="noopener noreferrer">#7863</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/7875" target="_blank" rel="noopener noreferrer">#7875</a> (<a href="https://github.com/Jokser" target="_blank" rel="noopener noreferrer">Pavel Kovalenko</a>)</li><li>Imported <code>libc</code> headers to contrib. It allows to make builds more consistent across various systems (only for <code>x86_64-linux-gnu</code>). <a href="https://github.com/ClickHouse/ClickHouse/pull/5773" target="_blank" rel="noopener noreferrer">#5773</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Remove <code>-fPIC</code> from some libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/8464" target="_blank" rel="noopener noreferrer">#8464</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Clean <code>CMakeLists.txt</code> for curl. See <a href="https://github.com/ClickHouse/ClickHouse/pull/8011#issuecomment-569478910" target="_blank" rel="noopener noreferrer">https://github.com/ClickHouse/ClickHouse/pull/8011#issuecomment-569478910</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8459" target="_blank" rel="noopener noreferrer">#8459</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Silent warnings in <code>CapNProto</code> library. <a href="https://github.com/ClickHouse/ClickHouse/pull/8220" target="_blank" rel="noopener noreferrer">#8220</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Add performance tests for short string optimized hash tables. <a href="https://github.com/ClickHouse/ClickHouse/pull/7679" target="_blank" rel="noopener noreferrer">#7679</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Now ClickHouse will build on <code>AArch64</code> even if <code>MADV_FREE</code> is not available. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8027" target="_blank" rel="noopener noreferrer">#8027</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8243" target="_blank" rel="noopener noreferrer">#8243</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Update <code>zlib-ng</code> to fix memory sanitizer problems. <a href="https://github.com/ClickHouse/ClickHouse/pull/7182" target="_blank" rel="noopener noreferrer">#7182</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8206" target="_blank" rel="noopener noreferrer">#8206</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Enable internal MySQL library on non-Linux system, because usage of OS packages is very fragile and usually does not work at all. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/5765" target="_blank" rel="noopener noreferrer">#5765</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8426" target="_blank" rel="noopener noreferrer">#8426</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed build on some systems after enabling <code>libc++</code>. This supersedes <a href="https://github.com/ClickHouse/ClickHouse/issues/8374" target="_blank" rel="noopener noreferrer">#8374</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8380" target="_blank" rel="noopener noreferrer">#8380</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Make <code>Field</code> methods more type-safe to find more errors. <a href="https://github.com/ClickHouse/ClickHouse/pull/7386" target="_blank" rel="noopener noreferrer">#7386</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8209" target="_blank" rel="noopener noreferrer">#8209</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Added missing files to the <code>libc-headers</code> submodule. <a href="https://github.com/ClickHouse/ClickHouse/pull/8507" target="_blank" rel="noopener noreferrer">#8507</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix wrong <code>JSON</code> quoting in performance test output. <a href="https://github.com/ClickHouse/ClickHouse/pull/8497" target="_blank" rel="noopener noreferrer">#8497</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Now stack trace is displayed for <code>std::exception</code> and <code>Poco::Exception</code>. In previous versions it was available only for <code>DB::Exception</code>. This improves diagnostics. <a href="https://github.com/ClickHouse/ClickHouse/pull/8501" target="_blank" rel="noopener noreferrer">#8501</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Porting <code>clock_gettime</code> and <code>clock_nanosleep</code> for fresh glibc versions. <a href="https://github.com/ClickHouse/ClickHouse/pull/8054" target="_blank" rel="noopener noreferrer">#8054</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Enable <code>part_log</code> in example config for developers. <a href="https://github.com/ClickHouse/ClickHouse/pull/8609" target="_blank" rel="noopener noreferrer">#8609</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix async nature of reload in <code>01036_no_superfluous_dict_reload_on_create_database*</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8111" target="_blank" rel="noopener noreferrer">#8111</a> (<a href="https://github.com/azat" target="_blank" rel="noopener noreferrer">Azat Khuzhin</a>)</li><li>Fixed codec performance tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/8615" target="_blank" rel="noopener noreferrer">#8615</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li>Add install scripts for <code>.tgz</code> build and documentation for them. <a href="https://github.com/ClickHouse/ClickHouse/pull/8612" target="_blank" rel="noopener noreferrer">#8612</a> <a href="https://github.com/ClickHouse/ClickHouse/pull/8591" target="_blank" rel="noopener noreferrer">#8591</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Removed old <code>ZSTD</code> test (it was created in year 2016 to reproduce the bug that pre 1.0 version of ZSTD has had). This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8618" target="_blank" rel="noopener noreferrer">#8618</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8619" target="_blank" rel="noopener noreferrer">#8619</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed build on Mac OS Catalina. <a href="https://github.com/ClickHouse/ClickHouse/pull/8600" target="_blank" rel="noopener noreferrer">#8600</a> (<a href="https://github.com/meob" target="_blank" rel="noopener noreferrer">meo</a>)</li><li>Increased number of rows in codec performance tests to make results noticeable. <a href="https://github.com/ClickHouse/ClickHouse/pull/8574" target="_blank" rel="noopener noreferrer">#8574</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li>In debug builds, treat <code>LOGICAL_ERROR</code> exceptions as assertion failures, so that they are easier to notice. <a href="https://github.com/ClickHouse/ClickHouse/pull/8475" target="_blank" rel="noopener noreferrer">#8475</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Make formats-related performance test more deterministic. <a href="https://github.com/ClickHouse/ClickHouse/pull/8477" target="_blank" rel="noopener noreferrer">#8477</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Update <code>lz4</code> to fix a MemorySanitizer failure. <a href="https://github.com/ClickHouse/ClickHouse/pull/8181" target="_blank" rel="noopener noreferrer">#8181</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Suppress a known MemorySanitizer false positive in exception handling. <a href="https://github.com/ClickHouse/ClickHouse/pull/8182" target="_blank" rel="noopener noreferrer">#8182</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Update <code>gcc</code> and <code>g++</code> to version 9 in <code>build/docker/build.sh</code> <a href="https://github.com/ClickHouse/ClickHouse/pull/7766" target="_blank" rel="noopener noreferrer">#7766</a> (<a href="https://github.com/tlightsky" target="_blank" rel="noopener noreferrer">TLightSky</a>)</li><li>Add performance test case to test that <code>PREWHERE</code> is worse than <code>WHERE</code>.  <a href="https://github.com/ClickHouse/ClickHouse/pull/7768" target="_blank" rel="noopener noreferrer">#7768</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Progress towards fixing one flacky test. <a href="https://github.com/ClickHouse/ClickHouse/pull/8621" target="_blank" rel="noopener noreferrer">#8621</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Avoid MemorySanitizer report for data from <code>libunwind</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8539" target="_blank" rel="noopener noreferrer">#8539</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Updated <code>libc++</code> to the latest version. <a href="https://github.com/ClickHouse/ClickHouse/pull/8324" target="_blank" rel="noopener noreferrer">#8324</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Build ICU library from sources. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/6460" target="_blank" rel="noopener noreferrer">#6460</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8219" target="_blank" rel="noopener noreferrer">#8219</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Switched from <code>libressl</code> to <code>openssl</code>. ClickHouse should support TLS 1.3 and SNI after this change. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8171" target="_blank" rel="noopener noreferrer">#8171</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8218" target="_blank" rel="noopener noreferrer">#8218</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fixed UBSan report when using <code>chacha20_poly1305</code> from SSL (happens on connect to <a href="https://yandex.ru/" target="_blank" rel="noopener noreferrer">https://yandex.ru/</a>). <a href="https://github.com/ClickHouse/ClickHouse/pull/8214" target="_blank" rel="noopener noreferrer">#8214</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix mode of default password file for <code>.deb</code> linux distros. <a href="https://github.com/ClickHouse/ClickHouse/pull/8075" target="_blank" rel="noopener noreferrer">#8075</a> (<a href="https://github.com/proller" target="_blank" rel="noopener noreferrer">proller</a>)</li><li>Improved expression for getting <code>clickhouse-server</code> PID in <code>clickhouse-test</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8063" target="_blank" rel="noopener noreferrer">#8063</a> (<a href="https://github.com/Akazz" target="_blank" rel="noopener noreferrer">Alexander Kazakov</a>)</li><li>Updated contrib/googletest to v1.10.0. <a href="https://github.com/ClickHouse/ClickHouse/pull/8587" target="_blank" rel="noopener noreferrer">#8587</a> (<a href="https://github.com/Alex-Burmak" target="_blank" rel="noopener noreferrer">Alexander Burmak</a>)</li><li>Fixed ThreadSaninitizer report in <code>base64</code> library. Also updated this library to the latest version, but it does not matter. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8397" target="_blank" rel="noopener noreferrer">#8397</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8403" target="_blank" rel="noopener noreferrer">#8403</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Fix <code>00600_replace_running_query</code> for processors. <a href="https://github.com/ClickHouse/ClickHouse/pull/8272" target="_blank" rel="noopener noreferrer">#8272</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Remove support for <code>tcmalloc</code> to make <code>CMakeLists.txt</code> simpler. <a href="https://github.com/ClickHouse/ClickHouse/pull/8310" target="_blank" rel="noopener noreferrer">#8310</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Release gcc builds now use <code>libc++</code> instead of <code>libstdc++</code>. Recently <code>libc++</code> was used only with clang. This will improve consistency of build configurations and portability. <a href="https://github.com/ClickHouse/ClickHouse/pull/8311" target="_blank" rel="noopener noreferrer">#8311</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Enable ICU library for build with MemorySanitizer. <a href="https://github.com/ClickHouse/ClickHouse/pull/8222" target="_blank" rel="noopener noreferrer">#8222</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Suppress warnings from <code>CapNProto</code> library. <a href="https://github.com/ClickHouse/ClickHouse/pull/8224" target="_blank" rel="noopener noreferrer">#8224</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Removed special cases of code for <code>tcmalloc</code>, because it&#x27;s no longer supported. <a href="https://github.com/ClickHouse/ClickHouse/pull/8225" target="_blank" rel="noopener noreferrer">#8225</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>In CI coverage task, kill the server gracefully to allow it to save the coverage report. This fixes incomplete coverage reports we&#x27;ve been seeing lately. <a href="https://github.com/ClickHouse/ClickHouse/pull/8142" target="_blank" rel="noopener noreferrer">#8142</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Performance tests for all codecs against <code>Float64</code> and <code>UInt64</code> values. <a href="https://github.com/ClickHouse/ClickHouse/pull/8349" target="_blank" rel="noopener noreferrer">#8349</a> (<a href="https://github.com/Enmk" target="_blank" rel="noopener noreferrer">Vasily Nemkov</a>)</li><li><code>termcap</code> is very much deprecated and lead to various problems (f.g. missing &quot;up&quot; cap and echoing <code>^J</code> instead of multi line) . Favor <code>terminfo</code> or bundled <code>ncurses</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7737" target="_blank" rel="noopener noreferrer">#7737</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Fix <code>test_storage_s3</code> integration test. <a href="https://github.com/ClickHouse/ClickHouse/pull/7734" target="_blank" rel="noopener noreferrer">#7734</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Support <code>StorageFile(&lt;format&gt;, null) </code> to insert block into given format file without actually write to disk. This is required for performance tests. <a href="https://github.com/ClickHouse/ClickHouse/pull/8455" target="_blank" rel="noopener noreferrer">#8455</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li><li>Added argument <code>--print-time</code> to functional tests which prints execution time per test. <a href="https://github.com/ClickHouse/ClickHouse/pull/8001" target="_blank" rel="noopener noreferrer">#8001</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Added asserts to <code>KeyCondition</code> while evaluating RPN. This will fix warning from gcc-9. <a href="https://github.com/ClickHouse/ClickHouse/pull/8279" target="_blank" rel="noopener noreferrer">#8279</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Dump cmake options in CI builds. <a href="https://github.com/ClickHouse/ClickHouse/pull/8273" target="_blank" rel="noopener noreferrer">#8273</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Don&#x27;t generate debug info for some fat libraries. <a href="https://github.com/ClickHouse/ClickHouse/pull/8271" target="_blank" rel="noopener noreferrer">#8271</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Make <code>log_to_console.xml</code> always log to stderr, regardless of is it interactive or not. <a href="https://github.com/ClickHouse/ClickHouse/pull/8395" target="_blank" rel="noopener noreferrer">#8395</a> (<a href="https://github.com/akuzm" target="_blank" rel="noopener noreferrer">Alexander Kuzmenkov</a>)</li><li>Removed some unused features from <code>clickhouse-performance-test</code> tool. <a href="https://github.com/ClickHouse/ClickHouse/pull/8555" target="_blank" rel="noopener noreferrer">#8555</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Now we will also search for <code>lld-X</code> with corresponding <code>clang-X</code> version. <a href="https://github.com/ClickHouse/ClickHouse/pull/8092" target="_blank" rel="noopener noreferrer">#8092</a> (<a href="https://github.com/alesapin" target="_blank" rel="noopener noreferrer">alesapin</a>)</li><li>Parquet build improvement. <a href="https://github.com/ClickHouse/ClickHouse/pull/8421" target="_blank" rel="noopener noreferrer">#8421</a> (<a href="https://github.com/maxulan" target="_blank" rel="noopener noreferrer">maxulan</a>)</li><li>More GCC warnings <a href="https://github.com/ClickHouse/ClickHouse/pull/8221" target="_blank" rel="noopener noreferrer">#8221</a> (<a href="https://github.com/kreuzerkrieg" target="_blank" rel="noopener noreferrer">kreuzerkrieg</a>)</li><li>Package for Arch Linux now allows to run ClickHouse server, and not only client. <a href="https://github.com/ClickHouse/ClickHouse/pull/8534" target="_blank" rel="noopener noreferrer">#8534</a> (<a href="https://github.com/excitoon" target="_blank" rel="noopener noreferrer">Vladimir Chebotarev</a>)</li><li>Fix test with processors. Tiny performance fixes. <a href="https://github.com/ClickHouse/ClickHouse/pull/7672" target="_blank" rel="noopener noreferrer">#7672</a> (<a href="https://github.com/KochetovNicolai" target="_blank" rel="noopener noreferrer">Nikolai Kochetov</a>)</li><li>Update contrib/protobuf. <a href="https://github.com/ClickHouse/ClickHouse/pull/8256" target="_blank" rel="noopener noreferrer">#8256</a> (<a href="https://github.com/matwey" target="_blank" rel="noopener noreferrer">Matwey V. Kornilov</a>)</li><li>In preparation of switching to c++20 as a new year celebration. &quot;May the C++ force be with ClickHouse.&quot; <a href="https://github.com/ClickHouse/ClickHouse/pull/8447" target="_blank" rel="noopener noreferrer">#8447</a> (<a href="https://github.com/amosbird" target="_blank" rel="noopener noreferrer">Amos Bird</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="experimental-feature-8">Experimental Feature<a class="hash-link" href="#experimental-feature-8" title="Direct link to heading">​</a></h4><ul><li>Added experimental setting <code>min_bytes_to_use_mmap_io</code>. It allows to read big files without copying data from kernel to userspace. The setting is disabled by default. Recommended threshold is about 64 MB, because mmap/munmap is slow. <a href="https://github.com/ClickHouse/ClickHouse/pull/8520" target="_blank" rel="noopener noreferrer">#8520</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li><li>Reworked quotas as a part of access control system. Added new table <code>system.quotas</code>, new functions <code>currentQuota</code>, <code>currentQuotaKey</code>, new SQL syntax <code>CREATE QUOTA</code>, <code>ALTER QUOTA</code>, <code>DROP QUOTA</code>, <code>SHOW QUOTA</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7257" target="_blank" rel="noopener noreferrer">#7257</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Allow skipping unknown settings with warnings instead of throwing exceptions. <a href="https://github.com/ClickHouse/ClickHouse/pull/7653" target="_blank" rel="noopener noreferrer">#7653</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li><li>Reworked row policies as a part of access control system. Added new table <code>system.row_policies</code>, new function <code>currentRowPolicies()</code>, new SQL syntax <code>CREATE POLICY</code>, <code>ALTER POLICY</code>, <code>DROP POLICY</code>, <code>SHOW CREATE POLICY</code>, <code>SHOW POLICIES</code>. <a href="https://github.com/ClickHouse/ClickHouse/pull/7808" target="_blank" rel="noopener noreferrer">#7808</a> (<a href="https://github.com/vitlibar" target="_blank" rel="noopener noreferrer">Vitaly Baranov</a>)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="security-fix">Security Fix<a class="hash-link" href="#security-fix" title="Direct link to heading">​</a></h4><ul><li>Fixed the possibility of reading directories structure in tables with <code>File</code> table engine. This fixes <a href="https://github.com/ClickHouse/ClickHouse/issues/8536" target="_blank" rel="noopener noreferrer">#8536</a>. <a href="https://github.com/ClickHouse/ClickHouse/pull/8537" target="_blank" rel="noopener noreferrer">#8537</a> (<a href="https://github.com/alexey-milovidov" target="_blank" rel="noopener noreferrer">alexey-milovidov</a>)</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="changelog-for-2019"><a href="https://github.com/ClickHouse/ClickHouse/blob/master/docs/en/whats-new/changelog/2019.md" target="_blank" rel="noopener noreferrer">Changelog for 2019</a><a class="hash-link" href="#changelog-for-2019" title="Direct link to heading">​</a></h2></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/staging3/docs/en/whats-new/changelog/2021"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">2021</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/staging3/docs/en/whats-new/changelog/2019"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">2019</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#clickhouse-release-2012" class="table-of-contents__link toc-highlight">ClickHouse release 20.12</a></li><li><a href="#clickhouse-release-v2012514-stable-2020-12-28" class="table-of-contents__link toc-highlight">ClickHouse release v20.12.5.14-stable, 2020-12-28</a></li><li><a href="#clickhouse-release-v201245-stable-2020-12-24" class="table-of-contents__link toc-highlight">ClickHouse release v20.12.4.5-stable, 2020-12-24</a></li><li><a href="#clickhouse-release-v201233-stable-2020-12-13" class="table-of-contents__link toc-highlight">ClickHouse release v20.12.3.3-stable, 2020-12-13</a></li><li><a href="#clickhouse-release-2011" class="table-of-contents__link toc-highlight">ClickHouse release 20.11</a><ul><li><a href="#clickhouse-release-v2011716-stable-2021-03-02" class="table-of-contents__link toc-highlight">ClickHouse release v20.11.7.16-stable, 2021-03-02</a></li><li><a href="#clickhouse-release-v201166-stable-2020-12-24" class="table-of-contents__link toc-highlight">ClickHouse release v20.11.6.6-stable, 2020-12-24</a></li><li><a href="#clickhouse-release-v201133-stable-2020-11-13" class="table-of-contents__link toc-highlight">ClickHouse release v20.11.3.3-stable, 2020-11-13</a></li><li><a href="#clickhouse-release-v201121-2020-11-11" class="table-of-contents__link toc-highlight">ClickHouse release v20.11.2.1, 2020-11-11</a></li></ul></li><li><a href="#clickhouse-release-2010" class="table-of-contents__link toc-highlight">ClickHouse release 20.10</a><ul><li><a href="#clickhouse-release-v201074-stable-2020-12-24" class="table-of-contents__link toc-highlight">ClickHouse release v20.10.7.4-stable, 2020-12-24</a></li><li><a href="#clickhouse-release-v201041-stable-2020-11-13" class="table-of-contents__link toc-highlight">ClickHouse release v20.10.4.1-stable, 2020-11-13</a></li><li><a href="#clickhouse-release-v2010330-2020-10-28" class="table-of-contents__link toc-highlight">ClickHouse release v20.10.3.30, 2020-10-28</a></li></ul></li><li><a href="#clickhouse-release-209" class="table-of-contents__link toc-highlight">ClickHouse release 20.9</a><ul><li><a href="#clickhouse-release-v209711-stable-2020-12-07" class="table-of-contents__link toc-highlight">ClickHouse release v20.9.7.11-stable, 2020-12-07</a></li><li><a href="#clickhouse-release-v209614-stable-2020-11-20" class="table-of-contents__link toc-highlight">ClickHouse release v20.9.6.14-stable, 2020-11-20</a></li><li><a href="#clickhouse-release-v20955-stable-2020-11-13" class="table-of-contents__link toc-highlight">ClickHouse release v20.9.5.5-stable, 2020-11-13</a></li><li><a href="#clickhouse-release-v209476-stable-2020-10-29" class="table-of-contents__link toc-highlight">ClickHouse release v20.9.4.76-stable (2020-10-29)</a></li><li><a href="#clickhouse-release-v209345-stable-2020-10-09" class="table-of-contents__link toc-highlight">ClickHouse release v20.9.3.45-stable (2020-10-09)</a></li><li><a href="#clickhouse-release-v209220-2020-09-22" class="table-of-contents__link toc-highlight">ClickHouse release v20.9.2.20, 2020-09-22</a></li></ul></li><li><a href="#clickhouse-release-208" class="table-of-contents__link toc-highlight">ClickHouse release 20.8</a><ul><li><a href="#clickhouse-release-v208122-lts-2021-01-16" class="table-of-contents__link toc-highlight">ClickHouse release v20.8.12.2-lts, 2021-01-16</a></li><li><a href="#clickhouse-release-v2081117-lts-2020-12-25" class="table-of-contents__link toc-highlight">ClickHouse release v20.8.11.17-lts, 2020-12-25</a></li><li><a href="#clickhouse-release-v2081013-lts-2020-12-24" class="table-of-contents__link toc-highlight">ClickHouse release v20.8.10.13-lts, 2020-12-24</a></li><li><a href="#clickhouse-release-v20866-lts-2020-11-13" class="table-of-contents__link toc-highlight">ClickHouse release v20.8.6.6-lts, 2020-11-13</a></li><li><a href="#clickhouse-release-v208545-lts-2020-10-29" class="table-of-contents__link toc-highlight">ClickHouse release v20.8.5.45-lts, 2020-10-29</a></li><li><a href="#clickhouse-release-v208411-lts-2020-10-09" class="table-of-contents__link toc-highlight">ClickHouse release v20.8.4.11-lts, 2020-10-09</a></li><li><a href="#clickhouse-release-v208318-stable-2020-09-18" class="table-of-contents__link toc-highlight">ClickHouse release v20.8.3.18-stable, 2020-09-18</a></li><li><a href="#clickhouse-release-v20823-stable-2020-09-08" class="table-of-contents__link toc-highlight">ClickHouse release v20.8.2.3-stable, 2020-09-08</a></li></ul></li><li><a href="#clickhouse-release-207" class="table-of-contents__link toc-highlight">ClickHouse release 20.7</a><ul><li><a href="#clickhouse-release-v207230-stable-2020-08-31" class="table-of-contents__link toc-highlight">ClickHouse release v20.7.2.30-stable, 2020-08-31</a></li></ul></li><li><a href="#clickhouse-release-206" class="table-of-contents__link toc-highlight">ClickHouse release 20.6</a><ul><li><a href="#clickhouse-release-v206328-stable" class="table-of-contents__link toc-highlight">ClickHouse release v20.6.3.28-stable</a></li></ul></li><li><a href="#clickhouse-release-205" class="table-of-contents__link toc-highlight">ClickHouse release 20.5</a><ul><li><a href="#clickhouse-release-v205440-stable-2020-08-10" class="table-of-contents__link toc-highlight">ClickHouse release v20.5.4.40-stable 2020-08-10</a></li><li><a href="#clickhouse-release-v20527-stable-2020-07-02" class="table-of-contents__link toc-highlight">ClickHouse release v20.5.2.7-stable 2020-07-02</a></li></ul></li><li><a href="#clickhouse-release-v204" class="table-of-contents__link toc-highlight">ClickHouse release v20.4</a><ul><li><a href="#clickhouse-release-v204899-stable-2020-08-10" class="table-of-contents__link toc-highlight">ClickHouse release v20.4.8.99-stable 2020-08-10</a></li><li><a href="#clickhouse-release-v204653-stable-2020-06-25" class="table-of-contents__link toc-highlight">ClickHouse release v20.4.6.53-stable 2020-06-25</a></li><li><a href="#clickhouse-release-v204536-stable-2020-06-10" class="table-of-contents__link toc-highlight">ClickHouse release v20.4.5.36-stable 2020-06-10</a></li><li><a href="#clickhouse-release-v204418-stable-2020-05-26" class="table-of-contents__link toc-highlight">ClickHouse release v20.4.4.18-stable 2020-05-26</a></li><li><a href="#clickhouse-release-v204316-stable-2020-05-23" class="table-of-contents__link toc-highlight">ClickHouse release v20.4.3.16-stable 2020-05-23</a></li><li><a href="#clickhouse-release-v20429-2020-05-12" class="table-of-contents__link toc-highlight">ClickHouse release v20.4.2.9, 2020-05-12</a></li></ul></li><li><a href="#clickhouse-release-v203" class="table-of-contents__link toc-highlight">ClickHouse release v20.3</a><ul><li><a href="#clickhouse-release-v203212-lts-2020-11-02" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.21.2-lts, 2020-11-02</a></li><li><a href="#clickhouse-release-v203206-lts-2020-10-09" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.20.6-lts, 2020-10-09</a></li><li><a href="#clickhouse-release-v203194-lts-2020-09-18" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.19.4-lts, 2020-09-18</a></li><li><a href="#clickhouse-release-v2031810-lts-2020-09-08" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.18.10-lts, 2020-09-08</a></li><li><a href="#clickhouse-release-v20317173-lts-2020-08-15" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.17.173-lts, 2020-08-15</a></li><li><a href="#clickhouse-release-v20316165-lts-2020-08-10" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.16.165-lts 2020-08-10</a></li><li><a href="#clickhouse-release-v20312112-lts-2020-06-25" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.12.112-lts 2020-06-25</a></li><li><a href="#clickhouse-release-v2031197-lts-2020-06-10" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.11.97-lts 2020-06-10</a></li><li><a href="#clickhouse-release-v2031075-lts-2020-05-23" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.10.75-lts 2020-05-23</a></li><li><a href="#clickhouse-release-v203853-2020-04-23" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.8.53, 2020-04-23</a></li><li><a href="#clickhouse-release-v203746-2020-04-17" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.7.46, 2020-04-17</a></li><li><a href="#clickhouse-release-v203640-2020-04-16" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.6.40, 2020-04-16</a></li><li><a href="#clickhouse-release-v203521-2020-03-27" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.5.21, 2020-03-27</a></li><li><a href="#clickhouse-release-v203410-2020-03-20" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.4.10, 2020-03-20</a></li><li><a href="#clickhouse-release-v20336-2020-03-17" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.3.6, 2020-03-17</a></li><li><a href="#clickhouse-release-v20321-2020-03-12" class="table-of-contents__link toc-highlight">ClickHouse release v20.3.2.1, 2020-03-12</a></li></ul></li><li><a href="#clickhouse-release-v201" class="table-of-contents__link toc-highlight">ClickHouse release v20.1</a><ul><li><a href="#clickhouse-release-v20116120-stable-2020-60-26" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.16.120-stable 2020-60-26</a></li><li><a href="#clickhouse-release-v20115109-stable-2020-06-19" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.15.109-stable 2020-06-19</a></li><li><a href="#clickhouse-release-v20114107-stable-2020-06-11" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.14.107-stable 2020-06-11</a></li><li><a href="#clickhouse-release-v20113105-stable-2020-06-10" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.13.105-stable 2020-06-10</a></li><li><a href="#clickhouse-release-v2011286-2020-05-26" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.12.86, 2020-05-26</a></li><li><a href="#clickhouse-release-v2011070-2020-04-17" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.10.70, 2020-04-17</a></li><li><a href="#clickhouse-release-v201954-2020-03-28" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.9.54, 2020-03-28</a></li><li><a href="#clickhouse-release-v201841-2020-03-20" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.8.41, 2020-03-20</a></li><li><a href="#clickhouse-release-v201738-2020-03-18" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.7.38, 2020-03-18</a></li><li><a href="#clickhouse-release-v201630-2020-03-05" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.6.30, 2020-03-05</a></li><li><a href="#clickhouse-release-v20124-2020-01-22" class="table-of-contents__link toc-highlight">ClickHouse release v20.1.2.4, 2020-01-22</a></li></ul></li><li><a href="#changelog-for-2019" class="table-of-contents__link toc-highlight">Changelog for 2019</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ClickHouse</div><ul class="footer__items"><li class="footer__item"><a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Company</a></li><li class="footer__item"><a href="https://clickhouse.com/cloud/" target="_blank" rel="noopener noreferrer" class="footer__link-item">ClickHouse as a Service</a></li><li class="footer__item"><a href="https://clickhouse.com/careers/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers</a></li><li class="footer__item"><a href="https://clickhouse.com/learn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Learn ClickHouse</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ClickHouse/ClickHouse" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://clickhouse.com/blog/en/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/c/ClickHouseDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ClickHouseDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/clickhousedb/shared_invite/zt-rxm3rdrk-lIUmhLC3V8WTaL0TGxsOmg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Policies</div><ul class="footer__items"><li class="footer__item"><a href="https://clickhouse.com/legal/trademark-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trademark Policy</a></li><li class="footer__item"><a href="https://clickhouse.com/legal/privacy-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li><li class="footer__item"><a href="https://clickhouse.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/docs/staging3/img/logo.png" alt="ClickHouse Documentation" class="themedImage_W2Cr themedImage--light_TfLj footer__logo"><img src="/docs/staging3/img/logo.png" alt="ClickHouse Documentation" class="themedImage_W2Cr themedImage--dark_oUvU footer__logo"></div><div class="footer__copyright">Copyright © 2016 - 2022 ClickHouse, Inc. ClickHouse Docs provided under the Creative Commons CC BY-NC-SA license. ClickHouse is a registered trademark of ClickHouse, Inc.</div></div></div></footer></div>
<script src="/docs/staging3/assets/js/runtime~main.1413fc46.js"></script>
<script src="/docs/staging3/assets/js/main.4e67e7ae.js"></script>
</body>
</html>