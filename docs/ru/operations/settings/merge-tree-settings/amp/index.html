










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="ru">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>Настройки MergeTree таблиц | Документация ClickHouse</title>
    <link rel="canonical" href="https://clickhouse.com/docs/ru/operations/settings/merge-tree-settings/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer{display:block}body{margin:0;font-family:Noto Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}ul{margin-bottom:1rem}ul{margin-top:0}ul ul{margin-bottom:0}b,strong{font-weight:bolder}a{text-decoration:none;background-color:transparent}a,a:hover{color:#ff8c00}a:hover{text-decoration:underline}a:not([href]),a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:Hind Siliguri,sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#495057}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}.order-md-0{order:0}.order-md-1{order:1}.order-md-2{order:2}.order-md-3{order:3}.order-md-4{order:4}.order-md-5{order:5}.order-md-6{order:6}.order-md-7{order:7}.order-md-8{order:8}.order-md-9{order:9}.order-md-10{order:10}.order-md-11{order:11}.order-md-12{order:12}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}.order-lg-0{order:0}.order-lg-1{order:1}.order-lg-2{order:2}.order-lg-3{order:3}.order-lg-4{order:4}.order-lg-5{order:5}.order-lg-6{order:6}.order-lg-7{order:7}.order-lg-8{order:8}.order-lg-9{order:9}.order-lg-10{order:10}.order-lg-11{order:11}.order-lg-12{order:12}}.table{width:100%;margin-bottom:8px;color:#212529}.table-light{background-color:#fbfcfd}.table-dark{background-color:#ccced0}.table-white{background-color:#fff}.table-black{background-color:#c1c2c3}.table-orange{background-color:#ffdfb8}.table-light-orange{background-color:#fff7ea}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:focus,.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:focus,.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:focus,.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:focus,.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:focus,.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:focus,.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 hsla(0,0%,100%,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}pre{white-space:pre-wrap}pre{border:1px solid #d6dbdf;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}.container,body{min-width:980px}.table{border-collapse:collapse}.table-dark{color:inherit}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/docs/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/docs/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h1 id=merge-tree-settings>Настройки MergeTree таблиц<a class=headerlink href=../amp/#merge-tree-settings title="Permanent link"> </a></h1> <p>Значения настроек всех MergeTree таблиц собраны в таблице <code class=syntax>system.merge_tree_settings</code>. Их можно переопределить в разделе <code class=syntax>merge_tree</code> файла <code class=syntax>config.xml</code> или задать в секции <code class=syntax>SETTINGS</code> каждой таблицы.</p> <p>Пример переопределения в <code class=syntax>config.xml</code>:</p> <div class=codehilite><pre><span></span><code class=syntax>&lt;merge_tree&gt;
    &lt;max_suspicious_broken_parts&gt;5&lt;/max_suspicious_broken_parts&gt;
&lt;/merge_tree&gt;
</code></pre></div> <p>Пример установки <code class=syntax>SETTINGS</code> для конкретной таблицы:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>foo</span><span class=w></span>
<span class=p>(</span><span class=w></span>
<span class=w>    </span><span class=o>`</span><span class=n>A</span><span class=o>`</span><span class=w> </span><span class=n>Int64</span><span class=w></span>
<span class=p>)</span><span class=w></span>
<span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MergeTree</span><span class=w></span>
<span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>tuple</span><span class=p>()</span><span class=w></span>
<span class=n>SETTINGS</span><span class=w> </span><span class=n>max_suspicious_broken_parts</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>500</span><span class=p>;</span><span class=w></span>
</code></pre></div> <p>Пример изменения настроек для конкретной таблицы при помощи команды <code class=syntax>ALTER TABLE ... MODIFY SETTING</code>:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>ALTER</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>foo</span><span class=w></span>
<span class=w>    </span><span class=k>MODIFY</span><span class=w> </span><span class=n>SETTING</span><span class=w> </span><span class=n>max_suspicious_broken_parts</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span><span class=w></span>
</code></pre></div> <h2 id=parts-to-throw-insert>parts_to_throw_insert<a class=headerlink href=../amp/#parts-to-throw-insert title="Permanent link"> </a></h2> <p>Eсли число активных кусков в партиции больше значения <code class=syntax>parts_to_throw_insert</code>, то INSERT прерывается с исключением: <code class=syntax>Too many parts (N). Merges are processing significantly slower than inserts</code>.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 300.</p> <p>Чтобы производительность запросов <code class=syntax>SELECT</code> стала максимальной, необходимо минимизировать количество обрабатываемых кусков, см. <a href=../../../../development/architecture/amp/#merge-tree>Дизайн MergeTree</a>.</p> <p>Можно установить значение больше — 600 (1200) кусков. Тогда ошибка <code class=syntax>Too many parts</code> будет появляться реже, но при этом могут возникнуть проблемы с фоновыми слияниями и производительностью <code class=syntax>SELECT</code>-запросов.</p> <h2 id=parts-to-delay-insert>parts_to_delay_insert<a class=headerlink href=../amp/#parts-to-delay-insert title="Permanent link"> </a></h2> <p>Eсли число кусков в партиции больше значения <code class=syntax>parts_to_delay_insert</code>, то <code class=syntax>INSERT</code> искусственно замедляется.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 150.</p> <p>ClickHouse искусственно выполняет <code class=syntax>INSERT</code> дольше (добавляет ‘sleep’) так, чтобы куски сливались в фоновом процессе быстрее, чем добавляются.</p> <h2 id=inactive-parts-to-throw-insert>inactive_parts_to_throw_insert<a class=headerlink href=../amp/#inactive-parts-to-throw-insert title="Permanent link"> </a></h2> <p>Если число неактивных кусков в партиции больше значения <code class=syntax>inactive_parts_to_throw_insert</code>, то <code class=syntax>INSERT</code> прерывается с исключением <code class=syntax>Too many inactive parts (N). Parts cleaning are processing significantly slower than inserts</code>.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 0 (без ограничений).</p> <h2 id=inactive-parts-to-delay-insert>inactive_parts_to_delay_insert<a class=headerlink href=../amp/#inactive-parts-to-delay-insert title="Permanent link"> </a></h2> <p>Если число неактивных кусков в партиции больше или равно значению <code class=syntax>inactive_parts_to_delay_insert</code>, то <code class=syntax>INSERT</code> искусственно замедляется. Это помогает, когда сервер не может быстро очистить неактивные куски.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 0 (без ограничений).</p> <h2 id=max-delay-to-insert>max_delay_to_insert<a class=headerlink href=../amp/#max-delay-to-insert title="Permanent link"> </a></h2> <p>Величина в секундах, которая используется для расчета задержки <code class=syntax>INSERT</code> в случаях, когда число кусков в партиции больше значения <a href=../amp/#parts-to-delay-insert>parts_to_delay_insert</a>.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 1.</p> <p>Величина задержки (в миллисекундах) для <code class=syntax>INSERT</code> вычисляется по формуле:</p> <div class=codehilite><pre><span></span><code class=syntax>max_k = parts_to_throw_insert - parts_to_delay_insert
k = 1 + parts_count_in_partition - parts_to_delay_insert
delay_milliseconds = pow(max_delay_to_insert * 1000, k / max_k)
</code></pre></div> <p>Т.е. если в партиции уже 299 кусков и parts_to_throw_insert = 300, parts_to_delay_insert = 150, а max_delay_to_insert = 1, то <code class=syntax>INSERT</code> замедлится на <code class=syntax>pow( 1 * 1000, (1 + 299 - 150) / (300 - 150) ) = 1000</code> миллисекунд.</p> <h2 id=max-parts-in-total>max_parts_in_total<a class=headerlink href=../amp/#max-parts-in-total title="Permanent link"> </a></h2> <p>Eсли суммарное число активных кусков во всех партициях таблицы больше значения <code class=syntax>max_parts_in_total</code>, то INSERT прерывается с исключением <code class=syntax>Too many parts (N)</code>.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 100000.</p> <p>С большим числом кусков в таблице производительность запросов ClickHouse снижается, а время старта ClickHouse — увеличивается. Чаще всего это следствие неправильного дизайна (ошибки выбора стратегии партиционирования, например, слишком мелкие партиции).</p> <h2 id=replicated-deduplication-window>replicated_deduplication_window<a class=headerlink href=../amp/#replicated-deduplication-window title="Permanent link"> </a></h2> <p>Количество хеш-сумм последних вставленных блоков, которые хранятся в Zookeeper.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> <li>0 (без ограничений).</li> </ul> <p>Значение по умолчанию: 100.</p> <p>Команда <code class=syntax>Insert</code> создает один или несколько блоков (кусков). При вставке в Replicated таблицы ClickHouse для <a href=../../../../engines/table-engines/mergetree-family/replication/amp/ >дедупликации вставок</a> записывает в Zookeeper хеш-суммы созданных кусков. Но хранятся только последние <code class=syntax>replicated_deduplication_window</code> хеш-сумм. Самые старые хеш-суммы удаляются из Zookeeper.<br> Большое значение <code class=syntax>replicated_deduplication_window</code> замедляет <code class=syntax>Insert</code>, так как приходится сравнивать большее количество хеш-сумм.<br> Хеш-сумма рассчитывается по названиям и типам полей, а также по данным вставленного куска (потока байт).</p> <h2 id=non-replicated-deduplication-window>non_replicated_deduplication_window<a class=headerlink href=../amp/#non-replicated-deduplication-window title="Permanent link"> </a></h2> <p>Количество последних вставленных блоков в нереплицированной <a href=../../../../engines/table-engines/mergetree-family/mergetree/amp/ >MergeTree</a> таблице, для которых хранятся хеш-суммы для проверки дубликатов.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> <li>0 (дедупликация отключена).</li> </ul> <p>Значение по умолчанию: 0.</p> <p>Используется механизм дедупликации, аналогичный реплицированным таблицам (см. описание настройки <a href=../amp/#replicated-deduplication-window>replicated_deduplication_window</a>). Хеш-суммы вставленных кусков записываются в локальный файл на диске.</p> <h2 id=replicated-deduplication-window-seconds>replicated_deduplication_window_seconds<a class=headerlink href=../amp/#replicated-deduplication-window-seconds title="Permanent link"> </a></h2> <p>Время хранения (в секундах) хеш-сумм вставленных блоков в Zookeeper. По истечении этого времени хеш-суммы удаляются.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 604800 (1 неделя).</p> <p>Аналогично <a href=../amp/#replicated-deduplication-window>replicated_deduplication_window</a>, настройка <code class=syntax>replicated_deduplication_window_seconds</code> задает время хранения хеш-сумм блоков для дедупликции <code class=syntax>Insert</code>. Хеш-суммы старше значения <code class=syntax>replicated_deduplication_window_seconds</code> удаляются из Zookeeper, даже если количество оставшихся хеш-сумм станет меньше чем <code class=syntax>replicated_deduplication_window</code>.</p> <h2 id=old-parts-lifetime>old_parts_lifetime<a class=headerlink href=../amp/#old-parts-lifetime title="Permanent link"> </a></h2> <p>Время (в секундах) хранения неактивных кусков для защиты от потери данных при спонтанной перезагрузке сервера.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 480.</p> <p>После объединения нескольких кусков в один новый ClickHouse помечает исходные куски как неактивные и удаляет их по прошествии <code class=syntax>old_parts_lifetime</code> секунд.<br> Неактивные куски удаляются, если они не нужны для текущих запросов, т.е. если счетчик ссылок куска <code class=syntax>refcount</code> имеет нулевое значение.</p> <p>При записи нового куска <code class=syntax>fsync</code> не вызывается, поэтому неактивные куски удаляются позже. Это значит, что некоторое время новый кусок находится только в оперативной памяти сервера (кеш ОС). Если сервер перезагрузится спонтанно, новый слитый кусок может испортиться или потеряться.</p> <p>Во время запуска сервер ClickHouse проверяет целостность кусков.<br> Если новый (слитый) кусок поврежден, ClickHouse возвращает неактивные куски в список активных и позже снова выполняет слияние. В этом случае испорченный кусок получает новое имя (добавляется префикс <code class=syntax>broken_</code>) и попадает в каталог <code class=syntax>detached</code>.<br> Если проверка целостности не выявляет проблем в слитом куске, то исходные неактивные куски переименовываются (добавляется префикс <code class=syntax>ignored_</code>) и перемещаются в каталог <code class=syntax>detached</code>.</p> <p>Стандартное для Linux значение <code class=syntax>dirty_expire_centisecs</code> — 30 секунд. Это максимальное время, в течение которого записанные данные хранятся только в оперативной памяти. Если нагрузка на дисковую систему большая, то данные записываются намного позже. Значение 480 секунд подобрали экспериментальным путем — это время, за которое новый кусок гарантированно запишется на диск.</p> <h2 id=replicated_fetches_http_connection_timeout>replicated_fetches_http_connection_timeout<a class=headerlink href=../amp/#replicated_fetches_http_connection_timeout title="Permanent link"> </a></h2> <p>Тайм-аут HTTP-соединения (в секундах) для запросов на скачивание кусков. Наследуется из профиля по умолчанию <a href=../../settings/amp/#http_connection_timeout>http_connection_timeout</a>, если не задан явно.</p> <p>Возможные значения:</p> <ul> <li>0 - используется значение <code class=syntax>http_connection_timeout</code>.</li> <li>Любое положительное целое число.</li> </ul> <p>Значение по умолчанию: <code class=syntax>0</code>.</p> <h2 id=replicated_fetches_http_send_timeout>replicated_fetches_http_send_timeout<a class=headerlink href=../amp/#replicated_fetches_http_send_timeout title="Permanent link"> </a></h2> <p>Тайм-аут (в секундах) для отправки HTTP-запросов на скачивание кусков. Наследуется из профиля по умолчанию <a href=../../settings/amp/#http_send_timeout>http_send_timeout</a>, если не задан явно.</p> <p>Возможные значения:</p> <ul> <li>0 - используется значение <code class=syntax>http_send_timeout</code>.</li> <li>Любое положительное целое число.</li> </ul> <p>Значение по умолчанию: <code class=syntax>0</code>.</p> <h2 id=replicated_fetches_http_receive_timeout>replicated_fetches_http_receive_timeout<a class=headerlink href=../amp/#replicated_fetches_http_receive_timeout title="Permanent link"> </a></h2> <p>Тайм-аут (в секундах) для получения HTTP-запросов на скачивание кусков. Наследуется из профиля по умолчанию <a href=../../settings/amp/#http_receive_timeout>http_receive_timeout</a>, если не задан явно.</p> <p>Возможные значения:</p> <ul> <li>0 - используется значение <code class=syntax>http_receive_timeout</code>.</li> <li>Любое положительное целое число.</li> </ul> <p>Значение по умолчанию: <code class=syntax>0</code>.</p> <h2 id=max_replicated_fetches_network_bandwidth>max_replicated_fetches_network_bandwidth<a class=headerlink href=../amp/#max_replicated_fetches_network_bandwidth title="Permanent link"> </a></h2> <p>Ограничивает максимальную скорость скачивания данных в сети (в байтах в секунду) для синхронизаций между <a href=../../../../engines/table-engines/mergetree-family/replication/amp/ >репликами</a>. Настройка применяется к конкретной таблице, в отличие от <a href=../../settings/amp/#max_replicated_fetches_network_bandwidth_for_server>max_replicated_fetches_network_bandwidth_for_server</a>, которая применяется к серверу.</p> <p>Можно ограничить скорость обмена данными как для всего сервера, так и для конкретной таблицы, но для этого значение табличной настройки должно быть меньше серверной. Иначе сервер будет учитывать только настройку <code class=syntax>max_replicated_fetches_network_bandwidth_for_server</code>.</p> <p>Настройка соблюдается неточно.</p> <p>Возможные значения:</p> <ul> <li>Любое целое положительное число.</li> <li>0 — Скорость не ограничена.</li> </ul> <p>Значение по умолчанию: <code class=syntax>0</code>.</p> <p><strong>Использование</strong></p> <p>Может быть использована для ограничения скорости передачи данных при репликации данных для добавления или замены новых узлов.</p> <h2 id=max_replicated_sends_network_bandwidth>max_replicated_sends_network_bandwidth<a class=headerlink href=../amp/#max_replicated_sends_network_bandwidth title="Permanent link"> </a></h2> <p>Ограничивает максимальную скорость отправки данных по сети (в байтах в секунду) для синхронизации между <a href=../../../../engines/table-engines/mergetree-family/replication/amp/ >репликами</a>. Настройка применяется к конкретной таблице, в отличие от <a href=../../settings/amp/#max_replicated_sends_network_bandwidth_for_server>max_replicated_sends_network_bandwidth_for_server</a>, которая применяется к серверу.</p> <p>Можно ограничить скорость обмена данными как для всего сервера, так и для конкретной таблицы, но для этого значение табличной настройки должно быть меньше серверной. Иначе сервер будет учитывать только настройку <code class=syntax>max_replicated_sends_network_bandwidth_for_server</code>.</p> <p>Настройка следуется неточно.</p> <p>Возможные значения:</p> <ul> <li>Любое целое положительное число.</li> <li>0 — Скорость не ограничена.</li> </ul> <p>Значение по умолчанию: <code class=syntax>0</code>.</p> <p><strong>Использование</strong></p> <p>Может быть использована для ограничения скорости сети при репликации данных для добавления или замены новых узлов.</p> <h2 id=max-bytes-to-merge-at-max-space-in-pool>max_bytes_to_merge_at_max_space_in_pool<a class=headerlink href=../amp/#max-bytes-to-merge-at-max-space-in-pool title="Permanent link"> </a></h2> <p>Максимальный суммарный размер кусков (в байтах) в одном слиянии, если есть свободные ресурсы в фоновом пуле.<br> <code class=syntax>max_bytes_to_merge_at_max_space_in_pool</code> примерно соответствует максимально возможному размеру куска, созданного автоматическим фоновым слиянием.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 161061273600 (150ГБ).</p> <p>Планировщик слияний периодически анализирует размер и количество кусков в партициях, и если в пуле хватает ресурсов, то начинает фоновое слияние. Слияния выполняются до тех пор, пока суммарный размер входных кусков не достигнет <code class=syntax>max_bytes_to_merge_at_max_space_in_pool</code>.</p> <p>Слияния, начатые по <a href=../../../../sql-reference/statements/optimize/amp/ >OPTIMIZE FINAL</a>, не учитывают <code class=syntax>max_bytes_to_merge_at_max_space_in_pool</code> и объединяют куски пока есть доступные ресурсы (свободное дисковое пространство) до тех пор, пока в партиции не останется один кусок.</p> <h2 id=max-bytes-to-merge-at-min-space-in-pool>max_bytes_to_merge_at_min_space_in_pool<a class=headerlink href=../amp/#max-bytes-to-merge-at-min-space-in-pool title="Permanent link"> </a></h2> <p>Максимальный суммарный размер кусков (в байтах) в одном слиянии при минимуме свободных ресурсов в фоновом пуле.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 1048576 (1 МБ).</p> <p><code class=syntax>max_bytes_to_merge_at_min_space_in_pool</code> задает максимальный суммарный размер кусков, которые можно объединить несмотря на нехватку свободных ресурсов (дискового пространства) в фоновом пуле. Это нужно, чтобы уменьшить количество маленьких кусков и снизить вероятность ошибки <code class=syntax>Too many parts</code>.</p> <p>Слияния резервируют дисковое пространство, удваивая суммарный размер кусков в слиянии. Поэтому при малом объеме свободного места на диске может сложиться ситуация, когда свободное место есть, но оно уже зарезервировано текущими слияниями. Из-за этого другие слияния не начинаются, и количество маленьких кусков в партиции растет с каждым запросом <code class=syntax>INSERT</code>.</p> <h2 id=merge-max-block-size>merge_max_block_size<a class=headerlink href=../amp/#merge-max-block-size title="Permanent link"> </a></h2> <p>Количество строк в блоках, которые читаются из объединяемых кусков.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: 8192</p> <p>Слияние читает строки из кусков блоками по <code class=syntax>merge_max_block_size</code> строк, производит слияние и записывает результат в новый кусок. Читаемый блок помещается в оперативную память, т.е. <code class=syntax>merge_max_block_size</code> влияет на размер оперативной памяти, необходимой для слияния. Таким образом, слияния могут потреблять большое количество оперативной памяти для таблиц, хранящих очень большие строки (если средний размер строки 100кб, то при слиянии 10 кусков будет использовано (100кб * 10 * 8192) =~ 8ГБ оперативной памяти). Уменьшив <code class=syntax>merge_max_block_size</code>, можно сократить размер оперативной памяти, необходимой для слияния, но при этом процесс слияния замедлится.</p> <h2 id=max-part-loading-threads>max_part_loading_threads<a class=headerlink href=../amp/#max-part-loading-threads title="Permanent link"> </a></h2> <p>Максимальное количество потоков, которые читают куски при старте ClickHouse.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: определяется автоматически (по количеству ядер процессора).</p> <p>На старте ClickHouse читает все куски из всех таблиц (читает файлы с метаданными кусков), чтобы построить в оперативной памяти список всех кусков. В некоторых системах с большим количеством кусков этот процесс может занимать длительное время. Это время можно сократить, увеличив <code class=syntax>max_part_loading_threads</code> (если при этом хватает ресурсов процессора и диска).</p> <h2 id=max-partitions-to-read>max_partitions_to_read<a class=headerlink href=../amp/#max-partitions-to-read title="Permanent link"> </a></h2> <p>Ограничивает максимальное число партиций для чтения в одном запросе.</p> <p>Указанное при создании таблицы значение настройки может быть переназначено настройкой на уровне запроса.</p> <p>Возможные значения:</p> <ul> <li>Любое положительное целое число.</li> </ul> <p>Значение по умолчанию: -1 (неограниченно).</p> <h2 id=allow_floating_point_partition_key>allow_floating_point_partition_key<a class=headerlink href=../amp/#allow_floating_point_partition_key title="Permanent link"> </a></h2> <p>Позволяет использовать число с плавающей запятой в качестве ключа партиционирования.</p> <p>Возможные значения:</p> <ul> <li>0 — Ключ партиционирования с плавающей запятой не разрешен.</li> <li>1 — Ключ партиционирования с плавающей запятой разрешен.</li> </ul> <p>Значение по умолчанию: <code class=syntax>0</code>.</p> <h2 id=check_sample_column_is_correct>check_sample_column_is_correct<a class=headerlink href=../amp/#check_sample_column_is_correct title="Permanent link"> </a></h2> <p>Разрешает проверку того, что тип данных столбца для сэмплирования или выражения сэмплирования при создании таблицы верный. Тип данных должен соответствовать одному из беззнаковых <a href=../../../../sql-reference/data-types/int-uint/amp/ >целочисленных типов</a>: <code class=syntax>UInt8</code>, <code class=syntax>UInt16</code>, <code class=syntax>UInt32</code>, <code class=syntax>UInt64</code>.</p> <p>Возможные значения:</p> <ul> <li>true — проверка включена.</li> <li>false — проверка при создании таблицы не проводится.</li> </ul> <p>Значение по умолчанию: <code class=syntax>true</code>.</p> <p>По умолчанию сервер ClickHouse при создании таблицы проверяет тип данных столбца для сэмплирования или выражения сэмплирования. Если уже существуют таблицы с некорректным выражением сэмплирования, то чтобы не возникало исключение при запуске сервера, установите <code class=syntax>check_sample_column_is_correct</code> в значение <code class=syntax>false</code>.</p> <h2 id=min-bytes-to-rebalance-partition-over-jbod>min_bytes_to_rebalance_partition_over_jbod<a class=headerlink href=../amp/#min-bytes-to-rebalance-partition-over-jbod title="Permanent link"> </a></h2> <p>Устанавливает минимальное количество байтов для обеспечения балансировки при распределении новых больших кусков данных по дискам тома <a href=https://en.wikipedia.org/wiki/Non-RAID_drive_architectures rel="external nofollow noreferrer" target=_blank>JBOD</a>.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> <li>0 — балансировка отключена.</li> </ul> <p>Значение по умолчанию: <code class=syntax>0</code>.</p> <p><strong>Использование</strong></p> <p>Значение настройки <code class=syntax>min_bytes_to_rebalance_partition_over_jbod</code> должно быть меньше значения настройки <a href=.././amp/#max-bytes-to-merge-at-max-space-in-pool>max_bytes_to_merge_at_max_space_in_pool</a>. Иначе ClickHouse сгенерирует исключение.</p> <h2 id=detach_not_byte_identical_parts>detach_not_byte_identical_parts<a class=headerlink href=../amp/#detach_not_byte_identical_parts title="Permanent link"> </a></h2> <p>Настраивает отключение куска данных после выполнения слияния или мутации, если на одной реплике его содержимое побайтно не совпадает с кусками на других репликах. Если настройка отключена, то кусок удаляется. Активируйте это поведение, если хотите анализировать такие куски позже.</p> <p>Эта настройка применяется к таблицам <code class=syntax>MergeTree</code> с включенной <a href=../../../../engines/table-engines/mergetree-family/replication/amp/ >репликацией данных</a>.</p> <p>Возможные значения:</p> <ul> <li>0 — куски данных удаляются.</li> <li>1 — куски данных открепляются.</li> </ul> <p>Значение по умолчанию: <code class=syntax>0</code>.</p> <h2 id=setting-merge-tree-clear-old-temporary-directories-interval-seconds>merge_tree_clear_old_temporary_directories_interval_seconds<a class=headerlink href=../amp/#setting-merge-tree-clear-old-temporary-directories-interval-seconds title="Permanent link"> </a></h2> <p>Задает интервал в секундах для удаления старых временных каталогов на сервере ClickHouse.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: <code class=syntax>60</code> секунд.</p> <h2 id=setting-merge-tree-clear-old-parts-interval-seconds>merge_tree_clear_old_parts_interval_seconds<a class=headerlink href=../amp/#setting-merge-tree-clear-old-parts-interval-seconds title="Permanent link"> </a></h2> <p>Задает интервал в секундах для удаления старых кусков данных, журналов предзаписи (WAL) и мутаций на сервере ClickHouse.</p> <p>Возможные значения:</p> <ul> <li>Положительное целое число.</li> </ul> <p>Значение по умолчанию: <code class=syntax>1</code> секунда.</p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2022 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/38993f215f9186c1ac3505b1e09697cd9a468b5d" rel="external nofollow noreferrer" target="_blank" class="text-reset">38993f21</a>
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/ru/operations/settings/merge-tree-settings/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
