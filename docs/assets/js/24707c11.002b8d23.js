"use strict";(self.webpackChunkclickhouse=self.webpackChunkclickhouse||[]).push([[43473],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,g=c["".concat(s,".").concat(m)]||c[m]||d[m]||i;return n?a.createElement(g,o(o({ref:t},u),{},{components:n})):a.createElement(g,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},12686:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return d}});var a=n(87462),r=n(63366),i=(n(67294),n(3905)),o=["components"],l={sidebar_label:"Updating and Deleting Data",sidebar_position:99,keywords:["update","delete","mutation"]},s="Updating and Deleting ClickHouse Data",p={unversionedId:"guides/developer/mutations",id:"guides/developer/mutations",title:"Updating and Deleting ClickHouse Data",description:'Although ClickHouse is geared toward high volume analytic workloads, it is possible in some situations to modify or delete existing data.  These operations are labeled "mutations" and are executed using the ALTER TABLE command.',source:"@site/docs/guides/developer/mutations.md",sourceDirName:"guides/developer",slug:"/guides/developer/mutations",permalink:"/docs/docs/guides/developer/mutations",tags:[],version:"current",sidebarPosition:99,frontMatter:{sidebar_label:"Updating and Deleting Data",sidebar_position:99,keywords:["update","delete","mutation"]},sidebar:"tutorialSidebar",previous:{title:"Applying CatBoost Models",permalink:"/docs/docs/guides/developer/apply-catboost-model"},next:{title:"Improving Query Performance",permalink:"/docs/docs/guides/improving-query-performance"}},u={},d=[{value:"Updating Existing Data",id:"updating-existing-data",level:2},{value:"Deleting Data",id:"deleting-data",level:2}],c={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"updating-and-deleting-clickhouse-data"},"Updating and Deleting ClickHouse Data"),(0,i.kt)("p",null,'Although ClickHouse is geared toward high volume analytic workloads, it is possible in some situations to modify or delete existing data.  These operations are labeled "mutations" and are executed using the ',(0,i.kt)("inlineCode",{parentName:"p"},"ALTER TABLE")," command."),(0,i.kt)("h2",{id:"updating-existing-data"},"Updating Existing Data"),(0,i.kt)("p",null,"From ClickHouse client, enter your update ",(0,i.kt)("inlineCode",{parentName:"p"},"ALTER TABLE")," command in this form:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE [<database>.]<table> UPDATE <column> = <expression> WHERE <filter_expr>\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<expression>")," is the new value for the column where the ",(0,i.kt)("inlineCode",{parentName:"p"},"<filter_expr>")," is satisfied.  The ",(0,i.kt)("inlineCode",{parentName:"p"},"<expression>")," must be the same datatype as the column or be convertable to the same datatype using the ",(0,i.kt)("inlineCode",{parentName:"p"},"CAST")," operator.  The ",(0,i.kt)("inlineCode",{parentName:"p"},"<filter_expr>")," should return a UInt8 (zero or non-zero) value for each row of the data.  Multiple ",(0,i.kt)("inlineCode",{parentName:"p"},"UPDATE <column>")," statements can be combined in a single ",(0,i.kt)("inlineCode",{parentName:"p"},"ALTER TABLE")," command separated by commas."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Examples"),":"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"A mutation like this allows updating replacing visitor_ids with new ones using a dictionary lookup:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE website.clicks UPDATE visitor_id = getDict('visitors', 'new_visitor_id', visitor_id) WHERE visit_date < '2022-01-01'\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Modifying multiple values in one command can be more efficient than multiple commands:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE website.clicks UPDATE url = substring(url, position(url, '://') + 3), visitor_id = new_visit_id WHERE visit_date < '2022-01-01'\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Mutations can be exectuted ",(0,i.kt)("inlineCode",{parentName:"p"},"ON CLUSTER")," for sharded tables:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE clicks ON CLUSTER main_cluster UPDATE click_count = click_count / 2 WHERE visitor_id ILIKE '%robot%'\n")))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"It is not possible to update columns that are part of the primary or sorting key.")),(0,i.kt)("h2",{id:"deleting-data"},"Deleting Data"),(0,i.kt)("p",null,"From ClickHouse client, enter your delete ",(0,i.kt)("inlineCode",{parentName:"p"},"ALTER TABLE")," command in this form:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE [<database>.]<table> DELETE WHERE <filter_expr>\n")),(0,i.kt)("p",null,"Again ",(0,i.kt)("inlineCode",{parentName:"p"},"<filter_expr>")," should return a UInt8 value for each row of data."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Examples")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Delete any records where a column is in an array of values: "),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE website.clicks DELETE WHERE visitor_id in (253, 1002, 4277)\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"What does this query alter?"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"ALTER TABLE clicks ON CLUSTER main_cluster WHERE visit_date < '2022-01-02 15:00:00' AND page_id = '573'\n")))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note")),(0,i.kt)("p",null,"To delete all of the data in a table, it is more efficient to use the command ",(0,i.kt)("inlineCode",{parentName:"p"},"TRUNCATE TABLE [<database].]<table>")," command.  This command can also be executed ",(0,i.kt)("inlineCode",{parentName:"p"},"ON CLUSTER"),"."))}m.isMDXComponent=!0}}]);