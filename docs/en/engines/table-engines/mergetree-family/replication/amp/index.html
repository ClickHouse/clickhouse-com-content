










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="en">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>Data Replication | ClickHouse Documentation</title>
    <link rel="canonical" href="https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Data Replication | ClickHouse Documentation",
"mainEntityOfPage": "https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/",




"image": "https://clickhouse.com/images/clickhouse-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "ClickHouse, Inc.",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.com/images/logo-400x240.png",
    "width": 400,
    "height": 240
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Data Replication | ClickHouse Documentation",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer,main,section{display:block}body{margin:0;font-family:Noto Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}ol,ul{margin-bottom:1rem}ol,ul{margin-top:0}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}b,strong{font-weight:bolder}small{font-size:80%}a{text-decoration:none;background-color:transparent}a,a:hover{color:#ff8c00}a:hover{text-decoration:underline}a:not([href]),a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}button{border-radius:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}button,select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button{overflow:visible}button,select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}summary{display:list-item;cursor:pointer}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:Hind Siliguri,sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.small,small{font-size:80%;font-weight:400}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#495057}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}.order-first{order:-1}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}.order-md-first{order:-1}.order-md-0{order:0}.order-md-1{order:1}.order-md-2{order:2}.order-md-3{order:3}.order-md-4{order:4}.order-md-5{order:5}.order-md-6{order:6}.order-md-7{order:7}.order-md-8{order:8}.order-md-9{order:9}.order-md-10{order:10}.order-md-11{order:11}.order-md-12{order:12}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}.order-lg-first{order:-1}.order-lg-0{order:0}.order-lg-1{order:1}.order-lg-2{order:2}.order-lg-3{order:3}.order-lg-4{order:4}.order-lg-5{order:5}.order-lg-6{order:6}.order-lg-7{order:7}.order-lg-8{order:8}.order-lg-9{order:9}.order-lg-10{order:10}.order-lg-11{order:11}.order-lg-12{order:12}}.table{width:100%;margin-bottom:8px;color:#212529}.table-warning{background-color:#ffeeba}.table-light{background-color:#fbfcfd}.table-dark{background-color:#ccced0}.table-white{background-color:#fff}.table-black{background-color:#c1c2c3}.table-orange{background-color:#ffdfb8}.table-light-orange{background-color:#fff7ea}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-warning{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-warning:focus,.btn-warning:hover{color:#495057;background-color:#e0a800;border-color:#d39e00}.btn-warning:focus{box-shadow:0 0 0 0 rgba(228,176,19,.5)}.btn-warning:disabled{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:focus,.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:focus,.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:focus,.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:focus,.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:focus,.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:focus,.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:focus{box-shadow:0 0 0 0 rgba(255,193,7,.5)}.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 hsla(0,0%,100%,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}.custom-switch{padding-left:2.25rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-file{display:inline-block;margin-bottom:0}.custom-file{position:relative;width:100%;height:calc(1.5em+.75rem+2px)}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}pre{white-space:pre-wrap}pre{border:1px solid #d6dbdf;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}.container,body{min-width:980px}.table{border-collapse:collapse}.table-dark{color:inherit}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/docs/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/docs/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h1 id=table_engines-replication>Data Replication<a class=headerlink href=../amp/#table_engines-replication title="Permanent link"> </a></h1> <p>Replication is only supported for tables in the MergeTree family:</p> <ul> <li>ReplicatedMergeTree</li> <li>ReplicatedSummingMergeTree</li> <li>ReplicatedReplacingMergeTree</li> <li>ReplicatedAggregatingMergeTree</li> <li>ReplicatedCollapsingMergeTree</li> <li>ReplicatedVersionedCollapsingMergeTree</li> <li>ReplicatedGraphiteMergeTree</li> </ul> <p>Replication works at the level of an individual table, not the entire server. A server can store both replicated and non-replicated tables at the same time.</p> <p>Replication does not depend on sharding. Each shard has its own independent replication.</p> <p>Compressed data for <code class=syntax>INSERT</code> and <code class=syntax>ALTER</code> queries is replicated (for more information, see the documentation for <a href=../../../../../sql-reference/statements/alter/amp/#query_language_queries_alter>ALTER</a>).</p> <p><code class=syntax>CREATE</code>, <code class=syntax>DROP</code>, <code class=syntax>ATTACH</code>, <code class=syntax>DETACH</code> and <code class=syntax>RENAME</code> queries are executed on a single server and are not replicated:</p> <ul> <li>The <code class=syntax>CREATE TABLE</code> query creates a new replicatable table on the server where the query is run. If this table already exists on other servers, it adds a new replica.</li> <li>The <code class=syntax>DROP TABLE</code> query deletes the replica located on the server where the query is run.</li> <li>The <code class=syntax>RENAME</code> query renames the table on one of the replicas. In other words, replicated tables can have different names on different replicas.</li> </ul> <p>ClickHouse uses <a href=https://zookeeper.apache.org rel="external nofollow noreferrer" target=_blank>Apache ZooKeeper</a> for storing replicas meta information. Use ZooKeeper version 3.4.5 or newer.</p> <p>To use replication, set parameters in the <a href=../../../../../operations/server-configuration-parameters/settings/amp/#server-settings_zookeeper>zookeeper</a> server configuration section.</p> <div class="admonition attention alert pb-0 mb-4 alert-warning" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">Attention</p> <p>Don’t neglect the security setting. ClickHouse supports the <code class=syntax>digest</code> <a class=alert-link href=https://zookeeper.apache.org/doc/current/zookeeperProgrammers.html#sc_ZooKeeperAccessControl rel="external nofollow noreferrer" target=_blank>ACL scheme</a> of the ZooKeeper security subsystem.</p> </div> <p>Example of setting the addresses of the ZooKeeper cluster:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;zookeeper&gt;</span>
    <span class=nt>&lt;node&gt;</span>
        <span class=nt>&lt;host&gt;</span>example1<span class=nt>&lt;/host&gt;</span>
        <span class=nt>&lt;port&gt;</span>2181<span class=nt>&lt;/port&gt;</span>
    <span class=nt>&lt;/node&gt;</span>
    <span class=nt>&lt;node&gt;</span>
        <span class=nt>&lt;host&gt;</span>example2<span class=nt>&lt;/host&gt;</span>
        <span class=nt>&lt;port&gt;</span>2181<span class=nt>&lt;/port&gt;</span>
    <span class=nt>&lt;/node&gt;</span>
    <span class=nt>&lt;node&gt;</span>
        <span class=nt>&lt;host&gt;</span>example3<span class=nt>&lt;/host&gt;</span>
        <span class=nt>&lt;port&gt;</span>2181<span class=nt>&lt;/port&gt;</span>
    <span class=nt>&lt;/node&gt;</span>
<span class=nt>&lt;/zookeeper&gt;</span>
</code></pre></div> <p>ClickHouse also supports to store replicas meta information in the auxiliary ZooKeeper cluster by providing ZooKeeper cluster name and path as engine arguments.<br> In other word, it supports to store the metadata of differnt tables in different ZooKeeper clusters.</p> <p>Example of setting the addresses of the auxiliary ZooKeeper cluster:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;auxiliary_zookeepers&gt;</span>
    <span class=nt>&lt;zookeeper2&gt;</span>
        <span class=nt>&lt;node&gt;</span>
            <span class=nt>&lt;host&gt;</span>example_2_1<span class=nt>&lt;/host&gt;</span>
            <span class=nt>&lt;port&gt;</span>2181<span class=nt>&lt;/port&gt;</span>
        <span class=nt>&lt;/node&gt;</span>
        <span class=nt>&lt;node&gt;</span>
            <span class=nt>&lt;host&gt;</span>example_2_2<span class=nt>&lt;/host&gt;</span>
            <span class=nt>&lt;port&gt;</span>2181<span class=nt>&lt;/port&gt;</span>
        <span class=nt>&lt;/node&gt;</span>
        <span class=nt>&lt;node&gt;</span>
            <span class=nt>&lt;host&gt;</span>example_2_3<span class=nt>&lt;/host&gt;</span>
            <span class=nt>&lt;port&gt;</span>2181<span class=nt>&lt;/port&gt;</span>
        <span class=nt>&lt;/node&gt;</span>
    <span class=nt>&lt;/zookeeper2&gt;</span>
    <span class=nt>&lt;zookeeper3&gt;</span>
        <span class=nt>&lt;node&gt;</span>
            <span class=nt>&lt;host&gt;</span>example_3_1<span class=nt>&lt;/host&gt;</span>
            <span class=nt>&lt;port&gt;</span>2181<span class=nt>&lt;/port&gt;</span>
        <span class=nt>&lt;/node&gt;</span>
    <span class=nt>&lt;/zookeeper3&gt;</span>
<span class=nt>&lt;/auxiliary_zookeepers&gt;</span>
</code></pre></div> <p>To store table datameta in a auxiliary ZooKeeper cluster instead of default ZooKeeper cluster, we can use the SQL to create table with<br> ReplicatedMergeTree engine as follow:</p> <div class=codehilite><pre><span></span><code class=syntax>CREATE TABLE table_name ( ... ) ENGINE = ReplicatedMergeTree('zookeeper_name_configured_in_auxiliary_zookeepers:path', 'replica_name') ...
</code></pre></div> <p>You can specify any existing ZooKeeper cluster and the system will use a directory on it for its own data (the directory is specified when creating a replicatable table).</p> <p>If ZooKeeper isn’t set in the config file, you can’t create replicated tables, and any existing replicated tables will be read-only.</p> <p>ZooKeeper is not used in <code class=syntax>SELECT</code> queries because replication does not affect the performance of <code class=syntax>SELECT</code> and queries run just as fast as they do for non-replicated tables. When querying distributed replicated tables, ClickHouse behavior is controlled by the settings <a href=../../../../../operations/settings/settings/amp/#settings-max_replica_delay_for_distributed_queries>max_replica_delay_for_distributed_queries</a> and <a href=../../../../../operations/settings/settings/amp/#settings-fallback_to_stale_replicas_for_distributed_queries>fallback_to_stale_replicas_for_distributed_queries</a>.</p> <p>For each <code class=syntax>INSERT</code> query, approximately ten entries are added to ZooKeeper through several transactions. (To be more precise, this is for each inserted block of data; an INSERT query contains one block or one block per <code class=syntax>max_insert_block_size = 1048576</code> rows.) This leads to slightly longer latencies for <code class=syntax>INSERT</code> compared to non-replicated tables. But if you follow the recommendations to insert data in batches of no more than one <code class=syntax>INSERT</code> per second, it does not create any problems. The entire ClickHouse cluster used for coordinating one ZooKeeper cluster has a total of several hundred <code class=syntax>INSERTs</code> per second. The throughput on data inserts (the number of rows per second) is just as high as for non-replicated data.</p> <p>For very large clusters, you can use different ZooKeeper clusters for different shards. However, from our experience this has not proven necessary based on production clusters with approximately 300 servers.</p> <p>Replication is asynchronous and multi-master. <code class=syntax>INSERT</code> queries (as well as <code class=syntax>ALTER</code>) can be sent to any available server. Data is inserted on the server where the query is run, and then it is copied to the other servers. Because it is asynchronous, recently inserted data appears on the other replicas with some latency. If part of the replicas are not available, the data is written when they become available. If a replica is available, the latency is the amount of time it takes to transfer the block of compressed data over the network. The number of threads performing background tasks for replicated tables can be set by <a href=../../../../../operations/settings/settings/amp/#background_schedule_pool_size>background_schedule_pool_size</a> setting.</p> <p><code class=syntax>ReplicatedMergeTree</code> engine uses a separate thread pool for replicated fetches. Size of the pool is limited by the <a href=../../../../../operations/settings/settings/amp/#background_fetches_pool_size>background_fetches_pool_size</a> setting which can be tuned with a server restart.</p> <p>By default, an INSERT query waits for confirmation of writing the data from only one replica. If the data was successfully written to only one replica and the server with this replica ceases to exist, the stored data will be lost. To enable getting confirmation of data writes from multiple replicas, use the <code class=syntax>insert_quorum</code> option.</p> <p>Each block of data is written atomically. The INSERT query is divided into blocks up to <code class=syntax>max_insert_block_size = 1048576</code> rows. In other words, if the <code class=syntax>INSERT</code> query has less than 1048576 rows, it is made atomically.</p> <p>Data blocks are deduplicated. For multiple writes of the same data block (data blocks of the same size containing the same rows in the same order), the block is only written once. The reason for this is in case of network failures when the client application does not know if the data was written to the DB, so the <code class=syntax>INSERT</code> query can simply be repeated. It does not matter which replica INSERTs were sent to with identical data. <code class=syntax>INSERTs</code> are idempotent. Deduplication parameters are controlled by <a href=../../../../../operations/server-configuration-parameters/settings/amp/#server_configuration_parameters-merge_tree>merge_tree</a> server settings.</p> <p>During replication, only the source data to insert is transferred over the network. Further data transformation (merging) is coordinated and performed on all the replicas in the same way. This minimizes network usage, which means that replication works well when replicas reside in different datacenters. (Note that duplicating data in different datacenters is the main goal of replication.)</p> <p>You can have any number of replicas of the same data. Based on our experiences, a relatively reliable and convenient solution could use double replication in production, with each server using RAID-5 or RAID-6 (and RAID-10 in some cases). </p> <p>The system monitors data synchronicity on replicas and is able to recover after a failure. Failover is automatic (for small differences in data) or semi-automatic (when data differs too much, which may indicate a configuration error).</p> <h2 id=creating-replicated-tables>Creating Replicated Tables<a class=headerlink href=../amp/#creating-replicated-tables title="Permanent link"> </a></h2> <p>The <code class=syntax>Replicated</code> prefix is added to the table engine name. For example:<code class=syntax>ReplicatedMergeTree</code>.</p> <p><strong>Replicated*MergeTree parameters</strong></p> <ul> <li><code class=syntax>zoo_path</code> — The path to the table in ZooKeeper.</li> <li><code class=syntax>replica_name</code> — The replica name in ZooKeeper.</li> <li><code class=syntax>other_parameters</code> — Parameters of an engine which is used for creating the replicated version, for example, version in <code class=syntax>ReplacingMergeTree</code>.</li> </ul> <p>Example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>table_name</span><span class=w></span>
<span class=p>(</span><span class=w></span>
<span class=w>    </span><span class=n>EventDate</span><span class=w> </span><span class=n>DateTime</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>CounterID</span><span class=w> </span><span class=n>UInt32</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>UserID</span><span class=w> </span><span class=n>UInt32</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>ver</span><span class=w> </span><span class=n>UInt16</span><span class=w></span>
<span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ReplicatedReplacingMergeTree</span><span class=p>(</span><span class=s1>'/clickhouse/tables/{layer}-{shard}/table_name'</span><span class=p>,</span><span class=w> </span><span class=s1>'{replica}'</span><span class=p>,</span><span class=w> </span><span class=n>ver</span><span class=p>)</span><span class=w></span>
<span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>toYYYYMM</span><span class=p>(</span><span class=n>EventDate</span><span class=p>)</span><span class=w></span>
<span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=p>(</span><span class=n>CounterID</span><span class=p>,</span><span class=w> </span><span class=n>EventDate</span><span class=p>,</span><span class=w> </span><span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>))</span><span class=w></span>
<span class=n>SAMPLE</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>);</span><span class=w></span>
</code></pre></div> <details><summary>Example in deprecated syntax</summary> <p></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>table_name</span><span class=w></span>
<span class=p>(</span><span class=w></span>
<span class=w>    </span><span class=n>EventDate</span><span class=w> </span><span class=n>DateTime</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>CounterID</span><span class=w> </span><span class=n>UInt32</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>UserID</span><span class=w> </span><span class=n>UInt32</span><span class=w></span>
<span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ReplicatedMergeTree</span><span class=p>(</span><span class=s1>'/clickhouse/tables/{layer}-{shard}/table_name'</span><span class=p>,</span><span class=w> </span><span class=s1>'{replica}'</span><span class=p>,</span><span class=w> </span><span class=n>EventDate</span><span class=p>,</span><span class=w> </span><span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>),</span><span class=w> </span><span class=p>(</span><span class=n>CounterID</span><span class=p>,</span><span class=w> </span><span class=n>EventDate</span><span class=p>,</span><span class=w> </span><span class=n>intHash32</span><span class=p>(</span><span class=n>UserID</span><span class=p>),</span><span class=w> </span><span class=n>EventTime</span><span class=p>),</span><span class=w> </span><span class=mi>8192</span><span class=p>);</span><span class=w></span>
</code></pre></div> </details> <p>As the example shows, these parameters can contain substitutions in curly brackets. The substituted values are taken from the <a href=../../../../../operations/server-configuration-parameters/settings/amp/#macros>macros</a> section of the configuration file.</p> <p>Example:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;macros&gt;</span>
    <span class=nt>&lt;layer&gt;</span>05<span class=nt>&lt;/layer&gt;</span>
    <span class=nt>&lt;shard&gt;</span>02<span class=nt>&lt;/shard&gt;</span>
    <span class=nt>&lt;replica&gt;</span>example05-02-1<span class=nt>&lt;/replica&gt;</span>
<span class=nt>&lt;/macros&gt;</span>
</code></pre></div> <p>The path to the table in ZooKeeper should be unique for each replicated table. Tables on different shards should have different paths.<br> In this case, the path consists of the following parts:</p> <p><code class=syntax>/clickhouse/tables/</code> is the common prefix. We recommend using exactly this one.</p> <p><code class=syntax>{layer}-{shard}</code> is the shard identifier. In this example it consists of two parts, since the example cluster uses bi-level sharding. For most tasks, you can leave just the {shard} substitution, which will be expanded to the shard identifier.</p> <p><code class=syntax>table_name</code> is the name of the node for the table in ZooKeeper. It is a good idea to make it the same as the table name. It is defined explicitly, because in contrast to the table name, it does not change after a RENAME query.<br> <em>HINT</em>: you could add a database name in front of <code class=syntax>table_name</code> as well. E.g. <code class=syntax>db_name.table_name</code></p> <p>The two built-in substitutions <code class=syntax>{database}</code> and <code class=syntax>{table}</code> can be used, they expand into the table name and the database name respectively (unless these macros are defined in the <code class=syntax>macros</code> section). So the zookeeper path can be specified as <code class=syntax>'/clickhouse/tables/{layer}-{shard}/{database}/{table}'</code>.<br> Be careful with table renames when using these built-in substitutions. The path in Zookeeper cannot be changed, and when the table is renamed, the macros will expand into a different path, the table will refer to a path that does not exist in Zookeeper, and will go into read-only mode.</p> <p>The replica name identifies different replicas of the same table. You can use the server name for this, as in the example. The name only needs to be unique within each shard.</p> <p>You can define the parameters explicitly instead of using substitutions. This might be convenient for testing and for configuring small clusters. However, you can’t use distributed DDL queries (<code class=syntax>ON CLUSTER</code>) in this case.</p> <p>When working with large clusters, we recommend using substitutions because they reduce the probability of error.</p> <p>You can specify default arguments for <code class=syntax>Replicated</code> table engine in the server configuration file. For instance:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;default_replica_path&gt;</span>/clickhouse/tables/{shard}/{database}/{table}<span class=nt>&lt;/default_replica_path&gt;</span>
<span class=nt>&lt;default_replica_name&gt;</span>{replica}<span class=nt>&lt;/default_replica_name&gt;</span>
</code></pre></div> <p>In this case, you can omit arguments when creating tables:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=p>(</span><span class=w></span>
<span class=w>    </span><span class=n>x</span><span class=w> </span><span class=n>UInt32</span><span class=w></span>
<span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ReplicatedMergeTree</span><span class=w></span>
<span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w></span>
</code></pre></div> <p>It is equivalent to:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=p>(</span><span class=w></span>
<span class=w>    </span><span class=n>x</span><span class=w> </span><span class=n>UInt32</span><span class=w></span>
<span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ReplicatedMergeTree</span><span class=p>(</span><span class=s1>'/clickhouse/tables/{shard}/{database}/table_name'</span><span class=p>,</span><span class=w> </span><span class=s1>'{replica}'</span><span class=p>)</span><span class=w></span>
<span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w></span>
</code></pre></div> <p>Run the <code class=syntax>CREATE TABLE</code> query on each replica. This query creates a new replicated table, or adds a new replica to an existing one.</p> <p>If you add a new replica after the table already contains some data on other replicas, the data will be copied from the other replicas to the new one after running the query. In other words, the new replica syncs itself with the others.</p> <p>To delete a replica, run <code class=syntax>DROP TABLE</code>. However, only one replica is deleted – the one that resides on the server where you run the query.</p> <h2 id=recovery-after-failures>Recovery After Failures<a class=headerlink href=../amp/#recovery-after-failures title="Permanent link"> </a></h2> <p>If ZooKeeper is unavailable when a server starts, replicated tables switch to read-only mode. The system periodically attempts to connect to ZooKeeper.</p> <p>If ZooKeeper is unavailable during an <code class=syntax>INSERT</code>, or an error occurs when interacting with ZooKeeper, an exception is thrown.</p> <p>After connecting to ZooKeeper, the system checks whether the set of data in the local file system matches the expected set of data (ZooKeeper stores this information). If there are minor inconsistencies, the system resolves them by syncing data with the replicas.</p> <p>If the system detects broken data parts (with the wrong size of files) or unrecognized parts (parts written to the file system but not recorded in ZooKeeper), it moves them to the <code class=syntax>detached</code> subdirectory (they are not deleted). Any missing parts are copied from the replicas.</p> <p>Note that ClickHouse does not perform any destructive actions such as automatically deleting a large amount of data.</p> <p>When the server starts (or establishes a new session with ZooKeeper), it only checks the quantity and sizes of all files. If the file sizes match but bytes have been changed somewhere in the middle, this is not detected immediately, but only when attempting to read the data for a <code class=syntax>SELECT</code> query. The query throws an exception about a non-matching checksum or size of a compressed block. In this case, data parts are added to the verification queue and copied from the replicas if necessary.</p> <p>If the local set of data differs too much from the expected one, a safety mechanism is triggered. The server enters this in the log and refuses to launch. The reason for this is that this case may indicate a configuration error, such as if a replica on a shard was accidentally configured like a replica on a different shard. However, the thresholds for this mechanism are set fairly low, and this situation might occur during normal failure recovery. In this case, data is restored semi-automatically - by “pushing a button”.</p> <p>To start recovery, create the node <code class=syntax>/path_to_table/replica_name/flags/force_restore_data</code> in ZooKeeper with any content, or run the command to restore all replicated tables:</p> <div class=codehilite><pre><span></span><code class=syntax>sudo -u clickhouse touch /var/lib/clickhouse/flags/force_restore_data
</code></pre></div> <p>Then restart the server. On start, the server deletes these flags and starts recovery.</p> <h2 id=recovery-after-complete-data-loss>Recovery After Complete Data Loss<a class=headerlink href=../amp/#recovery-after-complete-data-loss title="Permanent link"> </a></h2> <p>If all data and metadata disappeared from one of the servers, follow these steps for recovery:</p> <ol> <li>Install ClickHouse on the server. Define substitutions correctly in the config file that contains the shard identifier and replicas, if you use them.</li> <li>If you had unreplicated tables that must be manually duplicated on the servers, copy their data from a replica (in the directory <code class=syntax>/var/lib/clickhouse/data/db_name/table_name/</code>).</li> <li>Copy table definitions located in <code class=syntax>/var/lib/clickhouse/metadata/</code> from a replica. If a shard or replica identifier is defined explicitly in the table definitions, correct it so that it corresponds to this replica. (Alternatively, start the server and make all the <code class=syntax>ATTACH TABLE</code> queries that should have been in the .sql files in <code class=syntax>/var/lib/clickhouse/metadata/</code>.)</li> <li>To start recovery, create the ZooKeeper node <code class=syntax>/path_to_table/replica_name/flags/force_restore_data</code> with any content, or run the command to restore all replicated tables: <code class=syntax>sudo -u clickhouse touch /var/lib/clickhouse/flags/force_restore_data</code></li> </ol> <p>Then start the server (restart, if it is already running). Data will be downloaded from replicas.</p> <p>An alternative recovery option is to delete information about the lost replica from ZooKeeper (<code class=syntax>/path_to_table/replica_name</code>), then create the replica again as described in “<a href=../amp/#creating-replicated-tables>Creating replicated tables</a>”.</p> <p>There is no restriction on network bandwidth during recovery. Keep this in mind if you are restoring many replicas at once.</p> <h2 id=converting-from-mergetree-to-replicatedmergetree>Converting from MergeTree to ReplicatedMergeTree<a class=headerlink href=../amp/#converting-from-mergetree-to-replicatedmergetree title="Permanent link"> </a></h2> <p>We use the term <code class=syntax>MergeTree</code> to refer to all table engines in the <code class=syntax>MergeTree family</code>, the same as for <code class=syntax>ReplicatedMergeTree</code>.</p> <p>If you had a <code class=syntax>MergeTree</code> table that was manually replicated, you can convert it to a replicated table. You might need to do this if you have already collected a large amount of data in a <code class=syntax>MergeTree</code> table and now you want to enable replication.</p> <p>If the data differs on various replicas, first sync it, or delete this data on all the replicas except one.</p> <p>Rename the existing MergeTree table, then create a <code class=syntax>ReplicatedMergeTree</code> table with the old name.<br> Move the data from the old table to the <code class=syntax>detached</code> subdirectory inside the directory with the new table data (<code class=syntax>/var/lib/clickhouse/data/db_name/table_name/</code>).<br> Then run <code class=syntax>ALTER TABLE ATTACH PARTITION</code> on one of the replicas to add these data parts to the working set.</p> <h2 id=converting-from-replicatedmergetree-to-mergetree>Converting from ReplicatedMergeTree to MergeTree<a class=headerlink href=../amp/#converting-from-replicatedmergetree-to-mergetree title="Permanent link"> </a></h2> <p>Create a MergeTree table with a different name. Move all the data from the directory with the <code class=syntax>ReplicatedMergeTree</code> table data to the new table’s data directory. Then delete the <code class=syntax>ReplicatedMergeTree</code> table and restart the server.</p> <p>If you want to get rid of a <code class=syntax>ReplicatedMergeTree</code> table without launching the server:</p> <ul> <li>Delete the corresponding <code class=syntax>.sql</code> file in the metadata directory (<code class=syntax>/var/lib/clickhouse/metadata/</code>).</li> <li>Delete the corresponding path in ZooKeeper (<code class=syntax>/path_to_table/replica_name</code>).</li> </ul> <p>After this, you can launch the server, create a <code class=syntax>MergeTree</code> table, move the data to its directory, and then restart the server.</p> <h2 id=recovery-when-metadata-in-the-zookeeper-cluster-is-lost-or-damaged>Recovery When Metadata in the Zookeeper Cluster Is Lost or Damaged<a class=headerlink href=../amp/#recovery-when-metadata-in-the-zookeeper-cluster-is-lost-or-damaged title="Permanent link"> </a></h2> <p>If the data in ZooKeeper was lost or damaged, you can save data by moving it to an unreplicated table as described above.</p> <p><strong>See Also</strong></p> <ul> <li><a href=../../../../../operations/settings/settings/amp/#background_schedule_pool_size>background_schedule_pool_size</a></li> <li><a href=../../../../../operations/settings/settings/amp/#background_fetches_pool_size>background_fetches_pool_size</a></li> <li><a href=../../../../../operations/settings/settings/amp/#execute-merges-on-single-replica-time-threshold>execute_merges_on_single_replica_time_threshold</a></li> <li><a href=../../../../../operations/settings/merge-tree-settings/amp/#max_replicated_fetches_network_bandwidth>max_replicated_fetches_network_bandwidth</a></li> <li><a href=../../../../../operations/settings/merge-tree-settings/amp/#max_replicated_sends_network_bandwidth>max_replicated_sends_network_bandwidth</a></li> </ul>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2022 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/38993f215f9186c1ac3505b1e09697cd9a468b5d" rel="external nofollow noreferrer" target="_blank" class="text-reset">38993f21</a>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
