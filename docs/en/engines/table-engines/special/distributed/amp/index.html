










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="en">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>Distributed | ClickHouse Documentation</title>
    <link rel="canonical" href="https://clickhouse.com/docs/en/engines/table-engines/special/distributed/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "Distributed | ClickHouse Documentation",
"mainEntityOfPage": "https://clickhouse.com/docs/en/engines/table-engines/special/distributed/",




"image": "https://clickhouse.com/images/clickhouse-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "ClickHouse, Inc.",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.com/images/logo-400x240.png",
    "width": 400,
    "height": 240
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "Distributed | ClickHouse Documentation",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer,section{display:block}body{margin:0;font-family:Noto Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}address{font-style:normal;line-height:inherit}address,ul{margin-bottom:1rem}ul{margin-top:0}ul ul{margin-bottom:0}b,strong{font-weight:bolder}small{font-size:80%}a{text-decoration:none;background-color:transparent}a,a:hover{color:#ff8c00}a:hover{text-decoration:underline}a:not([href]),a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:Hind Siliguri,sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.small,small{font-size:80%;font-weight:400}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#495057}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}.order-first{order:-1}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}.order-md-first{order:-1}.order-md-0{order:0}.order-md-1{order:1}.order-md-2{order:2}.order-md-3{order:3}.order-md-4{order:4}.order-md-5{order:5}.order-md-6{order:6}.order-md-7{order:7}.order-md-8{order:8}.order-md-9{order:9}.order-md-10{order:10}.order-md-11{order:11}.order-md-12{order:12}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}.order-lg-first{order:-1}.order-lg-0{order:0}.order-lg-1{order:1}.order-lg-2{order:2}.order-lg-3{order:3}.order-lg-4{order:4}.order-lg-5{order:5}.order-lg-6{order:6}.order-lg-7{order:7}.order-lg-8{order:8}.order-lg-9{order:9}.order-lg-10{order:10}.order-lg-11{order:11}.order-lg-12{order:12}}.table{width:100%;margin-bottom:8px;color:#212529}.table-primary{background-color:#fff1b8}.table-light{background-color:#fbfcfd}.table-dark{background-color:#ccced0}.table-primary-light{background-color:#fffefb}.table-white{background-color:#fff}.table-black{background-color:#c1c2c3}.table-orange{background-color:#ffdfb8}.table-light-orange{background-color:#fff7ea}.table-medium{background-color:#f4f5f6}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-primary{color:#495057;background-color:#fc0;border-color:#fc0}.btn-primary:focus,.btn-primary:hover{color:#495057;background-color:#d9ad00;border-color:#cca300}.btn-primary:focus{box-shadow:0 0 0 0 rgba(228,185,13,.5)}.btn-primary:disabled{color:#495057;background-color:#fc0;border-color:#fc0}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:focus,.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:focus,.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-primary-light{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-primary-light:focus,.btn-primary-light:hover{color:#495057;background-color:#ffedca;border-color:#ffe9bd}.btn-primary-light:focus{box-shadow:0 0 0 0 rgba(228,225,217,.5)}.btn-primary-light:disabled{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:focus,.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:focus,.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:focus,.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:focus,.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-medium{color:#495057;background-color:#d6dbdf;border-color:#d6dbdf}.btn-medium:focus,.btn-medium:hover{color:#495057;background-color:#c1c8ce;border-color:#b9c2c9}.btn-medium:focus{box-shadow:0 0 0 0 rgba(193,198,203,.5)}.btn-medium:disabled{color:#495057;background-color:#d6dbdf;border-color:#d6dbdf}.btn-outline-primary{color:#fc0;border-color:#fc0}.btn-outline-primary:hover{color:#495057;background-color:#fc0;border-color:#fc0}.btn-outline-primary:focus{box-shadow:0 0 0 0 rgba(255,204,0,.5)}.btn-outline-primary:disabled{color:#fc0;background-color:transparent}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-primary-light{color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:hover{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:focus{box-shadow:0 0 0 0 rgba(255,250,240,.5)}.btn-outline-primary-light:disabled{color:#fffaf0;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 hsla(0,0%,100%,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-outline-medium{color:#d6dbdf;border-color:#d6dbdf}.btn-outline-medium:hover{color:#495057;background-color:#d6dbdf;border-color:#d6dbdf}.btn-outline-medium:focus{box-shadow:0 0 0 0 rgba(214,219,223,.5)}.btn-outline-medium:disabled{color:#d6dbdf;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}.btn-group{position:relative;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-file{display:inline-block;margin-bottom:0}.custom-file{position:relative;width:100%;height:calc(1.5em+.75rem+2px)}.custom-range{width:100%;height:1.4rem;padding:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-range:focus{outline:0}.custom-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-moz-range-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-ms-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range::-moz-focus-outer{border:0}.custom-range::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:#fc0;border:0;border-radius:1rem;-webkit-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-webkit-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-webkit-slider-thumb{-webkit-transition:none;transition:none}}.custom-range::-webkit-slider-thumb:active{background-color:#fff0b3}.custom-range::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-moz-range-thumb{width:1rem;height:1rem;background-color:#fc0;border:0;border-radius:1rem;-moz-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-moz-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-moz-range-thumb{-moz-transition:none;transition:none}}.custom-range::-moz-range-thumb:active{background-color:#fff0b3}.custom-range::-moz-range-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-ms-thumb{width:1rem;height:1rem;margin-top:0;margin-right:.2rem;margin-left:.2rem;background-color:#fc0;border:0;border-radius:1rem;-ms-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-ms-thumb{-ms-transition:none;transition:none}}.custom-range::-ms-thumb:active{background-color:#fff0b3}.custom-range::-ms-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:transparent;border-color:transparent;border-width:.5rem}.custom-range::-ms-fill-lower,.custom-range::-ms-fill-upper{background-color:#dee2e6;border-radius:1rem}.custom-range::-ms-fill-upper{margin-right:15px}.custom-range:disabled::-webkit-slider-thumb{background-color:#d6dbdf}.custom-range:disabled::-webkit-slider-runnable-track{cursor:default}.custom-range:disabled::-moz-range-thumb{background-color:#d6dbdf}.custom-range:disabled::-moz-range-track{cursor:default}.custom-range:disabled::-ms-thumb{background-color:#d6dbdf}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}pre{white-space:pre-wrap}pre{border:1px solid #d6dbdf;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}.container,body{min-width:980px}.table{border-collapse:collapse}.table-dark{color:inherit}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h1 id=distributed>Distributed Table Engine<a class=headerlink href=../amp/#distributed title="Permanent link"> </a></h1> <p>Tables with Distributed engine do not store any data of their own, but allow distributed query processing on multiple servers.<br> Reading is automatically parallelized. During a read, the table indexes on remote servers are used, if there are any.</p> <h2 id=distributed-creating-a-table>Creating a Table<a class=headerlink href=../amp/#distributed-creating-a-table title="Permanent link"> </a></h2> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=p>[</span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span><span class=w> </span><span class=p>[</span><span class=k>ON</span><span class=w> </span><span class=k>CLUSTER</span><span class=w> </span><span class=k>cluster</span><span class=p>]</span><span class=w></span>
<span class=p>(</span><span class=w></span>
<span class=w>    </span><span class=n>name1</span><span class=w> </span><span class=p>[</span><span class=n>type1</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span><span class=w> </span><span class=n>expr1</span><span class=p>],</span><span class=w></span>
<span class=w>    </span><span class=n>name2</span><span class=w> </span><span class=p>[</span><span class=n>type2</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=k>DEFAULT</span><span class=o>|</span><span class=n>MATERIALIZED</span><span class=o>|</span><span class=k>ALIAS</span><span class=w> </span><span class=n>expr2</span><span class=p>],</span><span class=w></span>
<span class=w>    </span><span class=p>...</span><span class=w></span>
<span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Distributed</span><span class=p>(</span><span class=k>cluster</span><span class=p>,</span><span class=w> </span><span class=k>database</span><span class=p>,</span><span class=w> </span><span class=k>table</span><span class=p>[,</span><span class=w> </span><span class=n>sharding_key</span><span class=p>[,</span><span class=w> </span><span class=n>policy_name</span><span class=p>]])</span><span class=w></span>
<span class=p>[</span><span class=n>SETTINGS</span><span class=w> </span><span class=n>name</span><span class=o>=</span><span class=n>value</span><span class=p>,</span><span class=w> </span><span class=p>...]</span><span class=w></span>
</code></pre></div> <h3 id=distributed-from-a-table>From a Table<a class=headerlink href=../amp/#distributed-from-a-table title="Permanent link"> </a></h3> <p>When the <code class=syntax>Distributed</code> table is pointing to a table on the current server you can adopt that table's schema:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=p>[</span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=n>db</span><span class=p>.]</span><span class=k>table_name</span><span class=w> </span><span class=p>[</span><span class=k>ON</span><span class=w> </span><span class=k>CLUSTER</span><span class=w> </span><span class=k>cluster</span><span class=p>]</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>[</span><span class=n>db2</span><span class=p>.]</span><span class=n>name2</span><span class=w> </span><span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Distributed</span><span class=p>(</span><span class=k>cluster</span><span class=p>,</span><span class=w> </span><span class=k>database</span><span class=p>,</span><span class=w> </span><span class=k>table</span><span class=p>[,</span><span class=w> </span><span class=n>sharding_key</span><span class=p>[,</span><span class=w> </span><span class=n>policy_name</span><span class=p>]])</span><span class=w> </span><span class=p>[</span><span class=n>SETTINGS</span><span class=w> </span><span class=n>name</span><span class=o>=</span><span class=n>value</span><span class=p>,</span><span class=w> </span><span class=p>...]</span><span class=w></span>
</code></pre></div> <p><strong>Distributed Parameters</strong></p> <ul> <li> <p><code class=syntax>cluster</code> - the cluster name in the server’s config file</p> </li> <li> <p><code class=syntax>database</code> - the name of a remote database</p> </li> <li> <p><code class=syntax>table</code> - the name of a remote table</p> </li> <li> <p><code class=syntax>sharding_key</code> - (optionally) sharding key</p> </li> <li> <p><code class=syntax>policy_name</code> - (optionally) policy name, it will be used to store temporary files for async send</p> </li> </ul> <p><strong>See Also</strong></p> <ul> <li><a href=../../../../../operations/settings/settings/amp/#insert_distributed_sync>insert_distributed_sync</a> setting</li> <li><a href=../../../mergetree-family/mergetree/amp/#table_engine-mergetree-multiple-volumes>MergeTree</a> for the examples</li> </ul> <p><strong>Distributed Settings</strong></p> <ul> <li> <p><code class=syntax>fsync_after_insert</code> - do the <code class=syntax>fsync</code> for the file data after asynchronous insert to Distributed. Guarantees that the OS flushed the whole inserted data to a file <strong>on the initiator node</strong> disk.</p> </li> <li> <p><code class=syntax>fsync_directories</code> - do the <code class=syntax>fsync</code> for directories. Guarantees that the OS refreshed directory metadata after operations related to asynchronous inserts on Distributed table (after insert, after sending the data to shard, etc).</p> </li> <li> <p><code class=syntax>bytes_to_throw_insert</code> - if more than this number of compressed bytes will be pending for async INSERT, an exception will be thrown. 0 - do not throw. Default 0.</p> </li> <li> <p><code class=syntax>bytes_to_delay_insert</code> - if more than this number of compressed bytes will be pending for async INSERT, the query will be delayed. 0 - do not delay. Default 0.</p> </li> <li> <p><code class=syntax>max_delay_to_insert</code> - max delay of inserting data into Distributed table in seconds, if there are a lot of pending bytes for async send. Default 60.</p> </li> <li> <p><code class=syntax>monitor_batch_inserts</code> - same as <a href=../../../../../operations/settings/settings/amp/#distributed_directory_monitor_batch_inserts>distributed_directory_monitor_batch_inserts</a></p> </li> <li> <p><code class=syntax>monitor_split_batch_on_failure</code> - same as <a href=../../../../../operations/settings/settings/amp/#distributed_directory_monitor_split_batch_on_failure>distributed_directory_monitor_split_batch_on_failure</a></p> </li> <li> <p><code class=syntax>monitor_sleep_time_ms</code> - same as <a href=../../../../../operations/settings/settings/amp/#distributed_directory_monitor_sleep_time_ms>distributed_directory_monitor_sleep_time_ms</a></p> </li> <li> <p><code class=syntax>monitor_max_sleep_time_ms</code> - same as <a href=../../../../../operations/settings/settings/amp/#distributed_directory_monitor_max_sleep_time_ms>distributed_directory_monitor_max_sleep_time_ms</a></p> </li> </ul> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">Note</p> <p><strong>Durability settings</strong> (<code class=syntax>fsync_...</code>):</p> <ul> <li>Affect only asynchronous INSERTs (i.e. <code class=syntax>insert_distributed_sync=false</code>) when data first stored on the initiator node disk and later asynchronously send to shards.</li> <li>May significantly decrease the inserts' performance</li> <li>Affect writing the data stored inside Distributed table folder into the <strong>node which accepted your insert</strong>. If you need to have guarantees of writing data to underlying MergeTree tables - see durability settings (<code class=syntax>...fsync...</code>) in <code class=syntax>system.merge_tree_settings</code></li> </ul> <p>For <strong>Insert limit settings</strong> (<code class=syntax>..._insert</code>) see also:</p> <ul> <li><a class=alert-link href=../../../../../operations/settings/settings/amp/#insert_distributed_sync>insert_distributed_sync</a> setting</li> <li><a class=alert-link href=../../../../../operations/settings/settings/amp/#settings-prefer-localhost-replica>prefer_localhost_replica</a> setting</li> <li><code class=syntax>bytes_to_throw_insert</code> handled before <code class=syntax>bytes_to_delay_insert</code>, so you should not set it to the value less then <code class=syntax>bytes_to_delay_insert</code></li> </ul> </div> <p><strong>Example</strong></p> <div class=codehilite><pre><span></span><code class=syntax><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>hits_all</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>hits</span><span class=w></span>
<span class=n>ENGINE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Distributed</span><span class=p>(</span><span class=n>logs</span><span class=p>,</span><span class=w> </span><span class=k>default</span><span class=p>,</span><span class=w> </span><span class=n>hits</span><span class=p>[,</span><span class=w> </span><span class=n>sharding_key</span><span class=p>[,</span><span class=w> </span><span class=n>policy_name</span><span class=p>]])</span><span class=w></span>
<span class=n>SETTINGS</span><span class=w></span>
<span class=w>    </span><span class=n>fsync_after_insert</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=n>fsync_directories</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=w></span>
</code></pre></div> <p>Data will be read from all servers in the <code class=syntax>logs</code> cluster, from the <code class=syntax>default.hits</code> table located on every server in the cluster.<br> Data is not only read but is partially processed on the remote servers (to the extent that this is possible).<br> For example, for a query with <code class=syntax>GROUP BY</code>, data will be aggregated on remote servers, and the intermediate states of aggregate functions will be sent to the requestor server. Then data will be further aggregated.</p> <p>Instead of the database name, you can use a constant expression that returns a string. For example: <code class=syntax>currentDatabase()</code>.</p> <h2 id=distributed-clusters>Clusters<a class=headerlink href=../amp/#distributed-clusters title="Permanent link"> </a></h2> <p>Clusters are configured in the <a href=../../../../../operations/configuration-files/amp/ >server configuration file</a>:</p> <div class=codehilite><pre><span></span><code class=syntax><span class=nt>&lt;remote_servers&gt;</span>
    <span class=nt>&lt;logs&gt;</span>
        <span class=cm>&lt;!-- Inter-server per-cluster secret for Distributed queries</span>
<span class=cm>             default: no secret (no authentication will be performed)</span>

<span class=cm>             If set, then Distributed queries will be validated on shards, so at least:</span>
<span class=cm>             - such cluster should exist on the shard,</span>
<span class=cm>             - such cluster should have the same secret.</span>

<span class=cm>             And also (and which is more important), the initial_user will</span>
<span class=cm>             be used as current user for the query.</span>
<span class=cm>        --&gt;</span>
        <span class=cm>&lt;!-- &lt;secret&gt;&lt;/secret&gt; --&gt;</span>
        <span class=nt>&lt;shard&gt;</span>
            <span class=cm>&lt;!-- Optional. Shard weight when writing data. Default: 1. --&gt;</span>
            <span class=nt>&lt;weight&gt;</span>1<span class=nt>&lt;/weight&gt;</span>
            <span class=cm>&lt;!-- Optional. Whether to write data to just one of the replicas. Default: false (write data to all replicas). --&gt;</span>
            <span class=nt>&lt;internal_replication&gt;</span>false<span class=nt>&lt;/internal_replication&gt;</span>
            <span class=nt>&lt;replica&gt;</span>
                <span class=cm>&lt;!-- Optional. Priority of the replica for load balancing (see also load_balancing setting). Default: 1 (less value has more priority). --&gt;</span>
                <span class=nt>&lt;priority&gt;</span>1<span class=nt>&lt;/priority&gt;</span>
                <span class=nt>&lt;host&gt;</span>example01-01-1<span class=nt>&lt;/host&gt;</span>
                <span class=nt>&lt;port&gt;</span>9000<span class=nt>&lt;/port&gt;</span>
            <span class=nt>&lt;/replica&gt;</span>
            <span class=nt>&lt;replica&gt;</span>
                <span class=nt>&lt;host&gt;</span>example01-01-2<span class=nt>&lt;/host&gt;</span>
                <span class=nt>&lt;port&gt;</span>9000<span class=nt>&lt;/port&gt;</span>
            <span class=nt>&lt;/replica&gt;</span>
        <span class=nt>&lt;/shard&gt;</span>
        <span class=nt>&lt;shard&gt;</span>
            <span class=nt>&lt;weight&gt;</span>2<span class=nt>&lt;/weight&gt;</span>
            <span class=nt>&lt;internal_replication&gt;</span>false<span class=nt>&lt;/internal_replication&gt;</span>
            <span class=nt>&lt;replica&gt;</span>
                <span class=nt>&lt;host&gt;</span>example01-02-1<span class=nt>&lt;/host&gt;</span>
                <span class=nt>&lt;port&gt;</span>9000<span class=nt>&lt;/port&gt;</span>
            <span class=nt>&lt;/replica&gt;</span>
            <span class=nt>&lt;replica&gt;</span>
                <span class=nt>&lt;host&gt;</span>example01-02-2<span class=nt>&lt;/host&gt;</span>
                <span class=nt>&lt;secure&gt;</span>1<span class=nt>&lt;/secure&gt;</span>
                <span class=nt>&lt;port&gt;</span>9440<span class=nt>&lt;/port&gt;</span>
            <span class=nt>&lt;/replica&gt;</span>
        <span class=nt>&lt;/shard&gt;</span>
    <span class=nt>&lt;/logs&gt;</span>
<span class=nt>&lt;/remote_servers&gt;</span>
</code></pre></div> <p>Here a cluster is defined with the name <code class=syntax>logs</code> that consists of two shards, each of which contains two replicas.<br> Shards refer to the servers that contain different parts of the data (in order to read all the data, you must access all the shards).<br> Replicas are duplicating servers (in order to read all the data, you can access the data on any one of the replicas).</p> <p>Cluster names must not contain dots.</p> <p>The parameters <code class=syntax>host</code>, <code class=syntax>port</code>, and optionally <code class=syntax>user</code>, <code class=syntax>password</code>, <code class=syntax>secure</code>, <code class=syntax>compression</code> are specified for each server:</p> <ul> <li><code class=syntax>host</code> – The address of the remote server. You can use either the domain or the IPv4 or IPv6 address. If you specify the domain, the server makes a DNS request when it starts, and the result is stored as long as the server is running. If the DNS request fails, the server does not start. If you change the DNS record, restart the server.</li> <li><code class=syntax>port</code> – The TCP port for messenger activity (<code class=syntax>tcp_port</code> in the config, usually set to 9000). Not to be confused with <code class=syntax>http_port</code>.</li> <li><code class=syntax>user</code> – Name of the user for connecting to a remote server. Default value is the <code class=syntax>default</code> user. This user must have access to connect to the specified server. Access is configured in the <code class=syntax>users.xml</code> file. For more information, see the section <a href=../../../../../operations/access-rights/amp/ >Access rights</a>.</li> <li><code class=syntax>password</code> – The password for connecting to a remote server (not masked). Default value: empty string.</li> <li><code class=syntax>secure</code> - Whether to use a secure SSL/TLS connection. Usually also requires specifying the port (the default secure port is <code class=syntax>9440</code>). The server should listen on <code class=syntax>&lt;tcp_port_secure&gt;9440&lt;/tcp_port_secure&gt;</code> and be configured with correct certificates.</li> <li><code class=syntax>compression</code> - Use data compression. Default value: <code class=syntax>true</code>.</li> </ul> <p>When specifying replicas, one of the available replicas will be selected for each of the shards when reading. You can configure the algorithm for load balancing (the preference for which replica to access) – see the <a href=../../../../../operations/settings/settings/amp/#settings-load_balancing>load_balancing</a> setting.<br> If the connection with the server is not established, there will be an attempt to connect with a short timeout. If the connection failed, the next replica will be selected, and so on for all the replicas. If the connection attempt failed for all the replicas, the attempt will be repeated the same way, several times.<br> This works in favour of resiliency, but does not provide complete fault tolerance: a remote server might accept the connection, but might not work, or work poorly.</p> <p>You can specify just one of the shards (in this case, query processing should be called remote, rather than distributed) or up to any number of shards. In each shard, you can specify from one to any number of replicas. You can specify a different number of replicas for each shard.</p> <p>You can specify as many clusters as you wish in the configuration.</p> <p>To view your clusters, use the <code class=syntax>system.clusters</code> table.</p> <p>The <code class=syntax>Distributed</code> engine allows working with a cluster like a local server. However, the cluster's configuration cannot be specified dynamically, it has to be configured in the server config file. Usually, all servers in a cluster will have the same cluster config (though this is not required). Clusters from the config file are updated on the fly, without restarting the server.</p> <p>If you need to send a query to an unknown set of shards and replicas each time, you do not need to create a <code class=syntax>Distributed</code> table – use the <code class=syntax>remote</code> table function instead. See the section <a href=../../../../../sql-reference/table-functions/amp/ >Table functions</a>.</p> <h2 id=distributed-writing-data>Writing data<a class=headerlink href=../amp/#distributed-writing-data title="Permanent link"> </a></h2> <p>There are two methods for writing data to a cluster:</p> <p>First, you can define which servers to write which data to and perform the write directly on each shard. In other words, perform direct <code class=syntax>INSERT</code> statements on the remote tables in the cluster that the <code class=syntax>Distributed</code> table is pointing to. This is the most flexible solution as you can use any sharding scheme, even one that is non-trivial due to the requirements of the subject area. This is also the most optimal solution since data can be written to different shards completely independently.</p> <p>Second, you can perform <code class=syntax>INSERT</code> statements on a <code class=syntax>Distributed</code> table. In this case, the table will distribute the inserted data across the servers itself. In order to write to a <code class=syntax>Distributed</code> table, it must have the <code class=syntax>sharding_key</code> parameter configured (except if there is only one shard).</p> <p>Each shard can have a <code class=syntax>&lt;weight&gt;</code> defined in the config file. By default, the weight is <code class=syntax>1</code>. Data is distributed across shards in the amount proportional to the shard weight. All shard weights are summed up, then each shard's weight is divided by the total to determine each shard's proportion. For example, if there are two shards and the first has a weight of 1 while the second has a weight of 2, the first will be sent one third (1 / 3) of inserted rows and the second will be sent two thirds (2 / 3).</p> <p>Each shard can have the <code class=syntax>internal_replication</code> parameter defined in the config file. If this parameter is set to <code class=syntax>true</code>, the write operation selects the first healthy replica and writes data to it. Use this if the tables underlying the <code class=syntax>Distributed</code> table are replicated tables (e.g. any of the <code class=syntax>Replicated*MergeTree</code> table engines). One of the table replicas will receive the write and it will be replicated to the other replicas automatically.</p> <p>If <code class=syntax>internal_replication</code> is set to <code class=syntax>false</code> (the default), data is written to all replicas. In this case, the <code class=syntax>Distributed</code> table replicates data itself. This is worse than using replicated tables because the consistency of replicas is not checked and, over time, they will contain slightly different data.</p> <p>To select the shard that a row of data is sent to, the sharding expression is analyzed, and its remainder is taken from dividing it by the total weight of the shards. The row is sent to the shard that corresponds to the half-interval of the remainders from <code class=syntax>prev_weights</code> to <code class=syntax>prev_weights + weight</code>, where <code class=syntax>prev_weights</code> is the total weight of the shards with the smallest number, and <code class=syntax>weight</code> is the weight of this shard. For example, if there are two shards, and the first has a weight of 9 while the second has a weight of 10, the row will be sent to the first shard for the remainders from the range [0, 9), and to the second for the remainders from the range [9, 19).</p> <p>The sharding expression can be any expression from constants and table columns that returns an integer. For example, you can use the expression <code class=syntax>rand()</code> for random distribution of data, or <code class=syntax>UserID</code> for distribution by the remainder from dividing the user’s ID (then the data of a single user will reside on a single shard, which simplifies running <code class=syntax>IN</code> and <code class=syntax>JOIN</code> by users). If one of the columns is not distributed evenly enough, you can wrap it in a hash function e.g. <code class=syntax>intHash64(UserID)</code>.</p> <p>A simple remainder from the division is a limited solution for sharding and isn’t always appropriate. It works for medium and large volumes of data (dozens of servers), but not for very large volumes of data (hundreds of servers or more). In the latter case, use the sharding scheme required by the subject area rather than using entries in <code class=syntax>Distributed</code> tables.</p> <p>You should be concerned about the sharding scheme in the following cases:</p> <ul> <li>Queries are used that require joining data (<code class=syntax>IN</code> or <code class=syntax>JOIN</code>) by a specific key. If data is sharded by this key, you can use local <code class=syntax>IN</code> or <code class=syntax>JOIN</code> instead of <code class=syntax>GLOBAL IN</code> or <code class=syntax>GLOBAL JOIN</code>, which is much more efficient.</li> <li>A large number of servers is used (hundreds or more) with a large number of small queries, for example, queries for data of individual clients (e.g. websites, advertisers, or partners). In order for the small queries to not affect the entire cluster, it makes sense to locate data for a single client on a single shard. Alternatively, as we’ve done in Yandex.Metrica, you can set up bi-level sharding: divide the entire cluster into “layers”, where a layer may consist of multiple shards. Data for a single client is located on a single layer, but shards can be added to a layer as necessary, and data is randomly distributed within them. <code class=syntax>Distributed</code> tables are created for each layer, and a single shared distributed table is created for global queries.</li> </ul> <p>Data is written asynchronously. When inserted in the table, the data block is just written to the local file system. The data is sent to the remote servers in the background as soon as possible. The periodicity for sending data is managed by the <a href=../../../../../operations/settings/settings/amp/#distributed_directory_monitor_sleep_time_ms>distributed_directory_monitor_sleep_time_ms</a> and <a href=../../../../../operations/settings/settings/amp/#distributed_directory_monitor_max_sleep_time_ms>distributed_directory_monitor_max_sleep_time_ms</a> settings. The <code class=syntax>Distributed</code> engine sends each file with inserted data separately, but you can enable batch sending of files with the <a href=../../../../../operations/settings/settings/amp/#distributed_directory_monitor_batch_inserts>distributed_directory_monitor_batch_inserts</a> setting. This setting improves cluster performance by better utilizing local server and network resources. You should check whether data is sent successfully by checking the list of files (data waiting to be sent) in the table directory: <code class=syntax>/var/lib/clickhouse/data/database/table/</code>. The number of threads performing background tasks can be set by <a href=../../../../../operations/settings/settings/amp/#background_distributed_schedule_pool_size>background_distributed_schedule_pool_size</a> setting.</p> <p>If the server ceased to exist or had a rough restart (for example, due to a hardware failure) after an <code class=syntax>INSERT</code> to a <code class=syntax>Distributed</code> table, the inserted data might be lost. If a damaged data part is detected in the table directory, it is transferred to the <code class=syntax>broken</code> subdirectory and no longer used.</p> <h2 id=distributed-reading-data>Reading data<a class=headerlink href=../amp/#distributed-reading-data title="Permanent link"> </a></h2> <p>When querying a <code class=syntax>Distributed</code> table, <code class=syntax>SELECT</code> queries are sent to all shards and work regardless of how data is distributed across the shards (they can be distributed completely randomly). When you add a new shard, you do not have to transfer old data into it. Instead, you can write new data to it by using a heavier weight – the data will be distributed slightly unevenly, but queries will work correctly and efficiently.</p> <p>When the <code class=syntax>max_parallel_replicas</code> option is enabled, query processing is parallelized across all replicas within a single shard. For more information, see the section <a href=../../../../../operations/settings/settings/amp/#settings-max_parallel_replicas>max_parallel_replicas</a>.</p> <h2 id=virtual-columns>Virtual Columns<a class=headerlink href=../amp/#virtual-columns title="Permanent link"> </a></h2> <ul> <li><code class=syntax>_shard_num</code> — Contains the <code class=syntax>shard_num</code> value from the table <code class=syntax>system.clusters</code>. Type: <a href=../../../../../sql-reference/data-types/int-uint/amp/ >UInt32</a>.</li> </ul> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">Note</p> <p>Since <a href=../../../../../sql-reference/table-functions/remote/amp/ class=alert-link>remote</a> and <a href=../../../../../sql-reference/table-functions/cluster/amp/ class=alert-link>cluster</a> table functions internally create temporary Distributed table, <code class=syntax>_shard_num</code> is available there too.</p> </div> <p><strong>See Also</strong></p> <ul> <li><a href=../../../amp/#table_engines-virtual_columns>Virtual columns</a> description</li> <li><a href=../../../../../operations/settings/settings/amp/#background_distributed_schedule_pool_size>background_distributed_schedule_pool_size</a> setting</li> <li><a href=../../../../../sql-reference/functions/other-functions/amp/#shard-num>shardNum()</a> and <a href=../../../../../sql-reference/functions/other-functions/amp/#shard-count>shardCount()</a> functions</li> </ul>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2022 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/c60fd44c5b70c56ff0f9c7fc538e58c6c8186aea" rel="external nofollow noreferrer" target="_blank" class="text-reset">c60fd44c</a>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/en/engines/table-engines/special/distributed/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
