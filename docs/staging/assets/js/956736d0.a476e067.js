"use strict";(self.webpackChunkclickhouse=self.webpackChunkclickhouse||[]).push([[70032],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return u}});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=c(a),u=o,k=m["".concat(s,".").concat(u)]||m[u]||d[u]||r;return a?n.createElement(k,i(i({ref:t},p),{},{components:a})):n.createElement(k,i({ref:t},p))}));function u(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},41646:function(e,t,a){a.r(t),a.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var n=a(87462),o=a(63366),r=(a(67294),a(3905)),i=["components"],l={sidebar_position:41,sidebar_label:"Applying CatBoost Models"},s="Applying a Catboost Model in ClickHouse",c={unversionedId:"guides/developer/apply-catboost-model",id:"guides/developer/apply-catboost-model",title:"Applying a Catboost Model in ClickHouse",description:"applying-catboost-model-in-clickhouse}",source:"@site/docs/guides/developer/apply-catboost-model.md",sourceDirName:"guides/developer",slug:"/guides/developer/apply-catboost-model",permalink:"/docs/staging/docs/guides/developer/apply-catboost-model",tags:[],version:"current",sidebarPosition:41,frontMatter:{sidebar_position:41,sidebar_label:"Applying CatBoost Models"},sidebar:"tutorialSidebar",previous:{title:"Full-text Search with Quickwit",permalink:"/docs/staging/docs/guides/developer/full-text-search"},next:{title:"Improving Query Performance",permalink:"/docs/staging/docs/guides/improving-query-performance"}},p={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"1. Create a Table",id:"create-table",level:2},{value:"2. Insert the Data to the Table",id:"insert-data-to-table",level:2},{value:"3. Integrate CatBoost into ClickHouse",id:"integrate-catboost-into-clickhouse",level:2},{value:"4. Run the Model Inference from SQL",id:"run-model-inference",level:2}],m={toc:d};function u(e){var t=e.components,a=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"applying-catboost-model-in-clickhouse"},"Applying a Catboost Model in ClickHouse"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://catboost.ai"},"CatBoost")," is a free and open-source gradient boosting library developed at Yandex for machine learning."),(0,r.kt)("p",null,"With this instruction, you will learn to apply pre-trained models in ClickHouse by running model inference from SQL."),(0,r.kt)("p",null,"To apply a CatBoost model in ClickHouse:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#create-table"},"Create a Table"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#insert-data-to-table"},"Insert the Data to the Table"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#integrate-catboost-into-clickhouse"},"Integrate CatBoost into ClickHouse")," (Optional step)."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"#run-model-inference"},"Run the Model Inference from SQL"),".")),(0,r.kt)("p",null,"For more information about training CatBoost models, see ",(0,r.kt)("a",{parentName:"p",href:"https://catboost.ai/docs/features/training.html#training"},"Training and applying models"),"."),(0,r.kt)("p",null,"You can reload CatBoost models if the configuration was updated without restarting the server using ",(0,r.kt)("a",{parentName:"p",href:"/docs/staging/docs/en/sql-reference/statements/system#query_language-system-reload-model"},"RELOAD MODEL")," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/staging/docs/en/sql-reference/statements/system#query_language-system-reload-models"},"RELOAD MODELS")," system queries."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"If you do not have the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/install/"},"Docker")," yet, install it."),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("a",{parentName:"p",href:"https://www.docker.com"},"Docker")," is a software platform that allows you to create containers that isolate a CatBoost and ClickHouse installation from the rest of the system."))),(0,r.kt)("p",null,"Before applying a CatBoost model:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1.")," Pull the ",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/yandex/tutorial-catboost-clickhouse"},"Docker image")," from the registry:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker pull yandex/tutorial-catboost-clickhouse\n")),(0,r.kt)("p",null,"This Docker image contains everything you need to run CatBoost and ClickHouse: code, runtime, libraries, environment variables, and configuration files."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2.")," Make sure the Docker image has been successfully pulled:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker image ls\nREPOSITORY                            TAG                 IMAGE ID            CREATED             SIZE\nyandex/tutorial-catboost-clickhouse   latest              622e4d17945b        22 hours ago        1.37GB\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.")," Start a Docker container based on this image:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker run -it -p 8888:8888 yandex/tutorial-catboost-clickhouse\n")),(0,r.kt)("h2",{id:"create-table"},"1. Create a Table"),(0,r.kt)("p",null,"To create a ClickHouse table for the training sample:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1.")," Start ClickHouse console client in the interactive mode:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ clickhouse client\n")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The ClickHouse server is already running inside the Docker container."))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2.")," Create the table using the command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},":) CREATE TABLE amazon_train\n(\n    date Date MATERIALIZED today(),\n    ACTION UInt8,\n    RESOURCE UInt32,\n    MGR_ID UInt32,\n    ROLE_ROLLUP_1 UInt32,\n    ROLE_ROLLUP_2 UInt32,\n    ROLE_DEPTNAME UInt32,\n    ROLE_TITLE UInt32,\n    ROLE_FAMILY_DESC UInt32,\n    ROLE_FAMILY UInt32,\n    ROLE_CODE UInt32\n)\nENGINE = MergeTree ORDER BY date\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.")," Exit from ClickHouse console client:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},":) exit\n")),(0,r.kt)("h2",{id:"insert-data-to-table"},"2. Insert the Data to the Table"),(0,r.kt)("p",null,"To insert the data:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1.")," Run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ clickhouse client --host 127.0.0.1 --query 'INSERT INTO amazon_train FORMAT CSVWithNames' < ~/amazon/train.csv\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2.")," Start ClickHouse console client in the interactive mode:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ clickhouse client\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.")," Make sure the data has been uploaded:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},":) SELECT count() FROM amazon_train\n\nSELECT count()\nFROM amazon_train\n\n+-count()-+\n|   65538 |\n+-------+\n")),(0,r.kt)("h2",{id:"integrate-catboost-into-clickhouse"},"3. Integrate CatBoost into ClickHouse"),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("strong",{parentName:"p"},"Optional step.")," The Docker image contains everything you need to run CatBoost and ClickHouse."))),(0,r.kt)("p",null,"To integrate CatBoost into ClickHouse:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1.")," Build the evaluation library."),(0,r.kt)("p",null,"The fastest way to evaluate a CatBoost model is compile ",(0,r.kt)("inlineCode",{parentName:"p"},"libcatboostmodel.<so|dll|dylib>")," library. For more information about how to build the library, see ",(0,r.kt)("a",{parentName:"p",href:"https://catboost.ai/docs/concepts/c-plus-plus-api_dynamic-c-pluplus-wrapper.html"},"CatBoost documentation"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"2.")," Create a new directory anywhere and with any name, for example, ",(0,r.kt)("inlineCode",{parentName:"p"},"data")," and put the created library in it. The Docker image already contains the library ",(0,r.kt)("inlineCode",{parentName:"p"},"data/libcatboostmodel.so"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.")," Create a new directory for config model anywhere and with any name, for example, ",(0,r.kt)("inlineCode",{parentName:"p"},"models"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"4.")," Create a model configuration file with any name, for example, ",(0,r.kt)("inlineCode",{parentName:"p"},"models/amazon_model.xml"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"5.")," Describe the model configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<models>\n    <model>\n        \x3c!-- Model type. Now catboost only. --\x3e\n        <type>catboost</type>\n        \x3c!-- Model name. --\x3e\n        <name>amazon</name>\n        \x3c!-- Path to trained model. --\x3e\n        <path>/home/catboost/tutorial/catboost_model.bin</path>\n        \x3c!-- Update interval. --\x3e\n        <lifetime>0</lifetime>\n    </model>\n</models>\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"6.")," Add the path to CatBoost and the model configuration to the ClickHouse configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"\x3c!-- File etc/clickhouse-server/config.d/models_config.xml. --\x3e\n<catboost_dynamic_library_path>/home/catboost/data/libcatboostmodel.so</catboost_dynamic_library_path>\n<models_config>/home/catboost/models/*_model.xml</models_config>\n")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can change path to the CatBoost model configuration later without restarting server."))),(0,r.kt)("h2",{id:"run-model-inference"},"4. Run the Model Inference from SQL"),(0,r.kt)("p",null,"For test model run the ClickHouse client ",(0,r.kt)("inlineCode",{parentName:"p"},"$ clickhouse client"),"."),(0,r.kt)("p",null,"Let\u2019s make sure that the model is working:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},":) SELECT\n    modelEvaluate('amazon',\n                RESOURCE,\n                MGR_ID,\n                ROLE_ROLLUP_1,\n                ROLE_ROLLUP_2,\n                ROLE_DEPTNAME,\n                ROLE_TITLE,\n                ROLE_FAMILY_DESC,\n                ROLE_FAMILY,\n                ROLE_CODE) > 0 AS prediction,\n    ACTION AS target\nFROM amazon_train\nLIMIT 10\n")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Function ",(0,r.kt)("a",{parentName:"p",href:"/docs/staging/docs/en/sql-reference/functions/other-functions#function-modelevaluate"},"modelEvaluate")," returns tuple with per-class raw predictions for multiclass models."))),(0,r.kt)("p",null,"Let\u2019s predict the probability:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},":) SELECT\n    modelEvaluate('amazon',\n                RESOURCE,\n                MGR_ID,\n                ROLE_ROLLUP_1,\n                ROLE_ROLLUP_2,\n                ROLE_DEPTNAME,\n                ROLE_TITLE,\n                ROLE_FAMILY_DESC,\n                ROLE_FAMILY,\n                ROLE_CODE) AS prediction,\n    1. / (1 + exp(-prediction)) AS probability,\n    ACTION AS target\nFROM amazon_train\nLIMIT 10\n")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"More info about ",(0,r.kt)("a",{parentName:"p",href:"/docs/staging/docs/en/sql-reference/functions/math-functions"},"exp()")," function."))),(0,r.kt)("p",null,"Let\u2019s calculate LogLoss on the sample:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},":) SELECT -avg(tg * log(prob) + (1 - tg) * log(1 - prob)) AS logloss\nFROM\n(\n    SELECT\n        modelEvaluate('amazon',\n                    RESOURCE,\n                    MGR_ID,\n                    ROLE_ROLLUP_1,\n                    ROLE_ROLLUP_2,\n                    ROLE_DEPTNAME,\n                    ROLE_TITLE,\n                    ROLE_FAMILY_DESC,\n                    ROLE_FAMILY,\n                    ROLE_CODE) AS prediction,\n        1. / (1. + exp(-prediction)) AS prob,\n        ACTION AS tg\n    FROM amazon_train\n)\n")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"More info about ",(0,r.kt)("a",{parentName:"p",href:"/docs/staging/docs/en/sql-reference/aggregate-functions/reference/avg#agg_function-avg"},"avg()")," and ",(0,r.kt)("a",{parentName:"p",href:"/docs/staging/docs/en/sql-reference/functions/math-functions"},"log()")," functions."))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/guides/apply_catboost_model/"},"Original article")," "))}u.isMDXComponent=!0}}]);