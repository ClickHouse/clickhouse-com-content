










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="zh">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>ClickHouse 版本 18.16 | ClickHouse文档</title>
    <link rel="canonical" href="https://clickhouse.com/docs/zh/whats-new/changelog/2018/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer{display:block}body{margin:0;font-family:Noto Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}dl,ul{margin-bottom:1rem}dl,ul{margin-top:0}ul ul{margin-bottom:0}dd{margin-bottom:.5rem;margin-left:0}b{font-weight:bolder}a{text-decoration:none;background-color:transparent}a,a:hover{color:#ff8c00}a:hover{text-decoration:underline}a:not([href]),a:not([href]):hover{color:inherit;text-decoration:none}code{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}input,select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}input{overflow:visible}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=date],input[type=datetime-local],input[type=month],input[type=time]{-webkit-appearance:listbox}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:Hind Siliguri,sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}.order-last{order:13}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}.offset-1{margin-left:8.3333333333%}.offset-2{margin-left:16.6666666667%}.offset-3{margin-left:25%}.offset-4{margin-left:33.3333333333%}.offset-5{margin-left:41.6666666667%}.offset-6{margin-left:50%}.offset-7{margin-left:58.3333333333%}.offset-8{margin-left:66.6666666667%}.offset-9{margin-left:75%}.offset-10{margin-left:83.3333333333%}.offset-11{margin-left:91.6666666667%}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}.order-md-last{order:13}.order-md-0{order:0}.order-md-1{order:1}.order-md-2{order:2}.order-md-3{order:3}.order-md-4{order:4}.order-md-5{order:5}.order-md-6{order:6}.order-md-7{order:7}.order-md-8{order:8}.order-md-9{order:9}.order-md-10{order:10}.order-md-11{order:11}.order-md-12{order:12}.offset-md-0{margin-left:0}.offset-md-1{margin-left:8.3333333333%}.offset-md-2{margin-left:16.6666666667%}.offset-md-3{margin-left:25%}.offset-md-4{margin-left:33.3333333333%}.offset-md-5{margin-left:41.6666666667%}.offset-md-6{margin-left:50%}.offset-md-7{margin-left:58.3333333333%}.offset-md-8{margin-left:66.6666666667%}.offset-md-9{margin-left:75%}.offset-md-10{margin-left:83.3333333333%}.offset-md-11{margin-left:91.6666666667%}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}.order-lg-last{order:13}.order-lg-0{order:0}.order-lg-1{order:1}.order-lg-2{order:2}.order-lg-3{order:3}.order-lg-4{order:4}.order-lg-5{order:5}.order-lg-6{order:6}.order-lg-7{order:7}.order-lg-8{order:8}.order-lg-9{order:9}.order-lg-10{order:10}.order-lg-11{order:11}.order-lg-12{order:12}.offset-lg-0{margin-left:0}.offset-lg-1{margin-left:8.3333333333%}.offset-lg-2{margin-left:16.6666666667%}.offset-lg-3{margin-left:25%}.offset-lg-4{margin-left:33.3333333333%}.offset-lg-5{margin-left:41.6666666667%}.offset-lg-6{margin-left:50%}.offset-lg-7{margin-left:58.3333333333%}.offset-lg-8{margin-left:66.6666666667%}.offset-lg-9{margin-left:75%}.offset-lg-10{margin-left:83.3333333333%}.offset-lg-11{margin-left:91.6666666667%}}.table{width:100%;margin-bottom:8px;color:#212529}.table-primary{background-color:#fff1b8}.table-light{background-color:#fbfcfd}.table-dark{background-color:#ccced0}.table-primary-light{background-color:#fffefb}.table-white{background-color:#fff}.table-black{background-color:#c1c2c3}.table-orange{background-color:#ffdfb8}.table-light-orange{background-color:#fff7ea}.table-dark{color:#fff;background-color:#343a40}.form-group{margin-bottom:1rem}.form-text{display:block;margin-top:.25rem}.form-row{display:flex;flex-wrap:wrap;margin-right:-5px;margin-left:-5px}.form-row>.col,.form-row>[class*=col-]{padding-right:5px;padding-left:5px}.form-check{position:relative;display:block;padding-left:1.25rem}.form-check-input{position:absolute;margin-top:.3rem;margin-left:-1.25rem}.form-check-inline{display:inline-flex;align-items:center;padding-left:0;margin-right:.75rem}.form-check-inline .form-check-input{position:static;margin-top:0;margin-right:.3125rem;margin-left:0}.invalid-feedback{display:none;width:100%;margin-top:.25rem;font-size:80%;color:#dc3545}.is-invalid~.invalid-feedback{display:block}.custom-select.is-invalid{border-color:#dc3545;padding-right:calc(.75em+2.3125rem);background:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px,url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545'%3E%3Ccircle cx='6' cy='6' r='4.5'/%3E%3Cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3E%3Ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3E%3C/svg%3E") #fff no-repeat center right 1.75rem/calc(.75em+.375rem) calc(.75em+.375rem)}.custom-select.is-invalid:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.form-check-input.is-invalid~.invalid-feedback{display:block}.form-inline{display:flex;flex-flow:row wrap;align-items:center}.form-inline .form-check{width:100%}@media(min-width:616px){.form-inline .form-group{display:flex;align-items:center;margin-bottom:0}.form-inline .form-group{flex:0 0 auto;flex-flow:row wrap}.form-inline .custom-select,.form-inline .input-group{width:auto}.form-inline .form-check{display:flex;align-items:center;justify-content:center;width:auto;padding-left:0}.form-inline .form-check-input{position:relative;flex-shrink:0;margin-top:0;margin-right:.25rem;margin-left:0}}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-primary{color:#495057;background-color:#fc0;border-color:#fc0}.btn-primary:focus,.btn-primary:hover{color:#495057;background-color:#d9ad00;border-color:#cca300}.btn-primary:focus{box-shadow:0 0 0 0 rgba(228,185,13,.5)}.btn-primary:disabled{color:#495057;background-color:#fc0;border-color:#fc0}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:focus,.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:focus,.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-primary-light{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-primary-light:focus,.btn-primary-light:hover{color:#495057;background-color:#ffedca;border-color:#ffe9bd}.btn-primary-light:focus{box-shadow:0 0 0 0 rgba(228,225,217,.5)}.btn-primary-light:disabled{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:focus,.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:focus,.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:focus,.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:focus,.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-primary{color:#fc0;border-color:#fc0}.btn-outline-primary:hover{color:#495057;background-color:#fc0;border-color:#fc0}.btn-outline-primary:focus{box-shadow:0 0 0 0 rgba(255,204,0,.5)}.btn-outline-primary:disabled{color:#fc0;background-color:transparent}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-primary-light{color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:hover{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:focus{box-shadow:0 0 0 0 rgba(255,250,240,.5)}.btn-outline-primary-light:disabled{color:#fffaf0;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 hsla(0,0%,100%,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.btn-group,.btn-group-vertical{position:relative;display:inline-flex;vertical-align:middle}.btn-group-vertical>.btn,.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group-vertical>.btn:active,.btn-group-vertical>.btn:focus,.btn-group-vertical>.btn:hover,.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.btn-group-vertical{flex-direction:column;align-items:flex-start;justify-content:center}.btn-group-vertical>.btn,.btn-group-vertical>.btn-group{width:100%}.btn-group-vertical>.btn-group:not(:first-child),.btn-group-vertical>.btn:not(:first-child){margin-top:-1px}.btn-group-vertical>.btn-group:not(:last-child)>.btn{border-bottom-right-radius:0;border-bottom-left-radius:0}.btn-group-vertical>.btn-group:not(:first-child)>.btn,.btn-group-vertical>.btn:not(:first-child){border-top-left-radius:0;border-top-right-radius:0}.input-group{position:relative;display:flex;flex-wrap:wrap;align-items:stretch;width:100%}.input-group>.custom-file,.input-group>.custom-select{position:relative;flex:1 1 0;min-width:0;margin-bottom:0}.input-group>.custom-file+.custom-file,.input-group>.custom-file+.custom-select,.input-group>.custom-select+.custom-file,.input-group>.custom-select+.custom-select{margin-left:-1px}.input-group>.custom-select:focus{z-index:3}.input-group>.custom-file .custom-file-input:focus{z-index:4}.input-group>.custom-select:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.custom-select:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group>.custom-file{display:flex;align-items:center}.input-group-text{display:flex;align-items:center;padding:.375rem .75rem;margin-bottom:0;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;text-align:center;white-space:nowrap;background-color:#e9ecef;border:1px solid #ced4da;border-radius:8px}.input-group-text input[type=checkbox],.input-group-text input[type=radio]{margin-top:0}.input-group-lg>.custom-select{height:calc(1.5em+1rem+2px)}.input-group-lg>.custom-select{padding:.5rem 1rem;font-size:1.125rem;line-height:1.5;border-radius:8px}.input-group-lg>.custom-select{padding-right:1.75rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-file{display:inline-block;margin-bottom:0}.custom-file,.custom-file-input{position:relative;width:100%;height:calc(1.5em+.75rem+2px)}.custom-file-input{z-index:2;margin:0;opacity:0}.custom-range{width:100%;height:1.4rem;padding:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-range:focus{outline:0}.custom-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-moz-range-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-ms-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range::-moz-focus-outer{border:0}.custom-range::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:#fc0;border:0;border-radius:1rem;-webkit-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-webkit-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-webkit-slider-thumb{-webkit-transition:none;transition:none}}.custom-range::-webkit-slider-thumb:active{background-color:#fff0b3}.custom-range::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-moz-range-thumb{width:1rem;height:1rem;background-color:#fc0;border:0;border-radius:1rem;-moz-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-moz-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-moz-range-thumb{-moz-transition:none;transition:none}}.custom-range::-moz-range-thumb:active{background-color:#fff0b3}.custom-range::-moz-range-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-ms-thumb{width:1rem;height:1rem;margin-top:0;margin-right:.2rem;margin-left:.2rem;background-color:#fc0;border:0;border-radius:1rem;-ms-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-ms-thumb{-ms-transition:none;transition:none}}.custom-range::-ms-thumb:active{background-color:#fff0b3}.custom-range::-ms-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:transparent;border-color:transparent;border-width:.5rem}.custom-range::-ms-fill-lower,.custom-range::-ms-fill-upper{background-color:#dee2e6;border-radius:1rem}.custom-range::-ms-fill-upper{margin-right:15px}.custom-range:disabled::-webkit-slider-thumb{background-color:#d6dbdf}.custom-range:disabled::-webkit-slider-runnable-track{cursor:default}.custom-range:disabled::-moz-range-thumb{background-color:#d6dbdf}.custom-range:disabled::-moz-range-track{cursor:default}.custom-range:disabled::-ms-thumb{background-color:#d6dbdf}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}.container,body{min-width:980px}.table{border-collapse:collapse}.table-dark{color:inherit}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/docs/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/docs/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h2 id=clickhouse-release-18-16>ClickHouse 版本 18.16<a class=headerlink href=../amp/#clickhouse-release-18-16 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-18-16-1-2018-12-21>ClickHouse 版本 18.16.1, 2018-12-21<a class=headerlink href=../amp/#clickhouse-release-18-16-1-2018-12-21 title="Permanent link"> </a></h3> <h4 id=bug-fixes>Bug 修复:<a class=headerlink href=../amp/#bug-fixes title="Permanent link"> </a></h4> <ul> <li>修复了导致使用 ODBC 源更新字典出现问题的错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/3825 rel="external nofollow noreferrer" target=_blank>#3825</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/3829 rel="external nofollow noreferrer" target=_blank>#3829</a></li> <li>聚合函数的 JIT 编译现在适用于 LowCardinality 列. <a href=https://github.com/ClickHouse/ClickHouse/issues/3838 rel="external nofollow noreferrer" target=_blank>#3838</a></li> </ul> <h4 id=improvements>改进:<a class=headerlink href=../amp/#improvements title="Permanent link"> </a></h4> <ul> <li>添加了 <code class=syntax>low_cardinality_allow_in_native_format</code> 设置 (默认启用). 禁用时, LowCardinality 列将转换为用于 SELECT 查询的普通列, 而用于 INSERT 查询的普通列将被转换. <a href=https://github.com/ClickHouse/ClickHouse/pull/3879 rel="external nofollow noreferrer" target=_blank>#3879</a></li> </ul> <h4 id=build-improvements>Build 改进:<a class=headerlink href=../amp/#build-improvements title="Permanent link"> </a></h4> <ul> <li>修复了在 macOS 和 ARM 上的构建.</li> </ul> <h3 id=clickhouse-release-18-16-0-2018-12-14>ClickHouse 版本 18.16.0, 2018-12-14<a class=headerlink href=../amp/#clickhouse-release-18-16-0-2018-12-14 title="Permanent link"> </a></h3> <h4 id=new-features>新特征:<a class=headerlink href=../amp/#new-features title="Permanent link"> </a></h4> <ul> <li>以半结构化输入格式 (<code class=syntax>JSONEachRow</code> 、 <code class=syntax>TSKV</code> ) 加载数据时, 会评估 <code class=syntax>DEFAULT</code> 表达式的缺失字段. 该功能通过 <code class=syntax>insert_sample_with_metadata</code> 设置启用. <a href=https://github.com/ClickHouse/ClickHouse/pull/3555 rel="external nofollow noreferrer" target=_blank>#3555</a></li> <li><code class=syntax>ALTER TABLE</code> 查询现在具有 <code class=syntax>MODIFY ORDER BY</code> 操作, 用于在添加或删除表列时更改排序键. 这对于 <code class=syntax>MergeTree</code> 系列中的表很有用, 这些表在基于此排序键合并时执行附加任务, 例如 <code class=syntax>SummingMergeTree</code>、<code class=syntax>AggregatingMergeTree</code> 等. <a href=https://github.com/ClickHouse/ClickHouse/pull/3581 rel="external nofollow noreferrer" target=_blank>#3581</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3755 rel="external nofollow noreferrer" target=_blank>#3755</a></li> <li>对于<code class=syntax>MergeTree</code> 系列中的表, 现在您可以指定不同的排序键 (<code class=syntax>ORDER BY</code>) 和索引 (<code class=syntax>PRIMARY KEY</code>) . 排序键可以比索引长. <a href=https://github.com/ClickHouse/ClickHouse/pull/3581 rel="external nofollow noreferrer" target=_blank>#3581</a></li> <li>添加了 <code class=syntax>hdfs</code> 表功能和 <code class=syntax>HDFS</code> 表引擎, 用于导入和导出数据到HDFS. <a href=https://github.com/ClickHouse/ClickHouse/pull/3617 rel="external nofollow noreferrer" target=_blank>chenxing-xc</a></li> <li>添加了使用 base64 的函数: <code class=syntax>base64Encode</code>, <code class=syntax>base64Decode</code>, <code class=syntax>tryBase64Decode</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3350 rel="external nofollow noreferrer" target=_blank>Alexander Krasheninnikov</a></li> <li>现在你可以使用一个参数来配置<code class=syntax>uniqCombined</code>聚合函数的精度(选择HyperLogLog单元格的数量). <a href=https://github.com/ClickHouse/ClickHouse/pull/3406 rel="external nofollow noreferrer" target=_blank>#3406</a></li> <li>添加了 <code class=syntax>system.contributors</code> 表, 其中包含在 ClickHouse 中提交的每个人的姓名. <a href=https://github.com/ClickHouse/ClickHouse/pull/3452 rel="external nofollow noreferrer" target=_blank>#3452</a></li> <li>添加了省略 <code class=syntax>ALTER TABLE ... FREEZE</code> 查询的分区的功能，以便一次备份所有分区. <a href=https://github.com/ClickHouse/ClickHouse/pull/3514 rel="external nofollow noreferrer" target=_blank>#3514</a></li> <li>添加了不需要指定返回值类型的 <code class=syntax>dictGet</code> 和 <code class=syntax>dictGetOrDefault</code> 函数. 类型是根据字典描述自动确定的. <a href=https://github.com/ClickHouse/ClickHouse/pull/3564 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>现在您可以为表描述中的列指定注释并使用 <code class=syntax>ALTER</code> 更改它. <a href=https://github.com/ClickHouse/ClickHouse/pull/3377 rel="external nofollow noreferrer" target=_blank>#3377</a></li> <li>支持使用简单键读取 <code class=syntax>Join</code> 类型的表. <a href=https://github.com/ClickHouse/ClickHouse/pull/3728 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>现在您可以在创建 <code class=syntax>Join</code> 类型表时指定选项 <code class=syntax>join_use_nulls</code>、<code class=syntax>max_rows_in_join</code>、<code class=syntax>max_bytes_in_join</code> 和 <code class=syntax>join_overflow_mode</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3728 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>加了 <code class=syntax>joinGet</code> 函数, 允许您像使用字典一样使用 <code class=syntax>Join</code> 类型的表. <a href=https://github.com/ClickHouse/ClickHouse/pull/3728 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>将 <code class=syntax>partition_key</code>、<code class=syntax>sorting_key</code>、<code class=syntax>primary_key</code> 和 <code class=syntax>sampling_key</code> 列添加到 <code class=syntax>system.tables</code> 表中, 以提供有关表键的信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/3609 rel="external nofollow noreferrer" target=_blank>#3609</a></li> <li>向 <code class=syntax>system.columns</code> 表添加了 <code class=syntax>is_in_partition_key</code>、<code class=syntax>is_in_sorting_key</code> 、<code class=syntax>is_in_primary_key</code> 和 <code class=syntax>is_in_sampling_key</code> 列. <a href=https://github.com/ClickHouse/ClickHouse/pull/3609 rel="external nofollow noreferrer" target=_blank>#3609</a></li> <li>将 <code class=syntax>min_time</code> 和 <code class=syntax>max_time</code> 列添加到 <code class=syntax>system.parts</code> 表中. 当分区键是由 <code class=syntax>DateTime</code>列组成的表达式时，将填充这些列. <a href=https://github.com/ClickHouse/ClickHouse/pull/3800 rel="external nofollow noreferrer" target=_blank>Emmanuel Donin de Rosière</a></li> </ul> <h4 id=bug-fixes-1>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-1 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>LowCardinality</code> 数据类型的修复和性能改进. <code class=syntax>GROUP BY</code> 使用 <code class=syntax>LowCardinality(Nullable(...))</code>. 获取 <code class=syntax>extremes</code> 的值. 处理高阶函数. <code class=syntax>LEFT ARRAY JOIN</code>. 分布式 <code class=syntax>GROUP BY</code>. 返回 <code class=syntax>Array</code> 的函数. 执行 <code class=syntax>ORDER BY</code>. 写入 <code class=syntax>Distributed</code> 表(nicelulu). 向后兼容来自实现 <code class=syntax>Native</code> 协议的旧客户端的 <code class=syntax>INSERT</code> 查询. 支持 <code class=syntax>JOIN</code> 的 <code class=syntax>LowCardinality</code>. 在单个流中工作时提高了性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/3823 rel="external nofollow noreferrer" target=_blank>#3823</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3803 rel="external nofollow noreferrer" target=_blank>#3803</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3799 rel="external nofollow noreferrer" target=_blank>#3799</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3769 rel="external nofollow noreferrer" target=_blank>#3769</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3744 rel="external nofollow noreferrer" target=_blank>#3744</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3681 rel="external nofollow noreferrer" target=_blank>#3681</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3651 rel="external nofollow noreferrer" target=_blank>#3651</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3649 rel="external nofollow noreferrer" target=_blank>#3649</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3641 rel="external nofollow noreferrer" target=_blank>#3641</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3632 rel="external nofollow noreferrer" target=_blank>#3632</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3568 rel="external nofollow noreferrer" target=_blank>#3568</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3523 rel="external nofollow noreferrer" target=_blank>#3523</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3518 rel="external nofollow noreferrer" target=_blank>#3518</a></li> <li>修复了 <code class=syntax>select_sequential_consistency</code> 选项的工作方式. 以前, 启用此设置后, 有时会在开始写入新分区后返回不完整的结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/2863 rel="external nofollow noreferrer" target=_blank>#2863</a></li> <li>执行 DDL <code class=syntax>ON CLUSTER</code> 查询和 <code class=syntax>ALTER UPDATE/DELETE</code> 时正确指定数据库. <a href=https://github.com/ClickHouse/ClickHouse/pull/3772 rel="external nofollow noreferrer" target=_blank>#3772</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3460 rel="external nofollow noreferrer" target=_blank>#3460</a></li> <li>为 VIEW 内的子查询正确指定了数据库. <a href=https://github.com/ClickHouse/ClickHouse/pull/3521 rel="external nofollow noreferrer" target=_blank>#3521</a></li> <li>修复了 <code class=syntax>PREWHERE</code> 中的 <code class=syntax>FINAL</code> 错误, 用于 <code class=syntax>VersionedCollapsingMergeTree</code> . <a href=https://github.com/ClickHouse/ClickHouse/commit/7167bfd7b365538f7a91c4307ad77e552ab4e8c1 rel="external nofollow noreferrer" target=_blank>7167bfd7</a></li> <li>现在您可以使用 <code class=syntax>KILL QUERY</code> 取消尚未启动的查询, 因为它们正在等待表被锁定. <a href=https://github.com/ClickHouse/ClickHouse/pull/3517 rel="external nofollow noreferrer" target=_blank>#3517</a></li> <li>如果时钟在午夜后移, 则更正了日期和时间计算(这发生在伊朗, 1981 年至 1983 年发生在莫斯科). 以前, 这导致时间比必要的提前一天重置, 并且还导致文本格式的日期和时间格式不正确. <a href=https://github.com/ClickHouse/ClickHouse/pull/3819 rel="external nofollow noreferrer" target=_blank>#3819</a></li> <li>修复了某些情况下 <code class=syntax>VIEW</code> 和省略数据库的子查询的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3521 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>修复了由于未锁定内部 <code class=syntax>MATERIALIZED VIEW</code> 而同时从 <code class=syntax>MATERIALIZED VIEW</code> 中读取并删除 <code class=syntax>MATERIALIZED VIEW</code> 时的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/3404 rel="external nofollow noreferrer" target=_blank>#3404</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3694 rel="external nofollow noreferrer" target=_blank>#3694</a></li> <li>修复了错误<code class=syntax>Lock handler cannot be nullptr</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3689 rel="external nofollow noreferrer" target=_blank>#3689</a></li> <li>修复了启用 <code class=syntax>compile_expressions</code> 选项时的查询处理(默认情况下启用). 不再展开像 <code class=syntax>now</code> 函数这样的非确定性常量表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/3457 rel="external nofollow noreferrer" target=_blank>#3457</a></li> <li>修复了在 <code class=syntax>toDecimal32/64/128</code> 函数中指定非常量比例参数时崩溃的问题s.</li> <li>修复了尝试将包含 <code class=syntax>Values</code> 格式的 <code class=syntax>NULL</code> 元素的数组插入没有 <code class=syntax>Nullable</code> 的 <code class=syntax>Array</code> 类型的列时的错误(如果 <code class=syntax>input_format_values_interpret_expressions</code> = 1). <a href=https://github.com/ClickHouse/ClickHouse/pull/3487 rel="external nofollow noreferrer" target=_blank>#3487</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3503 rel="external nofollow noreferrer" target=_blank>#3503</a></li> <li>如果 ZooKeeper 不可用, 则修复了在 <code class=syntax>DDLWorker</code> 中连续错误记录的问题. <a href=https://github.com/ClickHouse/ClickHouse/commit/8f50c620334988b28018213ec0092fe6423847e2 rel="external nofollow noreferrer" target=_blank>8f50c620</a></li> <li>修复了来自 <code class=syntax>Date</code> 和 <code class=syntax>DateTime</code> 类型参数的 <code class=syntax>quantile*</code> 函数的返回类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/3580 rel="external nofollow noreferrer" target=_blank>#3580</a></li> <li>修复了 <code class=syntax>WITH</code> 子句 如果它指定一个没有表达式的简单别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/3570 rel="external nofollow noreferrer" target=_blank>#3570</a></li> <li>修复了启用 <code class=syntax>enable_optimize_predicate_expression</code> 时使用命名子查询和限定列名的查询的处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/3588 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>修复了使用物化视图时 <code class=syntax>尝试附加到 nullptr 线程组</code> 的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3623 rel="external nofollow noreferrer" target=_blank>Marek Vavruša</a></li> <li>修复了将某些不正确的参数传递给 <code class=syntax>arrayReverse</code> 函数时发生的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/commit/73e3a7b662161d6005e7727d8a711b930386b871 rel="external nofollow noreferrer" target=_blank>73e3a7b6</a></li> <li>修复了 <code class=syntax>extractURLParameter</code> 函数中的缓冲区溢出问题. 改进性能. 添加了对包含零字节的字符串的正确处理. <a href=https://github.com/ClickHouse/ClickHouse/commit/141e9799e49201d84ea8e951d1bed4fb6d3dacb5 rel="external nofollow noreferrer" target=_blank>141e9799</a></li> <li>修复了 <code class=syntax>lowerUTF8</code> 和 <code class=syntax>upperUTF8</code> 函数中的缓冲区溢出. 删除了通过 <code class=syntax>FixedString</code> 类型参数执行这些函数的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/3662 rel="external nofollow noreferrer" target=_blank>#3662</a></li> <li>修复了删除 <code class=syntax>MergeTree</code> 表时罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/3680 rel="external nofollow noreferrer" target=_blank>#3680</a></li> <li>修复了从 <code class=syntax>Buffer</code> 表读取并同时在目标表上执行 <code class=syntax>ALTER</code> 或 <code class=syntax>DROP</code> 时的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/3719 rel="external nofollow noreferrer" target=_blank>#3719</a></li> <li>修复了超出 <code class=syntax>max_temporary_non_const_columns</code> 限制时的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3788 rel="external nofollow noreferrer" target=_blank>#3788</a></li> </ul> <h4 id=improvements-1>改进:<a class=headerlink href=../amp/#improvements-1 title="Permanent link"> </a></h4> <ul> <li>服务器不会将处理后的配置文件写入<code class=syntax>/etc/clickhouse-server/</code>目录. 相反, 它将它们保存在 <code class=syntax>path</code> 内的 <code class=syntax>preprocessed_configs</code> 目录中. 这意味着 <code class=syntax>/etc/clickhouse-server/</code> 目录对 <code class=syntax>clickhouse</code> 用户没有写权限, 提高了安全性. <a href=https://github.com/ClickHouse/ClickHouse/pull/2443 rel="external nofollow noreferrer" target=_blank>#2443</a></li> <li><code class=syntax>min_merge_bytes_to_use_direct_io</code> 选项默认设置为 10 GiB. 形成 MergeTree 系列中大部分表的合并将在 <code class=syntax>O_DIRECT</code> 模式下执行，以防止过多的页面缓存逐出. <a href=https://github.com/ClickHouse/ClickHouse/pull/3504 rel="external nofollow noreferrer" target=_blank>#3504</a></li> <li>当表数量非常多时，加速服务器启动. <a href=https://github.com/ClickHouse/ClickHouse/pull/3398 rel="external nofollow noreferrer" target=_blank>#3398</a></li> <li>为副本之间的连接添加了连接池和 HTTP <code class=syntax>Keep-Alive</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3594 rel="external nofollow noreferrer" target=_blank>#3594</a></li> <li>如果查询语法无效, <code class=syntax>HTTP</code> 接口返回 <code class=syntax>400 Bad Request</code> 代码(之前返回500). <a href=https://github.com/ClickHouse/ClickHouse/commit/31bc680ac5f4bb1d0360a8ba4696fa84bb47d6ab rel="external nofollow noreferrer" target=_blank>31bc680a</a></li> <li><code class=syntax>join_default_strictness</code> 选项默认设置为 <code class=syntax>ALL</code> 以实现兼容性. <a href=https://github.com/ClickHouse/ClickHouse/commit/120e2cbe2ff4fbad626c28042d9b28781c805afe rel="external nofollow noreferrer" target=_blank>120e2cbe</a></li> <li>对于无效或复杂的正则表达式，从 <code class=syntax>re2</code> 库中删除了对 <code class=syntax>stderr</code> 的日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/3723 rel="external nofollow noreferrer" target=_blank>#3723</a></li> <li>为 <code class=syntax>Kafka</code> 表引擎添加: 在开始从 Kafka 读取之前检查订阅; 表的 kafka_max_block_size 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/3396 rel="external nofollow noreferrer" target=_blank>Marek Vavruša</a></li> <li><code class=syntax>cityHash64</code>、<code class=syntax>farmHash64</code>、<code class=syntax>metroHash64</code>、<code class=syntax>sipHash64</code>、<code class=syntax>halfMD5</code>、<code class=syntax>murmurHash2_32</code>、<code class=syntax>murmurHash2_64</code>、<code class=syntax>murmurHash3_32</code> 和<code class=syntax>murmurHash3_64</code> 函数现在可用于任意数量的参数和参数元组的形式. <a href=https://github.com/ClickHouse/ClickHouse/pull/3451 rel="external nofollow noreferrer" target=_blank>#3451</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3519 rel="external nofollow noreferrer" target=_blank>#3519</a></li> <li><code class=syntax>arrayReverse</code> 函数现在适用于任何类型的数组. <a href=https://github.com/ClickHouse/ClickHouse/commit/73e3a7b662161d6005e7727d8a711b930386b871 rel="external nofollow noreferrer" target=_blank>73e3a7b6</a></li> <li>添加了一个可选参数：<code class=syntax>timeSlots</code> 函数的插槽大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/3724 rel="external nofollow noreferrer" target=_blank>Kirill Shvakov</a></li> <li>对于 <code class=syntax>FULL</code> 和 <code class=syntax>RIGHT JOIN</code>，<code class=syntax>max_block_size</code> 设置用于来自右表的非连接数据流. <a href=https://github.com/ClickHouse/ClickHouse/pull/3699 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>在 <code class=syntax>clickhouse-benchmark</code> 和 <code class=syntax>clickhouse-performance-test</code> 中添加了 <code class=syntax>--secure</code> 命令行参数以启用 TLS. <a href=https://github.com/ClickHouse/ClickHouse/pull/3688 rel="external nofollow noreferrer" target=_blank>#3688</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3690 rel="external nofollow noreferrer" target=_blank>#3690</a></li> <li><code class=syntax>Buffer</code> 类型表的结构与目标表的结构不匹配时的类型转换. <a href=https://github.com/ClickHouse/ClickHouse/pull/3603 rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a></li> <li>添加了 <code class=syntax>tcp_keep_alive_timeout</code> 选项以在指定时间间隔内不活动后启用保持活动数据包. <a href=https://github.com/ClickHouse/ClickHouse/pull/3441 rel="external nofollow noreferrer" target=_blank>#3441</a></li> <li>如果<code class=syntax>system.parts</code> 表包含单列, 则删除了不必要的对分区键值的引用. <a href=https://github.com/ClickHouse/ClickHouse/pull/3652 rel="external nofollow noreferrer" target=_blank>#3652</a></li> <li>模函数适用于 <code class=syntax>Date</code> 和 <code class=syntax>DateTime</code> 数据类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/3385 rel="external nofollow noreferrer" target=_blank>#3385</a></li> <li>添加了<code class=syntax>POWER</code>、<code class=syntax>LN</code>、<code class=syntax>LCASE</code>、<code class=syntax>UCASE</code>、<code class=syntax>REPLACE</code>、<code class=syntax>LOCATE</code>、<code class=syntax>SUBSTR</code> 和<code class=syntax>MID</code> 函数的同义词. <a href=https://github.com/ClickHouse/ClickHouse/pull/3774 rel="external nofollow noreferrer" target=_blank>#3774</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3763 rel="external nofollow noreferrer" target=_blank>#3763</a> Some function names are case-insensitive for compatibility with the SQL standard. Added syntactic sugar <code class=syntax>SUBSTRING(expr FROM start FOR length)</code> for compatibility with SQL. <a href=https://github.com/ClickHouse/ClickHouse/pull/3804 rel="external nofollow noreferrer" target=_blank>#3804</a></li> <li>添加了对与 <code class=syntax>clickhouse-server</code> 可执行代码对应的 <code class=syntax>mlock</code> 内存页面的功能，以防止其被强制内存不足. 默认情况下禁用此功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/3553 rel="external nofollow noreferrer" target=_blank>#3553</a></li> <li>从<code class=syntax>O_DIRECT</code> 读取时提高了性能(启用了<code class=syntax>min_bytes_to_use_direct_io</code> 选项). <a href=https://github.com/ClickHouse/ClickHouse/pull/3405 rel="external nofollow noreferrer" target=_blank>#3405</a></li> <li>改进了用于常量键参数和非常量默认参数的 <code class=syntax>dictGet...OrDefault</code> 函数的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/3563 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li><code class=syntax>firstSignificantSubdomain</code> 函数现在可以处理域 <code class=syntax>gov</code>、<code class=syntax>mil</code> 和 <code class=syntax>edu</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3601 rel="external nofollow noreferrer" target=_blank>Igor Hatarist</a> Improved performance. <a href=https://github.com/ClickHouse/ClickHouse/pull/3628 rel="external nofollow noreferrer" target=_blank>#3628</a></li> <li>能够通过在 <code class=syntax>/etc/default/clickhouse</code> 中定义 <code class=syntax>CLICKHOUSE_PROGRAM_ENV</code> 使用 <code class=syntax>SYS-V init.d</code> 脚本来指定用于启动 <code class=syntax>clickhouse-server</code> 的自定义环境变量.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/3612 rel="external nofollow noreferrer" target=_blank>Pavlo Bashynskyi</a></li> <li>clickhouse-server 初始化脚本的正确返回码. <a href=https://github.com/ClickHouse/ClickHouse/pull/3516 rel="external nofollow noreferrer" target=_blank>#3516</a></li> <li><code class=syntax>system.metrics</code> 表现在有 <code class=syntax>VersionInteger</code> 指标, <code class=syntax>system.build_options</code> 添加了行 <code class=syntax>VERSION_INTEGER</code>, 其中包含 ClickHouse 版本的数字形式, 例如 <code class=syntax>18016000</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3644 rel="external nofollow noreferrer" target=_blank>#3644</a></li> <li>删除了将 <code class=syntax>Date</code> 类型与数字进行比较的功能，以避免诸如 <code class=syntax>date = 2018-12-17</code> 之类的潜在错误, 其中错误地省略了日期周围的引号. <a href=https://github.com/ClickHouse/ClickHouse/pull/3687 rel="external nofollow noreferrer" target=_blank>#3687</a></li> <li>修复了像 <code class=syntax>rowNumberInAllBlocks</code> 这样的有状态函数的行为。 由于在查询分析期间启动，他们以前输出的结果大一个数字. <a href=https://github.com/ClickHouse/ClickHouse/pull/3729 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>如果无法删除 <code class=syntax>force_restore_data</code> 文件, 则会显示错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/3794 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> </ul> <h4 id=build-improvements-1>Build 改进:<a class=headerlink href=../amp/#build-improvements-1 title="Permanent link"> </a></h4> <ul> <li>更新了 <code class=syntax>jemalloc</code> 库, 修复了潜在的内存泄漏. <a href=https://github.com/ClickHouse/ClickHouse/pull/3557 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>默认情况下启用使用 <code class=syntax>jemalloc</code> 进行分析以便调试构建. <a href=https://github.com/ClickHouse/ClickHouse/commit/2cc82f5cbe266421cd4c1165286c2c47e5ffcb15 rel="external nofollow noreferrer" target=_blank>2cc82f5c</a></li> <li>添加了仅在系统上安装了 <code class=syntax>Docker</code> 时运行集成测试的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/3650 rel="external nofollow noreferrer" target=_blank>#3650</a></li> <li>在 SELECT 查询中添加了模糊表达式测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/3442 rel="external nofollow noreferrer" target=_blank>#3442</a></li> <li>添加了针对提交的压力测试, 它以并行和随机顺序执行功能测试以检测更多竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/3438 rel="external nofollow noreferrer" target=_blank>#3438</a></li> <li>改进了在 Docker 镜像中启动 clickhouse-server 的方法. <a href=https://github.com/ClickHouse/ClickHouse/pull/3663 rel="external nofollow noreferrer" target=_blank>Elghazal Ahmed</a></li> <li>对于 Docker 映像, 添加了对使用 <code class=syntax>/docker-entrypoint-initdb.d</code> 目录中的文件初始化数据库的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/3695 rel="external nofollow noreferrer" target=_blank>Konstantin Lebedev</a></li> <li>修复了 ARM 上的构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/3709 rel="external nofollow noreferrer" target=_blank>#3709</a></li> </ul> <h4 id=backward-incompatible-changes>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes title="Permanent link"> </a></h4> <ul> <li>删除了将 <code class=syntax>Date</code> 类型与数字进行比较的能力. 而不是 <code class=syntax>toDate('2018-12-18') = 17883</code>, 你必须使用显式类型转换 <code class=syntax>= toDate(17883)</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3687 rel="external nofollow noreferrer" target=_blank>#3687</a></li> </ul> <h2 id=clickhouse-release-18-14>ClickHouse 版本 18.14<a class=headerlink href=../amp/#clickhouse-release-18-14 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-18-14-19-2018-12-19>ClickHouse 版本 18.14.19, 2018-12-19<a class=headerlink href=../amp/#clickhouse-release-18-14-19-2018-12-19 title="Permanent link"> </a></h3> <h4 id=bug-fixes-2>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-2 title="Permanent link"> </a></h4> <ul> <li>修复了导致使用 ODBC 源更新字典出现问题的错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/3825 rel="external nofollow noreferrer" target=_blank>#3825</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/3829 rel="external nofollow noreferrer" target=_blank>#3829</a></li> <li>执行 DDL <code class=syntax>ON CLUSTER</code> 查询时正确指定数据库. <a href=https://github.com/ClickHouse/ClickHouse/pull/3460 rel="external nofollow noreferrer" target=_blank>#3460</a></li> <li>修复了超出 <code class=syntax>max_temporary_non_const_columns</code> 限制时的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3788 rel="external nofollow noreferrer" target=_blank>#3788</a></li> </ul> <h4 id=build-improvements-2>Build 改进:<a class=headerlink href=../amp/#build-improvements-2 title="Permanent link"> </a></h4> <ul> <li>修复了 ARM 上的构建.</li> </ul> <h3 id=clickhouse-release-18-14-18-2018-12-04>ClickHouse 版本 18.14.18, 2018-12-04<a class=headerlink href=../amp/#clickhouse-release-18-14-18-2018-12-04 title="Permanent link"> </a></h3> <h4 id=bug-fixes-3>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-3 title="Permanent link"> </a></h4> <ul> <li>修复了 <code class=syntax>dictGet...</code> 函数对于 <code class=syntax>range</code> 类型的字典的错误，如果其中一个参数是常量而另一个不是. <a href=https://github.com/ClickHouse/ClickHouse/pull/3751 rel="external nofollow noreferrer" target=_blank>#3751</a></li> <li>修复了导致消息 <code class=syntax>netlink: '...': attribute type 1 has an invalid length</code> 打印在 Linux 内核日志中的错误, 这种错误只发生在足够新的 Linux 内核版本上. <a href=https://github.com/ClickHouse/ClickHouse/pull/3749 rel="external nofollow noreferrer" target=_blank>#3749</a></li> <li>修复了函数 <code class=syntax>empty</code> 中 <code class=syntax>FixedString</code> 类型参数的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3703 rel="external nofollow noreferrer" target=_blank>Daniel, Dao Quang Minh</a></li> <li>修复了在使用大值 <code class=syntax>max_query_size</code> 设置时过多的内存分配(一次性预分配了 <code class=syntax>max_query_size</code> 字节的内存块). <a href=https://github.com/ClickHouse/ClickHouse/pull/3720 rel="external nofollow noreferrer" target=_blank>#3720</a></li> </ul> <h4 id=build-changes>Build 更新:<a class=headerlink href=../amp/#build-changes title="Permanent link"> </a></h4> <ul> <li>使用 OS 包中版本 7 的 LLVM/Clang 库修复构建 (这些库用于运行时查询编译). <a href=https://github.com/ClickHouse/ClickHouse/pull/3582 rel="external nofollow noreferrer" target=_blank>#3582</a></li> </ul> <h3 id=clickhouse-release-18-14-17-2018-11-30>ClickHouse 版本 18.14.17, 2018-11-30<a class=headerlink href=../amp/#clickhouse-release-18-14-17-2018-11-30 title="Permanent link"> </a></h3> <h4 id=bug-fixes-4>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-4 title="Permanent link"> </a></h4> <ul> <li>修复了 ODBC 桥进程未随主服务器进程终止的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/3642 rel="external nofollow noreferrer" target=_blank>#3642</a></li> <li>修复了同步插入到<code class=syntax>Distributed</code> 表中的问题, 其中的列列表与远程表的列列表不同. <a href=https://github.com/ClickHouse/ClickHouse/pull/3673 rel="external nofollow noreferrer" target=_blank>#3673</a></li> <li>修复了在删除 MergeTree 表时可能导致崩溃的罕见竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/3643 rel="external nofollow noreferrer" target=_blank>#3643</a></li> <li>修复了查询线程创建失败并出现 <code class=syntax>资源暂时不可用</code> 错误时的查询死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/3643 rel="external nofollow noreferrer" target=_blank>#3643</a></li> <li>修复了当使用 <code class=syntax>CREATE AS table</code> 语法并且在 <code class=syntax>AS table</code> 之前指定 <code class=syntax>ENGINE</code> 子句时对 <code class=syntax>ENGINE</code> 子句的解析 (错误导致忽略指定的引擎). <a href=https://github.com/ClickHouse/ClickHouse/pull/3692 rel="external nofollow noreferrer" target=_blank>#3692</a></li> </ul> <h3 id=clickhouse-release-18-14-15-2018-11-21>ClickHouse 版本 18.14.15, 2018-11-21<a class=headerlink href=../amp/#clickhouse-release-18-14-15-2018-11-21 title="Permanent link"> </a></h3> <h4 id=bug-fixes-5>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-5 title="Permanent link"> </a></h4> <ul> <li>反序列化 <code class=syntax>Array(String)</code> 类型的列时高估了内存块的大小, 导致 <code class=syntax>Memory limit exceeded</code> 错误. 该问题出现在版本 18.12.13. <a href=https://github.com/ClickHouse/ClickHouse/issues/3589 rel="external nofollow noreferrer" target=_blank>#3589</a></li> </ul> <h3 id=clickhouse-release-18-14-14-2018-11-20>ClickHouse 版本 18.14.14, 2018-11-20<a class=headerlink href=../amp/#clickhouse-release-18-14-14-2018-11-20 title="Permanent link"> </a></h3> <h4 id=bug-fixes-6>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-6 title="Permanent link"> </a></h4> <ul> <li>修复了集群配置为安全时的 <code class=syntax>ON CLUSTER</code> 查询 (标志 <code class=syntax>&lt;secure&gt;</code> ). <a href=https://github.com/ClickHouse/ClickHouse/pull/3599 rel="external nofollow noreferrer" target=_blank>#3599</a></li> </ul> <h4 id=build-changes-1>Build Changes:<a class=headerlink href=../amp/#build-changes-1 title="Permanent link"> </a></h4> <ul> <li>修复的问题(来自系统的 llvm-7, macos). <a href=https://github.com/ClickHouse/ClickHouse/pull/3582 rel="external nofollow noreferrer" target=_blank>#3582</a></li> </ul> <h3 id=clickhouse-release-18-14-13-2018-11-08>ClickHouse 版本 18.14.13, 2018-11-08<a class=headerlink href=../amp/#clickhouse-release-18-14-13-2018-11-08 title="Permanent link"> </a></h3> <h4 id=bug-fixes-7>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-7 title="Permanent link"> </a></h4> <ul> <li>修复了 <code class=syntax>MergingSorted 流中的块结构不匹配</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/3162 rel="external nofollow noreferrer" target=_blank>#3162</a></li> <li>修复了 <code class=syntax>ON CLUSTER</code> 查询, 以防在集群配置中打开安全连接 (<code class=syntax>&lt;secure&gt;</code> 标志). <a href=https://github.com/ClickHouse/ClickHouse/pull/3465 rel="external nofollow noreferrer" target=_blank>#3465</a></li> <li>修复了使用 <code class=syntax>SAMPLE</code>、<code class=syntax>PREWHERE</code> 和 alias 列的查询中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3543 rel="external nofollow noreferrer" target=_blank>#3543</a></li> <li>修复了启用 <code class=syntax>min_bytes_to_use_direct_io</code> 设置时罕见的 <code class=syntax>unknown compression method</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3544 rel="external nofollow noreferrer" target=_blank>3544</a></li> </ul> <h4 id=performance-improvements>性能改进:<a class=headerlink href=../amp/#performance-improvements title="Permanent link"> </a></h4> <ul> <li>修复了在 AMD EPYC 处理器上执行时使用 UInt16 或 Date 类型列的 <code class=syntax>GROUP BY</code> 查询的性能回归. <a href=https://github.com/ClickHouse/ClickHouse/pull/3512 rel="external nofollow noreferrer" target=_blank>Igor Lapko</a></li> <li>修复了处理长字符串的查询的性能回归. <a href=https://github.com/ClickHouse/ClickHouse/pull/3530 rel="external nofollow noreferrer" target=_blank>#3530</a></li> </ul> <h4 id=build-improvements-3>Build 改进:<a class=headerlink href=../amp/#build-improvements-3 title="Permanent link"> </a></h4> <ul> <li>简化 Arcadia 构建的改进. <a href=https://github.com/ClickHouse/ClickHouse/pull/3475 rel="external nofollow noreferrer" target=_blank>#3475</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/3535 rel="external nofollow noreferrer" target=_blank>#3535</a></li> </ul> <h3 id=clickhouse-release-18-14-12-2018-11-02>ClickHouse 版本 18.14.12, 2018-11-02<a class=headerlink href=../amp/#clickhouse-release-18-14-12-2018-11-02 title="Permanent link"> </a></h3> <h4 id=bug-fixes-8>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-8 title="Permanent link"> </a></h4> <ul> <li>修复了加入两个未命名子查询时崩溃的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/3505 rel="external nofollow noreferrer" target=_blank>#3505</a></li> <li>修复了在查询外部数据库时生成不正确的查询 (带有空的 <code class=syntax>WHERE</code> 子句). <a href=https://github.com/ClickHouse/ClickHouse/pull/3477 rel="external nofollow noreferrer" target=_blank>hotid</a></li> <li>修复了在 ODBC 字典中使用错误超时值的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/3511 rel="external nofollow noreferrer" target=_blank>Marek Vavruša</a></li> </ul> <h3 id=clickhouse-release-18-14-11-2018-10-29>ClickHouse 版本 18.14.11, 2018-10-29<a class=headerlink href=../amp/#clickhouse-release-18-14-11-2018-10-29 title="Permanent link"> </a></h3> <h4 id=bug-fixes-9>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-9 title="Permanent link"> </a></h4> <ul> <li>修复了错误 <code class=syntax>Block structure mismatch in UNION stream: different number of columns</code>. <a href=https://github.com/ClickHouse/ClickHouse/issues/2156 rel="external nofollow noreferrer" target=_blank>#2156</a></li> <li>修复了在包含嵌套结构内的数组的表中合并数据时出现的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3397 rel="external nofollow noreferrer" target=_blank>#3397</a></li> <li>修复了如果禁用 <code class=syntax>merge_tree_uniform_read_distribution</code> 设置 (默认启用) 时查询结果不正确的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/3429 rel="external nofollow noreferrer" target=_blank>#3429</a></li> <li>修复了以本机格式插入分布式表的错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/3411 rel="external nofollow noreferrer" target=_blank>#3411</a></li> </ul> <h3 id=clickhouse-release-18-14-10-2018-10-23>ClickHouse 版本 18.14.10, 2018-10-23<a class=headerlink href=../amp/#clickhouse-release-18-14-10-2018-10-23 title="Permanent link"> </a></h3> <ul> <li><code class=syntax>compile_expressions</code> 设置 (表达式的 JIT 编译) 默认是禁用的. <a href=https://github.com/ClickHouse/ClickHouse/pull/3410 rel="external nofollow noreferrer" target=_blank>#3410</a></li> <li><code class=syntax>enable_optimize_predicate_expression</code> 设置默认是禁用的.</li> </ul> <h3 id=clickhouse-release-18-14-9-2018-10-16>ClickHouse 版本 18.14.9, 2018-10-16<a class=headerlink href=../amp/#clickhouse-release-18-14-9-2018-10-16 title="Permanent link"> </a></h3> <h4 id=new-features-1>新特征:<a class=headerlink href=../amp/#new-features-1 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>GROUP BY</code> 的 <code class=syntax>WITH CUBE</code> 修饰符 (也可以使用替代语法 <code class=syntax>GROUP BY CUBE(...)</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/3172 rel="external nofollow noreferrer" target=_blank>#3172</a></li> <li>添加了 <code class=syntax>formatDateTime</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/2770 rel="external nofollow noreferrer" target=_blank>Alexandr Krasheninnikov</a></li> <li>增加了<code class=syntax>JDBC</code>表引擎和<code class=syntax>jdbc</code>表功能 (需要安装clickhouse-jdbc-bridge) . <a href=https://github.com/ClickHouse/ClickHouse/pull/3210 rel="external nofollow noreferrer" target=_blank>Alexandr Krasheninnikov</a></li> <li>添加了用于处理 ISO 周数的函数：<code class=syntax>toISOWeek</code>、<code class=syntax>toISOYear</code>、<code class=syntax>toStartOfISOYear</code> 和 <code class=syntax>toDayOfYear</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3146 rel="external nofollow noreferrer" target=_blank>#3146</a></li> <li>现在您可以为 <code class=syntax>MySQL</code> 和 <code class=syntax>ODBC</code> 表使用 <code class=syntax>Nullable</code> 列. <a href=https://github.com/ClickHouse/ClickHouse/pull/3362 rel="external nofollow noreferrer" target=_blank>#3362</a></li> <li>嵌套数据结构可以作为 <code class=syntax>JSONEachRow</code> 格式的嵌套对象读取. 添加了 <code class=syntax>input_format_import_nested_json</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/3144 rel="external nofollow noreferrer" target=_blank>Veloman Yunkan</a></li> <li>插入数据时，许多<code class=syntax>MATERIALIZED VIEW</code> 都可以进行并行处理. 请参阅<code class=syntax>parallel_view_processing</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/3208 rel="external nofollow noreferrer" target=_blank>Marek Vavruša</a></li> <li>添加了 <code class=syntax>SYSTEM FLUSH LOGS</code> 查询 (强制日志刷新到系统表，例如 <code class=syntax>query_log</code>) <a href=https://github.com/ClickHouse/ClickHouse/pull/3321 rel="external nofollow noreferrer" target=_blank>#3321</a></li> <li>现在你可以在声明 <code class=syntax>Replicated</code> 表时使用预定义的 <code class=syntax>database</code> 和 <code class=syntax>table</code> 宏. <a href=https://github.com/ClickHouse/ClickHouse/pull/3251 rel="external nofollow noreferrer" target=_blank>#3251</a></li> <li>添加了以工程符号 (表示十的幂) 读取 <code class=syntax>Decimal</code> 类型值的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/3153 rel="external nofollow noreferrer" target=_blank>#3153</a></li> </ul> <h4 id=experimental-features>实验特征:<a class=headerlink href=../amp/#experimental-features title="Permanent link"> </a></h4> <ul> <li><code class=syntax>LowCardinality</code> 数据类型的 GROUP BY 子句优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/3138 rel="external nofollow noreferrer" target=_blank>#3138</a></li> <li><code class=syntax>LowCardinality</code> 数据类型表达式的优化计算. <a href=https://github.com/ClickHouse/ClickHouse/pull/3200 rel="external nofollow noreferrer" target=_blank>#3200</a></li> </ul> <h4 id=improvements-2>改进:<a class=headerlink href=../amp/#improvements-2 title="Permanent link"> </a></h4> <ul> <li>使用 <code class=syntax>ORDER BY</code> 和 <code class=syntax>LIMIT</code> 显着减少了查询的内存消耗. 查看 <code class=syntax>max_bytes_before_remerge_sort</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/3205 rel="external nofollow noreferrer" target=_blank>#3205</a></li> <li>如果没有<code class=syntax>JOIN</code> (<code class=syntax>LEFT</code>，<code class=syntax>INNER</code>，...), 则假定<code class=syntax>INNER JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3147 rel="external nofollow noreferrer" target=_blank>#3147</a></li> <li>合格的星号在使用 <code class=syntax>JOIN</code> 的查询中正常工作. <a href=https://github.com/ClickHouse/ClickHouse/pull/3202 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li><code class=syntax>ODBC</code> 表引擎正确选择引用远程数据库的 SQL 方言中的标识符的方法. <a href=https://github.com/ClickHouse/ClickHouse/pull/3210 rel="external nofollow noreferrer" target=_blank>Alexandr Krasheninnikov</a></li> <li><code class=syntax>compile_expressions</code> 设置 (表达式的 JIT 编译) 默认启用.</li> <li>修复了同时 DROP DATABASE/TABLE IF EXISTS 和 CREATE DATABASE/TABLE IF NOT EXISTS 的行为. 以前, <code class=syntax>CREATE DATABASE ... IF NOT EXISTS</code> 查询可能会返回错误消息"File ... already exists", 而<code class=syntax>CREATE TABLE ... IF NOT EXISTS</code> 和 <code class=syntax>DROP TABLE IF EXISTS</code> 查询可能会返回 <code class=syntax>Table ...现在正在创建或附加</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3101 rel="external nofollow noreferrer" target=_blank>#3101</a></li> <li>当从 MySQL 或 ODBC 表查询时, 带有常量右半部分的 LIKE 和 IN 表达式被传递到远程服务器. <a href=https://github.com/ClickHouse/ClickHouse/pull/3182 rel="external nofollow noreferrer" target=_blank>#3182</a></li> <li>从 MySQL 和 ODBC 表查询时, 与 WHERE 子句中的常量表达式的比较将传递到远程服务器. 以前，只通过与常量的比较. <a href=https://github.com/ClickHouse/ClickHouse/pull/3182 rel="external nofollow noreferrer" target=_blank>#3182</a></li> <li>正确计算终端中 <code class=syntax>Pretty</code> 格式的行宽，包括带有象形文字的字符串. <a href=https://github.com/ClickHouse/ClickHouse/pull/3257 rel="external nofollow noreferrer" target=_blank>Amos Bird</a>.</li> <li>可以为 <code class=syntax>ALTER UPDATE</code> 查询指定 <code class=syntax>ON CLUSTER</code>.</li> <li>提高了读取 <code class=syntax>JSONEachRow</code> 格式数据的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/3332 rel="external nofollow noreferrer" target=_blank>#3332</a></li> <li>为兼容性添加了<code class=syntax>LENGTH</code> 和<code class=syntax>CHARACTER_LENGTH</code> 函数的同义词. <code class=syntax>CONCAT</code> 函数不再区分大小写. <a href=https://github.com/ClickHouse/ClickHouse/pull/3306 rel="external nofollow noreferrer" target=_blank>#3306</a></li> <li>添加了<code class=syntax>DateTime</code> 类型的<code class=syntax>TIMESTAMP</code> 同义词. <a href=https://github.com/ClickHouse/ClickHouse/pull/3390 rel="external nofollow noreferrer" target=_blank>#3390</a></li> <li>服务器日志中始终为 query_id 保留空间, 即使日志行与查询无关. 这使得使用第三方工具解析服务器文本日志变得更容易.</li> <li>当查询超过整数 GB 的下一个级别时, 会记录查询的内存消耗. <a href=https://github.com/ClickHouse/ClickHouse/pull/3205 rel="external nofollow noreferrer" target=_blank>#3205</a></li> <li>为使用 Native 协议的客户端库错误发送的列数少于服务器预期的 INSERT 查询的情况添加了兼容模式. 这种情况在使用 clickhouse-cpp 库时是可能的. 之前这种场景导致服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/3171 rel="external nofollow noreferrer" target=_blank>#3171</a></li> <li>在<code class=syntax>clickhouse-copier</code> 中用户定义的WHERE 表达式中, 您现在可以使用<code class=syntax>partition_key</code> 别名(用于按源表分区进行额外过滤). 如果分区方案在复制过程中发生变化, 但只是轻微变化, 这将很有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/3166 rel="external nofollow noreferrer" target=_blank>#3166</a></li> <li><code class=syntax>Kafka</code> 引擎的工作流已移至后台线程池, 以便在高负载时自动降低数据读取速度. <a href=https://github.com/ClickHouse/ClickHouse/pull/3215 rel="external nofollow noreferrer" target=_blank>Marek Vavruša</a>.</li> <li>支持以 <code class=syntax>Cap'n'Proto format</code> 读取结构的 <code class=syntax>Tuple</code> 和 <code class=syntax>Nested</code> 值，例如 <code class=syntax>struct</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3216 rel="external nofollow noreferrer" target=_blank>Marek Vavruša</a></li> <li><code class=syntax>firstSignificantSubdomain</code> 函数的顶级域列表现在包括域 <code class=syntax>biz</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3219 rel="external nofollow noreferrer" target=_blank>decaseal</a></li> <li>在外部字典的配置中, <code class=syntax>null_value</code> 被解释为默认数据类型的值. <a href=https://github.com/ClickHouse/ClickHouse/pull/3330 rel="external nofollow noreferrer" target=_blank>#3330</a></li> <li>支持 <code class=syntax>Decimal</code> 的 <code class=syntax>intDiv</code> 和 <code class=syntax>intDivOrZero</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/commit/b48402e8712e2b9b151e0eef8193811d433a1264 rel="external nofollow noreferrer" target=_blank>b48402e8</a></li> <li>支持<code class=syntax>Date</code>、<code class=syntax>DateTime</code>、<code class=syntax>UUID</code>和 <code class=syntax>Decimal</code>类型作为<code class=syntax>sumMap</code>聚合函数的键. <a href=https://github.com/ClickHouse/ClickHouse/pull/3281 rel="external nofollow noreferrer" target=_blank>#3281</a></li> <li>支持外部字典中的 <code class=syntax>Decimal</code> 数据类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/3324 rel="external nofollow noreferrer" target=_blank>#3324</a></li> <li>支持 <code class=syntax>SummingMergeTree</code> 表中的 <code class=syntax>Decimal</code> 数据类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/3348 rel="external nofollow noreferrer" target=_blank>#3348</a></li> <li>在 <code class=syntax>if</code> 中添加了针对 <code class=syntax>UUID</code> 的专业化. <a href=https://github.com/ClickHouse/ClickHouse/pull/3366 rel="external nofollow noreferrer" target=_blank>#3366</a></li> <li>从 <code class=syntax>MergeTree 表</code> 读取时减少了 <code class=syntax>open</code> 和 <code class=syntax>close</code> 系统调用的数量. <a href=https://github.com/ClickHouse/ClickHouse/pull/3283 rel="external nofollow noreferrer" target=_blank>#3283</a></li> <li><code class=syntax>TRUNCATE TABLE</code> 查询可以在任何副本上执行 (查询被传递给领导副本). <a href=https://github.com/ClickHouse/ClickHouse/pull/3375 rel="external nofollow noreferrer" target=_blank>Kirill Shvakov</a></li> </ul> <h4 id=bug-fixes-10>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-10 title="Permanent link"> </a></h4> <ul> <li>修复了<code class=syntax>range_hashed</code> 词典的<code class=syntax>Dictionary</code> 表问题。 此错误发生在 18.12.17 版本中. <a href=https://github.com/ClickHouse/ClickHouse/pull/1702 rel="external nofollow noreferrer" target=_blank>#1702</a></li> <li>修复了加载<code class=syntax>range_hashed</code> 字典时的错误 (消息<code class=syntax>Unsupported type Nullable (...)</code>). 此错误发生在 18.12.17 版本中. <a href=https://github.com/ClickHouse/ClickHouse/pull/3362 rel="external nofollow noreferrer" target=_blank>#3362</a></li> <li>修复了<code class=syntax>pointInPolygon</code>函数中由于大量顶点彼此靠近的多边形计算不准确而导致的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3331 rel="external nofollow noreferrer" target=_blank>#3331</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3341 rel="external nofollow noreferrer" target=_blank>#3341</a></li> <li>如果合并数据部分后, 结果部分的校验和与另一个副本中相同合并的结果不同, 则删除合并的结果并从另一个副本下载数据部分(这是正确的行为). 但是下载数据部分后, 由于该部分已经存在的错误, 无法将其添加到工作集中(因为数据部分在合并后有一些延迟被删除). 这导致循环尝试下载相同的数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/3194 rel="external nofollow noreferrer" target=_blank>#3194</a></li> <li>修复了查询总内存消耗的错误计算 (由于计算错误，<code class=syntax>max_memory_usage_for_all_queries</code> 设置工作不正确，<code class=syntax>MemoryTracking</code> 指标的值不正确). 此错误发生在 18.12.13 版本中. <a href=https://github.com/ClickHouse/ClickHouse/pull/3344 rel="external nofollow noreferrer" target=_blank>Marek Vavruša</a></li> <li>修复了 <code class=syntax>CREATE TABLE ... ON CLUSTER ... AS SELECT ...</code> 的功能.此错误发生在 18.12.13 版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/3247 rel="external nofollow noreferrer" target=_blank>#3247</a></li> <li>修复了如果 <code class=syntax>JOIN</code> 仅在远程服务器上执行, 则在启动查询的服务器上为 <code class=syntax>JOIN</code> 准备不必要的数据结构. <a href=https://github.com/ClickHouse/ClickHouse/pull/3340 rel="external nofollow noreferrer" target=_blank>#3340</a></li> <li>修复了 <code class=syntax>Kafka</code> 引擎中的错误：开始读取数据时出现异常后死锁, 完成后锁定. <a href=https://github.com/ClickHouse/ClickHouse/pull/3215 rel="external nofollow noreferrer" target=_blank>Marek Vavruša</a>.</li> <li>对于 <code class=syntax>Kafka</code> 表, 未传递可选的 <code class=syntax>schema</code> 参数 (<code class=syntax>Cap'n'Proto</code> 格式的模式). <a href=https://github.com/ClickHouse/ClickHouse/pull/3150 rel="external nofollow noreferrer" target=_blank>Vojtech Splichal</a></li> <li>如果 ZooKeeper 服务器的集合具有接受连接但随后立即关闭它而不是响应握手的服务器, 则 ClickHouse 选择连接另一台服务器. 以前, 这会产生错误 <code class=syntax>无法读取所有数据. 读取的字节数：0.预期的字节数：4</code>. 并且服务器无法启动. <a href=https://github.com/ClickHouse/ClickHouse/commit/8218cf3a5f39a43401953769d6d12a0bb8d29da9 rel="external nofollow noreferrer" target=_blank>8218cf3a</a></li> <li>如果 ZooKeeper 服务器的集合包含 DNS 查询返回错误的服务器, 这些服务器将被忽略. <a href=https://github.com/ClickHouse/ClickHouse/commit/17b8e209221061325ad7ba0539f03c6e65f87f29 rel="external nofollow noreferrer" target=_blank>17b8e209</a></li> <li><code class=syntax>VALUES</code> 格式插入数据时, 修复了 <code class=syntax>Date</code> 和 <code class=syntax>DateTime</code> 之间的类型转换 (如果 <code class=syntax>input_format_values_interpret_expressions = 1</code>). 之前在Unix Epoch时间的天数数值和Unix时间戳之间进行了转换, 导致了意想不到的结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/3229 rel="external nofollow noreferrer" target=_blank>#3229</a></li> <li>更正了 <code class=syntax>Decimal</code> 和整数之间的类型转换. <a href=https://github.com/ClickHouse/ClickHouse/pull/3211 rel="external nofollow noreferrer" target=_blank>#3211</a></li> <li>修复了 <code class=syntax>enable_optimize_predicate_expression</code> 设置中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3231 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>修复了 CSV 格式的浮点数解析错误, 如果使用非默认的 CSV 分隔符, 例如 <code class=syntax>;</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3155 rel="external nofollow noreferrer" target=_blank>#3155</a></li> <li>修复了 <code class=syntax>arrayCumSumNonNegative</code> 函数 (如果累加器小于零，它不会累加负值). <a href=https://github.com/ClickHouse/ClickHouse/pull/3163 rel="external nofollow noreferrer" target=_blank>Aleksey Studnev</a></li> <li>修复了使用 <code class=syntax>PREWHERE</code> 时 <code class=syntax>Merge</code> 表如何在 <code class=syntax>Distributed</code> 表之上工作. <a href=https://github.com/ClickHouse/ClickHouse/pull/3165 rel="external nofollow noreferrer" target=_blank>#3165</a></li> <li>ALTER UPDATE` 查询中的错误修复.</li> <li>修复了 18.12 版本中出现的 <code class=syntax>odbc</code> 表函数中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3197 rel="external nofollow noreferrer" target=_blank>#3197</a></li> <li>修复了使用 <code class=syntax>StateArray</code> 组合器的聚合函数的操作. <a href=https://github.com/ClickHouse/ClickHouse/pull/3188 rel="external nofollow noreferrer" target=_blank>#3188</a></li> <li>修复了将 <code class=syntax>Decimal</code> 值除以零时的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/commit/69dd6609193beb4e7acd3e6ad216eca0ccfb8179 rel="external nofollow noreferrer" target=_blank>69dd6609</a></li> <li>修复了使用 <code class=syntax>Decimal</code> 和整数参数的操作类型的输出. <a href=https://github.com/ClickHouse/ClickHouse/pull/3224 rel="external nofollow noreferrer" target=_blank>#3224</a></li> <li>修复了在 <code class=syntax>Decimal128</code> 上的 <code class=syntax>GROUP BY</code> 期间的段错误. <a href=https://github.com/ClickHouse/ClickHouse/commit/3359ba06c39fcd05bfdb87d6c64154819621e13a rel="external nofollow noreferrer" target=_blank>3359ba06</a></li> <li><code class=syntax>log_query_threads</code> 设置 (关于查询执行的每个线程的日志信息) 现在只有在 <code class=syntax>log_queries</code> 选项 (关于查询的日志信息) 设置为 1 时才生效. 由于<code class=syntax>log_query_threads</code> 选项默认启用, 即使查询日志被禁用, 有关线程的信息也会被记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/3241 rel="external nofollow noreferrer" target=_blank>#3241</a></li> <li>修复了分位数聚合函数分布式操作的错误 (错误信息<code class=syntax>Not found column quantile...</code>). <a href=https://github.com/ClickHouse/ClickHouse/commit/292a885533b8e3b41ce8993867069d14cbd5a664 rel="external nofollow noreferrer" target=_blank>292a8855</a></li> <li>修复了同时在 18.12.17 版本服务器和旧服务器的集群上工作时的兼容性问题. 对于具有固定长度和非固定长度的 GROUP BY 键的分布式查询, 如果有大量数据要聚合, 则返回的数据并不总是完全聚合 (两个不同的行包含相同的聚合键). <a href=https://github.com/ClickHouse/ClickHouse/pull/3254 rel="external nofollow noreferrer" target=_blank>#3254</a></li> <li>如果查询仅包含测试中声明的部分替换，则修复了对 <code class=syntax>clickhouse-performance-test</code> 中替换的处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/3263 rel="external nofollow noreferrer" target=_blank>#3263</a></li> <li>修复了将 <code class=syntax>FINAL</code> 与 <code class=syntax>PREWHERE</code> 结合使用时的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3298 rel="external nofollow noreferrer" target=_blank>#3298</a></li> <li>修复了在 <code class=syntax>ALTER</code> 期间添加的列上使用 <code class=syntax>PREWHERE</code> 时的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3298 rel="external nofollow noreferrer" target=_blank>#3298</a></li> <li>添加了对<code class=syntax>DEFAULT</code> 和<code class=syntax>MATERIALIZED</code> 表达式是否缺少<code class=syntax>arrayJoin</code> 的检查. 以前, <code class=syntax>arrayJoin</code> 在插入数据时会导致错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3337 rel="external nofollow noreferrer" target=_blank>#3337</a></li> <li>在<code class=syntax>PREWHERE</code> 子句中添加了对缺少<code class=syntax>arrayJoin</code> 的检查. 以前, 这会导致在执行查询时出现诸如 <code class=syntax>Size ...不匹配</code> 或 <code class=syntax>未知压缩方法</code> 之类的消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/3357 rel="external nofollow noreferrer" target=_blank>#3357</a></li> <li>修复了在用相应的 IN 表达式替换来自相等评估的 AND 链的优化后在极少数情况下可能发生的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3339 rel="external nofollow noreferrer" target=_blank>liuyimin-bytedance</a></li> <li>对<code class=syntax>clickhouse-benchmark</code> 的小修正: 以前, 客户端信息没有发送到服务器; 现在在关闭和限制迭代次数时更准确地计算执行的查询数. <a href=https://github.com/ClickHouse/ClickHouse/pull/3351 rel="external nofollow noreferrer" target=_blank>#3351</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3352 rel="external nofollow noreferrer" target=_blank>#3352</a></li> </ul> <h4 id=backward-incompatible-changes-1>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-1 title="Permanent link"> </a></h4> <ul> <li>删除了 <code class=syntax>allow_experimental_decimal_type</code> 选项. <code class=syntax>Decimal</code> 数据类型可用于默认使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/3329 rel="external nofollow noreferrer" target=_blank>#3329</a></li> </ul> <h2 id=clickhouse-release-18-12>ClickHouse 版本 18.12<a class=headerlink href=../amp/#clickhouse-release-18-12 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-18-12-17-2018-09-16>ClickHouse 版本 18.12.17, 2018-09-16<a class=headerlink href=../amp/#clickhouse-release-18-12-17-2018-09-16 title="Permanent link"> </a></h3> <h4 id=new-features-2>新特征:<a class=headerlink href=../amp/#new-features-2 title="Permanent link"> </a></h4> <ul> <li>为 <code class=syntax>clickhouse</code> 源实现了 <code class=syntax>invalidate_query</code> (指定查询以检查是否需要更新外部字典的能力). <a href=https://github.com/ClickHouse/ClickHouse/pull/3126 rel="external nofollow noreferrer" target=_blank>#3126</a></li> <li>添加了使用<code class=syntax>UInt*</code>、<code class=syntax>Int*</code> 和<code class=syntax>DateTime</code> 数据类型 (连同<code class=syntax>Date</code> 类型) 作为定义范围边界的<code class=syntax>range_hashed</code> 外部字典键的功能. 现在可以使用 <code class=syntax>NULL</code> 来指定一个开放范围. <a href=https://github.com/ClickHouse/ClickHouse/pull/3123 rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a></li> <li><code class=syntax>Decimal</code> 类型现在支持 <code class=syntax>var*</code> 和 <code class=syntax>stddev*</code> 聚合函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/3129 rel="external nofollow noreferrer" target=_blank>#3129</a></li> <li><code class=syntax>Decimal</code> 类型现在支持数学函数(<code class=syntax>exp</code>、<code class=syntax>sin</code> 等). <a href=https://github.com/ClickHouse/ClickHouse/pull/3129 rel="external nofollow noreferrer" target=_blank>#3129</a></li> <li><code class=syntax>system.part_log</code> 表现在有 <code class=syntax>partition_id</code> 列. <a href=https://github.com/ClickHouse/ClickHouse/pull/3089 rel="external nofollow noreferrer" target=_blank>#3089</a></li> </ul> <h4 id=bug-fixes-11>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-11 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>Merge</code> 现在可以在 <code class=syntax>Distributed</code> 表上正常工作. <a href=https://github.com/ClickHouse/ClickHouse/pull/3159 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>修复了导致无法在 <code class=syntax>Ubuntu Precise</code> 和旧版本上运行 ClickHouse 的不兼容性 (对 <code class=syntax>glibc</code> 版本的不必要依赖). 18.12.13 版本出现不兼容. <a href=https://github.com/ClickHouse/ClickHouse/pull/3130 rel="external nofollow noreferrer" target=_blank>#3130</a></li> <li>修复了 <code class=syntax>enable_optimize_predicate_expression</code> 设置中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3107 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>修复了在 18.12.13 之前的版本上使用副本集群并同时在具有较新版本的服务器上创建表的新副本时出现的向后兼容性小问题 (显示在消息 <code class=syntax>无法克隆副本, 因为......更新为新的 ClickHouse 版本</code>, 这是合乎逻辑的, 但不应该发生). <a href=https://github.com/ClickHouse/ClickHouse/pull/3122 rel="external nofollow noreferrer" target=_blank>#3122</a></li> </ul> <h4 id=backward-incompatible-changes-2>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-2 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>enable_optimize_predicate_expression</code> 选项默认启用 (相当乐观). 如果出现与搜索列名相关的查询分析错误, 请将 <code class=syntax>enable_optimize_predicate_expression</code> 设置为0. <a href=https://github.com/ClickHouse/ClickHouse/pull/3107 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> </ul> <h3 id=clickhouse-release-18-12-14-2018-09-13>ClickHouse 版本 18.12.14, 2018-09-13<a class=headerlink href=../amp/#clickhouse-release-18-12-14-2018-09-13 title="Permanent link"> </a></h3> <h4 id=new-features-3>新特征:<a class=headerlink href=../amp/#new-features-3 title="Permanent link"> </a></h4> <ul> <li>添加了对 <code class=syntax>ALTER UPDATE</code> 查询的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/3035 rel="external nofollow noreferrer" target=_blank>#3035</a></li> <li>添加了 <code class=syntax>allow_ddl</code> 选项, 用于限制用户对 DDL 查询的访问. <a href=https://github.com/ClickHouse/ClickHouse/pull/3104 rel="external nofollow noreferrer" target=_blank>#3104</a></li> <li>为<code class=syntax>MergeTree</code>引擎添加了<code class=syntax>min_merge_bytes_to_use_direct_io</code>选项，它允许您设置合并总大小的阈值（当超过阈值时，数据部分文件将使用O_DIRECT处理). <a href=https://github.com/ClickHouse/ClickHouse/pull/3117 rel="external nofollow noreferrer" target=_blank>#3117</a></li> <li><code class=syntax>system.merges</code> 系统表现在包含 <code class=syntax>partition_id</code> 列. <a href=https://github.com/ClickHouse/ClickHouse/pull/3099 rel="external nofollow noreferrer" target=_blank>#3099</a></li> </ul> <h4 id=improvements-3>改进<a class=headerlink href=../amp/#improvements-3 title="Permanent link"> </a></h4> <ul> <li>如果数据部分在变异期间保持不变，则副本不会下载它. <a href=https://github.com/ClickHouse/ClickHouse/pull/3103 rel="external nofollow noreferrer" target=_blank>#3103</a></li> <li>使用 <code class=syntax>clickhouse-client</code> 时，设置名称可自动完成. <a href=https://github.com/ClickHouse/ClickHouse/pull/3106 rel="external nofollow noreferrer" target=_blank>#3106</a></li> </ul> <h4 id=bug-fixes-12>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-12 title="Permanent link"> </a></h4> <ul> <li>添加了对插入时作为<code class=syntax>Nested</code> 类型字段元素的数组大小的检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/3118 rel="external nofollow noreferrer" target=_blank>#3118</a></li> <li>修复了使用 <code class=syntax>ODBC</code> 源和 <code class=syntax>hashed</code> 存储更新外部词典的错误. 此错误发生在 18.12.13 版本中.</li> <li>修复了从具有 <code class=syntax>IN</code> 条件的查询创建临时表时崩溃的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/3098 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>修复了可以包含 <code class=syntax>NULL</code> 元素的数组的聚合函数中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3097 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> </ul> <h3 id=clickhouse-release-18-12-13-2018-09-10>ClickHouse 版本 18.12.13, 2018-09-10<a class=headerlink href=../amp/#clickhouse-release-18-12-13-2018-09-10 title="Permanent link"> </a></h3> <h4 id=new-features-4>新特征:<a class=headerlink href=../amp/#new-features-4 title="Permanent link"> </a></h4> <ul> <li>添加了<code class=syntax>DECIMAL(digits, scale)</code>数据类型(<code class=syntax>Decimal32(scale)</code>、<code class=syntax>Decimal64(scale)</code>、<code class=syntax>Decimal128(scale)</code>). 要启用它, 请使用设置 <code class=syntax>allow_experimental_decimal_type</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/2846 rel="external nofollow noreferrer" target=_blank>#2846</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2970 rel="external nofollow noreferrer" target=_blank>#2970</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3008 rel="external nofollow noreferrer" target=_blank>#3008</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3047 rel="external nofollow noreferrer" target=_blank>#3047</a></li> <li>用于<code class=syntax>GROUP BY</code> 的新<code class=syntax>WITH ROLLUP</code> 修饰符 (替代语法：<code class=syntax>GROUP BY ROLLUP(...)</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/2948 rel="external nofollow noreferrer" target=_blank>#2948</a></li> <li>在使用 JOIN 的查询中，星号扩展为所有表中的列列表, 符合 SQL 标准. 您可以通过在用户配置级别将 <code class=syntax>asterisk_left_columns_only</code> 设置为 1 来恢复旧行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/2787 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>添加了对带有表函数的 JOIN 的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/2907 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>通过在 clickhouse-client 中按 Tab 自动完成. <a href=https://github.com/ClickHouse/ClickHouse/pull/2447 rel="external nofollow noreferrer" target=_blank>Sergey Shcherbin</a></li> <li>clickhouse-client 中的 Ctrl+C 清除输入的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/2877 rel="external nofollow noreferrer" target=_blank>#2877</a></li> <li>添加了<code class=syntax>join_default_strictness</code> 设置 (值：<code class=syntax>"</code>、<code class=syntax>'any'</code>、<code class=syntax>'all'</code>). 这允许您不为<code class=syntax>JOIN</code> 指定<code class=syntax>ANY</code> 或<code class=syntax>ALL</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/2982 rel="external nofollow noreferrer" target=_blank>#2982</a></li> <li>与查询处理相关的服务器日志的每一行都显示了查询 ID. <a href=https://github.com/ClickHouse/ClickHouse/pull/2482 rel="external nofollow noreferrer" target=_blank>#2482</a></li> <li>现在您可以在 clickhouse-client 中获取查询执行日志 (使用 <code class=syntax>send_logs_level</code> 设置). 通过分布式查询处理, 日志从所有服务器级联. <a href=https://github.com/ClickHouse/ClickHouse/pull/2482 rel="external nofollow noreferrer" target=_blank>#2482</a></li> <li><code class=syntax>system.query_log</code> 和 <code class=syntax>system.processes</code>(<code class=syntax>SHOW PROCESSLIST</code>) 表现在包含有关运行查询时所有更改设置的信息(<code class=syntax>Settings</code>数据的嵌套结构). 添加了<code class=syntax>log_query_settings</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/2482 rel="external nofollow noreferrer" target=_blank>#2482</a></li> <li><code class=syntax>system.query_log</code> 和 <code class=syntax>system.processes</code> 表现在显示有关参与查询执行的线程数的信息 (请参阅 <code class=syntax>thread_numbers</code> 列). <a href=https://github.com/ClickHouse/ClickHouse/pull/2482 rel="external nofollow noreferrer" target=_blank>#2482</a></li> <li>添加了 <code class=syntax>ProfileEvents</code> 计数器, 用于测量网络读写和磁盘读写所花费的时间、网络错误次数以及网络带宽受限时所花费的等待时间. <a href=https://github.com/ClickHouse/ClickHouse/pull/2482 rel="external nofollow noreferrer" target=_blank>#2482</a></li> <li>添加了包含来自 rusage 的系统指标的 <code class=syntax>ProfileEvents</code> 计数器 (您可以使用它们来获取有关用户空间和内核中 CPU 使用率、页面错误和上下文切换的信息), 以及 taskstats 指标 (使用这些来获取有关 I /O 等待时间, CPU 等待时间, 以及读取和记录的数据量, 有无页缓存). <a href=https://github.com/ClickHouse/ClickHouse/pull/2482 rel="external nofollow noreferrer" target=_blank>#2482</a></li> <li><code class=syntax>ProfileEvents</code> 计数器适用于全局和每个查询, 以及每个查询执行线程, 它允许您按查询详细分析资源消耗. <a href=https://github.com/ClickHouse/ClickHouse/pull/2482 rel="external nofollow noreferrer" target=_blank>#2482</a></li> <li>添加了 <code class=syntax>system.query_thread_log</code> 表, 其中包含有关每个查询执行线程的信息. 添加了<code class=syntax>log_query_threads</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/2482 rel="external nofollow noreferrer" target=_blank>#2482</a></li> <li><code class=syntax>system.metrics</code> 和 <code class=syntax>system.events</code> 表现在有内置文档. <a href=https://github.com/ClickHouse/ClickHouse/pull/3016 rel="external nofollow noreferrer" target=_blank>#3016</a></li> <li>添加了<code class=syntax>arrayEnumerateDense</code>函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/2975 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>添加了 <code class=syntax>arrayCumSumNonNegative</code> 和 <code class=syntax>arrayDifference</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/2942 rel="external nofollow noreferrer" target=_blank>Aleksey Studnev</a></li> <li>添加了<code class=syntax>retention</code>聚合函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/2887 rel="external nofollow noreferrer" target=_blank>Sundy Li</a></li> <li>现在您可以使用加号运算符添加 (合并) 聚合函数的状态, 并将聚合函数的状态乘以非负常数. <a href=https://github.com/ClickHouse/ClickHouse/pull/3062 rel="external nofollow noreferrer" target=_blank>#3062</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3034 rel="external nofollow noreferrer" target=_blank>#3034</a></li> <li>MergeTree 系列中的表现在具有虚拟列 <code class=syntax>_partition_id</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3089 rel="external nofollow noreferrer" target=_blank>#3089</a></li> </ul> <h4 id=experimental-features-1>实验功能:<a class=headerlink href=../amp/#experimental-features-1 title="Permanent link"> </a></h4> <ul> <li>添加了 <code class=syntax>LowCardinality(T)</code> 数据类型. 此数据类型会自动创建值的本地字典, 并允许在不解压字典的情况下进行数据处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/2830 rel="external nofollow noreferrer" target=_blank>#2830</a></li> <li>添加了 JIT 编译函数的缓存和编译前使用次数的计数器. 要 JIT 编译表达式, 请启用 <code class=syntax>compile_expressions</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/2990 rel="external nofollow noreferrer" target=_blank>#2990</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3077 rel="external nofollow noreferrer" target=_blank>#3077</a></li> </ul> <h4 id=improvements-4>改进:<a class=headerlink href=../amp/#improvements-4 title="Permanent link"> </a></h4> <ul> <li>修复了有废弃副本时复制日志无限累积的问题. 为延迟较长的副本添加了有效的恢复模式.</li> <li>当其中一个是字符串而其他是固定长度时，具有多个聚合字段的<code class=syntax>GROUP BY</code> 的性能得到改善.</li> <li>使用 <code class=syntax>PREWHERE</code> 和在 <code class=syntax>PREWHERE</code> 中隐式传输表达式时提高了性能.</li> <li>改进了文本格式的解析性能 (<code class=syntax>CSV</code>, <code class=syntax>TSV</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/2977 rel="external nofollow noreferrer" target=_blank>Amos Bird</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2980 rel="external nofollow noreferrer" target=_blank>#2980</a></li> <li>改进了读取二进制格式的字符串和数组的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/2955 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>当单个服务器上有大量表时，提高性能并减少对 <code class=syntax>system.tables</code> 和 <code class=syntax>system.columns</code> 的查询的内存消耗. <a href=https://github.com/ClickHouse/ClickHouse/pull/2953 rel="external nofollow noreferrer" target=_blank>#2953</a></li> <li>修复了大量查询导致错误时的性能问题 (<code class=syntax>_dl_addr</code>函数在<code class=syntax>perf top</code>中可见，但服务器没有使用太多CPU). <a href=https://github.com/ClickHouse/ClickHouse/pull/2938 rel="external nofollow noreferrer" target=_blank>#2938</a></li> <li>条件被投射到视图中 (当启用<code class=syntax>enable_optimize_predicate_expression</code> 时). <a href=https://github.com/ClickHouse/ClickHouse/pull/2907 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>对 <code class=syntax>UUID</code> 数据类型功能的改进. <a href=https://github.com/ClickHouse/ClickHouse/pull/3074 rel="external nofollow noreferrer" target=_blank>#3074</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2985 rel="external nofollow noreferrer" target=_blank>#2985</a></li> <li>The-Alchemist 词典支持 <code class=syntax>UUID</code> 数据类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/2822 rel="external nofollow noreferrer" target=_blank>#2822</a></li> <li><code class=syntax>visitParamExtractRaw</code> 函数可以正确处理嵌套结构. <a href=https://github.com/ClickHouse/ClickHouse/pull/2974 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>启用 <code class=syntax>input_format_skip_unknown_fields</code> 设置时, 会正确跳过 <code class=syntax>JSONEachRow</code> 格式的对象字段. <a href=https://github.com/ClickHouse/ClickHouse/pull/2958 rel="external nofollow noreferrer" target=_blank>BlahGeek</a></li> <li>对于带有条件的 <code class=syntax>CASE</code> 表达式, 您现在可以省略 <code class=syntax>ELSE</code>, 它等价于 <code class=syntax>ELSE NULL</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/2920 rel="external nofollow noreferrer" target=_blank>#2920</a></li> <li>现在可以在使用 ZooKeeper 时配置操作超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/2971 rel="external nofollow noreferrer" target=_blank>urykhy</a></li> <li>您可以将 <code class=syntax>LIMIT n, m</code> 的偏移量指定为 <code class=syntax>LIMIT n OFFSET m</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/2840 rel="external nofollow noreferrer" target=_blank>#2840</a></li> <li>您可以使用 <code class=syntax>SELECT TOP n</code> 语法作为 <code class=syntax>LIMIT</code> 的替代. <a href=https://github.com/ClickHouse/ClickHouse/pull/2840 rel="external nofollow noreferrer" target=_blank>#2840</a></li> <li>增加了写入系统表的队列大小, 因此不会经常发生<code class=syntax>SystemLog parameter queue is full</code>错误.</li> <li><code class=syntax>windowFunnel</code> 聚合函数现在支持满足多个条件的事件. <a href=https://github.com/ClickHouse/ClickHouse/pull/2801 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>重复列可用于 <code class=syntax>JOIN</code> 的 <code class=syntax>USING</code> 子句中. <a href=https://github.com/ClickHouse/ClickHouse/pull/3006 rel="external nofollow noreferrer" target=_blank>#3006</a></li> <li>Pretty<code class=syntax>格式现在对按宽度对齐的列有限制. 使用</code>output_format_pretty_max_column_pad_width` 设置. 如果一个值更宽, 它仍然会完整显示, 但表格中的其他单元格不会太宽. <a href=https://github.com/ClickHouse/ClickHouse/pull/3003 rel="external nofollow noreferrer" target=_blank>#3003</a></li> <li><code class=syntax>odbc</code> 表函数现在允许您指定数据库/模式名称. <a href=https://github.com/ClickHouse/ClickHouse/pull/2885 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>添加了使用在 <code class=syntax>clickhouse-client</code> 配置文件中指定的用户名的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/2909 rel="external nofollow noreferrer" target=_blank>Vladimir Kozbin</a></li> <li><code class=syntax>ZooKeeperExceptions</code> 计数器被分成三个计数器：<code class=syntax>ZooKeeperUserExceptions</code>、<code class=syntax>ZooKeeperHardwareExceptions</code> 和 <code class=syntax>ZooKeeperOtherExceptions</code>.</li> <li><code class=syntax>ALTER DELETE</code> 查询适用于物化视图.</li> <li>为 <code class=syntax>ReplicatedMergeTree</code> 表定期运行清理线程时添加了随机化, 以避免在有大量 <code class=syntax>ReplicatedMergeTree</code> 表时出现周期性负载峰值.</li> <li>支持 <code class=syntax>ATTACH TABLE ... ON CLUSTER</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/3025 rel="external nofollow noreferrer" target=_blank>#3025</a></li> </ul> <h4 id=bug-fixes-13>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-13 title="Permanent link"> </a></h4> <ul> <li>修复了 <code class=syntax>Dictionary</code> 表的问题 (抛出 <code class=syntax>Size of offsets does not match size of column</code> 或 <code class=syntax>Unknown compression method</code> 异常). 这个bug出现在18.10.3版本. <a href=https://github.com/ClickHouse/ClickHouse/issues/2913 rel="external nofollow noreferrer" target=_blank>#2913</a></li> <li>修复了合并 <code class=syntax>CollapsingMergeTree</code> 表时, 如果其中一个数据部分为空 (如果所有数据都被删除，这些部分是在合并或<code class=syntax>ALTER DELETE</code>期间形成的), 并且使用 <code class=syntax>vertical</code> 算法进行合并. <a href=https://github.com/ClickHouse/ClickHouse/pull/3049 rel="external nofollow noreferrer" target=_blank>#3049</a></li> <li>修复了在 <code class=syntax>DROP</code> 或 <code class=syntax>TRUNCATE</code> 期间为 <code class=syntax>Memory</code> 表同时执行 <code class=syntax>SELECT</code> 的竞争条件, 这可能导致服务器崩溃. 这个bug出现在1.1.54388版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/3038 rel="external nofollow noreferrer" target=_blank>#3038</a></li> <li>修复了在返回 <code class=syntax>Session is expired</code> 错误时插入 <code class=syntax>Replicated</code> 表时数据丢失的可能性 (数据丢失可以通过 <code class=syntax>ReplicatedDataLoss</code> 指标检测). 此错误发生在 1.1.54378 版本中. <a href=https://github.com/ClickHouse/ClickHouse/pull/2939 rel="external nofollow noreferrer" target=_blank>#2939</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2949 rel="external nofollow noreferrer" target=_blank>#2949</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2964 rel="external nofollow noreferrer" target=_blank>#2964</a></li> <li>修复了<code class=syntax>JOIN ... ON</code> 期间的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3000 rel="external nofollow noreferrer" target=_blank>#3000</a></li> <li>修复了当<code class=syntax>WHERE</code>表达式完全由一个限定的列名组成时搜索列名的错误，例如<code class=syntax>WHERE table.column</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/2994 rel="external nofollow noreferrer" target=_blank>#2994</a></li> <li>修复了如果从远程服务器请求包含带有子查询的 IN 表达式的单个列，则在执行分布式查询时发生的 <code class=syntax>Not found column</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3087 rel="external nofollow noreferrer" target=_blank>#3087</a></li> <li>修正了 <code class=syntax>UNION流中的块结构不匹配: 列数不同</code> 错误, 如果一个分片是本地的, 而另一个不是, 分布式查询发生, 并优化移动到 <code class=syntax>PREWHERE</code> 被触发. <a href=https://github.com/ClickHouse/ClickHouse/pull/2226 rel="external nofollow noreferrer" target=_blank>#2226</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3037 rel="external nofollow noreferrer" target=_blank>#3037</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3055 rel="external nofollow noreferrer" target=_blank>#3055</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3065 rel="external nofollow noreferrer" target=_blank>#3065</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3073 rel="external nofollow noreferrer" target=_blank>#3073</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3090 rel="external nofollow noreferrer" target=_blank>#3090</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3093 rel="external nofollow noreferrer" target=_blank>#3093</a></li> <li>修复了某些非凸多边形情况下的 <code class=syntax>pointInPolygon</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/2910 rel="external nofollow noreferrer" target=_blank>#2910</a></li> <li>修复了将 <code class=syntax>nan</code> 与整数进行比较时的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/3024 rel="external nofollow noreferrer" target=_blank>#3024</a></li> <li>修复了在极少数情况下可能导致段错误的 <code class=syntax>zlib-ng</code> 库中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/2854 rel="external nofollow noreferrer" target=_blank>#2854</a></li> <li>修复了在插入到具有 <code class=syntax>AggregateFunction</code> 列的表时, 如果聚合函数的状态不简单 (单独分配内存) , 并且如果单个插入请求导致多个小块时的内存泄漏. <a href=https://github.com/ClickHouse/ClickHouse/pull/3084 rel="external nofollow noreferrer" target=_blank>#3084</a></li> <li>修复了同时创建和删除同一个 <code class=syntax>Buffer</code> 或 <code class=syntax>MergeTree</code> 表时的竞争条件.</li> <li>修复了比较由某些非平凡类型 (例如元组) 组成的元组时出现段错误的可能性. <a href=https://github.com/ClickHouse/ClickHouse/pull/2989 rel="external nofollow noreferrer" target=_blank>#2989</a></li> <li>修复了运行某些 <code class=syntax>ON CLUSTER</code> 查询时出现段错误的可能性. <a href=https://github.com/ClickHouse/ClickHouse/pull/2960 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>修复了 <code class=syntax>arrayDistinct</code> 函数中 <code class=syntax>Nullable</code> 数组元素的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/2845 rel="external nofollow noreferrer" target=_blank>#2845</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2937 rel="external nofollow noreferrer" target=_blank>#2937</a></li> <li><code class=syntax>enable_optimize_predicate_expression</code> 选项现在可以正确支持带有 <code class=syntax>SELECT *</code> 的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/2929 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>修复了重新初始化 ZooKeeper 会话时的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/2917 rel="external nofollow noreferrer" target=_blank>#2917</a></li> <li>修复了使用 ZooKeeper 时潜在的阻塞问题.</li> <li>修复了在 <code class=syntax>SummingMergeTree</code> 中添加嵌套数据结构的错误代码.</li> <li>为聚合函数的状态分配内存时, 正确地考虑了对齐, 这使得在实现聚合函数的状态时使用需要对齐的操作成为可能. <a href=https://github.com/ClickHouse/ClickHouse/pull/2808 rel="external nofollow noreferrer" target=_blank>chenxing-xc</a></li> </ul> <h4 id=security-fix>安全修复:<a class=headerlink href=../amp/#security-fix title="Permanent link"> </a></h4> <ul> <li>安全使用 ODBC 数据源. 与 ODBC 驱动程序的交互使用单独的 <code class=syntax>clickhouse-odbc-bridge</code> 过程. 第三方 ODBC 驱动程序中的错误不再导致服务器稳定性或漏洞问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/2828 rel="external nofollow noreferrer" target=_blank>#2828</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2879 rel="external nofollow noreferrer" target=_blank>#2879</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2886 rel="external nofollow noreferrer" target=_blank>#2886</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2893 rel="external nofollow noreferrer" target=_blank>#2893</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2921 rel="external nofollow noreferrer" target=_blank>#2921</a></li> <li>修复了 <code class=syntax>catBoostPool</code> 表函数中文件路径的错误验证. <a href=https://github.com/ClickHouse/ClickHouse/pull/2894 rel="external nofollow noreferrer" target=_blank>#2894</a></li> <li>系统表的内容 (<code class=syntax>tables</code>、<code class=syntax>databases</code>、<code class=syntax>parts</code>、<code class=syntax>columns</code>、<code class=syntax>parts_columns</code>、<code class=syntax>merges</code>、<code class=syntax>mutations</code>、<code class=syntax>replicas</code> 和 <code class=syntax>replication_queue</code>) 根据用户配置进行过滤访问数据库(<code class=syntax>allow_databases</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/2856 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> </ul> <h4 id=backward-incompatible-changes-3>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-3 title="Permanent link"> </a></h4> <ul> <li>在使用 JOIN 的查询中, 星号扩展为所有表中的列列表, 符合 SQL 标准. 您可以通过在用户配置级别将 <code class=syntax>asterisk_left_columns_only</code> 设置为 1 来恢复旧行为.</li> </ul> <h4 id=build-changes-2>Build 更新:<a class=headerlink href=../amp/#build-changes-2 title="Permanent link"> </a></h4> <ul> <li>大多数集成测试现在可以通过提交运行.</li> <li>代码样式检查也可以通过提交运行.</li> <li>在 CentOS7/Fedora 上构建时正确选择了 <code class=syntax>memcpy</code> 实现. <a href=https://github.com/ClickHouse/ClickHouse/pull/2912 rel="external nofollow noreferrer" target=_blank>Etienne Champetier</a></li> <li>When using clang to build, some warnings from <code class=syntax>-Weverything</code> have been added, in addition to the regular <code class=syntax>-Wall-Wextra -Werror</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/2957 rel="external nofollow noreferrer" target=_blank>#2957</a></li> <li>调试构建使用 <code class=syntax>jemalloc</code> 调试选项.</li> <li>与 ZooKeeper 交互的库的接口被声明为抽象的. <a href=https://github.com/ClickHouse/ClickHouse/pull/2950 rel="external nofollow noreferrer" target=_blank>#2950</a></li> </ul> <h2 id=clickhouse-release-18-10>ClickHouse 版本 18.10<a class=headerlink href=../amp/#clickhouse-release-18-10 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-18-10-3-2018-08-13>ClickHouse 版本 18.10.3, 2018-08-13<a class=headerlink href=../amp/#clickhouse-release-18-10-3-2018-08-13 title="Permanent link"> </a></h3> <h4 id=new-features-5>新特征:<a class=headerlink href=../amp/#new-features-5 title="Permanent link"> </a></h4> <ul> <li>HTTPS 可用于复制. <a href=https://github.com/ClickHouse/ClickHouse/pull/2760 rel="external nofollow noreferrer" target=_blank>#2760</a></li> <li>除了现有的 <code class=syntax>murmurHash2_32</code> 之外, 还添加了函数 <code class=syntax>murmurHash2_64</code>、<code class=syntax>murmurHash3_32</code>、<code class=syntax>murmurHash3_64</code> 和 <code class=syntax>murmurHash3_128</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/2791 rel="external nofollow noreferrer" target=_blank>#2791</a></li> <li>支持 ClickHouse ODBC 驱动程序中的 Nullable 类型 (<code class=syntax>ODBCDriver2</code> 输出格式). <a href=https://github.com/ClickHouse/ClickHouse/pull/2834 rel="external nofollow noreferrer" target=_blank>#2834</a></li> <li>支持键列中的 <code class=syntax>UUID</code>.</li> </ul> <h4 id=improvements-5>改进:<a class=headerlink href=../amp/#improvements-5 title="Permanent link"> </a></h4> <ul> <li>从配置文件中删除集群时，无需重新启动服务器即可删除集群. <a href=https://github.com/ClickHouse/ClickHouse/pull/2777 rel="external nofollow noreferrer" target=_blank>#2777</a></li> <li>从配置文件中删除外部字典时，无需重新启动服务器即可删除它们. <a href=https://github.com/ClickHouse/ClickHouse/pull/2779 rel="external nofollow noreferrer" target=_blank>#2779</a></li> <li>为 <code class=syntax>Kafka</code> 表引擎添加了 <code class=syntax>SETTINGS</code> 支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/2781 rel="external nofollow noreferrer" target=_blank>Alexander Marshalov</a></li> <li><code class=syntax>UUID</code> 数据类型的改进 (尚未完成). <a href=https://github.com/ClickHouse/ClickHouse/pull/2618 rel="external nofollow noreferrer" target=_blank>#2618</a></li> <li>支持在 <code class=syntax>SummingMergeTree</code>、<code class=syntax>CollapsingMergeTree</code> 和 <code class=syntax>VersionedCollapsingMergeTree</code> 引擎中合并后的空部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/2815 rel="external nofollow noreferrer" target=_blank>#2815</a></li> <li>已完成突变的旧记录被删除 (<code class=syntax>ALTER DELETE</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/2784 rel="external nofollow noreferrer" target=_blank>#2784</a></li> <li>添加了 <code class=syntax>system.merge_tree_settings</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/2841 rel="external nofollow noreferrer" target=_blank>Kirill Shvakov</a></li> <li><code class=syntax>system.tables</code> 表现在有依赖列: <code class=syntax>dependencies_database</code> 和 <code class=syntax>dependencies_table</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/2851 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>添加了 <code class=syntax>max_partition_size_to_drop</code> 配置选项. <a href=https://github.com/ClickHouse/ClickHouse/pull/2782 rel="external nofollow noreferrer" target=_blank>#2782</a></li> <li>添加了 <code class=syntax>output_format_json_escape_forward_slashes</code> 选项. <a href=https://github.com/ClickHouse/ClickHouse/pull/2812 rel="external nofollow noreferrer" target=_blank>Alexander Bocharov</a></li> <li>添加了 <code class=syntax>max_fetch_partition_retries_count</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/2831 rel="external nofollow noreferrer" target=_blank>#2831</a></li> <li>添加了 <code class=syntax>prefer_localhost_replica</code> 设置, 用于禁用本地副本的首选项并在没有进程间交互的情况下转到本地副本. <a href=https://github.com/ClickHouse/ClickHouse/pull/2832 rel="external nofollow noreferrer" target=_blank>#2832</a></li> <li>在对空的 <code class=syntax>Float32</code> 或 <code class=syntax>Float64</code> 集合进行聚合的情况下, <code class=syntax>quantileExact</code> 聚合函数返回 <code class=syntax>nan</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/2855 rel="external nofollow noreferrer" target=_blank>Sundy Li</a></li> </ul> <h4 id=bug-fixes-14>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-14 title="Permanent link"> </a></h4> <ul> <li>删除了 ODBC 连接字符串参数的不必要转义, 这使得无法建立连接. 此错误发生在 18.6.0 版本中.</li> <li>修复了处理复制队列中 <code class=syntax>REPLACE PARTITION</code> 命令的逻辑. 如果同一个分区有两个 <code class=syntax>REPLACE</code> 命令, 不正确的逻辑可能会导致其中一个留在复制队列中而不会被执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/2814 rel="external nofollow noreferrer" target=_blank>#2814</a></li> <li>修复了所有数据部分为空时的合并错误 (如果所有数据都被删除, 则由合并或 <code class=syntax>ALTER DELETE</code> 形成的部分). 这个bug出现在18.1.0版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/2930 rel="external nofollow noreferrer" target=_blank>#2930</a></li> <li>修复了并发 <code class=syntax>Set</code> 或 <code class=syntax>Join</code> 的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/2823 rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>修正了 <code class=syntax>UNION流中的块结构不匹配: 列数不同</code> 错误, 如果一个 <code class=syntax>SELECT</code> 查询包含重复的列名, 在子查询 <code class=syntax>UNION ALL</code> 查询中发生的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/2094 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a></li> <li>修复了连接 MySQL 服务器时发生异常时的内存泄漏.</li> <li>修复了查询错误时不正确的 clickhouse-client 响应代码.</li> <li>修复了包含 DISTINCT 的物化视图的错误行为. <a href=https://github.com/ClickHouse/ClickHouse/issues/2795 rel="external nofollow noreferrer" target=_blank>#2795</a></li> </ul> <h4 id=backward-incompatible-changes-4>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-4 title="Permanent link"> </a></h4> <ul> <li>删除了对分布式表的 CHECK TABLE 查询的支持.</li> </ul> <h4 id=build-changes-3>Build 更新:<a class=headerlink href=../amp/#build-changes-3 title="Permanent link"> </a></h4> <ul> <li>分配器已被替换: 现在使用 <code class=syntax>jemalloc</code> 代替 <code class=syntax>tcmalloc</code>. 在某些情况下, 这将速度提高到 20%. 但是, 有些查询速度降低了 20%. 部分场景内存消耗降低约10%, 稳定性提升. 在竞争激烈的负载下, 用户空间和系统中的 CPU 使用率仅略有增加. <a href=https://github.com/ClickHouse/ClickHouse/pull/2773 rel="external nofollow noreferrer" target=_blank>#2773</a></li> <li>使用子模块中的 libressl. <a href=https://github.com/ClickHouse/ClickHouse/pull/1983 rel="external nofollow noreferrer" target=_blank>#1983</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/2807 rel="external nofollow noreferrer" target=_blank>#2807</a></li> <li>从子模块使用 unixodbc. <a href=https://github.com/ClickHouse/ClickHouse/pull/2789 rel="external nofollow noreferrer" target=_blank>#2789</a></li> <li>使用子模块中的 mariadb-connector-c. <a href=https://github.com/ClickHouse/ClickHouse/pull/2785 rel="external nofollow noreferrer" target=_blank>#2785</a></li> <li>将依赖于测试数据可用性的功能测试文件添加到存储库中 (暂时没有测试数据本身).</li> </ul> <h2 id=clickhouse-release-18-6>ClickHouse 版本 18.6<a class=headerlink href=../amp/#clickhouse-release-18-6 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-18-6-0-2018-08-02>ClickHouse 版本 18.6.0, 2018-08-02<a class=headerlink href=../amp/#clickhouse-release-18-6-0-2018-08-02 title="Permanent link"> </a></h3> <h4 id=new-features-6>新特征:<a class=headerlink href=../amp/#new-features-6 title="Permanent link"> </a></h4> <ul> <li>添加了对 JOIN ON 语法的 ON 表达式的支持:<br> <code class=syntax>JOIN ON Expr([table.]column ...) = Expr([table.]column, ...) [AND Expr([table.]column, ...) = Expr([table.]column, ...) ...]</code><br> 表达式必须是由 AND 运算符连接的等式链. 等式的每一边都可以是一个表的列上的任意表达式. 支持对右表使用完全限定的列名 (<code class=syntax>table.name</code>、<code class=syntax>database.table.name</code>、<code class=syntax>table_alias.name</code>、<code class=syntax>subquery_alias.name</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/2742 rel="external nofollow noreferrer" target=_blank>#2742</a></li> <li>可以启用 HTTPS 进行复制. <a href=https://github.com/ClickHouse/ClickHouse/pull/2760 rel="external nofollow noreferrer" target=_blank>#2760</a></li> </ul> <h4 id=improvements-6>改进:<a class=headerlink href=../amp/#improvements-6 title="Permanent link"> </a></h4> <ul> <li>服务器将其版本的补丁组件传递给客户端. 关于补丁版本组件的数据在 <code class=syntax>system.processes</code> 和 <code class=syntax>query_log</code> 中. <a href=https://github.com/ClickHouse/ClickHouse/pull/2646 rel="external nofollow noreferrer" target=_blank>#2646</a></li> </ul> <h2 id=clickhouse-release-18-5>ClickHouse 版本 18.5<a class=headerlink href=../amp/#clickhouse-release-18-5 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-18-5-1-2018-07-31>ClickHouse 版本 18.5.1, 2018-07-31<a class=headerlink href=../amp/#clickhouse-release-18-5-1-2018-07-31 title="Permanent link"> </a></h3> <h4 id=new-features-7>新特征:<a class=headerlink href=../amp/#new-features-7 title="Permanent link"> </a></h4> <ul> <li>添加了哈希函数 <code class=syntax>murmurHash2_32</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/2756 rel="external nofollow noreferrer" target=_blank>#2756</a>.</li> </ul> <h4 id=improvements-7>改进:<a class=headerlink href=../amp/#improvements-7 title="Permanent link"> </a></h4> <ul> <li>现在您可以使用 <code class=syntax>from_env</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/2741 rel="external nofollow noreferrer" target=_blank>#2741</a> 属性从环境变量设置配置文件中的值.</li> <li>添加了不区分大小写的 <code class=syntax>coalesce</code>、<code class=syntax>ifNull</code> 和 <code class=syntax>nullIf 函数</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/2752 rel="external nofollow noreferrer" target=_blank>#2752</a>.</li> </ul> <h4 id=bug-fixes-15>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-15 title="Permanent link"> </a></h4> <ul> <li>修复了启动副本时可能出现的错误 <a href=https://github.com/ClickHouse/ClickHouse/pull/2759 rel="external nofollow noreferrer" target=_blank>#2759</a>.</li> </ul> <h2 id=clickhouse-release-18-4>ClickHouse 版本 18.4<a class=headerlink href=../amp/#clickhouse-release-18-4 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-18-4-0-2018-07-28>ClickHouse 版本 18.4.0, 2018-07-28<a class=headerlink href=../amp/#clickhouse-release-18-4-0-2018-07-28 title="Permanent link"> </a></h3> <h4 id=new-features-8>新特征:<a class=headerlink href=../amp/#new-features-8 title="Permanent link"> </a></h4> <ul> <li>添加系统表: <code class=syntax>formats</code>、<code class=syntax>data_type_families</code>、<code class=syntax>aggregate_function_combinators</code>、<code class=syntax>table_functions</code>、<code class=syntax>table_engines</code>、<code class=syntax>collations</code> <a href=https://github.com/ClickHouse/ClickHouse/pull/2721 rel="external nofollow noreferrer" target=_blank>#2721</a>.</li> <li>添加了使用表函数而不是表作为 <code class=syntax>remote</code> 或<code class=syntax>cluster table function</code> 的参数的功能 <a href=https://github.com/ClickHouse/ClickHouse/pull/2708 rel="external nofollow noreferrer" target=_blank>#2708</a>.</li> <li>支持复制协议中的 <code class=syntax>HTTP Basic</code> 身份验证 <a href=https://github.com/ClickHouse/ClickHouse/pull/2727 rel="external nofollow noreferrer" target=_blank>#2727</a>.</li> <li><code class=syntax>has</code> 函数现在允许在 <code class=syntax>Enum</code> 值数组中搜索数值 <a href=https://github.com/ClickHouse/ClickHouse/pull/2699 rel="external nofollow noreferrer" target=_blank>Maxim Khrisanfov</a>.</li> <li>支持在从 <code class=syntax>Kafka</code> 读取时添加任意消息分隔符 <a href=https://github.com/ClickHouse/ClickHouse/pull/2701 rel="external nofollow noreferrer" target=_blank>Amos Bird</a>.</li> </ul> <h4 id=improvements-8>改进:<a class=headerlink href=../amp/#improvements-8 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>ALTER TABLE t DELETE WHERE</code> 查询不会重写不受 WHERE 条件影响的数据部分 <a href=https://github.com/ClickHouse/ClickHouse/pull/2694 rel="external nofollow noreferrer" target=_blank>#2694</a>.</li> <li><code class=syntax>ReplicatedMergeTree</code> 表的 <code class=syntax>use_minimalistic_checksums_in_zookeeper</code> 选项默认启用. 此设置是在 1.1.54378, 2018-04-16 版本中添加的. 不能再安装早于 1.1.54378 的版本.</li> <li>支持运行指定 <code class=syntax>ON CLUSTER</code> 的 <code class=syntax>KILL</code> 和 <code class=syntax>OPTIMIZE</code> 查询 <a href=https://github.com/ClickHouse/ClickHouse/pull/2689 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>.</li> </ul> <h4 id=bug-fixes-16>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-16 title="Permanent link"> </a></h4> <ul> <li>修复了错误 <code class=syntax>Column ... is not under a aggregate function and not in GROUP BY</code> 用于使用 IN 表达式进行聚合. 这个bug出现在18.1.0版本 (<a href=https://github.com/ClickHouse/ClickHouse/commit/bbdd780be0be06a0f336775941cdd536878dd2c2 rel="external nofollow noreferrer" target=_blank>bbdd780b</a>)</li> <li>修复了 <code class=syntax>windowFunnel aggregate function</code> 中的一个错误 <a href=https://github.com/ClickHouse/ClickHouse/pull/2735 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>.</li> <li>修复了 <code class=syntax>anyHeavy</code> 聚合函数中的错误 (<a href=https://github.com/ClickHouse/ClickHouse/commit/a2101df25a6a0fba99aa71f8793d762af2b801ee rel="external nofollow noreferrer" target=_blank>a2101df2</a>)</li> <li>修复了使用 <code class=syntax>countArray()</code> 聚合函数时服务器崩溃的问题.</li> </ul> <h4 id=backward-incompatible-changes-5>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-5 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>Kafka</code> 引擎的参数已从 <code class=syntax>Kafka(kafka_broker_list, kafka_topic_list, kafka_group_name, kafka_format[, kafka_schema, kafka_num_consumers])</code> 更改为 <code class=syntax>Kafka(kafka_broker_list, kafka_topic_list, kafka_topic_list, kafka_fka_name_schema_fka_format, kafka_fka_name_schema_group_format[, kafka_schema, kafka_num_consumers])</code> 如果您的表使用<code class=syntax>kafka_schema</code> 或<code class=syntax>kafka_num_consumers</code> 参数, 则必须手动编辑元数据文件<code class=syntax>path/metadata/database/table.sql</code> 并添加具有<code class=syntax>''</code> 值的<code class=syntax>kafka_row_delimiter</code> 参数.</li> </ul> <h2 id=clickhouse-release-18-1>ClickHouse 版本 18.1<a class=headerlink href=../amp/#clickhouse-release-18-1 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-18-1-0-2018-07-23>ClickHouse 版本 18.1.0, 2018-07-23<a class=headerlink href=../amp/#clickhouse-release-18-1-0-2018-07-23 title="Permanent link"> </a></h3> <h4 id=new-features-9>新特征:<a class=headerlink href=../amp/#new-features-9 title="Permanent link"> </a></h4> <ul> <li>支持对非复制 MergeTree 表的 <code class=syntax>ALTER TABLE t DELETE WHERE</code> 查询 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2634 rel="external nofollow noreferrer" target=_blank>#2634</a>).</li> <li>支持 <code class=syntax>uniq*</code> 聚合函数系列的任意类型 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2010 rel="external nofollow noreferrer" target=_blank>#2010</a>).</li> <li>支持比较运算符中的任意类型 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2026 rel="external nofollow noreferrer" target=_blank>#2026</a>).</li> <li><code class=syntax>users.xml</code> 文件允许设置格式为 <code class=syntax>10.0.0.1/255.255.255.0</code> 的子网掩码. 这对于在中间为 0 的 IPv6 网络使用掩码是必要的 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2637 rel="external nofollow noreferrer" target=_blank>#2637</a>).</li> <li>添加了 <code class=syntax>arrayDistinct</code> 函数 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2670 rel="external nofollow noreferrer" target=_blank>#2670</a>).</li> <li>SummingMergeTree 引擎现在可以处理 AggregateFunction 类型的列 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2566 rel="external nofollow noreferrer" target=_blank>Constantin S. Pan</a>).</li> </ul> <h4 id=improvements-9>改进:<a class=headerlink href=../amp/#improvements-9 title="Permanent link"> </a></h4> <ul> <li>更改了发布版本的编号方案. 现在第一部分包含发布年份 (莫斯科时区, 公元2000年), 第二部分包含主要更改的编号(大多数版本增加), 第三部分是补丁版本. 除非在变更日志中另有说明.否则版本仍然向后兼容.</li> <li>更快地将浮点数转换为字符串. (<a href=https://github.com/ClickHouse/ClickHouse/pull/2664 rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>如果在插入期间由于解析错误而跳过了某些行 (这在启用 <code class=syntax>input_allow_errors_num</code> 和 <code class=syntax>input_allow_errors_ratio</code> 设置的情况下是可能的), 跳过的行数现在会写入服务器日志(<a href=https://github.com/ClickHouse/ClickHouse/pull/2669 rel="external nofollow noreferrer" target=_blank>Leonardo Cecchi</a>).</li> </ul> <h4 id=bug-fixes-17>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-17 title="Permanent link"> </a></h4> <ul> <li>修复了临时表的 TRUNCATE 命令. (<a href=https://github.com/ClickHouse/ClickHouse/pull/2624 rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了 ZooKeeper 客户端库中读取响应时出现网络错误时发生的罕见死锁 (<a href=https://github.com/ClickHouse/ClickHouse/commit/c315200e64b87e44bdf740707fc857d1fdf7e947 rel="external nofollow noreferrer" target=_blank>c315200</a>).</li> <li>修复了 CAST 到 Nullable 类型期间的错误(<a href=https://github.com/ClickHouse/ClickHouse/issues/1322 rel="external nofollow noreferrer" target=_blank>#1322</a>).</li> <li>修复了区间边界重合时 <code class=syntax>maxIntersection()</code> 函数的错误结果 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2657 rel="external nofollow noreferrer" target=_blank>Michael Furmur</a>).</li> <li>修复了函数参数中 OR 表达式链的错误转换 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2663 rel="external nofollow noreferrer" target=_blank>chenxing-xc</a>).</li> <li>修复了在另一个子查询中包含 <code class=syntax>IN(子查询)</code> 表达式的查询的性能下降 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2571 rel="external nofollow noreferrer" target=_blank>#2571</a>).</li> <li>修复了使用非大写字母的 <code class=syntax>CAST</code> 函数的分布式查询中不同版本服务器之间的不兼容问题 (<a href=https://github.com/ClickHouse/ClickHouse/commit/fe8c4d64e434cacd4ceef34faa9005129f2190a5 rel="external nofollow noreferrer" target=_blank>fe8c4d6</a>).</li> <li>添加了对外部 DBMS 的查询标识符的缺失引用 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2635 rel="external nofollow noreferrer" target=_blank>#2635</a>).</li> </ul> <h4 id=backward-incompatible-changes-6>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-6 title="Permanent link"> </a></h4> <ul> <li>将包含数字零的字符串转换为 DateTime 不起作用. 示例: <code class=syntax>SELECT toDateTime('0')</code>. 这也是 <code class=syntax>DateTime DEFAULT '0'</code> 在表中不起作用的原因, 以及在字典中 <code class=syntax>&lt;null_value&gt;0&lt;/null_value&gt;</code> 的原因. 解决方案: 用<code class=syntax>0000-00-00 00:00:00</code>替换<code class=syntax>0</code>.</li> </ul> <h2 id=clickhouse-release-1-1>ClickHouse 版本 1.1<a class=headerlink href=../amp/#clickhouse-release-1-1 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-1-1-54394-2018-07-12>ClickHouse 版本 1.1.54394, 2018-07-12<a class=headerlink href=../amp/#clickhouse-release-1-1-54394-2018-07-12 title="Permanent link"> </a></h3> <h4 id=new-features-10>新特征:<a class=headerlink href=../amp/#new-features-10 title="Permanent link"> </a></h4> <ul> <li>添加了 <code class=syntax>histogram</code> 聚合函数 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2521 rel="external nofollow noreferrer" target=_blank>Mikhail Surin</a>).</li> <li>现在可以使用 <code class=syntax>OPTIMIZE TABLE ... FINAL</code> 而无需为 <code class=syntax>ReplicatedMergeTree</code> 指定分区 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2600 rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> </ul> <h4 id=bug-fixes-18>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-18 title="Permanent link"> </a></h4> <ul> <li>修复了发送和下载复制数据时套接字读写超时 (一秒) 非常小的问题, 这使得如果网络或磁盘上有负载, 则无法下载较大的部分 (导致循环尝试 下载部分). 此错误发生在 1.1.54388 版本中.</li> <li>修复了在表中插入重复数据块时在 ZooKeeper 中使用 chroot 时的问题.</li> <li><code class=syntax>has</code> 函数现在可以正确处理具有 Nullable 元素的数组 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2115 rel="external nofollow noreferrer" target=_blank>#2115</a>).</li> <li><code class=syntax>system.tables</code> 表在分布式查询中使用时可以正常工作. <code class=syntax>metadata_modification_time</code> 和 <code class=syntax>engine_full</code> 列现在是非虚拟的. 修复了仅从表中查询这些列时发生的错误.</li> <li>修复了插入空数据块后空 <code class=syntax>TinyLog</code> 表的工作方式 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2563 rel="external nofollow noreferrer" target=_blank>#2563</a>).</li> <li>如果 ZooKeeper 中节点的值为 NULL, 则 <code class=syntax>system.zookeeper</code> 表有效.</li> </ul> <h3 id=clickhouse-release-1-1-54390-2018-07-06>ClickHouse 版本 1.1.54390, 2018-07-06<a class=headerlink href=../amp/#clickhouse-release-1-1-54390-2018-07-06 title="Permanent link"> </a></h3> <h4 id=new-features-11>新特征:<a class=headerlink href=../amp/#new-features-11 title="Permanent link"> </a></h4> <ul> <li>查询可以以 <code class=syntax>multipart/form-data</code> 格式发送(在 <code class=syntax>query</code> 字段中), 如果外部数据也被发送用于查询处理 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2490 rel="external nofollow noreferrer" target=_blank>Olga Hvostikova</a>).</li> <li>添加了在以 CSV 格式读取数据时启用或禁用处理单引号或双引号的功能. 您可以在 <code class=syntax>format_csv_allow_single_quotes</code> 和 <code class=syntax>format_csv_allow_double_quotes</code> 设置中进行配置 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2574 rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>现在可以使用 <code class=syntax>OPTIMIZE TABLE ... FINAL</code> 而不指定 <code class=syntax>MergeTree</code> 的非复制变体的分区 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2599 rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> </ul> <h4 id=improvements-10>改进:<a class=headerlink href=../amp/#improvements-10 title="Permanent link"> </a></h4> <ul> <li>当可以使用表索引时，通过使用 IN 运算符提高性能、减少内存消耗和正确的内存消耗跟踪 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2584 rel="external nofollow noreferrer" target=_blank>#2584</a>).</li> <li>添加数据部分时删除了校验和的冗余检查. 这在有大量副本时很重要, 因为在这些情况下, 检查总数等于 N^2.</li> <li>为 <code class=syntax>arrayEnumerateUniq</code> 函数添加了对 <code class=syntax>Array(Tuple(...))</code> 参数的支持 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2573 rel="external nofollow noreferrer" target=_blank>#2573</a>).</li> <li>为 <code class=syntax>runningDifference</code> 函数添加了 <code class=syntax>Nullable</code> 支持 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2594 rel="external nofollow noreferrer" target=_blank>#2594</a>).</li> <li>提高了表达式数量非常多时的查询分析性能 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2572 rel="external nofollow noreferrer" target=_blank>#2572</a>).</li> <li>更快地选择要合并到 <code class=syntax>ReplicatedMergeTree</code> 表中的数据部分. ZooKeeper 会话的更快恢复 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2597 rel="external nofollow noreferrer" target=_blank>#2597</a>).</li> <li><code class=syntax>MergeTree</code> 表的 <code class=syntax>format_version.txt</code> 文件如果丢失则重新创建, 如果在复制没有文件的目录结构后启动 ClickHouse, 这是有意义的 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2593 rel="external nofollow noreferrer" target=_blank>Ciprian Hacman</a>).</li> </ul> <h4 id=bug-fixes-19>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-19 title="Permanent link"> </a></h4> <ul> <li>修复了使用 ZooKeeper 时无法在重新启动服务器之前恢复会话和表的只读状态的错误.</li> <li>修复了使用 ZooKeeper 时可能导致会话中断时旧节点不会被删除的错误.</li> <li>修复了 Float 参数的 <code class=syntax>quantileTDigest</code> 函数中的错误 (这个错误是在 1.1.54388 版本中引入的) (<a href=https://github.com/ClickHouse/ClickHouse/pull/2553 rel="external nofollow noreferrer" target=_blank>Mikhail Surin</a>).</li> <li>如果主键列位于相同大小的有符号和无符号整数之间的类型转换函数内, 则修复了 MergeTree 表的索引中的错误 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2603 rel="external nofollow noreferrer" target=_blank>#2603</a>).</li> <li>如果使用了宏但它们不在配置文件中, 则修复了段错误 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2570 rel="external nofollow noreferrer" target=_blank>#2570</a>).</li> <li>修复重新连接客户端时切换到默认数据库的问题 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2583 rel="external nofollow noreferrer" target=_blank>#2583</a>).</li> <li>修复了禁用 <code class=syntax>use_index_for_in_with_subqueries</code> 设置时发生的错误.</li> </ul> <h4 id=security-fix-1>安全修复:<a class=headerlink href=../amp/#security-fix-1 title="Permanent link"> </a></h4> <ul> <li>连接到 MySQL 时不再可能发送文件 (<code class=syntax>LOAD DATA LOCAL INFILE</code>).</li> </ul> <h3 id=clickhouse-release-1-1-54388-2018-06-28>ClickHouse 版本 1.1.54388, 2018-06-28<a class=headerlink href=../amp/#clickhouse-release-1-1-54388-2018-06-28 title="Permanent link"> </a></h3> <h4 id=new-features-12>新特征:<a class=headerlink href=../amp/#new-features-12 title="Permanent link"> </a></h4> <ul> <li>支持对复制表的 <code class=syntax>ALTER TABLE t DELETE WHERE</code> 查询. 添加了 <code class=syntax>system.mutations</code> 表以跟踪此类查询的进度.</li> <li>支持对 *MergeTree 表的 <code class=syntax>ALTER TABLE t [REPLACE|ATTACH] PARTITION</code> 查询.</li> <li>支持<code class=syntax>TRUNCATE TABLE</code>查询 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2260 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>几个新的复制表的 <code class=syntax>SYSTEM</code> 查询 (<code class=syntax>RESTART REPLICAS</code>, <code class=syntax>SYNC REPLICA</code>, <code class=syntax>[STOP|START] [MERGES|FETCHES|SENDS REPLICATED|REPLICATION QUEUES]</code>).</li> <li>增加了使用 MySQL 引擎写表的能力和对应的表函数 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2294 rel="external nofollow noreferrer" target=_blank>sundy-li</a>).</li> <li>添加了 <code class=syntax>url()</code> 表函数和 <code class=syntax>URL</code> 表引擎 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2501 rel="external nofollow noreferrer" target=_blank>Alexander Sapin</a>).</li> <li>添加了 <code class=syntax>windowFunnel</code> 聚合函数 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2352 rel="external nofollow noreferrer" target=_blank>sundy-li</a>).</li> <li>字符串的新 <code class=syntax>startsWith</code> 和 <code class=syntax>endsWith</code> 函数 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2429 rel="external nofollow noreferrer" target=_blank>Vadim Plakhtinsky</a>).</li> <li><code class=syntax>numbers()</code> 表函数现在允许您指定偏移量 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2535 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li><code class=syntax>clickhouse-client</code> 的密码可以交互输入.</li> <li>服务器日志现在可以发送到系统日志 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2459 rel="external nofollow noreferrer" target=_blank>Alexander Krasheninnikov</a>).</li> <li>支持使用共享库源登录词典 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2472 rel="external nofollow noreferrer" target=_blank>Alexander Sapin</a>).</li> <li>支持自定义 CSV 分隔符 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2263 rel="external nofollow noreferrer" target=_blank>Ivan Zhukov</a>).</li> <li>添加了 <code class=syntax>date_time_input_format</code> 设置. 如果将此设置切换为 <code class=syntax>best_effort</code>, 则会以多种格式读取 DateTime 值.</li> <li>添加了用于数据混淆的 <code class=syntax>clickhouse-obfuscator</code> 实用程序. 使用示例: 发布性能测试中使用的数据.</li> </ul> <h4 id=experimental-features-2>实验功能:<a class=headerlink href=../amp/#experimental-features-2 title="Permanent link"> </a></h4> <ul> <li>添加了仅在需要的地方计算 <code class=syntax>and</code> 参数的功能 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2272 rel="external nofollow noreferrer" target=_blank>Anastasia Tsarkova</a>).</li> <li>一些表达式现在可以 JIT 编译为本机代码 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2277 rel="external nofollow noreferrer" target=_blank>pyos</a>).</li> </ul> <h4 id=bug-fixes-20>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-20 title="Permanent link"> </a></h4> <ul> <li>使用 <code class=syntax>DISTINCT</code> 和 <code class=syntax>ORDER BY</code> 查询不再出现重复.</li> <li>使用<code class=syntax>ARRAY JOIN</code> 和 <code class=syntax>arrayFilter</code> 的查询不再返回不正确的结果.</li> <li>修复了从嵌套结构中读取数组列时的错误 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2066 rel="external nofollow noreferrer" target=_blank>#2066</a>).</li> <li>修复了使用 HAVING 子句 (如 <code class=syntax>HAVING tuple IN (...)</code>) 分析查询时的错误.</li> <li>修复了使用递归别名分析查询时的错误.</li> <li>修复了从 ReplacingMergeTree 读取时的错误，在 PREWHERE 中使用过滤所有行的条件 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2525 rel="external nofollow noreferrer" target=_blank>#2525</a>).</li> <li>在 HTTP 界面中使用会话时未应用用户配置文件设置.</li> <li>修复了如何从 clickhouse-local 中的命令行参数应用设置.</li> <li>ZooKeeper 客户端库现在使用从服务器收到的会话超时.</li> <li>修复了 ZooKeeper 客户端库中客户端等待服务器响应时间超过超时时间的错误.</li> <li>修复了分区键列条件查询的部分修剪 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2342 rel="external nofollow noreferrer" target=_blank>#2342</a>).</li> <li>现在可以在 <code class=syntax>CLEAR COLUMN IN PARTITION</code> 之后进行合并 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2315 rel="external nofollow noreferrer" target=_blank>#2315</a>).</li> <li>修复了 ODBC 表函数中的类型映射 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2268 rel="external nofollow noreferrer" target=_blank>sundy-li</a>).</li> <li>已修复带和不带时区的 <code class=syntax>DateTime</code> 的类型比较 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2400 rel="external nofollow noreferrer" target=_blank>Alexander Bocharov</a>).</li> <li>修复了 <code class=syntax>CAST</code> 运算符的语法解析和格式设置.</li> <li>固定插入到分布式表引擎的物化视图中 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2411 rel="external nofollow noreferrer" target=_blank>Babacar Diassé</a>).</li> <li>修复了将数据从 <code class=syntax>Kafka</code> 引擎写入物化视图时的竞争条件 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2448 rel="external nofollow noreferrer" target=_blank>Yangkuan Liu</a>).</li> <li>修复了 remote() 表函数中的 SSRF.</li> <li>修复了多行模式下 <code class=syntax>clickhouse-client</code> 的退出行为 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2510 rel="external nofollow noreferrer" target=_blank>#2510</a>).</li> </ul> <h4 id=improvements-11>改进:<a class=headerlink href=../amp/#improvements-11 title="Permanent link"> </a></h4> <ul> <li>复制表中的后台任务现在在线程池中执行，而不是在单独的线程中执行 (<a href=https://github.com/ClickHouse/ClickHouse/pull/1722 rel="external nofollow noreferrer" target=_blank>Silviu Caragea</a>).</li> <li>提高LZ4压缩性能.</li> <li>对具有大量 JOIN 和子查询的查询进行更快的分析.</li> <li>当网络错误过多时，DNS 缓存现在会自动更新.</li> <li>如果由于其中一个物化视图有太多的部件而无法插入表，则不会再插入表.</li> <li>更正了事件计数器 <code class=syntax>Query</code>、<code class=syntax>SelectQuery</code> 和 <code class=syntax>InsertQuery</code> 中的差异.</li> <li>如果元组类型匹配，则允许使用诸如 <code class=syntax>tuple IN (SELECT tuple)</code> 之类的表达式.</li> <li>即使您尚未配置 ZooKeeper，具有复制表的服务器也可以启动.</li> <li>在计算可用 CPU 内核数时，现在考虑了 cgroup 的限制 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2325 rel="external nofollow noreferrer" target=_blank>Atri Sharma</a>).</li> <li>在 systemd 配置文件中为配置目录添加了 chown (<a href=https://github.com/ClickHouse/ClickHouse/pull/2421 rel="external nofollow noreferrer" target=_blank>Mikhail Shiryaev</a>).</li> </ul> <h4 id=build-changes-4>Build 更新:<a class=headerlink href=../amp/#build-changes-4 title="Permanent link"> </a></h4> <ul> <li>gcc8 编译器可用于构建.</li> <li>添加了从子模块构建 llvm 的功能.</li> <li>ibrdkafka 库版本已更新至 v0.11.4.</li> <li>添加了使用系统 libcpuid 库的功能. 库版本已更新至 0.4.0.</li> <li>使用矢量类库修复了构建 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2274 rel="external nofollow noreferrer" target=_blank>Babacar Diassé</a>).</li> <li>Cmake 现在默认为 ninja 生成文件 (就像使用 <code class=syntax>-G Ninja</code> 时一样).</li> <li>添加了使用 libtinfo 库代替 libtermcap 的功能 (<a href=https://github.com/ClickHouse/ClickHouse/pull/2519 rel="external nofollow noreferrer" target=_blank>Georgy Kondratiev</a>).</li> <li>修复了 Fedora Rawhide 中的头文件冲突 (<a href=https://github.com/ClickHouse/ClickHouse/issues/2520 rel="external nofollow noreferrer" target=_blank>#2520</a>).</li> </ul> <h4 id=backward-incompatible-changes-7>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-7 title="Permanent link"> </a></h4> <ul> <li>删除了 <code class=syntax>Vertical</code> 和 <code class=syntax>Pretty*</code> 格式的转义并删除了 <code class=syntax>VerticalRaw</code> 格式.</li> <li>如果在分布式查询中同时使用版本 1.1.54388(或更高版本)和旧版本的服务器，并且查询具有不带 <code class=syntax>AS</code> 关键字的 <code class=syntax>cast(x, 'Type')</code> 表达式并且没有大写的 <code class=syntax>cast</code> 一词, 将抛出异常, 并显示类似 <code class=syntax>Not found column cast(0, 'UInt8') in block</code> 的消息. 解决方案: 更新整个集群上的服务器.</li> </ul> <h3 id=clickhouse-release-1-1-54385-2018-06-01>ClickHouse 版本 1.1.54385, 2018-06-01<a class=headerlink href=../amp/#clickhouse-release-1-1-54385-2018-06-01 title="Permanent link"> </a></h3> <h4 id=bug-fixes-21>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-21 title="Permanent link"> </a></h4> <ul> <li>修复了某些情况下导致 ZooKeeper 操作阻塞的错误.</li> </ul> <h3 id=clickhouse-release-1-1-54383-2018-05-22>ClickHouse 版本 1.1.54383, 2018-05-22<a class=headerlink href=../amp/#clickhouse-release-1-1-54383-2018-05-22 title="Permanent link"> </a></h3> <h4 id=bug-fixes-22>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-22 title="Permanent link"> </a></h4> <ul> <li>修复了一个表有很多副本时复制队列变慢的问题.</li> </ul> <h3 id=clickhouse-release-1-1-54381-2018-05-14>ClickHouse Rel版本ease 1.1.54381, 2018-05-14<a class=headerlink href=../amp/#clickhouse-release-1-1-54381-2018-05-14 title="Permanent link"> </a></h3> <h4 id=bug-fixes-23>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-23 title="Permanent link"> </a></h4> <ul> <li>修复了当 ClickHouse 与 ZooKeeper 服务器失去连接时 ZooKeeper 中的节点泄漏.</li> </ul> <h3 id=clickhouse-release-1-1-54380-2018-04-21>ClickHouse 版本 1.1.54380, 2018-04-21<a class=headerlink href=../amp/#clickhouse-release-1-1-54380-2018-04-21 title="Permanent link"> </a></h3> <h4 id=new-features-13>新特征:<a class=headerlink href=../amp/#new-features-13 title="Permanent link"> </a></h4> <ul> <li>添加了表函数 <code class=syntax>file(path, format, structure)</code>. 从 <code class=syntax>/dev/urandom</code> 读取字节的示例: <code class=syntax>ln -s /dev/urandom /var/lib/clickhouse/user_files/random``clickhouse-client -q "SELECT * FROM file('random', ' RowBinary', 'd UInt8') LIMIT 10"</code>.</li> </ul> <h4 id=improvements-12>改进:<a class=headerlink href=../amp/#improvements-12 title="Permanent link"> </a></h4> <ul> <li>子查询可以包含在 <code class=syntax>()</code> 括号中以提高查询的可读性. 例如: <code class=syntax>(SELECT 1) UNION ALL (SELECT 1)</code>.</li> <li>来自 <code class=syntax>system.processes</code> 表的简单 <code class=syntax>SELECT</code> 查询不包括在 <code class=syntax>max_concurrent_queries</code> 限制中.</li> </ul> <h4 id=bug-fixes-24>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-24 title="Permanent link"> </a></h4> <ul> <li>修复了从 <code class=syntax>物质化视图</code> 中选择时 <code class=syntax>IN</code> 运算符的错误行为.</li> <li>修复了在 <code class=syntax>partition_key_column IN (...)</code> 等表达式中按分区索引不正确的过滤.</li> <li>修复了如果在表上执行了 <code class=syntax>REANAME</code>，则无法在非领导副本上执行 <code class=syntax>OPTIMIZE</code> 查询.</li> <li>修复了在非领导副本上执行 <code class=syntax>OPTIMIZE</code> 或 <code class=syntax>ALTER</code> 查询时的授权错误.</li> <li>修复了 <code class=syntax>KILL QUERY</code> 的冻结问题.</li> <li>修复了 ZooKeeper 客户端库中的一个错误，如果在 ZooKeeper 配置中使用非空的 <code class=syntax>chroot</code> 前缀，该错误会导致监视丢失、分布式 DDL 队列冻结以及复制队列变慢.</li> </ul> <h4 id=backward-incompatible-changes-8>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-8 title="Permanent link"> </a></h4> <ul> <li>删除了对像 <code class=syntax>(a, b) IN (SELECT (a, b))</code> 这样的表达式的支持 (你可以使用等价的表达式 <code class=syntax>(a, b) IN (SELECT a, b)</code>). 在以前的版本中, 这些表达式会导致未确定的 <code class=syntax>WHERE</code> 过滤或导致错误.</li> </ul> <h3 id=clickhouse-release-1-1-54378-2018-04-16>ClickHouse 版本 1.1.54378, 2018-04-16<a class=headerlink href=../amp/#clickhouse-release-1-1-54378-2018-04-16 title="Permanent link"> </a></h3> <h4 id=new-features-14>新特征:<a class=headerlink href=../amp/#new-features-14 title="Permanent link"> </a></h4> <ul> <li>无需重新启动服务器即可更改日志级别.</li> <li>添加了 <code class=syntax>SHOW CREATE DATABASE</code> 查询.</li> <li><code class=syntax>query_id</code> 可以传递给 <code class=syntax>clickhouse-client</code> (elBroom).</li> <li>新设置：<code class=syntax>max_network_bandwidth_for_all_users</code>.</li> <li>为 <code class=syntax>MATERIALIZED VIEW</code> 添加了对 <code class=syntax>ALTER TABLE ... PARTITION ...</code> 的支持.</li> <li>在系统表中添加了有关未压缩形式的数据部分大小的信息.</li> <li>分布式表的服务器到服务器加密支持( <code class=syntax>&lt;remote_servers&gt;</code> 中的副本配置中的 <code class=syntax>&lt;secure&gt;1&lt;/secure&gt;</code>).</li> <li><code class=syntax>ReplicatedMergeTree</code> 系列的表级别配置以最小化 Zookeeper 中存储的数据量: <code class=syntax>use_minimalistic_checksums_in_zookeeper = 1</code></li> <li><code class=syntax>clickhouse-client</code> 提示的配置. 默认情况下, 服务器名称现在会输出到提示中. 服务器的显示名称可以更改. 它还在 <code class=syntax>X-ClickHouse-Display-Name</code> HTTP 标头中发送 (Kirill Shvakov).</li> <li>可以为 <code class=syntax>Kafka</code> 引擎指定多个逗号分隔的 <code class=syntax>topics</code> (Tobias Adamson)</li> <li>当查询被 <code class=syntax>KILL QUERY</code> 或 <code class=syntax>replace_running_query</code> 停止时，客户端会收到 <code class=syntax>Query was cancelled</code> 异常而不是不完整的结果.</li> </ul> <h4 id=improvements-13>改进:<a class=headerlink href=../amp/#improvements-13 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>ALTER TABLE ... DROP/DETACH PARTITION</code> 查询在复制队列的前面运行.</li> <li><code class=syntax>SELECT ... FINAL</code> 和 <code class=syntax>OPTIMIZE ... FINAL</code> 可以在表只有一个数据部分时使用.</li> <li>如果手动删除了 <code class=syntax>query_log</code> 表，则会即时重新创建它 (Kirill Shvakov).</li> <li><code class=syntax>lengthUTF8</code> 函数运行速度更快 (zhang2014).</li> <li>当分片数量非常多时，提高了在 <code class=syntax>分布式</code> 表 (<code class=syntax>insert_distributed_sync = 1</code>) 中同步插入的性能.</li> <li>服务器接受来自客户端的 <code class=syntax>send_timeout</code> 和 <code class=syntax>receive_timeout</code> 设置，并在连接到客户端时应用它们 (它们以相反的顺序应用：服务器套接字的 <code class=syntax>send_timeout</code> 设置为从客户端接收到的 <code class=syntax>receive_timeout</code> 值, 反之亦然).</li> <li>用于异步插入 <code class=syntax>Distributed</code> 表的更强大的崩溃恢复.</li> <li><code class=syntax>countEqual</code> 函数的返回类型从 <code class=syntax>UInt32</code> 更改为 <code class=syntax>UInt64</code> (谢磊).</li> </ul> <h4 id=bug-fixes-25>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-25 title="Permanent link"> </a></h4> <ul> <li>修复了表达式左侧为 <code class=syntax>Nullable</code> 时 <code class=syntax>IN</code> 的错误.</li> <li>当某些元组组件在表索引中时，现在使用带有 <code class=syntax>IN</code> 的元组时会返回正确的结果.</li> <li><code class=syntax>max_execution_time</code> 限制现在可以在分布式查询中正常工作.</li> <li>修复了计算 <code class=syntax>system.columns</code> 表中复合列大小时的错误.</li> <li>修复了创建临时表 <code class=syntax>CREATE TEMPORARY TABLE IF NOT EXISTS</code> 时的错误.</li> <li>修复了 <code class=syntax>StorageKafka</code> 中的错误 (##2075)</li> <li>固定服务器因某些聚合函数的无效参数而崩溃.</li> <li>修复了阻止<code class=syntax>DETACH DATABASE</code> 查询停止 <code class=syntax>ReplicatedMergeTree</code> 表的后台任务的错误.</li> <li>插入聚合物化视图时，不太可能发生 <code class=syntax>Too many parts</code> 状态 (##2084).</li> <li>如果替换必须跟在同一级别的另一个替换之后，则更正了配置中替换的递归处理.</li> <li>在创建使用带有 <code class=syntax>UNION ALL</code> 的查询的 <code class=syntax>VIEW</code> 时更正了元数据文件中的语法.</li> <li><code class=syntax>SummingMergeTree</code> 现在可以正确地使用复合键对嵌套数据结构求和.</li> <li>修复了在为 <code class=syntax>ReplicatedMergeTree</code> 表选择领导者时出现竞争条件的可能性.</li> </ul> <h4 id=build-changes-5>Build 更新:<a class=headerlink href=../amp/#build-changes-5 title="Permanent link"> </a></h4> <ul> <li>构建支持 <code class=syntax>ninja</code> 而不是 <code class=syntax>make</code>，并且默认使用 <code class=syntax>ninja</code> 来构建版本.</li> <li>重命名包：<code class=syntax>clickhouse-common-static</code>中的<code class=syntax>clickhouse-server-base</code>; <code class=syntax>clickhouse-server</code> 中的 <code class=syntax>clickhouse-server-common</code>; <code class=syntax>clickhouse-common-static-dbg</code> 中的 <code class=syntax>clickhouse-common-dbg</code>. 要安装, 请使用 <code class=syntax>clickhouse-server clickhouse-client</code> . 具有旧名称的包仍将加载到存储库中以实现向后兼容性.</li> </ul> <h4 id=backward-incompatible-changes-9>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-9 title="Permanent link"> </a></h4> <ul> <li>如果在左侧指定了数组, 则删除了 IN 表达式的特殊解释. 以前, 表达式 <code class=syntax>arr IN (set)</code> 被解释为"at least one <code class=syntax>arr</code> 元素属于 <code class=syntax>set</code>". 要在新版本中获得相同的行为, 请编写 <code class=syntax>arrayExists(x -&gt; x IN (set), arr)</code>.</li> <li>禁用套接字选项<code class=syntax>SO_REUSEPORT</code> 的错误使用，该选项默认在 Poco 库中被错误启用. 请注意, 在 Linux 上，不再有任何理由同时指定地址 <code class=syntax>::</code> 和 <code class=syntax>0.0.0.0</code> 用于侦听 – 仅使用 <code class=syntax>::</code>, 它允许侦听通过 IPv4 和 IPv6 的连接(默认情况下) 内核配置设置）. 您还可以通过在配置中指定 <code class=syntax>&lt;listen_reuse_port&gt;1&lt;/listen_reuse_port&gt;</code> 来恢复以前版本的行为.</li> </ul> <h3 id=clickhouse-release-1-1-54370-2018-03-16>ClickHouse 版本 1.1.54370, 2018-03-16<a class=headerlink href=../amp/#clickhouse-release-1-1-54370-2018-03-16 title="Permanent link"> </a></h3> <h4 id=new-features-15>新特征:<a class=headerlink href=../amp/#new-features-15 title="Permanent link"> </a></h4> <ul> <li>添加了 <code class=syntax>system.macros</code> 表和更改配置文件时宏的自动更新.</li> <li>添加了 <code class=syntax>SYSTEM RELOAD CONFIG</code> 查询.</li> <li>新增<code class=syntax>maxIntersections(left_col, right_col)</code>聚合函数, 返回最大同时相交区间数<code class=syntax>[left; 对]</code>. <code class=syntax>maxIntersectionsPosition(left, right)</code> 函数返回 "maximum" 间隔的开始. (<a href=https://github.com/ClickHouse/ClickHouse/pull/2012 rel="external nofollow noreferrer" target=_blank>Michael Furmur</a>).</li> </ul> <h4 id=improvements-14>改进:<a class=headerlink href=../amp/#improvements-14 title="Permanent link"> </a></h4> <ul> <li>在 <code class=syntax>Replicated</code> 表中插入数据时, 对 <code class=syntax>ZooKeeper</code> 的请求较少(并且大多数用户级错误已从 <code class=syntax>ZooKeeper</code> 日志中消失).</li> <li>添加了为数据集创建别名的功能. 示例: <code class=syntax>WITH (1, 2, 3) AS set SELECT number IN set FROM system.numbers LIMIT 10</code>.</li> </ul> <h4 id=bug-fixes-26>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-26 title="Permanent link"> </a></h4> <ul> <li>修复了从 <code class=syntax>Distributed</code> 表的合并表读取时的 <code class=syntax>Illegal PREWHERE</code> 错误.</li> <li>添加了允许您在仅支持 IPv4 的 Docker 容器中启动 clickhouse-server 的修复程序.</li> <li>修复了从系统 <code class=syntax>system.parts_columns</code> 表读取时的竞争条件.</li> <li>在同步插入到 <code class=syntax>Distributed</code> 表期间删除了双缓冲，这可能会导致连接超时.</li> <li>修复了在开始 <code class=syntax>SELECT</code> 查询之前导致等待不可用副本过长的错误.</li> <li>修复了 <code class=syntax>system.parts</code> 表中不正确的日期.</li> <li>修复了如果在 <code class=syntax>ZooKeeper</code> 集群的配置中 <code class=syntax>chroot</code> 不为空, 则无法在 <code class=syntax>Replicated</code> 表中插入数据的错误.</li> <li>修复了空 <code class=syntax>ORDER BY</code> 表的垂直合并算法.</li> <li>恢复了在对远程表的查询中使用字典的能力, 即使这些字典不存在于请求者服务器上. 此功能在 1.1.54362 版中丢失.</li> <li>当 <code class=syntax>IN</code> 的右侧应该使用远程 <code class=syntax>default.table</code> 时, 恢复了诸如 <code class=syntax>SELECT * FROM remote('server2', default.table) WHERE col IN (SELECT col2 FROM default.table)</code> 之类的查询行为而不是本地的. 此行为在 1.1.54358 版本中被破坏.</li> <li>删除了 <code class=syntax>Not found column ... in block</code> 的无关错误级日志记录.</li> </ul> <h3 id=clickhouse-release-1-1-54362-2018-03-11>ClickHouse 版本 1.1.54362, 2018-03-11<a class=headerlink href=../amp/#clickhouse-release-1-1-54362-2018-03-11 title="Permanent link"> </a></h3> <h4 id=new-features-16>新特征:<a class=headerlink href=../amp/#new-features-16 title="Permanent link"> </a></h4> <ul> <li>带 <code class=syntax>GROUP BY</code> 的空集 (例如 <code class=syntax>SELECT count(*) FROM table WHERE 0</code>) 的聚合现在返回一个结果, 其中一行带有聚合函数的空值, 符合 SQL 标准. 要恢复旧行为 (返回空结果), 请将 <code class=syntax>empty_result_for_aggregation_by_empty_set</code> 设置为 1.</li> <li>为 <code class=syntax>UNION ALL</code> 添加了类型转换. <code class=syntax>UNION ALL</code> 中的 <code class=syntax>SELECT</code> 位置允许不同的别名, 符合SQL标准.</li> <li><code class=syntax>LIMIT BY</code> 子句支持任意表达式. 以前, 只能使用由<code class=syntax>SELECT</code>产生的列.</li> <li>当将 <code class=syntax>IN</code> 应用于主键列中的表达式元组时, 将使用 <code class=syntax>MergeTree</code> 表的索引. 示例: <code class=syntax>WHERE (UserID, EventDate) IN ((123, '2000-01-01'), ...)</code> (Anastasiya Tsarkova).</li> <li>添加了用于在集群之间复制和重新分片数据的 <code class=syntax>clickhouse-copier</code> 工具(测试版).</li> <li>加了一致性哈希函数: <code class=syntax>yandexConsistentHash</code>、<code class=syntax>jumpConsistentHash</code>、<code class=syntax>sumburConsistentHash</code>. 它们可以用作分片键, 以减少后续重新分片期间的网络流量.</li> <li>添加函数: <code class=syntax>arrayAny</code>, <code class=syntax>arrayAll</code>, <code class=syntax>hasAny</code>, <code class=syntax>hasAll</code>, <code class=syntax>arrayIntersect</code>, <code class=syntax>arrayResize</code>.</li> <li>添加了 <code class=syntax>arrayCumSum</code> 函数 (Javi Santana).</li> <li>添加了 <code class=syntax>parseDateTimeBestEffort</code>、<code class=syntax>parseDateTimeBestEffortOrZero</code> 和 <code class=syntax>parseDateTimeBestEffortOrNull</code> 函数以从包含各种可能格式的文本的字符串中读取 DateTime.</li> <li>更新期间可以从外部字典中部分重新加载数据 (仅加载指定字段的值大于先前下载的记录) (Arsen Hakobyan).</li> <li>添加了 <code class=syntax>cluster</code> 表功能. 示例: <code class=syntax>cluster(cluster_name, db, table)</code>。 <code class=syntax>remote</code> 表函数可以接受集群名称作为第一个参数, 如果它被指定为标识符.</li> <li><code class=syntax>remote</code> 和 <code class=syntax>cluster</code> 表函数可用于 <code class=syntax>INSERT</code> 查询.</li> <li>将 <code class=syntax>create_table_query</code> 和 <code class=syntax>engine_full</code> 虚拟列添加到 <code class=syntax>system.tables</code>表. <code class=syntax>metadata_modification_time</code> 列是虚拟的.</li> <li>将 <code class=syntax>data_path</code> 和 <code class=syntax>metadata_path</code> 列添加到 <code class=syntax>system.tables</code> 和 <code class=syntax>system.databases</code> 表, 并将 <code class=syntax>path</code> 列添加到 <code class=syntax>system.parts</code> 和 <code class=syntax>system.parts_columns</code> 表.</li> <li>在 <code class=syntax>system.part_log</code> 表中添加了有关合并的附加信息.</li> <li><code class=syntax>system.query_log</code> 表可以使用任意分区键 (Kirill Shvakov).</li> <li><code class=syntax>SHOW TABLES</code> 查询现在也显示临时表. 添加临时表和 <code class=syntax>is_temporary</code> 列到 <code class=syntax>system.tables</code> (zhang2014).</li> <li>添加了<code class=syntax>DROP TEMPORARY TABLE</code>和<code class=syntax>EXISTS TEMPORARY TABLE</code>查询 (zhang2014).</li> <li>支持临时表的 <code class=syntax>SHOW CREATE TABLE</code> (zhang2014).</li> <li>为内部进程使用的设置添加了<code class=syntax>system_profile</code>配置参数.</li> <li>支持加载 <code class=syntax>object_id</code> 作为 <code class=syntax>MongoDB</code> 字典中的属性 (Pavel Litvinenko).</li> <li>使用 <code class=syntax>MongoDB</code> 源加载外部字典的数据时, 将 <code class=syntax>null</code> 作为默认值读取 (Pavel Litvinenko).</li> <li>从没有单引号的 Unix 时间戳中读取 <code class=syntax>Values</code> 格式的 <code class=syntax>DateTime</code> 值.</li> <li>在某些副本缺少请求的表的情况下, <code class=syntax>remote</code> 表函数支持故障转移.</li> <li>当您运行 <code class=syntax>clickhouse-server</code> 时，可以在命令行中覆盖配置设置. 示例: <code class=syntax>clickhouse-server -- --logger.level=information</code>.</li> <li>从 <code class=syntax>FixedString</code> 参数实现了 <code class=syntax>empty</code> 函数: 如果字符串完全由空字节组成, 该函数返回 1 (zhang2014).</li> <li>添加了<code class=syntax>listen_try</code>配置参数, 用于在不退出的情况下至少侦听一个侦听地址, 如果某些地址无法侦听 (对于禁用对 IPv4 或 IPv6 支持的系统很有用).</li> <li>添加了 <code class=syntax>VersionedCollapsingMergeTree</code> 表引擎.</li> <li>支持<code class=syntax>library</code> 字典源的行和任意数字类型.</li> <li><code class=syntax>MergeTree</code> 表可以在没有主键的情况下使用 (你需要指定 <code class=syntax>ORDER BY tuple()</code>).</li> <li>如果参数不是 <code class=syntax>NULL</code> , 则 <code class=syntax>Nullable</code> 类型可以 <code class=syntax>CAST</code> 到非 <code class=syntax>Nullable</code> 类型.</li> <li>可以为 <code class=syntax>VIEW</code> 执行 <code class=syntax>RENAME TABLE</code> .</li> <li>添加了 <code class=syntax>throwIf</code> 函数.</li> <li>添加了 <code class=syntax>odbc_default_field_size</code> 选项, 它允许您扩展从 ODBC 源加载的值的最大大小 (默认为 1024).</li> <li><code class=syntax>system.processes</code> 表和 <code class=syntax>SHOW PROCESSLIST</code> 现在有 <code class=syntax>is_cancelled</code> 和 <code class=syntax>peak_memory_usage</code> 列.</li> </ul> <h4 id=improvements-15>改进:<a class=headerlink href=../amp/#improvements-15 title="Permanent link"> </a></h4> <ul> <li>结果的限制和配额不再应用于 <code class=syntax>INSERT SELECT</code> 查询或 <code class=syntax>SELECT</code> 子查询的中间数据.</li> <li>在服务器启动时检查 <code class=syntax>Replicated</code> 表的状态时, 更少的 <code class=syntax>force_restore_data</code> 错误触发器.</li> <li>添加了 <code class=syntax>allow_distributed_ddl</code> 选项.</li> <li><code class=syntax>MergeTree</code> 表键的表达式中不允许使用不确定性函数.</li> <li>从 <code class=syntax>config.d</code> 目录替换的文件按字母顺序加载.</li> <li>在将空数组作为元素之一的常量多维数组的情况下, 改进了 <code class=syntax>arrayElement</code> 函数的性能. 示例: <code class=syntax>[[1], []][x]</code>.</li> <li>当使用具有非常大的替换 (例如, 非常大的 IP 网络列表) 的配置文件时, 服务器现在启动速度更快.</li> <li>运行查询时, 表值函数运行一次. 以前, <code class=syntax>remote</code> 和 <code class=syntax>mysql</code> 表值函数执行相同的查询两次以从远程服务器检索表结构.</li> <li>使用了 <code class=syntax>MkDocs</code> 文档生成器.</li> <li>当您尝试删除其他列的 <code class=syntax>DEFAULT</code> / <code class=syntax>MATERIALIZED</code> 表达式所依赖的表列时, 抛出异常 (zhang2014).</li> <li>添加了将文本格式中的空行解析为 <code class=syntax>Float</code> 数据类型的数字 0 的功能. 此功能以前可用, 但在版本 1.1.54342 中丢失.</li> <li><code class=syntax>Enum</code> 值可用于 <code class=syntax>min</code>、<code class=syntax>max</code>、<code class=syntax>sum</code> 和其他一些函数. 在这些情况下, 它使用相应的数值. 此功能以前可用, 但在 1.1.54337 版本中丢失.</li> <li>添加了 <code class=syntax>max_expanded_ast_elements</code> 以限制递归扩展别名后 AST 的大小.</li> </ul> <h4 id=bug-fixes-27>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-27 title="Permanent link"> </a></h4> <ul> <li>修复了错误地从子查询中删除不必要的列, 或未从包含 <code class=syntax>UNION ALL</code> 的子查询中删除的情况.</li> <li>修复了 <code class=syntax>ReplaceMergeTree</code> 表的合并错误.</li> <li>修复了 <code class=syntax>Distributed</code> 表中的同步插入 (<code class=syntax>insert_distributed_sync = 1</code>).</li> <li>修复了子查询中重复列的 <code class=syntax>FULL</code> 和 <code class=syntax>RIGHT JOIN</code> 的某些用途的段错误.</li> <li>修复了<code class=syntax>replace_running_query</code>和<code class=syntax>KILL QUERY</code>的某些用途的段错误.</li> <li>修复了 <code class=syntax>system.dictionaries</code> 表中 <code class=syntax>source</code> 和 <code class=syntax>last_exception</code> 列的顺序.</li> <li>修复了 <code class=syntax>DROP DATABASE</code> 查询未删除带有元数据的文件时的错误.</li> <li>修复了 <code class=syntax>Dictionary</code> 数据库的 <code class=syntax>DROP DATABASE</code> 查询.</li> <li>修复了基数大于 1 亿项的 <code class=syntax>uniqHLL12</code> 和 <code class=syntax>uniqCombined</code> 函数的低精度问题 (Alex Bocharov).</li> <li>修复了在需要同时计算 INSERT 查询中的默认显式表达式时隐式默认值的计算 (zhang2014).</li> <li>修复了对 <code class=syntax>MergeTree</code> 表的查询无法完成的罕见情况 (chenxing-xc).</li> <li>修复了在所有分片都是本地的情况下对 <code class=syntax>Distributed</code> 表运行 <code class=syntax>CHECK</code> 查询时发生的崩溃 (chenxing.xc).</li> <li>修复了使用正则表达式的函数的轻微性能回归.</li> <li>修复了从复杂表达式创建多维数组时的性能回归.</li> <li>修复了可能导致额外的 <code class=syntax>FORMAT</code> 部分出现在带有元数据的 <code class=syntax>.sql</code> 文件中的错误.</li> <li>修复了一个错误，该错误导致在尝试删除查看明确指定的表的 <code class=syntax>MATERIALIZED VIEW</code> 时应用 <code class=syntax>max_table_size_to_drop</code> 限制.</li> <li>修复了与旧客户端不兼容的问题 (旧客户端有时会使用 <code class=syntax>DateTime('timezone')</code> 类型发送数据, 他们不理解).</li> <li>修复了当这些列的条件移至 <code class=syntax>PREWHERE</code> 时读取使用 <code class=syntax>ALTER</code> 添加但对于旧分区为空的结构的 <code class=syntax>Nested</code> 列元素时的错误.</li> <li>修复了在查询到 <code class=syntax>Merge</code> 表时通过虚拟 <code class=syntax>_table</code> 列过滤表时的错误.</li> <li>修复了在 <code class=syntax>Distributed</code> 表中使用 <code class=syntax>ALIAS</code> 列时的错误.</li> <li>修复了一个错误, 该错误使动态编译无法用于带有来自 <code class=syntax>quantile</code> 系列的聚合函数的查询.</li> <li>修复了查询执行管道中的争用条件, 这种情况在使用具有大量表的 <code class=syntax>Merge</code> 表以及使用 <code class=syntax>GLOBAL</code> 子查询时在非常罕见的情况下发生.</li> <li>修复了在使用来自多个参数的聚合函数时将不同大小的数组传递给 <code class=syntax>arrayReduce</code> 函数时发生的崩溃.</li> <li>禁止在 <code class=syntax>MATERIALIZED VIEW</code> 中使用带有 <code class=syntax>UNION ALL</code> 的查询.</li> <li>修复了服务器启动时 <code class=syntax>part_log</code> 系统表初始化过程中的错误 (默认情况下, <code class=syntax>part_log</code>是禁用的).</li> </ul> <h4 id=backward-incompatible-changes-10>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-10 title="Permanent link"> </a></h4> <ul> <li>删除了 <code class=syntax>distributed_ddl_allow_replicated_alter</code> 选项. 默认情况下启用此行为.</li> <li>删除了 <code class=syntax>strict_insert_defaults</code> 设置. 如果您正在使用此功能, 请写信至 <code class=syntax>clickhouse-feedback@yandex-team.com</code>.</li> <li>移除了 <code class=syntax>UnsortedMergeTree</code> 引擎.</li> </ul> <h3 id=clickhouse-release-1-1-54343-2018-02-05>ClickHouse 版本 1.1.54343, 2018-02-05<a class=headerlink href=../amp/#clickhouse-release-1-1-54343-2018-02-05 title="Permanent link"> </a></h3> <ul> <li>添加了在分布式 DDL 查询和分布式表构造函数中定义集群名称的宏支持: <code class=syntax>CREATE TABLE distr ON CLUSTER '{cluster}' (...) ENGINE = Distributed('{cluster}', 'db', 'table')</code>.</li> <li>现在像 <code class=syntax>SELECT ... FROM table WHERE expr IN (subquery)</code> 这样的查询是使用 <code class=syntax>table</code> 索引处理的.</li> <li>在插入到复制表时改进了重复处理, 因此它们不再减慢复制队列的执行速度.</li> </ul> <h3 id=clickhouse-release-1-1-54342-2018-01-22>ClickHouse 版本 1.1.54342, 2018-01-22<a class=headerlink href=../amp/#clickhouse-release-1-1-54342-2018-01-22 title="Permanent link"> </a></h3> <p>此版本包含先前版本 1.1.54337 的错误修复:</p> <ul> <li>修复了 1.1.54337 中的回归: 如果默认用户具有只读访问权限, 则服务器拒绝启动并显示消息 <code class=syntax>Cannot create database in readonly mode</code>.</li> <li>修复了 1.1.54337 中的一个回归: 在具有 systemd 的系统上, 无论配置如何, 日志始终写入 syslog; 监视器脚本仍然使用 init.d.</li> <li>修复了 1.1.54337 中的回归: Docker 镜像中的默认配置错误.</li> <li>修复了 Graphite MergeTree 的非确定性行为 (您可以在日志消息中看到它 <code class=syntax>合并后的数据与另一个副本上的数据不是字节相同</code> ).</li> <li>修复了对复制表进行 OPTIMIZE 查询后可能导致合并不一致的错误 (您可能会在日志消息中看到它 <code class=syntax>Part ... intersects the previous part</code> ).</li> <li>当目标表中存在 MATERIALIZED 列时, 缓冲区表现在可以正常工作 (by zhang2014).</li> <li>修复了 NULL 实现中的一个错误.</li> </ul> <h3 id=clickhouse-release-1-1-54337-2018-01-18>ClickHouse 版本 1.1.54337, 2018-01-18<a class=headerlink href=../amp/#clickhouse-release-1-1-54337-2018-01-18 title="Permanent link"> </a></h3> <h4 id=new-features-17>新特征:<a class=headerlink href=../amp/#new-features-17 title="Permanent link"> </a></h4> <ul> <li>添加了对表中多维数组和元组 (<code class=syntax>Tuple</code> 数据类型) 的存储的支持.</li> <li>支持用于 <code class=syntax>DESCRIBE</code> 和 <code class=syntax>INSERT</code> 查询的表函数. 在 <code class=syntax>DESCRIBE</code> 中添加了对子查询的支持. 示例：<code class=syntax>DESC TABLE remote('host', default.hits)</code>; <code class=syntax>DESC 表（选择 1）</code>; <code class=syntax>插入表功能远程（'host'，default.hits）</code>. 除了 <code class=syntax>INSERT INTO</code> , 还支持 <code class=syntax>INSERT INTO TABLE</code>.</li> <li>改进了对时区的支持. <code class=syntax>DateTime</code> 数据类型可以使用用于解析和格式化文本格式的时区进行注释. 示例: <code class=syntax>DateTime('Asia/Istanbul')</code>. 当在函数中为 DateTime 参数指定时区时, 返回类型将跟踪时区, 并且值将按预期显示.</li> <li>添加了函数<code class=syntax>toTimeZone</code>、<code class=syntax>timeDiff</code>、<code class=syntax>toQuarter</code>、<code class=syntax>toRelativeQuarterNum</code>. <code class=syntax>toRelativeHour</code>/<code class=syntax>Minute</code>/<code class=syntax>Second</code> 函数可以将 <code class=syntax>Date</code> 类型的值作为参数. <code class=syntax>now</code> 函数名区分大小写.</li> <li>添加了 <code class=syntax>toStartOfFifteenMinutes</code> 函数 (Kirill Shvakov).</li> <li>添加了用于格式化查询的 <code class=syntax>clickhouse format</code> 工具.</li> <li>添加了 <code class=syntax>format_schema_path</code> 配置参数 (Marek Vavruşa). 它用于以 <code class=syntax>Cap'n Proto</code> 格式指定模式. 架构文件只能位于指定目录中.</li> <li>添加了对配置替换 (<code class=syntax>incl</code> 和 <code class=syntax>conf.d</code>) 的支持, 用于配置外部词典和模型 (Pavel Yakunin).</li> <li>添加了一个包含 <code class=syntax>system.settings</code> 表文档的列 (Kirill Shvakov).</li> <li>添加了 <code class=syntax>system.parts_columns</code> 表, 其中包含有关 <code class=syntax>MergeTree</code> 表的每个数据部分中的列大小的信息.</li> <li>添加了 <code class=syntax>system.models</code> 表, 其中包含有关已加载的 <code class=syntax>CatBoost</code> 机器学习模型的信息.</li> <li>增加了 <code class=syntax>mysql</code> 和 <code class=syntax>odbc</code> 表功能以及相应的 <code class=syntax>MySQL</code> 和 <code class=syntax>ODBC</code> 表引擎, 用于访问远程数据库. 此功能处于测试阶段.</li> <li>添加了为 <code class=syntax>groupArray</code> 聚合函数传递 <code class=syntax>AggregateFunction</code> 类型参数的可能性 (这样你就可以创建一些聚合函数的状态数组).</li> <li>删除了对聚合函数组合器的各种组合的限制. 例如, 您可以使用 <code class=syntax>avgForEachIf</code> 和 <code class=syntax>avgIfForEach</code> 聚合函数, 它们具有不同的行为.</li> <li><code class=syntax>-ForEach</code> 聚合函数组合器针对多参数聚合函数的情况进行了扩展.</li> <li>添加了对 <code class=syntax>Nullable</code> 参数的聚合函数的支持, 即使在函数返回非 <code class=syntax>Nullable</code> 结果的情况下 (由 Silviu Caragea 添加). 示例: <code class=syntax>groupArray</code>、<code class=syntax>groupUniqArray</code>、<code class=syntax>topK</code>.</li> <li>为 <code class=syntax>clickhouse-client</code> 添加了 <code class=syntax>max_client_network_bandwidth</code> (Kirill Shvakov).</li> <li>允许具有 <code class=syntax>readonly = 2</code> 设置的用户使用 TEMPORARY 表 (CREATE, DROP, INSERT…) (Kirill Shvakov).</li> <li>添加了对 <code class=syntax>Kafka</code> 引擎使用多个消费者的支持. <code class=syntax>Kafka</code> 的扩展配置选项 (Marek Vavruša).</li> <li>添加了 <code class=syntax>intExp3</code> 和 <code class=syntax>intExp4</code> 函数.</li> <li>添加了 <code class=syntax>sumKahan</code> 聚合函数.</li> <li>添加到 * Number* OrNull 函数, 其中 * Number* 是数字类型.</li> <li>添加了对 <code class=syntax>INSERT SELECT</code> 查询的 <code class=syntax>WITH</code> 子句的支持 (author: zhang2014).</li> <li>添加设置: <code class=syntax>http_connection_timeout</code>、<code class=syntax>http_send_timeout</code>、<code class=syntax>http_receive_timeout</code>. 特别是, 这些设置用于下载数据部分以进行复制. 如果网络过载, 更改这些设置可以实现更快的故障转移.</li> <li>为类型为 <code class=syntax>Null</code> 的表添加了对 <code class=syntax>ALTER</code> 的支持 (Anastasiya Tsarkova).</li> <li><code class=syntax>reinterpretAsString</code> 函数针对所有连续存储在内存中的数据类型进行了扩展.</li> <li>为 <code class=syntax>clickhouse-local</code> 工具添加了 <code class=syntax>--silent</code> 选项. 它禁止在 stderr 中打印查询执行信息.</li> <li>添加了对从文本中读取 <code class=syntax>Date</code> 类型值的支持, 该格式使用一位数而不是两位数指定月份和/或月份中的某天 (Amos Bird).</li> </ul> <h4 id=performance-optimizations>性能优化:<a class=headerlink href=../amp/#performance-optimizations title="Permanent link"> </a></h4> <ul> <li>改进了来自字符串参数的聚合函数 <code class=syntax>min</code>、<code class=syntax>max</code>、<code class=syntax>any</code>、<code class=syntax>anyLast</code>、<code class=syntax>anyHeavy</code>、<code class=syntax>argMin</code>、<code class=syntax>argMax</code> 的性能.</li> <li>改进了函数 <code class=syntax>isInfinite</code>、<code class=syntax>isFinite</code>、<code class=syntax>isNaN</code>、<code class=syntax>roundToExp2</code> 的性能.</li> <li>改进了以文本格式解析和格式化 <code class=syntax>Date</code> 和 <code class=syntax>DateTime</code> 类型值的性能.</li> <li>提高解析浮点数的性能和精度.</li> <li>在左右部分具有不包含在 <code class=syntax>USING</code> 中的名称相同的列的情况下, 降低了 <code class=syntax>JOIN</code> 的内存使用量.</li> <li>通过降低计算稳定性, 改进了聚合函数 <code class=syntax>varSamp</code>、<code class=syntax>varPop</code>、<code class=syntax>stddevSamp</code>、<code class=syntax>stddevPop</code>、<code class=syntax>covarSamp</code>、<code class=syntax>covarPop</code>、<code class=syntax>corr</code> 的性能. 旧函数可在名称 <code class=syntax>varSampStable</code>、<code class=syntax>varPopStable</code>、<code class=syntax>stddevSampStable</code>、<code class=syntax>stddevPopStable</code>、<code class=syntax>covarSampStable</code>、<code class=syntax>covarPopStable</code>、<code class=syntax>corrStable</code> 下使用.</li> </ul> <h4 id=bug-fixes-28>Bug 修复:<a class=headerlink href=../amp/#bug-fixes-28 title="Permanent link"> </a></h4> <ul> <li>在运行 <code class=syntax>DROP</code> 或 <code class=syntax>DETACH PARTITION</code> 查询后修复了重复数据删除. 在以前的版本中, 删除分区并再次插入相同的数据不起作用, 因为插入的块被认为是重复的.</li> <li>修复了一个错误, 该错误可能导致对带有 <code class=syntax>POPULATE</code> 的 <code class=syntax>CREATE MATERIALIZED VIEW</code> 查询的 <code class=syntax>WHERE</code> 子句的错误解释.</li> <li>修复了在 <code class=syntax>zookeeper_servers</code> 配置中使用 <code class=syntax>root_path</code> 参数的错误.</li> <li>修复了将 <code class=syntax>Date</code> 参数传递给 <code class=syntax>toStartOfDay</code> 的意外结果.</li> <li>修复了 <code class=syntax>addMonths</code> 和 <code class=syntax>subtractMonths</code> 函数以及 <code class=syntax>INTERVAL n MONTH</code> 在结果为上一年的情况下的算术.</li> <li>为 <code class=syntax>DISTINCT</code>、<code class=syntax>JOIN</code> 和 <code class=syntax>uniq</code> 聚合函数和外部词典 (Evgeniy Ivanov) 添加了对 <code class=syntax>UUID</code> 数据类型的缺失支持. 对 <code class=syntax>UUID</code> 的支持仍然不完整.</li> <li>在行总和为零的情况下修复了 <code class=syntax>SummingMergeTree</code> 行为.</li> <li>对<code class=syntax>Kafka</code> 引擎的各种修复 (Marek Vavruša).</li> <li>修复了 <code class=syntax>Join</code> 表引擎的错误行为 (Amos Bird).</li> <li>修复了 FreeBSD 和 OS X 下不正确的分配器行为.</li> <li><code class=syntax>extractAll</code> 函数现在支持空匹配.</li> <li>修复了阻止使用 <code class=syntax>libressl</code> 而不是 <code class=syntax>openssl</code> 的错误.</li> <li>修复了来自临时表的 <code class=syntax>CREATE TABLE AS SELECT</code> 查询.</li> <li>修复了更新复制队列的非原子性. 这可能会导致副本不同步, 直到服务器重新启动.</li> <li>修复了 <code class=syntax>gcd</code>、<code class=syntax>lcm</code> 和 <code class=syntax>modulo</code> (<code class=syntax>%</code> 运算符) 中可能出现的溢出 (Maks Skorokhod).</li> <li><code class=syntax>-preprocessed</code> 文件现在在更改 <code class=syntax>umask</code> 后创建 (<code class=syntax>umask</code> 可以在配置中更改).</li> <li>修复了使用自定义分区键时部件背景检查 (<code class=syntax>MergeTreePartChecker</code>) 的错误.</li> <li>修复了文本格式元组 ( <code class=syntax>Tuple</code> 数据类型的值) 的解析.</li> <li>改进了有关传递给 <code class=syntax>multiIf</code>、<code class=syntax>array</code> 和一些其他函数的不兼容类型的错误消息.</li> <li>重新设计了对 <code class=syntax>Nullable</code> 类型的支持. 修复了可能导致服务器崩溃的错误. 修复了几乎所有与 <code class=syntax>NULL</code> 支持相关的其他错误: INSERT SELECT 中的类型转换不正确、HAVING 和 PREWHERE 中对 Nullable 的支持不足、<code class=syntax>join_use_nulls</code> 模式、可空类型作为 <code class=syntax>OR</code> 运算符的参数等.</li> <li>修复了与数据类型的内部语义相关的各种错误. 示例: 在 <code class=syntax>SummingMergeTree</code> 中对 <code class=syntax>Enum</code> 类型字段进行不必要的求和; <code class=syntax>Pretty</code> 格式的 <code class=syntax>Enum</code> 类型的对齐等.</li> <li>更严格地检查允许的复合列组合.</li> <li>修复了为 <code class=syntax>FixedString</code> 数据类型指定一个非常大的参数时的溢出问题.</li> <li>修复了一般情况下 <code class=syntax>topK</code> 聚合函数中的错误.</li> <li>使用 <code class=syntax>-Array</code> 组合器在聚合函数的n元变体的参数中添加了对数组大小相等性的缺失检查.</li> <li>修复了 <code class=syntax>clickhouse-client</code> 的 <code class=syntax>--pager</code> 中的错误 (author: ks1322).</li> <li>修复了 <code class=syntax>exp10</code> 函数的精度.</li> <li>修复了<code class=syntax>visitParamExtract</code> 函数的行为, 以便更好地遵守文档.</li> <li>修复了指定错误数据类型时崩溃的问题.</li> <li>修复了所有列都是常量的情况下 <code class=syntax>DISTINCT</code> 的行为.</li> <li>修复了在使用带有复杂常量表达式的 <code class=syntax>tupleElement</code> 函数作为元组元素索引的情况下的查询格式.</li> <li>修复了 <code class=syntax>range_hashed</code> 字典的 <code class=syntax>Dictionary</code> 表中的错误.</li> <li>修复了导致 <code class=syntax>FULL</code> 和 <code class=syntax>RIGHT JOIN</code> 结果中行数过多的错误 (Amos Bird).</li> <li>修复了在配置重新加载期间在 <code class=syntax>config.d</code> 目录中创建和删除临时文件时服务器崩溃的问题.</li> <li>修复了 <code class=syntax>SYSTEM DROP DNS CACHE</code> 查询: 缓存已刷新但集群节点的地址未更新.</li> <li>修复了对视图下的表执行 <code class=syntax>DETACH TABLE</code> 后 <code class=syntax>MATERIALIZED VIEW</code> 的行为 (Marek Vavruša).</li> </ul> <h4 id=build-improvements-4>Build 改进:<a class=headerlink href=../amp/#build-improvements-4 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>pbuilder</code> 工具用于构建. 构建过程几乎完全独立于构建宿主环境.</li> <li>单个构建用于不同的操作系统版本. 软件包和二进制文件已与各种 Linux 系统兼容.</li> <li>添加了 <code class=syntax>clickhouse-test</code> 包. 它可用于运行功能测试.</li> <li>源 tarball 现在可以发布到存储库. 它可用于在不使用 GitHub 的情况下重现构建.</li> <li>添加了与 Travis CI 的有限集成. 由于 Travis 中构建时间的限制, 仅测试调试构建并运行有限的测试子集.</li> <li>在默认版本中添加了对 <code class=syntax>Cap'n'Proto</code> 的支持.</li> <li>将文档来源的格式从 <code class=syntax>Restricted Text</code> 更改为 <code class=syntax>Markdown</code>.</li> <li>添加了对 <code class=syntax>systemd</code> (Vladimir Smirnov) 的支持. 由于与某些操作系统映像不兼容, 它默认被禁用, 可以手动启用.</li> <li>对于动态代码生成, <code class=syntax>clang</code> 和 <code class=syntax>lld</code> 被嵌入到 <code class=syntax>clickhouse</code> 二进制文件中. 它们也可以作为 <code class=syntax>clickhouse clang</code> 和 <code class=syntax>clickhouse lld</code> 调用.</li> <li>从代码中删除了 GNU 扩展的使用. 启用了<code class=syntax>-Wextra</code> 选项。 当使用 <code class=syntax>clang</code> 构建时, 默认是 <code class=syntax>libc++</code> 而不是 <code class=syntax>libstdc++</code>.</li> <li>提取了 <code class=syntax>clickhouse_parsers</code> 和 <code class=syntax>clickhouse_common_io</code> 库以加速各种工具的构建.</li> </ul> <h4 id=backward-incompatible-changes-11>向后不兼容的更新:<a class=headerlink href=../amp/#backward-incompatible-changes-11 title="Permanent link"> </a></h4> <ul> <li>包含 <code class=syntax>Nullable</code> 列的 <code class=syntax>Log</code> 类型表中标记的格式以向后不兼容的方式进行了更改. 如果你有这些表, 你应该在启动新的服务器版本之前将它们转换为 <code class=syntax>TinyLog</code> 类型. 为此, 请在 <code class=syntax>metadata</code> 目录中相应的 <code class=syntax>.sql</code> 文件中将 <code class=syntax>ENGINE = Log</code> 替换为 <code class=syntax>ENGINE = TinyLog</code>. 如果你的表没有 <code class=syntax>Nullable</code> 列或者你的表的类型不是 <code class=syntax>Log</code>, 那么你不需要做任何事情.</li> <li>删除了 <code class=syntax>experimental_allow_extended_storage_definition_syntax</code> 设置. 现在默认启用此功能.</li> <li><code class=syntax>runningIncome</code> 函数被重命名为 <code class=syntax>runningDifferenceStartingWithFirstvalue</code> 以避免混淆.</li> <li>当在没有表的 FROM 之后直接指定 ARRAY JOIN 时, 删除了 <code class=syntax>FROM ARRAY JOIN arr</code> 语法 (Amos Bird).</li> <li>删除了仅用于演示目的的 <code class=syntax>BlockTabSeparated</code> 格式.</li> <li>更改了聚合函数 <code class=syntax>varSamp</code>、<code class=syntax>varPop</code>、<code class=syntax>stddevSamp</code>、<code class=syntax>stddevPop</code>、<code class=syntax>covarSamp</code>、<code class=syntax>covarPop</code>、<code class=syntax>corr</code> 的状态格式. 如果您已将这些聚合函数的状态存储在表中 (使用 <code class=syntax>AggregateFunction</code> 数据类型或具有相应状态的物化视图), 请写信至 <a href=../mailto:clickhouse-feedback@yandex-team.comamp/ >clickhouse-feedback@yandex-team.com</a>.</li> <li>在以前的服务器版本中, 有一个未公开的功能: 如果聚合函数依赖于参数, 您仍然可以在 AggregateFunction 数据类型中不带参数地指定它. 示例: <code class=syntax>AggregateFunction(quantiles, UInt64)</code> 而不是 <code class=syntax>AggregateFunction(quantiles(0.5, 0.9), UInt64)</code> . 此功能已丢失. 虽然它没有记录, 但我们计划在未来的版本中再次支持它.</li> <li>枚举数据类型不能用于最小/最大聚合函数. 此能力将在下一个版本中恢复.</li> </ul> <h4 id=please-note-when-upgrading>升级时请注意:<a class=headerlink href=../amp/#please-note-when-upgrading title="Permanent link"> </a></h4> <ul> <li>在集群上进行滚动更新时, 当一些副本运行旧版本的 ClickHouse 和一些运行新版本时, 复制会暂时停止, 并且日志中出现消息 <code class=syntax>unknown parameter 'shard'</code> . 更新集群的所有副本后, 复制将继续.</li> <li>如果在集群服务器上运行不同版本的 ClickHouse, 使用以下函数的分布式查询可能会得到不正确的结果: <code class=syntax>varSamp</code>、<code class=syntax>varPop</code>、<code class=syntax>stddevSamp</code>、<code class=syntax>stddevPop</code>、<code class=syntax>covarSamp</code>、<code class=syntax>covarPop</code> , <code class=syntax>corr</code>. 您应该更新所有集群节点.</li> </ul> <h2 id=changelog-for-2017><a href=../../2017/amp/#clickhouse-release-1-1-54327-2017-12-21>Changelog for 2017</a><a class=headerlink href=../amp/#changelog-for-2017 title="Permanent link"> </a></h2>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2022 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/38993f215f9186c1ac3505b1e09697cd9a468b5d" rel="external nofollow noreferrer" target="_blank" class="text-reset">38993f21</a>
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/zh/whats-new/changelog/2018/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
