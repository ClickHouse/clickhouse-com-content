










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="zh">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>ClickHouse 版本 19.17 | ClickHouse文档</title>
    <link rel="canonical" href="https://clickhouse.com/docs/zh/whats-new/changelog/2019/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer,header,main{display:block}body{margin:0;font-family:Noto Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}address{font-style:normal;line-height:inherit}address,ul{margin-bottom:1rem}ul{margin-top:0}ul ul{margin-bottom:0}dd{margin-bottom:.5rem;margin-left:0}b{font-weight:bolder}small{font-size:80%}a{text-decoration:none;background-color:transparent}a,a:hover{color:#ff8c00}a:hover{text-decoration:underline}a:not([href]),a:not([href]):hover{color:inherit;text-decoration:none}code{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}input,select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}input{overflow:visible}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=date],input[type=datetime-local],input[type=month],input[type=time]{-webkit-appearance:listbox}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}summary{display:list-item;cursor:pointer}template{display:none}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:Hind Siliguri,sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.small,small{font-size:80%;font-weight:400}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}.order-first{order:-1}.order-last{order:13}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}.offset-1{margin-left:8.3333333333%}.offset-2{margin-left:16.6666666667%}.offset-3{margin-left:25%}.offset-4{margin-left:33.3333333333%}.offset-5{margin-left:41.6666666667%}.offset-6{margin-left:50%}.offset-7{margin-left:58.3333333333%}.offset-8{margin-left:66.6666666667%}.offset-9{margin-left:75%}.offset-10{margin-left:83.3333333333%}.offset-11{margin-left:91.6666666667%}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}.order-md-first{order:-1}.order-md-last{order:13}.order-md-0{order:0}.order-md-1{order:1}.order-md-2{order:2}.order-md-3{order:3}.order-md-4{order:4}.order-md-5{order:5}.order-md-6{order:6}.order-md-7{order:7}.order-md-8{order:8}.order-md-9{order:9}.order-md-10{order:10}.order-md-11{order:11}.order-md-12{order:12}.offset-md-0{margin-left:0}.offset-md-1{margin-left:8.3333333333%}.offset-md-2{margin-left:16.6666666667%}.offset-md-3{margin-left:25%}.offset-md-4{margin-left:33.3333333333%}.offset-md-5{margin-left:41.6666666667%}.offset-md-6{margin-left:50%}.offset-md-7{margin-left:58.3333333333%}.offset-md-8{margin-left:66.6666666667%}.offset-md-9{margin-left:75%}.offset-md-10{margin-left:83.3333333333%}.offset-md-11{margin-left:91.6666666667%}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}.order-lg-first{order:-1}.order-lg-last{order:13}.order-lg-0{order:0}.order-lg-1{order:1}.order-lg-2{order:2}.order-lg-3{order:3}.order-lg-4{order:4}.order-lg-5{order:5}.order-lg-6{order:6}.order-lg-7{order:7}.order-lg-8{order:8}.order-lg-9{order:9}.order-lg-10{order:10}.order-lg-11{order:11}.order-lg-12{order:12}.offset-lg-0{margin-left:0}.offset-lg-1{margin-left:8.3333333333%}.offset-lg-2{margin-left:16.6666666667%}.offset-lg-3{margin-left:25%}.offset-lg-4{margin-left:33.3333333333%}.offset-lg-5{margin-left:41.6666666667%}.offset-lg-6{margin-left:50%}.offset-lg-7{margin-left:58.3333333333%}.offset-lg-8{margin-left:66.6666666667%}.offset-lg-9{margin-left:75%}.offset-lg-10{margin-left:83.3333333333%}.offset-lg-11{margin-left:91.6666666667%}}.table{width:100%;margin-bottom:8px;color:#212529}.table-primary{background-color:#fff1b8}.table-warning{background-color:#ffeeba}.table-light{background-color:#fbfcfd}.table-dark{background-color:#ccced0}.table-primary-light{background-color:#fffefb}.table-white{background-color:#fff}.table-black{background-color:#c1c2c3}.table-orange{background-color:#ffdfb8}.table-light-orange{background-color:#fff7ea}.table-dark{color:#fff;background-color:#343a40}.invalid-feedback{display:none;width:100%;margin-top:.25rem;font-size:80%;color:#dc3545}.is-invalid~.invalid-feedback{display:block}.custom-select.is-invalid{border-color:#dc3545;padding-right:calc(.75em+2.3125rem);background:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px,url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545'%3E%3Ccircle cx='6' cy='6' r='4.5'/%3E%3Cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3E%3Ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3E%3C/svg%3E") #fff no-repeat center right 1.75rem/calc(.75em+.375rem) calc(.75em+.375rem)}.custom-select.is-invalid:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-primary{color:#495057;background-color:#fc0;border-color:#fc0}.btn-primary:focus,.btn-primary:hover{color:#495057;background-color:#d9ad00;border-color:#cca300}.btn-primary:focus{box-shadow:0 0 0 0 rgba(228,185,13,.5)}.btn-primary:disabled{color:#495057;background-color:#fc0;border-color:#fc0}.btn-warning{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-warning:focus,.btn-warning:hover{color:#495057;background-color:#e0a800;border-color:#d39e00}.btn-warning:focus{box-shadow:0 0 0 0 rgba(228,176,19,.5)}.btn-warning:disabled{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:focus,.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:focus,.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-primary-light{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-primary-light:focus,.btn-primary-light:hover{color:#495057;background-color:#ffedca;border-color:#ffe9bd}.btn-primary-light:focus{box-shadow:0 0 0 0 rgba(228,225,217,.5)}.btn-primary-light:disabled{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:focus,.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:focus,.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:focus,.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:focus,.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-primary{color:#fc0;border-color:#fc0}.btn-outline-primary:hover{color:#495057;background-color:#fc0;border-color:#fc0}.btn-outline-primary:focus{box-shadow:0 0 0 0 rgba(255,204,0,.5)}.btn-outline-primary:disabled{color:#fc0;background-color:transparent}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:focus{box-shadow:0 0 0 0 rgba(255,193,7,.5)}.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-primary-light{color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:hover{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:focus{box-shadow:0 0 0 0 rgba(255,250,240,.5)}.btn-outline-primary-light:disabled{color:#fffaf0;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 hsla(0,0%,100%,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.btn-group{position:relative;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group{position:relative;display:flex;flex-wrap:wrap;align-items:stretch;width:100%}.input-group>.custom-file,.input-group>.custom-select{position:relative;flex:1 1 0;min-width:0;margin-bottom:0}.input-group>.custom-file+.custom-file,.input-group>.custom-file+.custom-select,.input-group>.custom-select+.custom-file,.input-group>.custom-select+.custom-select{margin-left:-1px}.input-group>.custom-select:focus{z-index:3}.input-group>.custom-file .custom-file-input:focus{z-index:4}.input-group>.custom-select:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.custom-select:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group>.custom-file{display:flex;align-items:center}.input-group-text{display:flex;align-items:center;padding:.375rem .75rem;margin-bottom:0;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;text-align:center;white-space:nowrap;background-color:#e9ecef;border:1px solid #ced4da;border-radius:8px}.input-group-text input[type=checkbox],.input-group-text input[type=radio]{margin-top:0}.input-group-lg>.custom-select{height:calc(1.5em+1rem+2px)}.input-group-lg>.custom-select{padding:.5rem 1rem;font-size:1.125rem;line-height:1.5;border-radius:8px}.input-group-lg>.custom-select{padding-right:1.75rem}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-file{display:inline-block;margin-bottom:0}.custom-file,.custom-file-input{position:relative;width:100%;height:calc(1.5em+.75rem+2px)}.custom-file-input{z-index:2;margin:0;opacity:0}.custom-range{width:100%;height:1.4rem;padding:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-range:focus{outline:0}.custom-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-moz-range-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-ms-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range::-moz-focus-outer{border:0}.custom-range::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:#fc0;border:0;border-radius:1rem;-webkit-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-webkit-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-webkit-slider-thumb{-webkit-transition:none;transition:none}}.custom-range::-webkit-slider-thumb:active{background-color:#fff0b3}.custom-range::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-moz-range-thumb{width:1rem;height:1rem;background-color:#fc0;border:0;border-radius:1rem;-moz-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-moz-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-moz-range-thumb{-moz-transition:none;transition:none}}.custom-range::-moz-range-thumb:active{background-color:#fff0b3}.custom-range::-moz-range-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-ms-thumb{width:1rem;height:1rem;margin-top:0;margin-right:.2rem;margin-left:.2rem;background-color:#fc0;border:0;border-radius:1rem;-ms-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-ms-thumb{-ms-transition:none;transition:none}}.custom-range::-ms-thumb:active{background-color:#fff0b3}.custom-range::-ms-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:transparent;border-color:transparent;border-width:.5rem}.custom-range::-ms-fill-lower,.custom-range::-ms-fill-upper{background-color:#dee2e6;border-radius:1rem}.custom-range::-ms-fill-upper{margin-right:15px}.custom-range:disabled::-webkit-slider-thumb{background-color:#d6dbdf}.custom-range:disabled::-webkit-slider-runnable-track{cursor:default}.custom-range:disabled::-moz-range-thumb{background-color:#d6dbdf}.custom-range:disabled::-moz-range-track{cursor:default}.custom-range:disabled::-ms-thumb{background-color:#d6dbdf}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}.container,body{min-width:980px}.table{border-collapse:collapse}.table-dark{color:inherit}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/docs/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/docs/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h2 id=clickhouse-release-v19-17>ClickHouse 版本 19.17<a class=headerlink href=../amp/#clickhouse-release-v19-17 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-v19-17-6-36-2019-12-27>ClickHouse 版本 19.17.6.36, 2019-12-27<a class=headerlink href=../amp/#clickhouse-release-v19-17-6-36-2019-12-27 title="Permanent link"> </a></h3> <h4 id=bug-fix>Bug 修复<a class=headerlink href=../amp/#bug-fix title="Permanent link"> </a></h4> <ul> <li>修复了解压缩中潜在的缓冲区溢出. 恶意用户可以传递可能导致缓冲区读取的伪造压缩数据. 这个问题是由 Yandex 信息安全团队的 Eldar Zaitov 发现的. <a href=https://github.com/ClickHouse/ClickHouse/pull/8404 rel="external nofollow noreferrer" target=_blank>#8404</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了当服务器无法使用字符串数据类型的值 (需要 UTF-8 验证) 以 JSON 或 XML 格式发送或写入数据或使用 Brotli 算法或某些方式压缩结果数据时可能出现的服务器崩溃 ( <code class=syntax>std::terminate</code> ) 其他罕见情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/8384 rel="external nofollow noreferrer" target=_blank>#8384</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了来自 clickhouse <code class=syntax>VIEW</code> 源的词典, 现在阅读此类词典不会导致错误 <code class=syntax>There is no query</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8351 rel="external nofollow noreferrer" target=_blank>#8351</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了检查 users.xml 中指定的 host_regexp 是否允许客户端主机的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/8241 rel="external nofollow noreferrer" target=_blank>#8241</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/8342 rel="external nofollow noreferrer" target=_blank>#8342</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>分布式表的 <code class=syntax>RENAME TABLE</code> 现在会在发送到分片之前重命名包含插入数据的文件夹. 这解决了连续重命名 <code class=syntax>tableA-&gt;tableB</code>、<code class=syntax>tableC-&gt;tableA</code> 的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/8306 rel="external nofollow noreferrer" target=_blank>#8306</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>由 DDL 查询创建的 <code class=syntax>range_hashed</code> 外部字典现在允许任意数字类型的范围. <a href=https://github.com/ClickHouse/ClickHouse/pull/8275 rel="external nofollow noreferrer" target=_blank>#8275</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>INSERT INTO table SELECT ... FROM mysql(...)</code> 表函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/8234 rel="external nofollow noreferrer" target=_blank>#8234</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>复了插入不存在的文件时在 <code class=syntax>INSERT INTO TABLE FUNCTION file()</code> 中的段错误. 现在在这种情况下将创建文件, 然后将处理插入. <a href=https://github.com/ClickHouse/ClickHouse/pull/8177 rel="external nofollow noreferrer" target=_blank>#8177</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>修复了聚合位图和标量位图相交时的位图和错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8082 rel="external nofollow noreferrer" target=_blank>#8082</a> (<a href=https://github.com/moon03432 rel="external nofollow noreferrer" target=_blank>Yue Huang</a>)</li> <li>修复了在没有 <code class=syntax>TABLE</code> 或 <code class=syntax>DICTIONARY</code> 限定符的情况下使用 <code class=syntax>EXISTS</code> 查询时的段错误，就像 <code class=syntax>EXISTS</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8213 rel="external nofollow noreferrer" target=_blank>#8213</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了函数 <code class=syntax>rand</code> 和 <code class=syntax>randConstant</code> 在参数可为空的情况下的返回类型. 现在函数总是返回 <code class=syntax>UInt32</code> 而不是 <code class=syntax>Nullable(UInt32)</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8204 rel="external nofollow noreferrer" target=_blank>#8204</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了 <code class=syntax>DROP DICTIONARY IF EXISTS db.dict</code>, 现在如果 <code class=syntax>db</code> 不存在则不会抛出异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/8185 rel="external nofollow noreferrer" target=_blank>#8185</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>如果由于服务器崩溃而没有完全删除表, 服务器将尝试恢复并加载它. <a href=https://github.com/ClickHouse/ClickHouse/pull/8176 rel="external nofollow noreferrer" target=_blank>#8176</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>如果有两个以上的分片本地表，则修复了分布式表的简单计数查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/8164 rel="external nofollow noreferrer" target=_blank>#8164</a> (<a href=https://github.com/nicelulu rel="external nofollow noreferrer" target=_blank>小路</a>)</li> <li>修复了导致 DB::BlockStreamProfileInfo::calculateRowsBeforeLimit() 中数据竞争的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8143 rel="external nofollow noreferrer" target=_blank>#8143</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>修复了在合并指定部分后立即执行的 <code class=syntax>ALTER table MOVE part</code>, 这可能导致移动指定部分合并到的部分. 现在它正确地移动了指定的部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/8104 rel="external nofollow noreferrer" target=_blank>#8104</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>现在可以将字典的表达式指定为字符串. 这对于从非 ClickHouse 源中提取数据时计算属性很有用, 因为它允许对这些表达式使用非 ClickHouse 语法. <a href=https://github.com/ClickHouse/ClickHouse/pull/8098 rel="external nofollow noreferrer" target=_blank>#8098</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>clickhouse-copier</code> 中由于 ZXid 溢出而导致的非常罕见的竞争. <a href=https://github.com/ClickHouse/ClickHouse/pull/8088 rel="external nofollow noreferrer" target=_blank>#8088</a> (<a href=https://github.com/dingxiangfei2009 rel="external nofollow noreferrer" target=_blank>Ding Xiang Fei</a>)</li> <li>修复了查询失败后 (例如由于"Too many simultaneous queries") 不会读取外部表信息的错误, 并且下一个请求会将此信息解释为下一个查询的开始, 从而导致 <code class=syntax>Unknown packet from client</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8084 rel="external nofollow noreferrer" target=_blank>#8084</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>避免在"Unknown packet X from server"之后取消引用. <a href=https://github.com/ClickHouse/ClickHouse/pull/8071 rel="external nofollow noreferrer" target=_blank>#8071</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>恢复对所有 ICU 语言环境的支持, 添加为常量表达式应用排序规则的功能, 并将语言名称添加到 system.collations 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/8051 rel="external nofollow noreferrer" target=_blank>#8051</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>从 <code class=syntax>StorageFile</code> 和 <code class=syntax>StorageHDFS</code> 读取的流数量现在受到限制, 以避免超过内存限制. <a href=https://github.com/ClickHouse/ClickHouse/pull/7981 rel="external nofollow noreferrer" target=_blank>#7981</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了没有键的 <code class=syntax>*MergeTree</code> 表的 <code class=syntax>CHECK TABLE</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/7979 rel="external nofollow noreferrer" target=_blank>#7979</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>如果没有突变, 则从零件名称中删除了突变编号. 此删除改进了与旧版本的兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/8250 rel="external nofollow noreferrer" target=_blank>#8250</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复部分附属部分由于 data_version 大于表突变版本而跳过突变的 bug. <a href=https://github.com/ClickHouse/ClickHouse/pull/7812 rel="external nofollow noreferrer" target=_blank>#7812</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>允许在将零件移动到另一台设备后使用零件的冗余副本启动服务器. <a href=https://github.com/ClickHouse/ClickHouse/pull/7810 rel="external nofollow noreferrer" target=_blank>#7810</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复使用聚合函数列时可能出现的 <code class=syntax>Sizes of columns does not match</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7790 rel="external nofollow noreferrer" target=_blank>#7790</a> (<a href=https://github.com/bgranvea rel="external nofollow noreferrer" target=_blank>Boris Granveaud</a>)</li> <li>现在, 如果将 WITH TIES 与 LIMIT BY 一起使用, 则会抛出异常. 现在可以将 TOP 与 LIMIT BY 一起使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/7637 rel="external nofollow noreferrer" target=_blank>#7637</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>修复字典重新加载, 如果它有 <code class=syntax>invalidate_query</code>, 它会停止更新并且在之前的更新尝试中出现一些异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/8029 rel="external nofollow noreferrer" target=_blank>#8029</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> </ul> <h3 id=clickhouse-release-v19-17-4-11-2019-11-22>ClickHouse 版本 19.17.4.11, 2019-11-22<a class=headerlink href=../amp/#clickhouse-release-v19-17-4-11-2019-11-22 title="Permanent link"> </a></h3> <h4 id=backward-incompatible-change>向后不兼容的更新<a class=headerlink href=../amp/#backward-incompatible-change title="Permanent link"> </a></h4> <ul> <li>使用列而不是 AST 来存储标量子查询结果以获得更好的性能. 设置 <code class=syntax>enable_scalar_subquery_optimization</code> 是在 19.17 中添加的, 默认情况下启用. 在从以前的版本升级到 19.17.2 或 19.17.3 期间, 它会导致类似 <a href=https://github.com/ClickHouse/ClickHouse/issues/7851 rel="external nofollow noreferrer" target=_blank>this</a> 的错误. 此设置在 19.17.4 中默认禁用, 以便从 19.16 和更旧版本升级而不会出错. <a href=https://github.com/ClickHouse/ClickHouse/pull/7392 rel="external nofollow noreferrer" target=_blank>#7392</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> </ul> <h4 id=new-feature>新特征<a class=headerlink href=../amp/#new-feature title="Permanent link"> </a></h4> <ul> <li>添加使用 DDL 查询创建字典的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/7360 rel="external nofollow noreferrer" target=_blank>#7360</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>使 <code class=syntax>bloom_filter</code> 类型的索引支持 <code class=syntax>LowCardinality</code> 和 <code class=syntax>Nullable</code>. <a href=https://github.com/ClickHouse/ClickHouse/issues/7363 rel="external nofollow noreferrer" target=_blank>#7363</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7561 rel="external nofollow noreferrer" target=_blank>#7561</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>添加函数 <code class=syntax>isValidJSON</code> 以检查传递的字符串是否是有效的 json. <a href=https://github.com/ClickHouse/ClickHouse/issues/5910 rel="external nofollow noreferrer" target=_blank>#5910</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7293 rel="external nofollow noreferrer" target=_blank>#7293</a> (<a href=https://github.com/Vdimir rel="external nofollow noreferrer" target=_blank>Vdimir</a>)</li> <li>实现 <code class=syntax>arrayCompact</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/7328 rel="external nofollow noreferrer" target=_blank>#7328</a> (<a href=https://github.com/Joeywzr rel="external nofollow noreferrer" target=_blank>Memo</a>)</li> <li>为十进制数创建函数 <code class=syntax>hex</code> . 它的工作原理类似于 <code class=syntax>hex(reinterpretAsString())</code>, 但不会删除最后的零字节. <a href=https://github.com/ClickHouse/ClickHouse/pull/7355 rel="external nofollow noreferrer" target=_blank>#7355</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>添加 <code class=syntax>arrayFill</code> 和 <code class=syntax>arrayReverseFill</code> 函数, 将元素替换为数组前/后的其他元素. <a href=https://github.com/ClickHouse/ClickHouse/pull/7380 rel="external nofollow noreferrer" target=_blank>#7380</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>添加 <code class=syntax>CRC32IEEE()</code> / <code class=syntax>CRC64()</code> 支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/7480 rel="external nofollow noreferrer" target=_blank>#7480</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>实现类似于 in 的 <code class=syntax>char</code> 函数. <a href=https://dev.mysql.com/doc/refman/8.0/en/string-functions.html#function_char rel="external nofollow noreferrer" target=_blank>mysql</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7486 rel="external nofollow noreferrer" target=_blank>#7486</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>)</li> <li>添加 <code class=syntax>bitmapTransform</code> 函数. 它将位图中的一组值转换为另一个值数组, 结果是一个新的位图. <a href=https://github.com/ClickHouse/ClickHouse/pull/7598 rel="external nofollow noreferrer" target=_blank>#7598</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>实现了<code class=syntax>javaHashUTF16LE()</code>函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/7651 rel="external nofollow noreferrer" target=_blank>#7651</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li> <li>为分布式引擎添加 <code class=syntax>_shard_num</code> 虚拟列. <a href=https://github.com/ClickHouse/ClickHouse/pull/7624 rel="external nofollow noreferrer" target=_blank>#7624</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> </ul> <h4 id=experimental-feature>实验功能<a class=headerlink href=../amp/#experimental-feature title="Permanent link"> </a></h4> <ul> <li>支持 <code class=syntax>MergeTree</code> 中的处理器 (新的查询执行管道). <a href=https://github.com/ClickHouse/ClickHouse/pull/7181 rel="external nofollow noreferrer" target=_blank>#7181</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> </ul> <h4 id=bug-fix-1>Bug 修复<a class=headerlink href=../amp/#bug-fix-1 title="Permanent link"> </a></h4> <ul> <li>修复 <code class=syntax>Values</code> 中不正确的浮点解析. <a href=https://github.com/ClickHouse/ClickHouse/issues/7817 rel="external nofollow noreferrer" target=_blank>#7817</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7870 rel="external nofollow noreferrer" target=_blank>#7870</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复启用 trace_log 时可能发生的罕见死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/7838 rel="external nofollow noreferrer" target=_blank>#7838</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>生成 Kafka 表时防止消息重复, 其中有任何 MV 从中选择. <a href=https://github.com/ClickHouse/ClickHouse/pull/7265 rel="external nofollow noreferrer" target=_blank>#7265</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>支持 <code class=syntax>IN</code> 中的 <code class=syntax>Array(LowCardinality(Nullable(String)))</code>. 解决 <a href=https://github.com/ClickHouse/ClickHouse/issues/7364 rel="external nofollow noreferrer" target=_blank>#7364</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7366 rel="external nofollow noreferrer" target=_blank>#7366</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li> <li>在 <code class=syntax>SQL BIGINT</code> 中添加对 <code class=syntax>SQL TINYINT</code> 的处理, 并在 ODBC Bridge 中修复对 <code class=syntax>SQL_FLOAT</code> 数据源类型的处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/7491 rel="external nofollow noreferrer" target=_blank>#7491</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>)</li> <li>修复空十进制列上的聚合( <code class=syntax>avg</code> 和分位数). <a href=https://github.com/ClickHouse/ClickHouse/pull/7431 rel="external nofollow noreferrer" target=_blank>#7431</a> (<a href=https://github.com/akonyaev90 rel="external nofollow noreferrer" target=_blank>Andrey Konyaev</a>)</li> <li>将 <code class=syntax>INSERT</code> 修复为 Distributed with <code class=syntax>MATERIALIZED</code> 列. <a href=https://github.com/ClickHouse/ClickHouse/pull/7377 rel="external nofollow noreferrer" target=_blank>#7377</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>如果分区的某些部分已经在目标磁盘或卷上, 则使 <code class=syntax>MOVE PARTITION</code> 工作. <a href=https://github.com/ClickHouse/ClickHouse/pull/7434 rel="external nofollow noreferrer" target=_blank>#7434</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复了在多磁盘配置中 <code class=syntax>ReplicatedMergeTree</code> 中的突变期间无法创建硬链接的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7558 rel="external nofollow noreferrer" target=_blank>#7558</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复了当整个部分保持不变并且在另一个磁盘上找到最佳空间时 MergeTree 上发生突变的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7602 rel="external nofollow noreferrer" target=_blank>#7602</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复了未从磁盘配置中读取 <code class=syntax>keep_free_space_ratio</code> 的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7645 rel="external nofollow noreferrer" target=_blank>#7645</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复表中仅包含 <code class=syntax>Tuple</code> 列或具有复杂路径的列的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7541 rel="external nofollow noreferrer" target=_blank>7541</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7545 rel="external nofollow noreferrer" target=_blank>#7545</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>在 max_memory_usage 限制中不考虑 Buffer 引擎的内存. <a href=https://github.com/ClickHouse/ClickHouse/pull/7552 rel="external nofollow noreferrer" target=_blank>#7552</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复由 <code class=syntax>tuple()</code> 排序的 <code class=syntax>MergeTree</code> 表中的最终标记使用. 在极少数情况下, 它可能会在选择时导致 <code class=syntax>Can't adjust last granule</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7639 rel="external nofollow noreferrer" target=_blank>#7639</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复具有需要上下文的操作 (例如 json 的函数) 的谓词的突变中的错误, 这可能导致崩溃或奇怪的异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/7664 rel="external nofollow noreferrer" target=_blank>#7664</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复在 <code class=syntax>data/</code> 和 <code class=syntax>shadow/</code> 目录中转义的数据库和表名的不匹配. <a href=https://github.com/ClickHouse/ClickHouse/pull/7575 rel="external nofollow noreferrer" target=_blank>#7575</a> (<a href=https://github.com/Alex-Burmak rel="external nofollow noreferrer" target=_blank>Alexander Burmak</a>)</li> <li>支持 RIGHT|FULL JOIN 中的重复键, 例如 <code class=syntax>ON t.x = u.x AND t.x = u.y</code>. 在这种情况下修复崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/7586 rel="external nofollow noreferrer" target=_blank>#7586</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>使用 RIGHT 或 FULL JOIN 连接表达式时, 修复 <code class=syntax>Not found column &lt;expression&gt; in block</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/7641 rel="external nofollow noreferrer" target=_blank>#7641</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>再次尝试以 <code class=syntax>PrettySpace</code> format 格式修复无限循环. <a href=https://github.com/ClickHouse/ClickHouse/pull/7591 rel="external nofollow noreferrer" target=_blank>#7591</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>当所有参数都是相同大小的 <code class=syntax>FixedString</code> 时, 修复 <code class=syntax>concat</code> 函数中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7635 rel="external nofollow noreferrer" target=_blank>#7635</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了在定义 S3、URL 和 HDFS 存储时使用 1 个参数的异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/7618 rel="external nofollow noreferrer" target=_blank>#7618</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复带有查询的视图的 InterpreterSelectQuery 的范围. <a href=https://github.com/ClickHouse/ClickHouse/pull/7601 rel="external nofollow noreferrer" target=_blank>#7601</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> </ul> <h4 id=improvement>改进<a class=headerlink href=../amp/#improvement title="Permanent link"> </a></h4> <ul> <li><code class=syntax>Nullable</code> 列识别和 NULL 值由 ODBC 桥正确处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/7402 rel="external nofollow noreferrer" target=_blank>#7402</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>以原子方式写入分布式发送的当前批次. <a href=https://github.com/ClickHouse/ClickHouse/pull/7600 rel="external nofollow noreferrer" target=_blank>#7600</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>如果我们无法在查询中检测到列名的表, 则抛出异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/7358 rel="external nofollow noreferrer" target=_blank>#7358</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>将 <code class=syntax>merge_max_block_size</code> 设置添加到 <code class=syntax>MergeTreeSettings</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7412 rel="external nofollow noreferrer" target=_blank>#7412</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>带有 <code class=syntax>HAVING</code> 和不带 <code class=syntax>GROUP BY</code> 的查询假定按常量分组. 所以, <code class=syntax>SELECT 1 HAVING 1</code> 现在返回一个结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/7496 rel="external nofollow noreferrer" target=_blank>#7496</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>支持将 <code class=syntax>(X,)</code> 解析为类似于python的元组. <a href=https://github.com/ClickHouse/ClickHouse/pull/7501 rel="external nofollow noreferrer" target=_blank>#7501</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/7562 rel="external nofollow noreferrer" target=_blank>#7562</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>使 <code class=syntax>range</code> 函数行为几乎像 Pythonic 一样. <a href=https://github.com/ClickHouse/ClickHouse/pull/7518 rel="external nofollow noreferrer" target=_blank>#7518</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>)</li> <li>将 <code class=syntax>constraints</code> 列添加到表 <code class=syntax>system.settings</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7553 rel="external nofollow noreferrer" target=_blank>#7553</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>更好的 tcp 处理程序的 Null 格式，以便可以通过 clickhouse-client 使用 <code class=syntax>select ignore(&lt;expression&gt;) from table format Null</code> 进行性能测量. <a href=https://github.com/ClickHouse/ClickHouse/pull/7606 rel="external nofollow noreferrer" target=_blank>#7606</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>像 <code class=syntax>CREATE TABLE ... AS (SELECT (1, 2))</code> 这样的查询被正确解析. <a href=https://github.com/ClickHouse/ClickHouse/pull/7542 rel="external nofollow noreferrer" target=_blank>#7542</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> </ul> <h4 id=performance-improvement>性能改进<a class=headerlink href=../amp/#performance-improvement title="Permanent link"> </a></h4> <ul> <li>改进了对短字符串键的聚合性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/6243 rel="external nofollow noreferrer" target=_blank>#6243</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>, <a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>在折叠常量谓词后运行另一遍语法/表达式分析以获得潜在的优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/7497 rel="external nofollow noreferrer" target=_blank>#7497</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>使用存储元信息来评估琐碎的 <code class=syntax>SELECT count() FROM table;</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7510 rel="external nofollow noreferrer" target=_blank>#7510</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>, <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>矢量化处理 <code class=syntax>arrayReduce</code> 类似于聚合器 <code class=syntax>addBatch</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7608 rel="external nofollow noreferrer" target=_blank>#7608</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li><code class=syntax>Kafka</code> 消费性能的小幅改进. <a href=https://github.com/ClickHouse/ClickHouse/pull/7475 rel="external nofollow noreferrer" target=_blank>#7475</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement title="Permanent link"> </a></h4> <ul> <li>添加对 CPU 架构 AARCH64 的交叉编译支持. 重构打包脚本. <a href=https://github.com/ClickHouse/ClickHouse/pull/7370 rel="external nofollow noreferrer" target=_blank>#7370</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7539 rel="external nofollow noreferrer" target=_blank>#7539</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>构建软件包时, 将 darwin-x86_64 和 linux-aarch64 工具链解压到已安装的 Docker 卷中. <a href=https://github.com/ClickHouse/ClickHouse/pull/7534 rel="external nofollow noreferrer" target=_blank>#7534</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>更新二进制打包器的 Docker 镜像. <a href=https://github.com/ClickHouse/ClickHouse/pull/7474 rel="external nofollow noreferrer" target=_blank>#7474</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复了 MacOS Catalina 上的编译错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7585 rel="external nofollow noreferrer" target=_blank>#7585</a> (<a href=https://github.com/ernestp rel="external nofollow noreferrer" target=_blank>Ernest Poletaev</a>)</li> <li>查询分析逻辑中的一些重构: 将复杂的类拆分成几个简单的类. <a href=https://github.com/ClickHouse/ClickHouse/pull/7454 rel="external nofollow noreferrer" target=_blank>#7454</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复没有子模块的构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/7295 rel="external nofollow noreferrer" target=_blank>#7295</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>CMake 文件中更好的 <code class=syntax>add_globs</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7418 rel="external nofollow noreferrer" target=_blank>#7418</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>删除 <code class=syntax>unwind</code> 目标中的硬编码路径. <a href=https://github.com/ClickHouse/ClickHouse/pull/7460 rel="external nofollow noreferrer" target=_blank>#7460</a> (<a href=https://github.com/podshumok rel="external nofollow noreferrer" target=_blank>Konstantin Podshumok</a>)</li> <li>允许使用没有 ssl 的 mysql 格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/7524 rel="external nofollow noreferrer" target=_blank>#7524</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h4 id=other>其他<a class=headerlink href=../amp/#other title="Permanent link"> </a></h4> <ul> <li>为 ClickHouse SQL 方言添加了 ANTLR4 语法. <a href=https://github.com/ClickHouse/ClickHouse/issues/7595 rel="external nofollow noreferrer" target=_blank>#7595</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7596 rel="external nofollow noreferrer" target=_blank>#7596</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h2 id=clickhouse-release-v19-16>ClickHouse 版本 19.16<a class=headerlink href=../amp/#clickhouse-release-v19-16 title="Permanent link"> </a></h2> <h4 id=clickhouse-release-v19-16-14-65-2020-03-25>ClickHouse 版本 19.16.14.65, 2020-03-25<a class=headerlink href=../amp/#clickhouse-release-v19-16-14-65-2020-03-25 title="Permanent link"> </a></h4> <ul> <li>修复了多个参数 (超过 10 个) 的三元逻辑 OP 的批量计算中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8718 rel="external nofollow noreferrer" target=_blank>#8718</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>) This bugfix was backported to version 19.16 by a special request from Altinity.</li> </ul> <h4 id=clickhouse-release-v19-16-14-65-2020-03-05>ClickHouse 版本 19.16.14.65, 2020-03-05<a class=headerlink href=../amp/#clickhouse-release-v19-16-14-65-2020-03-05 title="Permanent link"> </a></h4> <ul> <li>修复分布式子查询与旧 CH 版本不兼容的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7851 rel="external nofollow noreferrer" target=_blank>#7851</a> <a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>(tabplubix)</a></li> <li>执行 <code class=syntax>CREATE</code> 查询时, 在存储引擎参数中折叠常量表达式. 用当前数据库替换空数据库名称. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6508 rel="external nofollow noreferrer" target=_blank>#6508</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/3492 rel="external nofollow noreferrer" target=_blank>#3492</a>. 还修复了 <code class=syntax>ClickHouseDictionarySource</code> 中本地地址的检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/9262 rel="external nofollow noreferrer" target=_blank>#9262</a> <a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>(tabplubix)</a></li> <li>现在 <code class=syntax>*MergeTree</code> 表引擎族中的后台合并更准确地保留存储策略卷顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/8549 rel="external nofollow noreferrer" target=_blank>#8549</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>在读取后缀之后但提交之前发生异常时, 在极少数情况下防止在 <code class=syntax>Kafka</code> 中丢失数据. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9378 rel="external nofollow noreferrer" target=_blank>#9378</a>. 相关的: <a href=https://github.com/ClickHouse/ClickHouse/issues/7175 rel="external nofollow noreferrer" target=_blank>#7175</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9507 rel="external nofollow noreferrer" target=_blank>#9507</a> <a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>(filimonov)</a></li> <li>修复在尝试使用/删除使用错误参数创建的 <code class=syntax>Kafka</code> 表时导致服务器终止的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9494 rel="external nofollow noreferrer" target=_blank>#9494</a>. Incorporates <a href=https://github.com/ClickHouse/ClickHouse/issues/9507 rel="external nofollow noreferrer" target=_blank>#9507</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9513 rel="external nofollow noreferrer" target=_blank>#9513</a> <a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>(filimonov)</a></li> <li>允许将 <code class=syntax>MaterializedView</code> 与 <code class=syntax>Kafka</code> 表上方的子查询一起使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/8197 rel="external nofollow noreferrer" target=_blank>#8197</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> </ul> <h4 id=new-feature-1>新特征<a class=headerlink href=../amp/#new-feature-1 title="Permanent link"> </a></h4> <ul> <li>添加 <code class=syntax>deduplicate_blocks_in_dependent_materialized_views</code> 选项以控制幂等插入到具有物化视图的表中的行为. 应 Altinity 的特殊要求, 此新功能已添加到错误修复版本中. <a href=https://github.com/ClickHouse/ClickHouse/pull/9070 rel="external nofollow noreferrer" target=_blank>#9070</a> <a href=https://github.com/urykhy rel="external nofollow noreferrer" target=_blank>(urykhy)</a></li> </ul> <h3 id=clickhouse-release-v19-16-2-2-2019-10-30>ClickHouse 版本 19.16.2.2, 2019-10-30<a class=headerlink href=../amp/#clickhouse-release-v19-16-2-2-2019-10-30 title="Permanent link"> </a></h3> <h4 id=backward-incompatible-change-1>向后不兼容的更新<a class=headerlink href=../amp/#backward-incompatible-change-1 title="Permanent link"> </a></h4> <ul> <li>为 count/countIf 添加缺失的 arity 验证. <a href=https://github.com/ClickHouse/ClickHouse/issues/7095 rel="external nofollow noreferrer" target=_blank>#7095</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/7298 rel="external nofollow noreferrer" target=_blank>#7298</a> (<a href=https://github.com/Vdimir rel="external nofollow noreferrer" target=_blank>Vdimir</a>)</li> <li>删除旧的 <code class=syntax>asterisk_left_columns_only</code> 设置 (默认情况下禁用). <a href=https://github.com/ClickHouse/ClickHouse/pull/7335 rel="external nofollow noreferrer" target=_blank>#7335</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>模板数据格式的格式字符串现在在文件中指定. <a href=https://github.com/ClickHouse/ClickHouse/pull/7118 rel="external nofollow noreferrer" target=_blank>#7118</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> </ul> <h4 id=new-feature-2>新特征<a class=headerlink href=../amp/#new-feature-2 title="Permanent link"> </a></h4> <ul> <li>引入 uniqCombined64() 计算大于 UINT_MAX 的基数. <a href=https://github.com/ClickHouse/ClickHouse/pull/7213 rel="external nofollow noreferrer" target=_blank>#7213</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/7222 rel="external nofollow noreferrer" target=_blank>#7222</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>支持数组列上的布隆过滤器索引. <a href=https://github.com/ClickHouse/ClickHouse/pull/6984 rel="external nofollow noreferrer" target=_blank>#6984</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li> <li>添加一个函数 <code class=syntax>getMacro(name)</code>, 它从服务器配置中返回带有相应 <code class=syntax>&lt;macros&gt;</code> 值的字符串. <a href=https://github.com/ClickHouse/ClickHouse/pull/7240 rel="external nofollow noreferrer" target=_blank>#7240</a><br> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为基于 HTTP 源的字典设置两个配置选项: <code class=syntax>credentials</code> 和 <code class=syntax>http-headers</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7092 rel="external nofollow noreferrer" target=_blank>#7092</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>添加一个新的 ProfileEvent <code class=syntax>Merge</code> 来计算启动的后台合并的数量. <a href=https://github.com/ClickHouse/ClickHouse/pull/7093 rel="external nofollow noreferrer" target=_blank>#7093</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>添加返回完全限定域名的 fullHostName 函数. <a href=https://github.com/ClickHouse/ClickHouse/issues/7263 rel="external nofollow noreferrer" target=_blank>#7263</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7291 rel="external nofollow noreferrer" target=_blank>#7291</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>)</li> <li>添加函数 <code class=syntax>arraySplit</code> 和 <code class=syntax>arrayReverseSplit</code>, 它们通过 <code class=syntax>cut off</code> 条件拆分数组. 它们在时间序列处理中很有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/7294 rel="external nofollow noreferrer" target=_blank>#7294</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>添加返回 multiMatch 系列函数中所有匹配索引数组的新函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/7299 rel="external nofollow noreferrer" target=_blank>#7299</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>添加一个新的数据库引擎 <code class=syntax>Lazy</code>, 该引擎针对存储大量小型 -Log 表进行了优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/7171 rel="external nofollow noreferrer" target=_blank>#7171</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>为位图列添加聚合函数 groupBitmapAnd、-Or、-Xor. <a href=https://github.com/ClickHouse/ClickHouse/pull/7109 rel="external nofollow noreferrer" target=_blank>#7109</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>添加聚合函数组合子 -OrNull 和 -OrDefault，当没有聚合时返回空值或默认值. <a href=https://github.com/ClickHouse/ClickHouse/pull/7331 rel="external nofollow noreferrer" target=_blank>#7331</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>引入支持自定义转义和分隔符规则的 CustomSeparated 数据格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/7118 rel="external nofollow noreferrer" target=_blank>#7118</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>支持Redis作为外部字典的来源. <a href=https://github.com/ClickHouse/ClickHouse/pull/4361 rel="external nofollow noreferrer" target=_blank>#4361</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6962 rel="external nofollow noreferrer" target=_blank>#6962</a> (<a href=https://github.com/comunodi rel="external nofollow noreferrer" target=_blank>comunodi</a>, <a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> </ul> <h4 id=bug-fix-2>Bug 修复<a class=headerlink href=../amp/#bug-fix-2 title="Permanent link"> </a></h4> <ul> <li>修复错误的查询结果, 如果它有 <code class=syntax>WHERE IN (SELECT ...)</code> 部分并且使用了 <code class=syntax>optimize_read_in_order</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7371 rel="external nofollow noreferrer" target=_blank>#7371</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton<br> Popov</a>)</li> <li>禁用 MariaDB 身份验证插件, 该插件依赖于项目外的文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/7140 rel="external nofollow noreferrer" target=_blank>#7140</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>修复异常 <code class=syntax>Cannot convert column ... because it is constant but values of constants are different in source and result</code> , 这在函数 <code class=syntax>now()</code>、<code class=syntax>today()</code>、<code class=syntax>yesterday()</code>、 <code class=syntax>randConstant()</code> 时, 这种情况很少发生. <a href=https://github.com/ClickHouse/ClickHouse/pull/7156 rel="external nofollow noreferrer" target=_blank>#7156</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了使用 HTTP 保持活动超时而不是 TCP 保持活动超时的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/7351 rel="external nofollow noreferrer" target=_blank>#7351</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>修复了 groupBitmapOr 中的分段错误. (issue <a href=https://github.com/ClickHouse/ClickHouse/issues/7109 rel="external nofollow noreferrer" target=_blank>#7109</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/7289 rel="external nofollow noreferrer" target=_blank>#7289</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>对于物化视图，在写入所有数据后调用 Kafka 的提交. <a href=https://github.com/ClickHouse/ClickHouse/pull/7175 rel="external nofollow noreferrer" target=_blank>#7175</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复了 <code class=syntax>system.part_log</code> 表中错误的 <code class=syntax>duration_ms</code> 值. 差了十倍. <a href=https://github.com/ClickHouse/ClickHouse/pull/7172 rel="external nofollow noreferrer" target=_blank>#7172</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>解决 LIVE VIEW 表崩溃并重新启用所有 LIVE VIEW 测试的快速修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/7201 rel="external nofollow noreferrer" target=_blank>#7201</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li> <li>在 MergeTree 部分的最小/最大索引中正确序列化 NULL 值. <a href=https://github.com/ClickHouse/ClickHouse/pull/7234 rel="external nofollow noreferrer" target=_blank>#7234</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>当表创建为 <code class=syntax>CREATE TABLE AS</code> 时, 不要将虚拟列放入 .sql 元数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/7183 rel="external nofollow noreferrer" target=_blank>#7183</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复 <code class=syntax>ATTACH PART</code> 查询中的分段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7185 rel="external nofollow noreferrer" target=_blank>#7185</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复空 IN 子查询和空 INNER/RIGHT JOIN 优化给出的某些查询的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/7284 rel="external nofollow noreferrer" target=_blank>#7284</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复 LIVE VIEW getHeader() 方法中的 AddressSanitizer 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7271 rel="external nofollow noreferrer" target=_blank>#7271</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li> </ul> <h4 id=improvement-1>改进<a class=headerlink href=../amp/#improvement-1 title="Permanent link"> </a></h4> <ul> <li>在 queue_wait_max_ms 等待发生的情况下添加一条消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/7390 rel="external nofollow noreferrer" target=_blank>#7390</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>在表级设置 <code class=syntax>s3_min_upload_part_size</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/7059 rel="external nofollow noreferrer" target=_blank>#7059</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>在 StorageFactory 中检查 TTL. <a href=https://github.com/ClickHouse/ClickHouse/pull/7304 rel="external nofollow noreferrer" target=_blank>#7304</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>)</li> <li>在部分合并连接中挤压左侧块 (优化). <a href=https://github.com/ClickHouse/ClickHouse/pull/7122 rel="external nofollow noreferrer" target=_blank>#7122</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>不允许在复制表引擎的突变中使用非确定性函数, 因为这会导致副本之间的不一致. <a href=https://github.com/ClickHouse/ClickHouse/pull/7247 rel="external nofollow noreferrer" target=_blank>#7247</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>在将异常堆栈跟踪转换为字符串时禁用内存跟踪器. 可以防止服务器上的 <code class=syntax>Memory limit exceeded</code> 类型的错误信息丢失, 导致客户端 <code class=syntax>Attempt to read after eof</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/7264 rel="external nofollow noreferrer" target=_blank>#7264</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>各种格式改进. 解决 <a href=https://github.com/ClickHouse/ClickHouse/issues/6033 rel="external nofollow noreferrer" target=_blank>#6033</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/2633 rel="external nofollow noreferrer" target=_blank>#2633</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/6611 rel="external nofollow noreferrer" target=_blank>#6611</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/6742 rel="external nofollow noreferrer" target=_blank>#6742</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7215 rel="external nofollow noreferrer" target=_blank>#7215</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>ClickHouse 会忽略 IN 运算符右侧无法转换为左侧类型的值. 使其适用于复合类型——数组和元组. <a href=https://github.com/ClickHouse/ClickHouse/pull/7283 rel="external nofollow noreferrer" target=_blank>#7283</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>支持 ASOF JOIN 缺失的不等式. 可以在 ON 语法中为 ASOF 列加入 less-or-equal 变体和严格的更大和更少变体. <a href=https://github.com/ClickHouse/ClickHouse/pull/7282 rel="external nofollow noreferrer" target=_blank>#7282</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>优化部分合并连接. <a href=https://github.com/ClickHouse/ClickHouse/pull/7070 rel="external nofollow noreferrer" target=_blank>#7070</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>不要在 uniqCombined 函数中使用超过 98K 的内存. <a href=https://github.com/ClickHouse/ClickHouse/pull/7236 rel="external nofollow noreferrer" target=_blank>#7236</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/7270 rel="external nofollow noreferrer" target=_blank>#7270</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>在 PartialMergeJoin 中刷新磁盘上右侧连接表的部分 (如果没有足够的内存). 需要时加载数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/7186 rel="external nofollow noreferrer" target=_blank>#7186</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=performance-improvement-1>性能改进<a class=headerlink href=../amp/#performance-improvement-1 title="Permanent link"> </a></h4> <ul> <li>通过避免数据重复来加速使用 const 参数的 joinGet. <a href=https://github.com/ClickHouse/ClickHouse/pull/7359 rel="external nofollow noreferrer" target=_blank>#7359</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>如果子查询为空, 则提前返回. <a href=https://github.com/ClickHouse/ClickHouse/pull/7007 rel="external nofollow noreferrer" target=_blank>#7007</a> (<a href=https://github.com/nicelulu rel="external nofollow noreferrer" target=_blank>小路</a>)</li> <li>优化 Values 中 SQL 表达式的解析. <a href=https://github.com/ClickHouse/ClickHouse/pull/6781 rel="external nofollow noreferrer" target=_blank>#6781</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-1>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-1 title="Permanent link"> </a></h4> <ul> <li>禁用一些用于交叉编译到 Mac OS 的贡献. <a href=https://github.com/ClickHouse/ClickHouse/pull/7101 rel="external nofollow noreferrer" target=_blank>#7101</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>为 clickhouse_common_io 添加缺少的 PocoXML 链接. <a href=https://github.com/ClickHouse/ClickHouse/pull/7200 rel="external nofollow noreferrer" target=_blank>#7200</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>在 clickhouse-test 中接受多个测试过滤器参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/7226 rel="external nofollow noreferrer" target=_blank>#7226</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>为 ARM 启用 musl 和 jemalloc. <a href=https://github.com/ClickHouse/ClickHouse/pull/7300 rel="external nofollow noreferrer" target=_blank>#7300</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>将 <code class=syntax>--client-option</code> 参数添加到 <code class=syntax>clickhouse-test</code> 以将附加参数传递给客户端. <a href=https://github.com/ClickHouse/ClickHouse/pull/7277 rel="external nofollow noreferrer" target=_blank>#7277</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>在 rpm 包升级时保留现有配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/7103 rel="external nofollow noreferrer" target=_blank>#7103</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复 PVS 检测到的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7153 rel="external nofollow noreferrer" target=_blank>#7153</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复 Darwin 的构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/7149 rel="external nofollow noreferrer" target=_blank>#7149</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>glibc 2.29 兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/7142 rel="external nofollow noreferrer" target=_blank>#7142</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>确保 dh_clean 不接触潜在的源文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/7205 rel="external nofollow noreferrer" target=_blank>#7205</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>从 altinity rpm 更新时尝试避免冲突 - 它在 clickhouse-server-common 中单独打包了配置文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/7073 rel="external nofollow noreferrer" target=_blank>#7073</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>优化一些头文件以加快重建速度. <a href=https://github.com/ClickHouse/ClickHouse/pull/7212 rel="external nofollow noreferrer" target=_blank>#7212</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/7231 rel="external nofollow noreferrer" target=_blank>#7231</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander<br> Kuzmenkov</a>)</li> <li>添加日期和日期时间的性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/7332 rel="external nofollow noreferrer" target=_blank>#7332</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>修复一些包含非确定性突变的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/7132 rel="external nofollow noreferrer" target=_blank>#7132</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>将带有 MemorySanitizer 的构建添加到 CI. <a href=https://github.com/ClickHouse/ClickHouse/pull/7066 rel="external nofollow noreferrer" target=_blank>#7066</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>避免在 MetricsTransmitter 中使用未初始化的值. <a href=https://github.com/ClickHouse/ClickHouse/pull/7158 rel="external nofollow noreferrer" target=_blank>#7158</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复 MemorySanitizer 发现的 Fields 中的一些问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/7135 rel="external nofollow noreferrer" target=_blank>#7135</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/7179 rel="external nofollow noreferrer" target=_blank>#7179</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>), <a href=https://github.com/ClickHouse/ClickHouse/pull/7376 rel="external nofollow noreferrer" target=_blank>#7376</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复 murmurhash32 中未定义的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/7388 rel="external nofollow noreferrer" target=_blank>#7388</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复 StoragesInfoStream 中未定义的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/7384 rel="external nofollow noreferrer" target=_blank>#7384</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了外部数据库引擎 (MySQL、ODBC、JDBC) 的常量表达式折叠. 在以前的版本中, 它不适用于多个常量表达式, 也不适用于 Date、DateTime 和 UUID. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7245 rel="external nofollow noreferrer" target=_blank>#7245</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7252 rel="external nofollow noreferrer" target=_blank>#7252</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在访问 no_users_thread 变量时修复实时视图中的 ThreadSanitizer 数据竞争错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7353 rel="external nofollow noreferrer" target=_blank>#7353</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li> <li>摆脱 libcommon 中的 malloc 符号. <a href=https://github.com/ClickHouse/ClickHouse/pull/7134 rel="external nofollow noreferrer" target=_blank>#7134</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/7065 rel="external nofollow noreferrer" target=_blank>#7065</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos<br> Bird</a>)</li> <li>添加全局标志 ENABLE_LIBRARIES 以禁用所有库. <a href=https://github.com/ClickHouse/ClickHouse/pull/7063 rel="external nofollow noreferrer" target=_blank>#7063</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h4 id=code-cleanup>代码清理<a class=headerlink href=../amp/#code-cleanup title="Permanent link"> </a></h4> <ul> <li>通用化配置存储库以准备 DDL for Dictionaries. <a href=https://github.com/ClickHouse/ClickHouse/pull/7155 rel="external nofollow noreferrer" target=_blank>#7155</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>没有任何语义的字典 DDL 解析器. <a href=https://github.com/ClickHouse/ClickHouse/pull/7209 rel="external nofollow noreferrer" target=_blank>#7209</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>将 ParserCreateQuery 拆分为不同的较小解析器. <a href=https://github.com/ClickHouse/ClickHouse/pull/7253 rel="external nofollow noreferrer" target=_blank>#7253</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>外部字典附近的小重构和重命名. <a href=https://github.com/ClickHouse/ClickHouse/pull/7111 rel="external nofollow noreferrer" target=_blank>#7111</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>重构一些代码, 为基于角色的访问控制做准备. <a href=https://github.com/ClickHouse/ClickHouse/pull/7235 rel="external nofollow noreferrer" target=_blank>#7235</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>DatabaseOrdinary 代码的一些改进. <a href=https://github.com/ClickHouse/ClickHouse/pull/7086 rel="external nofollow noreferrer" target=_blank>#7086</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>不要在哈希表的 find() 和 emplace() 方法中使用迭代器. <a href=https://github.com/ClickHouse/ClickHouse/pull/7026 rel="external nofollow noreferrer" target=_blank>#7026</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>修复 getMultipleValuesFromConfig 以防参数 root 不为空. <a href=https://github.com/ClickHouse/ClickHouse/pull/7374 rel="external nofollow noreferrer" target=_blank>#7374</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>删除一些复制粘贴 (TemporaryFile 和 TemporaryFileStream). <a href=https://github.com/ClickHouse/ClickHouse/pull/7166 rel="external nofollow noreferrer" target=_blank>#7166</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>提高了一点代码可读性 (<code class=syntax>MergeTreeData::getActiveContainingPart</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/7361 rel="external nofollow noreferrer" target=_blank>#7361</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>如果 <code class=syntax>ThreadPool::schedule(...)</code> 抛出异常, 则等待所有使用本地对象的计划作业. 将 <code class=syntax>ThreadPool::schedule(...)</code> 重命名为 <code class=syntax>ThreadPool::scheduleOrThrowOnError(...)</code> 并修复注释以明确它可能会抛出. <a href=https://github.com/ClickHouse/ClickHouse/pull/7350 rel="external nofollow noreferrer" target=_blank>#7350</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> </ul> <h2 id=clickhouse-release-19-15>ClickHouse 版本 19.15<a class=headerlink href=../amp/#clickhouse-release-19-15 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-15-4-10-2019-10-31>ClickHouse 版本 19.15.4.10, 2019-10-31<a class=headerlink href=../amp/#clickhouse-release-19-15-4-10-2019-10-31 title="Permanent link"> </a></h3> <h4 id=bug-fix-3>Bug 修复<a class=headerlink href=../amp/#bug-fix-3 title="Permanent link"> </a></h4> <ul> <li>添加了 SQL BIGINT 中 SQL TINYINT 的处理, 并修复了 ODBC Bridge 中 SQL_FLOAT 数据源类型的处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/7491 rel="external nofollow noreferrer" target=_blank>#7491</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>)</li> <li>允许在 MOVE PARTITION 中的目标磁盘或卷上有一些部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/7434 rel="external nofollow noreferrer" target=_blank>#7434</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>通过 ODBC 桥修复可空列中的 NULL 值. <a href=https://github.com/ClickHouse/ClickHouse/pull/7402 rel="external nofollow noreferrer" target=_blank>#7402</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>修复了 INSERT 到具有 MATERIALIZED 列的分布式非本地节点. <a href=https://github.com/ClickHouse/ClickHouse/pull/7377 rel="external nofollow noreferrer" target=_blank>#7377</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>固定函数 getMultipleValuesFromConfig. <a href=https://github.com/ClickHouse/ClickHouse/pull/7374 rel="external nofollow noreferrer" target=_blank>#7374</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>修复了使用 HTTP 保持活动超时而不是 TCP 保持活动超时的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/7351 rel="external nofollow noreferrer" target=_blank>#7351</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>等待所有作业在异常情况下完成 (修复罕见的段错误). <a href=https://github.com/ClickHouse/ClickHouse/pull/7350 rel="external nofollow noreferrer" target=_blank>#7350</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>插入 Kafka 表时不要推送到 MV. <a href=https://github.com/ClickHouse/ClickHouse/pull/7265 rel="external nofollow noreferrer" target=_blank>#7265</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>禁用异常堆栈的内存跟踪器. <a href=https://github.com/ClickHouse/ClickHouse/pull/7264 rel="external nofollow noreferrer" target=_blank>#7264</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了转换外部数据库查询中的错误代码. <a href=https://github.com/ClickHouse/ClickHouse/pull/7252 rel="external nofollow noreferrer" target=_blank>#7252</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>避免在 MetricsTransmitter 中使用未初始化的值. <a href=https://github.com/ClickHouse/ClickHouse/pull/7158 rel="external nofollow noreferrer" target=_blank>#7158</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加了带有用于测试的宏的示例配置. (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-15-3-6-2019-10-09>ClickHouse 版本 19.15.3.6, 2019-10-09<a class=headerlink href=../amp/#clickhouse-release-19-15-3-6-2019-10-09 title="Permanent link"> </a></h3> <h4 id=bug-fix-4>Bug 修复<a class=headerlink href=../amp/#bug-fix-4 title="Permanent link"> </a></h4> <ul> <li>修复了散列字典中的 bad_variant. (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 ATTACH PART 查询中分段错误的错误. (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了<code class=syntax>MergeTreeData</code> 中的时间计算. (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>在编写完成后显式提交给Kafka. <a href=https://github.com/ClickHouse/ClickHouse/pull/7175 rel="external nofollow noreferrer" target=_blank>#7175</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>在 MergeTree 部分的最小/最大索引中正确序列化 NULL 值. <a href=https://github.com/ClickHouse/ClickHouse/pull/7234 rel="external nofollow noreferrer" target=_blank>#7234</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> </ul> <h3 id=clickhouse-release-19-15-2-2-2019-10-01>ClickHouse 版本 19.15.2.2, 2019-10-01<a class=headerlink href=../amp/#clickhouse-release-19-15-2-2-2019-10-01 title="Permanent link"> </a></h3> <h4 id=new-feature-3>新特征<a class=headerlink href=../amp/#new-feature-3 title="Permanent link"> </a></h4> <ul> <li>分层存储: 支持使用 MergeTree 引擎为表使用多个存储卷. 可以在 SSD 上存储新数据并自动将旧数据移动到 HDD. (<a href=https://clickhouse.github.io/clickhouse-presentations/meetup30/new_features/#12 rel="external nofollow noreferrer" target=_blank>example</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4918 rel="external nofollow noreferrer" target=_blank>#4918</a> (<a href=https://github.com/ObjatieGroba rel="external nofollow noreferrer" target=_blank>Igr</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6489 rel="external nofollow noreferrer" target=_blank>#6489</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加表函数 <code class=syntax>input</code>, 用于在 <code class=syntax>INSERT SELECT</code> 查询中读取传入数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/5450 rel="external nofollow noreferrer" target=_blank>#5450</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6832 rel="external nofollow noreferrer" target=_blank>#6832</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>添加一个 <code class=syntax>sparse_hashed</code> 字典布局, 它在功能上等同于 <code class=syntax>hashed</code> 布局, 但内存效率更高. 它以较慢的值检索为代价使用大约两倍的内存. <a href=https://github.com/ClickHouse/ClickHouse/pull/6894 rel="external nofollow noreferrer" target=_blank>#6894</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>实现定义用户列表以访问字典的能力. 仅使用当前连接的数据库. <a href=https://github.com/ClickHouse/ClickHouse/pull/6907 rel="external nofollow noreferrer" target=_blank>#6907</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>向<code class=syntax>SHOW</code>查询添加<code class=syntax>LIMIT</code>选项. <a href=https://github.com/ClickHouse/ClickHouse/pull/6944 rel="external nofollow noreferrer" target=_blank>#6944</a> (<a href=https://github.com/malkfilipp rel="external nofollow noreferrer" target=_blank>Philipp Malkovsky</a>)</li> <li>添加 <code class=syntax>bitmapSubsetLimit(bitmap, range_start, limit)</code> 函数, 返回集合中不小于 <code class=syntax>range_start</code> 的最小 <code class=syntax>limit</code> 值的子集. <a href=https://github.com/ClickHouse/ClickHouse/pull/6957 rel="external nofollow noreferrer" target=_blank>#6957</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>添加 <code class=syntax>bitmapMin</code> 和 <code class=syntax>bitmapMax</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/6970 rel="external nofollow noreferrer" target=_blank>#6970</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>添加与 <a href=https://github.com/ClickHouse/ClickHouse/issues/6648 rel="external nofollow noreferrer" target=_blank>issue-6648</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6999 rel="external nofollow noreferrer" target=_blank>#6999</a> 相关的函数 <code class=syntax>repeat</code>.(<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>)</li> </ul> <h4 id=experimental-feature-1>实验功能<a class=headerlink href=../amp/#experimental-feature-1 title="Permanent link"> </a></h4> <ul> <li>实现 (在内存中) 不改变当前管道的 Merge Join 变体. 结果按合并键部分排序. 设置 <code class=syntax>partial_merge_join = 1</code> 以使用此功能. Merge Join 仍在开发中. <a href=https://github.com/ClickHouse/ClickHouse/pull/6940 rel="external nofollow noreferrer" target=_blank>#6940</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>添加 <code class=syntax>S3</code> 引擎和表格功能。. 它仍在开发中 (尚无身份验证支持). <a href=https://github.com/ClickHouse/ClickHouse/pull/5596 rel="external nofollow noreferrer" target=_blank>#5596</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> </ul> <h4 id=improvement-2>改进<a class=headerlink href=../amp/#improvement-2 title="Permanent link"> </a></h4> <ul> <li>从 Kafka 读取的每条消息都是以原子方式插入的. 这解决了 Kafka 引擎的几乎所有已知问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/6950 rel="external nofollow noreferrer" target=_blank>#6950</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>分布式查询故障转移的改进. 缩短恢复时间, 现在它也是可配置的, 可以在 <code class=syntax>system.clusters</code> 中看到. <a href=https://github.com/ClickHouse/ClickHouse/pull/6399 rel="external nofollow noreferrer" target=_blank>#6399</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>直接在 <code class=syntax>IN</code> 部分支持枚举的数值. #6766 <a href=https://github.com/ClickHouse/ClickHouse/pull/6941 rel="external nofollow noreferrer" target=_blank>#6941</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>支持 (可选, 默认禁用) 重定向 URL 存储. <a href=https://github.com/ClickHouse/ClickHouse/pull/6914 rel="external nofollow noreferrer" target=_blank>#6914</a> (<a href=https://github.com/maqroll rel="external nofollow noreferrer" target=_blank>maqroll</a>)</li> <li>添加旧版本客户端连接到服务器时的信息消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/6893 rel="external nofollow noreferrer" target=_blank>#6893</a> (<a href=https://github.com/malkfilipp rel="external nofollow noreferrer" target=_blank>Philipp Malkovsky</a>)</li> <li>删除分布式表中发送数据的最大退避睡眠时间限制. <a href=https://github.com/ClickHouse/ClickHouse/pull/6895 rel="external nofollow noreferrer" target=_blank>#6895</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加将带有累积值的配置文件事件 (计数器) 发送到石墨的功能. 它可以在服务器 <code class=syntax>config.xml</code> 中的 <code class=syntax>&lt;events_cumulative&gt;</code> 下启用. <a href=https://github.com/ClickHouse/ClickHouse/pull/6969 rel="external nofollow noreferrer" target=_blank>#6969</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>在通过 HTTP 以本机格式将数据插入类型为 <code class=syntax>LowCardinality(T)</code> 的列中时, 自动将类型 <code class=syntax>T</code> 添加到 <code class=syntax>LowCardinality(T)</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/6891 rel="external nofollow noreferrer" target=_blank>#6891</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>添加使用函数 <code class=syntax>hex</code> 而不使用 <code class=syntax>reinterpretAsString</code> 为 <code class=syntax>Float32</code> 和 <code class=syntax>Float64</code> 的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/7024 rel="external nofollow noreferrer" target=_blank>#7024</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-2>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-2 title="Permanent link"> </a></h4> <ul> <li>将 gdb-index 添加到带有调试信息的 clickhouse 二进制文件中. 它将加快 <code class=syntax>gdb</code> 的启动时间. <a href=https://github.com/ClickHouse/ClickHouse/pull/6947 rel="external nofollow noreferrer" target=_blank>#6947</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>使用使用 <code class=syntax>pigz</code> 的补丁dpkg-deb加速deb打包. <a href=https://github.com/ClickHouse/ClickHouse/pull/6960 rel="external nofollow noreferrer" target=_blank>#6960</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>设置 <code class=syntax>enable_fuzzing = 1</code> 以启用所有项目代码的 libfuzzer 检测. <a href=https://github.com/ClickHouse/ClickHouse/pull/7042 rel="external nofollow noreferrer" target=_blank>#7042</a> (<a href=https://github.com/kyprizel rel="external nofollow noreferrer" target=_blank>kyprizel</a>)</li> <li>在 CI 中添加 split build 冒烟测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/7061 rel="external nofollow noreferrer" target=_blank>#7061</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>将带有 MemorySanitizer 的构建添加到 CI. <a href=https://github.com/ClickHouse/ClickHouse/pull/7066 rel="external nofollow noreferrer" target=_blank>#7066</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>用 <code class=syntax>sparsehash-c11</code> 替换 <code class=syntax>libsparsehash</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6965 rel="external nofollow noreferrer" target=_blank>#6965</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> </ul> <h4 id=bug-fix-5>Bug 修复<a class=headerlink href=../amp/#bug-fix-5 title="Permanent link"> </a></h4> <ul> <li>修复了大型表上复杂键的索引分析性能下降. 这修复了 #6924. <a href=https://github.com/ClickHouse/ClickHouse/pull/7075 rel="external nofollow noreferrer" target=_blank>#7075</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复从 Kafka 空主题中选择时导致段错误的逻辑错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6909 rel="external nofollow noreferrer" target=_blank>#6909</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复 <code class=syntax>MySQLBlockInputStream.cpp</code> 中过早关闭 MySQL 连接. <a href=https://github.com/ClickHouse/ClickHouse/pull/6882 rel="external nofollow noreferrer" target=_blank>#6882</a> (<a href=https://github.com/clemrodriguez rel="external nofollow noreferrer" target=_blank>Clément Rodriguez</a>)</li> <li>返回对非常旧的 Linux 内核的支持 (修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6841 rel="external nofollow noreferrer" target=_blank>#6841</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6853 rel="external nofollow noreferrer" target=_blank>#6853</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在输入流中出现空块的情况下，修复 <code class=syntax>insert select</code> 查询中可能丢失的数据. #6834 #6862 <a href=https://github.com/ClickHouse/ClickHouse/pull/6911 rel="external nofollow noreferrer" target=_blank>#6911</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复参数中带有空数组的函数 <code class=syntax>АrrayEnumerateUniqRanked</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6928 rel="external nofollow noreferrer" target=_blank>#6928</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>使用数组连接和全局子查询修复复杂查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/6934 rel="external nofollow noreferrer" target=_blank>#6934</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>使用多个 JOIN 修复 ORDER BY 和 GROUP BY 中的 <code class=syntax>Unknown identifier</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7022 rel="external nofollow noreferrer" target=_blank>#7022</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了在执行带有 <code class=syntax>LowCardinality</code> 参数的函数时发出的 <code class=syntax>MSan</code> 警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/7062 rel="external nofollow noreferrer" target=_blank>#7062</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> </ul> <h4 id=backward-incompatible-change-2>向后不兼容的更新<a class=headerlink href=../amp/#backward-incompatible-change-2 title="Permanent link"> </a></h4> <ul> <li>更改了位图* 聚合函数状态的序列化格式以提高性能. 无法读取之前版本中位图* 的序列化状态. <a href=https://github.com/ClickHouse/ClickHouse/pull/6908 rel="external nofollow noreferrer" target=_blank>#6908</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> </ul> <h2 id=clickhouse-release-19-14>ClickHouse 版本 19.14<a class=headerlink href=../amp/#clickhouse-release-19-14 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-14-7-15-2019-10-02>ClickHouse 版本 19.14.7.15, 2019-10-02<a class=headerlink href=../amp/#clickhouse-release-19-14-7-15-2019-10-02 title="Permanent link"> </a></h3> <h4 id=bug-fix-6>Bug 修复<a class=headerlink href=../amp/#bug-fix-6 title="Permanent link"> </a></h4> <ul> <li>此版本还包含 19.11.12.69 的所有错误修复.</li> <li>修复了 19.14 和更早版本之间分布式查询的兼容性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7068 rel="external nofollow noreferrer" target=_blank>#7068</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7069 rel="external nofollow noreferrer" target=_blank>#7069</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-14-6-12-2019-09-19>ClickHouse 版本 19.14.6.12, 2019-09-19<a class=headerlink href=../amp/#clickhouse-release-19-14-6-12-2019-09-19 title="Permanent link"> </a></h3> <h4 id=bug-fix-7>Bug 修复<a class=headerlink href=../amp/#bug-fix-7 title="Permanent link"> </a></h4> <ul> <li>修复函数 <code class=syntax>АrrayEnumerateUniqRanked</code> 在参数中带有空数组. <a href=https://github.com/ClickHouse/ClickHouse/pull/6928 rel="external nofollow noreferrer" target=_blank>#6928</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>使用带有别名的 <code class=syntax>ARRAY JOIN</code> 和 <code class=syntax>GLOBAL IN subquery</code> 修复了查询中的子查询名称. 如果指定了外部表名, 则使用子查询别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/6934 rel="external nofollow noreferrer" target=_blank>#6934</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-3>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-3 title="Permanent link"> </a></h4> <ul> <li>修复 <a href=https://clickhouse-test-reports.s3.yandex.net/6944/aab95fd5175a513413c7395a73a82044bdafb906/functional_stateless_tests_(debug).html rel="external nofollow noreferrer" target=_blank>flapping</a> 测试 <code class=syntax>00715_fetch_merged_or_mutated_part_zookeeper</code> 00715_mut_fetch_merged 的脚本需要重新写入 shellpart_或重新写入它的 shell 脚本申请. <a href=https://github.com/ClickHouse/ClickHouse/pull/6977 rel="external nofollow noreferrer" target=_blank>#6977</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>修复了函数 <code class=syntax>groupUniqArray</code> 中的 UBSan 和 MemSan 失败，并带有 emtpy 数组参数. 这是由于没有调用零单元格值的构造函数, 将空的 <code class=syntax>PaddPODArray</code> 放入哈希表零单元格中引起的. <a href=https://github.com/ClickHouse/ClickHouse/pull/6937 rel="external nofollow noreferrer" target=_blank>#6937</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> </ul> <h3 id=clickhouse-release-19-14-3-3-2019-09-10>ClickHouse 版本 19.14.3.3, 2019-09-10<a class=headerlink href=../amp/#clickhouse-release-19-14-3-3-2019-09-10 title="Permanent link"> </a></h3> <h4 id=new-feature-4>新特征<a class=headerlink href=../amp/#new-feature-4 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>ORDER BY</code> 的 <code class=syntax>WITH FILL</code> 修饰符. (continuation of <a href=https://github.com/ClickHouse/ClickHouse/issues/5069 rel="external nofollow noreferrer" target=_blank>#5069</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6610 rel="external nofollow noreferrer" target=_blank>#6610</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li><code class=syntax>LIMIT</code> 的 <code class=syntax>WITH TIES</code> 修饰符. (continuation of <a href=https://github.com/ClickHouse/ClickHouse/issues/5069 rel="external nofollow noreferrer" target=_blank>#5069</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6610 rel="external nofollow noreferrer" target=_blank>#6610</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>将未加引号的 <code class=syntax>NULL</code> 文字解析为 NULL (如果设置 <code class=syntax>format_csv_unquoted_null_literal_as_null=1</code>). 如果此字段的数据类型不可为空, 则使用默认值初始化空字段 (如果设置 <code class=syntax>input_format_null_as_default=1</code>). <a href=https://github.com/ClickHouse/ClickHouse/issues/5990 rel="external nofollow noreferrer" target=_blank>#5990</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6055 rel="external nofollow noreferrer" target=_blank>#6055</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>支持在表函数 <code class=syntax>file</code> 和 <code class=syntax>hdfs</code> 的路径中使用通配符. 如果路径包含通配符, 则该表将是只读的. 用法示例: <code class=syntax>select * from hdfs('hdfs://hdfs1:9000/some_dir/another_dir/*/file{0..9}{0..9}')</code> 和 <code class=syntax>select * from file('some_dir /{some_file,another_file,yet_another}.tsv', 'TSV', 'value UInt32')</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6092 rel="external nofollow noreferrer" target=_blank>#6092</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>新的 <code class=syntax>system.metric_log</code> 表, 它存储具有指定时间间隔的 <code class=syntax>system.events</code> 和 <code class=syntax>system.metrics</code> 的值. <a href=https://github.com/ClickHouse/ClickHouse/issues/6363 rel="external nofollow noreferrer" target=_blank>#6363</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6467 rel="external nofollow noreferrer" target=_blank>#6467</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6530 rel="external nofollow noreferrer" target=_blank>#6530</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>允许将 ClickHouse 文本日志写入 <code class=syntax>system.text_log</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/issues/6037 rel="external nofollow noreferrer" target=_blank>#6037</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6103 rel="external nofollow noreferrer" target=_blank>#6103</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6164 rel="external nofollow noreferrer" target=_blank>#6164</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在堆栈跟踪中显示私有符号 (这是通过解析 ELF 文件的符号表完成的). 如果存在调试信息, 则在堆栈跟踪中添加有关文件和行号的信息. 使用程序中存在的索引符号加速符号名称查找. 添加了用于自省的新 SQL 函数: <code class=syntax>demangle</code> 和 <code class=syntax>addressToLine</code>. 将函数 <code class=syntax>symbolizeAddress</code> 重命名为 <code class=syntax>addressToSymbol</code> 以保持一致性. 出于性能原因, 函数<code class=syntax>addressToSymbol</code> 将返回损坏的名称, 您必须应用<code class=syntax>demangle</code>. 添加了默认关闭的设置 <code class=syntax>allow_introspection_functions</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6201 rel="external nofollow noreferrer" target=_blank>#6201</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>表函数 <code class=syntax>values</code> (名称不区分大小写). 它允许从 <a href=https://github.com/ClickHouse/ClickHouse/issues/5984 rel="external nofollow noreferrer" target=_blank>#5984</a> 中提出的 <code class=syntax>VALUES</code> 列表中读取. 示例: <code class=syntax>SELECT * FROM VALUES('a UInt64, s String', (1, 'one'), (2, 'two'), (3, 'three'))</code>. <a href=https://github.com/ClickHouse/ClickHouse/issues/6217 rel="external nofollow noreferrer" target=_blank>#6217</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6209 rel="external nofollow noreferrer" target=_blank>#6209</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>添加了更改存储设置的功能. 语法: <code class=syntax>ALTER TABLE &lt;table&gt; MODIFY SETTING &lt;setting&gt; = &lt;value&gt;</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6366 rel="external nofollow noreferrer" target=_blank>#6366</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6669 rel="external nofollow noreferrer" target=_blank>#6669</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6685 rel="external nofollow noreferrer" target=_blank>#6685</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>支持拆卸分离部件. 语法: <code class=syntax>ALTER TABLE &lt;table_name&gt; DROP DETACHED PART '&lt;part_id&gt;'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6158 rel="external nofollow noreferrer" target=_blank>#6158</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>表约束. 允许向表定义添加约束, 这将在插入时检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/5273 rel="external nofollow noreferrer" target=_blank>#5273</a> (<a href=https://github.com/NanoBjorn rel="external nofollow noreferrer" target=_blank>Gleb Novikov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6652 rel="external nofollow noreferrer" target=_blank>#6652</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>支持级联物化视图. <a href=https://github.com/ClickHouse/ClickHouse/pull/6324 rel="external nofollow noreferrer" target=_blank>#6324</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>默认情况下打开查询分析器以每秒对每个查询执行线程进行一次采样. <a href=https://github.com/ClickHouse/ClickHouse/pull/6283 rel="external nofollow noreferrer" target=_blank>#6283</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>输入格式 <code class=syntax>ORC</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6454 rel="external nofollow noreferrer" target=_blank>#6454</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6703 rel="external nofollow noreferrer" target=_blank>#6703</a> (<a href=https://github.com/akonyaev90 rel="external nofollow noreferrer" target=_blank>akonyaev90</a>)</li> <li>添加了两个新函数: <code class=syntax>sigmoid</code> 和 <code class=syntax>tanh</code> (对机器学习应用程序很有用). <a href=https://github.com/ClickHouse/ClickHouse/pull/6254 rel="external nofollow noreferrer" target=_blank>#6254</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>函数 <code class=syntax>hasToken(haystack, token)</code>, <code class=syntax>hasTokenCaseInsensitive(haystack, token)</code> 来检查给定的令牌是否在 haystack 中. 令牌是两个非字母数字 ASCII 字符 (或 haystack 的边界) 之间的最大长度子串. 令牌必须是一个常量字符串. 由 tokenbf_v1 索引专业化支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/6596 rel="external nofollow noreferrer" target=_blank>#6596</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/6662 rel="external nofollow noreferrer" target=_blank>#6662</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>新函数 <code class=syntax>neighbor(value, offset[, default_value])</code>. 允许在数据块中的列中达到上一个/下一个值. <a href=https://github.com/ClickHouse/ClickHouse/pull/5925 rel="external nofollow noreferrer" target=_blank>#5925</a> (<a href=https://github.com/alex-krash rel="external nofollow noreferrer" target=_blank>Alex Krash</a>) <a href=https://github.com/ClickHouse/ClickHouse/commit/6685365ab8c5b74f9650492c88a012596eb1b0c6 rel="external nofollow noreferrer" target=_blank>6685365ab8c5b74f9650492c88a012596eb1b0c6</a> <a href=https://github.com/ClickHouse/ClickHouse/commit/341e2e4587a18065c2da1ca888c73389f48ce36c rel="external nofollow noreferrer" target=_blank>341e2e4587a18065c2da1ca888c73389f48ce36c</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>Alexey Milovidov</a></li> <li>创建了一个函数 <code class=syntax>currentUser()</code>, 返回授权用户的登录信息. 添加别名 <code class=syntax>user()</code> 以兼容 MySQL. <a href=https://github.com/ClickHouse/ClickHouse/pull/6470 rel="external nofollow noreferrer" target=_blank>#6470</a> (<a href=https://github.com/alex-krash rel="external nofollow noreferrer" target=_blank>Alex Krash</a>)</li> <li><a href=https://github.com/ClickHouse/ClickHouse/issues/5885 rel="external nofollow noreferrer" target=_blank>#5885</a> 中提出的新聚合函数 <code class=syntax>quantilesExactInclusive</code> 和<code class=syntax>quantilesExactExclusive</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6477 rel="external nofollow noreferrer" target=_blank>#6477</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>函数 <code class=syntax>bitmapRange(bitmap, range_begin, range_end)</code> 返回具有指定范围的新集合 (不包括<code class=syntax>range_end</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/6314 rel="external nofollow noreferrer" target=_blank>#6314</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>函数 <code class=syntax>geohashesInBox(longitude_min, latitude_min, longitude_max, latitude_max, precision)</code> 它创建覆盖提供区域的 geohash-boxes 的精确长字符串数组. <a href=https://github.com/ClickHouse/ClickHouse/pull/6127 rel="external nofollow noreferrer" target=_blank>#6127</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>使用 <code class=syntax>Kafka</code> 表实现对 INSERT 查询的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/6012 rel="external nofollow noreferrer" target=_blank>#6012</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>向 Kafka 引擎添加了对 <code class=syntax>_partition</code> 和 <code class=syntax>_timestamp</code> 虚拟列的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/6400 rel="external nofollow noreferrer" target=_blank>#6400</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>可以从<code class=syntax>query_log</code>、服务器日志、使用基于正则表达式的规则的进程列表中删除敏感数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/5710 rel="external nofollow noreferrer" target=_blank>#5710</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> </ul> <h4 id=experimental-feature-2>实验功能<a class=headerlink href=../amp/#experimental-feature-2 title="Permanent link"> </a></h4> <ul> <li>输入和输出数据格式 <code class=syntax>Template</code> . 它允许为输入和输出指定自定义格式字符串. <a href=https://github.com/ClickHouse/ClickHouse/issues/4354 rel="external nofollow noreferrer" target=_blank>#4354</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6727 rel="external nofollow noreferrer" target=_blank>#6727</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>最初在 <a href=https://github.com/ClickHouse/ClickHouse/pull/2898 rel="external nofollow noreferrer" target=_blank>#2898</a> 中提出的 <code class=syntax>LIVE VIEW</code> 表的实现, 在 <a href=https://github.com/ClickHouse rel="external nofollow noreferrer" target=_blank>#3925</a> 中准备 /ClickHouse/issues/3925)，然后在 <a href=https://github.com/ClickHouse/ClickHouse/issues/5541 rel="external nofollow noreferrer" target=_blank>#5541</a> 中更新. 详细说明见<a href=https://github.com/ClickHouse/ClickHouse/issues/5541 rel="external nofollow noreferrer" target=_blank>#5541</a>. <a href=https://github.com/ClickHouse/ClickHouse/issues/5541 rel="external nofollow noreferrer" target=_blank>#5541</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>) <a href="https://github.com/ ClickHouse/ClickHouse/pull/6425" rel="external nofollow noreferrer" target=_blank>#6425</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6656 rel="external nofollow noreferrer" target=_blank>#6656</a> ([vzakaznikov] (<a href=https://github.com/vzakaznikov target=_blank>https://github.com/vzakaznikov</a>)) 请注意，下一个版本可能会删除 <code class=syntax>LIVE VIEW</code> 功能.</li> </ul> <h4 id=bug-fix-8>Bug 修复<a class=headerlink href=../amp/#bug-fix-8 title="Permanent link"> </a></h4> <ul> <li>此版本还包含 19.13 和 19.11 的所有错误修复.</li> <li>修复表有跳过索引和垂直合并时的分段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6723 rel="external nofollow noreferrer" target=_blank>#6723</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>使用非平凡的列默认值修复每列 TTL. 以前在强制 TTL 合并与 <code class=syntax>OPTIMIZE ... FINAL</code> 查询的情况下, 过期值被替换为类型默认值而不是用户指定的列默认值. <a href=https://github.com/ClickHouse/ClickHouse/pull/6796 rel="external nofollow noreferrer" target=_blank>#6796</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复正常服务器重启时Kafka消息重复问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/6597 rel="external nofollow noreferrer" target=_blank>#6597</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复了读取 Kafka 消息时的无限循环. 根本不要暂停/恢复消费者订阅 - 否则在某些情况下它可能会无限期暂停. <a href=https://github.com/ClickHouse/ClickHouse/pull/6354 rel="external nofollow noreferrer" target=_blank>#6354</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复 <code class=syntax>bitmapContains</code> 函数中 <code class=syntax>Key expression contains comparison between inconvertible types</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/issues/6136 rel="external nofollow noreferrer" target=_blank>#6136</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/6146 rel="external nofollow noreferrer" target=_blank>#6146</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6156 rel="external nofollow noreferrer" target=_blank>#6156</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>使用启用的 <code class=syntax>optimize_skip_unused_shards</code> 和丢失的分片键修复段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6384 rel="external nofollow noreferrer" target=_blank>#6384</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复了可能导致内存损坏的突变中的错误代码. 修复了由于从 <code class=syntax>system.parts</code> 或 <code class=syntax>system.parts_columns</code> 并发 <code class=syntax>DROP TABLE</code> 和 <code class=syntax>SELECT</code> 而可能发生的读取地址 <code class=syntax>0x14c0</code> 的段错误. 修复了准备突变查询时的竞争条件. 修复复制表的 <code class=syntax>OPTIMIZE</code> 和 ALTER 等并发修改操作导致的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/6514 rel="external nofollow noreferrer" target=_blank>#6514</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 MySQL 界面中删除了额外的详细日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/6389 rel="external nofollow noreferrer" target=_blank>#6389</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>返回从配置文件中的 <code class=syntax>true</code> 和 <code class=syntax>false</code> 解析布尔设置的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/6278 rel="external nofollow noreferrer" target=_blank>#6278</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>Nullable(Decimal128)</code> 上 <code class=syntax>quantile</code> 和 <code class=syntax>median</code> 函数中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/6378 rel="external nofollow noreferrer" target=_blank>#6378</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了主键上包含转换为 Float 类型的带有 <code class=syntax>WHERE</code> 条件的 <code class=syntax>SELECT</code> 查询可能返回的不完整结果. 它是由 <code class=syntax>toFloat</code> 函数中的单调性检查不正确引起的. <a href=https://github.com/ClickHouse/ClickHouse/issues/6248 rel="external nofollow noreferrer" target=_blank>#6248</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6374 rel="external nofollow noreferrer" target=_blank>#6374</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>检查 <code class=syntax>max_expanded_ast_elements</code> 设置是否有突变. 在 <code class=syntax>TRUNCATE TABLE</code> 之后清除突变. <a href=https://github.com/ClickHouse/ClickHouse/pull/6205 rel="external nofollow noreferrer" target=_blank>#6205</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>与<code class=syntax>join_use_nulls</code> 一起使用时，修复键列的JOIN 结果. 附加空值而不是列默认值. <a href=https://github.com/ClickHouse/ClickHouse/pull/6249 rel="external nofollow noreferrer" target=_blank>#6249</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复具有垂直合并和更改的跳过索引. 修复 <code class=syntax>Bad size of marks file</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/issues/6594 rel="external nofollow noreferrer" target=_blank>#6594</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6713 rel="external nofollow noreferrer" target=_blank>#6713</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>当合并/更改的部分之一为空(0 行)时, 修复 <code class=syntax>ALTER MODIFY COLUMN</code> 和垂直合并中的罕见崩溃. <a href=https://github.com/ClickHouse/ClickHouse/issues/6746 rel="external nofollow noreferrer" target=_blank>#6746</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6780 rel="external nofollow noreferrer" target=_blank>#6780</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了在 <code class=syntax>AggregateFunctionFactory</code> 中转换 <code class=syntax>LowCardinality</code> 类型的错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6257 rel="external nofollow noreferrer" target=_blank>#6257</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6281 rel="external nofollow noreferrer" target=_blank>#6281</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复 <code class=syntax>topK</code> 和 <code class=syntax>topK Weighted</code> 聚合函数中的错误行为和可能的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6404 rel="external nofollow noreferrer" target=_blank>#6404</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复了围绕 <code class=syntax>getIdentifier</code> 函数的不安全代码. <a href=https://github.com/ClickHouse/ClickHouse/issues/6401 rel="external nofollow noreferrer" target=_blank>#6401</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6409 rel="external nofollow noreferrer" target=_blank>#6409</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 MySQL 有线协议中的错误(在连接到 ClickHouse 表单 MySQL 客户端时使用). 由 <code class=syntax>PacketPayloadWriteBuffer</code> 中的堆缓冲区溢出引起. <a href=https://github.com/ClickHouse/ClickHouse/pull/6212 rel="external nofollow noreferrer" target=_blank>#6212</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>修复了 <code class=syntax>bitmapSubsetInRange</code> 函数中的内存泄漏. <a href=https://github.com/ClickHouse/ClickHouse/pull/6819 rel="external nofollow noreferrer" target=_blank>#6819</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>修复粒度更改后执行变异时的罕见错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6816 rel="external nofollow noreferrer" target=_blank>#6816</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>默认允许所有字段的 protobuf 消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/6132 rel="external nofollow noreferrer" target=_blank>#6132</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>当我们在第二个参数上发送一个 <code class=syntax>NULL</code> 参数时，解决了一个带有 <code class=syntax>nullIf</code> 函数的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6446 rel="external nofollow noreferrer" target=_blank>#6446</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>修复带有字符串字段的复杂键缓存字典中内存分配/释放错误的罕见错误, 这会导致无限内存消耗(看起来像内存泄漏). 当字符串大小是从 8 开始的 2 的幂(8、16、32 等)时会重现错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6447 rel="external nofollow noreferrer" target=_blank>#6447</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了小序列上的 Gorilla 编码导致异常 <code class=syntax>Cannot write after end of buffer</code>. <a href=https://github.com/ClickHouse/ClickHouse/issues/6398 rel="external nofollow noreferrer" target=_blank>#6398</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6444 rel="external nofollow noreferrer" target=_blank>#6444</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>允许在启用了 <code class=syntax>join_use_nulls</code> 的 JOIN 中使用不可为空的类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/6705 rel="external nofollow noreferrer" target=_blank>#6705</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>在 <code class=syntax>clickhouse-client</code> 中禁用查询中的 <code class=syntax>Poco::AbstractConfiguration</code> 替换. <a href=https://github.com/ClickHouse/ClickHouse/pull/6706 rel="external nofollow noreferrer" target=_blank>#6706</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>避免 <code class=syntax>REPLACE PARTITION</code> 中的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/6677 rel="external nofollow noreferrer" target=_blank>#6677</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>对常量参数使用 <code class=syntax>arrayReduce</code> 可能会导致段错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/6242 rel="external nofollow noreferrer" target=_blank>#6242</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6326 rel="external nofollow noreferrer" target=_blank>#6326</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复在 <code class=syntax>DROP PARTITION</code> 之后恢复副本时可能出现的不一致部分. <a href=https://github.com/ClickHouse/ClickHouse/issues/6522 rel="external nofollow noreferrer" target=_blank>#6522</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6523 rel="external nofollow noreferrer" target=_blank>#6523</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了 <code class=syntax>JSONExtractRaw</code> 函数挂起的问题. <a href=https://github.com/ClickHouse/ClickHouse/issues/6195 rel="external nofollow noreferrer" target=_blank>#6195</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6198 rel="external nofollow noreferrer" target=_blank>#6198</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用自适应粒度修复不正确的跳过索引序列化和聚合的错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/6594 rel="external nofollow noreferrer" target=_blank>#6594</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6748 rel="external nofollow noreferrer" target=_blank>#6748</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>使用两级聚合修复 <code class=syntax>GROUP BY</code> 的 <code class=syntax>WITH ROLLUP</code> 和 <code class=syntax>WITH CUBE</code> 修饰符. <a href=https://github.com/ClickHouse/ClickHouse/pull/6225 rel="external nofollow noreferrer" target=_blank>#6225</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复以自适应粒度写入二级索引标记的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6126 rel="external nofollow noreferrer" target=_blank>#6126</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复服务器启动时的初始化顺序. 由于 <code class=syntax>StorageMergeTree::background_task_handle</code> 是在 <code class=syntax>startup()</code> 中初始化的, 所以 <code class=syntax>MergeTreeBlockOutputStream::write()</code> 可能会在初始化之前尝试使用它. 只需检查它是否已初始化. <a href=https://github.com/ClickHouse/ClickHouse/pull/6080 rel="external nofollow noreferrer" target=_blank>#6080</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>清除上一个因错误而完成的读操作的数据缓冲区. <a href=https://github.com/ClickHouse/ClickHouse/pull/6026 rel="external nofollow noreferrer" target=_blank>#6026</a> (<a href=https://github.com/bopohaa rel="external nofollow noreferrer" target=_blank>Nikolay</a>)</li> <li>修复为 Replicated*MergeTree 表创建新副本时启用自适应粒度的错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/6394 rel="external nofollow noreferrer" target=_blank>#6394</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6452 rel="external nofollow noreferrer" target=_blank>#6452</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了在访问未初始化的 <code class=syntax>ThreadStatus</code> 结构时出现异常时在 <code class=syntax>libunwind</code> 中发生异常的情况下服务器启动期间可能发生的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/6456 rel="external nofollow noreferrer" target=_blank>#6456</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>修复 <code class=syntax>yandexConsistentHash</code> 函数中的崩溃. 通过模糊测试发现. <a href=https://github.com/ClickHouse/ClickHouse/issues/6304 rel="external nofollow noreferrer" target=_blank>#6304</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6305 rel="external nofollow noreferrer" target=_blank>#6305</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了服务器过载和全局线程池接近满时挂起查询的可能性. 这在具有大量分片(数百个)的集群上发生的可能性更高, 因为分布式查询为每个连接分配一个线程到每个分片. 例如, 如果 330 个分片的集群正在处理 30 个并发分布式查询, 则此问题可能会重现. 此问题影响从 19.2 开始的所有版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/6301 rel="external nofollow noreferrer" target=_blank>#6301</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了<code class=syntax>arrayEnumerateUniqRanked</code> 函数的逻辑. <a href=https://github.com/ClickHouse/ClickHouse/pull/6423 rel="external nofollow noreferrer" target=_blank>#6423</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修正解码符号表时的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6603 rel="external nofollow noreferrer" target=_blank>#6603</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复了将 <code class=syntax>LowCardinality(Nullable)</code> 转换为 not-Nullable 列中的不相关异常, 以防它不包含 Nulls (例如, 在像 <code class=syntax>SELECT CAST(CAST('Hello' AS LowCardinality(Nullable(String)))] AS String 这样的查询中 )</code>. <a href=https://github.com/ClickHouse/ClickHouse/issues/6094 rel="external nofollow noreferrer" target=_blank>#6094</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6119 rel="external nofollow noreferrer" target=_blank>#6119</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>删除了 <code class=syntax>system.settings</code> 表中额外的描述引用. <a href=https://github.com/ClickHouse/ClickHouse/issues/6696 rel="external nofollow noreferrer" target=_blank>#6696</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6699 rel="external nofollow noreferrer" target=_blank>#6699</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>避免在复制表的 <code class=syntax>TRUNCATE</code> 中可能出现死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/6695 rel="external nofollow noreferrer" target=_blank>#6695</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修正了按键排序的顺序读取. <a href=https://github.com/ClickHouse/ClickHouse/pull/6189 rel="external nofollow noreferrer" target=_blank>#6189</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复带有 <code class=syntax>enable_mixed_granularity_parts=1</code> 的表的 <code class=syntax>ALTER TABLE ... UPDATE</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/6543 rel="external nofollow noreferrer" target=_blank>#6543</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复 <a href=https://github.com/ClickHouse/ClickHouse/pull/4405 rel="external nofollow noreferrer" target=_blank>#4405</a> 打开的错误 (自 19.4.0 起). 当我们不查询任何列 (<code class=syntax>SELECT 1</code>) 时, 通过 MergeTree 表在对分布式表的查询中重现. <a href=https://github.com/ClickHouse/ClickHouse/pull/6236 rel="external nofollow noreferrer" target=_blank>#6236</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了有符号类型到无符号类型的整数除法中的溢出. 该行为与 C 或 C++ 语言 (整数提升规则) 中的行为完全相同, 这可能令人惊讶. 请注意, 将大有符号数除以大无符号数或反之亦然时仍然可能发生溢出 (但这种情况不太常见). 所有服务器版本都存在该问题. <a href=https://github.com/ClickHouse/ClickHouse/issues/6214 rel="external nofollow noreferrer" target=_blank>#6214</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6233 rel="external nofollow noreferrer" target=_blank>#6233</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>当设置了 <code class=syntax>max_execution_speed</code> 或 <code class=syntax>max_execution_speed_bytes</code> 时, 限制用于节流的最大休眠时间. 修复了 <code class=syntax>Estimated query execution time (inf seconds) is too long</code> 等错误错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/5547 rel="external nofollow noreferrer" target=_blank>#5547</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6232 rel="external nofollow noreferrer" target=_blank>#6232</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了在<code class=syntax>MaterializedView</code>中使用<code class=syntax>MATERIALIZED</code>列和别名的问题. <a href=https://github.com/ClickHouse/ClickHouse/issues/448 rel="external nofollow noreferrer" target=_blank>#448</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/3484 rel="external nofollow noreferrer" target=_blank>#3484</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/3450 rel="external nofollow noreferrer" target=_blank>#3450</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/2878 rel="external nofollow noreferrer" target=_blank>#2878</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/2285 rel="external nofollow noreferrer" target=_blank>#2285</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3796 rel="external nofollow noreferrer" target=_blank>#3796</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6316 rel="external nofollow noreferrer" target=_blank>#6316</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复未实现为处理器的输入流的 <code class=syntax>FormatFactory</code> 行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/6495 rel="external nofollow noreferrer" target=_blank>#6495</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修正了错字. <a href=https://github.com/ClickHouse/ClickHouse/pull/6631 rel="external nofollow noreferrer" target=_blank>#6631</a> (<a href=https://github.com/alexryndin rel="external nofollow noreferrer" target=_blank>Alex Ryndin</a>)</li> <li>错误消息中的错字 ( is -&gt; are ). <a href=https://github.com/ClickHouse/ClickHouse/pull/6839 rel="external nofollow noreferrer" target=_blank>#6839</a> (<a href=https://github.com/den-crane rel="external nofollow noreferrer" target=_blank>Denis Zhuravlev</a>)</li> <li>如果类型包含逗号, 则从字符串解析列列表时已修复错误 (此问题与 <code class=syntax>File</code>、<code class=syntax>URL</code>、<code class=syntax>HDFS</code> 存储相关) <a href=https://github.com/ClickHouse/ClickHouse/issues/6217 rel="external nofollow noreferrer" target=_blank>#6217</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6209 rel="external nofollow noreferrer" target=_blank>#6209</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> </ul> <h4 id=security-fix>安全修复<a class=headerlink href=../amp/#security-fix title="Permanent link"> </a></h4> <ul> <li>此版本还包含 19.13 和 19.11 的所有错误安全修复.</li> <li>修复了由于 SQL 解析器中的堆栈溢出, 伪造查询导致服务器崩溃的可能性. 修复了合并和分布式表、物化视图和涉及子查询的行级安全条件中堆栈溢出的可能性. <a href=https://github.com/ClickHouse/ClickHouse/pull/6433 rel="external nofollow noreferrer" target=_blank>#6433</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=improvement-3>改进<a class=headerlink href=../amp/#improvement-3 title="Permanent link"> </a></h4> <ul> <li>正确实现 <code class=syntax>AND/OR</code> 的三元逻辑. <a href=https://github.com/ClickHouse/ClickHouse/pull/6048 rel="external nofollow noreferrer" target=_blank>#6048</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>现在, 在从没有 TTL 信息或过时的 TTL 信息的旧部分进行 <code class=syntax>OPTIMIZE ... FINAL</code> 查询后, 将删除具有过期 TTL 的值和行, 例如, 在 <code class=syntax>ALTER ... MODIFY TTL</code> 查询之后. 添加了查询 <code class=syntax>SYSTEM STOP/START TTL MERGES</code> 以禁止/允许使用 TTL 分配合并并过滤所有合并中的过期值. <a href=https://github.com/ClickHouse/ClickHouse/pull/6274 rel="external nofollow noreferrer" target=_blank>#6274</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>可以使用 <code class=syntax>CLICKHOUSE_HISTORY_FILE</code> env 为客户端更改 ClickHouse 历史文件的位置. <a href=https://github.com/ClickHouse/ClickHouse/pull/6840 rel="external nofollow noreferrer" target=_blank>#6840</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>从 <code class=syntax>InterpreterSelectQuery</code> 中删除 <code class=syntax>dry_run</code> 标志. … <a href=https://github.com/ClickHouse/ClickHouse/pull/6375 rel="external nofollow noreferrer" target=_blank>#6375</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>支持带有 <code class=syntax>ON</code> 部分的 <code class=syntax>ASOF JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6211 rel="external nofollow noreferrer" target=_blank>#6211</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>更好地支持用于突变和复制的跳过索引. 支持 <code class=syntax>MATERIALIZE/CLEAR INDEX ... IN PARTITION</code> 查询. <code class=syntax>UPDATE x = x</code> 重新计算所有使用列 <code class=syntax>x</code> 的索引. <a href=https://github.com/ClickHouse/ClickHouse/pull/5053 rel="external nofollow noreferrer" target=_blank>#5053</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>无论 <code class=syntax>allow_experimental_live_view</code> 设置如何, 都允许使用 <code class=syntax>ATTACH</code> 实时视图 (例如，在服务器启动时). <a href=https://github.com/ClickHouse/ClickHouse/pull/6754 rel="external nofollow noreferrer" target=_blank>#6754</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>对于查询分析器收集的堆栈跟踪, 不包括查询分析器本身生成的堆栈帧. <a href=https://github.com/ClickHouse/ClickHouse/pull/6250 rel="external nofollow noreferrer" target=_blank>#6250</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>现在表函数<code class=syntax>values</code>、<code class=syntax>file</code>、<code class=syntax>url</code>、<code class=syntax>hdfs</code> 支持ALIAS 列. <a href=https://github.com/ClickHouse/ClickHouse/pull/6255 rel="external nofollow noreferrer" target=_blank>#6255</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>如果 <code class=syntax>config.d</code> 文件没有对应的根元素作为配置文件, 则抛出异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/6123 rel="external nofollow noreferrer" target=_blank>#6123</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>在 <code class=syntax>no space left on device</code> 的异常消息中打印额外信息. <a href=https://github.com/ClickHouse/ClickHouse/issues/6182 rel="external nofollow noreferrer" target=_blank>#6182</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/6252 rel="external nofollow noreferrer" target=_blank>#6252</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6352 rel="external nofollow noreferrer" target=_blank>#6352</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>在确定读取查询要覆盖的 <code class=syntax>Distributed</code> 表的分片时 (对于 <code class=syntax>optimize_skip_unused_shards</code> =1), ClickHouse 现在检查来自 select 语句的 <code class=syntax>prewhere</code> 和 <code class=syntax>where</code> 子句的条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/6521 rel="external nofollow noreferrer" target=_blank>#6521</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>为没有 AVX2 但有 SSE 4.2 和 PCLMUL 指令集的机器启用<code class=syntax>SIMDJSON</code>. <a href=https://github.com/ClickHouse/ClickHouse/issues/6285 rel="external nofollow noreferrer" target=_blank>#6285</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6320 rel="external nofollow noreferrer" target=_blank>#6320</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>ClickHouse 可以在没有 <code class=syntax>O_DIRECT</code> 支持的文件系统上工作（例如 ZFS 和 BtrFS），无需额外调整. <a href=https://github.com/ClickHouse/ClickHouse/issues/4449 rel="external nofollow noreferrer" target=_blank>#4449</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6730 rel="external nofollow noreferrer" target=_blank>#6730</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>支持最终子查询的下推谓词. <a href=https://github.com/ClickHouse/ClickHouse/pull/6120 rel="external nofollow noreferrer" target=_blank>#6120</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6162 rel="external nofollow noreferrer" target=_blank>#6162</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>更好的<code class=syntax>JOIN ON</code>键提取. <a href=https://github.com/ClickHouse/ClickHouse/pull/6131 rel="external nofollow noreferrer" target=_blank>#6131</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>更新了 <code class=syntax>SIMDJSON</code>. <a href=https://github.com/ClickHouse/ClickHouse/issues/6285 rel="external nofollow noreferrer" target=_blank>#6285</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6306 rel="external nofollow noreferrer" target=_blank>#6306</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>优化 <code class=syntax>SELECT count()</code> 查询最小列的选择. <a href=https://github.com/ClickHouse/ClickHouse/pull/6344 rel="external nofollow noreferrer" target=_blank>#6344</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>在 <code class=syntax>windowFunnel()</code> 中添加了 <code class=syntax>strict</code> 参数. 当设置了 <code class=syntax>strict</code> 时, <code class=syntax>windowFunnel()</code> 只对唯一值应用条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/6548 rel="external nofollow noreferrer" target=_blank>#6548</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li> <li><code class=syntax>mysqlxx::Pool</code> 更安全的接口. <a href=https://github.com/ClickHouse/ClickHouse/pull/6150 rel="external nofollow noreferrer" target=_blank>#6150</a> (<a href=https://github.com/avasiliev rel="external nofollow noreferrer" target=_blank>avasiliev</a>)</li> <li>使用 <code class=syntax>--help</code> 选项执行时的选项行大小现在对应于终端大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/6590 rel="external nofollow noreferrer" target=_blank>#6590</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>禁用无键聚合的 <code class=syntax>read in order</code> 优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/6599 rel="external nofollow noreferrer" target=_blank>#6599</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li><code class=syntax>INCORRECT_DATA</code> 和 <code class=syntax>TYPE_MISMATCH</code> 错误代码的 HTTP 状态代码从默认的 <code class=syntax>500 Internal Server Error</code> 更改为 <code class=syntax>400 Bad Request</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6271 rel="external nofollow noreferrer" target=_blank>#6271</a> (<a href=https://github.com/a-rodin rel="external nofollow noreferrer" target=_blank>Alexander Rodin</a>)</li> <li>将 Join 对象从 <code class=syntax>ExpressionAction</code> 移动到 <code class=syntax>AnalyzedJoin</code>. <code class=syntax>ExpressionAnalyzer</code> 和 <code class=syntax>ExpressionAction</code> 不再了解 <code class=syntax>Join</code> 类. 它的逻辑被<code class=syntax>AnalyzedJoin</code> iface隐藏了. <a href=https://github.com/ClickHouse/ClickHouse/pull/6801 rel="external nofollow noreferrer" target=_blank>#6801</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了当分片之一是本地主机但查询是通过网络连接发送时分布式查询可能出现的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/6759 rel="external nofollow noreferrer" target=_blank>#6759</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>更改了多个表 <code class=syntax>RENAME</code> 的语义以避免可能的死锁. <a href=https://github.com/ClickHouse/ClickHouse/issues/6757 rel="external nofollow noreferrer" target=_blank>#6757</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6756 rel="external nofollow noreferrer" target=_blank>#6756</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>重写 MySQL 兼容性服务器以防止在内存中加载完整的数据包负载. 每个连接的内存消耗减少到大约 <code class=syntax>2 * DBMS_DEFAULT_BUFFER_SIZE</code> (读/写缓冲区). <a href=https://github.com/ClickHouse/ClickHouse/pull/5811 rel="external nofollow noreferrer" target=_blank>#5811</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>将 AST 别名解释逻辑移出不必了解查询语义的解析器. <a href=https://github.com/ClickHouse/ClickHouse/pull/6108 rel="external nofollow noreferrer" target=_blank>#6108</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>NamesAndTypesList` 稍微更安全的解析. <a href=https://github.com/ClickHouse/ClickHouse/issues/6408 rel="external nofollow noreferrer" target=_blank>#6408</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6410 rel="external nofollow noreferrer" target=_blank>#6410</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>clickhouse-copier</code>: 允许在查询中使用带有 <code class=syntax>partition_key</code> 别名的配置中的 <code class=syntax>where_condition</code> 来检查分区是否存在 (之前它仅用于读取数据查询). <a href=https://github.com/ClickHouse/ClickHouse/pull/6577 rel="external nofollow noreferrer" target=_blank>#6577</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>在 <code class=syntax>throwIf</code> 中添加了可选的消息参数. (<a href=https://github.com/ClickHouse/ClickHouse/issues/5772 rel="external nofollow noreferrer" target=_blank>#5772</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6329 rel="external nofollow noreferrer" target=_blank>#6329</a> (<a href=https://github.com/Vdimir rel="external nofollow noreferrer" target=_blank>Vdimir</a>)</li> <li>发送插入数据时出现的服务器异常现在也在客户端处理. <a href=https://github.com/ClickHouse/ClickHouse/issues/5891 rel="external nofollow noreferrer" target=_blank>#5891</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6711 rel="external nofollow noreferrer" target=_blank>#6711</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>添加了一个指标 <code class=syntax>DistributedFilesToInsert</code> , 显示文件系统中被分布式表选择发送到远程服务器的文件总数. 该数字是所有分片的总和. <a href=https://github.com/ClickHouse/ClickHouse/pull/6600 rel="external nofollow noreferrer" target=_blank>#6600</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将大部分 JOIN 准备逻辑从 <code class=syntax>ExpressionAction/ExpressionAnalyzer</code> 移动到 <code class=syntax>AnalyzedJoin</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6785 rel="external nofollow noreferrer" target=_blank>#6785</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复 TSan <a href=https://clickhouse-test-reports.s3.yandex.net/6399/c1c1d1daa98e199e620766f1bd06a5921050a00d/functional_stateful_tests_(thread).html rel="external nofollow noreferrer" target=_blank>warning</a> <code class=syntax>lock-order-inversion</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6740 rel="external nofollow noreferrer" target=_blank>#6740</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>关于缺乏 Linux 功能的更好的信息消息. 使用 <code class=syntax>fatal</code> 级别记录致命错误, 这将使其更容易在 <code class=syntax>system.text_log</code> 中找到. <a href=https://github.com/ClickHouse/ClickHouse/pull/6441 rel="external nofollow noreferrer" target=_blank>#6441</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>当启用将临时数据转储到磁盘以限制 <code class=syntax>GROUP BY</code>、<code class=syntax>ORDER BY</code>期间的内存使用时, 它没有检查可用磁盘空间. 修复添加一个新的设置 <code class=syntax>min_free_disk_space</code>, 当可用磁盘空间小于阈值时, 查询将停止并抛出 <code class=syntax>ErrorCodes::NOT_ENOUGH_SPACE</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6678 rel="external nofollow noreferrer" target=_blank>#6678</a> (<a href=https://github.com/weiqxu rel="external nofollow noreferrer" target=_blank>Weiqing Xu</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6691 rel="external nofollow noreferrer" target=_blank>#6691</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>通过线程删除递归 rwlock. 这是没有意义的，因为线程在查询之间被重用. <code class=syntax>SELECT</code> 查询可能会在一个线程中获取锁, 从另一个线程持有锁并从第一个线程退出. 同时, 第一个线程可以被 <code class=syntax>DROP</code> 查询重用。 这将导致错误的 <code class=syntax>Attempt to acquire exclusive lock recursively</code> 消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/6771 rel="external nofollow noreferrer" target=_blank>#6771</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>拆分 <code class=syntax>Expression Analyzer.appendLine()</code>. 在 <code class=syntax>ExpressionAnalyzer</code> 中为 <code class=syntax>Merge Join</code> 准备一个位置. <a href=https://github.com/ClickHouse/ClickHouse/pull/6524 rel="external nofollow noreferrer" target=_blank>#6524</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>向 MySQL 兼容服务器添加了 <code class=syntax>mysql_native_password</code> 身份验证插件. <a href=https://github.com/ClickHouse/ClickHouse/pull/6194 rel="external nofollow noreferrer" target=_blank>#6194</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>更少的 <code class=syntax>clock_gettime</code> 调用; 修复了 <code class=syntax>Allocator</code> 中调试/发布之间的 ABI 兼容性 (无关紧要的问题). <a href=https://github.com/ClickHouse/ClickHouse/pull/6197 rel="external nofollow noreferrer" target=_blank>#6197</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 <code class=syntax>collectUsedColumns</code> 从 <code class=syntax>ExpressionAnalyzer</code> 移至 <code class=syntax>Syntax Analyzer</code>. <code class=syntax>Syntax Analyzer</code> 现在生成 <code class=syntax>required_source_columns</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6416 rel="external nofollow noreferrer" target=_blank>#6416</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>添加设置 <code class=syntax>joined_subquery_requires_alias</code> 以要求 <code class=syntax>FROM</code> 中存在多个表的子选择和表函数的别名 (比如使用JOIN的查询). <a href=https://github.com/ClickHouse/ClickHouse/pull/6733 rel="external nofollow noreferrer" target=_blank>#6733</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>从 <code class=syntax>ExpressionAnalyzer</code> 中提取 <code class=syntax>GetAggregatesVisitor</code> 类. <a href=https://github.com/ClickHouse/ClickHouse/pull/6458 rel="external nofollow noreferrer" target=_blank>#6458</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li><code class=syntax>system.query_log</code>: 将 <code class=syntax>type</code> 列的数据类型更改为 <code class=syntax>Enum</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6265 rel="external nofollow noreferrer" target=_blank>#6265</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li><code class=syntax>sha256_password</code> 认证插件的静态链接. <a href=https://github.com/ClickHouse/ClickHouse/pull/6512 rel="external nofollow noreferrer" target=_blank>#6512</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>避免设置 <code class=syntax>compile</code> 工作的额外依赖. 在以前的版本中, 用户可能会收到诸如 <code class=syntax>cannot open crti.o</code>、<code class=syntax>unable to find library -lc</code> 等错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6309 rel="external nofollow noreferrer" target=_blank>#6309</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>对可能来自恶意副本的输入进行更多验证. <a href=https://github.com/ClickHouse/ClickHouse/pull/6303 rel="external nofollow noreferrer" target=_blank>#6303</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>现在 <code class=syntax>clickhouse-obfuscator</code> 文件在 <code class=syntax>clickhouse-client</code> 包中可用. 在以前的版本中, 它可用作 <code class=syntax>clickhouse obfuscator</code> (带空格). <a href=https://github.com/ClickHouse/ClickHouse/issues/5816 rel="external nofollow noreferrer" target=_blank>#5816</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6609 rel="external nofollow noreferrer" target=_blank>#6609</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>当我们有至少两个以不同顺序读取至少两个表的查询和另一个对其中一个表执行 DDL 操作的查询时, 修复了死锁. 修复了另一个非常罕见的僵局. <a href=https://github.com/ClickHouse/ClickHouse/pull/6764 rel="external nofollow noreferrer" target=_blank>#6764</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>向 <code class=syntax>system.processes</code> 和 <code class=syntax>system.query_log</code> 添加了 <code class=syntax>os_thread_ids</code> 列以获得更好的调试可能性. <a href=https://github.com/ClickHouse/ClickHouse/pull/6763 rel="external nofollow noreferrer" target=_blank>#6763</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>当 <code class=syntax>sha256_password</code> 用作默认身份验证插件时发生的PHP mysqlnd扩展错误的解决方法 (在<a href=https://github.com/ClickHouse/ClickHouse/issues/6031 rel="external nofollow noreferrer" target=_blank>#6031</a>中描述). <a href=https://github.com/ClickHouse/ClickHouse/pull/6113 rel="external nofollow noreferrer" target=_blank>#6113</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>使用已更改的可空性列删除不需要的位置. <a href=https://github.com/ClickHouse/ClickHouse/pull/6693 rel="external nofollow noreferrer" target=_blank>#6693</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>将 <code class=syntax>queue_max_wait_ms</code> 的默认值设置为零， 因为当前值(五秒) 没有意义. 在极少数情况下, 此设置有任何用处. 添加了设置 <code class=syntax>replace_running_query_max_wait_ms</code>、<code class=syntax>kafka_max_wait_ms</code> 和 <code class=syntax>connection_pool_max_wait_ms</code> 以消除歧义. <a href=https://github.com/ClickHouse/ClickHouse/pull/6692 rel="external nofollow noreferrer" target=_blank>#6692</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>从 <code class=syntax>ExpressionAnalyzer</code> 中提取 <code class=syntax>SelectQueryExpressionAnalyzer</code>. 保留最后一个用于非选择查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/6499 rel="external nofollow noreferrer" target=_blank>#6499</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>删除了重复的输入和输出格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/6239 rel="external nofollow noreferrer" target=_blank>#6239</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>允许用户在连接时覆盖 <code class=syntax>poll_interval</code> 和 <code class=syntax>idle_connection_timeout</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/6230 rel="external nofollow noreferrer" target=_blank>#6230</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>MergeTree</code> 现在有一个附加选项 <code class=syntax>ttl_only_drop_parts</code> (默认情况下禁用) 以避免部分修剪部分, 以便在部分中的所有行都过期时完全删除. <a href=https://github.com/ClickHouse/ClickHouse/pull/6191 rel="external nofollow noreferrer" target=_blank>#6191</a> (<a href=https://github.com/svladykin rel="external nofollow noreferrer" target=_blank>Sergi Vladykin</a>)</li> <li>类型检查集合索引函数. 如果函数类型错误, 则抛出异常. 这修复了 UBSan 的模糊测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6511 rel="external nofollow noreferrer" target=_blank>#6511</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> </ul> <h4 id=performance-improvement-2>性能改进<a class=headerlink href=../amp/#performance-improvement-2 title="Permanent link"> </a></h4> <ul> <li>使用 <code class=syntax>ORDER BY expressions</code> 子句优化查询, 其中 <code class=syntax>expressions</code> 具有与 <code class=syntax>MergeTree</code> 表中的排序键重合的前缀. 此优化由 <code class=syntax>optimize_read_in_order</code> 设置控制. <a href=https://github.com/ClickHouse/ClickHouse/pull/6054 rel="external nofollow noreferrer" target=_blank>#6054</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6629 rel="external nofollow noreferrer" target=_blank>#6629</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>允许在零件装载和拆卸期间使用多个螺纹. <a href=https://github.com/ClickHouse/ClickHouse/issues/6372 rel="external nofollow noreferrer" target=_blank>#6372</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/6074 rel="external nofollow noreferrer" target=_blank>#6074</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6438 rel="external nofollow noreferrer" target=_blank>#6438</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>实现了更新聚合函数状态的批处理变体. 它可能会带来性能优势. <a href=https://github.com/ClickHouse/ClickHouse/pull/6435 rel="external nofollow noreferrer" target=_blank>#6435</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>对函数 <code class=syntax>exp</code>、<code class=syntax>log</code>、<code class=syntax>sigmoid</code>、<code class=syntax>tanh</code>使用 <code class=syntax>FastOps</code> 库. FastOps 是 Michael Parakhin(Yandex CTO)的一个快速向量数学库. <code class=syntax>exp</code> 和 <code class=syntax>log</code> 函数的性能提高了 6 倍以上. <code class=syntax>Float32</code> 参数中的函数 <code class=syntax>exp</code> 和 <code class=syntax>log</code> 将返回 <code class=syntax>Float32</code>(在以前的版本中，它们总是返回 <code class=syntax>Float64</code>). 现在 <code class=syntax>exp(nan)</code> 可能返回 <code class=syntax>inf</code>. <code class=syntax>exp</code> 和 <code class=syntax>log</code> 函数的结果可能不是最接近真实答案的机器可表示数字. <a href=https://github.com/ClickHouse/ClickHouse/pull/6254 rel="external nofollow noreferrer" target=_blank>#6254</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) 使用 Danila Kutenin 变体使 fastops 工作 <a href=https://github.com/ClickHouse/ClickHouse/pull/6317 rel="external nofollow noreferrer" target=_blank> #6317</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>禁用 <code class=syntax>UInt8/16</code> 的连续键优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/6298 rel="external nofollow noreferrer" target=_blank>#6298</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6701 rel="external nofollow noreferrer" target=_blank>#6701</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>通过摆脱 <code class=syntax>ParsedJson::Iterator</code> 中的动态分配, 提高了 <code class=syntax>simdjson</code> 库的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/6479 rel="external nofollow noreferrer" target=_blank>#6479</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>使用 <code class=syntax>mmap()</code> 分配内存时的故障前页面. <a href=https://github.com/ClickHouse/ClickHouse/pull/6667 rel="external nofollow noreferrer" target=_blank>#6667</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>修复 <code class=syntax>Decimal</code> 比较中的性能错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6380 rel="external nofollow noreferrer" target=_blank>#6380</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-4>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-4 title="Permanent link"> </a></h4> <ul> <li>删除编译器 (运行时模板实例化), 因为我们已经赢得了它的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/6646 rel="external nofollow noreferrer" target=_blank>#6646</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了性能测试, 以更孤立的方式显示 gcc-9 中的性能下降. <a href=https://github.com/ClickHouse/ClickHouse/pull/6302 rel="external nofollow noreferrer" target=_blank>#6302</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了表函数<code class=syntax>numbers_mt</code>, 它是<code class=syntax>numbers</code>的多线程版本. 使用哈希函数更新性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6554 rel="external nofollow noreferrer" target=_blank>#6554</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li><code class=syntax>clickhouse-benchmark</code> 中的比较模式. <a href=https://github.com/ClickHouse/ClickHouse/issues/6220 rel="external nofollow noreferrer" target=_blank>#6220</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6343 rel="external nofollow noreferrer" target=_blank>#6343</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>尽最大努力打印堆栈跟踪. 还添加了 <code class=syntax>SIGPROF</code> 作为调试信号以打印正在运行的线程的堆栈跟踪. <a href=https://github.com/ClickHouse/ClickHouse/pull/6529 rel="external nofollow noreferrer" target=_blank>#6529</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>每个函数都在自己的文件中, 第 10 部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/6321 rel="external nofollow noreferrer" target=_blank>#6321</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>删除加倍的 const <code class=syntax>TABLE_IS_READ_ONLY</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6566 rel="external nofollow noreferrer" target=_blank>#6566</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li><code class=syntax>StringHashMap</code> PR <a href=https://github.com/ClickHouse/ClickHouse/issues/5417 rel="external nofollow noreferrer" target=_blank>#5417</a> 的格式更改. <a href=https://github.com/ClickHouse/ClickHouse/pull/6700 rel="external nofollow noreferrer" target=_blank>#6700</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>在<code class=syntax>ExpressionAnalyzer</code> 中创建连接的更好子查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/6824 rel="external nofollow noreferrer" target=_blank>#6824</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>删除冗余条件 (由 PVS Studio 发现). <a href=https://github.com/ClickHouse/ClickHouse/pull/6775 rel="external nofollow noreferrer" target=_blank>#6775</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>分离<code class=syntax>ReverseIndex</code>的哈希表接口. <a href=https://github.com/ClickHouse/ClickHouse/pull/6672 rel="external nofollow noreferrer" target=_blank>#6672</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>重构设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/6689 rel="external nofollow noreferrer" target=_blank>#6689</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>为 <code class=syntax>set</code> 索引函数添加注释. <a href=https://github.com/ClickHouse/ClickHouse/pull/6319 rel="external nofollow noreferrer" target=_blank>#6319</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>在 Linux 上的调试版本中提高 OOM 分数. <a href=https://github.com/ClickHouse/ClickHouse/pull/6152 rel="external nofollow noreferrer" target=_blank>#6152</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>HDFS HA 现在可用于调试版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/6650 rel="external nofollow noreferrer" target=_blank>#6650</a> (<a href=https://github.com/weiqxu rel="external nofollow noreferrer" target=_blank>Weiqing Xu</a>)</li> <li>向 <code class=syntax>transform_query_for_external_database</code> 添加了一个测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6388 rel="external nofollow noreferrer" target=_blank>#6388</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为 Kafka 表添加多个物化视图的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6509 rel="external nofollow noreferrer" target=_blank>#6509</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>制定更好的构建方案. <a href=https://github.com/ClickHouse/ClickHouse/pull/6500 rel="external nofollow noreferrer" target=_blank>#6500</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复了 <code class=syntax>test_external_dictionaries</code> 集成, 以防它在非 root 用户下执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/6507 rel="external nofollow noreferrer" target=_blank>#6507</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>当写入数据包的总大小超过<code class=syntax>DBMS_DEFAULT_BUFFER_SIZE</code>时, 该错误会重现. <a href=https://github.com/ClickHouse/ClickHouse/pull/6204 rel="external nofollow noreferrer" target=_blank>#6204</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>添加了对 <code class=syntax>RENAME</code> 表竞争条件的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6752 rel="external nofollow noreferrer" target=_blank>#6752</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>避免 <code class=syntax>KILL QUERY</code> 中设置的数据竞争. <a href=https://github.com/ClickHouse/ClickHouse/pull/6753 rel="external nofollow noreferrer" target=_blank>#6753</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加集成测试以通过缓存字典处理错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6755 rel="external nofollow noreferrer" target=_blank>#6755</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>在 Mac OS 上禁用解析 ELF 对象文件, 因为它没有意义. <a href=https://github.com/ClickHouse/ClickHouse/pull/6578 rel="external nofollow noreferrer" target=_blank>#6578</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>尝试使变更日志生成器更好. <a href=https://github.com/ClickHouse/ClickHouse/pull/6327 rel="external nofollow noreferrer" target=_blank>#6327</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 <code class=syntax>-Wshadow</code> 开关添加到 GCC. <a href=https://github.com/ClickHouse/ClickHouse/pull/6325 rel="external nofollow noreferrer" target=_blank>#6325</a> (<a href=https://github.com/kreuzerkrieg rel="external nofollow noreferrer" target=_blank>kreuzerkrieg</a>)</li> <li>删除了对 <code class=syntax>mimalloc</code> 支持的过时代码. <a href=https://github.com/ClickHouse/ClickHouse/pull/6715 rel="external nofollow noreferrer" target=_blank>#6715</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>zlib-ng</code> 确定 x86 功能并将此信息保存到全局变量. 这是在 defalteInit 调用中完成的, 它可以由不同的线程同时进行. 为避免多线程写入, 请在库启动时执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/6141 rel="external nofollow noreferrer" target=_blank>#6141</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>对在 <a href=https://github.com/ClickHouse/ClickHouse/issues/5192 rel="external nofollow noreferrer" target=_blank>#5192</a> 中修复的连接中的错误进行回归测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6147 rel="external nofollow noreferrer" target=_blank>#6147</a> (<a href=https://github.com/theruziev rel="external nofollow noreferrer" target=_blank>Bakhtiyor Ruziev</a>)</li> <li>修复了 MSan 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/6144 rel="external nofollow noreferrer" target=_blank>#6144</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复抖动 TTL 测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6782 rel="external nofollow noreferrer" target=_blank>#6782</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复了 <code class=syntax>MergeTreeDataPart::is_frozen</code> 字段中的错误数据竞争. <a href=https://github.com/ClickHouse/ClickHouse/pull/6583 rel="external nofollow noreferrer" target=_blank>#6583</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了模糊测试中的超时. 在以前的版本中, 它设法在查询 <code class=syntax>SELECT * FROM numbers_mt(gccMurmurHash(''))</code> 中找到错误挂断. <a href=https://github.com/ClickHouse/ClickHouse/pull/6582 rel="external nofollow noreferrer" target=_blank>#6582</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>向列的 <code class=syntax>static_cast</code> 添加调试检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/6581 rel="external nofollow noreferrer" target=_blank>#6581</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在官方 RPM 包中支持 Oracle Linux. <a href=https://github.com/ClickHouse/ClickHouse/issues/6356 rel="external nofollow noreferrer" target=_blank>#6356</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6585 rel="external nofollow noreferrer" target=_blank>#6585</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 json perftests 从 <code class=syntax>once</code> 更改为 <code class=syntax>loop</code> 类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/6536 rel="external nofollow noreferrer" target=_blank>#6536</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li><code class=syntax>odbc-bridge.cpp</code> 定义了 <code class=syntax>main()</code>, 因此它不应包含在 <code class=syntax>clickhouse-lib</code> 中. <a href=https://github.com/ClickHouse/ClickHouse/pull/6538 rel="external nofollow noreferrer" target=_blank>#6538</a> (<a href=https://github.com/orivej rel="external nofollow noreferrer" target=_blank>Orivej Desh</a>)</li> <li>测试 <code class=syntax>FULL|RIGHT JOIN</code> 中的崩溃, 右表的键为空. <a href=https://github.com/ClickHouse/ClickHouse/pull/6362 rel="external nofollow noreferrer" target=_blank>#6362</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>添加了对别名扩展限制的测试以防万一. <a href=https://github.com/ClickHouse/ClickHouse/pull/6442 rel="external nofollow noreferrer" target=_blank>#6442</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在适当的地方从 <code class=syntax>boost::filesystem</code> 切换到 <code class=syntax>std::filesystem</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6253 rel="external nofollow noreferrer" target=_blank>#6253</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6385 rel="external nofollow noreferrer" target=_blank>#6385</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>向网站添加了 RPM 包. <a href=https://github.com/ClickHouse/ClickHouse/pull/6251 rel="external nofollow noreferrer" target=_blank>#6251</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 <code class=syntax>IN</code> 部分添加修复 <code class=syntax>Unknown identifier</code> 异常的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6708 rel="external nofollow noreferrer" target=_blank>#6708</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>简化<code class=syntax>shared_ptr_helper</code>, 因为人们难以理解它. <a href=https://github.com/ClickHouse/ClickHouse/pull/6675 rel="external nofollow noreferrer" target=_blank>#6675</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了针对固定 Gorilla 和 DoubleDelta 编解码器的性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6179 rel="external nofollow noreferrer" target=_blank>#6179</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>将集成测试 <code class=syntax>test_dictionaries</code> 拆分为 4 个单独的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6776 rel="external nofollow noreferrer" target=_blank>#6776</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复 <code class=syntax>PipelineExecutor</code> 中的 PVS-Studio 警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/6777 rel="external nofollow noreferrer" target=_blank>#6777</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>允许在 ASan 中使用 <code class=syntax>library</code> 字典源. <a href=https://github.com/ClickHouse/ClickHouse/pull/6482 rel="external nofollow noreferrer" target=_blank>#6482</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了从 PR 列表生成变更日志的选项. <a href=https://github.com/ClickHouse/ClickHouse/pull/6350 rel="external nofollow noreferrer" target=_blank>#6350</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>读取时锁定<code class=syntax>TinyLog</code>存储. <a href=https://github.com/ClickHouse/ClickHouse/pull/6226 rel="external nofollow noreferrer" target=_blank>#6226</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>检查 CI 中损坏的符号链接. <a href=https://github.com/ClickHouse/ClickHouse/pull/6634 rel="external nofollow noreferrer" target=_blank>#6634</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>增加 <code class=syntax>stack overflow</code> 测试的超时时间，因为在调试构建中可能需要很长时间. <a href=https://github.com/ClickHouse/ClickHouse/pull/6637 rel="external nofollow noreferrer" target=_blank>#6637</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了对双空格的检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/6643 rel="external nofollow noreferrer" target=_blank>#6643</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复使用消毒剂构建时的 <code class=syntax>new/delete</code> 内存跟踪. 跟踪不清楚. 它只防止测试中的内存限制异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/6450 rel="external nofollow noreferrer" target=_blank>#6450</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>在链接时启用对未定义符号的检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/6453 rel="external nofollow noreferrer" target=_blank>#6453</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>避免每天重建 <code class=syntax>hyperscan</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/6307 rel="external nofollow noreferrer" target=_blank>#6307</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 <code class=syntax>ProtobufWriter</code> 中的 UBSan 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/6163 rel="external nofollow noreferrer" target=_blank>#6163</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>不允许将查询分析器与消毒剂一起使用, 因为它不兼容. <a href=https://github.com/ClickHouse/ClickHouse/pull/6769 rel="external nofollow noreferrer" target=_blank>#6769</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加测试以在计时器失败后重新加载字典. <a href=https://github.com/ClickHouse/ClickHouse/pull/6114 rel="external nofollow noreferrer" target=_blank>#6114</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复 <code class=syntax>PipelineExecutor::prepareProcessor</code> 参数类型的不一致. <a href=https://github.com/ClickHouse/ClickHouse/pull/6494 rel="external nofollow noreferrer" target=_blank>#6494</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>添加了对错误 URI 的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6493 rel="external nofollow noreferrer" target=_blank>#6493</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>向 <code class=syntax>CAST</code> 函数添加了更多检查. 这应该在模糊测试中获得有关分段错误的更多信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/6346 rel="external nofollow noreferrer" target=_blank>#6346</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>为在本地构建镜像的 <code class=syntax>docker/builder</code> 容器添加了 <code class=syntax>gcc-9</code> 支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/6333 rel="external nofollow noreferrer" target=_blank>#6333</a> (<a href=https://github.com/NanoBjorn rel="external nofollow noreferrer" target=_blank>Gleb Novikov</a>)</li> <li>使用 <code class=syntax>Low Cardinality(String)</code> 测试主键. <a href=https://github.com/ClickHouse/ClickHouse/issues/5044 rel="external nofollow noreferrer" target=_blank>#5044</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6219 rel="external nofollow noreferrer" target=_blank>#6219</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>修复了受缓慢堆栈跟踪打印影响的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6315 rel="external nofollow noreferrer" target=_blank>#6315</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 <a href=https://github.com/ClickHouse/ClickHouse/pull/6029 rel="external nofollow noreferrer" target=_blank>#6029</a> 中修复的<code class=syntax>groupUniqArray</code> 中添加崩溃测试用例. <a href=https://github.com/ClickHouse/ClickHouse/issues/4402 rel="external nofollow noreferrer" target=_blank>#4402</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6129 rel="external nofollow noreferrer" target=_blank>#6129</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>修复指数变异测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6645 rel="external nofollow noreferrer" target=_blank>#6645</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>在性能测试中, 不要读取我们没有运行的查询的查询日志. <a href=https://github.com/ClickHouse/ClickHouse/pull/6427 rel="external nofollow noreferrer" target=_blank>#6427</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>现在可以使用任何低基数类型创建物化视图, 而不管有关可疑低基数类型的设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/6428 rel="external nofollow noreferrer" target=_blank>#6428</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>更新了 <code class=syntax>send_logs_level</code> 设置的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6207 rel="external nofollow noreferrer" target=_blank>#6207</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复 gcc-8.2 下的构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/6196 rel="external nofollow noreferrer" target=_blank>#6196</a> (<a href=https://github.com/zlobober rel="external nofollow noreferrer" target=_blank>Max Akhmedov</a>)</li> <li>使用内部 libc++ 修复构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/6724 rel="external nofollow noreferrer" target=_blank>#6724</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>使用 <code class=syntax>rdkafka</code> 库修复共享构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/6101 rel="external nofollow noreferrer" target=_blank>#6101</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>Mac OS 版本的修复 (不完整). <a href=https://github.com/ClickHouse/ClickHouse/pull/6390 rel="external nofollow noreferrer" target=_blank>#6390</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6429 rel="external nofollow noreferrer" target=_blank>#6429</a> (<a href=https://github.com/alex-zaitsev rel="external nofollow noreferrer" target=_blank>alex-zaitsev</a>)</li> <li>修复 <code class=syntax>splitted</code> 构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/6618 rel="external nofollow noreferrer" target=_blank>#6618</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>其他构建修复: <a href=https://github.com/ClickHouse/ClickHouse/pull/6186 rel="external nofollow noreferrer" target=_blank>#6186</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6486 rel="external nofollow noreferrer" target=_blank>#6486</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6348 rel="external nofollow noreferrer" target=_blank>#6348</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6744 rel="external nofollow noreferrer" target=_blank>#6744</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6016 rel="external nofollow noreferrer" target=_blank>#6016</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6421 rel="external nofollow noreferrer" target=_blank>#6421</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6491 rel="external nofollow noreferrer" target=_blank>#6491</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h4 id=backward-incompatible-change-3>向后不兼容的更新<a class=headerlink href=../amp/#backward-incompatible-change-3 title="Permanent link"> </a></h4> <ul> <li>删除了很少使用的表函数 <code class=syntax>catBoostPool</code> 和存储 <code class=syntax>CatBoostPool</code>. 如果您使用过此表格功能, 请写邮件至 <code class=syntax>clickhouse-feedback@yandex-team.com</code>. 请注意, CatBoost 集成仍然存在并将得到支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/6279 rel="external nofollow noreferrer" target=_blank>#6279</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>默认情况下禁用 <code class=syntax>ANY RIGHT JOIN</code> 和 <code class=syntax>ANY FULL JOIN</code>. 设置 <code class=syntax>any_join_distinct_right_table_keys</code> 设置以启用它们. <a href=https://github.com/ClickHouse/ClickHouse/issues/5126 rel="external nofollow noreferrer" target=_blank>#5126</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6351 rel="external nofollow noreferrer" target=_blank>#6351</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h2 id=clickhouse-release-19-13>ClickHouse 版本 19.13<a class=headerlink href=../amp/#clickhouse-release-19-13 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-13-6-51-2019-10-02>ClickHouse 版本 19.13.6.51, 2019-10-02<a class=headerlink href=../amp/#clickhouse-release-19-13-6-51-2019-10-02 title="Permanent link"> </a></h3> <h4 id=bug-fix-9>Bug 修复<a class=headerlink href=../amp/#bug-fix-9 title="Permanent link"> </a></h4> <ul> <li>此版本还包含 19.11.12.69 的所有错误修复.</li> </ul> <h3 id=clickhouse-release-19-13-5-44-2019-09-20>ClickHouse 版本 19.13.5.44, 2019-09-20<a class=headerlink href=../amp/#clickhouse-release-19-13-5-44-2019-09-20 title="Permanent link"> </a></h3> <h4 id=bug-fix-10>Bug 修复<a class=headerlink href=../amp/#bug-fix-10 title="Permanent link"> </a></h4> <ul> <li>此版本还包含 19.14.6.12 的所有错误修复.</li> <li>修复了在 Zookeeper 不可访问时对复制表执行 <code class=syntax>DROP</code> 查询时可能出现的表不一致状态. <a href=https://github.com/ClickHouse/ClickHouse/issues/6045 rel="external nofollow noreferrer" target=_blank>#6045</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6413 rel="external nofollow noreferrer" target=_blank>#6413</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>修复 StorageMerge 中的数据竞争. <a href=https://github.com/ClickHouse/ClickHouse/pull/6717 rel="external nofollow noreferrer" target=_blank>#6717</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复查询分析器中引入的错误, 该错误导致来自套接字的无休止的接收. <a href=https://github.com/ClickHouse/ClickHouse/pull/6386 rel="external nofollow noreferrer" target=_blank>#6386</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复在布尔值上执行 <code class=syntax>JSONExtractRaw</code> 函数时 CPU 使用率过高的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/6208 rel="external nofollow noreferrer" target=_blank>#6208</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复了推送到物化视图时的回归. <a href=https://github.com/ClickHouse/ClickHouse/pull/6415 rel="external nofollow noreferrer" target=_blank>#6415</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>表函数 <code class=syntax>url</code> 存在允许攻击者在请求中注入任意 HTTP 头的漏洞. 此问题由 <a href=https://github.com/NSTikhomirov rel="external nofollow noreferrer" target=_blank>Nikita Tikhomirov</a> 发现. <a href=https://github.com/ClickHouse/ClickHouse/pull/6466 rel="external nofollow noreferrer" target=_blank>#6466</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 Set index 中无用的 <code class=syntax>AST</code> 检查. <a href=https://github.com/ClickHouse/ClickHouse/issues/6510 rel="external nofollow noreferrer" target=_blank>#6510</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6651 rel="external nofollow noreferrer" target=_blank>#6651</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>修复了对嵌入在查询中的 <code class=syntax>AggregateFunction</code> 值的解析. <a href=https://github.com/ClickHouse/ClickHouse/issues/6575 rel="external nofollow noreferrer" target=_blank>#6575</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6773 rel="external nofollow noreferrer" target=_blank>#6773</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>修复了<code class=syntax>trim</code> 函数族的错误行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/6647 rel="external nofollow noreferrer" target=_blank>#6647</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-13-4-32-2019-09-10>ClickHouse 版本 19.13.4.32, 2019-09-10<a class=headerlink href=../amp/#clickhouse-release-19-13-4-32-2019-09-10 title="Permanent link"> </a></h3> <h4 id=bug-fix-11>Bug 修复<a class=headerlink href=../amp/#bug-fix-11 title="Permanent link"> </a></h4> <ul> <li>此版本还包含 19.11.9.52 和 19.11.10.54 的所有错误安全修复.</li> <li>修复了 <code class=syntax>system.parts</code> 表和 <code class=syntax>ALTER</code> 查询中的数据争用. <a href=https://github.com/ClickHouse/ClickHouse/issues/6245 rel="external nofollow noreferrer" target=_blank>#6245</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6513 rel="external nofollow noreferrer" target=_blank>#6513</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了在从带有样本和 prewhere 的空分布式表中读取时发生的流中不匹配的标头. <a href=https://github.com/ClickHouse/ClickHouse/issues/6167 rel="external nofollow noreferrer" target=_blank>#6167</a> (<a href=https://github.com/fancyqlx rel="external nofollow noreferrer" target=_blank>Lixiang Qian</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6823 rel="external nofollow noreferrer" target=_blank>#6823</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了在带有元组的子查询中使用 <code class=syntax>IN</code> 子句时崩溃的问题. <a href=https://github.com/ClickHouse/ClickHouse/issues/6125 rel="external nofollow noreferrer" target=_blank>#6125</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6550 rel="external nofollow noreferrer" target=_blank>#6550</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复 <code class=syntax>GLOBAL JOIN ON</code> 部分中列名相同的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/6181 rel="external nofollow noreferrer" target=_blank>#6181</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复将类型转换为不支持它的 <code class=syntax>Decimal</code> 时的崩溃。 改为抛出异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/6297 rel="external nofollow noreferrer" target=_blank>#6297</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了 <code class=syntax>extractAll()</code> 函数中的崩溃问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/6644 rel="external nofollow noreferrer" target=_blank>#6644</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li><code class=syntax>MySQL</code>、<code class=syntax>ODBC</code>、<code class=syntax>JDBC</code> 表函数的查询转换现在可以正常用于带有多个 <code class=syntax>AND</code> 表达式的 <code class=syntax>SELECT WHERE</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/issues/6381 rel="external nofollow noreferrer" target=_blank>#6381</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6676 rel="external nofollow noreferrer" target=_blank>#6676</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>为 MySQL 8 集成添加了先前的声明检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/6569 rel="external nofollow noreferrer" target=_blank>#6569</a> (<a href=https://github.com/rafaeldtinoco rel="external nofollow noreferrer" target=_blank>Rafael David Tinoco</a>)</li> </ul> <h4 id=security-fix-1>安全修复<a class=headerlink href=../amp/#security-fix-1 title="Permanent link"> </a></h4> <ul> <li>修复解压阶段编解码器的两个漏洞 (恶意用户可以编造压缩数据导致解压缓冲区溢出). <a href=https://github.com/ClickHouse/ClickHouse/pull/6670 rel="external nofollow noreferrer" target=_blank>#6670</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h3 id=clickhouse-release-19-13-3-26-2019-08-22>ClickHouse 版本 19.13.3.26, 2019-08-22<a class=headerlink href=../amp/#clickhouse-release-19-13-3-26-2019-08-22 title="Permanent link"> </a></h3> <h4 id=bug-fix-12>Bug 修复<a class=headerlink href=../amp/#bug-fix-12 title="Permanent link"> </a></h4> <ul> <li>修复带有 <code class=syntax>enable_mixed_granularity_parts=1</code> 的表的 <code class=syntax>ALTER TABLE ... UPDATE</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/6543 rel="external nofollow noreferrer" target=_blank>#6543</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>用带有元组的子查询的 IN 子句时修复 NPE. <a href=https://github.com/ClickHouse/ClickHouse/issues/6125 rel="external nofollow noreferrer" target=_blank>#6125</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6550 rel="external nofollow noreferrer" target=_blank>#6550</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了一个问题, 如果一个陈旧的副本变得活跃, 它可能仍然有被 DROP PARTITION 删除的数据部分. <a href=https://github.com/ClickHouse/ClickHouse/issues/6522 rel="external nofollow noreferrer" target=_blank>#6522</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6523 rel="external nofollow noreferrer" target=_blank>#6523</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>解决了解析 CSV 的问题. <a href=https://github.com/ClickHouse/ClickHouse/issues/6426 rel="external nofollow noreferrer" target=_blank>#6426</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6559 rel="external nofollow noreferrer" target=_blank>#6559</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了 system.parts 表和 ALTER 查询中的数据竞争. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6245 rel="external nofollow noreferrer" target=_blank>#6245</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6513 rel="external nofollow noreferrer" target=_blank>#6513</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了可能导致内存损坏的突变中的错误代码. 修复了由于从 <code class=syntax>system.parts</code> 或 <code class=syntax>system.parts_columns</code> 并发 <code class=syntax>DROP TABLE</code> 和 <code class=syntax>SELECT</code> 而可能发生的读取地址 <code class=syntax>0x14c0</code> 的段错误. 修复了准备突变查询时的竞争条件. 修复复制表的 <code class=syntax>OPTIMIZE</code> 和 ALTER 等并发修改操作导致的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/6514 rel="external nofollow noreferrer" target=_blank>#6514</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了在跳过索引的表上进行<code class=syntax>ALTER DELETE</code>查询后可能丢失的数据. <a href=https://github.com/ClickHouse/ClickHouse/issues/6224 rel="external nofollow noreferrer" target=_blank>#6224</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6282 rel="external nofollow noreferrer" target=_blank>#6282</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> </ul> <h4 id=security-fix-2>安全修复<a class=headerlink href=../amp/#security-fix-2 title="Permanent link"> </a></h4> <ul> <li>如果攻击者拥有对 ZooKeeper 的写访问权限, 并且能够从运行 ClickHouse 的网络中运行可用的自定义服务器, 则它可以创建自定义构建的恶意服务器, 该服务器将充当 ClickHouse 副本并将其注册到 ZooKeeper 中. 当另一个副本从恶意副本中获取数据部分时, 它可以强制 clickhouse-server 写入文件系统上的任意路径. 由 Yandex 信息安全团队 Eldar Zaitov 发现. <a href=https://github.com/ClickHouse/ClickHouse/pull/6247 rel="external nofollow noreferrer" target=_blank>#6247</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-13-2-19-2019-08-14>ClickHouse 版本 19.13.2.19, 2019-08-14<a class=headerlink href=../amp/#clickhouse-release-19-13-2-19-2019-08-14 title="Permanent link"> </a></h3> <h4 id=new-feature-5>新特征<a class=headerlink href=../amp/#new-feature-5 title="Permanent link"> </a></h4> <ul> <li>查询级别的采样分析器. <a href=https://gist.github.com/alexey-milovidov/92758583dd41c24c360fdb8d6a4da194 rel="external nofollow noreferrer" target=_blank>Example</a>. <a href=https://github.com/ClickHouse/ClickHouse/issues/4247 rel="external nofollow noreferrer" target=_blank>#4247</a> (<a href=https://github.com/laplab rel="external nofollow noreferrer" target=_blank>laplab</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6124 rel="external nofollow noreferrer" target=_blank>#6124</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6250 rel="external nofollow noreferrer" target=_blank>#6250</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6283 rel="external nofollow noreferrer" target=_blank>#6283</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6386 rel="external nofollow noreferrer" target=_blank>#6386</a></li> <li>允许使用 <code class=syntax>COLUMNS('regexp')</code> 表达式指定一个列列表, 它的工作方式类似于更复杂的 <code class=syntax>*</code> 星号变体. <a href=https://github.com/ClickHouse/ClickHouse/pull/5951 rel="external nofollow noreferrer" target=_blank>#5951</a> (<a href=https://github.com/mfridental rel="external nofollow noreferrer" target=_blank>mfridental</a>), (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>CREATE TABLE AS table_function()</code> 现在可以了. <a href=https://github.com/ClickHouse/ClickHouse/pull/6057 rel="external nofollow noreferrer" target=_blank>#6057</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>于随机梯度下降的 Adam 优化器默认用于 <code class=syntax>stochasticLinearRegression()</code> 和 <code class=syntax>stochasticLogisticRegression()</code> 聚合函数, 因为它在几乎没有任何调整的情况下显示出良好的质量. <a href=https://github.com/ClickHouse/ClickHouse/pull/6000 rel="external nofollow noreferrer" target=_blank>#6000</a> (<a href=https://github.com/Quid37 rel="external nofollow noreferrer" target=_blank>Quid37</a>)</li> <li>添加了使用自定义周数的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/5212 rel="external nofollow noreferrer" target=_blank>#5212</a> (<a href=https://github.com/andyyzh rel="external nofollow noreferrer" target=_blank>Andy Yang</a>)</li> <li>RENAME` 查询现在适用于所有存储. <a href=https://github.com/ClickHouse/ClickHouse/pull/5953 rel="external nofollow noreferrer" target=_blank>#5953</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>现在, 无论服务器设置中指定的日志级别如何, 客户端都可以通过设置 <code class=syntax>send_logs_level</code> 从服务器接收任何所需级别的日志. <a href=https://github.com/ClickHouse/ClickHouse/pull/5964 rel="external nofollow noreferrer" target=_blank>#5964</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> </ul> <h4 id=backward-incompatible-change-4>向后不兼容的更新<a class=headerlink href=../amp/#backward-incompatible-change-4 title="Permanent link"> </a></h4> <ul> <li>默认情况下启用设置 <code class=syntax>input_format_defaults_for_omited_fields</code>。 分布式表中的插入需要此设置在集群上相同 (您需要在滚动更新之前设置它). 它可以为 <code class=syntax>JSONEachRow</code> 和 <code class=syntax>CSV*</code> 格式的省略字段计算复杂的默认表达式. 它应该是预期的行为, 但可能导致可以忽略不计的性能差异. <a href=https://github.com/ClickHouse/ClickHouse/pull/6043 rel="external nofollow noreferrer" target=_blank>#6043</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>), <a href=https://github.com/ClickHouse/ClickHouse/pull/5625 rel="external nofollow noreferrer" target=_blank>#5625</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> </ul> <h4 id=experimental-features>实验功能<a class=headerlink href=../amp/#experimental-features title="Permanent link"> </a></h4> <ul> <li>新的查询处理管道. 使用 <code class=syntax>experimental_use_processors=1</code> 选项来启用它. 用于自己的麻烦. <a href=https://github.com/ClickHouse/ClickHouse/pull/4914 rel="external nofollow noreferrer" target=_blank>#4914</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> </ul> <h4 id=bug-fix-13>Bug 修复<a class=headerlink href=../amp/#bug-fix-13 title="Permanent link"> </a></h4> <ul> <li>Kafka 集成已在此版本中修复.</li> <li>修复了大 <code class=syntax>DoubleDelta</code> 值的 <code class=syntax>Int64</code> 的 <code class=syntax>DoubleDelta</code> 编码, 改进了 <code class=syntax>Int32</code> 随机数据的 <code class=syntax>DoubleDelta</code> 编码. <a href=https://github.com/ClickHouse/ClickHouse/pull/5998 rel="external nofollow noreferrer" target=_blank>#5998</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>如果设置 <code class=syntax>merge_tree_uniform_read_distribution</code> 设置为 0, 则修复了对 <code class=syntax>max_rows_to_read</code> 的高估. <a href=https://github.com/ClickHouse/ClickHouse/pull/6019 rel="external nofollow noreferrer" target=_blank>#6019</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=improvement-4>改进<a class=headerlink href=../amp/#improvement-4 title="Permanent link"> </a></h4> <ul> <li>如果 <code class=syntax>config.d</code> 文件没有对应的根元素作为配置文件, 则抛出异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/6123 rel="external nofollow noreferrer" target=_blank>#6123</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> </ul> <h4 id=performance-improvement-3>性能改进<a class=headerlink href=../amp/#performance-improvement-3 title="Permanent link"> </a></h4> <ul> <li>优化 <code class=syntax>count()</code>. 现在它使用最小的列 (如果可能). <a href=https://github.com/ClickHouse/ClickHouse/pull/6028 rel="external nofollow noreferrer" target=_blank>#6028</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-5>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-5 title="Permanent link"> </a></h4> <ul> <li>报告性能测试中的内存使用情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/5899 rel="external nofollow noreferrer" target=_blank>#5899</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>使用外部 <code class=syntax>libcxx</code> 修复构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/6010 rel="external nofollow noreferrer" target=_blank>#6010</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>使用 <code class=syntax>rdkafka</code> 库修复共享构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/6101 rel="external nofollow noreferrer" target=_blank>#6101</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> </ul> <h2 id=clickhouse-release-19-11>ClickHouse 版本 19.11<a class=headerlink href=../amp/#clickhouse-release-19-11 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-11-13-74-2019-11-01>ClickHouse 版本 19.11.13.74, 2019-11-01<a class=headerlink href=../amp/#clickhouse-release-19-11-13-74-2019-11-01 title="Permanent link"> </a></h3> <h4 id=bug-fix-14>Bug 修复<a class=headerlink href=../amp/#bug-fix-14 title="Permanent link"> </a></h4> <ul> <li>修复了 <code class=syntax>ALTER MODIFY COLUMN</code> 和垂直合并中的罕见崩溃，当合并/更改的部分之一为空时 (0 行). <a href=https://github.com/ClickHouse/ClickHouse/pull/6780 rel="external nofollow noreferrer" target=_blank>#6780</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>手动更新<code class=syntax>SIMDJSON</code>. 这修复了使用虚假 json 诊断消息可能导致 stderr 文件泛滥的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/7548 rel="external nofollow noreferrer" target=_blank>#7548</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>修复了用于突变的 <code class=syntax>mrk</code> 文件扩展名的错误. (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> </ul> <h3 id=clickhouse-release-19-11-12-69-2019-10-02>ClickHouse 版本 19.11.12.69, 2019-10-02<a class=headerlink href=../amp/#clickhouse-release-19-11-12-69-2019-10-02 title="Permanent link"> </a></h3> <h4 id=bug-fix-15>Bug 修复<a class=headerlink href=../amp/#bug-fix-15 title="Permanent link"> </a></h4> <ul> <li>修复了大型表上复杂键的索引分析性能下降. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6924 rel="external nofollow noreferrer" target=_blank>#6924</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7075 rel="external nofollow noreferrer" target=_blank>#7075</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用分布式引擎在表中发送数据时避免罕见的 SIGSEGV (<code class=syntax>Failed to send batch: file with index XXXXX is absent</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/7032 rel="external nofollow noreferrer" target=_blank>#7032</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>使用多个连接修复 <code class=syntax>Unknown identifier</code> . 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5254 rel="external nofollow noreferrer" target=_blank>#5254</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7022 rel="external nofollow noreferrer" target=_blank>#7022</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h3 id=clickhouse-release-19-11-11-57-2019-09-13>ClickHouse 版本 19.11.11.57, 2019-09-13<a class=headerlink href=../amp/#clickhouse-release-19-11-11-57-2019-09-13 title="Permanent link"> </a></h3> <ul> <li>修复从 Kafka 空主题中选择时导致段错误的逻辑错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/6902 rel="external nofollow noreferrer" target=_blank>#6902</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6909 rel="external nofollow noreferrer" target=_blank>#6909</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复函数 <code class=syntax>АrrayEnumerateUniqRanked</code> 在参数中带有空数组. <a href=https://github.com/ClickHouse/ClickHouse/pull/6928 rel="external nofollow noreferrer" target=_blank>#6928</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h3 id=clickhouse-release-19-11-10-54-2019-09-10>ClickHouse 版本 19.11.10.54, 2019-09-10<a class=headerlink href=../amp/#clickhouse-release-19-11-10-54-2019-09-10 title="Permanent link"> </a></h3> <h4 id=bug-fix-16>Bug 修复<a class=headerlink href=../amp/#bug-fix-16 title="Permanent link"> </a></h4> <ul> <li>手动为 Kafka 消息存储偏移量，以便能够一次为所有分区提交所有偏移量。 修复了 <code class=syntax>one consumer - many partitions</code> 场景中的潜在重复. <a href=https://github.com/ClickHouse/ClickHouse/pull/6872 rel="external nofollow noreferrer" target=_blank>#6872</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> </ul> <h3 id=clickhouse-release-19-11-9-52-2019-09-6>ClickHouse 版本 19.11.9.52, 2019-09-6<a class=headerlink href=../amp/#clickhouse-release-19-11-9-52-2019-09-6 title="Permanent link"> </a></h3> <ul> <li>改进缓存字典中的错误处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/6737 rel="external nofollow noreferrer" target=_blank>#6737</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复了函数 <code class=syntax>arrayEnumerateUniqRanked</code> 中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6779 rel="external nofollow noreferrer" target=_blank>#6779</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>在从 JSON 中提取 <code class=syntax>Tuple</code> 时修复 <code class=syntax>JSONExtract</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/6718 rel="external nofollow noreferrer" target=_blank>#6718</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复了在跳过索引的表上进行<code class=syntax>ALTER DELETE</code>查询后可能丢失的数据. <a href=https://github.com/ClickHouse/ClickHouse/issues/6224 rel="external nofollow noreferrer" target=_blank>#6224</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6282 rel="external nofollow noreferrer" target=_blank>#6282</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>修复了性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6392 rel="external nofollow noreferrer" target=_blank>#6392</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>Parquet: 修复读取布尔列. <a href=https://github.com/ClickHouse/ClickHouse/pull/6579 rel="external nofollow noreferrer" target=_blank>#6579</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了常量参数的 <code class=syntax>nullIf</code> 函数的错误行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/6518 rel="external nofollow noreferrer" target=_blank>#6518</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/6580 rel="external nofollow noreferrer" target=_blank>#6580</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复正常服务器重启时Kafka消息重复问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/6597 rel="external nofollow noreferrer" target=_blank>#6597</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复了长时间 <code class=syntax>ALTER UPDATE</code> 或 <code class=syntax>ALTER DELETE</code> 可能会阻止常规合并运行的问题. 如果没有足够的可用线程, 则防止执行突变. <a href=https://github.com/ClickHouse/ClickHouse/issues/6502 rel="external nofollow noreferrer" target=_blank>#6502</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6617 rel="external nofollow noreferrer" target=_blank>#6617</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了在服务器配置文件中处理 <code class=syntax>timezone</code> 的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6709 rel="external nofollow noreferrer" target=_blank>#6709</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 kafka 测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/6805 rel="external nofollow noreferrer" target=_blank>#6805</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> </ul> <h4 id=security-fix-3>安全修复<a class=headerlink href=../amp/#security-fix-3 title="Permanent link"> </a></h4> <ul> <li>果攻击者拥有对 ZooKeeper 的写访问权限, 并且能够从运行 ClickHouse 的网络中运行可用的自定义服务器, 则它可以创建自定义构建的恶意服务器, 该服务器将充当 ClickHouse 副本并将其注册到 ZooKeeper 中. 当另一个副本从恶意副本中获取数据部分时, 它可以强制 clickhouse-server 写入文件系统上的任意路径. 由 Yandex 信息安全团队 Eldar Zaitov 发现. <a href=https://github.com/ClickHouse/ClickHouse/pull/6247 rel="external nofollow noreferrer" target=_blank>#6247</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-11-8-46-2019-08-22>ClickHouse 版本 19.11.8.46, 2019-08-22<a class=headerlink href=../amp/#clickhouse-release-19-11-8-46-2019-08-22 title="Permanent link"> </a></h3> <h4 id=bug-fix-17>Bug 修复<a class=headerlink href=../amp/#bug-fix-17 title="Permanent link"> </a></h4> <ul> <li>修复带有 <code class=syntax>enable_mixed_granularity_parts=1</code> 的表的 <code class=syntax>ALTER TABLE ... UPDATE</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/6543 rel="external nofollow noreferrer" target=_blank>#6543</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>用带有元组的子查询的 IN 子句时修复 NPE. <a href=https://github.com/ClickHouse/ClickHouse/issues/6125 rel="external nofollow noreferrer" target=_blank>#6125</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6550 rel="external nofollow noreferrer" target=_blank>#6550</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了一个问题, 如果一个陈旧的副本变得活跃, 它可能仍然有被 DROP PARTITION 删除的数据部分. <a href=https://github.com/ClickHouse/ClickHouse/issues/6522 rel="external nofollow noreferrer" target=_blank>#6522</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6523 rel="external nofollow noreferrer" target=_blank>#6523</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了解析 CSV 的问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/6426 rel="external nofollow noreferrer" target=_blank>#6426</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6559 rel="external nofollow noreferrer" target=_blank>#6559</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了 system.parts 表和 ALTER 查询中的数据竞争. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6245 rel="external nofollow noreferrer" target=_blank>#6245</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6513 rel="external nofollow noreferrer" target=_blank>#6513</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了可能导致内存损坏的突变中的错误代码. 修复了由于从 <code class=syntax>system.parts</code> 或 <code class=syntax>system.parts_columns</code> 并发 <code class=syntax>DROP TABLE</code> 和 <code class=syntax>SELECT</code> 而可能发生的读取地址 <code class=syntax>0x14c0</code> 的段错误. 修复了准备突变查询时的竞争条件. 修复复制表的 <code class=syntax>OPTIMIZE</code> 和 ALTER 等并发修改操作导致的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/6514 rel="external nofollow noreferrer" target=_blank>#6514</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-11-7-40-2019-08-14>ClickHouse 版本 19.11.7.40, 2019-08-14<a class=headerlink href=../amp/#clickhouse-release-19-11-7-40-2019-08-14 title="Permanent link"> </a></h3> <h4 id=bug-fix-18>Bug 修复<a class=headerlink href=../amp/#bug-fix-18 title="Permanent link"> </a></h4> <ul> <li>Kafka 集成已在此版本中修复.</li> <li>修复了当使用 <code class=syntax>arrayReduce</code> 作为常量参数时的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6326 rel="external nofollow noreferrer" target=_blank>#6326</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 <code class=syntax>toFloat()</code> 单调性. <a href=https://github.com/ClickHouse/ClickHouse/pull/6374 rel="external nofollow noreferrer" target=_blank>#6374</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>修复了启用的 <code class=syntax>optimize_skip_unused_shards</code> 和丢失的分片键修复段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6384 rel="external nofollow noreferrer" target=_blank>#6384</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>CurtizJ</a>)</li> <li>修复了<code class=syntax>arrayEnumerateUniqRanked</code> 函数的逻辑. <a href=https://github.com/ClickHouse/ClickHouse/pull/6423 rel="external nofollow noreferrer" target=_blank>#6423</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>从 MySQL 处理程序中删除了额外的详细日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/6389 rel="external nofollow noreferrer" target=_blank>#6389</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>topK</code> 和 <code class=syntax>topK Weighted</code> 聚合函数中的错误行为和可能的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6404 rel="external nofollow noreferrer" target=_blank>#6404</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>CurtizJ</a>)</li> <li>不要在 <code class=syntax>system.columns</code> 表中暴露虚拟列. 这是向后兼容所必需的. <a href=https://github.com/ClickHouse/ClickHouse/pull/6406 rel="external nofollow noreferrer" target=_blank>#6406</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复复杂键缓存字典中字符串字段的内存分配错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6447 rel="external nofollow noreferrer" target=_blank>#6447</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复在为 <code class=syntax>Replicated*MergeTree</code> 表创建新副本时启用自适应粒度的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6452 rel="external nofollow noreferrer" target=_blank>#6452</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复读取 Kafka 消息时的无限循环. <a href=https://github.com/ClickHouse/ClickHouse/pull/6354 rel="external nofollow noreferrer" target=_blank>#6354</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>abyss7</a>)</li> <li>修复了由于 SQL 解析器中的堆栈溢出以及 <code class=syntax>Merge</code> 和 <code class=syntax>Distributed</code> 表中的堆栈溢出的可能性, 伪造查询导致服务器崩溃的可能性 <a href=https://github.com/ClickHouse/ClickHouse/pull/6433 rel="external nofollow noreferrer" target=_blank>#6433</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了小序列上的 Gorilla 编码错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6444 rel="external nofollow noreferrer" target=_blank>#6444</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Enmk</a>)</li> </ul> <h4 id=improvement-5>改进<a class=headerlink href=../amp/#improvement-5 title="Permanent link"> </a></h4> <ul> <li>允许用户在连接时覆盖 <code class=syntax>poll_interval</code> 和 <code class=syntax>idle_connection_timeout</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/6230 rel="external nofollow noreferrer" target=_blank>#6230</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-11-5-28-2019-08-05>ClickHouse 版本 19.11.5.28, 2019-08-05<a class=headerlink href=../amp/#clickhouse-release-19-11-5-28-2019-08-05 title="Permanent link"> </a></h3> <h4 id=bug-fix-19>Bug 修复<a class=headerlink href=../amp/#bug-fix-19 title="Permanent link"> </a></h4> <ul> <li>修复了服务器过载时挂起查询的可能性. <a href=https://github.com/ClickHouse/ClickHouse/pull/6301 rel="external nofollow noreferrer" target=_blank>#6301</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 yandexConsistentHash 函数中的 FPE. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6304 rel="external nofollow noreferrer" target=_blank>#6304</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6126 rel="external nofollow noreferrer" target=_blank>#6126</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了在 <code class=syntax>AggregateFunctionFactory</code> 中转换 <code class=syntax>LowCardinality</code> 类型的错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6257 rel="external nofollow noreferrer" target=_blank>#6257</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6281 rel="external nofollow noreferrer" target=_blank>#6281</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复从配置文件中的 <code class=syntax>true</code> 和 <code class=syntax>false</code> 字符串解析 <code class=syntax>bool</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/6278 rel="external nofollow noreferrer" target=_blank>#6278</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>当 <code class=syntax>WHERE</code> 的一部分移动到 <code class=syntax>PREWHERE</code> 时, 修复了在对 <code class=syntax>MergeTree</code> 表上的 <code class=syntax>Distributed</code> 表的查询中流标头不兼容的罕见错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6236 rel="external nofollow noreferrer" target=_blank>#6236</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了有符号类型到无符号类型的整数除法中的溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6214 rel="external nofollow noreferrer" target=_blank>#6214</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6233 rel="external nofollow noreferrer" target=_blank>#6233</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=backward-incompatible-change-5>向后不兼容的更新<a class=headerlink href=../amp/#backward-incompatible-change-5 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>Kafka</code> 仍然损坏.</li> </ul> <h3 id=clickhouse-release-19-11-4-24-2019-08-01>ClickHouse 版本 19.11.4.24, 2019-08-01<a class=headerlink href=../amp/#clickhouse-release-19-11-4-24-2019-08-01 title="Permanent link"> </a></h3> <h4 id=bug-fix-20>Bug 修复<a class=headerlink href=../amp/#bug-fix-20 title="Permanent link"> </a></h4> <ul> <li>修复以自适应粒度写入二级索引标记的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6126 rel="external nofollow noreferrer" target=_blank>#6126</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了带有两级聚合的 <code class=syntax>GROUP BY</code> 的 <code class=syntax>WITH ROLLUP</code> 和 <code class=syntax>WITH CUBE</code> 修饰符. <a href=https://github.com/ClickHouse/ClickHouse/pull/6225 rel="external nofollow noreferrer" target=_blank>#6225</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复了 <code class=syntax>JSONExtractRaw</code> 函数中的挂起问题. 已修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6195 rel="external nofollow noreferrer" target=_blank>#6195</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6198 rel="external nofollow noreferrer" target=_blank>#6198</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 ExternalLoader::reloadOutdated() 中的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6082 rel="external nofollow noreferrer" target=_blank>#6082</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复了服务器可能会关闭侦听套接字但不会关闭并继续服务剩余查询的情况. 您最终可能会运行两个 clickhouse-server 进程. 有时, 服务器可能会为剩余的查询返回错误 <code class=syntax>bad_function_call</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/6231 rel="external nofollow noreferrer" target=_blank>#6231</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了通过 ODBC、MySQL、ClickHouse 和 HTTP 初始加载外部词典时更新字段上无用和不正确的条件. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6069 rel="external nofollow noreferrer" target=_blank>#6069</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6083 rel="external nofollow noreferrer" target=_blank>#6083</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了将 <code class=syntax>LowCardinality(Nullable)</code> 转换为 not-Nullable 列中的不相关异常，以防它不包含 Nulls（例如, 像在 <code class=syntax>SELECT CAST(CAST('Hello' AS LowCardinality(Nullable(String))) AS String</code> 这样的查询中). <a href=https://github.com/ClickHouse/ClickHouse/issues/6094 rel="external nofollow noreferrer" target=_blank>#6094</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6119 rel="external nofollow noreferrer" target=_blank>#6119</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>在极少数情况下修复 <code class=syntax>uniq</code> 聚合函数的非确定性结果. 该错误存在于所有 ClickHouse 版本中. <a href=https://github.com/ClickHouse/ClickHouse/pull/6058 rel="external nofollow noreferrer" target=_blank>#6058</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>当我们在函数 <code class=syntax>IPv6CIDRToRange</code> 上设置太高的 CIDR 时出现段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/6068 rel="external nofollow noreferrer" target=_blank>#6068</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>修复了服务器从许多不同的上下文中抛出许多异常时的小内存泄漏. <a href=https://github.com/ClickHouse/ClickHouse/pull/6144 rel="external nofollow noreferrer" target=_blank>#6144</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复消费者订阅前暂停, 订阅后未恢复的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/6075 rel="external nofollow noreferrer" target=_blank>#6075</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>) Note that Kafka is broken in this version.</li> <li>清除之前已完成但出现错误的读取操作中的 Kafka 数据缓冲区 <a href=https://github.com/ClickHouse/ClickHouse/pull/6026 rel="external nofollow noreferrer" target=_blank>#6026</a> (<a href="https://github.com/ bopohaa" rel="external nofollow noreferrer" target=_blank>Nikolay</a>) 请注意, 此版本中 Kafka 已损坏.</li> <li>由于 <code class=syntax>StorageMergeTree::background_task_handle</code> 是在<code class=syntax>startup()</code> 中初始化的, 所以 <code class=syntax>MergeTreeBlockOutputStream::write()</code> 可能会在初始化之前尝试使用它. 只需检查它是否已初始化. <a href=https://github.com/ClickHouse/ClickHouse/pull/6080 rel="external nofollow noreferrer" target=_blank>#6080</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-6>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-6 title="Permanent link"> </a></h4> <ul> <li>添加官方<code class=syntax>rpm</code>包. <a href=https://github.com/ClickHouse/ClickHouse/pull/5740 rel="external nofollow noreferrer" target=_blank>#5740</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>) (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加使用<code class=syntax>packager</code>脚本构建<code class=syntax>.rpm</code>和<code class=syntax>.tgz</code>包的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/5769 rel="external nofollow noreferrer" target=_blank>#5769</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复“Arcadia”构建系统. <a href=https://github.com/ClickHouse/ClickHouse/pull/6223 rel="external nofollow noreferrer" target=_blank>#6223</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h4 id=backward-incompatible-change-6>向后不兼容的更新<a class=headerlink href=../amp/#backward-incompatible-change-6 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>Kafka</code> 在这个版本中仍然被损坏.</li> </ul> <h3 id=clickhouse-release-19-11-3-11-2019-07-18>ClickHouse 版本 19.11.3.11, 2019-07-18<a class=headerlink href=../amp/#clickhouse-release-19-11-3-11-2019-07-18 title="Permanent link"> </a></h3> <h4 id=new-feature-6>新特征<a class=headerlink href=../amp/#new-feature-6 title="Permanent link"> </a></h4> <ul> <li>添加了对准备好的语句的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/5331/ rel="external nofollow noreferrer" target=_blank>#5331</a> (<a href=https://github.com/sanych73 rel="external nofollow noreferrer" target=_blank>Alexander</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/5630 rel="external nofollow noreferrer" target=_blank>#5630</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>DoubleDelta</code> 和 <code class=syntax>Gorilla</code> 列编解码器. <a href=https://github.com/ClickHouse/ClickHouse/pull/5600 rel="external nofollow noreferrer" target=_blank>#5600</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>添加了 <code class=syntax>os_thread_priority</code> 设置, 允许控制操作系统使用的查询处理线程的 <code class=syntax>nice</code> 值来调整动态调度优先级. 它需要 <code class=syntax>CAP_SYS_NICE</code> 功能才能工作. 这实现 <a href=https://github.com/ClickHouse/ClickHouse/issues/5858 rel="external nofollow noreferrer" target=_blank>#5858</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5909 rel="external nofollow noreferrer" target=_blank>#5909</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为 Kafka 引擎实现 <code class=syntax>_topic</code>、<code class=syntax>_offset</code>、<code class=syntax>_key</code> 列 <a href=https://github.com/ClickHouse/ClickHouse/pull/5382 rel="external nofollow noreferrer" target=_blank>#5382</a> (<a href="https://github.com/ abyss7" rel="external nofollow noreferrer" target=_blank>Ivan</a>) 请注意, 这个版本中 Kafka 已损坏.</li> <li>添加聚合函数组合器 <code class=syntax>-Resample</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5590 rel="external nofollow noreferrer" target=_blank>#5590</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>聚合函数<code class=syntax>groupArrayMovingSum(win_size)(x)</code> 和<code class=syntax>groupArrayMovingAvg(win_size)(x)</code>, 计算有或没有窗口大小限制的移动总和/平均. <a href=https://github.com/ClickHouse/ClickHouse/pull/5595 rel="external nofollow noreferrer" target=_blank>#5595</a> (<a href=https://github.com/inv2004 rel="external nofollow noreferrer" target=_blank>inv2004</a>)</li> <li>添加同义词 <code class=syntax>arrayFlatten</code> \&lt;-&gt; <code class=syntax>flatten</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5764 rel="external nofollow noreferrer" target=_blank>#5764</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>将优步的H3功能 <code class=syntax>geoToH3</code> 集成在一起. <a href=https://github.com/ClickHouse/ClickHouse/pull/4724 rel="external nofollow noreferrer" target=_blank>#4724</a> (<a href=https://github.com/BHYCHIK rel="external nofollow noreferrer" target=_blank>Remen Ivan</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/5805 rel="external nofollow noreferrer" target=_blank>#5805</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=bug-fix-21>Bug 修复<a class=headerlink href=../amp/#bug-fix-21 title="Permanent link"> </a></h4> <ul> <li>使用异步更新实现 DNS 缓存. 单独的线程解析所有主机并使用周期更新 DNS 缓存 (设置 <code class=syntax>dns_cache_update_period</code>). 当主机的 ip 频繁更改时. 它应该会有所帮助. <a href=https://github.com/ClickHouse/ClickHouse/pull/5857 rel="external nofollow noreferrer" target=_blank>#5857</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复 <code class=syntax>Delta</code> 编解码器中的段错误, 该错误会影响值小于 32 位大小的列. 该错误导致随机内存损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/5786 rel="external nofollow noreferrer" target=_blank>#5786</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复 TTL 合并中的段错误与块中的非物理列. <a href=https://github.com/ClickHouse/ClickHouse/pull/5819 rel="external nofollow noreferrer" target=_blank>#5819</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复了检查带有 <code class=syntax>LowCardinality</code> 列的部分的罕见错误. 以前, <code class=syntax>checkDataPart</code> 对于带有 <code class=syntax>LowCardinality</code> 列的部分总是失败. <a href=https://github.com/ClickHouse/ClickHouse/pull/5832 rel="external nofollow noreferrer" target=_blank>#5832</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>避免在服务器线程池已满时挂起连接. 当连接超时很长时, 对于从 <code class=syntax>remote</code> 表函数的连接或到没有副本的分片的连接很重要. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5878 rel="external nofollow noreferrer" target=_blank>#5878</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5881 rel="external nofollow noreferrer" target=_blank>#5881</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>支持 <code class=syntax>evalMLModel</code> 函数的常量参数. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5817 rel="external nofollow noreferrer" target=_blank>#5817</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5820 rel="external nofollow noreferrer" target=_blank>#5820</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 ClickHouse 将默认时区确定为 <code class=syntax>UCT</code> 而不是 <code class=syntax>UTC</code> 时的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5804 rel="external nofollow noreferrer" target=_blank>#5804</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5828 rel="external nofollow noreferrer" target=_blank>#5828</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 <code class=syntax>visitParamExtractRaw</code> 中的缓冲区下溢. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5901 rel="external nofollow noreferrer" target=_blank>#5901</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5902 rel="external nofollow noreferrer" target=_blank>#5902</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>现在分布式的<code class=syntax>DROP/ALTER/TRUNCATE/OPTIMIZE ON CLUSTER</code>查询将直接在leader副本上执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/5757 rel="external nofollow noreferrer" target=_blank>#5757</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>使用 <code class=syntax>ColumnNullable</code> + 相关更改修复 <code class=syntax>ColumnConst</code> 的 <code class=syntax>coalesce</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5755 rel="external nofollow noreferrer" target=_blank>#5755</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复 <code class=syntax>ReadBufferFromKafkaConsumer</code> 以便它在 <code class=syntax>commit()</code> 之后继续读取新消息，即使它之前被停止. <a href=https://github.com/ClickHouse/ClickHouse/pull/5852 rel="external nofollow noreferrer" target=_blank>#5852</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>在右表中的 <code class=syntax>Nullable</code> 键上连接时修复 <code class=syntax>FULL</code> 和 <code class=syntax>RIGHT</code> 连接结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/5859 rel="external nofollow noreferrer" target=_blank>#5859</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>低优先级查询无限休眠的可能修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/5842 rel="external nofollow noreferrer" target=_blank>#5842</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复竞争条件, 导致某些查询在 <code class=syntax>SYSTEM FLUSH LOGS</code> 查询后可能不会出现在 query_log 中. <a href=https://github.com/ClickHouse/ClickHouse/issues/5456 rel="external nofollow noreferrer" target=_blank>#5456</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5685 rel="external nofollow noreferrer" target=_blank>#5685</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复了 ClusterCopier 中的 <code class=syntax>heap-use-after-free</code> ASan 警告，由 watch 导致尝试使用已删除的复制器对象. <a href=https://github.com/ClickHouse/ClickHouse/pull/5871 rel="external nofollow noreferrer" target=_blank>#5871</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了由 <code class=syntax>IColumn::deserializeAndInsertFromArena</code> 的某些实现返回的错误 <code class=syntax>StringRef</code> 指针. 此错误仅影响单元测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/5973 rel="external nofollow noreferrer" target=_blank>#5973</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>防止屏蔽同名列的源和中间数组连接列. <a href=https://github.com/ClickHouse/ClickHouse/pull/5941 rel="external nofollow noreferrer" target=_blank>#5941</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>使用 MySQL 样式标识符引用修复对 MySQL 引擎的插入和选择查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/5704 rel="external nofollow noreferrer" target=_blank>#5704</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>现在 <code class=syntax>CHECK TABLE</code> 查询可以与 MergeTree 引擎系列一起使用. 如果每个部分 (或在更简单的引擎情况下的文件) 有任何检查状态和消息, 它会返回检查状态和消息. 此外, 修复了获取损坏部分的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5865 rel="external nofollow noreferrer" target=_blank>#5865</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复 SPLIT_SHARED_LIBRARIES 运行时. <a href=https://github.com/ClickHouse/ClickHouse/pull/5793 rel="external nofollow noreferrer" target=_blank>#5793</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>当 <code class=syntax>/etc/localtime</code> 是一个像 <code class=syntax>../usr/share/zoneinfo/Asia/Istanbul</code> 这样的相对符号链接时, 修复了时区初始化 <a href=https://github.com/ClickHouse/ClickHouse/pull/5922 rel="external nofollow noreferrer" target=_blank>#5922</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>clickhouse-copier: 修复关机后免费使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/5752 rel="external nofollow noreferrer" target=_blank>#5752</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>更新了 <code class=syntax>simdjson</code> . 修复部分无效的零字节JSON解析成功的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/5938 rel="external nofollow noreferrer" target=_blank>#5938</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复关闭系统日志 <a href=https://github.com/ClickHouse/ClickHouse/pull/5802 rel="external nofollow noreferrer" target=_blank>#5802</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复 invalidate_query 中的条件依赖于字典时挂起. <a href=https://github.com/ClickHouse/ClickHouse/pull/6011 rel="external nofollow noreferrer" target=_blank>#6011</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> </ul> <h4 id=improvement-6>改进<a class=headerlink href=../amp/#improvement-6 title="Permanent link"> </a></h4> <ul> <li>在集群配置中允许无法解析的地址. 它们将被视为不可用并在每次连接尝试时尝试解决. 这对 Kubernetes 尤其有用. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5714 rel="external nofollow noreferrer" target=_blank>#5714</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5924 rel="external nofollow noreferrer" target=_blank>#5924</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>关闭空闲的 TCP 连接 (默认超时一小时). 这对于在每台服务器上有多个分布式表的大型集群尤其重要, 因为每台服务器都可能保持与其他所有服务器的连接池, 并且在查询并发峰值之后, 连接将停止. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5879 rel="external nofollow noreferrer" target=_blank>#5879</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5880 rel="external nofollow noreferrer" target=_blank>#5880</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>topK</code> 函数的质量更好. 如果新元素具有更大的权重, 则更改 SavingSpace 设置行为以删除最后一个元素. <a href=https://github.com/ClickHouse/ClickHouse/issues/5833 rel="external nofollow noreferrer" target=_blank>#5833</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5850 rel="external nofollow noreferrer" target=_blank>#5850</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>用于域的 URL 函数现在可以用于没有方案的不完整 URL. <a href=https://github.com/ClickHouse/ClickHouse/pull/5725 rel="external nofollow noreferrer" target=_blank>#5725</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>将校验和添加到 <code class=syntax>system.parts_columns</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/5874 rel="external nofollow noreferrer" target=_blank>#5874</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>添加了 <code class=syntax>Enum</code> 数据类型作为 <code class=syntax>Enum</code> 或 <code class=syntax>Enum 16</code> 的同义词. <a href=https://github.com/ClickHouse/ClickHouse/pull/5886 rel="external nofollow noreferrer" target=_blank>#5886</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li><code class=syntax>T64</code> 编解码器的全位转置变体. 可以使用 <code class=syntax>zstd</code> 实现更好的压缩. <a href=https://github.com/ClickHouse/ClickHouse/pull/5742 rel="external nofollow noreferrer" target=_blank>#5742</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li><code class=syntax>startsWith</code> 函数的条件现在可以使用主键. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5310 rel="external nofollow noreferrer" target=_blank>#5310</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/5882 rel="external nofollow noreferrer" target=_blank>#5882</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5919 rel="external nofollow noreferrer" target=_blank>#5919</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>)</li> <li>通过允许空数据库名称, 允许将 <code class=syntax>clickhouse-copier</code> 与交叉复制集群拓扑一起使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/5745 rel="external nofollow noreferrer" target=_blank>#5745</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>)</li> <li>在没有 <code class=syntax>tzdata</code> 的系统 (例如裸 Docker 容器) 上使用 <code class=syntax>UTC</code> 作为默认时区. 在此补丁之前，打印错误消息 <code class=syntax>Could not determine local time zone</code> 并且服务器或客户端拒绝启动. <a href=https://github.com/ClickHouse/ClickHouse/pull/5827 rel="external nofollow noreferrer" target=_blank>#5827</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>返回对函数 <code class=syntax>quantileTiming</code> 中浮点参数的支持, 以实现向后兼容. <a href=https://github.com/ClickHouse/ClickHouse/pull/5911 rel="external nofollow noreferrer" target=_blank>#5911</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在错误消息中显示哪个表缺少列. <a href=https://github.com/ClickHouse/ClickHouse/pull/5768 rel="external nofollow noreferrer" target=_blank>#5768</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>禁止不同用户使用相同的 query_id 运行查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/5430 rel="external nofollow noreferrer" target=_blank>#5430</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>用于将指标发送到 Graphite 的更强大的代码。 即使在长时间的 <code class=syntax>RENAME TABLE</code> 操作期间它也能工作. <a href=https://github.com/ClickHouse/ClickHouse/pull/5875 rel="external nofollow noreferrer" target=_blank>#5875</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>当 ThreadPool 无法安排要执行的任务时, 将显示更多信息性错误消息. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5305 rel="external nofollow noreferrer" target=_blank>#5305</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5801 rel="external nofollow noreferrer" target=_blank>#5801</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>倒置ngramSearch更直观. <a href=https://github.com/ClickHouse/ClickHouse/pull/5807 rel="external nofollow noreferrer" target=_blank>#5807</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>在 HDFS 引擎构建器中添加用户解析. <a href=https://github.com/ClickHouse/ClickHouse/pull/5946 rel="external nofollow noreferrer" target=_blank>#5946</a> (<a href=https://github.com/akonyaev90 rel="external nofollow noreferrer" target=_blank>akonyaev90</a>)</li> <li>更新 <code class=syntax>max_ast_elements parameter</code> 的默认值. <a href=https://github.com/ClickHouse/ClickHouse/pull/5933 rel="external nofollow noreferrer" target=_blank>#5933</a> (<a href=https://github.com/izebit rel="external nofollow noreferrer" target=_blank>Artem Konovalov</a>)</li> <li>添加了过时设置的概念. 可以使用过时的设置 <code class=syntax>allow_experimental_low_cardinality_type</code> 没有效果. <a href=https://github.com/ClickHouse/ClickHouse/commit/0f15c01c6802f7ce1a1494c12c846be8c98944cd rel="external nofollow noreferrer" target=_blank>0f15c01c6802f7ce1a1494c12c846be8c98944cd</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>Alexey Milovidov</a></li> </ul> <h4 id=performance-improvement-4>性能改进<a class=headerlink href=../amp/#performance-improvement-4 title="Permanent link"> </a></h4> <ul> <li>增加从合并表中选择的流数量, 以实现更均匀的线程分布. 添加了设置 <code class=syntax>max_streams_multiplier_for_merge_tables</code>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5797 rel="external nofollow noreferrer" target=_blank>#5797</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5915 rel="external nofollow noreferrer" target=_blank>#5915</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-7>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-7 title="Permanent link"> </a></h4> <ul> <li>为客户端-服务器与不同版本的clickhouse交互添加向后兼容性测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/5868 rel="external nofollow noreferrer" target=_blank>#5868</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>在每个提交和拉取请求中测试覆盖率信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/5896 rel="external nofollow noreferrer" target=_blank>#5896</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>与 address sanitizer 合作以支持我们的自定义分配器 (<code class=syntax>Arena</code> 和 <code class=syntax>ArenaWithFreeLists</code>), 以便更好地调试 <code class=syntax>use-after-free</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5728 rel="external nofollow noreferrer" target=_blank>#5728</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>切换到 <a href=https://github.com/llvm-mirror/libunwind rel="external nofollow noreferrer" target=_blank>LLVM libunwind implementation</a> 以进行 C++ 异常处理和堆栈跟踪打印. <a href=https://github.com/ClickHouse/ClickHouse/pull/4828 rel="external nofollow noreferrer" target=_blank>#4828</a> (<a href=https://github.com/laplab rel="external nofollow noreferrer" target=_blank>Nikita Lapkov</a>)</li> <li>添加来自 -Weverything 的另外两个警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/5923 rel="external nofollow noreferrer" target=_blank>#5923</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>允许使用 Memory Sanitizer 构建 ClickHouse. <a href=https://github.com/ClickHouse/ClickHouse/pull/3949 rel="external nofollow noreferrer" target=_blank>#3949</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了关于模糊测试中 <code class=syntax>bitTest</code> 函数的 ubsan 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/5943 rel="external nofollow noreferrer" target=_blank>#5943</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>Docker: 增加了初始化需要身份验证的 ClickHouse 实例的可能性. <a href=https://github.com/ClickHouse/ClickHouse/pull/5727 rel="external nofollow noreferrer" target=_blank>#5727</a> (<a href=https://github.com/shurshun rel="external nofollow noreferrer" target=_blank>Korviakov Andrey</a>)</li> <li>将 librdkafka 更新至 1.1.0 版. <a href=https://github.com/ClickHouse/ClickHouse/pull/5872 rel="external nofollow noreferrer" target=_blank>#5872</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>为集成测试添加全局超时并在测试代码中禁用其中的一些. <a href=https://github.com/ClickHouse/ClickHouse/pull/5741 rel="external nofollow noreferrer" target=_blank>#5741</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复一些 ThreadSanitizer 故障. <a href=https://github.com/ClickHouse/ClickHouse/pull/5854 rel="external nofollow noreferrer" target=_blank>#5854</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li><code class=syntax>--no-undefined</code> 选项强制链接器在链接时检查所有外部名称是否存在. 在拆分构建模式下跟踪库之间的真实依赖关系非常有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/5855 rel="external nofollow noreferrer" target=_blank>#5855</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>添加了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5797 rel="external nofollow noreferrer" target=_blank>#5797</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5914 rel="external nofollow noreferrer" target=_blank>#5914</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) 的性能测试.</li> <li>修复了与 gcc-7 的兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/5840 rel="external nofollow noreferrer" target=_blank>#5840</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了对 gcc-9 的支持. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5717 rel="external nofollow noreferrer" target=_blank>#5717</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5774 rel="external nofollow noreferrer" target=_blank>#5774</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 libunwind 可以错误链接时的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5948 rel="external nofollow noreferrer" target=_blank>#5948</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 PVS-Studio 发现的一些警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/5921 rel="external nofollow noreferrer" target=_blank>#5921</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了对 <code class=syntax>clang-tidy</code> 静态分析器的初始支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/5806 rel="external nofollow noreferrer" target=_blank>#5806</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 BSD/Linux 字节序宏 (<code class=syntax>be64toh</code> 和 <code class=syntax>htobe64</code>) 转换为 Mac OS X 等价物. <a href=https://github.com/ClickHouse/ClickHouse/pull/5785 rel="external nofollow noreferrer" target=_blank>#5785</a> (<a href=https://github.com/fredchenbj rel="external nofollow noreferrer" target=_blank>Fu Chen</a>)</li> <li>改进的集成测试指南. <a href=https://github.com/ClickHouse/ClickHouse/pull/5796 rel="external nofollow noreferrer" target=_blank>#5796</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复在macosx + gcc9的构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/5822 rel="external nofollow noreferrer" target=_blank>#5822</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复一个难以发现的拼写错误: aggreGate -&gt;aggregate. <a href=https://github.com/ClickHouse/ClickHouse/pull/5753 rel="external nofollow noreferrer" target=_blank>#5753</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>修复 freebsd 构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/5760 rel="external nofollow noreferrer" target=_blank>#5760</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>将实验性 YouTube 频道的链接添加到网站 <a href=https://github.com/ClickHouse/ClickHouse/pull/5845 rel="external nofollow noreferrer" target=_blank>#5845</a> (<a href=https://github.com/blinkov rel="external nofollow noreferrer" target=_blank>Ivan Blinkov</a>)</li> <li>CMake: 添加覆盖标志选项: WITH_COVERAGE <a href=https://github.com/ClickHouse/ClickHouse/pull/5776 rel="external nofollow noreferrer" target=_blank>#5776</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复一些内联 PODArray 的初始大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/5787 rel="external nofollow noreferrer" target=_blank>#5787</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>clickhouse-server.postinst: 修复 centos 6 的操作系统检测. <a href=https://github.com/ClickHouse/ClickHouse/pull/5788 rel="external nofollow noreferrer" target=_blank>#5788</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>添加了 Arch linux 包生成. <a href=https://github.com/ClickHouse/ClickHouse/pull/5719 rel="external nofollow noreferrer" target=_blank>#5719</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>通过 libs (dbms) 拆分 Common/config.h. <a href=https://github.com/ClickHouse/ClickHouse/pull/5715 rel="external nofollow noreferrer" target=_blank>#5715</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复 <code class=syntax>Arcadia</code> 构建平台 <a href=https://github.com/ClickHouse/ClickHouse/pull/5795 rel="external nofollow noreferrer" target=_blank>#5795</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复非常规构建 (gcc9, 无子模块). <a href=https://github.com/ClickHouse/ClickHouse/pull/5792 rel="external nofollow noreferrer" target=_blank>#5792</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>在 unalignedStore 中需要显式类型, 因为它被证明容易出错. <a href=https://github.com/ClickHouse/ClickHouse/pull/5791 rel="external nofollow noreferrer" target=_blank>#5791</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>修复 MacOS 构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/5830 rel="external nofollow noreferrer" target=_blank>#5830</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>根据此处的要求, 关于具有更大数据集的新 JIT 功能的性能测试 <a href=https://github.com/ClickHouse/ClickHouse/issues/5263 rel="external nofollow noreferrer" target=_blank>#5263</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5887 rel="external nofollow noreferrer" target=_blank>#5887</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>在压力测试中运行状态测试 <a href=https://github.com/ClickHouse/ClickHouse/commit/12693e568722f11e19859742f56428455501fd2a rel="external nofollow noreferrer" target=_blank>12693e568722f11e19859742f56428455501fd2a</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> </ul> <h4 id=backward-incompatible-change-7>向后不兼容变更<a class=headerlink href=../amp/#backward-incompatible-change-7 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>Kafka</code> 在这个版本中被损坏.</li> <li>默认情况下为新的 <code class=syntax>MergeTree</code> 表启用 <code class=syntax>adaptive_index_granularity</code> = 10MB. 如果您在 19.11+ 版本上创建了新的 MergeTree 表, 则无法降级到 19.6 之前的版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/5628 rel="external nofollow noreferrer" target=_blank>#5628</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>删除了 Yandex.Metrica 使用的过时的未记录的嵌入式词典. <code class=syntax>OSIn</code>、<code class=syntax>SEIn</code>、<code class=syntax>OSToRoot</code>、<code class=syntax>SEToRoot</code>、<code class=syntax>OSHierarchy</code>、<code class=syntax>SEHierarchy</code> 函数不再可用. 如果您正在使用这些功能, 请发送电子邮件至 <a href=../mailto:clickhouse-feedback@yandex-team.comamp/ >clickhouse-feedback@yandex-team.com</a>. 注意: 最后一刻我们决定暂时保留这些功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/5780 rel="external nofollow noreferrer" target=_blank>#5780</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h2 id=clickhouse-release-19-10>ClickHouse 版本 19.10<a class=headerlink href=../amp/#clickhouse-release-19-10 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-10-1-5-2019-07-12>ClickHouse 版本 19.10.1.5, 2019-07-12<a class=headerlink href=../amp/#clickhouse-release-19-10-1-5-2019-07-12 title="Permanent link"> </a></h3> <h4 id=new-feature-7>新特征<a class=headerlink href=../amp/#new-feature-7 title="Permanent link"> </a></h4> <ul> <li>添加新的列编解码器：<code class=syntax>T64</code>. 适用于 (U)IntX/EnumX/Data(Time)/DecimalX 列. 它应该适用于具有恒定值或小范围值的列. 编解码器本身允许放大或缩小数据类型而无需重新压缩. <a href=https://github.com/ClickHouse/ClickHouse/pull/5557 rel="external nofollow noreferrer" target=_blank>#5557</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>添加数据库引擎<code class=syntax>MySQL</code>, 允许查看远程MySQL服务器中的所有表. <a href=https://github.com/ClickHouse/ClickHouse/pull/5599 rel="external nofollow noreferrer" target=_blank>#5599</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li><code class=syntax>bitmapContains</code> 实现. 如果第二个位图包含一个元素, 它比 <code class=syntax>bitmapHasAny</code> 快 2 倍. <a href=https://github.com/ClickHouse/ClickHouse/pull/5535 rel="external nofollow noreferrer" target=_blank>#5535</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>支持 <code class=syntax>crc32</code> 函数 (行为与 MySQL 或 PHP 完全相同). 如果您需要哈希函数, 请不要使用它. <a href=https://github.com/ClickHouse/ClickHouse/pull/5661 rel="external nofollow noreferrer" target=_blank>#5661</a> (<a href=https://github.com/BHYCHIK rel="external nofollow noreferrer" target=_blank>Remen Ivan</a>)</li> <li>实现了 <code class=syntax>SYSTEM START/STOP DISTRIBUTED SENDS</code> 查询以控制对 <code class=syntax>Distributed</code> 表的异步插入. <a href=https://github.com/ClickHouse/ClickHouse/pull/4935 rel="external nofollow noreferrer" target=_blank>#4935</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> </ul> <h4 id=bug-fix-22>Bug 修复<a class=headerlink href=../amp/#bug-fix-22 title="Permanent link"> </a></h4> <ul> <li>执行突变时忽略查询执行限制和合并限制的最大部分大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/5659 rel="external nofollow noreferrer" target=_blank>#5659</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复可能导致正常块重复数据删除 (极其罕见) 和插入重复块 (更常见) 的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5549 rel="external nofollow noreferrer" target=_blank>#5549</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复函数 <code class=syntax>arrayEnumerateUniqRanked</code> 的空数组参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/5559 rel="external nofollow noreferrer" target=_blank>#5559</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>不要在无意轮询任何消息的情况下订阅 Kafka 主题. <a href=https://github.com/ClickHouse/ClickHouse/pull/5698 rel="external nofollow noreferrer" target=_blank>#5698</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>使设置 <code class=syntax>join_use_nulls</code> 对不能在 Nullable 内的类型无效. <a href=https://github.com/ClickHouse/ClickHouse/pull/5700 rel="external nofollow noreferrer" target=_blank>#5700</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>修复了 <code class=syntax>Incorrect size of index granularity</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5720 rel="external nofollow noreferrer" target=_blank>#5720</a> (<a href=https://github.com/coraxster rel="external nofollow noreferrer" target=_blank>coraxster</a>)</li> <li>修复 Float 到 Decimal 转换溢出. <a href=https://github.com/ClickHouse/ClickHouse/pull/5607 rel="external nofollow noreferrer" target=_blank>#5607</a> (<a href=https://github.com/coraxster rel="external nofollow noreferrer" target=_blank>coraxster</a>)</li> <li>当 <code class=syntax>WriteBufferFromHDFS</code> 的析构函数被调用时刷新缓冲区. 这修复了写入<code class=syntax>HDFS</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5684 rel="external nofollow noreferrer" target=_blank>#5684</a> (<a href=https://github.com/eejoin rel="external nofollow noreferrer" target=_blank>Xindong Peng</a>)</li> </ul> <h4 id=improvement-7>改进<a class=headerlink href=../amp/#improvement-7 title="Permanent link"> </a></h4> <ul> <li>启用设置 <code class=syntax>input_format_defaults_for_omited_fields</code> 时，将 <code class=syntax>CSV</code> 中的空单元格视为默认值. <a href=https://github.com/ClickHouse/ClickHouse/pull/5625 rel="external nofollow noreferrer" target=_blank>#5625</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>非阻塞加载外部字典. <a href=https://github.com/ClickHouse/ClickHouse/pull/5567 rel="external nofollow noreferrer" target=_blank>#5567</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>可以根据设置为已建立的连接动态更改网络超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/4558 rel="external nofollow noreferrer" target=_blank>#4558</a> (<a href=https://github.com/podshumok rel="external nofollow noreferrer" target=_blank>Konstantin Podshumok</a>)</li> <li>使用 <code class=syntax>public_suffix_list</code> 作为函数 <code class=syntax>firstSignificantSubdomain</code>、<code class=syntax>cutToFirstSignificantSubdomain</code>. 它使用由<code class=syntax>gperf</code> 生成的完美哈希表和从文件生成的列表: <a href=https://publicsuffix.org/list/public_suffix_list.dat target=_blank>https://publicsuffix.org/list/public_suffix_list.dat</a>. (例如, 现在我们认为域 <code class=syntax>ac.uk</code> 不重要). <a href=https://github.com/ClickHouse/ClickHouse/pull/5030 rel="external nofollow noreferrer" target=_blank>#5030</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>在系统表中采用了 <code class=syntax>IPv6</code> 数据类型; <code class=syntax>system.processes</code> 和 <code class=syntax>system.query_log</code> 中的统一客户端信息列. <a href=https://github.com/ClickHouse/ClickHouse/pull/5640 rel="external nofollow noreferrer" target=_blank>#5640</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用会话与 MySQL 兼容协议进行连接. #5476 <a href=https://github.com/ClickHouse/ClickHouse/pull/5646 rel="external nofollow noreferrer" target=_blank>#5646</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>支持更多 <code class=syntax>ALTER</code> 查询 <code class=syntax>ON CLUSTER</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5593 rel="external nofollow noreferrer" target=_blank>#5593</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5613 rel="external nofollow noreferrer" target=_blank>#5613</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>)</li> <li>支持 <code class=syntax>clickhouse-local</code> 配置文件中的 <code class=syntax>&lt;logger&gt;</code> 部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/5540 rel="external nofollow noreferrer" target=_blank>#5540</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>允许在 <code class=syntax>clickhouse-local</code> 中使用 <code class=syntax>remote</code> 表函数运行查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/5627 rel="external nofollow noreferrer" target=_blank>#5627</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h4 id=performance-improvement-5>性能改进<a class=headerlink href=../amp/#performance-improvement-5 title="Permanent link"> </a></h4> <ul> <li>添加在 MergeTree 列末尾写入最终标记的可能性. 它允许避免对超出表数据范围的键进行无用的读取. 仅在使用自适应索引粒度时才启用. <a href=https://github.com/ClickHouse/ClickHouse/pull/5624 rel="external nofollow noreferrer" target=_blank>#5624</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>通过减少 <code class=syntax>stat</code> 系统调用的数量, 改进了 MergeTree 表在非常慢的文件系统上的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/5648 rel="external nofollow noreferrer" target=_blank>#5648</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了从版本 19.6 中引入的 MergeTree 表读取时的性能下降. 修复 #5631. <a href=https://github.com/ClickHouse/ClickHouse/pull/5633 rel="external nofollow noreferrer" target=_blank>#5633</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-8>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-8 title="Permanent link"> </a></h4> <ul> <li>实现了 <code class=syntax>TestKeeper</code> 作为用于测试的 ZooKeeper 接口的实现. <a href=https://github.com/ClickHouse/ClickHouse/pull/5643 rel="external nofollow noreferrer" target=_blank>#5643</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>levushkin aleksej</a>)</li> <li>现在开始, <code class=syntax>.sql</code> 测试可以由服务器独立运行, 与随机数据库并行运行. 它允许更快地运行它们, 使用自定义服务器配置添加新测试, 并确保不同的测试不会相互影响. <a href=https://github.com/ClickHouse/ClickHouse/pull/5554 rel="external nofollow noreferrer" target=_blank>#5554</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>从性能测试中删除 <code class=syntax>&lt;name&gt;</code> 和 <code class=syntax>&lt;metrics&gt;</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5672 rel="external nofollow noreferrer" target=_blank>#5672</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>修复了 <code class=syntax>Pretty</code> 格式的 <code class=syntax>select_format</code> 性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/5642 rel="external nofollow noreferrer" target=_blank>#5642</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h2 id=clickhouse-release-19-9>ClickHouse 版本 19.9<a class=headerlink href=../amp/#clickhouse-release-19-9 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-9-3-31-2019-07-05>ClickHouse 版本 19.9.3.31, 2019-07-05<a class=headerlink href=../amp/#clickhouse-release-19-9-3-31-2019-07-05 title="Permanent link"> </a></h3> <h4 id=bug-fix-23>Bug 修复<a class=headerlink href=../amp/#bug-fix-23 title="Permanent link"> </a></h4> <ul> <li>修复 Delta 编解码器中的段错误, 该错误会影响值小于 32 位大小的列. 该错误导致随机内存损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/5786 rel="external nofollow noreferrer" target=_blank>#5786</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复使用低基数列检查零件时的罕见错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5832 rel="external nofollow noreferrer" target=_blank>#5832</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复 TTL 合并中的段错误与块中的非物理列. <a href=https://github.com/ClickHouse/ClickHouse/pull/5819 rel="external nofollow noreferrer" target=_blank>#5819</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复低优先级查询的潜在无限睡眠. <a href=https://github.com/ClickHouse/ClickHouse/pull/5842 rel="external nofollow noreferrer" target=_blank>#5842</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 ClickHouse 如何将默认时区确定为 UCT 而不是 UTC. <a href=https://github.com/ClickHouse/ClickHouse/pull/5828 rel="external nofollow noreferrer" target=_blank>#5828</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复关于在领导者副本之前在跟随者副本上执行分布式 DROP/ALTER/TRUNCATE/OPTIMIZE ON CLUSTER 查询的错误. 现在它们将直接在领导者副本上执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/5757 rel="external nofollow noreferrer" target=_blank>#5757</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复竞争条件, 导致某些查询在 SYSTEM FLUSH LOGS 查询后可能不会立即出现在 query_log 中. <a href=https://github.com/ClickHouse/ClickHouse/pull/5685 rel="external nofollow noreferrer" target=_blank>#5685</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>为 <code class=syntax>evalMLModel</code> 函数添加了对常量参数的缺失支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/5820 rel="external nofollow noreferrer" target=_blank>#5820</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-9-2-4-2019-06-24>ClickHouse 版本 19.9.2.4, 2019-06-24<a class=headerlink href=../amp/#clickhouse-release-19-9-2-4-2019-06-24 title="Permanent link"> </a></h3> <h4 id=new-feature-8>新特征<a class=headerlink href=../amp/#new-feature-8 title="Permanent link"> </a></h4> <ul> <li>在 <code class=syntax>system.parts</code> 表中打印有关冻结部件的信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/5471 rel="external nofollow noreferrer" target=_blank>#5471</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>如果未在参数中设置, 则在 tty 上启动 clickhouse-client 时询问客户端密码. <a href=https://github.com/ClickHouse/ClickHouse/pull/5092 rel="external nofollow noreferrer" target=_blank>#5092</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>为 Decimal 类型实现 <code class=syntax>dictGet</code> 和 <code class=syntax>dictGetOrDefault</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/5394 rel="external nofollow noreferrer" target=_blank>#5394</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=improvement-8>改进<a class=headerlink href=../amp/#improvement-8 title="Permanent link"> </a></h4> <ul> <li>Debian init: 添加服务停止超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/5522 rel="external nofollow noreferrer" target=_blank>#5522</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>添加默认禁止设置为 LowCardinality 创建具有可疑类型的表. <a href=https://github.com/ClickHouse/ClickHouse/pull/5448 rel="external nofollow noreferrer" target=_blank>#5448</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>回归函数在不用作函数 <code class=syntax>evalMLMethod</code> 中的状态时返回模型权重. <a href=https://github.com/ClickHouse/ClickHouse/pull/5411 rel="external nofollow noreferrer" target=_blank>#5411</a> (<a href=https://github.com/Quid37 rel="external nofollow noreferrer" target=_blank>Quid37</a>)</li> <li>重命名和改进回归方法. <a href=https://github.com/ClickHouse/ClickHouse/pull/5492 rel="external nofollow noreferrer" target=_blank>#5492</a> (<a href=https://github.com/Quid37 rel="external nofollow noreferrer" target=_blank>Quid37</a>)</li> <li>字符串搜索器的界面更清晰. <a href=https://github.com/ClickHouse/ClickHouse/pull/5586 rel="external nofollow noreferrer" target=_blank>#5586</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> </ul> <h4 id=bug-fix-24>Bug 修复<a class=headerlink href=../amp/#bug-fix-24 title="Permanent link"> </a></h4> <ul> <li>修复 Kafka 中潜在的数据丢失问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/5445 rel="external nofollow noreferrer" target=_blank>#5445</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>使用零列调用时以 <code class=syntax>PrettySpace</code> 格式修复潜在的无限循环. <a href=https://github.com/ClickHouse/ClickHouse/pull/5560 rel="external nofollow noreferrer" target=_blank>#5560</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>修复了线性模型中的 UInt32 溢出错误. 允许 eval ML 模型用于非常量模型参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/5516 rel="external nofollow noreferrer" target=_blank>#5516</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li><code class=syntax>ALTER TABLE ... DROP INDEX IF EXISTS ...</code> 如果提供的索引不存在，则不应引发异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/5524 rel="external nofollow noreferrer" target=_blank>#5524</a> (<a href=https://github.com/NanoBjorn rel="external nofollow noreferrer" target=_blank>Gleb Novikov</a>)</li> <li>在标量子查询中使用 <code class=syntax>bitmapHasAny</code> 修复段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5528 rel="external nofollow noreferrer" target=_blank>#5528</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>修复了复制连接池不重试解析主机时的错误, 即使 DNS 缓存已删除. <a href=https://github.com/ClickHouse/ClickHouse/pull/5534 rel="external nofollow noreferrer" target=_blank>#5534</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 ReplicatedMergeTree 上的 <code class=syntax>ALTER ... MODIFY TTL</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/5539 rel="external nofollow noreferrer" target=_blank>#5539</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>使用 MATERIALIZED 列将 INSERT 修复到分布式表中. <a href=https://github.com/ClickHouse/ClickHouse/pull/5429 rel="external nofollow noreferrer" target=_blank>#5429</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>在截断 Join 存储时修复错误分配 <a href=https://github.com/ClickHouse/ClickHouse/pull/5437 rel="external nofollow noreferrer" target=_blank>#5437</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>)</li> <li>在包 tzdata 的最新版本中, 一些文件现在是符号链接. 当前检测默认时区的机制被破坏, 并为某些时区提供了错误的名称. 现在至少我们将时区名称强制为 TZ 的内容 (如果提供). <a href=https://github.com/ClickHouse/ClickHouse/pull/5443 rel="external nofollow noreferrer" target=_blank>#5443</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>使用 MultiVolnitsky 搜索器修复一些非常罕见的情况, 当总针数总和至少为 16KB 时. 该算法遗漏或覆盖了之前的结果, 这可能导致 <code class=syntax>multiSearchAny</code> 的结果不正确. <a href=https://github.com/ClickHouse/ClickHouse/pull/5588 rel="external nofollow noreferrer" target=_blank>#5588</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>修复 ExternalData 请求的设置无法使用 ClickHouse 设置时的问题. 此外, 目前无法使用设置 <code class=syntax>date_time_input_format</code> 和 <code class=syntax>low_cardinality_allow_in_native_format</code>, 因为名称不明确 (在外部数据中它可以解释为表格式, 在查询中它可以是一个设置). <a href=https://github.com/ClickHouse/ClickHouse/pull/5455 rel="external nofollow noreferrer" target=_blank>#5455</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>修复了仅从 FS 中删除部件而不将它们从 Zookeeper 中删除的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5520 rel="external nofollow noreferrer" target=_blank>#5520</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>从 MySQL 协议中删除调试日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/5478 rel="external nofollow noreferrer" target=_blank>#5478</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 DDL 查询处理过程中跳过 ZNONODE. <a href=https://github.com/ClickHouse/ClickHouse/pull/5489 rel="external nofollow noreferrer" target=_blank>#5489</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复混合 <code class=syntax>UNION ALL</code> 结果列类型. 存在数据和结果列的列类型不一致的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/5503 rel="external nofollow noreferrer" target=_blank>#5503</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>在 dictGetT 函数中对错误的整数抛出异常而不是崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/5446 rel="external nofollow noreferrer" target=_blank>#5446</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复 <code class=syntax>system.dictionaries</code> 表中散列字典的错误 element_count 和 load_factor. <a href=https://github.com/ClickHouse/ClickHouse/pull/5440 rel="external nofollow noreferrer" target=_blank>#5440</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-9>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-9 title="Permanent link"> </a></h4> <ul> <li>修复了没有 <code class=syntax>Brotli</code> HTTP 压缩支持的构建 (<code class=syntax>ENABLE_BROTLI=OFF</code> cmake 变量). <a href=https://github.com/ClickHouse/ClickHouse/pull/5521 rel="external nofollow noreferrer" target=_blank>#5521</a> (<a href=https://github.com/citrin rel="external nofollow noreferrer" target=_blank>Anton Yuzhaninov</a>)</li> <li>包含 roaring.h 作为 roaring/roaring.h. <a href=https://github.com/ClickHouse/ClickHouse/pull/5523 rel="external nofollow noreferrer" target=_blank>#5523</a> (<a href=https://github.com/orivej rel="external nofollow noreferrer" target=_blank>Orivej Desh</a>)</li> <li>修复 hyperscan 中的 gcc9 警告 (#line directive is evil!). <a href=https://github.com/ClickHouse/ClickHouse/pull/5546 rel="external nofollow noreferrer" target=_blank>#5546</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>修复使用 gcc-9 编译时的所有警告. 修复一些贡献问题. 修复 gcc9 ICE 并提交给 bugzilla. <a href=https://github.com/ClickHouse/ClickHouse/pull/5498 rel="external nofollow noreferrer" target=_blank>#5498</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>修复了与 lld 的链接. <a href=https://github.com/ClickHouse/ClickHouse/pull/5477 rel="external nofollow noreferrer" target=_blank>#5477</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>删除字典中未使用的专业化. <a href=https://github.com/ClickHouse/ClickHouse/pull/5452 rel="external nofollow noreferrer" target=_blank>#5452</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>针对不同类型文件的格式化和解析表的改进性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/5497 rel="external nofollow noreferrer" target=_blank>#5497</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>修复并行测试运行. <a href=https://github.com/ClickHouse/ClickHouse/pull/5506 rel="external nofollow noreferrer" target=_blank>#5506</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>Docker: 使用 clickhouse-test 中的配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/5531 rel="external nofollow noreferrer" target=_blank>#5531</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复 FreeBSD 编译. <a href=https://github.com/ClickHouse/ClickHouse/pull/5447 rel="external nofollow noreferrer" target=_blank>#5447</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>升级 boost 到 1.70. <a href=https://github.com/ClickHouse/ClickHouse/pull/5570 rel="external nofollow noreferrer" target=_blank>#5570</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复构建clickhouse作为子模块的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/5574 rel="external nofollow noreferrer" target=_blank>#5574</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>改进 JSONExtract 性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/5444 rel="external nofollow noreferrer" target=_blank>#5444</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> </ul> <h2 id=clickhouse-release-19-8>ClickHouse 版本 19.8<a class=headerlink href=../amp/#clickhouse-release-19-8 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-8-3-8-2019-06-11>ClickHouse 版本 19.8.3.8, 2019-06-11<a class=headerlink href=../amp/#clickhouse-release-19-8-3-8-2019-06-11 title="Permanent link"> </a></h3> <h4 id=new-features>新特征<a class=headerlink href=../amp/#new-features title="Permanent link"> </a></h4> <ul> <li>添加了使用 JSON 的函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/4686 rel="external nofollow noreferrer" target=_blank>#4686</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/5124 rel="external nofollow noreferrer" target=_blank>#5124</a>. (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>添加一个函数 basename, 其行为类似于 basename 函数, 该函数存在于很多语言中 (python 中的 <code class=syntax>os.path.basename</code>，PHP 中的 <code class=syntax>basename</code> 等......). 使用类 UNIX 路径或 Windows 路径. <a href=https://github.com/ClickHouse/ClickHouse/pull/5136 rel="external nofollow noreferrer" target=_blank>#5136</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>添加了 <code class=syntax>LIMIT n, m BY</code> 或 <code class=syntax>LIMIT m OFFSET n BY</code> 语法来为LIMIT BY 子句设置n 的偏移量. <a href=https://github.com/ClickHouse/ClickHouse/pull/5138 rel="external nofollow noreferrer" target=_blank>#5138</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>添加了新的数据类型 <code class=syntax>SimpleAggregateFunction</code>, 它允许在 <code class=syntax>AggregatingMergeTree</code> 中具有轻聚合的列. 这只能与简单的函数一起使用, 如 <code class=syntax>any</code>、<code class=syntax>anyLast</code>、<code class=syntax>sum</code>、<code class=syntax>min</code>、<code class=syntax>max</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4629 rel="external nofollow noreferrer" target=_blank>#4629</a> (<a href=https://github.com/bgranvea rel="external nofollow noreferrer" target=_blank>Boris Granveaud</a>)</li> <li>在函数 <code class=syntax>ngramDistance</code> 中添加了对非常量参数的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/5198 rel="external nofollow noreferrer" target=_blank>#5198</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>添加函数 <code class=syntax>skewPop</code>、<code class=syntax>skewSamp</code>、<code class=syntax>kurtPop</code> 和 <code class=syntax>kurtSamp</code> 分别计算序列偏度、样本偏度、峰度和样本峰度. <a href=https://github.com/ClickHouse/ClickHouse/pull/5200 rel="external nofollow noreferrer" target=_blank>#5200</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>支持 <code class=syntax>MaterializeView</code> 存储的重命名操作. <a href=https://github.com/ClickHouse/ClickHouse/pull/5209 rel="external nofollow noreferrer" target=_blank>#5209</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>添加了允许使用 MySQL 客户端连接到 ClickHouse 的服务器. <a href=https://github.com/ClickHouse/ClickHouse/pull/4715 rel="external nofollow noreferrer" target=_blank>#4715</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>添加 <code class=syntax>toDecimal*OrZero</code> 和 <code class=syntax>toDecimal*OrNull</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/5291 rel="external nofollow noreferrer" target=_blank>#5291</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>支持函数中的十进制类型: <code class=syntax>quantile</code>、<code class=syntax>quantiles</code>、<code class=syntax>median</code>、<code class=syntax>quantileExactWeighted</code>、<code class=syntax>quantilesExactWeighted</code>、<code class=syntax>medianExactWeighted</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5304 rel="external nofollow noreferrer" target=_blank>#5304</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>添加了 <code class=syntax>toValidUTF8</code> 函数，用替换字符 � (U+FFFD) 替换所有无效的 UTF-8 字符. <a href=https://github.com/ClickHouse/ClickHouse/pull/5322 rel="external nofollow noreferrer" target=_blank>#5322</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>添加了 <code class=syntax>format</code> 功能. 使用参数中列出的字符串格式化常量模式 (简化的 Python 格式模式). <a href=https://github.com/ClickHouse/ClickHouse/pull/5330 rel="external nofollow noreferrer" target=_blank>#5330</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>添加了 <code class=syntax>system.detached_parts</code> 表, 其中包含有关 <code class=syntax>MergeTree</code> 表的分离部分的信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/5353 rel="external nofollow noreferrer" target=_blank>#5353</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>akuzm</a>)</li> <li>添加了 <code class=syntax>ngramSearch</code> 函数来计算needle和haystack之间的非对称差异. <a href=https://github.com/ClickHouse/ClickHouse/pull/5418 rel="external nofollow noreferrer" target=_blank>#5418</a><a href=https://github.com/ClickHouse/ClickHouse/pull/5422 rel="external nofollow noreferrer" target=_blank>#5422</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>使用聚合函数接口实现基本机器学习方法 (随机线性回归和逻辑回归). 有不同的更新模型权重的策略 (简单梯度下降、动量方法、Nesterov 方法). 还支持自定义尺寸的小批量. <a href=https://github.com/ClickHouse/ClickHouse/pull/4943 rel="external nofollow noreferrer" target=_blank>#4943</a> (<a href=https://github.com/Quid37 rel="external nofollow noreferrer" target=_blank>Quid37</a>)</li> <li><code class=syntax>geohashEncode</code> 和 <code class=syntax>geohashDecode</code> 函数的实现. <a href=https://github.com/ClickHouse/ClickHouse/pull/5003 rel="external nofollow noreferrer" target=_blank>#5003</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>添加聚合函数<code class=syntax>timeSeriesGroupSum</code>, 可以聚合采样时间戳不对齐的不同时间序列. 它将在两个样本时间戳之间使用线性插值, 然后将时间序列相加. 添加聚合函数 <code class=syntax>timeSeriesGroupRateSum</code> , 它计算时间序列的速率, 然后将速率相加. <a href=https://github.com/ClickHouse/ClickHouse/pull/4542 rel="external nofollow noreferrer" target=_blank>#4542</a> (<a href=https://github.com/LiuYangkuan rel="external nofollow noreferrer" target=_blank>Yangkuan Liu</a>)</li> <li>添加了函数 <code class=syntax>IPv4CIDRtoIPv4Range</code> 和 <code class=syntax>IPv6CIDRtoIPv6Range</code> 以使用 CIDR 计算子网中 IP 的下限和上限. <a href=https://github.com/ClickHouse/ClickHouse/pull/5095 rel="external nofollow noreferrer" target=_blank>#5095</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>当我们使用启用设置 <code class=syntax>send_progress_in_http_headers</code> 的 HTTP 发送查询时, 添加 X-ClickHouse-Summary 标头. 返回 X-ClickHouse-Progress 的常用信息, 附加信息, 如查询中插入了多少行和字节数. <a href=https://github.com/ClickHouse/ClickHouse/pull/5116 rel="external nofollow noreferrer" target=_blank>#5116</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> </ul> <h4 id=improvements>改进<a class=headerlink href=../amp/#improvements title="Permanent link"> </a></h4> <ul> <li>为 MergeTree 系列表(默认值: 100 000) 添加了 <code class=syntax>max_parts_in_total</code> 设置, 以防止不安全的分区键规范 #5166. <a href=https://github.com/ClickHouse/ClickHouse/pull/5171 rel="external nofollow noreferrer" target=_blank>#5171</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>clickhouse-obfuscator</code>: 通过将初始种子与列名而不是列位置相结合来为各个列派生种子. 这旨在转换具有多个相关表的数据集, 以便转换后表保持可连接. <a href=https://github.com/ClickHouse/ClickHouse/pull/5178 rel="external nofollow noreferrer" target=_blank>#5178</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了函数<code class=syntax>JSONExtractRaw</code>、<code class=syntax>JSONExtractKeyAndValues</code>. 将函数 <code class=syntax>jsonExtract&lt;type&gt;</code> 重命名为 <code class=syntax>JSONExtract&lt;type&gt;</code>. 当出现问题时, 这些函数返回相应的值, 而不是 <code class=syntax>NULL</code> . 修改了函数<code class=syntax>JSONExtract</code>, 现在它从它的最后一个参数中获取返回类型并且不注入可空值. 在 AVX2 指令不可用的情况下, 实现了对 RapidJSON 的回退. Simdjson 库更新到新版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/5235 rel="external nofollow noreferrer" target=_blank>#5235</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>现在 <code class=syntax>if</code> 和 <code class=syntax>multiIf</code> 函数不依赖于条件的 <code class=syntax>Nullable</code> , 而是依赖于分支的sql兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/5238 rel="external nofollow noreferrer" target=_blank>#5238</a> (<a href=https://github.com/janplus rel="external nofollow noreferrer" target=_blank>Jian Wu</a>)</li> <li><code class=syntax>In</code> 谓词现在从 <code class=syntax>Null</code> 输入生成 <code class=syntax>Null</code> 结果, 就像 <code class=syntax>Equal</code> 函数一样. <a href=https://github.com/ClickHouse/ClickHouse/pull/5152 rel="external nofollow noreferrer" target=_blank>#5152</a> (<a href=https://github.com/janplus rel="external nofollow noreferrer" target=_blank>Jian Wu</a>)</li> <li>查来自 Kafka 的每 (flush_interval / poll_timeout) 行数的时间限制. 这允许更频繁地中断 Kafka 消费者的读取并检查顶级流的时间限制. <a href=https://github.com/ClickHouse/ClickHouse/pull/5249 rel="external nofollow noreferrer" target=_blank>#5249</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>将 rdkafka 与捆绑的 SASL 联系起来. 它应该允许使用 SASL SCRAM 身份验证. <a href=https://github.com/ClickHouse/ClickHouse/pull/5253 rel="external nofollow noreferrer" target=_blank>#5253</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>用于 ALL JOINS 的 RowRefList 的批处理版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/5267 rel="external nofollow noreferrer" target=_blank>#5267</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>clickhouse-server: 提供更多信息的侦听错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/5268 rel="external nofollow noreferrer" target=_blank>#5268</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>支持 clickhouse-copier 中的字典用于 <code class=syntax>&lt;sharding_key&gt;</code> 中的函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/5270 rel="external nofollow noreferrer" target=_blank>#5270</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>添加新设置 <code class=syntax>kafka_commit_every_batch</code> 以规范 Kafka 提交策略.<br> 它允许设置提交模式: 在处理每批消息之后, 或在整个块写入存储之后. 这是在某些极端情况下丢失某些消息或读取它们两次之间的权衡. <a href=https://github.com/ClickHouse/ClickHouse/pull/5308 rel="external nofollow noreferrer" target=_blank>#5308</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>使 <code class=syntax>windowFunnel</code> 支持其他无符号整数类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/5320 rel="external nofollow noreferrer" target=_blank>#5320</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>)</li> <li>允许在 Merge 引擎中隐藏虚拟列 <code class=syntax>_table</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5325 rel="external nofollow noreferrer" target=_blank>#5325</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>使 <code class=syntax>sequenceMatch</code> 聚合函数支持其他无符号整数类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/5339 rel="external nofollow noreferrer" target=_blank>#5339</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>)</li> <li>如果校验和不匹配最有可能是由硬件故障引起的, 则会提供更好的错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/5355 rel="external nofollow noreferrer" target=_blank>#5355</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>检查底层表是否支持对 <code class=syntax>StorageMerge</code> 的采样 <a href=https://github.com/ClickHouse/ClickHouse/pull/5366 rel="external nofollow noreferrer" target=_blank>#5366</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>在外部字典中使用后关闭 MySQL 连接. 它与问题 #893 有关. <a href=https://github.com/ClickHouse/ClickHouse/pull/5395 rel="external nofollow noreferrer" target=_blank>#5395</a> (<a href=https://github.com/clemrodriguez rel="external nofollow noreferrer" target=_blank>Clément Rodriguez</a>)</li> <li>MySQL Wire 协议的改进. 将格式名称更改为 MySQLWire. 使用 RAII 调用 RSA_free. 如果无法创建上下文, 则禁用 SSL. <a href=https://github.com/ClickHouse/ClickHouse/pull/5419 rel="external nofollow noreferrer" target=_blank>#5419</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>允许使用不可访问的历史文件运行 (只读，没有磁盘空间，文件是目录，...). <a href=https://github.com/ClickHouse/ClickHouse/pull/5431 rel="external nofollow noreferrer" target=_blank>#5431</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>尊重异步 INSERT 中的查询设置到分布式表. <a href=https://github.com/ClickHouse/ClickHouse/pull/4936 rel="external nofollow noreferrer" target=_blank>#4936</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>)</li> <li>将函数 <code class=syntax>leastSqr</code> 重命名为 <code class=syntax>simpleLinearRegression</code>，将 <code class=syntax>LinearRegression</code> 重命名为 <code class=syntax>linearRegression</code>，将 <code class=syntax>LogisticRegression</code> 重命名为 <code class=syntax>logisticRegression</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5391 rel="external nofollow noreferrer" target=_blank>#5391</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> </ul> <h4 id=performance-improvements>性能改进<a class=headerlink href=../amp/#performance-improvements title="Permanent link"> </a></h4> <ul> <li>在 ALTER MODIFY 查询中并行处理部分非复制 MergeTree 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/4639 rel="external nofollow noreferrer" target=_blank>#4639</a> (<a href=https://github.com/IvanKush rel="external nofollow noreferrer" target=_blank>Ivan Kush</a>)</li> <li>正则表达式提取优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/5193 rel="external nofollow noreferrer" target=_blank>#5193</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5191 rel="external nofollow noreferrer" target=_blank>#5191</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>如果仅在连接部分中使用, 请勿添加右连接键列以连接结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/5260 rel="external nofollow noreferrer" target=_blank>#5260</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>在第一个空响应后冻结 Kafka 缓冲区. 它避免了多次调用 <code class=syntax>ReadBuffer::next()</code> 以获得一些行解析流中的空结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/5283 rel="external nofollow noreferrer" target=_blank>#5283</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>多参数的 <code class=syntax>concat</code> 函数优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/5357 rel="external nofollow noreferrer" target=_blank>#5357</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>查询优化. 允许在将逗号/交叉连接重写为内部语句时下推 IN 语句. <a href=https://github.com/ClickHouse/ClickHouse/pull/5396 rel="external nofollow noreferrer" target=_blank>#5396</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>用参考文件1升级您的LZ4实现以获得更快的解压. <a href=https://github.com/ClickHouse/ClickHouse/pull/5070 rel="external nofollow noreferrer" target=_blank>#5070</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>实现了 MSD 基数排序 (基于 kxsort) 和部分排序. <a href=https://github.com/ClickHouse/ClickHouse/pull/5129 rel="external nofollow noreferrer" target=_blank>#5129</a> (<a href=https://github.com/kvinty rel="external nofollow noreferrer" target=_blank>Evgenii Pravda</a>)</li> </ul> <h4 id=bug-fixes>Bug 修复<a class=headerlink href=../amp/#bug-fixes title="Permanent link"> </a></h4> <ul> <li>修复推送需要加入的列. <a href=https://github.com/ClickHouse/ClickHouse/pull/5192 rel="external nofollow noreferrer" target=_blank>#5192</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>修复了当 ClickHouse 由 systemd 运行时, 命令 <code class=syntax>sudo service clickhouse-server forcerestart</code> 没有按预期工作的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/5204 rel="external nofollow noreferrer" target=_blank>#5204</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>复 DataPartsExchange 中的 http 错误代码 (9009 端口上的服务器间 http 服务器始终返回代码 200, 即使出现错误). <a href=https://github.com/ClickHouse/ClickHouse/pull/5216 rel="external nofollow noreferrer" target=_blank>#5216</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复长度超过 MAX_SMALL_STRING_SIZE 的字符串的 SimpleAggregateFunction <a href=https://github.com/ClickHouse/ClickHouse/pull/5311 rel="external nofollow noreferrer" target=_blank>#5311</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复 IN 中 <code class=syntax>Decimal</code> 到 <code class=syntax>Nullable(Decimal)</code> 的转换错误. 支持其他十进制到十进制的转换 (包括不同的尺度). <a href=https://github.com/ClickHouse/ClickHouse/pull/5350 rel="external nofollow noreferrer" target=_blank>#5350</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了 simdjson 库中的 FPU 破坏导致 <code class=syntax>uniqHLL</code> 和 <code class=syntax>uniqCombined</code> 聚合函数和数学函数 (如 <code class=syntax>log</code>) 计算错误的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/5354 rel="external nofollow noreferrer" target=_blank>#5354</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 JSON 函数中混合常量/非常量情况的处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/5435 rel="external nofollow noreferrer" target=_blank>#5435</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复 <code class=syntax>retention</code> 功能. 现在在一行数据中满足的所有条件都添加到数据状态中. <a href=https://github.com/ClickHouse/ClickHouse/pull/5119 rel="external nofollow noreferrer" target=_blank>#5119</a> (<a href=https://github.com/nicelulu rel="external nofollow noreferrer" target=_blank>小路</a>)</li> <li>用小数修复 <code class=syntax>quantileExact</code> 的结果类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/5304 rel="external nofollow noreferrer" target=_blank>#5304</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=documentation>文档<a class=headerlink href=../amp/#documentation title="Permanent link"> </a></h4> <ul> <li>将 <code class=syntax>CollapsingMergeTree</code> 的文档翻译成中文. <a href=https://github.com/ClickHouse/ClickHouse/pull/5168 rel="external nofollow noreferrer" target=_blank>#5168</a> (<a href=https://github.com/AlexZFX rel="external nofollow noreferrer" target=_blank>张风啸</a>)</li> <li>将一些关于表引擎的文档翻译成中文. <a href=https://github.com/ClickHouse/ClickHouse/pull/5134 rel="external nofollow noreferrer" target=_blank>#5134</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5328 rel="external nofollow noreferrer" target=_blank>#5328</a> (<a href=https://github.com/neverlee rel="external nofollow noreferrer" target=_blank>never lee</a>)</li> </ul> <h4 id=buildtestingpackaging-improvements>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvements title="Permanent link"> </a></h4> <ul> <li>复一些显示可能在免费后使用的清除报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/5139 rel="external nofollow noreferrer" target=_blank>#5139</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5143 rel="external nofollow noreferrer" target=_blank>#5143</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5393 rel="external nofollow noreferrer" target=_blank>#5393</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>为方便起见, 将性能测试移出单独的目录. <a href=https://github.com/ClickHouse/ClickHouse/pull/5158 rel="external nofollow noreferrer" target=_blank>#5158</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复不正确的性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/5255 rel="external nofollow noreferrer" target=_blank>#5255</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>增加了一个工具来计算由位转换引起的校验和来调试硬件问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/5334 rel="external nofollow noreferrer" target=_blank>#5334</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使运行脚本更有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/5340 rel="external nofollow noreferrer" target=_blank>#5340</a><a href=https://github.com/ClickHouse/ClickHouse/pull/5360 rel="external nofollow noreferrer" target=_blank>#5360</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>添加如何编写性能测试的小说明. <a href=https://github.com/ClickHouse/ClickHouse/pull/5408 rel="external nofollow noreferrer" target=_blank>#5408</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加在性能测试中的创建、填充和删除查询中进行替换的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/5367 rel="external nofollow noreferrer" target=_blank>#5367</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> </ul> <h2 id=clickhouse-release-19-7>ClickHouse 版本 19.7<a class=headerlink href=../amp/#clickhouse-release-19-7 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-7-5-29-2019-07-05>ClickHouse 版本 19.7.5.29, 2019-07-05<a class=headerlink href=../amp/#clickhouse-release-19-7-5-29-2019-07-05 title="Permanent link"> </a></h3> <h4 id=bug-fix-25>Bug 修复<a class=headerlink href=../amp/#bug-fix-25 title="Permanent link"> </a></h4> <ul> <li>使用 JOIN 修复某些查询中的性能回归. <a href=https://github.com/ClickHouse/ClickHouse/pull/5192 rel="external nofollow noreferrer" target=_blank>#5192</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> </ul> <h3 id=clickhouse-release-19-7-5-27-2019-06-09>ClickHouse 版本 19.7.5.27, 2019-06-09<a class=headerlink href=../amp/#clickhouse-release-19-7-5-27-2019-06-09 title="Permanent link"> </a></h3> <h4 id=new-features-1>新特征<a class=headerlink href=../amp/#new-features-1 title="Permanent link"> </a></h4> <ul> <li>添加位图相关函数 <code class=syntax>bitmapHasAny</code> 和 <code class=syntax>bitmapHasAll</code> 类似于数组的 <code class=syntax>hasAny</code> 和 <code class=syntax>hasAll</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/5279 rel="external nofollow noreferrer" target=_blank>#5279</a> (<a href=https://github.com/svladykin rel="external nofollow noreferrer" target=_blank>Sergi Vladykin</a>)</li> </ul> <h4 id=bug-fixes-1>Bug 修复<a class=headerlink href=../amp/#bug-fixes-1 title="Permanent link"> </a></h4> <ul> <li>使用 Null 值修复 <code class=syntax>minmax</code> INDEX 上的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5246 rel="external nofollow noreferrer" target=_blank>#5246</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>将 LIMIT BY 中的所有输入列标记为所需输出。 它修复了某些分布式查询中的 <code class=syntax>Not found column</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5407 rel="external nofollow noreferrer" target=_blank>#5407</a> (<a href=https://github.com/kvap rel="external nofollow noreferrer" target=_blank>Constantin S. Pan</a>)</li> <li>在带有 DEFAULT 的列上修复 <code class=syntax>SELECT .. PREWHERE</code> 中的 <code class=syntax>Column '0' already exists</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5397 rel="external nofollow noreferrer" target=_blank>#5397</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复 <code class=syntax>ReplicatedMergeTree</code> 上的 <code class=syntax>ALTER MODIFY TTL</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/5539/commits rel="external nofollow noreferrer" target=_blank>#5539</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>当 Kafka 消费者启动失败时不要让服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/5285 rel="external nofollow noreferrer" target=_blank>#5285</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复位图函数产生错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/5359 rel="external nofollow noreferrer" target=_blank>#5359</a> (<a href=https://github.com/andyyzh rel="external nofollow noreferrer" target=_blank>Andy Yang</a>)</li> <li>修复哈希字典的 element_count (不包括重复项). <a href=https://github.com/ClickHouse/ClickHouse/pull/5440 rel="external nofollow noreferrer" target=_blank>#5440</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>使用环境变量 TZ 的内容作为时区的名称. 在某些情况下有助于正确检测默认时区. <a href=https://github.com/ClickHouse/ClickHouse/pull/5443 rel="external nofollow noreferrer" target=_blank>#5443</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>不要尝试在 <code class=syntax>dictGetT</code> 函数中转换整数, 因为它不能正常工作. 改为抛出异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/5446 rel="external nofollow noreferrer" target=_blank>#5446</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复 ExternalData HTTP 请求中的设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/5455 rel="external nofollow noreferrer" target=_blank>#5455</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila<br> Kutenin</a>)</li> <li>修复了仅从 FS 中删除部件而不将它们从 Zookeeper 中删除的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5520 rel="external nofollow noreferrer" target=_blank>#5520</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>bitmapHasAny</code> 函数中的分段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5528 rel="external nofollow noreferrer" target=_blank>#5528</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>修复了复制连接池不重试解析主机时的错误, 即使 DNS 缓存已删除. <a href=https://github.com/ClickHouse/ClickHouse/pull/5534 rel="external nofollow noreferrer" target=_blank>#5534</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>DROP INDEX IF EXISTS</code> 查询. 现在 <code class=syntax>ALTER TABLE ... DROP INDEX IF EXISTS ...</code> 如果提供的索引不存在, 查询不会引发异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/5524 rel="external nofollow noreferrer" target=_blank>#5524</a> (<a href=https://github.com/NanoBjorn rel="external nofollow noreferrer" target=_blank>Gleb Novikov</a>)</li> <li>修复联合所有超类型列. 存在数据和结果列的列类型不一致的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/5503 rel="external nofollow noreferrer" target=_blank>#5503</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>在 DDL 查询处理期间跳过 ZNONODE. 在另一个节点删除任务队列中的 znode 之前, 没有处理它但已经获得孩子列表的节点将终止 DDLWorker 线程. <a href=https://github.com/ClickHouse/ClickHouse/pull/5489 rel="external nofollow noreferrer" target=_blank>#5489</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>使用 MATERIALIZED 列将 INSERT 修复到 Distributed() 表中. <a href=https://github.com/ClickHouse/ClickHouse/pull/5429 rel="external nofollow noreferrer" target=_blank>#5429</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> </ul> <h3 id=clickhouse-release-19-7-3-9-2019-05-30>ClickHouse 版本 19.7.3.9, 2019-05-30<a class=headerlink href=../amp/#clickhouse-release-19-7-3-9-2019-05-30 title="Permanent link"> </a></h3> <h4 id=new-features-2>新特征<a class=headerlink href=../amp/#new-features-2 title="Permanent link"> </a></h4> <ul> <li>允许限制用户可以指定的设置范围. 这些约束可以在用户设置配置文件中设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/4931 rel="external nofollow noreferrer" target=_blank>#4931</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>添加函数 <code class=syntax>groupUniqArray</code> 的第二个版本, 并带有一个可选的 <code class=syntax>max_size</code> 参数, 用于限制结果数组的大小, 这种行为类似于 <code class=syntax>groupArray(max_size)(x)</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/5026 rel="external nofollow noreferrer" target=_blank>#5026</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>对于 TSVWithNames/CSVWithNames 输入文件格式, 现在可以根据文件标题确定列顺序. 这由 <code class=syntax>input_format_with_names_use_header</code> 参数控制.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/5081 rel="external nofollow noreferrer" target=_blank>#5081</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander</a>)</li> </ul> <h4 id=bug-fixes-2>Bug 修复<a class=headerlink href=../amp/#bug-fixes-2 title="Permanent link"> </a></h4> <ul> <li>uncompressed_cache + JOIN在合并期间崩溃. (#5197)<a href=https://github.com/ClickHouse/ClickHouse/pull/5133 rel="external nofollow noreferrer" target=_blank>#5133</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>clickhouse 客户端查询系统表时出现分段错误. #5066. <a href=https://github.com/ClickHouse/ClickHouse/pull/5127 rel="external nofollow noreferrer" target=_blank>#5127</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>通过 KafkaEngine 重载数据丢失. (#4736) <a href=https://github.com/ClickHouse/ClickHouse/pull/5080 rel="external nofollow noreferrer" target=_blank>#5080</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>修复了在使用 UNION ALL 执行涉及至少两个来自 system.columns、system.tables、system.parts、system.parts_tables 或 Merge 系列表的查询并执行相关列的 ALTER 时可能发生的非常罕见的数据竞争条件并发表. <a href=https://github.com/ClickHouse/ClickHouse/pull/5189 rel="external nofollow noreferrer" target=_blank>#5189</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=performance-improvements-1>性能改进<a class=headerlink href=../amp/#performance-improvements-1 title="Permanent link"> </a></h4> <ul> <li>使用基数排序按 <code class=syntax>ORDER BY</code> 中的单个数字列进行排序, 而无需 <code class=syntax>LIMIT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/5106 rel="external nofollow noreferrer" target=_blank>#5106</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/4439 rel="external nofollow noreferrer" target=_blank>#4439</a> (<a href=https://github.com/kvinty rel="external nofollow noreferrer" target=_blank>Evgenii Pravda</a>, <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=documentation-1>文档<a class=headerlink href=../amp/#documentation-1 title="Permanent link"> </a></h4> <ul> <li>将一些表引擎的文档翻译成中文. <a href=https://github.com/ClickHouse/ClickHouse/pull/5107 rel="external nofollow noreferrer" target=_blank>#5107</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/5094 rel="external nofollow noreferrer" target=_blank>#5094</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/5087 rel="external nofollow noreferrer" target=_blank>#5087</a> (<a href=https://github.com/AlexZFX rel="external nofollow noreferrer" target=_blank>张风啸</a>), <a href=https://github.com/ClickHouse/ClickHouse/pull/5068 rel="external nofollow noreferrer" target=_blank>#5068</a> (<a href=https://github.com/neverlee rel="external nofollow noreferrer" target=_blank>never lee</a>)</li> </ul> <h4 id=buildtestingpackaging-improvements-1>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvements-1 title="Permanent link"> </a></h4> <ul> <li>在 <code class=syntax>clickhouse-test</code> 中正确打印 UTF-8 字符. <a href=https://github.com/ClickHouse/ClickHouse/pull/5084 rel="external nofollow noreferrer" target=_blank>#5084</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为 clickhouse-client 添加命令行参数以始终加载建议数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/5102 rel="external nofollow noreferrer" target=_blank>#5102</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>解决部分 PVS-Studio 警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/5082 rel="external nofollow noreferrer" target=_blank>#5082</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>更新 LZ4. <a href=https://github.com/ClickHouse/ClickHouse/pull/5040 rel="external nofollow noreferrer" target=_blank>#5040</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>添加 gperf 以构建即将到来的拉取请求的需求 #5030. <a href=https://github.com/ClickHouse/ClickHouse/pull/5110 rel="external nofollow noreferrer" target=_blank>#5110</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h2 id=clickhouse-release-19-6>ClickHouse 版本 19.6<a class=headerlink href=../amp/#clickhouse-release-19-6 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-6-3-18-2019-06-13>ClickHouse 版本 19.6.3.18, 2019-06-13<a class=headerlink href=../amp/#clickhouse-release-19-6-3-18-2019-06-13 title="Permanent link"> </a></h3> <h4 id=bug-fixes-3>Bug 修复<a class=headerlink href=../amp/#bug-fixes-3 title="Permanent link"> </a></h4> <ul> <li>修复了来自表函数 <code class=syntax>mysql</code> 和 <code class=syntax>odbc</code> 以及相应表引擎的查询的 IN 条件下推. 这修复了 #3540 和 #2384. <a href=https://github.com/ClickHouse/ClickHouse/pull/5313 rel="external nofollow noreferrer" target=_blank>#5313</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 Zookeeper 中的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/5297 rel="external nofollow noreferrer" target=_blank>#5297</a> (<a href=https://github.com/github1youlc rel="external nofollow noreferrer" target=_blank>github1youlc</a>)</li> <li>允许在 CSV 中引用小数. <a href=https://github.com/ClickHouse/ClickHouse/pull/5284 rel="external nofollow noreferrer" target=_blank>#5284</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a></li> <li>禁止从浮点 Inf/NaN 转换为小数 (抛出异常). <a href=https://github.com/ClickHouse/ClickHouse/pull/5282 rel="external nofollow noreferrer" target=_blank>#5282</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复重命名查询中的数据竞争. <a href=https://github.com/ClickHouse/ClickHouse/pull/5247 rel="external nofollow noreferrer" target=_blank>#5247</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>暂时禁用 LFAlloc. 使用 LFAlloc 可能会导致在分配 UncompressedCache 时出现大量 MAP_FAILED 并导致高负载服务器上的查询崩溃. <a href=https://github.com/ClickHouse/ClickHouse/commit/cfdba938ce22f16efeec504f7f90206a515b1280 rel="external nofollow noreferrer" target=_blank>cfdba93</a>(<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> </ul> <h3 id=clickhouse-release-19-6-2-11-2019-05-13>ClickHouse 版本 19.6.2.11, 2019-05-13<a class=headerlink href=../amp/#clickhouse-release-19-6-2-11-2019-05-13 title="Permanent link"> </a></h3> <h4 id=new-features-3>新特征<a class=headerlink href=../amp/#new-features-3 title="Permanent link"> </a></h4> <ul> <li>列和表的 TTL 表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/4212 rel="external nofollow noreferrer" target=_blank>#4212</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>添加了对 HTTP 响应的 <code class=syntax>brotli</code> 压缩的支持 (接受编码：br). <a href=https://github.com/ClickHouse/ClickHouse/pull/4388 rel="external nofollow noreferrer" target=_blank>#4388</a> (<a href=https://github.com/fandyushin rel="external nofollow noreferrer" target=_blank>Mikhail</a>)</li> <li>添加了新函数 <code class=syntax>isValidUTF8</code> 用于检查一组字节是否正确 utf-8 编码. <a href=https://github.com/ClickHouse/ClickHouse/pull/4934 rel="external nofollow noreferrer" target=_blank>#4934</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>添加新的负载平衡策略 <code class=syntax>first_or_random</code> , 它将查询发送到第一个指定的主机, 如果无法访问, 则将查询发送到分片的随机主机. 对交叉复制拓扑设置有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/5012 rel="external nofollow noreferrer" target=_blank>#5012</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>)</li> </ul> <h4 id=experimental-features-1>实验功能<a class=headerlink href=../amp/#experimental-features-1 title="Permanent link"> </a></h4> <ul> <li>为 MergeTree* 表族添加设置 <code class=syntax>index_granularity_bytes</code> (自适应索引粒度). <a href=https://github.com/ClickHouse/ClickHouse/pull/4826 rel="external nofollow noreferrer" target=_blank>#4826</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> </ul> <h4 id=improvements-1>改进<a class=headerlink href=../amp/#improvements-1 title="Permanent link"> </a></h4> <ul> <li>添加了对函数 <code class=syntax>substringUTF8</code> 的非常量和负大小和长度参数的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/4989 rel="external nofollow noreferrer" target=_blank>#4989</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在左连接中禁用右表下推, 右连接中禁用左表, 以及完全连接中的两个表. 这在某些情况下修复了错误的 JOIN 结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/4846 rel="external nofollow noreferrer" target=_blank>#4846</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li><code class=syntax>clickhouse-copier</code>: 从<code class=syntax>--task-file</code>选项自动上传任务配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/4876 rel="external nofollow noreferrer" target=_blank>#4876</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>为存储工厂和表函数工厂添加了错别字处理程序. <a href=https://github.com/ClickHouse/ClickHouse/pull/4891 rel="external nofollow noreferrer" target=_blank>#4891</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>支持无子查询的多个连接的星号和合格星号. <a href=https://github.com/ClickHouse/ClickHouse/pull/4898 rel="external nofollow noreferrer" target=_blank>#4898</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>使缺失列错误消息更加用户友好. <a href=https://github.com/ClickHouse/ClickHouse/pull/4915 rel="external nofollow noreferrer" target=_blank>#4915</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=performance-improvements-2>性能改进<a class=headerlink href=../amp/#performance-improvements-2 title="Permanent link"> </a></h4> <ul> <li>ASOF JOIN 的显着加速. <a href=https://github.com/ClickHouse/ClickHouse/pull/4924 rel="external nofollow noreferrer" target=_blank>#4924</a> (<a href=https://github.com/Gladdy rel="external nofollow noreferrer" target=_blank>Martijn Bakker</a>)</li> </ul> <h4 id=backward-incompatible-changes>向后不兼容更改<a class=headerlink href=../amp/#backward-incompatible-changes title="Permanent link"> </a></h4> <ul> <li>HTTP 标头 <code class=syntax>Query-Id</code> 重命名为 <code class=syntax>X-ClickHouse-Query-Id</code> 以保持一致性. <a href=https://github.com/ClickHouse/ClickHouse/pull/4972 rel="external nofollow noreferrer" target=_blank>#4972</a> (<a href=https://github.com/fandyushin rel="external nofollow noreferrer" target=_blank>Mikhail</a>)</li> </ul> <h4 id=bug-fixes-4>Bug 修复<a class=headerlink href=../amp/#bug-fixes-4 title="Permanent link"> </a></h4> <ul> <li>修复了 <code class=syntax>clickhouse-copier</code> 中潜在的空指针取消引用. <a href=https://github.com/ClickHouse/ClickHouse/pull/4900 rel="external nofollow noreferrer" target=_blank>#4900</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复了 JOIN + ARRAY JOIN 查询错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4938 rel="external nofollow noreferrer" target=_blank>#4938</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了当字典通过带有 engine=Dictionary 的数据库依赖另一个字典时服务器启动时挂起的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4962 rel="external nofollow noreferrer" target=_blank>#4962</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>部分修复了 <code class=syntax>distributed_product_mode = local</code> . 可以通过表别名允许本地表的列在 <code class=syntax>where/have/order by/...</code> 中. 如果表没有别名, 则抛出异常. 目前还无法访问没有表别名的列. <a href=https://github.com/ClickHouse/ClickHouse/pull/4986 rel="external nofollow noreferrer" target=_blank>#4986</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>使用 <code class=syntax>JOIN</code> 修复 <code class=syntax>SELECT DISTINCT</code> 的潜在错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/5001 rel="external nofollow noreferrer" target=_blank>#5001</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了在使用 UNION ALL 执行涉及至少两个来自 system.columns、system.tables、system.parts、system.parts_tables 或 Merge 系列表的查询并执行相关列的 ALTER 时可能发生的非常罕见的数据竞争条件并发表. <a href=https://github.com/ClickHouse/ClickHouse/pull/5189 rel="external nofollow noreferrer" target=_blank>#5189</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=buildtestingpackaging-improvements-2>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvements-2 title="Permanent link"> </a></h4> <ul> <li>修复了在不同主机上运行 clickhouse-server 时的测试失败. <a href=https://github.com/ClickHouse/ClickHouse/pull/4713 rel="external nofollow noreferrer" target=_blank>#4713</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>clickhouse-test: 在非 tty 环境中禁用颜色控制序列. <a href=https://github.com/ClickHouse/ClickHouse/pull/4937 rel="external nofollow noreferrer" target=_blank>#4937</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>clickhouse-test: 允许使用任何测试数据库 (尽可能删除 <code class=syntax>test.</code> 限定) <a href=https://github.com/ClickHouse/ClickHouse/pull/5008 rel="external nofollow noreferrer" target=_blank>#5008</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复 ubsan 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/5037 rel="external nofollow noreferrer" target=_blank>#5037</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>在 ClickHouse 中添加了 Yandex LFAlloc 以不同方式分配 MarkCache 和 UncompressedCache 数据以更可靠地捕获段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4995 rel="external nofollow noreferrer" target=_blank>#4995</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>Python util 可帮助进行向后移植和更改日志. <a href=https://github.com/ClickHouse/ClickHouse/pull/4949 rel="external nofollow noreferrer" target=_blank>#4949</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> </ul> <h2 id=clickhouse-release-19-5>ClickHouse 版本 19.5<a class=headerlink href=../amp/#clickhouse-release-19-5 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-5-4-22-2019-05-13>ClickHouse 版本 19.5.4.22, 2019-05-13<a class=headerlink href=../amp/#clickhouse-release-19-5-4-22-2019-05-13 title="Permanent link"> </a></h3> <h4 id=bug-fixes-5>Bug 修复<a class=headerlink href=../amp/#bug-fixes-5 title="Permanent link"> </a></h4> <ul> <li>修复了位图* 函数中可能发生的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/5220 rel="external nofollow noreferrer" target=_blank>#5220</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/5228 rel="external nofollow noreferrer" target=_blank>#5228</a> (<a href=https://github.com/andyyzh rel="external nofollow noreferrer" target=_blank>Andy Yang</a>)</li> <li>修复了在使用 UNION ALL 执行涉及至少两个来自 system.columns、system.tables、system.parts、system.parts_tables 或 Merge 系列表的查询并执行相关列的 ALTER 时可能发生的非常罕见的数据竞争条件并发表. <a href=https://github.com/ClickHouse/ClickHouse/pull/5189 rel="external nofollow noreferrer" target=_blank>#5189</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 <code class=syntax>Set for IN is not created yet in case of using single LowCardinality column in the left part of IN</code>. 如果 LowCardinality 列是主键的一部分，则会发生此错误. #5031 <a href=https://github.com/ClickHouse/ClickHouse/pull/5154 rel="external nofollow noreferrer" target=_blank>#5154</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>保留函数修改: 如果一行同时满足第一个和第NTH个条件, 则只将第一个满足的条件添加到数据状态中. 现在在一行数据中满足的所有条件都添加到数据状态中. <a href=https://github.com/ClickHouse/ClickHouse/pull/5119 rel="external nofollow noreferrer" target=_blank>#5119</a> (<a href=https://github.com/nicelulu rel="external nofollow noreferrer" target=_blank>小路</a>)</li> </ul> <h3 id=clickhouse-release-19-5-3-8-2019-04-18>ClickHouse 版本 19.5.3.8, 2019-04-18<a class=headerlink href=../amp/#clickhouse-release-19-5-3-8-2019-04-18 title="Permanent link"> </a></h3> <h4 id=bug-fixes-6>Bug 修复<a class=headerlink href=../amp/#bug-fixes-6 title="Permanent link"> </a></h4> <ul> <li>固定类型的设置 <code class=syntax>max_partitions_per_insert_block</code> 从布尔值到 UInt64. <a href=https://github.com/ClickHouse/ClickHouse/pull/5028 rel="external nofollow noreferrer" target=_blank>#5028</a> (<a href=https://github.com/mhsekhavat rel="external nofollow noreferrer" target=_blank>Mohammad Hossein Sekhavat</a>)</li> </ul> <h3 id=clickhouse-release-19-5-2-6-2019-04-15>ClickHouse 版本 19.5.2.6, 2019-04-15<a class=headerlink href=../amp/#clickhouse-release-19-5-2-6-2019-04-15 title="Permanent link"> </a></h3> <h4 id=new-features-4>新特征<a class=headerlink href=../amp/#new-features-4 title="Permanent link"> </a></h4> <ul> <li><a href=https://github.com/intel/hyperscan rel="external nofollow noreferrer" target=_blank>Hyperscan</a> 添加了多个正则表达式匹配 (函数<code class=syntax>multiMatchAny</code>、<code class=syntax>multiMatchAnyIndex</code>、<code class=syntax>multiFuzzyMatchAny</code>、<code class=syntax>multiFuzzyMatchAnyIndex</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4780 rel="external nofollow noreferrer" target=_blank>#4780</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/4841 rel="external nofollow noreferrer" target=_blank>#4841</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>添加了 <code class=syntax>multiSearchFirstPosition</code> 功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/4780 rel="external nofollow noreferrer" target=_blank>#4780</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>表实现每行预定义的表达式过滤器. <a href=https://github.com/ClickHouse/ClickHouse/pull/4792 rel="external nofollow noreferrer" target=_blank>#4792</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>一种基于布隆过滤器的新型数据跳过索引 (可用于<code class=syntax>equal</code>、<code class=syntax>in</code>和<code class=syntax>like</code>函数). <a href=https://github.com/ClickHouse/ClickHouse/pull/4499 rel="external nofollow noreferrer" target=_blank>#4499</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>添加了<code class=syntax>ASOF JOIN</code>, 它允许运行连接到已知最新值的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/4774 rel="external nofollow noreferrer" target=_blank>#4774</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4867 rel="external nofollow noreferrer" target=_blank>#4867</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4863 rel="external nofollow noreferrer" target=_blank>#4863</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4875 rel="external nofollow noreferrer" target=_blank>#4875</a> (<a href=https://github.com/Gladdy rel="external nofollow noreferrer" target=_blank>Martijn Bakker</a>, <a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>将多个 <code class=syntax>COMMA JOIN</code> 重写为 <code class=syntax>CROSS JOIN</code>. 如果可能, 然后将它们重写为 <code class=syntax>INNER JOIN</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/4661 rel="external nofollow noreferrer" target=_blank>#4661</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=improvement-9>改进<a class=headerlink href=../amp/#improvement-9 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>topK</code> 和 <code class=syntax>topK Weighted</code> 现在支持自定义 <code class=syntax>load Factor</code>. (fixes issue <a href=https://github.com/ClickHouse/ClickHouse/issues/4252 rel="external nofollow noreferrer" target=_blank>#4252</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4634 rel="external nofollow noreferrer" target=_blank>#4634</a> (<a href=https://github.com/kirillDanshin rel="external nofollow noreferrer" target=_blank>Kirill Danshin</a>)</li> <li>即使对于没有采样的表, 也允许使用 <code class=syntax>parallel_replicas_count &gt; 1</code> (该设置被简单地忽略). 在以前的版本中, 它导致异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/4637 rel="external nofollow noreferrer" target=_blank>#4637</a> (<a href=https://github.com/digitalist rel="external nofollow noreferrer" target=_blank>Alexey Elymanov</a>)</li> <li>支持 <code class=syntax>CREATE OR REPLACE VIEW</code>. 允许在单个语句中创建视图或设置新定义. <a href=https://github.com/ClickHouse/ClickHouse/pull/4654 rel="external nofollow noreferrer" target=_blank>#4654</a> (<a href=https://github.com/bgranvea rel="external nofollow noreferrer" target=_blank>Boris Granveaud</a>)</li> <li><code class=syntax>Buffer</code> 表引擎现在支持 <code class=syntax>PREWHERE</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4671 rel="external nofollow noreferrer" target=_blank>#4671</a> (<a href=https://github.com/LiuYangkuan rel="external nofollow noreferrer" target=_blank>Yangkuan Liu</a>)</li> <li>添加在 <code class=syntax>readonly</code> 模式下在zookeeper中启动没有元数据的复制表的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/4691 rel="external nofollow noreferrer" target=_blank>#4691</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 clickhouse-client 中进度条的闪烁. 将 <code class=syntax>FORMAT Null</code> 与流查询一起使用时, 该问题最为明显. <a href=https://github.com/ClickHouse/ClickHouse/pull/4811 rel="external nofollow noreferrer" target=_blank>#4811</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>允许在每个用户的基础上禁用带有 <code class=syntax>hyperscan</code> 库的功能, 以限制可能过度和不受控制的资源使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/4816 rel="external nofollow noreferrer" target=_blank>#4816</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加版本号记录所有错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4824 rel="external nofollow noreferrer" target=_blank>#4824</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>向 <code class=syntax>multiMatch</code> 函数添加了限制, 该限制要求字符串大小适合 <code class=syntax>unsigned int</code>。 还为 <code class=syntax>multiSearch</code> 函数添加了参数数量限制. <a href=https://github.com/ClickHouse/ClickHouse/pull/4834 rel="external nofollow noreferrer" target=_blank>#4834</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>改进了 Hyperscan 中暂存空间的使用和错误处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/4866 rel="external nofollow noreferrer" target=_blank>#4866</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>从 <code class=syntax>*GraphiteMergeTree</code> 引擎表的表配置中填充 <code class=syntax>system.graphite_detentions</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4584 rel="external nofollow noreferrer" target=_blank>#4584</a> (<a href=https://github.com/Felixoid rel="external nofollow noreferrer" target=_blank>Mikhail f. Shiryaev</a>)</li> <li>将 <code class=syntax>trigramDistance</code> 函数重命名为 <code class=syntax>ngramDistance</code> 并添加更多带有 <code class=syntax>CaseInsensitive</code> 和 <code class=syntax>UTF</code> 的函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/4602 rel="external nofollow noreferrer" target=_blank>#4602</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>改进的数据跳跃指数计算. <a href=https://github.com/ClickHouse/ClickHouse/pull/4640 rel="external nofollow noreferrer" target=_blank>#4640</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>将普通、<code class=syntax>DEFAULT</code>、<code class=syntax>MATERIALIZED</code> 和<code class=syntax>ALIAS</code> 列保留在一个列表中 (修复问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/2867 rel="external nofollow noreferrer" target=_blank>#2867</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4707 rel="external nofollow noreferrer" target=_blank>#4707</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> </ul> <h4 id=bug-fix-26>Bug 修复<a class=headerlink href=../amp/#bug-fix-26 title="Permanent link"> </a></h4> <ul> <li>在内存分配失败的情况下避免使用 <code class=syntax>std::terminate</code>. 现在按预期抛出 <code class=syntax>std::bad_alloc</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/4665 rel="external nofollow noreferrer" target=_blank>#4665</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了从缓冲区读取 capnproto 的问题. 有时文件未通过 HTTP 成功加载. <a href=https://github.com/ClickHouse/ClickHouse/pull/4674 rel="external nofollow noreferrer" target=_blank>#4674</a> (<a href=https://github.com/smirnov-vs rel="external nofollow noreferrer" target=_blank>Vladislav</a>)</li> <li>在 <code class=syntax>OPTIMIZE TABLE FINAL</code> 查询后修复错误 <code class=syntax>Unknown log entry type: 0</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/4683 rel="external nofollow noreferrer" target=_blank>#4683</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li><code class=syntax>hasAny</code> 或 <code class=syntax>hasAll</code> 函数的错误参数可能会导致段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4698 rel="external nofollow noreferrer" target=_blank>#4698</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>执行 <code class=syntax>DROP DATABASE dictionary</code> 查询时可能发生死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/4701 rel="external nofollow noreferrer" target=_blank>#4701</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>median</code> 和 <code class=syntax>quantile</code> 函数中未定义的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/4702 rel="external nofollow noreferrer" target=_blank>#4702</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>修复 <code class=syntax>network_compression_method</code> 为小写时的压缩级别检测. 在 v19.1 中损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/4706 rel="external nofollow noreferrer" target=_blank>#4706</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复了对 <code class=syntax>&lt;timezone&gt;UTC&lt;/timezone&gt;</code> 设置的无知 (修复了问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/4658 rel="external nofollow noreferrer" target=_blank>#4658</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4718 rel="external nofollow noreferrer" target=_blank>#4718</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>使用 <code class=syntax>Distributed</code> 表修复 <code class=syntax>histogram</code> 函数行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/4741 rel="external nofollow noreferrer" target=_blank>#4741</a> (<a href=https://github.com/olegkv rel="external nofollow noreferrer" target=_blank>olegkv</a>)</li> <li>修复了 tsan 报告 <code class=syntax>destroy of a locked mutex</code> 的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4742 rel="external nofollow noreferrer" target=_blank>#4742</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了由于系统日志使用中的竞争条件而导致关闭的 TSan 报告。 修复了启用 part_log 时关闭时潜在的释放后使用问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4758 rel="external nofollow noreferrer" target=_blank>#4758</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>ReplicatedMergeTreeAlterThread</code> 中的重新检查部分以防出错. <a href=https://github.com/ClickHouse/ClickHouse/pull/4772 rel="external nofollow noreferrer" target=_blank>#4772</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>中间聚合函数状态的算术运算不适用于常量参数 (例如子查询结果). <a href=https://github.com/ClickHouse/ClickHouse/pull/4776 rel="external nofollow noreferrer" target=_blank>#4776</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>始终在元数据中反引用列名称. 否则不可能创建一个名为<code class=syntax>index</code>的列的表 (由于元数据中的<code class=syntax>ATTACH</code>查询格式错误, 服务器不会重启). <a href=https://github.com/ClickHouse/ClickHouse/pull/4782 rel="external nofollow noreferrer" target=_blank>#4782</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>Distributed</code> 表上的 <code class=syntax>ALTER ... MODIFY ORDER BY</code> 崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/4790 rel="external nofollow noreferrer" target=_blank>#4790</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>)</li> <li>使用启用的 <code class=syntax>enable_optimize_predicate_expression</code> 修复 <code class=syntax>JOIN ON</code> 中的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4794 rel="external nofollow noreferrer" target=_blank>#4794</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>使用来自 Kafka 的 protobuf 消息后通过添加无关行来修复错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4808 rel="external nofollow noreferrer" target=_blank>#4808</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复 <code class=syntax>JOIN</code> 在不可为空与可为空列上的崩溃. 修复 <code class=syntax>ANY JOIN</code> + <code class=syntax>join_use_nulls</code> 中右键中的 <code class=syntax>NULLs</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4815 rel="external nofollow noreferrer" target=_blank>#4815</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复 <code class=syntax>clickhouse-copier</code> 中的分段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4835 rel="external nofollow noreferrer" target=_blank>#4835</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>如果表被重命名或同时更改, 则修复了来自 <code class=syntax>system.tables</code> 的 <code class=syntax>SELECT</code> 中的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/4836 rel="external nofollow noreferrer" target=_blank>#4836</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在获取已经过时的数据部分时修复了数据竞争. <a href=https://github.com/ClickHouse/ClickHouse/pull/4839 rel="external nofollow noreferrer" target=_blank>#4839</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 MergeTree 系列的 <code class=syntax>RENAME</code> 表中可能发生的罕见数据竞争. <a href=https://github.com/ClickHouse/ClickHouse/pull/4844 rel="external nofollow noreferrer" target=_blank>#4844</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了函数 <code class=syntax>arrayIntersect</code> 中的分段错误. 如果使用混合常量和普通参数调用函数, 可能会发生分段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4847 rel="external nofollow noreferrer" target=_blank>#4847</a> (<a href=https://github.com/fancyqlx rel="external nofollow noreferrer" target=_blank>Lixiang Qian</a>)</li> <li>当列包含一长串空数组时, 修复了在极少数情况下从 <code class=syntax>Array(LowCardinality)</code> 列读取的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4850 rel="external nofollow noreferrer" target=_blank>#4850</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>当我们加入可空与不可空时，, 修复 <code class=syntax>FULL/RIGHT JOIN</code> 中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/4855 rel="external nofollow noreferrer" target=_blank>#4855</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>在副本之间获取部分时修复 <code class=syntax>No message received</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/4856 rel="external nofollow noreferrer" target=_blank>#4856</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了在单个数组中有多个重复值的情况下<code class=syntax>arrayIntersect</code>函数错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/4871 rel="external nofollow noreferrer" target=_blank>#4871</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复并发 <code class=syntax>ALTER COLUMN</code> 查询期间可能导致服务器崩溃的竞争条件 (修复问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/3421 rel="external nofollow noreferrer" target=_blank>#3421</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4592 rel="external nofollow noreferrer" target=_blank>#4592</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>使用 const 列修复 <code class=syntax>FULL/RIGHT JOIN</code> 中的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/4723 rel="external nofollow noreferrer" target=_blank>#4723</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>用星号修复 <code class=syntax>GLOBAL JOIN</code> 中的重复项. <a href=https://github.com/ClickHouse/ClickHouse/pull/4705 rel="external nofollow noreferrer" target=_blank>#4705</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复未指定列类型时列 <code class=syntax>CODEC</code> 的 <code class=syntax>ALTER MODIFY</code> 中的参数推导. <a href=https://github.com/ClickHouse/ClickHouse/pull/4883 rel="external nofollow noreferrer" target=_blank>#4883</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>函数 <code class=syntax>cutQueryStringAndFragment()</code> 和 <code class=syntax>queryStringAndFragment()</code> 现在可以在 <code class=syntax>URL</code> 包含片段且没有查询时正常工作. <a href=https://github.com/ClickHouse/ClickHouse/pull/4894 rel="external nofollow noreferrer" target=_blank>#4894</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复了设置 <code class=syntax>min_bytes_to_use_direct_io</code> 大于零时的罕见错误，当线程必须在列文件中向后寻找时会发生这种情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/4897 rel="external nofollow noreferrer" target=_blank>#4897</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>用 <code class=syntax>LowCardinality</code> 参数修复聚合函数的错误参数类型 (修复问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/4919 rel="external nofollow noreferrer" target=_blank>#4919</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4922 rel="external nofollow noreferrer" target=_blank>#4922</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复<code class=syntax>GLOBAL JOIN</code>中的错误名称限定. <a href=https://github.com/ClickHouse/ClickHouse/pull/4969 rel="external nofollow noreferrer" target=_blank>#4969</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修正函数 <code class=syntax>toISOWeek</code> 结果为1970年. <a href=https://github.com/ClickHouse/ClickHouse/pull/4988 rel="external nofollow noreferrer" target=_blank>#4988</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>DROP</code>、<code class=syntax>TRUNCATE</code> 和 <code class=syntax>OPTIMIZE</code> 查询重复, 当在 <code class=syntax>ON CLUSTER</code> 上为 <code class=syntax>ReplicatedMergeTree*</code> 表族执行时. <a href=https://github.com/ClickHouse/ClickHouse/pull/4991 rel="external nofollow noreferrer" target=_blank>#4991</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> </ul> <h4 id=backward-incompatible-change-8>向后不兼容更新<a class=headerlink href=../amp/#backward-incompatible-change-8 title="Permanent link"> </a></h4> <ul> <li>将设置 <code class=syntax>insert_sample_with_metadata</code> 重命名为设置 <code class=syntax>input_format_defaults_for_omited_fields</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4771 rel="external nofollow noreferrer" target=_blank>#4771</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>添加了设置 <code class=syntax>max_partitions_per_insert_block</code> (默认值为 100). 如果插入的块包含更多的分区, 则抛出异常. 如果要取消限制, 请将其设置为 0 (不推荐). <a href=https://github.com/ClickHouse/ClickHouse/pull/4845 rel="external nofollow noreferrer" target=_blank>#4845</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>多重搜索功能被重命名 (<code class=syntax>multiPosition</code> 到 <code class=syntax>multiSearchAllPositions</code>, <code class=syntax>multiSearch</code> 到 <code class=syntax>multiSearchAny</code>, <code class=syntax>firstMatch</code> 到 <code class=syntax>multiSearchFirstIndex</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4780 rel="external nofollow noreferrer" target=_blank>#4780</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> </ul> <h4 id=performance-improvement-6>性能改进<a class=headerlink href=../amp/#performance-improvement-6 title="Permanent link"> </a></h4> <ul> <li>通过内联优化 Volnitsky 搜索器, 为具有许多针或许多相似二元组的查询提供大约 5-10% 的搜索改进. <a href=https://github.com/ClickHouse/ClickHouse/pull/4862 rel="external nofollow noreferrer" target=_blank>#4862</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>修复了当设置 <code class=syntax>use_uncompressed_cache</code> 大于零时的性能问题, 当所有读取包含在缓存中的数据时出现 <a href=https://github.com/ClickHouse/ClickHouse/pull/4913 rel="external nofollow noreferrer" target=_blank>#4913</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-10>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-10 title="Permanent link"> </a></h4> <ul> <li>强化调试构建: 更细粒度的内存映射和 ASLR; 为标记缓存和索引添加内存保护. 这允许在 ASan 和 MSan 无法执行的情况下找到更多内存踩踏错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4632 rel="external nofollow noreferrer" target=_blank>#4632</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加对 cmake 变量 <code class=syntax>ENABLE_PROTOBUF</code>、<code class=syntax>ENABLE_PARQUET</code> 和<code class=syntax>ENABLE_BROTLI</code> 的支持, 允许启用/禁用上述功能 (与我们对 librdkafka、mysql 等所做的一样). <a href=https://github.com/ClickHouse/ClickHouse/pull/4669 rel="external nofollow noreferrer" target=_blank>#4669</a> (<a href=https://github.com/silviucpp rel="external nofollow noreferrer" target=_blank>Silviu Caragea</a>)</li> <li>如果在测试运行后挂起某些查询, 则添加打印所有线程的进程列表和堆栈跟踪的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/4675 rel="external nofollow noreferrer" target=_blank>#4675</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>在 <code class=syntax>clickhouse-test</code> 中添加对 <code class=syntax>Connection loss</code> 错误的重试. <a href=https://github.com/ClickHouse/ClickHouse/pull/4682 rel="external nofollow noreferrer" target=_blank>#4682</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>使用 vagrant 添加 freebsd 构建并使用线程清理器构建打包脚本. <a href=https://github.com/ClickHouse/ClickHouse/pull/4712 rel="external nofollow noreferrer" target=_blank>#4712</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4748 rel="external nofollow noreferrer" target=_blank>#4748</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>现在用户在安装过程中要求用户 <code class=syntax>default</code> 的密码. <a href=https://github.com/ClickHouse/ClickHouse/pull/4725 rel="external nofollow noreferrer" target=_blank>#4725</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>抑制 <code class=syntax>rdkafka</code> 库中的警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/4740 rel="external nofollow noreferrer" target=_blank>#4740</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>允许在没有 ssl 的情况下构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/4750 rel="external nofollow noreferrer" target=_blank>#4750</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>添加一种从自定义用户启动 clickhouse-server 图像的方法. <a href=https://github.com/ClickHouse/ClickHouse/pull/4753 rel="external nofollow noreferrer" target=_blank>#4753</a> (<a href=https://github.com/Felixoid rel="external nofollow noreferrer" target=_blank>Mikhail f. Shiryaev</a>)</li> <li>将 contrib 升级到 1.69. <a href=https://github.com/ClickHouse/ClickHouse/pull/4793 rel="external nofollow noreferrer" target=_blank>#4793</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>使用 Thread Sanitizer 编译时禁用 <code class=syntax>mremap</code>. 令人惊讶的是, TSan 没有拦截导致误报的 <code class=syntax>mremap</code> (尽管它确实拦截了 <code class=syntax>mmap</code>、<code class=syntax>munmap</code>). 修复了状态测试中的 TSan 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/4859 rel="external nofollow noreferrer" target=_blank>#4859</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>通过 HTTP 接口使用格式模式添加测试检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/4864 rel="external nofollow noreferrer" target=_blank>#4864</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> </ul> <h2 id=clickhouse-release-19-4>ClickHouse 版本 19.4<a class=headerlink href=../amp/#clickhouse-release-19-4 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-4-4-33-2019-04-17>ClickHouse 版本 19.4.4.33, 2019-04-17<a class=headerlink href=../amp/#clickhouse-release-19-4-4-33-2019-04-17 title="Permanent link"> </a></h3> <h4 id=bug-fixes-7>Bug 修复<a class=headerlink href=../amp/#bug-fixes-7 title="Permanent link"> </a></h4> <ul> <li>在内存分配失败的情况下避免使用 <code class=syntax>std::terminate</code>。 现在按预期抛出 <code class=syntax>std::bad_alloc</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/4665 rel="external nofollow noreferrer" target=_blank>#4665</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了从缓冲区读取 capnproto 的问题. 有时文件未通过 HTTP 成功加载. <a href=https://github.com/ClickHouse/ClickHouse/pull/4674 rel="external nofollow noreferrer" target=_blank>#4674</a> (<a href=https://github.com/smirnov-vs rel="external nofollow noreferrer" target=_blank>Vladislav</a>)</li> <li>在 <code class=syntax>OPTIMIZE TABLE FINAL</code> 查询后修复错误 <code class=syntax>Unknown log entry type: 0</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/4683 rel="external nofollow noreferrer" target=_blank>#4683</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li><code class=syntax>hasAny</code> 或 <code class=syntax>hasAll</code> 函数的错误参数可能会导致段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4698 rel="external nofollow noreferrer" target=_blank>#4698</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>执行 <code class=syntax>DROP DATABASE dictionary</code> 查询时可能发生死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/4701 rel="external nofollow noreferrer" target=_blank>#4701</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>median</code> 和 <code class=syntax>quantile</code> 函数中未定义的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/4702 rel="external nofollow noreferrer" target=_blank>#4702</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>修复 <code class=syntax>network_compression_method</code> 为小写时的压缩级别检测. 在 v19.1 中损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/4706 rel="external nofollow noreferrer" target=_blank>#4706</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复了对 <code class=syntax>&lt;timezone&gt;UTC&lt;/timezone&gt;</code> 设置的无知 (修复了问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/4658 rel="external nofollow noreferrer" target=_blank>#4658</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4718 rel="external nofollow noreferrer" target=_blank>#4718</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>使用 <code class=syntax>Distributed</code> 表修复 <code class=syntax>histogram</code> 函数行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/4741 rel="external nofollow noreferrer" target=_blank>#4741</a> (<a href=https://github.com/olegkv rel="external nofollow noreferrer" target=_blank>olegkv</a>)</li> <li>修复了 tsan 报告 <code class=syntax>destroy of a locked mutex</code> 的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4742 rel="external nofollow noreferrer" target=_blank>#4742</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了由于系统日志使用中的竞争条件而导致关闭的 TSan 报告. 修复了启用 part_log 时关闭时潜在的释放后使用问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4758 rel="external nofollow noreferrer" target=_blank>#4758</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>ReplicatedMergeTreeAlterThread</code> 中的重新检查部分以防出错. <a href=https://github.com/ClickHouse/ClickHouse/pull/4772 rel="external nofollow noreferrer" target=_blank>#4772</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>中间聚合函数状态的算术运算不适用于常量参数 (例如子查询结果). <a href=https://github.com/ClickHouse/ClickHouse/pull/4776 rel="external nofollow noreferrer" target=_blank>#4776</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>始终在元数据中反引用列名称. 否则不可能创建一个名为 <code class=syntax>index</code> 的列的表 (由于元数据中的<code class=syntax>ATTACH</code>查询格式错误, 服务器不会重启). <a href=https://github.com/ClickHouse/ClickHouse/pull/4782 rel="external nofollow noreferrer" target=_blank>#4782</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>Distributed</code> 表上的 <code class=syntax>ALTER ... MODIFY ORDER BY</code> 崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/4790 rel="external nofollow noreferrer" target=_blank>#4790</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>)</li> <li>修复了启用 <code class=syntax>enable_optimize_predicate_expression</code> 的 <code class=syntax>JOIN ON</code> 中段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4794 rel="external nofollow noreferrer" target=_blank>#4794</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>使用来自 Kafka 的 protobuf 消息后通过添加无关行来修复错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4808 rel="external nofollow noreferrer" target=_blank>#4808</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复 <code class=syntax>clickhouse-copier</code> 中的分段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4835 rel="external nofollow noreferrer" target=_blank>#4835</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>如果表被重命名或同时更改, 则修复了来自 <code class=syntax>system.tables</code> 的 <code class=syntax>SELECT</code> 中的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/4836 rel="external nofollow noreferrer" target=_blank>#4836</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在获取已经过时的数据部分时修复了数据竞争. <a href=https://github.com/ClickHouse/ClickHouse/pull/4839 rel="external nofollow noreferrer" target=_blank>#4839</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 MergeTree 系列的 <code class=syntax>RENAME</code> 表中可能发生的罕见数据竞争. <a href=https://github.com/ClickHouse/ClickHouse/pull/4844 rel="external nofollow noreferrer" target=_blank>#4844</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了函数 <code class=syntax>arrayIntersect</code> 中的分段错误. Segmentation fault could happen if function was called with mixed constant and ordinary arguments. <a href=https://github.com/ClickHouse/ClickHouse/pull/4847 rel="external nofollow noreferrer" target=_blank>#4847</a> (<a href=https://github.com/fancyqlx rel="external nofollow noreferrer" target=_blank>Lixiang Qian</a>)</li> <li>当列包含一长串空数组时, 修复了在极少数情况下从 <code class=syntax>Array(LowCardinality)</code> 列读取的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4850 rel="external nofollow noreferrer" target=_blank>#4850</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>在副本之间获取部分时修复 <code class=syntax>No message received</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/4856 rel="external nofollow noreferrer" target=_blank>#4856</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了在单个数组中有多个重复值的情况下<code class=syntax>arrayIntersect</code>函数错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/4871 rel="external nofollow noreferrer" target=_blank>#4871</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复并发 <code class=syntax>ALTER COLUMN</code> 查询期间可能导致服务器崩溃的竞争条件 (修复问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/3421 rel="external nofollow noreferrer" target=_blank>#3421</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4592 rel="external nofollow noreferrer" target=_blank>#4592</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>修复未指定列类型时列 <code class=syntax>CODEC</code> 的 <code class=syntax>ALTER MODIFY</code> 中的参数推导. <a href=https://github.com/ClickHouse/ClickHouse/pull/4883 rel="external nofollow noreferrer" target=_blank>#4883</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>函数 <code class=syntax>cutQueryStringAndFragment()</code> 和 <code class=syntax>queryStringAndFragment()</code> 现在可以在 <code class=syntax>URL</code> 包含片段且没有查询时正常工作. <a href=https://github.com/ClickHouse/ClickHouse/pull/4894 rel="external nofollow noreferrer" target=_blank>#4894</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复了设置 <code class=syntax>min_bytes_to_use_direct_io</code> 大于零时的罕见错误，当线程必须在列文件中向后寻找时会发生这种情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/4897 rel="external nofollow noreferrer" target=_blank>#4897</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>使用 <code class=syntax>LowCardinality</code> 参数修复聚合函数的错误参数类型 (修复问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/4919 rel="external nofollow noreferrer" target=_blank>#4919</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4922 rel="external nofollow noreferrer" target=_blank>#4922</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修正函数 <code class=syntax>toISOWeek</code> 结果为1970年. <a href=https://github.com/ClickHouse/ClickHouse/pull/4988 rel="external nofollow noreferrer" target=_blank>#4988</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>DROP</code>、<code class=syntax>TRUNCATE</code> 和 <code class=syntax>OPTIMIZE</code> 查询重复，当在 <code class=syntax>ON CLUSTER</code> 上为 <code class=syntax>ReplicatedMergeTree*</code> 表族执行时. <a href=https://github.com/ClickHouse/ClickHouse/pull/4991 rel="external nofollow noreferrer" target=_blank>#4991</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> </ul> <h4 id=improvements-2>改进<a class=headerlink href=../amp/#improvements-2 title="Permanent link"> </a></h4> <ul> <li>将普通、<code class=syntax>DEFAULT</code>、<code class=syntax>MATERIALIZED</code> 和<code class=syntax>ALIAS</code> 列保留在一个列表中 (修复问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/2867 rel="external nofollow noreferrer" target=_blank>#2867</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4707 rel="external nofollow noreferrer" target=_blank>#4707</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> </ul> <h3 id=clickhouse-release-19-4-3-11-2019-04-02>ClickHouse 版本 19.4.3.11, 2019-04-02<a class=headerlink href=../amp/#clickhouse-release-19-4-3-11-2019-04-02 title="Permanent link"> </a></h3> <h4 id=bug-fixes-8>Bug 修复<a class=headerlink href=../amp/#bug-fixes-8 title="Permanent link"> </a></h4> <ul> <li>当我们加入可空与不可空时, 修复 <code class=syntax>FULL/RIGHT JOIN</code> 中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/4855 rel="external nofollow noreferrer" target=_blank>#4855</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复 <code class=syntax>clickhouse-copier</code> 中的分段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4835 rel="external nofollow noreferrer" target=_blank>#4835</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-11>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-11 title="Permanent link"> </a></h4> <ul> <li>Add a way to launch clickhouse-server image from a custom user. <a href=https://github.com/ClickHouse/ClickHouse/pull/4753 rel="external nofollow noreferrer" target=_blank>#4753</a> (<a href=https://github.com/Felixoid rel="external nofollow noreferrer" target=_blank>Mikhail f. Shiryaev</a>)</li> </ul> <h3 id=clickhouse-release-19-4-2-7-2019-03-30>ClickHouse 版本 19.4.2.7, 2019-03-30<a class=headerlink href=../amp/#clickhouse-release-19-4-2-7-2019-03-30 title="Permanent link"> </a></h3> <h4 id=bug-fixes-9>Bug 修复<a class=headerlink href=../amp/#bug-fixes-9 title="Permanent link"> </a></h4> <ul> <li>当列包含一长串空数组时, 修复了在极少数情况下从 <code class=syntax>Array(LowCardinality)</code> 列读取的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4850 rel="external nofollow noreferrer" target=_blank>#4850</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> </ul> <h3 id=clickhouse-release-19-4-1-3-2019-03-19>ClickHouse 版本 19.4.1.3, 2019-03-19<a class=headerlink href=../amp/#clickhouse-release-19-4-1-3-2019-03-19 title="Permanent link"> </a></h3> <h4 id=bug-fixes-10>Bug 修复<a class=headerlink href=../amp/#bug-fixes-10 title="Permanent link"> </a></h4> <ul> <li>修复了同时包含<code class=syntax>LIMIT BY</code> 和<code class=syntax>LIMIT</code> 的远程查询. 以前, 如果使用 <code class=syntax>LIMIT BY</code> 和 <code class=syntax>LIMIT</code> 进行远程查询, <code class=syntax>LIMIT</code>可能发生在<code class=syntax>LIMIT BY</code>之前, 导致过滤结果过分. <a href=https://github.com/ClickHouse/ClickHouse/pull/4708 rel="external nofollow noreferrer" target=_blank>#4708</a> (<a href=https://github.com/kvap rel="external nofollow noreferrer" target=_blank>Constantin S. Pan</a>)</li> </ul> <h3 id=clickhouse-release-19-4-0-49-2019-03-09>ClickHouse 版本 19.4.0.49, 2019-03-09<a class=headerlink href=../amp/#clickhouse-release-19-4-0-49-2019-03-09 title="Permanent link"> </a></h3> <h4 id=new-features-5>新特征<a class=headerlink href=../amp/#new-features-5 title="Permanent link"> </a></h4> <ul> <li>添加了对 <code class=syntax>Protobuf</code> 格式的完全支持 (输入和输出, 嵌套数据结构). <a href=https://github.com/ClickHouse/ClickHouse/pull/4174 rel="external nofollow noreferrer" target=_blank>#4174</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4493 rel="external nofollow noreferrer" target=_blank>#4493</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>使用 Roaring Bitmaps 添加位图功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/4207 rel="external nofollow noreferrer" target=_blank>#4207</a> (<a href=https://github.com/andyyzh rel="external nofollow noreferrer" target=_blank>Andy Yang</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/4568 rel="external nofollow noreferrer" target=_blank>#4568</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>Parquet 格式支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/4448 rel="external nofollow noreferrer" target=_blank>#4448</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>添加了 N-gram 距离以进行模糊字符串比较. 它类似于 R 语言中的 q-gram 度量. <a href=https://github.com/ClickHouse/ClickHouse/pull/4466 rel="external nofollow noreferrer" target=_blank>#4466</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>从专用的聚合和保留模式中组合石墨聚合规则. <a href=https://github.com/ClickHouse/ClickHouse/pull/4426 rel="external nofollow noreferrer" target=_blank>#4426</a> (<a href=https://github.com/Felixoid rel="external nofollow noreferrer" target=_blank>Mikhail f. Shiryaev</a>)</li> <li>添加了 <code class=syntax>max_execution_speed</code> 和 <code class=syntax>max_execution_speed_bytes</code> 以限制资源使用. 添加了<code class=syntax>min_execution_speed_bytes</code>设置以补充<code class=syntax>min_execution_speed</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4430 rel="external nofollow noreferrer" target=_blank>#4430</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>实现的函数<code class=syntax>flatten</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4555 rel="external nofollow noreferrer" target=_blank>#4555</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4409 rel="external nofollow noreferrer" target=_blank>#4409</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>, <a href=https://github.com/kzon rel="external nofollow noreferrer" target=_blank>kzon</a>)</li> <li>添加了函数 <code class=syntax>arrayEnumerateDenseRanked</code> 和 <code class=syntax>arrayEnumerateUniqRanked</code> (类似于 <code class=syntax>arrayEnumerateUniq</code>, 但允许微调数组深度以查看多维数组内部). <a href=https://github.com/ClickHouse/ClickHouse/pull/4475 rel="external nofollow noreferrer" target=_blank>#4475</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/4601 rel="external nofollow noreferrer" target=_blank>#4601</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>有一些限制的多个 JOINS: 没有星号, 在 ON/WHERE/GROUP BY/... 中没有复杂的别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/4462 rel="external nofollow noreferrer" target=_blank>#4462</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=bug-fixes-11>Bug 修复<a class=headerlink href=../amp/#bug-fixes-11 title="Permanent link"> </a></h4> <ul> <li>此版本还包含 19.3 和 19.1 的所有错误修复.</li> <li>修复了数据跳过索引中的错误: INSERT 后的颗粒顺序不正确. <a href=https://github.com/ClickHouse/ClickHouse/pull/4407 rel="external nofollow noreferrer" target=_blank>#4407</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>修复了 <code class=syntax>Nullable</code> 和 <code class=syntax>LowCardinality</code> 列的 <code class=syntax>set</code> 索引. 在此之前, 带有 <code class=syntax>Nullable</code> 或 <code class=syntax>LowCardinality</code> 列的 <code class=syntax>set</code> 索引在选择时导致错误 <code class=syntax>Data type must be deserialized with multiple streams</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/4594 rel="external nofollow noreferrer" target=_blank>#4594</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>在完整的 <code class=syntax>executable</code> 字典更新时正确设置 update_time. <a href=https://github.com/ClickHouse/ClickHouse/pull/4551 rel="external nofollow noreferrer" target=_blank>#4551</a> (<a href=https://github.com/temoon rel="external nofollow noreferrer" target=_blank>Tema Novikov</a>)</li> <li>修复 19.3 中损坏的进度条. <a href=https://github.com/ClickHouse/ClickHouse/pull/4627 rel="external nofollow noreferrer" target=_blank>#4627</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复了在某些情况下内存区域缩小时 MemoryTracker 不一致的值. <a href=https://github.com/ClickHouse/ClickHouse/pull/4619 rel="external nofollow noreferrer" target=_blank>#4619</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 ThreadPool 中未定义的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/4612 rel="external nofollow noreferrer" target=_blank>#4612</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了一个非常罕见的崩溃, 消息 <code class=syntax>mutex lock failed: Invalid argument</code> 可能发生在 MergeTree 表与 SELECT 同时删除时. <a href=https://github.com/ClickHouse/ClickHouse/pull/4608 rel="external nofollow noreferrer" target=_blank>#4608</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>ODBC 驱动程序与 <code class=syntax>LowCardinality</code> 数据类型兼容. <a href=https://github.com/ClickHouse/ClickHouse/pull/4381 rel="external nofollow noreferrer" target=_blank>#4381</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>FreeBSD: <code class=syntax>AIOcontextPool: Found io_event with unknown id 0</code> 错误的修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/4438 rel="external nofollow noreferrer" target=_blank>#4438</a> (<a href=https://github.com/urgordeadbeef rel="external nofollow noreferrer" target=_blank>urgordeadbeef</a>)</li> <li><code class=syntax>system.part_log</code> 表的创建与配置无关. <a href=https://github.com/ClickHouse/ClickHouse/pull/4483 rel="external nofollow noreferrer" target=_blank>#4483</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>复缓存字典的 <code class=syntax>dictIsIn</code> 函数中未定义的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/4515 rel="external nofollow noreferrer" target=_blank>#4515</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了当 SELECT 查询多次锁定同一个表 (例如来自不同线程或执行多个子查询时) 并且存在并发 DDL 查询时的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/4535 rel="external nofollow noreferrer" target=_blank>#4535</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>默认情况下禁用 compile_expressions 直到我们获得自己的 <code class=syntax>llvm</code> contrib 并且可以使用 <code class=syntax>clang</code> 和 <code class=syntax>asan</code> 对其进行测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/4579 rel="external nofollow noreferrer" target=_blank>#4579</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li><code class=syntax>clickhouse</code> 外部字典源的 <code class=syntax>invalidate_query</code> 返回错误的结果集 (空或多于一行或多于一列) 时, 防止 <code class=syntax>std::terminate</code>. 修复了每五秒执行一次 <code class=syntax>invalidate_query</code> 的问题, 而不管 <code class=syntax>lifetime</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4583 rel="external nofollow noreferrer" target=_blank>#4583</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>当具有 <code class=syntax>clickhouse</code> 源的字典的 <code class=syntax>invalidate_query</code> 涉及 <code class=syntax>system.dictionaries</code> 表或 <code class=syntax>Dictionaries</code> 数据库时, 避免死锁 (罕见情况). <a href=https://github.com/ClickHouse/ClickHouse/pull/4599 rel="external nofollow noreferrer" target=_blank>#4599</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 WHERE 为空的 CROSS JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/4598 rel="external nofollow noreferrer" target=_blank>#4598</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了传递常量参数时函数 <code class=syntax>replicate</code> 中的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4603 rel="external nofollow noreferrer" target=_blank>#4603</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用谓词优化器修复 lambda 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/4408 rel="external nofollow noreferrer" target=_blank>#4408</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>多个连接多个修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/4595 rel="external nofollow noreferrer" target=_blank>#4595</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=improvements-3>改进<a class=headerlink href=../amp/#improvements-3 title="Permanent link"> </a></h4> <ul> <li>支持右表列的 JOIN ON 部分中的别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/4412 rel="external nofollow noreferrer" target=_blank>#4412</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>多个 JOIN 的结果需要在子选择中使用正确的结果名称. 在结果中用源名称替换平面别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/4474 rel="external nofollow noreferrer" target=_blank>#4474</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>改进连接语句的下推逻辑. <a href=https://github.com/ClickHouse/ClickHouse/pull/4387 rel="external nofollow noreferrer" target=_blank>#4387</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> </ul> <h4 id=performance-improvements-3>性能改进<a class=headerlink href=../amp/#performance-improvements-3 title="Permanent link"> </a></h4> <ul> <li>改进了 <code class=syntax>move to PREWHERE</code> 优化的启发式方法. <a href=https://github.com/ClickHouse/ClickHouse/pull/4405 rel="external nofollow noreferrer" target=_blank>#4405</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用适当的查找表, 使用 HashTable 的 API 获取 8 位和 16 位密钥. <a href=https://github.com/ClickHouse/ClickHouse/pull/4536 rel="external nofollow noreferrer" target=_blank>#4536</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>改进了字符串比较的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/4564 rel="external nofollow noreferrer" target=_blank>#4564</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在单独的线程中清理分布式 DDL 队列, 使其不会减慢处理分布式 DDL 任务的主循环. <a href=https://github.com/ClickHouse/ClickHouse/pull/4502 rel="external nofollow noreferrer" target=_blank>#4502</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>当 <code class=syntax>min_bytes_to_use_direct_io</code> 设置为 1 时, 并不是每个文件都以 O_DIRECT 模式打开, 因为读取的数据大小有时会被一个压缩块的大小低估. <a href=https://github.com/ClickHouse/ClickHouse/pull/4526 rel="external nofollow noreferrer" target=_blank>#4526</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-12>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-12 title="Permanent link"> </a></h4> <ul> <li>添加了对 clang-9 的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/4604 rel="external nofollow noreferrer" target=_blank>#4604</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复错误的 <code class=syntax>__asm__</code> 指令 (再次). <a href=https://github.com/ClickHouse/ClickHouse/pull/4621 rel="external nofollow noreferrer" target=_blank>#4621</a> (<a href=https://github.com/podshumok rel="external nofollow noreferrer" target=_blank>Konstantin Podshumok</a>)</li> <li>添加从命令行指定 <code class=syntax>clickhouse-performance-test</code> 设置的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/4437 rel="external nofollow noreferrer" target=_blank>#4437</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>将字典测试添加到集成测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/4477 rel="external nofollow noreferrer" target=_blank>#4477</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>将来自网站基准测试的查询添加到自动化性能测试中. <a href=https://github.com/ClickHouse/ClickHouse/pull/4496 rel="external nofollow noreferrer" target=_blank>#4496</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>xxhash.h</code> 在外部 lz4 中不存在, 因为它是一个实现细节, 它的符号使用 <code class=syntax>XXH_NAMESPACE</code> 宏命名. 当 lz4 是外部的时, xxHash 也必须是外部的, 并且依赖项必须链接到它. <a href=https://github.com/ClickHouse/ClickHouse/pull/4495 rel="external nofollow noreferrer" target=_blank>#4495</a> (<a href=https://github.com/orivej rel="external nofollow noreferrer" target=_blank>Orivej Desh</a>)</li> <li>修复了可以使用负数或浮点参数调用 <code class=syntax>quantileTiming</code> 聚合函数的情况 (这修复了使用未定义行为清理器的模糊测试). <a href=https://github.com/ClickHouse/ClickHouse/pull/4506 rel="external nofollow noreferrer" target=_blank>#4506</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>拼写错误更正. <a href=https://github.com/ClickHouse/ClickHouse/pull/4531 rel="external nofollow noreferrer" target=_blank>#4531</a> (<a href=https://github.com/sdk2 rel="external nofollow noreferrer" target=_blank>sdk2</a>)</li> <li>修复 Mac 上的编译. <a href=https://github.com/ClickHouse/ClickHouse/pull/4371 rel="external nofollow noreferrer" target=_blank>#4371</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>为 FreeBSD 和各种不寻常的构建配置构建修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/4444 rel="external nofollow noreferrer" target=_blank>#4444</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h2 id=clickhouse-release-19-3>ClickHouse 版本 19.3<a class=headerlink href=../amp/#clickhouse-release-19-3 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-3-9-1-2019-04-02>ClickHouse 版本 19.3.9.1, 2019-04-02<a class=headerlink href=../amp/#clickhouse-release-19-3-9-1-2019-04-02 title="Permanent link"> </a></h3> <h4 id=bug-fixes-12>Bug 修复<a class=headerlink href=../amp/#bug-fixes-12 title="Permanent link"> </a></h4> <ul> <li>当我们加入可空与不可空时, 修复 <code class=syntax>FULL/RIGHT JOIN</code> 中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/4855 rel="external nofollow noreferrer" target=_blank>#4855</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复 <code class=syntax>clickhouse-copier</code> 中的分段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4835 rel="external nofollow noreferrer" target=_blank>#4835</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>当列包含一长串空数组时, 修复了在极少数情况下从 <code class=syntax>Array(LowCardinality)</code> 列读取的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4850 rel="external nofollow noreferrer" target=_blank>#4850</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> </ul> <h4 id=buildtestingpackaging-improvement-13>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvement-13 title="Permanent link"> </a></h4> <ul> <li>添加一种从自定义用户启动 clickhouse-server 图像的方法. <a href=https://github.com/ClickHouse/ClickHouse/pull/4753 rel="external nofollow noreferrer" target=_blank>#4753</a> (<a href=https://github.com/Felixoid rel="external nofollow noreferrer" target=_blank>Mikhail f. Shiryaev</a>)</li> </ul> <h3 id=clickhouse-release-19-3-7-2019-03-12>ClickHouse 版本 19.3.7, 2019-03-12<a class=headerlink href=../amp/#clickhouse-release-19-3-7-2019-03-12 title="Permanent link"> </a></h3> <h4 id=bug-fixes-13>Bug 修复<a class=headerlink href=../amp/#bug-fixes-13 title="Permanent link"> </a></h4> <ul> <li>修复了 #3920 中的错误。 此错误表现为随机缓存损坏 (消息 <code class=syntax>Unknown codec family code</code>, <code class=syntax>Cannot seek through file</code> ) 和段错误. 此错误首先出现在 19.1 版本中, 并存在于 19.1.10 和 19.3.6 之前的版本中. <a href=https://github.com/ClickHouse/ClickHouse/pull/4623 rel="external nofollow noreferrer" target=_blank>#4623</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-3-6-2019-03-02>ClickHouse 版本 19.3.6, 2019-03-02<a class=headerlink href=../amp/#clickhouse-release-19-3-6-2019-03-02 title="Permanent link"> </a></h3> <h4 id=bug-fixes-14>Bug 修复<a class=headerlink href=../amp/#bug-fixes-14 title="Permanent link"> </a></h4> <ul> <li>当线程池中的线程超过1000个时, 线程退出可能会发生<code class=syntax>std::terminate</code>. <a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4485 rel="external nofollow noreferrer" target=_blank>#4485</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4505 rel="external nofollow noreferrer" target=_blank>#4505</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>现在可以创建带有注释的 <code class=syntax>ReplicatedMergeTree*</code> 表，没有默认值的列和带有没有注释和默认值的列编解码器的表. 还修复了编解码器的比较. <a href=https://github.com/ClickHouse/ClickHouse/pull/4523 rel="external nofollow noreferrer" target=_blank>#4523</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了使用数组或元组 JOIN 时的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/4552 rel="external nofollow noreferrer" target=_blank>#4552</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了 clickhouse-copier 崩溃并显示消息 <code class=syntax>ThreadStatus not created</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/4540 rel="external nofollow noreferrer" target=_blank>#4540</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了使用分布式ddl时服务器关闭时的挂起问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4472 rel="external nofollow noreferrer" target=_blank>#4472</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>错误消息中打印了不正确的列号, 该错误消息是对编号大于 10 的列进行文本格式解析. <a href=https://github.com/ClickHouse/ClickHouse/pull/4484 rel="external nofollow noreferrer" target=_blank>#4484</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=buildtestingpackaging-improvements-3>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvements-3 title="Permanent link"> </a></h4> <ul> <li>修复了启用 AVX 的构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/4527 rel="external nofollow noreferrer" target=_blank>#4527</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>用基于已知版本而不是编译它的内核的扩展记帐和 IO 记帐. <a href=https://github.com/ClickHouse/ClickHouse/pull/4541 rel="external nofollow noreferrer" target=_blank>#4541</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>)</li> <li>用基于已知版本而不是合成它的知识的扩展记录帐和 IO. <a href=https://github.com/ClickHouse/ClickHouse/pull/4473 rel="external nofollow noreferrer" target=_blank>#4473</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>删除了 <code class=syntax>Field.cpp</code> 中 <code class=syntax>void readBinary(...)</code> 的 <code class=syntax>inline</code> 标签. 还合并了冗余的 <code class=syntax>namespace DB</code> 块. <a href=https://github.com/ClickHouse/ClickHouse/pull/4530 rel="external nofollow noreferrer" target=_blank>#4530</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> </ul> <h3 id=clickhouse-release-19-3-5-2019-02-21>ClickHouse 版本 19.3.5, 2019-02-21<a class=headerlink href=../amp/#clickhouse-release-19-3-5-2019-02-21 title="Permanent link"> </a></h3> <h4 id=bug-fixes-15>Bug 修复<a class=headerlink href=../amp/#bug-fixes-15 title="Permanent link"> </a></h4> <ul> <li>修复了大型 http 插入查询处理的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4454 rel="external nofollow noreferrer" target=_blank>#4454</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了由于 <code class=syntax>send_logs_level</code> 设置的错误实现而导致的与旧版本的向后不兼容. <a href=https://github.com/ClickHouse/ClickHouse/pull/4445 rel="external nofollow noreferrer" target=_blank>#4445</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了使用列注释引入的表函数<code class=syntax>remote</code> 向后不兼容的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4446 rel="external nofollow noreferrer" target=_blank>#4446</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-3-4-2019-02-16>ClickHouse 版本 19.3.4, 2019-02-16<a class=headerlink href=../amp/#clickhouse-release-19-3-4-2019-02-16 title="Permanent link"> </a></h3> <h4 id=improvements-4>改进<a class=headerlink href=../amp/#improvements-4 title="Permanent link"> </a></h4> <ul> <li>当执行 <code class=syntax>ATTACH Table</code> 查询时, 表索引大小不考虑内存限制. 避免了表被分离后无法被附加的可能性. <a href=https://github.com/ClickHouse/ClickHouse/pull/4396 rel="external nofollow noreferrer" target=_blank>#4396</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>稍微提高了从 ZooKeeper 接收的最大字符串和数组大小的限制. 它允许继续使用 ZooKeeper 上增加的 <code class=syntax>CLIENT_JVMFLAGS=-Djute.maxbuffer=...</code> 大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/4398 rel="external nofollow noreferrer" target=_blank>#4398</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>允许修复废弃的副本, 即使它的队列中已经有大量节点. <a href=https://github.com/ClickHouse/ClickHouse/pull/4399 rel="external nofollow noreferrer" target=_blank>#4399</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>向<code class=syntax>SET</code>索引添加一个必需参数 (最大存储行数). <a href=https://github.com/ClickHouse/ClickHouse/pull/4386 rel="external nofollow noreferrer" target=_blank>#4386</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> </ul> <h4 id=bug-fixes-16>Bug 修复<a class=headerlink href=../amp/#bug-fixes-16 title="Permanent link"> </a></h4> <ul> <li>修复了按单个 <code class=syntax>LowCardinality</code> 键分组的 <code class=syntax>WITH ROLLUP</code> 结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/4384 rel="external nofollow noreferrer" target=_blank>#4384</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了集合索引中的错误 (如果包含超过 <code class=syntax>max_rows</code> 行，则删除一个粒度). <a href=https://github.com/ClickHouse/ClickHouse/pull/4386 rel="external nofollow noreferrer" target=_blank>#4386</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>许多 FreeBSD 构建修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/4397 rel="external nofollow noreferrer" target=_blank>#4397</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>使用包含相同别名的子查询修复了查询中的别名替换 (问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/4110 rel="external nofollow noreferrer" target=_blank>#4110</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/4351 rel="external nofollow noreferrer" target=_blank>#4351</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=buildtestingpackaging-improvements-4>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvements-4 title="Permanent link"> </a></h4> <ul> <li>添加在 docker 镜像中运行 <code class=syntax>clickhouse-server</code> 以进行无状态测试的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/4347 rel="external nofollow noreferrer" target=_blank>#4347</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> </ul> <h3 id=clickhouse-release-19-3-3-2019-02-13>ClickHouse 版本 19.3.3, 2019-02-13<a class=headerlink href=../amp/#clickhouse-release-19-3-3-2019-02-13 title="Permanent link"> </a></h3> <h4 id=new-features-6>新特征<a class=headerlink href=../amp/#new-features-6 title="Permanent link"> </a></h4> <ul> <li>添加了 <code class=syntax>KILL MUTATION</code> 语句，允许删除由于某些原因卡住的突变。 将 <code class=syntax>latest_failed_part</code>、<code class=syntax>latest_fail_time</code>、<code class=syntax>latest_fail_reason</code> 字段添加到 <code class=syntax>system.mutations</code> 表中，以便于故障排除. <a href=https://github.com/ClickHouse/ClickHouse/pull/4287 rel="external nofollow noreferrer" target=_blank>#4287</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>添加了计算信息熵的聚合函数 <code class=syntax>entropy</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/4238 rel="external nofollow noreferrer" target=_blank>#4238</a> (<a href=https://github.com/Quid37 rel="external nofollow noreferrer" target=_blank>Quid37</a>)</li> <li>添加了向服务器发送查询 <code class=syntax>INSERT INTO tbl VALUES (....)</code> 的功能, 而无需拆分 <code class=syntax>query</code> 和 <code class=syntax>data</code> 部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/4301 rel="external nofollow noreferrer" target=_blank>#4301</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加了 <code class=syntax>arrayWithConstant</code> 函数的通用实现. <a href=https://github.com/ClickHouse/ClickHouse/pull/4322 rel="external nofollow noreferrer" target=_blank>#4322</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>实现了<code class=syntax>NOT BETWEEN</code>比较运算符. <a href=https://github.com/ClickHouse/ClickHouse/pull/4228 rel="external nofollow noreferrer" target=_blank>#4228</a> (<a href=https://github.com/nezed rel="external nofollow noreferrer" target=_blank>Dmitry Naumov</a>)</li> <li>实现 <code class=syntax>sumMapFiltered</code> 以便能够限制 <code class=syntax>sumMap</code> 对其值求和的键的数量. <a href=https://github.com/ClickHouse/ClickHouse/pull/4129 rel="external nofollow noreferrer" target=_blank>#4129</a> (<a href=https://github.com/ercolanelli-leo rel="external nofollow noreferrer" target=_blank>Léo Ercolanelli</a>)</li> <li>在 <code class=syntax>mysql</code> 表函数中添加了对 <code class=syntax>Nullable</code> 类型的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/4198 rel="external nofollow noreferrer" target=_blank>#4198</a> (<a href=https://github.com/edonin rel="external nofollow noreferrer" target=_blank>Emmanuel Donin de Rosière</a>)</li> <li>支持 <code class=syntax>LIMIT</code> 子句中的任意常量表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/4246 rel="external nofollow noreferrer" target=_blank>#4246</a> (<a href=https://github.com/k3box rel="external nofollow noreferrer" target=_blank>k3box</a>)</li> <li>添加了 <code class=syntax>topKWeighted</code> 聚合函数, 该函数采用带 (无符号整数) 权重的附加参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/4245 rel="external nofollow noreferrer" target=_blank>#4245</a> (<a href=https://github.com/andrewgolman rel="external nofollow noreferrer" target=_blank>Andrew Golman</a>)</li> <li><code class=syntax>StorageJoin</code> 现在支持 <code class=syntax>join_any_take_last_row</code> 设置, 允许覆盖相同键的现有值. <a href=https://github.com/ClickHouse/ClickHouse/pull/3973 rel="external nofollow noreferrer" target=_blank>#3973</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a></li> <li>添加函数 <code class=syntax>toStartOfInterval</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/4304 rel="external nofollow noreferrer" target=_blank>#4304</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>添加了 <code class=syntax>RowBinaryWithNamesAndTypes</code> 格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/4200 rel="external nofollow noreferrer" target=_blank>#4200</a> (<a href=https://github.com/DarkWanderer rel="external nofollow noreferrer" target=_blank>Oleg V. Kozlyuk</a>)</li> <li>添加了 <code class=syntax>IPv4</code> 和 <code class=syntax>IPv6</code> 数据类型. 更有效地实现 <code class=syntax>IPv*</code> 功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/3669 rel="external nofollow noreferrer" target=_blank>#3669</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>添加函数 <code class=syntax>toStartOfTenMinutes()</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4298 rel="external nofollow noreferrer" target=_blank>#4298</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>添加了 <code class=syntax>Protobuf</code> 输出格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/4005 rel="external nofollow noreferrer" target=_blank>#4005</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4158 rel="external nofollow noreferrer" target=_blank>#4158</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>为数据导入的 HTTP 接口添加了 brotli 支持 (插入). <a href=https://github.com/ClickHouse/ClickHouse/pull/4235 rel="external nofollow noreferrer" target=_blank>#4235</a> (<a href=https://github.com/fandyushin rel="external nofollow noreferrer" target=_blank>Mikhail</a>)</li> <li>添加了用户在函数名称中输入拼写错误或在命令行客户端中输入时的提示. <a href=https://github.com/ClickHouse/ClickHouse/pull/4239 rel="external nofollow noreferrer" target=_blank>#4239</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>将 <code class=syntax>Query-Id</code> 添加到服务器的 HTTP 响应标头. <a href=https://github.com/ClickHouse/ClickHouse/pull/4231 rel="external nofollow noreferrer" target=_blank>#4231</a> (<a href=https://github.com/fandyushin rel="external nofollow noreferrer" target=_blank>Mikhail</a>)</li> </ul> <h4 id=experimental-features-2>实验功能<a class=headerlink href=../amp/#experimental-features-2 title="Permanent link"> </a></h4> <ul> <li>为 MergeTree 表引擎系列添加了 <code class=syntax>minmax</code> 和 <code class=syntax>set</code> 数据跳过索引. <a href=https://github.com/ClickHouse/ClickHouse/pull/4143 rel="external nofollow noreferrer" target=_blank>#4143</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>如果可能, 添加了 <code class=syntax>CROSS JOIN</code> 到 <code class=syntax>INNER JOIN</code> 的转换. <a href=https://github.com/ClickHouse/ClickHouse/pull/4221 rel="external nofollow noreferrer" target=_blank>#4221</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4266 rel="external nofollow noreferrer" target=_blank>#4266</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=bug-fixes-17>Bug 修复<a class=headerlink href=../amp/#bug-fixes-17 title="Permanent link"> </a></h4> <ul> <li>修复了 <code class=syntax>JOIN ON</code> 部分中重复列的 <code class=syntax>Not found column</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/4279 rel="external nofollow noreferrer" target=_blank>#4279</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>使 <code class=syntax>START REPLICATED SENDS</code> 命令开始复制发送. <a href=https://github.com/ClickHouse/ClickHouse/pull/4229 rel="external nofollow noreferrer" target=_blank>#4229</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>)</li> <li>使用 <code class=syntax>Array(LowCardinality)</code> 参数修复了聚合函数的执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/4055 rel="external nofollow noreferrer" target=_blank>#4055</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>KochetovNicolai</a>)</li> <li>修复了在执行 <code class=syntax>INSERT ... SELECT ... FROM file(...)</code> 查询和文件具有 <code class=syntax>CSVWithNames</code> 或 <code class=syntax>TSVWIthNames</code> 格式并且缺少第一个数据行时的错误行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/4297 rel="external nofollow noreferrer" target=_blank>#4297</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了字典不可用时重新加载字典时崩溃的问题. 这个bug出现在19.1.6. <a href=https://github.com/ClickHouse/ClickHouse/pull/4188 rel="external nofollow noreferrer" target=_blank>#4188</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复了右表中有重复项的 <code class=syntax>ALL JOIN</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/4184 rel="external nofollow noreferrer" target=_blank>#4184</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了 <code class=syntax>use_uncompressed_cache=1</code> 的分段错误和错误未压缩大小的异常. 这个bug出现在19.1.6. <a href=https://github.com/ClickHouse/ClickHouse/pull/4186 rel="external nofollow noreferrer" target=_blank>#4186</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>compile_expressions</code> 与大 (超过 int16) 日期比较的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4341 rel="external nofollow noreferrer" target=_blank>#4341</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>从表函数 <code class=syntax>numbers(0)</code> 中选择时修复了无限循环. <a href=https://github.com/ClickHouse/ClickHouse/pull/4280 rel="external nofollow noreferrer" target=_blank>#4280</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>暂时禁用 <code class=syntax>ORDER BY</code> 的谓词优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/3890 rel="external nofollow noreferrer" target=_blank>#3890</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>修复了在旧 CPU 上使用 base64 函数时的 <code class=syntax>Illegal instruction</code> 错误. 仅在使用 gcc-8 编译 ClickHouse 时才重现此错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4275 rel="external nofollow noreferrer" target=_blank>#4275</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了通过 TLS 连接与 PostgreSQL ODBC 驱动程序交互时的 <code class=syntax>No message received</code> 错误. 还修复了使用 MySQL ODBC 驱动程序时的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4170 rel="external nofollow noreferrer" target=_blank>#4170</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了在条件运算符 (函数 <code class=syntax>if</code>) 的分支中使用 <code class=syntax>Date</code> 和 <code class=syntax>DateTime</code> 参数时不正确的结果. 为函数 <code class=syntax>if</code> 添加了通用情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/4243 rel="external nofollow noreferrer" target=_blank>#4243</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>ClickHouse 词典现在在 <code class=syntax>clickhouse</code> 进程中加载. <a href=https://github.com/ClickHouse/ClickHouse/pull/4166 rel="external nofollow noreferrer" target=_blank>#4166</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了在 <code class=syntax>No such file or directory</code> 错误后重试带有 <code class=syntax>File</code> 引擎的表中的 <code class=syntax>SELECT</code> 时的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/4161 rel="external nofollow noreferrer" target=_blank>#4161</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了从 <code class=syntax>system.tables</code> 中选择时的竞争条件可能会出现 <code class=syntax>table does not exist</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4313 rel="external nofollow noreferrer" target=_blank>#4313</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>如果以交互模式运行, <code class=syntax>clickhouse-client</code> 可以在退出时加载命令行建议数据时出现段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4317 rel="external nofollow noreferrer" target=_blank>#4317</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了执行包含 <code class=syntax>IN</code> 运算符的突变时产生错误结果的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4099 rel="external nofollow noreferrer" target=_blank>#4099</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>修复错误: 如果有一个带有 <code class=syntax>Dictionary</code> 引擎的数据库, 所有词典都在服务器启动时强制加载, 如果有来自localhost的带有ClickHouse源的词典, 则该词典无法加载. <a href=https://github.com/ClickHouse/ClickHouse/pull/4255 rel="external nofollow noreferrer" target=_blank>#4255</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了在服务器关闭时尝试再次创建系统日志时的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4254 rel="external nofollow noreferrer" target=_blank>#4254</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>正确返回正确的类型并正确处理 <code class=syntax>joinGet</code> 函数中的锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/4153 rel="external nofollow noreferrer" target=_blank>#4153</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>添加了 <code class=syntax>sumMapWithOverflow</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/4151 rel="external nofollow noreferrer" target=_blank>#4151</a> (<a href=https://github.com/ercolanelli-leo rel="external nofollow noreferrer" target=_blank>Léo Ercolanelli</a>)</li> <li>使用 <code class=syntax>allow_experimental_multiple_joins_emulation</code> 修复段错误. <a href=https://github.com/ClickHouse/ClickHouse/commit/52de2cd927f7b5257dd67e175f0a5560a48840d0 rel="external nofollow noreferrer" target=_blank>52de2c</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了错误的 <code class=syntax>Date</code> 和<code class=syntax>DateTime</code> 比较错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4237 rel="external nofollow noreferrer" target=_blank>#4237</a> (<a href=https://github.com/valexey rel="external nofollow noreferrer" target=_blank>valexey</a>)</li> <li>修复了未定义行为消毒剂下的模糊测试: 添加了对 <code class=syntax>quantile*Weighted</code> 系列函数的参数类型检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/4145 rel="external nofollow noreferrer" target=_blank>#4145</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了删除旧数据部分可能会因 <code class=syntax>File not found</code> 错误而失败时的罕见竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/4378 rel="external nofollow noreferrer" target=_blank>#4378</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复缺少 /etc/clickhouse-server/config.xml 的安装包. <a href=https://github.com/ClickHouse/ClickHouse/pull/4343 rel="external nofollow noreferrer" target=_blank>#4343</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h4 id=buildtestingpackaging-improvements-5>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvements-5 title="Permanent link"> </a></h4> <ul> <li>Debian 软件包: 根据配置更正 /etc/clickhouse-server/preprocessed 链接. <a href=https://github.com/ClickHouse/ClickHouse/pull/4205 rel="external nofollow noreferrer" target=_blank>#4205</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>FreeBSD 的各种构建修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/4225 rel="external nofollow noreferrer" target=_blank>#4225</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>添加了在 perftest 中创建、填充和删除表格的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/4220 rel="external nofollow noreferrer" target=_blank>#4220</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加了一个脚本来检查重复的包含. <a href=https://github.com/ClickHouse/ClickHouse/pull/4326 rel="external nofollow noreferrer" target=_blank>#4326</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了在性能测试中按索引运行查询的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/4264 rel="external nofollow noreferrer" target=_blank>#4264</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>建议安装带有调试符号的包. <a href=https://github.com/ClickHouse/ClickHouse/pull/4274 rel="external nofollow noreferrer" target=_blank>#4274</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>重构性能测试. 更好的日志记录和信号处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/4171 rel="external nofollow noreferrer" target=_blank>#4171</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>向匿名化的 Yandex.Metrika 数据集添加了文档. <a href=https://github.com/ClickHouse/ClickHouse/pull/4164 rel="external nofollow noreferrer" target=_blank>#4164</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>Аdded 工具, 用于将旧的月份分区部分转换为自定义分区格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/4195 rel="external nofollow noreferrer" target=_blank>#4195</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>在 s3 中添加了关于两个数据集的文档. <a href=https://github.com/ClickHouse/ClickHouse/pull/4144 rel="external nofollow noreferrer" target=_blank>#4144</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加了从拉取请求描述创建变更日志的脚本. <a href=https://github.com/ClickHouse/ClickHouse/pull/4169 rel="external nofollow noreferrer" target=_blank>#4169</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4173 rel="external nofollow noreferrer" target=_blank>#4173</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>KochetovNicolai</a>) (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>KochetovNicolai</a>)</li> <li>为 ClickHouse 添加了 puppet 模块. <a href=https://github.com/ClickHouse/ClickHouse/pull/4182 rel="external nofollow noreferrer" target=_blank>#4182</a> (<a href=https://github.com/MaxFedotov rel="external nofollow noreferrer" target=_blank>Maxim Fedotov</a>)</li> <li>添加了一组未记录功能的文档. <a href=https://github.com/ClickHouse/ClickHouse/pull/4168 rel="external nofollow noreferrer" target=_blank>#4168</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>ARM 构建修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/4210 rel="external nofollow noreferrer" target=_blank>#4210</a><a href=https://github.com/ClickHouse/ClickHouse/pull/4306 rel="external nofollow noreferrer" target=_blank>#4306</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4291 rel="external nofollow noreferrer" target=_blank>#4291</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>) (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>字典测试现在可以从 <code class=syntax>ctest</code> 运行. <a href=https://github.com/ClickHouse/ClickHouse/pull/4189 rel="external nofollow noreferrer" target=_blank>#4189</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>现在 <code class=syntax>/etc/ssl</code> 被用作 SSL 证书的默认目录. <a href=https://github.com/ClickHouse/ClickHouse/pull/4167 rel="external nofollow noreferrer" target=_blank>#4167</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在开始时添加了检查 SSE 和 AVX 指令. <a href=https://github.com/ClickHouse/ClickHouse/pull/4234 rel="external nofollow noreferrer" target=_blank>#4234</a> (<a href=https://github.com/igron99 rel="external nofollow noreferrer" target=_blank>Igr</a>)</li> <li>初始化脚本将等待服务器直到启动. <a href=https://github.com/ClickHouse/ClickHouse/pull/4281 rel="external nofollow noreferrer" target=_blank>#4281</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h4 id=backward-incompatible-changes-1>向后不兼容更改<a class=headerlink href=../amp/#backward-incompatible-changes-1 title="Permanent link"> </a></h4> <ul> <li>删除了 <code class=syntax>allow_experimental_low_cardinality_type</code> 设置. <code class=syntax>LowCardinality</code> 数据类型是生产就绪的. <a href=https://github.com/ClickHouse/ClickHouse/pull/4323 rel="external nofollow noreferrer" target=_blank>#4323</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>根据可用内存量减少标记缓存大小和未压缩缓存大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/4240 rel="external nofollow noreferrer" target=_blank>#4240</a> (<a href=https://github.com/k-lopatin rel="external nofollow noreferrer" target=_blank>Lopatin Konstantin</a></li> <li>在 <code class=syntax>CREATE TABLE</code> 查询中添加了关键字 <code class=syntax>INDEX</code> . 名称为 <code class=syntax>index</code> 的列必须用反引号或双引号引用: <code class=syntax>`index`</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4143 rel="external nofollow noreferrer" target=_blank>#4143</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li><code class=syntax>sumMap</code> 现在提升结果类型而不是溢出. 旧的 <code class=syntax>sumMap</code> 行为可以通过使用 <code class=syntax>sumMapWithOverflow</code> 函数获得. <a href=https://github.com/ClickHouse/ClickHouse/pull/4151 rel="external nofollow noreferrer" target=_blank>#4151</a> (<a href=https://github.com/ercolanelli-leo rel="external nofollow noreferrer" target=_blank>Léo Ercolanelli</a>)</li> </ul> <h4 id=performance-improvements-4>性能改进<a class=headerlink href=../amp/#performance-improvements-4 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>std::sort</code> 替换为 <code class=syntax>pdqsort</code> 用于没有 <code class=syntax>LIMIT</code> 的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/4236 rel="external nofollow noreferrer" target=_blank>#4236</a> (<a href=https://github.com/kvinty rel="external nofollow noreferrer" target=_blank>Evgenii Pravda</a>)</li> <li>现在服务器重用来自全局线程池的线程. 这会影响某些极端情况下的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/4150 rel="external nofollow noreferrer" target=_blank>#4150</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=improvements-5>改进<a class=headerlink href=../amp/#improvements-5 title="Permanent link"> </a></h4> <ul> <li>为 FreeBSD 实现 AIO 支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/4305 rel="external nofollow noreferrer" target=_blank>#4305</a> (<a href=https://github.com/urgordeadbeef rel="external nofollow noreferrer" target=_blank>urgordeadbeef</a>)</li> <li><code class=syntax>SELECT * FROM a JOIN b USING a, b</code> 现在只从左表返回 <code class=syntax>a</code> 和 <code class=syntax>b</code> 列. <a href=https://github.com/ClickHouse/ClickHouse/pull/4141 rel="external nofollow noreferrer" target=_blank>#4141</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>允许客户端的<code class=syntax>-C</code> 选项作为<code class=syntax>-c</code> 选项工作. <a href=https://github.com/ClickHouse/ClickHouse/pull/4232 rel="external nofollow noreferrer" target=_blank>#4232</a> (<a href=https://github.com/syominsergey rel="external nofollow noreferrer" target=_blank>syominsergey</a>)</li> <li>现在不带值使用的选项 <code class=syntax>--password</code> 需要来自 stdin 的密码. <a href=https://github.com/ClickHouse/ClickHouse/pull/4230 rel="external nofollow noreferrer" target=_blank>#4230</a> (<a href=https://github.com/bsd-conqueror rel="external nofollow noreferrer" target=_blank>BSD_Conqueror</a>)</li> <li>在包含 <code class=syntax>LIKE</code> 表达式或正则表达式的字符串文字中添加了未转义元字符的突出显示. <a href=https://github.com/ClickHouse/ClickHouse/pull/4327 rel="external nofollow noreferrer" target=_blank>#4327</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>如果客户端套接字消失, 则添加取消 HTTP 只读查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/4213 rel="external nofollow noreferrer" target=_blank>#4213</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>)</li> <li>现在服务器报告进度以保持客户端连接有效. <a href=https://github.com/ClickHouse/ClickHouse/pull/4215 rel="external nofollow noreferrer" target=_blank>#4215</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>启用了 <code class=syntax>optimize_throw_if_noop</code> 设置的 OPTIMIZE 查询原因稍微好一点的消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/4294 rel="external nofollow noreferrer" target=_blank>#4294</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为 clickhouse 服务器添加了对 <code class=syntax>--version</code> 选项的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/4251 rel="external nofollow noreferrer" target=_blank>#4251</a> (<a href=https://github.com/k-lopatin rel="external nofollow noreferrer" target=_blank>Lopatin Konstantin</a>)</li> <li>为 <code class=syntax>clickhouse-server</code> 添加了 <code class=syntax>--help/-h</code> 选项. <a href=https://github.com/ClickHouse/ClickHouse/pull/4233 rel="external nofollow noreferrer" target=_blank>#4233</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>添加了对具有聚合函数状态结果的标量子查询的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/4348 rel="external nofollow noreferrer" target=_blank>#4348</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>改进了服务器关闭时间和 ALTERs 等待时间. <a href=https://github.com/ClickHouse/ClickHouse/pull/4372 rel="external nofollow noreferrer" target=_blank>#4372</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>向 system.replicas 添加了关于 replicad_can_become_leader 设置的信息, 如果副本不会尝试成为领导者，则添加日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/4379 rel="external nofollow noreferrer" target=_blank>#4379</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> </ul> <h2 id=clickhouse-release-19-1>ClickHouse 版本 19.1<a class=headerlink href=../amp/#clickhouse-release-19-1 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-1-14-2019-03-14>ClickHouse 版本 19.1.14, 2019-03-14<a class=headerlink href=../amp/#clickhouse-release-19-1-14-2019-03-14 title="Permanent link"> </a></h3> <ul> <li>修复了在将 <code class=syntax>GLOBAL JOIN</code> 与 <code class=syntax>SELECT *</code> (罕见情况) 一起使用的情况下, 如果设置 <code class=syntax>asterisk_left_columns_only</code> 设置为 1 时可能发生的错误 <code class=syntax>Column ... queried more than once</code>. 该问题在 19.3 及更新版本中不存在. <a href=https://github.com/ClickHouse/ClickHouse/pull/4692/commits/6bac7d8d11a9b0d6de0b32b53c47eb2f6f8e7062 rel="external nofollow noreferrer" target=_blank>6bac7d8d</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h3 id=clickhouse-release-19-1-13-2019-03-12>ClickHouse 版本 19.1.13, 2019-03-12<a class=headerlink href=../amp/#clickhouse-release-19-1-13-2019-03-12 title="Permanent link"> </a></h3> <p>此版本包含与 19.3.7 完全相同的补丁集.</p> <h3 id=clickhouse-release-19-1-10-2019-03-03>ClickHouse 版本 19.1.10, 2019-03-03<a class=headerlink href=../amp/#clickhouse-release-19-1-10-2019-03-03 title="Permanent link"> </a></h3> <p>此版本包含与 19.3.6 完全相同的补丁集</p> <h2 id=clickhouse-release-19-1-1>ClickHouse 版本 19.1<a class=headerlink href=../amp/#clickhouse-release-19-1-1 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-1-9-2019-02-21>ClickHouse 版本 19.1.9, 2019-02-21<a class=headerlink href=../amp/#clickhouse-release-19-1-9-2019-02-21 title="Permanent link"> </a></h3> <h4 id=bug-fixes-18>Bug 修复<a class=headerlink href=../amp/#bug-fixes-18 title="Permanent link"> </a></h4> <ul> <li>修复了由于 <code class=syntax>send_logs_level</code> 设置的错误实现而导致的与旧版本的向后不兼容. <a href=https://github.com/ClickHouse/ClickHouse/pull/4445 rel="external nofollow noreferrer" target=_blank>#4445</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了使用列注释引入的表函数 <code class=syntax>remote</code> 向后不兼容的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4446 rel="external nofollow noreferrer" target=_blank>#4446</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-1-8-2019-02-16>ClickHouse 版本 19.1.8, 2019-02-16<a class=headerlink href=../amp/#clickhouse-release-19-1-8-2019-02-16 title="Permanent link"> </a></h3> <h4 id=bug-fixes-19>Bug 修复<a class=headerlink href=../amp/#bug-fixes-19 title="Permanent link"> </a></h4> <ul> <li>修复缺少 /etc/clickhouse-server/config.xml 的安装包. <a href=https://github.com/ClickHouse/ClickHouse/pull/4343 rel="external nofollow noreferrer" target=_blank>#4343</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h2 id=clickhouse-release-19-1-2>ClickHouse 版本 19.1<a class=headerlink href=../amp/#clickhouse-release-19-1-2 title="Permanent link"> </a></h2> <h3 id=clickhouse-release-19-1-7-2019-02-15>ClickHouse 版本 19.1.7, 2019-02-15<a class=headerlink href=../amp/#clickhouse-release-19-1-7-2019-02-15 title="Permanent link"> </a></h3> <h4 id=bug-fixes-20>Bug 修复<a class=headerlink href=../amp/#bug-fixes-20 title="Permanent link"> </a></h4> <ul> <li>正确返回正确的类型并正确处理<code class=syntax>joinGet</code>函数中的锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/4153 rel="external nofollow noreferrer" target=_blank>#4153</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复了在服务器关闭时尝试再次创建系统日志时的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4254 rel="external nofollow noreferrer" target=_blank>#4254</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复错误: 如果有一个带有 <code class=syntax>Dictionary</code> 引擎的数据库, 所有词典都在服务器启动时强制加载, 如果有来自localhost的带有ClickHouse源的词典, 则该词典无法加载. <a href=https://github.com/ClickHouse/ClickHouse/pull/4255 rel="external nofollow noreferrer" target=_blank>#4255</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了执行包含 <code class=syntax>IN</code> 运算符的突变时产生错误结果的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4099 rel="external nofollow noreferrer" target=_blank>#4099</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>如果以交互模式运行, <code class=syntax>clickhouse-client</code> 可以在退出时加载命令行建议数据时出现段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4317 rel="external nofollow noreferrer" target=_blank>#4317</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>从 <code class=syntax>system.tables</code> 中选择时固定的竞争条件可能会给出“表不存在”错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4313 rel="external nofollow noreferrer" target=_blank>#4313</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了在 <code class=syntax>No such file or directory</code> 错误后重试带有 <code class=syntax>File</code> 引擎的表中的 <code class=syntax>SELECT</code> 时的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/4161 rel="external nofollow noreferrer" target=_blank>#4161</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了一个问题: 本地 ClickHouse 词典通过 TCP 加载, 但应在进程内加载. <a href=https://github.com/ClickHouse/ClickHouse/pull/4166 rel="external nofollow noreferrer" target=_blank>#4166</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了通过 TLS 连接与 PostgreSQL ODBC 驱动程序交互时的 <code class=syntax>No message received</code> 错误. 还修复了使用 MySQL ODBC 驱动程序时的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4170 rel="external nofollow noreferrer" target=_blank>#4170</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>暂时禁用<code class=syntax>ORDER BY</code> 的谓词优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/3890 rel="external nofollow noreferrer" target=_blank>#3890</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>从表函数 <code class=syntax>numbers(0)</code> 中选择时修复了无限循环. <a href=https://github.com/ClickHouse/ClickHouse/pull/4280 rel="external nofollow noreferrer" target=_blank>#4280</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 <code class=syntax>compile_expressions</code> 与大 (超过 int16) 日期比较的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4341 rel="external nofollow noreferrer" target=_blank>#4341</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>uncompressed_cache=1</code> 的分段错误和错误的未压缩大小的异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/4186 rel="external nofollow noreferrer" target=_blank>#4186</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了右表中有重复项的 <code class=syntax>ALL JOIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4184 rel="external nofollow noreferrer" target=_blank>#4184</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了在执行 <code class=syntax>INSERT ... SELECT ... FROM file(...)</code> 查询和文件具有 <code class=syntax>CSVWithNames</code> 或 <code class=syntax>TSVWIthNames</code> 格式并且缺少第一个数据行时的错误行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/4297 rel="external nofollow noreferrer" target=_blank>#4297</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用 <code class=syntax>Array(LowCardinality)</code> 参数修复了聚合函数的执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/4055 rel="external nofollow noreferrer" target=_blank>#4055</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>KochetovNicolai</a>)</li> <li>Debian 软件包: 根据配置更正 /etc/clickhouse-server/preprocessed 链接. <a href=https://github.com/ClickHouse/ClickHouse/pull/4205 rel="external nofollow noreferrer" target=_blank>#4205</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复了未定义行为消毒剂下的模糊测试: 添加了对 <code class=syntax>quantile*Weighted</code> 系列函数的参数类型检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/4145 rel="external nofollow noreferrer" target=_blank>#4145</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使 <code class=syntax>START REPLICATED SENDS</code> 命令开始复制发送. <a href=https://github.com/ClickHouse/ClickHouse/pull/4229 rel="external nofollow noreferrer" target=_blank>#4229</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>)</li> <li>修复了 JOIN ON 部分中重复列的 <code class=syntax>Not found column</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4279 rel="external nofollow noreferrer" target=_blank>#4279</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>现在 <code class=syntax>/etc/ssl</code> 被用作 SSL 证书的默认目录. <a href=https://github.com/ClickHouse/ClickHouse/pull/4167 rel="external nofollow noreferrer" target=_blank>#4167</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了字典不可用时重新加载字典时崩溃的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4188 rel="external nofollow noreferrer" target=_blank>#4188</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>修复了错误的 <code class=syntax>Date</code> 和<code class=syntax>DateTime</code> 比较错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4237 rel="external nofollow noreferrer" target=_blank>#4237</a> (<a href=https://github.com/valexey rel="external nofollow noreferrer" target=_blank>valexey</a>)</li> <li>修复了在条件运算符（函数 <code class=syntax>if</code>) 的分支中使用 <code class=syntax>Date</code> 和 <code class=syntax>DateTime</code> 参数时不正确的结果. 为函数 <code class=syntax>if</code> 添加了通用情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/4243 rel="external nofollow noreferrer" target=_blank>#4243</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h3 id=clickhouse-release-19-1-6-2019-01-24>ClickHouse 版本 19.1.6, 2019-01-24<a class=headerlink href=../amp/#clickhouse-release-19-1-6-2019-01-24 title="Permanent link"> </a></h3> <h4 id=new-features-7>新特征<a class=headerlink href=../amp/#new-features-7 title="Permanent link"> </a></h4> <ul> <li>表的自定义每列压缩编解码器. <a href=https://github.com/ClickHouse/ClickHouse/pull/3899 rel="external nofollow noreferrer" target=_blank>#3899</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4111 rel="external nofollow noreferrer" target=_blank>#4111</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>, <a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>, <a href=https://github.com/Sindbag rel="external nofollow noreferrer" target=_blank>Anatoly</a>)</li> <li>添加了压缩编解码器 <code class=syntax>Delta</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4052 rel="external nofollow noreferrer" target=_blank>#4052</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>允许<code class=syntax>ALTER</code>压缩编解码器. <a href=https://github.com/ClickHouse/ClickHouse/pull/4054 rel="external nofollow noreferrer" target=_blank>#4054</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加函数<code class=syntax>left</code>、<code class=syntax>right</code>、<code class=syntax>trim</code>、<code class=syntax>ltrim</code>、<code class=syntax>rtrim</code>、<code class=syntax>timestampadd</code>、<code class=syntax>timestampsub</code> 以实现SQL标准兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/3826 rel="external nofollow noreferrer" target=_blank>#3826</a> (<a href=https://github.com/blinkov rel="external nofollow noreferrer" target=_blank>Ivan Blinkov</a>)</li> <li>支持写入<code class=syntax>HDFS</code>表和<code class=syntax>hdfs</code>表功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/4084 rel="external nofollow noreferrer" target=_blank>#4084</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加了从大型 haystack 中搜索多个常量字符串的函数: <code class=syntax>multiPosition</code>、<code class=syntax>multiSearch</code>、<code class=syntax>firstMatch</code> 以及 <code class=syntax>-UTF8</code>、<code class=syntax>-CaseInsensitive</code> 和 <code class=syntax>-CaseInsensitiveUTF8</code> 变体. <a href=https://github.com/ClickHouse/ClickHouse/pull/4053 rel="external nofollow noreferrer" target=_blank>#4053</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>如果<code class=syntax>SELECT</code> 查询通过分片键进行过滤, 则修剪未使用的分片 (设置<code class=syntax>optimize_skip_unused_shards</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/3851 rel="external nofollow noreferrer" target=_blank>#3851</a> (<a href=https://github.com/kanterov rel="external nofollow noreferrer" target=_blank>Gleb Kanterov</a>, <a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>允许 <code class=syntax>Kafka</code> 引擎忽略每个块的一些解析错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4094 rel="external nofollow noreferrer" target=_blank>#4094</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>添加了对<code class=syntax>CatBoost</code> 多类模型评估的支持。 函数<code class=syntax>modelEvaluate</code> 返回带有多类模型的每类原始预测的元组。 <code class=syntax>libcatboostmodel.so</code> 应该使用 <a href=https://github.com/catboost/catboost/pull/607 rel="external nofollow noreferrer" target=_blank>#607</a> 构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/3959 rel="external nofollow noreferrer" target=_blank>#3959</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>KochetovNicolai</a>)</li> <li>添加函数 <code class=syntax>filesystemAvailable</code>、<code class=syntax>filesystemFree</code>、<code class=syntax>filesystemCapacity</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4097 rel="external nofollow noreferrer" target=_blank>#4097</a> (<a href=https://github.com/bgranvea rel="external nofollow noreferrer" target=_blank>Boris Granveaud</a>)</li> <li>添加了散列函数 <code class=syntax>xxHash64</code> 和 <code class=syntax>xxHash32</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3905 rel="external nofollow noreferrer" target=_blank>#3905</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>添加了 <code class=syntax>gccMurmurHash</code> 散列函数 (GCC 风味的 Murmur 散列), 它使用与 [gcc] (<a href=https://github.com/gcc-mirror/gcc/blob/41d6b10e96a1de98e90a7c0378437c3255814b16/libstdc%2B%2B-v3/include/bits/functional_hash.h#L191)相同的散列种子 target=_blank>https://github.com/gcc-mirror/gcc/blob/41d6b10e96a1de98e90a7c0378437c3255814b16/libstdc%2B%2B-v3/include/bits/functional_hash.h#L191)相同的散列种子</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/4000 rel="external nofollow noreferrer" target=_blank>#4000</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>)</li> <li>添加了散列函数 <code class=syntax>javaHash</code>、<code class=syntax>hiveHash</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3811 rel="external nofollow noreferrer" target=_blank>#3811</a> (<a href=https://github.com/shangshujie365 rel="external nofollow noreferrer" target=_blank>shangshujie365</a>)</li> <li>添加了表功能<code class=syntax>remoteSecure</code>. 功能作为 <code class=syntax>remote</code> 工作，但使用安全连接. <a href=https://github.com/ClickHouse/ClickHouse/pull/4088 rel="external nofollow noreferrer" target=_blank>#4088</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> </ul> <h4 id=experimental-features-3>实验功能<a class=headerlink href=../amp/#experimental-features-3 title="Permanent link"> </a></h4> <ul> <li>添加了多个 JOIN 仿真 (<code class=syntax>allow_experimental_multiple_joins_emulation</code> 设置). <a href=https://github.com/ClickHouse/ClickHouse/pull/3946 rel="external nofollow noreferrer" target=_blank>#3946</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=bug-fixes-21>Bug 修复<a class=headerlink href=../amp/#bug-fixes-21 title="Permanent link"> </a></h4> <ul> <li>将 <code class=syntax>compiled_expression_cache_size</code> 设置限制为默认以降低内存消耗. <a href=https://github.com/ClickHouse/ClickHouse/pull/4041 rel="external nofollow noreferrer" target=_blank>#4041</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复导致执行复制表 ALTER 的线程和从 ZooKeeper 更新配置的线程挂起的错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/2947 rel="external nofollow noreferrer" target=_blank>#2947</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/3891 rel="external nofollow noreferrer" target=_blank>#3891</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3934 rel="external nofollow noreferrer" target=_blank>#3934</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>修复了执行分布式 ALTER 任务时的竞争条件. 竞争条件导致多个副本尝试执行任务, 所有副本除了一个因 ZooKeeper 错误而失败. <a href=https://github.com/ClickHouse/ClickHouse/pull/3904 rel="external nofollow noreferrer" target=_blank>#3904</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>修复了在对 ZooKeeper 的请求超时后不刷新 <code class=syntax>from_zk</code> 配置元素的错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/2947 rel="external nofollow noreferrer" target=_blank>#2947</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3947 rel="external nofollow noreferrer" target=_blank>#3947</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>修复错误前缀的错误 IPv4 子网掩码. <a href=https://github.com/ClickHouse/ClickHouse/pull/3945 rel="external nofollow noreferrer" target=_blank>#3945</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了由于资源耗尽而无法创建新线程的极少数情况下的崩溃 (<code class=syntax>std::terminate</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/3956 rel="external nofollow noreferrer" target=_blank>#3956</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复在 <code class=syntax>getStructureOfRemoteTable</code> 中使用错误限制时在 <code class=syntax>remote</code> 表函数执行中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4009 rel="external nofollow noreferrer" target=_blank>#4009</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复 netlink 套接字泄漏. 它们被放置在一个永远不会被删除的池中, 并且当所有当前套接字都在使用时, 在新线程开始时创建新套接字. <a href=https://github.com/ClickHouse/ClickHouse/pull/4017 rel="external nofollow noreferrer" target=_blank>#4017</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>修复在分支 <code class=syntax>odbc-bridge</code> 子进程后, 在从 <code class=syntax>/proc</code> 读取所有 fds 之前关闭 <code class=syntax>/proc/self/fd</code> 目录的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4120 rel="external nofollow noreferrer" target=_blank>#4120</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>在主键中使用字符串的情况下修复了字符串到 UInt 的单调转换. <a href=https://github.com/ClickHouse/ClickHouse/pull/3870 rel="external nofollow noreferrer" target=_blank>#3870</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>修复整数转换函数单调性计算错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3921 rel="external nofollow noreferrer" target=_blank>#3921</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 <code class=syntax>arrayEnumerateUniq</code>、<code class=syntax>arrayEnumerateDense</code> 函数中某些无效参数的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3909 rel="external nofollow noreferrer" target=_blank>#3909</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 StorageMerge 中的 UB. <a href=https://github.com/ClickHouse/ClickHouse/pull/3910 rel="external nofollow noreferrer" target=_blank>#3910</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复了函数 <code class=syntax>addDays</code>、<code class=syntax>subtractDays</code> 中的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3913 rel="external nofollow noreferrer" target=_blank>#3913</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复错误: 函数<code class=syntax>round</code>、<code class=syntax>floor</code>、<code class=syntax>trunc</code>、<code class=syntax>ceil</code> 在整数参数和大的负比例上执行时可能返回虚假结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/3914 rel="external nofollow noreferrer" target=_blank>#3914</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了由 <code class=syntax>kill query sync</code> 引起的导致核心转储的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3916 rel="external nofollow noreferrer" target=_blank>#3916</a> (<a href=https://github.com/fancyqlx rel="external nofollow noreferrer" target=_blank>muVulDeePecker</a>)</li> <li>修复空复制队列后长时间延迟的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/3928 rel="external nofollow noreferrer" target=_blank>#3928</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3932 rel="external nofollow noreferrer" target=_blank>#3932</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了使用 <code class=syntax>LowCardinality</code> 主键插入表时过多的内存使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/3955 rel="external nofollow noreferrer" target=_blank>#3955</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>KochetovNicolai</a>)</li> <li>在空数组的情况下修复了<code class=syntax>Native</code>格式的<code class=syntax>LowCardinality</code>序列化. <a href=https://github.com/ClickHouse/ClickHouse/issues/3907 rel="external nofollow noreferrer" target=_blank>#3907</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4011 rel="external nofollow noreferrer" target=_blank>#4011</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>KochetovNicolai</a>)</li> <li>修复了使用单 LowCardinality 数字列不同时的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/issues/3895 rel="external nofollow noreferrer" target=_blank>#3895</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/4012 rel="external nofollow noreferrer" target=_blank>#4012</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>KochetovNicolai</a>)</li> <li>使用 LowCardinality 键修复了专门的聚合 (如果启用了 <code class=syntax>compile</code> 设置). <a href=https://github.com/ClickHouse/ClickHouse/pull/3886 rel="external nofollow noreferrer" target=_blank>#3886</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>KochetovNicolai</a>)</li> <li>修复复制表查询的用户和密码转发. <a href=https://github.com/ClickHouse/ClickHouse/pull/3957 rel="external nofollow noreferrer" target=_blank>#3957</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>) (<a href=https://github.com/nicelulu rel="external nofollow noreferrer" target=_blank>小路</a>)</li> <li>修复了在重新加载字典时列出字典数据库中的表时可能发生的非常罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/3970 rel="external nofollow noreferrer" target=_blank>#3970</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了当 HAVING 与 ROLLUP 或 CUBE 一起使用时的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/issues/3756 rel="external nofollow noreferrer" target=_blank>#3756</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3837 rel="external nofollow noreferrer" target=_blank>#3837</a> (<a href=https://github.com/reflection rel="external nofollow noreferrer" target=_blank>Sam Chou</a>)</li> <li>使用 <code class=syntax>JOIN ON</code> 语法和分布式表进行查询的固定列别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/3980 rel="external nofollow noreferrer" target=_blank>#3980</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>修复了 <code class=syntax>quantileTDigest</code> (由 Artem Vakhrushev 发现) 的内部实现中的错误. 此错误从未发生在 ClickHouse 中, 仅与直接使用 ClickHouse 代码库作为库的人相关. <a href=https://github.com/ClickHouse/ClickHouse/pull/3935 rel="external nofollow noreferrer" target=_blank>#3935</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=improvements-6>改进<a class=headerlink href=../amp/#improvements-6 title="Permanent link"> </a></h4> <ul> <li>支持 <code class=syntax>ALTER TABLE ADD COLUMN</code> 语句中的 <code class=syntax>IF NOT EXISTS</code> 以及 <code class=syntax>DROP/MODIFY/CLEAR/COMMENT COLUMN</code> 中的 <code class=syntax>IF EXISTS</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3900 rel="external nofollow noreferrer" target=_blank>#3900</a> (<a href=https://github.com/bgranvea rel="external nofollow noreferrer" target=_blank>Boris Granveaud</a>)</li> <li>函数 <code class=syntax>parseDateTimeBestEffort</code>: 支持<code class=syntax>DD.MM.YYYY</code>、<code class=syntax>DD.MM.YY</code>、<code class=syntax>DD-MM-YYYY</code>、<code class=syntax>DD-Mon-YYYY</code>、<code class=syntax>DD/Month/YYYY</code>等格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/3922 rel="external nofollow noreferrer" target=_blank>#3922</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>CapnProtoInputStream</code> 现在支持锯齿状结构. <a href=https://github.com/ClickHouse/ClickHouse/pull/4063 rel="external nofollow noreferrer" target=_blank>#4063</a> (<a href=https://github.com/Miniwoffer rel="external nofollow noreferrer" target=_blank>Odin Hultgren Van Der Horst</a>)</li> <li>可用性改进: 添加了检查服务器进程是否从数据目录的所有者启动. 如果数据属于非 root 用户, 则不允许从 root 启动服务器. <a href=https://github.com/ClickHouse/ClickHouse/pull/3785 rel="external nofollow noreferrer" target=_blank>#3785</a> (<a href=https://github.com/sergey-v-galtsev rel="external nofollow noreferrer" target=_blank>sergey-v-galtsev</a>)</li> <li>在使用 JOIN 分析查询期间检查所需列的更好逻辑. <a href=https://github.com/ClickHouse/ClickHouse/pull/3930 rel="external nofollow noreferrer" target=_blank>#3930</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>在单个服务器中有大量分布式表的情况下减少连接数. <a href=https://github.com/ClickHouse/ClickHouse/pull/3726 rel="external nofollow noreferrer" target=_blank>#3726</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>支持 ODBC 驱动程序 <code class=syntax>WITH TOTALS</code> 查询的总计行. <a href=https://github.com/ClickHouse/ClickHouse/pull/3836 rel="external nofollow noreferrer" target=_blank>#3836</a> (<a href=https://github.com/nightweb rel="external nofollow noreferrer" target=_blank>Maksim Koritckiy</a>)</li> <li>允许在 if 函数中使用 <code class=syntax>Enum</code> 作为整数. <a href=https://github.com/ClickHouse/ClickHouse/pull/3875 rel="external nofollow noreferrer" target=_blank>#3875</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>添加了 <code class=syntax>low_cardinality_allow_in_native_format</code> 设置. 如果禁用, 请勿使用 <code class=syntax>Native</code> 格式的 <code class=syntax>LowCadrinality</code> 类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/3879 rel="external nofollow noreferrer" target=_blank>#3879</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>KochetovNicolai</a>)</li> <li>从已编译的表达式缓存中删除了一些冗余对象以降低内存使用率. <a href=https://github.com/ClickHouse/ClickHouse/pull/4042 rel="external nofollow noreferrer" target=_blank>#4042</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加检查 <code class=syntax>SET send_logs_level = 'value'</code> 查询接受适当的值. <a href=https://github.com/ClickHouse/ClickHouse/pull/3873 rel="external nofollow noreferrer" target=_blank>#3873</a> (<a href=https://github.com/s-mx rel="external nofollow noreferrer" target=_blank>Sabyanin Maxim</a>)</li> <li>类型转换函数中的固定数据类型检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/3896 rel="external nofollow noreferrer" target=_blank>#3896</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> </ul> <h4 id=performance-improvements-5>性能改进<a class=headerlink href=../amp/#performance-improvements-5 title="Permanent link"> </a></h4> <ul> <li>添加 MergeTree 设置 <code class=syntax>use_minimalistic_part_header_in_zookeeper</code>. 如果启用，复制表将在单个部分 znode 中存储压缩部分元数据. 这可以显着减少 ZooKeeper 快照大小 (特别是如果表有很多列). 请注意, 启用此设置后, 您将无法降级到不支持它的版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/3960 rel="external nofollow noreferrer" target=_blank>#3960</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>为函数 <code class=syntax>sequenceMatch</code> 和 <code class=syntax>sequenceCount</code> 添加基于 DFA 的实现，以防模式不包含时间. <a href=https://github.com/ClickHouse/ClickHouse/pull/4004 rel="external nofollow noreferrer" target=_blank>#4004</a> (<a href=https://github.com/ercolanelli-leo rel="external nofollow noreferrer" target=_blank>Léo Ercolanelli</a>)</li> <li>整数序列化的性能改进. <a href=https://github.com/ClickHouse/ClickHouse/pull/3968 rel="external nofollow noreferrer" target=_blank>#3968</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>零左填充 PODArray 以便 -1 元素始终有效并归零. 它用于偏移量的无分支计算. <a href=https://github.com/ClickHouse/ClickHouse/pull/3920 rel="external nofollow noreferrer" target=_blank>#3920</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>恢复了导致性能下降的 <code class=syntax>jemalloc</code> 版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/4018 rel="external nofollow noreferrer" target=_blank>#4018</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=backward-incompatible-changes-2>向后不兼容更改<a class=headerlink href=../amp/#backward-incompatible-changes-2 title="Permanent link"> </a></h4> <ul> <li>删除了未记录的特性 <code class=syntax>ALTER MODIFY PRIMARY KEY</code>, 因为它被 <code class=syntax>ALTER MODIFY ORDER BY</code> 命令取代. <a href=https://github.com/ClickHouse/ClickHouse/pull/3887 rel="external nofollow noreferrer" target=_blank>#3887</a> (<a href=https://github.com/ztlpn rel="external nofollow noreferrer" target=_blank>Alex Zatelepin</a>)</li> <li>删除了函数 <code class=syntax>shardByHash</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/3833 rel="external nofollow noreferrer" target=_blank>#3833</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>禁止使用类型为 <code class=syntax>AggregateFunction</code> 的标量子查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/3865 rel="external nofollow noreferrer" target=_blank>#3865</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> </ul> <h4 id=buildtestingpackaging-improvements-6>构建/测试/打包改进<a class=headerlink href=../amp/#buildtestingpackaging-improvements-6 title="Permanent link"> </a></h4> <ul> <li>添加了对 PowerPC (<code class=syntax>ppc64le</code>) 构建的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/4132 rel="external nofollow noreferrer" target=_blank>#4132</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>)</li> <li>在公共可用数据集上运行状态功能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/3969 rel="external nofollow noreferrer" target=_blank>#3969</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了当服务器无法以 Docker 或 systemd-nspawn 中的 <code class=syntax>bash: /usr/bin/clickhouse-extract-from-config: Operation not allowed</code> 消息启动时的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4136 rel="external nofollow noreferrer" target=_blank>#4136</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 <code class=syntax>rdkafka</code> 库更新到 v1.0.0-RC5. 使用 cppkafka 而不是原始 C 接口. <a href=https://github.com/ClickHouse/ClickHouse/pull/4025 rel="external nofollow noreferrer" target=_blank>#4025</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>更新了 <code class=syntax>mariadb-client</code> 库. 修复了 UBSan 发现的问题之一. <a href=https://github.com/ClickHouse/ClickHouse/pull/3924 rel="external nofollow noreferrer" target=_blank>#3924</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>UBSan 版本的一些修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/3926 rel="external nofollow noreferrer" target=_blank>#3926</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3021 rel="external nofollow noreferrer" target=_blank>#3021</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/3948 rel="external nofollow noreferrer" target=_blank>#3948</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用 UBSan 构建添加了每次提交的测试运行.</li> <li>添加了 PVS-Studio 静态分析器的每次提交运行.</li> <li>修复了 PVS-Studio 发现的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4013 rel="external nofollow noreferrer" target=_blank>#4013</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 glibc 兼容性问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/4100 rel="external nofollow noreferrer" target=_blank>#4100</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 Docker 镜像移至 18.10 并添加 glibc &gt;= 2.28 的兼容性文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/3965 rel="external nofollow noreferrer" target=_blank>#3965</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>如果用户不想在服务器 Docker 映像中 chown 目录，请添加 env 变量. <a href=https://github.com/ClickHouse/ClickHouse/pull/3967 rel="external nofollow noreferrer" target=_blank>#3967</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>在 clang 中启用了来自 <code class=syntax>-Weverything</code> 的大部分警告. 启用 <code class=syntax>-Wpedantic</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/3986 rel="external nofollow noreferrer" target=_blank>#3986</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了一些仅在 clang 8 中可用的警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/3993 rel="external nofollow noreferrer" target=_blank>#3993</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用共享链接时链接到 <code class=syntax>libLLVM</code> 而不是单个 LLVM 库. <a href=https://github.com/ClickHouse/ClickHouse/pull/3989 rel="external nofollow noreferrer" target=_blank>#3989</a> (<a href=https://github.com/orivej rel="external nofollow noreferrer" target=_blank>Orivej Desh</a>)</li> <li>测试图像添加了清除变量. <a href=https://github.com/ClickHouse/ClickHouse/pull/4072 rel="external nofollow noreferrer" target=_blank>#4072</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li><code class=syntax>clickhouse-server</code> debian 包会推荐 <code class=syntax>libcap2-bin</code> 包使用 <code class=syntax>setcap</code> 工具设置功能. 这是可选的. <a href=https://github.com/ClickHouse/ClickHouse/pull/4093 rel="external nofollow noreferrer" target=_blank>#4093</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>改进了编译时间, 修复了包含. <a href=https://github.com/ClickHouse/ClickHouse/pull/3898 rel="external nofollow noreferrer" target=_blank>#3898</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>添加了哈希函数的性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/3918 rel="external nofollow noreferrer" target=_blank>#3918</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复了循环库依赖. <a href=https://github.com/ClickHouse/ClickHouse/pull/3958 rel="external nofollow noreferrer" target=_blank>#3958</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>改进了低可用内存的编译. <a href=https://github.com/ClickHouse/ClickHouse/pull/4030 rel="external nofollow noreferrer" target=_blank>#4030</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>添加了测试脚本以重现 <code class=syntax>jemalloc</code> 中的性能下降. <a href=https://github.com/ClickHouse/ClickHouse/pull/4036 rel="external nofollow noreferrer" target=_blank>#4036</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 <code class=syntax>dbms</code> 下注释和字符串中的拼写错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/4122 rel="external nofollow noreferrer" target=_blank>#4122</a> (<a href=https://github.com/maiha rel="external nofollow noreferrer" target=_blank>maiha</a>)</li> <li>修正了评论中的错别字. <a href=https://github.com/ClickHouse/ClickHouse/pull/4089 rel="external nofollow noreferrer" target=_blank>#4089</a> (<a href=https://github.com/kvinty rel="external nofollow noreferrer" target=_blank>Evgenii Pravda</a>)</li> </ul> <h2 id=changelog-for-2018><a href=../../2018/amp/#clickhouse-release-18-16>Changelog for 2018</a><a class=headerlink href=../amp/#changelog-for-2018 title="Permanent link"> </a></h2>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2022 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/38993f215f9186c1ac3505b1e09697cd9a468b5d" rel="external nofollow noreferrer" target="_blank" class="text-reset">38993f21</a>
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/zh/whats-new/changelog/2019/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
