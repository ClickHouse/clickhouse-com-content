










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="zh">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>ClickHouse 版本 20.12 | ClickHouse文档</title>
    <link rel="canonical" href="https://clickhouse.com/docs/zh/whats-new/changelog/2020/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer,header,main{display:block}body{margin:0;font-family:Noto Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}address{font-style:normal;line-height:inherit}address,ul{margin-bottom:1rem}ul{margin-top:0}ul ul{margin-bottom:0}b{font-weight:bolder}a{text-decoration:none;background-color:transparent}a,a:hover{color:#ff8c00}a:hover{text-decoration:underline}a:not([href]),a:not([href]):hover{color:inherit;text-decoration:none}code{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}label{display:inline-block;margin-bottom:.5rem}input,select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}input{overflow:visible}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=date],input[type=datetime-local],input[type=month],input[type=time]{-webkit-appearance:listbox}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}template{display:none}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:Hind Siliguri,sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.mark,mark{padding:.2em;background-color:#fcf8e3}.list-inline{padding-left:0;list-style:none}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-auto,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-auto,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-auto{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-auto{flex:0 0 auto;width:auto;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}.order-first{order:-1}.order-last{order:13}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}.offset-1{margin-left:8.3333333333%}.offset-2{margin-left:16.6666666667%}.offset-3{margin-left:25%}.offset-4{margin-left:33.3333333333%}.offset-5{margin-left:41.6666666667%}.offset-6{margin-left:50%}.offset-7{margin-left:58.3333333333%}.offset-8{margin-left:66.6666666667%}.offset-9{margin-left:75%}.offset-10{margin-left:83.3333333333%}.offset-11{margin-left:91.6666666667%}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-auto{flex:0 0 auto;width:auto;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}.order-md-first{order:-1}.order-md-last{order:13}.order-md-0{order:0}.order-md-1{order:1}.order-md-2{order:2}.order-md-3{order:3}.order-md-4{order:4}.order-md-5{order:5}.order-md-6{order:6}.order-md-7{order:7}.order-md-8{order:8}.order-md-9{order:9}.order-md-10{order:10}.order-md-11{order:11}.order-md-12{order:12}.offset-md-0{margin-left:0}.offset-md-1{margin-left:8.3333333333%}.offset-md-2{margin-left:16.6666666667%}.offset-md-3{margin-left:25%}.offset-md-4{margin-left:33.3333333333%}.offset-md-5{margin-left:41.6666666667%}.offset-md-6{margin-left:50%}.offset-md-7{margin-left:58.3333333333%}.offset-md-8{margin-left:66.6666666667%}.offset-md-9{margin-left:75%}.offset-md-10{margin-left:83.3333333333%}.offset-md-11{margin-left:91.6666666667%}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-auto{flex:0 0 auto;width:auto;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}.order-lg-first{order:-1}.order-lg-last{order:13}.order-lg-0{order:0}.order-lg-1{order:1}.order-lg-2{order:2}.order-lg-3{order:3}.order-lg-4{order:4}.order-lg-5{order:5}.order-lg-6{order:6}.order-lg-7{order:7}.order-lg-8{order:8}.order-lg-9{order:9}.order-lg-10{order:10}.order-lg-11{order:11}.order-lg-12{order:12}.offset-lg-0{margin-left:0}.offset-lg-1{margin-left:8.3333333333%}.offset-lg-2{margin-left:16.6666666667%}.offset-lg-3{margin-left:25%}.offset-lg-4{margin-left:33.3333333333%}.offset-lg-5{margin-left:41.6666666667%}.offset-lg-6{margin-left:50%}.offset-lg-7{margin-left:58.3333333333%}.offset-lg-8{margin-left:66.6666666667%}.offset-lg-9{margin-left:75%}.offset-lg-10{margin-left:83.3333333333%}.offset-lg-11{margin-left:91.6666666667%}}.table{width:100%;margin-bottom:8px;color:#212529}.table-primary{background-color:#fff1b8}.table-success{background-color:#c3e6cb}.table-info{background-color:#bee5eb}.table-warning{background-color:#ffeeba}.table-light{background-color:#fbfcfd}.table-dark{background-color:#ccced0}.table-primary-light{background-color:#fffefb}.table-white{background-color:#fff}.table-black{background-color:#c1c2c3}.table-orange{background-color:#ffdfb8}.table-light-orange{background-color:#fff7ea}.table-dark{color:#fff;background-color:#343a40}.invalid-feedback{display:none;width:100%;margin-top:.25rem;font-size:80%;color:#dc3545}.is-invalid~.invalid-feedback{display:block}.custom-select.is-invalid{border-color:#dc3545;padding-right:calc(.75em+2.3125rem);background:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px,url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545'%3E%3Ccircle cx='6' cy='6' r='4.5'/%3E%3Cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3E%3Ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3E%3C/svg%3E") #fff no-repeat center right 1.75rem/calc(.75em+.375rem) calc(.75em+.375rem)}.custom-select.is-invalid:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.custom-control-input.is-invalid~.custom-control-label{color:#dc3545}.custom-control-input.is-invalid~.custom-control-label:before{border-color:#dc3545}.custom-control-input.is-invalid:checked~.custom-control-label:before{border-color:#e4606d;background-color:#e4606d}.custom-control-input.is-invalid:focus~.custom-control-label:before{box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.custom-control-input.is-invalid:focus:not(:checked)~.custom-control-label:before,.custom-file-input.is-invalid~.custom-file-label{border-color:#dc3545}.custom-file-input.is-invalid:focus~.custom-file-label{border-color:#dc3545;box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-primary{color:#495057;background-color:#fc0;border-color:#fc0}.btn-primary:focus,.btn-primary:hover{color:#495057;background-color:#d9ad00;border-color:#cca300}.btn-primary:focus{box-shadow:0 0 0 0 rgba(228,185,13,.5)}.btn-primary:disabled{color:#495057;background-color:#fc0;border-color:#fc0}.btn-success{color:#fff;background-color:#28a745;border-color:#28a745}.btn-success:focus,.btn-success:hover{color:#fff;background-color:#218838;border-color:#1e7e34}.btn-success:focus{box-shadow:0 0 0 0 rgba(72,180,97,.5)}.btn-success:disabled{color:#fff;background-color:#28a745;border-color:#28a745}.btn-info{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-info:focus,.btn-info:hover{color:#fff;background-color:#138496;border-color:#117a8b}.btn-info:focus{box-shadow:0 0 0 0 rgba(58,176,195,.5)}.btn-info:disabled{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-warning{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-warning:focus,.btn-warning:hover{color:#495057;background-color:#e0a800;border-color:#d39e00}.btn-warning:focus{box-shadow:0 0 0 0 rgba(228,176,19,.5)}.btn-warning:disabled{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:focus,.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:focus,.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-primary-light{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-primary-light:focus,.btn-primary-light:hover{color:#495057;background-color:#ffedca;border-color:#ffe9bd}.btn-primary-light:focus{box-shadow:0 0 0 0 rgba(228,225,217,.5)}.btn-primary-light:disabled{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:focus,.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:focus,.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:focus,.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:focus,.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-primary{color:#fc0;border-color:#fc0}.btn-outline-primary:hover{color:#495057;background-color:#fc0;border-color:#fc0}.btn-outline-primary:focus{box-shadow:0 0 0 0 rgba(255,204,0,.5)}.btn-outline-primary:disabled{color:#fc0;background-color:transparent}.btn-outline-success{color:#28a745;border-color:#28a745}.btn-outline-success:hover{color:#fff;background-color:#28a745;border-color:#28a745}.btn-outline-success:focus{box-shadow:0 0 0 0 rgba(40,167,69,.5)}.btn-outline-success:disabled{color:#28a745;background-color:transparent}.btn-outline-info{color:#17a2b8;border-color:#17a2b8}.btn-outline-info:hover{color:#fff;background-color:#17a2b8;border-color:#17a2b8}.btn-outline-info:focus{box-shadow:0 0 0 0 rgba(23,162,184,.5)}.btn-outline-info:disabled{color:#17a2b8;background-color:transparent}.btn-outline-warning{color:#ffc107;border-color:#ffc107}.btn-outline-warning:hover{color:#495057;background-color:#ffc107;border-color:#ffc107}.btn-outline-warning:focus{box-shadow:0 0 0 0 rgba(255,193,7,.5)}.btn-outline-warning:disabled{color:#ffc107;background-color:transparent}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-primary-light{color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:hover{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:focus{box-shadow:0 0 0 0 rgba(255,250,240,.5)}.btn-outline-primary-light:disabled{color:#fffaf0;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 hsla(0,0%,100%,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.collapsing{position:relative;height:0;overflow:hidden;transition:height .35s ease}@media(prefers-reduced-motion:reduce){.collapsing{transition:none}}.btn-group{position:relative;display:inline-flex;vertical-align:middle}.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group{position:relative;display:flex;flex-wrap:wrap;align-items:stretch;width:100%}.input-group>.custom-file,.input-group>.custom-select{position:relative;flex:1 1 0;min-width:0;margin-bottom:0}.input-group>.custom-file+.custom-file,.input-group>.custom-file+.custom-select,.input-group>.custom-select+.custom-file,.input-group>.custom-select+.custom-select{margin-left:-1px}.input-group>.custom-file .custom-file-input:focus~.custom-file-label,.input-group>.custom-select:focus{z-index:3}.input-group>.custom-file .custom-file-input:focus{z-index:4}.input-group>.custom-select:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.custom-select:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group>.custom-file{display:flex;align-items:center}.input-group>.custom-file:not(:last-child) .custom-file-label,.input-group>.custom-file:not(:last-child) .custom-file-label:after{border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.custom-file:not(:first-child) .custom-file-label{border-top-left-radius:0;border-bottom-left-radius:0}.input-group-text{display:flex;align-items:center;padding:.375rem .75rem;margin-bottom:0;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;text-align:center;white-space:nowrap;background-color:#e9ecef;border:1px solid #ced4da;border-radius:8px}.input-group-text input[type=checkbox],.input-group-text input[type=radio]{margin-top:0}.input-group-lg>.custom-select{height:calc(1.5em+1rem+2px)}.input-group-lg>.custom-select{padding:.5rem 1rem;font-size:1.125rem;line-height:1.5;border-radius:8px}.input-group-lg>.custom-select{padding-right:1.75rem}.custom-control{position:relative;display:block;min-height:1.5rem;padding-left:1.5rem}.custom-control-inline{display:inline-flex;margin-right:1rem}.custom-control-input{position:absolute;left:0;z-index:-1;width:1rem;height:1.25rem;opacity:0}.custom-control-input:checked~.custom-control-label:before{color:#fff;border-color:#fc0;background-color:#fc0}.custom-control-input:focus~.custom-control-label:before{box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-control-input:focus:not(:checked)~.custom-control-label:before{border-color:#ffe680}.custom-control-input:not(:disabled):active~.custom-control-label:before{color:#fff;background-color:#fff0b3;border-color:#fff0b3}.custom-control-input:disabled~.custom-control-label,.custom-control-input[disabled]~.custom-control-label{color:#6c757d}.custom-control-input:disabled~.custom-control-label:before,.custom-control-input[disabled]~.custom-control-label:before{background-color:#e9ecef}.custom-control-label{position:relative;margin-bottom:0;vertical-align:top}.custom-control-label:before{pointer-events:none;background-color:#fff;border:1px solid #d6dbdf}.custom-control-label:after,.custom-control-label:before{position:absolute;top:.25rem;left:-1.5rem;display:block;width:1rem;height:1rem;content:""}.custom-control-label:after{background:no-repeat 50%/50% 50%}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-file{display:inline-block;margin-bottom:0}.custom-file,.custom-file-input{position:relative;width:100%;height:calc(1.5em+.75rem+2px)}.custom-file-input{z-index:2;margin:0;opacity:0}.custom-file-input:focus~.custom-file-label{border-color:#ffe680;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-file-input:disabled~.custom-file-label,.custom-file-input[disabled]~.custom-file-label{background-color:#e9ecef}.custom-file-input:lang(en)~.custom-file-label:after{content:"Browse"}.custom-file-input~.custom-file-label[data-browse]:after{content:attr(data-browse)}.custom-file-label{left:0;z-index:1;height:calc(1.5em+.75rem+2px);font-weight:400;background-color:#fff;border:1px solid #ced4da;border-radius:8px}.custom-file-label,.custom-file-label:after{position:absolute;top:0;right:0;padding:.375rem .75rem;line-height:1.5;color:#6c757d}.custom-file-label:after{bottom:0;z-index:3;display:block;height:calc(1.5em+.75rem);content:"Browse";background-color:#e9ecef;border-left:inherit;border-radius:0 8px 8px 0}.custom-range{width:100%;height:1.4rem;padding:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-range:focus{outline:0}.custom-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-moz-range-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range:focus::-ms-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .2rem rgba(255,204,0,.25)}.custom-range::-moz-focus-outer{border:0}.custom-range::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:#fc0;border:0;border-radius:1rem;-webkit-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-webkit-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-webkit-slider-thumb{-webkit-transition:none;transition:none}}.custom-range::-webkit-slider-thumb:active{background-color:#fff0b3}.custom-range::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-moz-range-thumb{width:1rem;height:1rem;background-color:#fc0;border:0;border-radius:1rem;-moz-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-moz-appearance:none;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-moz-range-thumb{-moz-transition:none;transition:none}}.custom-range::-moz-range-thumb:active{background-color:#fff0b3}.custom-range::-moz-range-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.custom-range::-ms-thumb{width:1rem;height:1rem;margin-top:0;margin-right:.2rem;margin-left:.2rem;background-color:#fc0;border:0;border-radius:1rem;-ms-transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;appearance:none}@media(prefers-reduced-motion:reduce){.custom-range::-ms-thumb{-ms-transition:none;transition:none}}.custom-range::-ms-thumb:active{background-color:#fff0b3}.custom-range::-ms-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:transparent;border-color:transparent;border-width:.5rem}.custom-range::-ms-fill-lower,.custom-range::-ms-fill-upper{background-color:#dee2e6;border-radius:1rem}.custom-range::-ms-fill-upper{margin-right:15px}.custom-range:disabled::-webkit-slider-thumb{background-color:#d6dbdf}.custom-range:disabled::-webkit-slider-runnable-track{cursor:default}.custom-range:disabled::-moz-range-thumb{background-color:#d6dbdf}.custom-range:disabled::-moz-range-track{cursor:default}.custom-range:disabled::-ms-thumb{background-color:#d6dbdf}.custom-control-label:before,.custom-file-label,.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-control-label:before,.custom-file-label,.custom-select{transition:none}}img,tr{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}.container,body{min-width:980px}.table{border-collapse:collapse}.table-dark{color:inherit}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
          <h3 id=clickhouse-ban-ben-20-12>ClickHouse 版本 20.12<a class=headerlink href=../amp/#clickhouse-ban-ben-20-12 title="Permanent link"> </a></h3> <h3 id=clickhouse-ban-ben-v20-12-5-14-stable-2020-12-28>ClickHouse 版本 v20.12.5.14-stable, 2020-12-28<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-12-5-14-stable-2020-12-28 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu title="Permanent link"> </a></h4> <ul> <li>在合并期间禁用 AIO 写入, 因为它会导致合并期间主键列的数据损坏极为罕见. <a href=https://github.com/ClickHouse/ClickHouse/pull/18481 rel="external nofollow noreferrer" target=_blank>#18481</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了在使用类型为 <code class=syntax>Nullable(String)</code> 的参数执行 <code class=syntax>toType(...)</code> 函数 (<code class=syntax>toDate</code>、<code class=syntax>toUInt32</code> 等)时出现的 <code class=syntax>value is too short</code> 错误. 现在这些函数在解析错误时返回 <code class=syntax>NULL</code> 而不是抛出异常. 修复 <a href=https://github.com/ClickHouse/ClickHouse/pull/18445 rel="external nofollow noreferrer" target=_blank>#18445</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>限制从宽部分合并到紧凑部分. 在垂直合并的情况下, 它会导致结果部分损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/18381 rel="external nofollow noreferrer" target=_blank>#18381</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复填充表 <code class=syntax>system.settings_profile_elements</code>. 此 PR 修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/18231 rel="external nofollow noreferrer" target=_blank>#18231</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18379 rel="external nofollow noreferrer" target=_blank>#18379</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>使用组合子 <code class=syntax>Distinct</code> 修复聚合函数中可能的崩溃, 同时使用两级聚合. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17682 rel="external nofollow noreferrer" target=_blank>#17682</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18365 rel="external nofollow noreferrer" target=_blank>#18365</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复查询 <code class=syntax>MODIFY COLUMN ... REMOVE TTL</code> 并没有真正删除列 TTL 时的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/18130 rel="external nofollow noreferrer" target=_blank>#18130</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin title="Permanent link"> </a></h4> <ul> <li>将时区信息更新为 2020e. <a href=https://github.com/ClickHouse/ClickHouse/pull/18531 rel="external nofollow noreferrer" target=_blank>#18531</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-12-4-5-stable-2020-12-24>ClickHouse 版本 v20.12.4.5-stable, 2020-12-24<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-12-4-5-stable-2020-12-24 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_1>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_1 title="Permanent link"> </a></h4> <ul> <li>修复了在具有双 IPv4/IPv6 堆栈的机器上服务器无法访问 <code class=syntax>clickhouse-odbc-bridge</code> 进程的问题; - 修复了使用格式错误的查询执行 ODBC 字典更新和/或导致崩溃的问题; 可能关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14489 rel="external nofollow noreferrer" target=_blank>#14489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18278 rel="external nofollow noreferrer" target=_blank>#18278</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>修复了 Enum 和 Int 类型之间的键比较. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17989 rel="external nofollow noreferrer" target=_blank>#17989</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18214 rel="external nofollow noreferrer" target=_blank>#18214</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了 <code class=syntax>MaterializeMySQL</code> 数据库引擎中唯一键转换崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/18186 rel="external nofollow noreferrer" target=_blank>#18186</a> 并修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16372 rel="external nofollow noreferrer" target=_blank>#16372</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/18211 rel="external nofollow noreferrer" target=_blank>#18211</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了 S3 URL 解析中的 <code class=syntax>std::out_of_range: basic_string</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18059 rel="external nofollow noreferrer" target=_blank>#18059</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>修复了由于 MaterializeMySQL 不支持转换 MySQL 前缀索引而导致某些表无法从 MySQL 同步到 ClickHouse 的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15187 rel="external nofollow noreferrer" target=_blank>#15187</a> 并修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17912 rel="external nofollow noreferrer" target=_blank>#17912</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/17944 rel="external nofollow noreferrer" target=_blank>#17944</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了查询包含 <code class=syntax>ARRAY JOIN</code> 时查询优化产生错误结果的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17887 rel="external nofollow noreferrer" target=_blank>#17887</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>修复了 <code class=syntax>topK</code> 聚合函数中可能出现的段错误. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/17404 rel="external nofollow noreferrer" target=_blank>#17404</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17845 rel="external nofollow noreferrer" target=_blank>#17845</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>修复了服务器在守护进程模式下运行时空的 <code class=syntax>system.stack_trace</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/17630 rel="external nofollow noreferrer" target=_blank>#17630</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-12-3-3-stable-2020-12-13>ClickHouse 版本 v20.12.3.3-stable, 2020-12-13<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-12-3-3-stable-2020-12-13 title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng title="Permanent link"> </a></h4> <ul> <li>默认启用<code class=syntax>use_compact_format_in_distributed_parts_names</code> (参考文档). <a href=https://github.com/ClickHouse/ClickHouse/pull/16728 rel="external nofollow noreferrer" target=_blank>#16728</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>创建使用 <code class=syntax>File</code> 引擎的表时, 在 <code class=syntax>SETTINGS</code> 子句中接受与文件格式 (例如 <code class=syntax>format_csv_delimiter</code> ) 相关的用户设置, 并在所有 <code class=syntax>INSERT</code> 和 <code class=syntax>SELECT</code> 中使用这些设置. 当前用户会话中或 DML 查询本身的 <code class=syntax>SETTINGS</code> 子句中更改的文件格式设置不再影响查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/16591 rel="external nofollow noreferrer" target=_blank>#16591</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> </ul> <h4 id=xin-te-zheng>新特征<a class=headerlink href=../amp/#xin-te-zheng title="Permanent link"> </a></h4> <ul> <li>添加 <code class=syntax>*.xz</code> 压缩/解压支持。它允许在 <code class=syntax>file()</code> 函数中使用 <code class=syntax>*.xz</code>. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/8828 rel="external nofollow noreferrer" target=_blank>#8828</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16578 rel="external nofollow noreferrer" target=_blank>#16578</a> (<a href=https://github.com/fibersel rel="external nofollow noreferrer" target=_blank>Abi Palagashvili</a>).</li> <li>引入查询<code class=syntax>ALTER TABLE ... DROP|DETACH PART 'part_name'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15511 rel="external nofollow noreferrer" target=_blank>#15511</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> <li>添加了新的 ALTER UPDATE/DELETE IN PARTITION 语法. <a href=https://github.com/ClickHouse/ClickHouse/pull/13403 rel="external nofollow noreferrer" target=_blank>#13403</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>允许在使用 JSON 输入/输出格式时将命名元组格式化为 JSON 对象, 由 <code class=syntax>output_format_json_named_tuples_as_objects</code> 设置控制, 默认禁用. <a href=https://github.com/ClickHouse/ClickHouse/pull/17175 rel="external nofollow noreferrer" target=_blank>#17175</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>在TSV和CSV格式默认情况下添加一种可能的输入枚举值作为它的id. <a href=https://github.com/ClickHouse/ClickHouse/pull/16834 rel="external nofollow noreferrer" target=_blank>#16834</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>添加对 Nullable、LowCardinality、Array 和 Tuple 的 COLLATE 支持，其中嵌套类型为 String. 同时重构ColumnString.cpp中与collations相关的代码. <a href=https://github.com/ClickHouse/ClickHouse/pull/16273 rel="external nofollow noreferrer" target=_blank>#16273</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>新的 <code class=syntax>tcpPort</code> 函数返回此服务器监听的 TCP 端口. <a href=https://github.com/ClickHouse/ClickHouse/pull/17134 rel="external nofollow noreferrer" target=_blank>#17134</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>添加新的数学函数：<code class=syntax>acosh</code>、<code class=syntax>asinh</code>、<code class=syntax>atan2</code>、<code class=syntax>atanh</code>、<code class=syntax>cosh</code>、<code class=syntax>hypot</code>、<code class=syntax>log1p</code>、<code class=syntax>sinh</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16636 rel="external nofollow noreferrer" target=_blank>#16636</a> (<a href=https://github.com/hombit rel="external nofollow noreferrer" target=_blank>Konstantin Malanchev</a>).</li> <li>在不同副本之间分配合并的可能性. 引入 <code class=syntax>execute_merges_on_single_replica_time_threshold</code> 合并树设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/16424 rel="external nofollow noreferrer" target=_blank>#16424</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>添加设置 <code class=syntax>aggregate_functions_null_for_empty</code> 以实现 SQL 标准兼容性. 此选项将重写查询中的所有聚合函数, 并向它们添加 -OrNull 后缀. 实现 <a href=https://github.com/ClickHouse/ClickHouse/issues/10273 rel="external nofollow noreferrer" target=_blank>10273</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16123 rel="external nofollow noreferrer" target=_blank>#16123</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>更新了 DateTime、DateTime64 解析以接受字符串日期文字格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/16040 rel="external nofollow noreferrer" target=_blank>#16040</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>可以使用 <code class=syntax>--history_file</code> 参数在 <code class=syntax>clickhouse-client</code> 中更改历史文件的路径. <a href=https://github.com/ClickHouse/ClickHouse/pull/15960 rel="external nofollow noreferrer" target=_blank>#15960</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> </ul> <h4 id=bug-xiu-fu_2>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_2 title="Permanent link"> </a></h4> <ul> <li>修复在极少数情况下服务器可以停止接受连接的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17542 rel="external nofollow noreferrer" target=_blank>#17542</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了在 Linux 的 Windows 子系统上运行的 ClickHouse 在 <code class=syntax>Atomic</code> 数据库中执行 <code class=syntax>RENAME</code> 查询时出现的 <code class=syntax>Function not implementation</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17661 rel="external nofollow noreferrer" target=_blank>#17661</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17664 rel="external nofollow noreferrer" target=_blank>#17664</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>如果禁用了<code class=syntax>in_memory_parts_enable_wal</code>, 则不要从 WAL 恢复部件. <a href=https://github.com/ClickHouse/ClickHouse/pull/17802 rel="external nofollow noreferrer" target=_blank>#17802</a> (<a href=https://github.com/detailyang rel="external nofollow noreferrer" target=_blank>detailyang</a>).</li> <li>使用 <code class=syntax>min_compress_block_size</code> 修复 MergeTreeWriterSettings 的 <code class=syntax>max_compress_block_size</code> 的错误初始化. <a href=https://github.com/ClickHouse/ClickHouse/pull/17833 rel="external nofollow noreferrer" target=_blank>#17833</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>有关要删除的最大表大小的异常消息显示不正确. <a href=https://github.com/ClickHouse/ClickHouse/pull/17764 rel="external nofollow noreferrer" target=_blank>#17764</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了插入 <code class=syntax>Distributed</code> 表时空间不足时可能出现的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/17737 rel="external nofollow noreferrer" target=_blank>#17737</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了 ClickHouse 无法恢复与 MySQL 服务器的连接时的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17681 rel="external nofollow noreferrer" target=_blank>#17681</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>当 <code class=syntax>pool_size</code> &gt; 1 时, 由于竞争条件, 在执行 <code class=syntax>ON CLUSTER</code> 查询时, 可能会错误地确定集群是否为循环 (交叉) 复制. 已修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/17640 rel="external nofollow noreferrer" target=_blank>#17640</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>异常 <code class=syntax>fmt::v7::format_error</code> 可以记录在 MergeTree 表的后台. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17613 rel="external nofollow noreferrer" target=_blank>#17613</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17615 rel="external nofollow noreferrer" target=_blank>#17615</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当 clickhouse-client 在交互模式下与多行查询一起使用时, 单行注释被错误地扩展到查询结束. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13654 rel="external nofollow noreferrer" target=_blank>#13654</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17565 rel="external nofollow noreferrer" target=_blank>#17565</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当相应的突变在不同的副本上被杀死时, 修复更改查询挂起. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16953 rel="external nofollow noreferrer" target=_blank>#16953</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17499 rel="external nofollow noreferrer" target=_blank>#17499</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 clickhouse 低估了标记缓存大小的问题. 当有很多带有标记的小文件时可能会发生. <a href=https://github.com/ClickHouse/ClickHouse/pull/17496 rel="external nofollow noreferrer" target=_blank>#17496</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>启用设置 <code class=syntax>optimize_redundant_functions_in_order_by</code> 来修复 <code class=syntax>ORDER BY</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17471 rel="external nofollow noreferrer" target=_blank>#17471</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复 <code class=syntax>DISTINCT</code> 之后由于不正确优化而可能出现的重复项. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17294 rel="external nofollow noreferrer" target=_blank>#17294</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17296 rel="external nofollow noreferrer" target=_blank>#17296</a> (<a href=https://github.com/chengxianglibra rel="external nofollow noreferrer" target=_blank>li chengxiang</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17439 rel="external nofollow noreferrer" target=_blank>#17439</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复从具有 <code class=syntax>LowCardinality</code> 类型的 <code class=syntax>JOIN</code> 表读取时崩溃的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17228 rel="external nofollow noreferrer" target=_blank>#17228</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17397 rel="external nofollow noreferrer" target=_blank>#17397</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 <code class=syntax>toInt256(inf)</code> 堆栈溢出. Int256 是一项实验性功能. 已关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/17235 rel="external nofollow noreferrer" target=_blank>#17235</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17257 rel="external nofollow noreferrer" target=_blank>#17257</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>使用 <code class=syntax>LIMIT</code> 修复分布式查询中可能记录的 <code class=syntax>Unexpected packet Data received from client</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/17254 rel="external nofollow noreferrer" target=_blank>#17254</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复子查询中存在 const 列时设置索引失效的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17246 rel="external nofollow noreferrer" target=_blank>#17246</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17249 rel="external nofollow noreferrer" target=_blank>#17249</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复索引比较类型不同时可能出现的错误索引分析. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17122 rel="external nofollow noreferrer" target=_blank>#17122</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17145 rel="external nofollow noreferrer" target=_blank>#17145</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复 ColumnConst 比较导致崩溃. 这个修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17088 rel="external nofollow noreferrer" target=_blank>#17088</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17135 rel="external nofollow noreferrer" target=_blank>#17135</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>MaterializeMySQL (实验功能) 的多个修复. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16923 rel="external nofollow noreferrer" target=_blank>#16923</a> 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15883 rel="external nofollow noreferrer" target=_blank>#15883</a> 修复 MaterializeMySQL 同步失败时修改 MySQL binlog_checksum. <a href=https://github.com/ClickHouse/ClickHouse/pull/17091 rel="external nofollow noreferrer" target=_blank>#17091</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复非领导者 ReplicatedMergeTree 表的 <code class=syntax>ON CLUSTER</code> 查询可能永远挂起的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/17089 rel="external nofollow noreferrer" target=_blank>#17089</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了在创建 <code class=syntax>some_table</code> 时 <code class=syntax>CREATE TABLE ... AS some_table</code> 查询崩溃 <code class=syntax>AS table_function()</code> 修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/17072 rel="external nofollow noreferrer" target=_blank>#17072</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>功能模糊位的错误未完成的实现, 相关问题: <a href=https://github.com/ClickHouse/ClickHouse/issues/16980 rel="external nofollow noreferrer" target=_blank>#16980</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17051 rel="external nofollow noreferrer" target=_blank>#17051</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>在 CFA 寄存器为 RAX 的情况下修复 LLVM 的 libunwind. 这是 <a href=https://github.com/llvm/llvm-project/tree/master/libunwind rel="external nofollow noreferrer" target=_blank>LLVM's libunwind</a> 中的 <a href="https://bugs.llvm.org/show_bug.cgi?id=48186" rel="external nofollow noreferrer" target=_blank>bug</a> ). 我们已经有针对此错误的解决方法. <a href=https://github.com/ClickHouse/ClickHouse/pull/17046 rel="external nofollow noreferrer" target=_blank>#17046</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>避免远程查询的不必要的网络错误, 这些错误在执行时可能会被取消, 例如使用 <code class=syntax>LIMIT</code> 的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/17006 rel="external nofollow noreferrer" target=_blank>#17006</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复 <code class=syntax>optimize_distributed_group_by_sharding_key</code> 设置 (默认情况下禁用) 以仅使用 OFFSET 进行查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/16996 rel="external nofollow noreferrer" target=_blank>#16996</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了使用 JOIN 在分布式表上合并表的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/16993 rel="external nofollow noreferrer" target=_blank>#16993</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了从 double 转换时大整数 (128、256 位) 的错误结果。 大整数支持是实验性的. <a href=https://github.com/ClickHouse/ClickHouse/pull/16986 rel="external nofollow noreferrer" target=_blank>#16986</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>修复在 <code class=syntax>ALTER TABLE ... MODIFY COLUMN ... NewType</code> 之后可能发生的服务器崩溃, 当 <code class=syntax>SELECT</code> 在更改列上具有 <code class=syntax>WHERE</code> 表达式并且更改尚未完成时. <a href=https://github.com/ClickHouse/ClickHouse/pull/16968 rel="external nofollow noreferrer" target=_blank>#16968</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li><code class=syntax>clickhouse-git-import</code> 中没有正确计算批判信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/16959 rel="external nofollow noreferrer" target=_blank>#16959</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>通过使用单调函数进行优化来修复顺序. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16107 rel="external nofollow noreferrer" target=_blank>#16107</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16956 rel="external nofollow noreferrer" target=_blank>#16956</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>通过启用 <code class=syntax>optimize_aggregators_of_group_by_keys</code> 和 join 设置来修复组的优化. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12604 rel="external nofollow noreferrer" target=_blank>#12604</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16951 rel="external nofollow noreferrer" target=_blank>#16951</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复使用 <code class=syntax>ORDER BY</code> 的查询可能出现的错误 <code class=syntax>Illegal type of argument</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16580 rel="external nofollow noreferrer" target=_blank>#16580</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16928 rel="external nofollow noreferrer" target=_blank>#16928</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 InterpreterShowAccessQuery 中的奇怪代码. <a href=https://github.com/ClickHouse/ClickHouse/pull/16866 rel="external nofollow noreferrer" target=_blank>#16866</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>使用函数 <code class=syntax>timeSeriesGroupSum</code> 时防止clickhouse 服务器崩溃. 该功能已从较新的 ClickHouse 版本中删除. <a href=https://github.com/ClickHouse/ClickHouse/pull/16865 rel="external nofollow noreferrer" target=_blank>#16865</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>当查询分析器打开并且 ClickHouse 安装在操作系统上时, 修复罕见的无声崩溃, glibc 版本已经 (据说) 损坏了某些功能的异步展开表. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15301 rel="external nofollow noreferrer" target=_blank>#15301</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13098 rel="external nofollow noreferrer" target=_blank>#13098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16846 rel="external nofollow noreferrer" target=_blank>#16846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复在不带任何参数的情况下使用 <code class=syntax>any</code> 时的崩溃。 这是针对 <a href=https://github.com/ClickHouse/ClickHouse/issues/16803 rel="external nofollow noreferrer" target=_blank>#16803</a>的 . cc @azat. <a href=https://github.com/ClickHouse/ClickHouse/pull/16826 rel="external nofollow noreferrer" target=_blank>#16826</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>如果在磁盘上写入表元数据时无法分配内存, 则可以写入损坏的元数据文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/16772 rel="external nofollow noreferrer" target=_blank>#16772</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>使用分区谓词修复琐碎的查询优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/16767 rel="external nofollow noreferrer" target=_blank>#16767</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>在启用了 <code class=syntax>transform_null_in</code> 设置的情况下修复多列和元组上的 <code class=syntax>IN</code> 运算符. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15310 rel="external nofollow noreferrer" target=_blank>#15310</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16722 rel="external nofollow noreferrer" target=_blank>#16722</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>通过 MySQL 协议返回 INSERT 查询的受影响行数. 以前 ClickHouse 过去总是返回 0, 现在已修复. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16605 rel="external nofollow noreferrer" target=_blank>#16605</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16715 rel="external nofollow noreferrer" target=_blank>#16715</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复使用 <code class=syntax>if</code> 后缀聚合函数时远程查询失败的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16574 rel="external nofollow noreferrer" target=_blank>#16574</a> Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16231 rel="external nofollow noreferrer" target=_blank>#16231</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/16610 rel="external nofollow noreferrer" target=_blank>#16610</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复由 <code class=syntax>select_sequential_consistency</code> 引起的不一致行为, 用于优化的琐碎计数查询和 system.tables. <a href=https://github.com/ClickHouse/ClickHouse/pull/16309 rel="external nofollow noreferrer" target=_blank>#16309</a> (<a href=https://github.com/haoch rel="external nofollow noreferrer" target=_blank>Hao Chen</a>).</li> </ul> <h4 id=gai-jin>改进<a class=headerlink href=../amp/#gai-jin title="Permanent link"> </a></h4> <ul> <li>删除被 TTL、变异或折叠合并算法修剪后的空部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/16895 rel="external nofollow noreferrer" target=_blank>#16895</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>为分布式表中的异步发送启用紧凑格式的目录: <code class=syntax>use_compact_format_in_distributed_parts_names</code> 默认设置为 1. <a href=https://github.com/ClickHouse/ClickHouse/pull/16788 rel="external nofollow noreferrer" target=_blank>#16788</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果没有数据写入 S3, 则中止分段上传. <a href=https://github.com/ClickHouse/ClickHouse/pull/16840 rel="external nofollow noreferrer" target=_blank>#16840</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>重新解析 <code class=syntax>format_avro_schema_registry_url</code> 的IP. <a href=https://github.com/ClickHouse/ClickHouse/pull/16985 rel="external nofollow noreferrer" target=_blank>#16985</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>在 system.distribution_queue 中的 data_path 中屏蔽密码. <a href=https://github.com/ClickHouse/ClickHouse/pull/16727 rel="external nofollow noreferrer" target=_blank>#16727</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用列转换器替换不存在的列时抛出错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/16183 rel="external nofollow noreferrer" target=_blank>#16183</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>当没有足够的内存供所有线程同时工作时关闭并行解析. 当有人试图插入非常大的行 (&gt; min_chunk_bytes_for_parallel_parsing) 时, 也可能有 <code class=syntax>Memory limit exceeded</code> 之类的例外, 因为要解析的每个部分都必须是独立的一组字符串 (一个或多个). <a href=https://github.com/ClickHouse/ClickHouse/pull/16721 rel="external nofollow noreferrer" target=_blank>#16721</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>安装脚本应始终在 config 文件夹中创建子目录. 这仅与使用自定义配置的 Docker 构建相关. <a href=https://github.com/ClickHouse/ClickHouse/pull/16936 rel="external nofollow noreferrer" target=_blank>#16936</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>纠正 JSONEachRow、JSONCompactEachRow 和 RegexpRow 输入格式的错误消息中的语法. <a href=https://github.com/ClickHouse/ClickHouse/pull/17205 rel="external nofollow noreferrer" target=_blank>#17205</a> (<a href=https://github.com/sneako rel="external nofollow noreferrer" target=_blank>nico piderman</a>).</li> <li>将 <code class=syntax>SOURCE(CLICKHOUSE(...))</code> 的默认 <code class=syntax>host</code> 和 <code class=syntax>port</code> 参数设置为当前实例，并将默认的 <code class=syntax>user</code> 值设置为 <code class=syntax>default</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16997 rel="external nofollow noreferrer" target=_blank>#16997</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> <li>执行<code class=syntax>ATTACH/DETACH TABLE &lt;DICTIONARY&gt;</code> 时抛出信息性错误消息. 在此 PR 之前, <code class=syntax>detach table &lt;dict&gt;</code> 可以工作, 但会导致内存中元数据格式错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/16885 rel="external nofollow noreferrer" target=_blank>#16885</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>添加 cutToFirstSignificantSubdomainWithWWW(). <a href=https://github.com/ClickHouse/ClickHouse/pull/16845 rel="external nofollow noreferrer" target=_blank>#16845</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果给出错误的配置, 服务器拒绝启动并显示异常消息 (缺少<code class=syntax>metric_log</code>.<code class=syntax>collect_interval_milliseconds</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/16815 rel="external nofollow noreferrer" target=_blank>#16815</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>不存在分布式 DDL 配置时更好的异常消息. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5075 rel="external nofollow noreferrer" target=_blank>#5075</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16769 rel="external nofollow noreferrer" target=_blank>#16769</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>可用性改进：当 <code class=syntax>CODEC</code> 表达式在 <code class=syntax>CREATE TABLE</code> 查询中错位时, 在语法错误消息中提供更好的建议. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12493 rel="external nofollow noreferrer" target=_blank>#12493</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16768 rel="external nofollow noreferrer" target=_blank>#16768</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在分布式引擎启动时删除异步插入的空目录. <a href=https://github.com/ClickHouse/ClickHouse/pull/16729 rel="external nofollow noreferrer" target=_blank>#16729</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>将 S3 与 nginx 服务器一起用作代理的解决方法. Nginx 当前不接受像 <code class=syntax>http://domain.com?delete</code> 这样的空路径 url, 但是 vanilla aws-sdk-cpp 会产生这种 url. 此提交使用修补过的 aws-sdk-cpp 版本, 在这种情况下, 它使 url 以 "/" 作为路径, 例如 <code class=syntax>http://domain.com/?delete</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16709 rel="external nofollow noreferrer" target=_blank>#16709</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>允许 <code class=syntax>reinterpretAs*</code> 函数处理相同大小的整数和浮点数. 实现 <a href=https://github.com/ClickHouse/ClickHouse/issues/16640 rel="external nofollow noreferrer" target=_blank>16640</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16657 rel="external nofollow noreferrer" target=_blank>#16657</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>现在，<code class=syntax>&lt;auxiliary_zookeepers&gt;</code> 配置可以在 <code class=syntax>config.xml</code> 中更改并在不启动服务器的情况下重新加载. <a href=https://github.com/ClickHouse/ClickHouse/pull/16627 rel="external nofollow noreferrer" target=_blank>#16627</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>在到远程资源的 https 连接中支持 SNI. 这将允许连接到需要 SNI 的 Cloudflare 服务器. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10055 rel="external nofollow noreferrer" target=_blank>#10055</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16252 rel="external nofollow noreferrer" target=_blank>#16252</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>可以连接到需要 SNI 的 <code class=syntax>clickhouse-server</code> 安全端点. 当 <code class=syntax>clickhouse-server</code> 托管在 TLS 代理之后是可能的. <a href=https://github.com/ClickHouse/ClickHouse/pull/16938 rel="external nofollow noreferrer" target=_blank>#16938</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>如果创建了物化视图循环, 则修复可能的堆栈溢出. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/15732 rel="external nofollow noreferrer" target=_blank>#15732</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16048 rel="external nofollow noreferrer" target=_blank>#16048</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>简化 MergeTree 表引擎系列的后台任务处理的实现. 用户应该没有明显的变化. <a href=https://github.com/ClickHouse/ClickHouse/pull/15983 rel="external nofollow noreferrer" target=_blank>#15983</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>MaterializeMySQL (实验功能) 的改进. 当 MySQL 同步用户有错误权限时抛出关于正确同步权限的异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/15977 rel="external nofollow noreferrer" target=_blank>#15977</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>).</li> <li>使用 BloomFilter 生成 <code class=syntax>indexOf()</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/14977 rel="external nofollow noreferrer" target=_blank>#14977</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>).</li> </ul> <h4 id=xing-neng-gai-jin>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin title="Permanent link"> </a></h4> <ul> <li>使用 Floyd-Rivest 算法, 它是 ClickHouse 部分排序用例的最佳选择. 基准在 <a href=https://github.com/danlark1/miniselect target=_blank>https://github.com/danlark1/miniselect</a> 和 <a href=https://drive.google.com/drive/folders/1DHEaeXgZuX6AJ9eByeZ8iQVQv0ueP8XM rel="external nofollow noreferrer" target=_blank>here</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16825 rel="external nofollow noreferrer" target=_blank>#16825</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>).</li> <li>现在, <code class=syntax>ReplicatedMergeTree</code> 树引擎系列使用单独的线程池进行复制提取. 通过设置“background_fetches_pool_size”限制池的大小, 可以通过服务器重启进行调整. 设置的默认值是 3, 这意味着最大并行提取量等于 3 (允许使用 10G 网络) . 修复 #520. <a href=https://github.com/ClickHouse/ClickHouse/pull/16390 rel="external nofollow noreferrer" target=_blank>#16390</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 <code class=syntax>quantileTDigest</code> 状态的不受控制的增长. <a href=https://github.com/ClickHouse/ClickHouse/pull/16680 rel="external nofollow noreferrer" target=_blank>#16680</a> (<a href=https://github.com/hrissan rel="external nofollow noreferrer" target=_blank>hrissan</a>).</li> <li>将 <code class=syntax>VIEW</code> 子查询描述添加到 <code class=syntax>EXPLAIN</code>. 限制<code class=syntax>VIEW</code>的下推优化. 将 <code class=syntax>Distributed</code> 的本地副本添加到查询计划中. <a href=https://github.com/ClickHouse/ClickHouse/pull/14936 rel="external nofollow noreferrer" target=_blank>#14936</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用 max_threads &gt; 0 和 ORDER BY 中的表达式修复 optimize_read_in_order/optimize_aggregation_in_order. <a href=https://github.com/ClickHouse/ClickHouse/pull/16637 rel="external nofollow noreferrer" target=_blank>#16637</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复从 <code class=syntax>Merge</code> 表读取大量 <code class=syntax>MergeTree</code> 表的性能. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7748 rel="external nofollow noreferrer" target=_blank>#7748</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16988 rel="external nofollow noreferrer" target=_blank>#16988</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>现在我们可以安全地修剪具有精确匹配的分区. 有用的案例: 假设表由 <code class=syntax>intHash64(x) % 100</code> 分区, 并且查询的条件是逐字的, 而不是 x. <a href=https://github.com/ClickHouse/ClickHouse/pull/16253 rel="external nofollow noreferrer" target=_blank>#16253</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> </ul> <h4 id=shi-yan-gong-neng>实验功能<a class=headerlink href=../amp/#shi-yan-gong-neng title="Permanent link"> </a></h4> <ul> <li>添加 <code class=syntax>Embedded RocksDB</code> 表引擎 (可用于字典). <a href=https://github.com/ClickHouse/ClickHouse/pull/15073 rel="external nofollow noreferrer" target=_blank>#15073</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_1>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_1 title="Permanent link"> </a></h4> <ul> <li>测试覆盖率构建图像的改进. <a href=https://github.com/ClickHouse/ClickHouse/pull/17233 rel="external nofollow noreferrer" target=_blank>#17233</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>将嵌入的时区数据更新到 2020d 版 (同时将 cctz 更新到最新的 master). <a href=https://github.com/ClickHouse/ClickHouse/pull/17204 rel="external nofollow noreferrer" target=_blank>#17204</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复 Poco 中的 UBSan 报告. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/12719 rel="external nofollow noreferrer" target=_blank>#12719</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16765 rel="external nofollow noreferrer" target=_blank>#16765</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>不要使用 UBSan 检测第三方库. <a href=https://github.com/ClickHouse/ClickHouse/pull/16764 rel="external nofollow noreferrer" target=_blank>#16764</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复缓存字典中的 UBSan 报告. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/12641 rel="external nofollow noreferrer" target=_blank>#12641</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16763 rel="external nofollow noreferrer" target=_blank>#16763</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在尝试将无限浮点数转换为整数时修复 UBSan 报告. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14190 rel="external nofollow noreferrer" target=_blank>#14190</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16677 rel="external nofollow noreferrer" target=_blank>#16677</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h2 id=clickhouse-ban-ben-20-11>ClickHouse 版本 20.11<a class=headerlink href=../amp/#clickhouse-ban-ben-20-11 title="Permanent link"> </a></h2> <h3 id=clickhouse-ban-ben-v20-11-7-16-stable-2021-03-02>ClickHouse 版本 v20.11.7.16-stable, 2021-03-02<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-11-7-16-stable-2021-03-02 title="Permanent link"> </a></h3> <h4 id=gai-jin_1>改进<a class=headerlink href=../amp/#gai-jin_1 title="Permanent link"> </a></h4> <ul> <li>将 clickhouse 用户和组的 uid / gid 显式设置为 clickhouse-server 图像中的固定值 (101). <a href=https://github.com/ClickHouse/ClickHouse/pull/19096 rel="external nofollow noreferrer" target=_blank>#19096</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> </ul> <h4 id=bug-xiu-fu_3>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_3 title="Permanent link"> </a></h4> <ul> <li>BloomFilter 索引崩溃修复. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/19757 rel="external nofollow noreferrer" target=_blank>#19757</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19884 rel="external nofollow noreferrer" target=_blank>#19884</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>如果启用了 system.text_log, 则可能出现死锁. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/19874 rel="external nofollow noreferrer" target=_blank>#19874</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19875 rel="external nofollow noreferrer" target=_blank>#19875</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在以前的版本中, 函数 arrayEnumerateUniq 的异常参数可能会导致崩溃或无限循环. 这关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/19787 rel="external nofollow noreferrer" target=_blank>#19787</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19788 rel="external nofollow noreferrer" target=_blank>#19788</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了使用算术类型与字符串类型的准确比较时的堆栈溢出. <a href=https://github.com/ClickHouse/ClickHouse/pull/19773 rel="external nofollow noreferrer" target=_blank>#19773</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复 <code class=syntax>bitmapAndnot</code> 函数中的分段错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/19668 rel="external nofollow noreferrer" target=_blank>#19668</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19713 rel="external nofollow noreferrer" target=_blank>#19713</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>一些具有大整数的函数可能会导致段错误. 大整数是实验性功能. 这关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/19667 rel="external nofollow noreferrer" target=_blank>#19667</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19672 rel="external nofollow noreferrer" target=_blank>#19672</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>LowCardinality</code> 参数的 <code class=syntax>neighbor</code> 函数的错误结果. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10333 rel="external nofollow noreferrer" target=_blank>#10333</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19617 rel="external nofollow noreferrer" target=_blank>#19617</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复断开连接后连接中 CompressedWriteBuffer 的 use-after-free. <a href=https://github.com/ClickHouse/ClickHouse/pull/19599 rel="external nofollow noreferrer" target=_blank>#19599</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li><code class=syntax>DROP/DETACH TABLE table ON CLUSTER cluster SYNC</code> 查询可能会挂起, 已修复. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/19568 rel="external nofollow noreferrer" target=_blank>#19568</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19572 rel="external nofollow noreferrer" target=_blank>#19572</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>查询 CREATE DICTIONARY id 表达式修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/19571 rel="external nofollow noreferrer" target=_blank>#19571</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>使用 merge_tree_min_rows_for_concurrent_read/merge_tree_min_bytes_for_concurrent_read=0/UINT64_MAX 修复 SIGSEGV. <a href=https://github.com/ClickHouse/ClickHouse/pull/19528 rel="external nofollow noreferrer" target=_blank>#19528</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果使用专门设计的参数调用 <code class=syntax>addMonth</code> 函数, 则可能会发生缓冲区溢出 (在内存读取时). 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/19441 rel="external nofollow noreferrer" target=_blank>#19441</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/19413 rel="external nofollow noreferrer" target=_blank>#19413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19472 rel="external nofollow noreferrer" target=_blank>#19472</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果文件之一中有空数据块，则将分布式批处理标记为已损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/19449 rel="external nofollow noreferrer" target=_blank>#19449</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复 Uber H3 库中可能的缓冲区溢出. 请参阅 <a href=https://github.com/uber/h3/issues/392 target=_blank>https://github.com/uber/h3/issues/392</a>. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/19219 rel="external nofollow noreferrer" target=_blank>#19219</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19383 rel="external nofollow noreferrer" target=_blank>#19383</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 system.parts _state 列 (查询此列时出现 LOGICAL_ERROR，由于顺序不正确). <a href=https://github.com/ClickHouse/ClickHouse/pull/19346 rel="external nofollow noreferrer" target=_blank>#19346</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复错误 <code class=syntax>Cannot convert column now64() because it is constant but values of constants are different in source and result</code> . 续 <a href=https://github.com/ClickHouse/ClickHouse/issues/7156 rel="external nofollow noreferrer" target=_blank>#7156</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19316 rel="external nofollow noreferrer" target=_blank>#19316</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复在处理 ReplicatedMergeTree 表时并发 <code class=syntax>ALTER</code> 和 <code class=syntax>DROP</code> 查询可能挂起的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/19237 rel="external nofollow noreferrer" target=_blank>#19237</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了从 <code class=syntax>ORC</code> 格式的文件中无限读取的问题 (在 <a href=https://github.com/ClickHouse/ClickHouse/issues/10580 rel="external nofollow noreferrer" target=_blank>#10580</a> 中引入). 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/19095 rel="external nofollow noreferrer" target=_blank>#19095</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19134 rel="external nofollow noreferrer" target=_blank>#19134</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 clickhouse 无法从 <code class=syntax>LowCardinality(Nullable(...))</code> 读取压缩编解码器并抛出异常 <code class=syntax>Attempt to read after EOF</code> 时的启动错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/18340 rel="external nofollow noreferrer" target=_blank>#18340</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19101 rel="external nofollow noreferrer" target=_blank>#19101</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了使用 <code class=syntax>Template</code> 或 <code class=syntax>CustomSeparated</code> 格式通过 http 接口插入数据时出现的 <code class=syntax>There no checkpoint</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/19021 rel="external nofollow noreferrer" target=_blank>#19021</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19072 rel="external nofollow noreferrer" target=_blank>#19072</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>限制对以旧语法创建的 <code class=syntax>MergeTree</code> 表的 <code class=syntax>MODIFY TTL</code> 查询. 之前查询成功了, 但实际上没有效果. <a href=https://github.com/ClickHouse/ClickHouse/pull/19064 rel="external nofollow noreferrer" target=_blank>#19064</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>确保 <code class=syntax>groupUniqArray</code> 为 Enum 类型的参数返回正确的类型. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/17875 rel="external nofollow noreferrer" target=_blank>#17875</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19019 rel="external nofollow noreferrer" target=_blank>#19019</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果将函数 <code class=syntax>ignore</code> 与 <code class=syntax>LowCardinality</code> 参数一起使用, 则修复可能的错误 <code class=syntax>Expected single dictionary argument for function</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14275 rel="external nofollow noreferrer" target=_blank>#14275</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19016 rel="external nofollow noreferrer" target=_blank>#19016</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用 <code class=syntax>TinyLog</code> 引擎修复将 <code class=syntax>LowCardinality</code> 列插入到表中的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/18629 rel="external nofollow noreferrer" target=_blank>#18629</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/19010 rel="external nofollow noreferrer" target=_blank>#19010</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>禁用 <code class=syntax>optimize_move_functions_out_of_any</code> 因为优化并不总是正确的. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/18051 rel="external nofollow noreferrer" target=_blank>#18051</a>. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/18973 rel="external nofollow noreferrer" target=_blank>#18973</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18981 rel="external nofollow noreferrer" target=_blank>#18981</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了非常罕见的关机死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/18977 rel="external nofollow noreferrer" target=_blank>#18977</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复某些转义文本突变时的错误 (例如 <code class=syntax>ALTER ... UPDATE e = CAST('foo', 'Enum8(\'foo\' = 1')</code> 序列化不正确). 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/18878 rel="external nofollow noreferrer" target=_blank>#18878</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18944 rel="external nofollow noreferrer" target=_blank>#18944</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>附加分区应该重置突变. <a href=https://github.com/ClickHouse/ClickHouse/issues/18804 rel="external nofollow noreferrer" target=_blank>#18804</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18935 rel="external nofollow noreferrer" target=_blank>#18935</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>修复 clickhouse-local 关机时可能挂起的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/18891 rel="external nofollow noreferrer" target=_blank>#18891</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18893 rel="external nofollow noreferrer" target=_blank>#18893</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 *If 具有一元函数和 Nullable 类型的组合器. <a href=https://github.com/ClickHouse/ClickHouse/pull/18806 rel="external nofollow noreferrer" target=_blank>#18806</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果设置<code class=syntax>network_compression_method</code>全局设置为非默认值，则服务器可以拒绝异步分布式插入. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/18741 rel="external nofollow noreferrer" target=_blank>#18741</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18776 rel="external nofollow noreferrer" target=_blank>#18776</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在尝试将 <code class=syntax>CAST</code> <code class=syntax>NULL</code> 从 <code class=syntax>Nullable(String)</code> 转换为 <code class=syntax>Nullable(Decimal(P, S))</code> 时的 <code class=syntax>Attempt to read after eof</code> 错误. 现在函数<code class=syntax>CAST</code> 在它不能从可为空的字符串解析十进制时返回<code class=syntax>NULL</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7690 rel="external nofollow noreferrer" target=_blank>#7690</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18718 rel="external nofollow noreferrer" target=_blank>#18718</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>使用不匹配的 arg 大小修复 Logger. <a href=https://github.com/ClickHouse/ClickHouse/pull/18717 rel="external nofollow noreferrer" target=_blank>#18717</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>添加 FixedString 数据类型支持. 将数据从 MySQL 复制到 ClickHouse 时, 我会收到此异常 <code class=syntax>Code: 50, e.displayText() = DB::Exception: Unsupported type FixedString(1)</code> . 此补丁修复了错误 <a href=https://github.com/ClickHouse/ClickHouse/issues/18450 rel="external nofollow noreferrer" target=_blank>#18450</a> 还修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6556 rel="external nofollow noreferrer" target=_blank>#6556</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18553 rel="external nofollow noreferrer" target=_blank>#18553</a> (<a href=https://github.com/awesomeleo rel="external nofollow noreferrer" target=_blank>awesomeleo</a>).</li> <li>在使用 <code class=syntax>RIGHT</code> 或 FULL<code class=syntax>连接进行子查询后使用</code>ORDER BY<code class=syntax>时修复可能的</code>Pipeline stuck` 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/18550 rel="external nofollow noreferrer" target=_blank>#18550</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复在相应的突变杀死后可能导致 <code class=syntax>ALTER</code> 查询挂起的错误. 由线程模糊器发现. <a href=https://github.com/ClickHouse/ClickHouse/pull/18518 rel="external nofollow noreferrer" target=_blank>#18518</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在合并期间禁用AIO写, 因为这可能导致合并期间主键列的数据损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/18481 rel="external nofollow noreferrer" target=_blank>#18481</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>当无法计算结果时, 在分析阶段禁用子查询的常量折叠. <a href=https://github.com/ClickHouse/ClickHouse/pull/18446 rel="external nofollow noreferrer" target=_blank>#18446</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了在使用类型为 Nullable(String) 的参数执行 <code class=syntax>toType(...)</code> 函数 (<code class=syntax>toDate</code>、<code class=syntax>toUInt32</code> 等) 时出现的 <code class=syntax>value is too short</code> 错误. 现在这些函数在解析错误时返回 <code class=syntax>NULL</code> 而不是抛出异常. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7673 rel="external nofollow noreferrer" target=_blank>#7673</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18445 rel="external nofollow noreferrer" target=_blank>#18445</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>限制从宽部分合并到紧凑部分. 在垂直合并的情况下, 它会导致结果部分损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/18381 rel="external nofollow noreferrer" target=_blank>#18381</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复填充表 <code class=syntax>system.settings_profile_elements</code> . 这个 PR 修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/18231 rel="external nofollow noreferrer" target=_blank>#18231</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18379 rel="external nofollow noreferrer" target=_blank>#18379</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复带有常量参数的二元函数的索引分析, 导致错误的查询结果. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/18364 rel="external nofollow noreferrer" target=_blank>#18364</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18373 rel="external nofollow noreferrer" target=_blank>#18373</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>使用组合子 <code class=syntax>Distinct</code> 修复聚合函数中可能的崩溃，同时使用两级聚合. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17682 rel="external nofollow noreferrer" target=_blank>#17682</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18365 rel="external nofollow noreferrer" target=_blank>#18365</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>如果只能从 <code class=syntax>table</code> 中选择任意一列, 现在可以执行 <code class=syntax>SELECT count() FROM table</code> . 此 PR 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10639 rel="external nofollow noreferrer" target=_blank>#10639</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18233 rel="external nofollow noreferrer" target=_blank>#18233</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li><code class=syntax>SELECT JOIN</code> 现在需要对每个连接表的 <code class=syntax>SELECT</code> 权限. 此 PR 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17654 rel="external nofollow noreferrer" target=_blank>#17654</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18232 rel="external nofollow noreferrer" target=_blank>#18232</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复在读取退避的情况下从 <code class=syntax>MergeTree*</code> 读取时可能不完整的查询结果 (消息`<debug> MergeTreeReadPool: Will lower number of threads in logs). 在 <a href=https://github.com/ClickHouse/ClickHouse/issues/16423 rel="external nofollow noreferrer" target=_blank>#16423</a> 中引入. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/18137 rel="external nofollow noreferrer" target=_blank>#18137</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18216 rel="external nofollow noreferrer" target=_blank>#18216</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</debug></li> <li>修复查询 <code class=syntax>MODIFY COLUMN ... REMOVE TTL</code> 并没有真正删除列 TTL 时的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/18130 rel="external nofollow noreferrer" target=_blank>#18130</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>使用谓词优化器修复不确定函数. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17244 rel="external nofollow noreferrer" target=_blank>#17244</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17273 rel="external nofollow noreferrer" target=_blank>#17273</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Mutation 可能会在 <code class=syntax>MOVE</code> 或 <code class=syntax>REPLACE PARTITION</code> 之后等待一些不存在的部分, 或者在极少数情况下, 在 <code class=syntax>DETACH</code> 或 <code class=syntax>DROP PARTITION</code> 之后挂起. 是固定的. <a href=https://github.com/ClickHouse/ClickHouse/pull/15537 rel="external nofollow noreferrer" target=_blank>#15537</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_2>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_2 title="Permanent link"> </a></h4> <ul> <li>将时区信息更新为 2020e. <a href=https://github.com/ClickHouse/ClickHouse/pull/18531 rel="external nofollow noreferrer" target=_blank>#18531</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-11-6-6-stable-2020-12-24>ClickHouse 版本 v20.11.6.6-stable, 2020-12-24<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-11-6-6-stable-2020-12-24 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_4>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_4 title="Permanent link"> </a></h4> <ul> <li>修复了在具有双 <code class=syntax>IPv4/IPv6 stack</code> 的机器上的服务器无法访问 <code class=syntax>clickhouse-odbc-bridge</code> 进程时的问题, 并修复了使用格式错误的查询执行 ODBC 字典更新和/或导致崩溃时的问题. 这可能会关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14489 rel="external nofollow noreferrer" target=_blank>#14489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18278 rel="external nofollow noreferrer" target=_blank>#18278</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>修复了 Enum 和 Int 类型之间的键比较. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17989 rel="external nofollow noreferrer" target=_blank>#17989</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18214 rel="external nofollow noreferrer" target=_blank>#18214</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了 <code class=syntax>MaterializeMySQL</code> 数据库引擎中唯一键转换崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/18186 rel="external nofollow noreferrer" target=_blank>#18186</a> 并修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16372 rel="external nofollow noreferrer" target=_blank>#16372</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/18211 rel="external nofollow noreferrer" target=_blank>#18211</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了 S3 URL 解析中的 <code class=syntax>std::out_of_range: basic_string</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18059 rel="external nofollow noreferrer" target=_blank>#18059</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>修复了由于 MaterializeMySQL 不支持转换 MySQL 前缀索引而导致某些表无法从 MySQL 同步到 ClickHouse 的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15187 rel="external nofollow noreferrer" target=_blank>#15187</a> 并修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17912 rel="external nofollow noreferrer" target=_blank>#17912</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/17944 rel="external nofollow noreferrer" target=_blank>#17944</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了查询包含<code class=syntax>ARRAY JOIN</code>时查询优化产生错误结果的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17887 rel="external nofollow noreferrer" target=_blank>#17887</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>修复 <code class=syntax>topK</code> 聚合函数中可能出现的段错误. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/17404 rel="external nofollow noreferrer" target=_blank>#17404</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17845 rel="external nofollow noreferrer" target=_blank>#17845</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>如果禁用了<code class=syntax>in_memory_parts_enable_wal</code>, 则不要从 WAL 恢复部件. <a href=https://github.com/ClickHouse/ClickHouse/pull/17802 rel="external nofollow noreferrer" target=_blank>#17802</a> (<a href=https://github.com/detailyang rel="external nofollow noreferrer" target=_blank>detailyang</a>).</li> <li>修复了 ClickHouse 无法恢复与 MySQL 服务器的连接时的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17681 rel="external nofollow noreferrer" target=_blank>#17681</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>修复了 <code class=syntax>optimize_trivial_count_query</code> 与分区谓词不一致的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/17644 rel="external nofollow noreferrer" target=_blank>#17644</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了服务器在守护进程模式下运行时空的 <code class=syntax>system.stack_trace</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/17630 rel="external nofollow noreferrer" target=_blank>#17630</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了当 xxception <code class=syntax>fmt::v7::format_error</code> 可以登录到 MergeTree 表的后台时的行为. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17613 rel="external nofollow noreferrer" target=_blank>#17613</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17615 rel="external nofollow noreferrer" target=_blank>#17615</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 clickhouse-client 在交互模式下使用多行查询和单行注释错误地扩展到查询结束时的行为. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13654 rel="external nofollow noreferrer" target=_blank>#13654</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17565 rel="external nofollow noreferrer" target=_blank>#17565</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了服务器在极少数情况下停止接受连接的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17542 rel="external nofollow noreferrer" target=_blank>#17542</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在不同副本上杀死相应突变时更改查询挂起的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16953 rel="external nofollow noreferrer" target=_blank>#16953</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17499 rel="external nofollow noreferrer" target=_blank>#17499</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 clickhouse 低估标记缓存大小时的错误. 当有很多带有标记的小文件时可能会发生. <a href=https://github.com/ClickHouse/ClickHouse/pull/17496 rel="external nofollow noreferrer" target=_blank>#17496</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了启用设置 <code class=syntax>optimize_redundant_functions_in_order_by</code> 的 <code class=syntax>ORDER BY</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17471 rel="external nofollow noreferrer" target=_blank>#17471</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 <code class=syntax>DISTINCT</code> 之后由于不正确优化而可能出现的重复项. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17294 rel="external nofollow noreferrer" target=_blank>#17294</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17296 rel="external nofollow noreferrer" target=_blank>#17296</a> (<a href=https://github.com/chengxianglibra rel="external nofollow noreferrer" target=_blank>li chengxiang</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17439 rel="external nofollow noreferrer" target=_blank>#17439</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了从具有 <code class=syntax>LowCardinality</code> 类型的 <code class=syntax>JOIN</code> 表读取时崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17228 rel="external nofollow noreferrer" target=_blank>#17228</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17397 rel="external nofollow noreferrer" target=_blank>#17397</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了子查询中有 const 列时设置索引失效的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17246 rel="external nofollow noreferrer" target=_blank>#17246</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17249 rel="external nofollow noreferrer" target=_blank>#17249</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复索引比较类型不同时可能出现的错误索引分析. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17122 rel="external nofollow noreferrer" target=_blank>#17122</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17145 rel="external nofollow noreferrer" target=_blank>#17145</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了 <code class=syntax>ColumnConst</code> 比较导致崩溃. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17088 rel="external nofollow noreferrer" target=_blank>#17088</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/17135 rel="external nofollow noreferrer" target=_blank>#17135</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了非领导者 <code class=syntax>ReplicatedMergeTreeTables</code> 的 <code class=syntax>ON CLUSTER</code> 查询可能永远挂起的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/17089 rel="external nofollow noreferrer" target=_blank>#17089</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了函数 <code class=syntax>fuzz Bits</code> 中模糊器发现的错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16980 rel="external nofollow noreferrer" target=_blank>#16980</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17051 rel="external nofollow noreferrer" target=_blank>#17051</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>避免远程查询的不必要的网络错误, 这些错误在执行时可能会被取消, 例如使用 <code class=syntax>LIMIT</code> 的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/17006 rel="external nofollow noreferrer" target=_blank>#17006</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了从 double 转换时大整数 (128、256 位) 的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/16986 rel="external nofollow noreferrer" target=_blank>#16986</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>出现错误时解析 <code class=syntax>format_avro_schema_registry_url</code> 的IP. <a href=https://github.com/ClickHouse/ClickHouse/pull/16985 rel="external nofollow noreferrer" target=_blank>#16985</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复了在 <code class=syntax>ALTER TABLE ... MODIFY COLUMN ... NewType</code> 之后, 当 <code class=syntax>SELECT</code> 在更改列上具有 <code class=syntax>WHERE</code> 表达式并且更改尚未完成时可能出现的服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/16968 rel="external nofollow noreferrer" target=_blank>#16968</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li><code class=syntax>clickhouse-git-import</code> 中没有正确计算批判信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/16959 rel="external nofollow noreferrer" target=_blank>#16959</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>通过单调函数优化来固定顺序. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16107 rel="external nofollow noreferrer" target=_blank>#16107</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16956 rel="external nofollow noreferrer" target=_blank>#16956</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了启用设置 <code class=syntax>optimize_aggregators_of_group_by_keys</code> 和 joins 的 group by 优化. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12604 rel="external nofollow noreferrer" target=_blank>#12604</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16951 rel="external nofollow noreferrer" target=_blank>#16951</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>安装脚本应始终在 config 文件夹中创建子目录. 这仅与使用自定义配置的 Docker 构建相关. <a href=https://github.com/ClickHouse/ClickHouse/pull/16936 rel="external nofollow noreferrer" target=_blank>#16936</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复了使用 <code class=syntax>ORDER BY</code> 的查询可能出现的错误 <code class=syntax>Illegal type of argument</code> . 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16580 rel="external nofollow noreferrer" target=_blank>#16580</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16928 rel="external nofollow noreferrer" target=_blank>#16928</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>如果没有数据写入 WriteBufferFromS3, 则中止分段上传. <a href=https://github.com/ClickHouse/ClickHouse/pull/16840 rel="external nofollow noreferrer" target=_blank>#16840</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>修复了在不带任何参数的情况下使用 <code class=syntax>any</code> 时崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16803 rel="external nofollow noreferrer" target=_blank>#16803</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16826 rel="external nofollow noreferrer" target=_blank>#16826</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了 ClickHouse 过去总是返回 0 而不是通过 MySQL 协议进行 <code class=syntax>INSERT</code> 查询的受影响行数时的行为. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16605 rel="external nofollow noreferrer" target=_blank>#16605</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16715 rel="external nofollow noreferrer" target=_blank>#16715</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了 TDigest 不受控制的增长. <a href=https://github.com/ClickHouse/ClickHouse/pull/16680 rel="external nofollow noreferrer" target=_blank>#16680</a> (<a href=https://github.com/hrissan rel="external nofollow noreferrer" target=_blank>hrissan</a>).</li> <li>修复了在 Aggregate 函数中使用后缀 <code class=syntax>if</code> 时远程查询失败的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16574 rel="external nofollow noreferrer" target=_blank>#16574</a> fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16231 rel="external nofollow noreferrer" target=_blank>#16231</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/16610 rel="external nofollow noreferrer" target=_blank>#16610</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了由 <code class=syntax>select_sequential_consistency</code> 导致优化的琐碎计数查询和 system.tables 的不一致行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/16309 rel="external nofollow noreferrer" target=_blank>#16309</a> (<a href=https://github.com/haoch rel="external nofollow noreferrer" target=_blank>Hao Chen</a>).</li> <li>使用 ColumnTransformer 替换不存在的列时抛出错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/16183 rel="external nofollow noreferrer" target=_blank>#16183</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-11-3-3-stable-2020-11-13>ClickHouse 版本 v20.11.3.3-stable, 2020-11-13<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-11-3-3-stable-2020-11-13 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_5>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_5 title="Permanent link"> </a></h4> <ul> <li>当查询分析器打开并且 ClickHouse 安装在操作系统上时, 修复罕见的无声崩溃, glibc 版本已经 (据说) 损坏了某些功能的异步展开表. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15301 rel="external nofollow noreferrer" target=_blank>#15301</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13098 rel="external nofollow noreferrer" target=_blank>#13098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16846 rel="external nofollow noreferrer" target=_blank>#16846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-11-2-1-2020-11-11>ClickHouse 版本 v20.11.2.1, 2020-11-11<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-11-2-1-2020-11-11 title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng_1>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng_1 title="Permanent link"> </a></h4> <ul> <li>如果在 <code class=syntax>distributed_ddl</code> 配置部分指定了一些 <code class=syntax>profile</code>, 那么这个配置文件可以在服务器启动时覆盖 <code class=syntax>default</code> 配置文件的设置. 已修复, 现在分布式 DDL 查询的设置不应影响全局服务器设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/16635 rel="external nofollow noreferrer" target=_blank>#16635</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>限制在键 (排序键、主键、分区键等) 中使用不可比较的数据类型 (如 <code class=syntax>AggregateFunction</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/16601 rel="external nofollow noreferrer" target=_blank>#16601</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>删除 <code class=syntax>ANALYZE</code> 和 <code class=syntax>AST</code> 查询，并使设置 <code class=syntax>enable_debug_queries</code> 过时, 因为它现在是全功能 <code class=syntax>EXPLAIN</code> 查询的一部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/16536 rel="external nofollow noreferrer" target=_blank>#16536</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>聚合函数 <code class=syntax>boundingRatio</code>、<code class=syntax>rankCorr</code>、<code class=syntax>retention</code>、<code class=syntax>timeSeriesGroupSum</code>、<code class=syntax>timeSeriesGroupRateSum</code>、<code class=syntax>windowFunnel</code> 被错误地设为不区分大小写. 现在他们的名字按照设计区分大小写. 只有在 SQL 标准中指定的函数或为了与其他 DBMS 兼容而制作的函数或与这些函数类似的函数才应不区分大小写. <a href=https://github.com/ClickHouse/ClickHouse/pull/16407 rel="external nofollow noreferrer" target=_blank>#16407</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>使 <code class=syntax>rankCorr</code> 函数在数据不足时返回 nan <a href=https://github.com/ClickHouse/ClickHouse/issues/16124 rel="external nofollow noreferrer" target=_blank>#16124</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16135 rel="external nofollow noreferrer" target=_blank>#16135</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>从20.5以上的版本升级时, 如果进行滚动更新, 集群同时包含20.5以上和20.5以下的版本, 如果旧版本的ClickHouse节点重启, 旧版本在新版本存在的情况下启动, 可能会导致 到 <code class=syntax>Part ... intersects previous part</code> 错误. 为防止出现此错误, 首先在所有集群节点上安装更新的 clickhouse-server 软件包, 然后重新启动 (因此，当 clickhouse-server 重新启动时, 它将以新版本启动).</li> </ul> <h4 id=xin-te-zheng_1>新特征<a class=headerlink href=../amp/#xin-te-zheng_1 title="Permanent link"> </a></h4> <ul> <li>添加了对 LDAP 作为本地不存在用户的用户目录的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/12736 rel="external nofollow noreferrer" target=_blank>#12736</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>添加 <code class=syntax>system.replicated_fetches</code> 表, 显示当前正在运行的后台提取. <a href=https://github.com/ClickHouse/ClickHouse/pull/16428 rel="external nofollow noreferrer" target=_blank>#16428</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>添加设置<code class=syntax>date_time_output_format</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15845 rel="external nofollow noreferrer" target=_blank>#15845</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>为 ClickHouse 添加了最小的 Web UI. <a href=https://github.com/ClickHouse/ClickHouse/pull/16158 rel="external nofollow noreferrer" target=_blank>#16158</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>允许一次读/写单个 protobuf 消息 (无长度分隔符). <a href=https://github.com/ClickHouse/ClickHouse/pull/15199 rel="external nofollow noreferrer" target=_blank>#15199</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>添加了初始 OpenTelemetry 支持. ClickHouse 现在通过 Native 和 HTTP 协议接受 OpenTelemetry traceparent 标头, 并在某些情况下向下游传递它们. 执行查询的跟踪跨度保存到 <code class=syntax>system.opentelemetry_span_log</code> 表中. <a href=https://github.com/ClickHouse/ClickHouse/pull/14195 rel="external nofollow noreferrer" target=_blank>#14195</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>允许在 <code class=syntax>CREATE TABLE</code> 查询的列列表中指定主键. 这是与其他 SQL 方言兼容所必需的. <a href=https://github.com/ClickHouse/ClickHouse/pull/15823 rel="external nofollow noreferrer" target=_blank>#15823</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>实现 <code class=syntax>OFFSET offset_row_count {ROW | ROWS} FETCH {FIRST | NEXT} fetch_row_count {ROW | ROWS} {ONLY | WITH TIES}</code> 在带有 ORDER BY 的 SELECT 查询中. 这是指定 <code class=syntax>LIMIT</code> 的SQL标准方式. <a href=https://github.com/ClickHouse/ClickHouse/pull/15855 rel="external nofollow noreferrer" target=_blank>#15855</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li><code class=syntax>errorCodeToName</code> 函数 - 返回错误的变量名称 (用于分析 query_log 和类似的). <code class=syntax>system.errors</code> 表 - 显示错误发生的次数 (包括 <code class=syntax>system_events_show_zero_values</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/16438 rel="external nofollow noreferrer" target=_blank>#16438</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加了函数 <code class=syntax>untuple</code>, 这是一个特殊的函数, 它可以通过扩展命名元组将新列引入到 SELECT 列表中. <a href=https://github.com/ClickHouse/ClickHouse/pull/16242 rel="external nofollow noreferrer" target=_blank>#16242</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>, <a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>现在我们可以通过查询参数提供标识符. 并且这些参数可以用作表对象或列. <a href=https://github.com/ClickHouse/ClickHouse/pull/16594 rel="external nofollow noreferrer" target=_blank>#16594</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>为 MergeTree BloomFilter 索引添加了大整数 (UInt256、Int128、Int256)和 UUID 数据类型支持. 大整数是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/16642 rel="external nofollow noreferrer" target=_blank>#16642</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>添加 <code class=syntax>farmFingerprint64</code> 函数 (非加密字符串散列). <a href=https://github.com/ClickHouse/ClickHouse/pull/16570 rel="external nofollow noreferrer" target=_blank>#16570</a> (<a href=https://github.com/JacobHayes rel="external nofollow noreferrer" target=_blank>Jacob Hayes</a>).</li> <li>添加 <code class=syntax>log_queries_min_query_duration_ms</code>, 只有比这个设置的值慢的查询才会转到 <code class=syntax>query_log</code>/<code class=syntax>query_thread_log</code> (例如mysql中的 <code class=syntax>slow_query_log</code> ). <a href=https://github.com/ClickHouse/ClickHouse/pull/16529 rel="external nofollow noreferrer" target=_blank>#16529</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>能够在 <code class=syntax>Alpine</code> 的顶部创建一个 docker 图像. 使用来自 ubuntu 20.04 的预编译二进制和 glibc 组件. <a href=https://github.com/ClickHouse/ClickHouse/pull/16479 rel="external nofollow noreferrer" target=_blank>#16479</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>添加了 <code class=syntax>toUUIDOrNull</code>、<code class=syntax>toUUIDOrZero</code> 转换函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/16337 rel="external nofollow noreferrer" target=_blank>#16337</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>添加 <code class=syntax>max_concurrent_queries_for_all_users</code> 设置, 用例见 <a href=https://github.com/ClickHouse/ClickHouse/issues/6636 rel="external nofollow noreferrer" target=_blank>#6636</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16154 rel="external nofollow noreferrer" target=_blank>#16154</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> <li>向 clickhouse-client 添加一个新选项 <code class=syntax>print_query_id</code>. 它有助于使用客户端生成的当前查询 ID 生成任意字符串. 默认情况下还会在 clickhouse-client 中打印查询 ID. <a href=https://github.com/ClickHouse/ClickHouse/pull/15809 rel="external nofollow noreferrer" target=_blank>#15809</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>添加 <code class=syntax>tid</code> 和 <code class=syntax>logTrace</code> 函数. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/9434 rel="external nofollow noreferrer" target=_blank>#9434</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15803 rel="external nofollow noreferrer" target=_blank>#15803</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>添加函数 <code class=syntax>formatReadableTimeDelta</code>, 将时间增量格式化为人类可读的字符串... <a href=https://github.com/ClickHouse/ClickHouse/pull/15497 rel="external nofollow noreferrer" target=_blank>#15497</a> (<a href=https://github.com/filipecaixeta rel="external nofollow noreferrer" target=_blank>Filipe Caixeta</a>).</li> <li>在多磁盘配置中为卷添加了 <code class=syntax>disable_merges</code> 选项. <a href=https://github.com/ClickHouse/ClickHouse/pull/13956 rel="external nofollow noreferrer" target=_blank>#13956</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> </ul> <h4 id=shi-yan-gong-neng_1>实验功能<a class=headerlink href=../amp/#shi-yan-gong-neng_1 title="Permanent link"> </a></h4> <ul> <li>新函数 <code class=syntax>encrypt</code>、<code class=syntax>aes_encrypt_mysql</code>、<code class=syntax>decrypt</code>、<code class=syntax>aes_decrypt_mysql</code>. 这些功能运行缓慢, 因此我们将其视为实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/11844 rel="external nofollow noreferrer" target=_blank>#11844</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> </ul> <h4 id=bug-xiu-fu_6>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_6 title="Permanent link"> </a></h4> <ul> <li>在 <code class=syntax>system.distribution_queue</code> 中的data_path中屏蔽密码. <a href=https://github.com/ClickHouse/ClickHouse/pull/16727 rel="external nofollow noreferrer" target=_blank>#16727</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>在启用了 <code class=syntax>transform_null_in</code> 设置的情况下修复多个列和元组上的 <code class=syntax>IN</code> 运算符. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15310 rel="external nofollow noreferrer" target=_blank>#15310</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16722 rel="external nofollow noreferrer" target=_blank>#16722</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>如果查询的表没有采样, 设置 <code class=syntax>max_parallel_replicas</code> 将无法正常工作. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5733 rel="external nofollow noreferrer" target=_blank>#5733</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16675 rel="external nofollow noreferrer" target=_blank>#16675</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>使用 max_threads &gt; 0 和 ORDER BY 中的表达式修复 optimize_read_in_order/optimize_aggregation_in_order. <a href=https://github.com/ClickHouse/ClickHouse/pull/16637 rel="external nofollow noreferrer" target=_blank>#16637</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li><code class=syntax>DEFAULT</code> 表达式的计算涉及可能的名称冲突 (这是不太可能遇到的). 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9359 rel="external nofollow noreferrer" target=_blank>#9359</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16612 rel="external nofollow noreferrer" target=_blank>#16612</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>query_thread_log.query_duration_ms</code> 单元. <a href=https://github.com/ClickHouse/ClickHouse/pull/16563 rel="external nofollow noreferrer" target=_blank>#16563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复使用 MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine 时的错误. <code class=syntax>MaterializeMySQL</code> 是一个实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/16504 rel="external nofollow noreferrer" target=_blank>#16504</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>).</li> <li>带有 <code class=syntax>Decimal</code> 的 <code class=syntax>round</code> 函数的特别设计参数导致整数除以零. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13338 rel="external nofollow noreferrer" target=_blank>#13338</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16451 rel="external nofollow noreferrer" target=_blank>#16451</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复分布式的 DROP TABLE (使用 INSERT). <a href=https://github.com/ClickHouse/ClickHouse/pull/16409 rel="external nofollow noreferrer" target=_blank>#16409</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复复制队列中非常大的条目的处理. 如果表结构非常大 (接近 1 MB), 则非常大的条目可能会出现在 ALTER 查询中. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16307 rel="external nofollow noreferrer" target=_blank>#16307</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16332 rel="external nofollow noreferrer" target=_blank>#16332</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了由于未创建过滤集而可能删除部分返回数据时的不一致行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/16308 rel="external nofollow noreferrer" target=_blank>#16308</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复 sharding_key 中的 dictGet (以及类似的地方, 即当函数上下文被永久存储时). <a href=https://github.com/ClickHouse/ClickHouse/pull/16205 rel="external nofollow noreferrer" target=_blank>#16205</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复尝试执行 <code class=syntax>OPTIMIZE</code> 命令时在 <code class=syntax>clickhouse-local</code> 中抛出的异常. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16076 rel="external nofollow noreferrer" target=_blank>#16076</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16192 rel="external nofollow noreferrer" target=_blank>#16192</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15780 rel="external nofollow noreferrer" target=_blank>#15780</a> 回归, 例如 <code class=syntax>indexOf([1, 2, 3], toLowCardinality(1))</code> 现在被禁止, 但不应该. <a href=https://github.com/ClickHouse/ClickHouse/pull/16038 rel="external nofollow noreferrer" target=_blank>#16038</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>修复 MySQL 数据库的错误. 当用作数据库引擎的 MySQL 服务器关闭时, 某些查询会引发异常, 因为它们试图从禁用的服务器获取表, 而这是不必要的. 例如, 查询 <code class=syntax>SELECT ... FROM system.parts</code> 应该只适用于 MergeTree 表并且根本不要接触 MySQL 数据库. <a href=https://github.com/ClickHouse/ClickHouse/pull/16032 rel="external nofollow noreferrer" target=_blank>#16032</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>现在, 当 <code class=syntax>ALTER MODIFY COLUMN ... DEFAULT ...</code> 与列类型的默认值不兼容时, 将抛出异常. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15854 rel="external nofollow noreferrer" target=_blank>#15854</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15858 rel="external nofollow noreferrer" target=_blank>#15858</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 IPv4CIDRToRange/IPv6CIDRToRange 函数以接受常量 IP 列值. <a href=https://github.com/ClickHouse/ClickHouse/pull/15856 rel="external nofollow noreferrer" target=_blank>#15856</a> (<a href=https://github.com/vladimir-golovchenko rel="external nofollow noreferrer" target=_blank>vladimir-golovchenko</a>).</li> </ul> <h4 id=gai-jin_2>改进<a class=headerlink href=../amp/#gai-jin_2 title="Permanent link"> </a></h4> <ul> <li>将 <code class=syntax>INTERVAL '1 hours'</code> 视为等同于 <code class=syntax>INTERVAL 1 HOUR</code>, 以与 Postgres 和类似的兼容. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15637 rel="external nofollow noreferrer" target=_blank>#15637</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15978 rel="external nofollow noreferrer" target=_blank>#15978</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>启用通过 CSV、TSV 和 JSON 输入格式的数字 ID 解析枚举值. <a href=https://github.com/ClickHouse/ClickHouse/pull/15685 rel="external nofollow noreferrer" target=_blank>#15685</a> (<a href=https://github.com/vivarum rel="external nofollow noreferrer" target=_blank>vivarum</a>).</li> <li>更好地为 JBOD 架构和 <code class=syntax>MergeTree</code> 存储安排读取任务. 新设置 <code class=syntax>read_backoff_min_concurrency</code> 作为读取线程数的下限. <a href=https://github.com/ClickHouse/ClickHouse/pull/16423 rel="external nofollow noreferrer" target=_blank>#16423</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>在 <code class=syntax>Avro</code> 格式中添加对 <code class=syntax>LowCardinality</code> 的缺失支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/16521 rel="external nofollow noreferrer" target=_blank>#16521</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>将 <code class=syntax>S3</code> 与 nginx 服务器一起用作代理的解决方法. Nginx 当前不接受像 <code class=syntax>http://domain.com?delete</code> 这样的空路径 url, 但是 vanilla aws-sdk-cpp 会产生这种 url. 此提交使用修补过的 aws-sdk-cpp 版本, 在这种情况下, 它使 url 以"/"作为路径, 例如 <code class=syntax>http://domain.com/?delete</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16814 rel="external nofollow noreferrer" target=_blank>#16814</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>更好地诊断输入数据中的解析错误. 在 <code class=syntax>Cannot read all data</code> 错误上提供行号. <a href=https://github.com/ClickHouse/ClickHouse/pull/16644 rel="external nofollow noreferrer" target=_blank>#16644</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>使 <code class=syntax>mind Map</code> 和<code class=syntax>maxMap</code> 的行为更加可取. 它不会在结果中跳过零值. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16087 rel="external nofollow noreferrer" target=_blank>#16087</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16631 rel="external nofollow noreferrer" target=_blank>#16631</a> (<a href=https://github.com/ildus rel="external nofollow noreferrer" target=_blank>Ildus Kurbangaliev</a>).</li> <li>在运行时更好地更新 ZooKeeper 配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/16630 rel="external nofollow noreferrer" target=_blank>#16630</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>尽早应用 SETTINGS 子句. 它允许修改查询中的更多设置. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/3178 rel="external nofollow noreferrer" target=_blank>#3178</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16619 rel="external nofollow noreferrer" target=_blank>#16619</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在 <code class=syntax>event_time_microseconds</code> 字段存储在 Decimal64 中, 而不是 UInt64. <a href=https://github.com/ClickHouse/ClickHouse/pull/16617 rel="external nofollow noreferrer" target=_blank>#16617</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>现在可以在<code class=syntax>APPLY</code>列转换器中使用参数化函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/16589 rel="external nofollow noreferrer" target=_blank>#16589</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>改进后台任务的调度, 该任务删除 <code class=syntax>Atomic</code> 数据库中已删除表的数据. 如果表实际上没有数据目录, <code class=syntax>Atomic</code> 数据库不会创建到表数据目录的损坏符号链接. <a href=https://github.com/ClickHouse/ClickHouse/pull/16584 rel="external nofollow noreferrer" target=_blank>#16584</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li><code class=syntax>WITH</code> 部分 (CTE) 中的子查询可以通过名称引用 <code class=syntax>WITH</code> 部分中先前的子查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/16575 rel="external nofollow noreferrer" target=_blank>#16575</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>将 current_database 添加到 <code class=syntax>system.query_thread_log</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16558 rel="external nofollow noreferrer" target=_blank>#16558</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>允许将当前实例中已经提交或过时的部分提取到分离目录中. 当从另一个集群迁移表并具有 N 到 1 个分片映射时, 它很有用. 它也与当前的 fetchPartition 实现一致. <a href=https://github.com/ClickHouse/ClickHouse/pull/16538 rel="external nofollow noreferrer" target=_blank>#16538</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li><code class=syntax>RabbitMQ</code> 的多项改进: 修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16263 rel="external nofollow noreferrer" target=_blank>#16263</a> 的错误. 还最小化了事件循环生命周期. 添加了更高效的队列设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/16426 rel="external nofollow noreferrer" target=_blank>#16426</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>修复 <code class=syntax>quantileDeterministic</code> 函数中的调试断言. 在以前的版本中, 它还可以通过网络传输多达两倍的数据. 虽然不存在错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15683 rel="external nofollow noreferrer" target=_blank>#15683</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16410 rel="external nofollow noreferrer" target=_blank>#16410</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加 <code class=syntax>TablesToDropQueueSize</code> 指标. 它等于正在等待后台数据删除的已删除表的数量. <a href=https://github.com/ClickHouse/ClickHouse/pull/16364 rel="external nofollow noreferrer" target=_blank>#16364</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>当客户端断开连接时更好的诊断. 在以前的版本中, 服务器中记录了 <code class=syntax>Attempt to read after EOF</code> 和 <code class=syntax>Broken pipe</code> 异常. 在新版本中, 它的信息消息 <code class=syntax>Client has dropped the connection, cancel the query.</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16329 rel="external nofollow noreferrer" target=_blank>#16329</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>为 Set/Join 表引擎添加 total_rows/total_bytes (来自 system.tables) 支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/16306 rel="external nofollow noreferrer" target=_blank>#16306</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>现在可以为 MergeTree 表引擎系列指定没有 <code class=syntax>ORDER BY</code> 的 <code class=syntax>PRIMARY KEY</code>. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/15591 rel="external nofollow noreferrer" target=_blank>#15591</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16284 rel="external nofollow noreferrer" target=_blank>#16284</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>如果系统中没有 tmp 文件夹 (chroot、错误配置等) <code class=syntax>clickhouse-local</code> 将在当前目录中创建临时子文件夹. <a href=https://github.com/ClickHouse/ClickHouse/pull/16280 rel="external nofollow noreferrer" target=_blank>#16280</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>添加对嵌套数据类型 (如命名元组) 作为子类型的支持. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15587 rel="external nofollow noreferrer" target=_blank>#15587</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16262 rel="external nofollow noreferrer" target=_blank>#16262</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>支持<code class=syntax>database_atomic_wait_for_drop_and_detach_synchronously</code>/<code class=syntax>NO DELAY</code>/<code class=syntax>SYNC</code> for <code class=syntax>DROP DATABASE</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16127 rel="external nofollow noreferrer" target=_blank>#16127</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加 <code class=syntax>allow_nondeterministic_optimize_skip_unused_shards</code> (允许在分片键中使用非确定性，如 <code class=syntax>rand()</code> 或 <code class=syntax>dictGet()</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/16105 rel="external nofollow noreferrer" target=_blank>#16105</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复 <code class=syntax>memory_profiler_step</code>/<code class=syntax>max_untracked_memory</code> 以通过 HTTP 进行查询 (包括测试). 修复在 xml 配置中全局调整此值也无济于事的问题, 因为这些设置无论如何都不会应用, 只有默认 (4MB) 值是 <a href="https://github.com/ClickHouse/ClickHouse/blob/17731245336d8c84f75e4c0894c5797ed7732190 /src/Common/ThreadStatus.h#L104" rel="external nofollow noreferrer" target=_blank>used</a>. 修复 http 查询最根 ThreadStatus 的 <code class=syntax>query_id</code> (通过在读取 query_id 后初始化 QueryScope). <a href=https://github.com/ClickHouse/ClickHouse/pull/16101 rel="external nofollow noreferrer" target=_blank>#16101</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>现在, 无论集群配置中的 <code class=syntax>&lt;internal_replication&gt;</code> 设置如何，都可以执行 <code class=syntax>ALTER ... ON CLUSTER</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/16075 rel="external nofollow noreferrer" target=_blank>#16075</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 <code class=syntax>clickhouse-client</code> 可能因加载建议而在退出时中止的罕见问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16035 rel="external nofollow noreferrer" target=_blank>#16035</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16047 rel="external nofollow noreferrer" target=_blank>#16047</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>为具有复杂键的 <code class=syntax>Redis</code> 字典添加 <code class=syntax>cache</code> 布局支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/15985 rel="external nofollow noreferrer" target=_blank>#15985</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>在配置错误的情况下修复查询挂起 (无限循环) (<code class=syntax>connections_with_failover_max_tries</code> 设置为 0). <a href=https://github.com/ClickHouse/ClickHouse/pull/15876 rel="external nofollow noreferrer" target=_blank>#15876</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>将某些日志消息的级别从信息更改为调试, 因此不会为每个查询显示信息消息. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/5293 rel="external nofollow noreferrer" target=_blank>#5293</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15816 rel="external nofollow noreferrer" target=_blank>#15816</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>删除 <code class=syntax>MemoryTrackingInBackground*</code> 指标以避免潜在的误导性结果. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15684 rel="external nofollow noreferrer" target=_blank>#15684</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15813 rel="external nofollow noreferrer" target=_blank>#15813</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加重新连接到 <code class=syntax>zookeeper-dump-tree</code> 工具. <a href=https://github.com/ClickHouse/ClickHouse/pull/15711 rel="external nofollow noreferrer" target=_blank>#15711</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>允许在 <code class=syntax>CREATE TABLE table AS table_function(...)</code> 查询中明确指定列列表. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9249 rel="external nofollow noreferrer" target=_blank>#9249</a> 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14214 rel="external nofollow noreferrer" target=_blank>#14214</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14295 rel="external nofollow noreferrer" target=_blank>#14295</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> </ul> <h4 id=xing-neng-gai-jin_1>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_1 title="Permanent link"> </a></h4> <ul> <li>不要在 SELECT FINAL 中跨分区合并部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/15938 rel="external nofollow noreferrer" target=_blank>#15938</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>提高 <code class=syntax>-OrNull</code> 和 <code class=syntax>-OrDefault</code> 聚合函数的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/16661 rel="external nofollow noreferrer" target=_blank>#16661</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>提高 <code class=syntax>quantileMerge</code> 的性能. 在以前的版本中, 它非常慢. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/1463 rel="external nofollow noreferrer" target=_blank>#1463</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16643 rel="external nofollow noreferrer" target=_blank>#16643</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>稍微提高逻辑函数的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/16347 rel="external nofollow noreferrer" target=_blank>#16347</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>改进了 MergeTree 表引擎中合并分配的性能. 不应该对用户可见. <a href=https://github.com/ClickHouse/ClickHouse/pull/16191 rel="external nofollow noreferrer" target=_blank>#16191</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>通过预分配哈希表加速哈希/sparse_hashed 字典加载. <a href=https://github.com/ClickHouse/ClickHouse/pull/15454 rel="external nofollow noreferrer" target=_blank>#15454</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>现在, 琐碎的计数优化变得有点不琐碎了.包含精确分区expr的谓词也可以被优化. 这也修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/11092 rel="external nofollow noreferrer" target=_blank>#11092</a>当 <code class=syntax>max_parallel_replicas &gt; 1</code> 时返回错误计数的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/15074 rel="external nofollow noreferrer" target=_blank>#15074</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_3>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_3 title="Permanent link"> </a></h4> <ul> <li>为无状态测试添加薄片检查. 在功能测试被合并之前, 它将提前检测出可能不可靠的功能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/16238 rel="external nofollow noreferrer" target=_blank>#16238</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>使用适当的版本进行 <code class=syntax>croaring</code> 而不是合并. <a href=https://github.com/ClickHouse/ClickHouse/pull/16285 rel="external nofollow noreferrer" target=_blank>#16285</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>改进为 <code class=syntax>ya.make</code> 构建系统生成构建文件 (Arcadia). <a href=https://github.com/ClickHouse/ClickHouse/pull/16700 rel="external nofollow noreferrer" target=_blank>#16700</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>为 <code class=syntax>MaterializeMySQL</code> 数据库引擎添加MySQL BinLog文件检查工具. <code class=syntax>MaterializeMySQL</code> 是一个实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/16223 rel="external nofollow noreferrer" target=_blank>#16223</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>检查非可执行文件上的可执行位. 人们经常不小心从 Windows 提交可执行文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/15843 rel="external nofollow noreferrer" target=_blank>#15843</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>检查标题中的 <code class=syntax>#pragma once</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/15818 rel="external nofollow noreferrer" target=_blank>#15818</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 libhdfs3 中非法代码样式 <code class=syntax>&amp;vector[idx]</code>. 这修复了 libcxx 调试版本。 另见 <a href=https://github.com/ClickHouse-Extras/libhdfs3/pull/8 target=_blank>https://github.com/ClickHouse-Extras/libhdfs3/pull/8</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/15815 rel="external nofollow noreferrer" target=_blank>#15815</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>在 Mac OS 上修复一个杂项示例工具的构建. 请注意, 我们不在我们的 CI 中在 Mac OS 上构建示例 (我们仅构建 ClickHouse 二进制文件), 因此它不会再次中断的可能性为零. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15804 rel="external nofollow noreferrer" target=_blank>#15804</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15808 rel="external nofollow noreferrer" target=_blank>#15808</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>简化 Sys/V 初始化脚本. <a href=https://github.com/ClickHouse/ClickHouse/pull/14135 rel="external nofollow noreferrer" target=_blank>#14135</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>将 <code class=syntax>boost::program_options</code> 添加到 <code class=syntax>db_generator</code> 以提高其可用性. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/15940 rel="external nofollow noreferrer" target=_blank>#15940</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15973 rel="external nofollow noreferrer" target=_blank>#15973</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> </ul> <h2 id=clickhouse-ban-ben-20-10>ClickHouse 版本 20.10<a class=headerlink href=../amp/#clickhouse-ban-ben-20-10 title="Permanent link"> </a></h2> <h3 id=clickhouse-ban-ben-v20-10-7-4-stable-2020-12-24>ClickHouse 版本 v20.10.7.4-stable, 2020-12-24<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-10-7-4-stable-2020-12-24 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_7>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_7 title="Permanent link"> </a></h4> <ul> <li>修复了 <code class=syntax>clickhouse-odbc-bridge</code> 进程无法被具有双 <code class=syntax>IPv4/IPv6</code> 堆栈的机器上的服务器访问的问题, 并修复了使用格式错误的查询执行 ODBC 字典更新和/或导致崩溃时的问题. 这可能会关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14489 rel="external nofollow noreferrer" target=_blank>#14489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18278 rel="external nofollow noreferrer" target=_blank>#18278</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>修复 Enum 和 Int 类型之间的键比较. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17989 rel="external nofollow noreferrer" target=_blank>#17989</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18214 rel="external nofollow noreferrer" target=_blank>#18214</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了 <code class=syntax>MaterializeMySQL</code> 数据库引擎中唯一键转换崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/18186 rel="external nofollow noreferrer" target=_blank>#18186</a> 并修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16372 rel="external nofollow noreferrer" target=_blank>#16372</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/18211 rel="external nofollow noreferrer" target=_blank>#18211</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了 S3 URL 解析中的 <code class=syntax>std::out_of_range: basic_string</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18059 rel="external nofollow noreferrer" target=_blank>#18059</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>修复了由于 MaterializeMySQL 不支持转换 MySQL 前缀索引而导致某些表无法从 MySQL 同步到 ClickHouse 的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15187 rel="external nofollow noreferrer" target=_blank>#15187</a> 并修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17912 rel="external nofollow noreferrer" target=_blank>#17912</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/17944 rel="external nofollow noreferrer" target=_blank>#17944</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复 <code class=syntax>topK</code> 聚合函数中可能出现的段错误. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/17404 rel="external nofollow noreferrer" target=_blank>#17404</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17845 rel="external nofollow noreferrer" target=_blank>#17845</a> (<a href=https://github.com/kitaisreal rel="external nofollow noreferrer" target=_blank>Maksim Kita</a>).</li> <li>如果禁用了<code class=syntax>in_memory_parts_enable_wal</code>, 则不要从 <code class=syntax>WAL</code> 恢复部件. <a href=https://github.com/ClickHouse/ClickHouse/pull/17802 rel="external nofollow noreferrer" target=_blank>#17802</a> (<a href=https://github.com/detailyang rel="external nofollow noreferrer" target=_blank>detailyang</a>).</li> <li>修复了 ClickHouse 无法恢复与 MySQL 服务器的连接时的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17681 rel="external nofollow noreferrer" target=_blank>#17681</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>修复了服务器在守护进程模式下运行时空的 <code class=syntax>system.stack_trace</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/17630 rel="external nofollow noreferrer" target=_blank>#17630</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了在多行查询的交互模式下使用 <code class=syntax>clickhouse-client</code> 时的行为, 并且单行注释被错误地扩展到查询结束. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13654 rel="external nofollow noreferrer" target=_blank>#13654</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17565 rel="external nofollow noreferrer" target=_blank>#17565</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了服务器在极少数情况下停止接受连接的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17542 rel="external nofollow noreferrer" target=_blank>#17542</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在不同副本上杀死相应突变时的 <code class=syntax>ALTER</code> 查询挂起. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16953 rel="external nofollow noreferrer" target=_blank>#16953</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17499 rel="external nofollow noreferrer" target=_blank>#17499</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 clickhouse 低估标记缓存大小时的错误. 当有很多带有标记的小文件时可能会发生. <a href=https://github.com/ClickHouse/ClickHouse/pull/17496 rel="external nofollow noreferrer" target=_blank>#17496</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了启用设置 <code class=syntax>optimize_redundant_functions_in_order_by</code> 的 <code class=syntax>ORDER BY</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/17471 rel="external nofollow noreferrer" target=_blank>#17471</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 <code class=syntax>DISTINCT</code> 之后由于不正确优化而可能出现的重复项. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17294 rel="external nofollow noreferrer" target=_blank>#17294</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17296 rel="external nofollow noreferrer" target=_blank>#17296</a> (<a href=https://github.com/chengxianglibra rel="external nofollow noreferrer" target=_blank>li chengxiang</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17439 rel="external nofollow noreferrer" target=_blank>#17439</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了从具有 <code class=syntax>LowCardinality</code> 类型的 <code class=syntax>JOIN</code> 表读取时崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17228 rel="external nofollow noreferrer" target=_blank>#17228</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17397 rel="external nofollow noreferrer" target=_blank>#17397</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了子查询中存在 const 列时设置索引失效的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17246 rel="external nofollow noreferrer" target=_blank>#17246</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17249 rel="external nofollow noreferrer" target=_blank>#17249</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了导致崩溃的 <code class=syntax>ColumnConst</code> 比较. 这个修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17088 rel="external nofollow noreferrer" target=_blank>#17088</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17135 rel="external nofollow noreferrer" target=_blank>#17135</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了非领导者 <code class=syntax>ReplicatedMergeTreeTables</code> 的 <code class=syntax>ON CLUSTER</code> 查询可能永远挂起的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/17089 rel="external nofollow noreferrer" target=_blank>#17089</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了函数 <code class=syntax>fuzzBits</code> 中的模糊器发现错误. 这修复了. <a href=https://github.com/ClickHouse/ClickHouse/pull/17051 rel="external nofollow noreferrer" target=_blank>#17051</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>避免远程查询的不必要的网络错误, 这些错误在执行时可能会被取消, 例如使用 <code class=syntax>LIMIT</code> 的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/17006 rel="external nofollow noreferrer" target=_blank>#17006</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了从 double 转换时大整数 (128、256 位) 的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/16986 rel="external nofollow noreferrer" target=_blank>#16986</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>出现错误时解析 <code class=syntax>format_avro_schema_registry_url</code> 的IP. <a href=https://github.com/ClickHouse/ClickHouse/pull/16985 rel="external nofollow noreferrer" target=_blank>#16985</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复了在 <code class=syntax>ALTER TABLE ... MODIFY COLUMN ... NewType</code> 之后, 当“SELECT”在更改列上具有 <code class=syntax>WHERE</code> 表达式并且更改尚未完成时可能出现的服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/16968 rel="external nofollow noreferrer" target=_blank>#16968</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li><code class=syntax>clickhouse-git-import</code> 中没有正确计算批判信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/16959 rel="external nofollow noreferrer" target=_blank>#16959</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>通过单调函数优化来固定顺序. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16107 rel="external nofollow noreferrer" target=_blank>#16107</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16956 rel="external nofollow noreferrer" target=_blank>#16956</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>Fixrf 通过启用设置 <code class=syntax>optimize_aggregators_of_group_by_keys</code> 和连接来优化组. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12604 rel="external nofollow noreferrer" target=_blank>#12604</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16951 rel="external nofollow noreferrer" target=_blank>#16951</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>安装脚本应始终在 config 文件夹中创建子目录. 这仅与使用自定义配置的 Docker 构建相关. <a href=https://github.com/ClickHouse/ClickHouse/pull/16936 rel="external nofollow noreferrer" target=_blank>#16936</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>使用 <code class=syntax>ORDER BY</code> 的查询修复可能的错误 <code class=syntax>Illegal type of argument</code> . 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16580 rel="external nofollow noreferrer" target=_blank>#16580</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16928 rel="external nofollow noreferrer" target=_blank>#16928</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>如果没有数据写入<code class=syntax>WriteBufferFromS3</code>, 则中止分段上传. <a href=https://github.com/ClickHouse/ClickHouse/pull/16840 rel="external nofollow noreferrer" target=_blank>#16840</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>修复了在不带任何参数的情况下使用 <code class=syntax>any</code> 时的崩溃问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16803 rel="external nofollow noreferrer" target=_blank>#16803</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16826 rel="external nofollow noreferrer" target=_blank>#16826</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了 ClickHouse 过去总是通过 MySQL 协议为 <code class=syntax>INSERT</code> 查询返回许多受影响行的 0 插入的行为. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16605 rel="external nofollow noreferrer" target=_blank>#16605</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16715 rel="external nofollow noreferrer" target=_blank>#16715</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了 <code class=syntax>TDigest</code> 不受控制的增长. <a href=https://github.com/ClickHouse/ClickHouse/pull/16680 rel="external nofollow noreferrer" target=_blank>#16680</a> (<a href=https://github.com/hrissan rel="external nofollow noreferrer" target=_blank>hrissan</a>).</li> <li>修复了在 Aggregate 函数中使用后缀 <code class=syntax>if</code> 时远程查询失败的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16574 rel="external nofollow noreferrer" target=_blank>#16574</a> fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/16231 rel="external nofollow noreferrer" target=_blank>#16231</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/16610 rel="external nofollow noreferrer" target=_blank>#16610</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-10-4-1-stable-2020-11-13>ClickHouse 版本 v20.10.4.1-stable, 2020-11-13<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-10-4-1-stable-2020-11-13 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_8>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_8 title="Permanent link"> </a></h4> <ul> <li>当查询分析器打开并且 ClickHouse 安装在操作系统上时, 修复罕见的无声崩溃, glibc 版本已经 (据说) 损坏了某些功能的异步展开表. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15301 rel="external nofollow noreferrer" target=_blank>#15301</a>。 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13098 rel="external nofollow noreferrer" target=_blank>#13098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16846 rel="external nofollow noreferrer" target=_blank>#16846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在启用了 <code class=syntax>transform_null_in</code> 设置的情况下修复多个列和元组上的 <code class=syntax>IN</code> 运算符. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15310 rel="external nofollow noreferrer" target=_blank>#15310</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16722 rel="external nofollow noreferrer" target=_blank>#16722</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>这将修复 optimize_read_in_order/optimize_aggregation_in_order 与 max_threads&gt;0 和 ORDER BY 中的表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/16637 rel="external nofollow noreferrer" target=_blank>#16637</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>现在, 当从输入解析 AVRO 时, LowCardinality 从类型中删除. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16188 rel="external nofollow noreferrer" target=_blank>#16188</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16521 rel="external nofollow noreferrer" target=_blank>#16521</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>通过适当缩小 GTID 集, 修复使用 MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine 和 MySQL Slave 上启用的 <code class=syntax>slave_parallel_worker</code> 时元数据的快速增长. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15951 rel="external nofollow noreferrer" target=_blank>#15951</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16504 rel="external nofollow noreferrer" target=_blank>#16504</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>).</li> <li>修复分布式的 DROP TABLE (使用 INSERT). <a href=https://github.com/ClickHouse/ClickHouse/pull/16409 rel="external nofollow noreferrer" target=_blank>#16409</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复复制队列中非常大的条目的处理. 如果表结构非常大 (接近 1 MB), 则非常大的条目可能会出现在 ALTER 查询中. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16307 rel="external nofollow noreferrer" target=_blank>#16307</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16332 rel="external nofollow noreferrer" target=_blank>#16332</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 MySQL 数据库的错误. 当用作数据库引擎的 MySQL 服务器关闭时, 某些查询会引发异常, 因为它们试图从禁用的服务器获取表, 而这是不必要的. 例如, 查询 <code class=syntax>SELECT ... FROM system.parts</code> 应该只适用于 MergeTree 表并且根本不要接触 MySQL 数据库. <a href=https://github.com/ClickHouse/ClickHouse/pull/16032 rel="external nofollow noreferrer" target=_blank>#16032</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> </ul> <h4 id=gai-jin_3>改进<a class=headerlink href=../amp/#gai-jin_3 title="Permanent link"> </a></h4> <ul> <li>将 S3 与 nginx 服务器一起用作代理的解决方法。 Nginx 当前不接受像 <a href=http://domain.com?delete target=_blank>http://domain.com?delete</a> 这样的空路径 url，但是 vanilla aws-sdk-cpp 会生成这种 url。 此提交使用修补过的 aws-sdk-cpp 版本，在这种情况下，它使 url 以“/”作为路径，例如 <a href=http://domain.com/?delete target=_blank>http://domain.com/?delete</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16813 rel="external nofollow noreferrer" target=_blank>#16813</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-10-3-30-2020-10-28>ClickHouse 版本 v20.10.3.30, 2020-10-28<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-10-3-30-2020-10-28 title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng_2>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng_2 title="Permanent link"> </a></h4> <ul> <li>使 <code class=syntax>multiple_joins_rewriter_version</code> 过时. 删除连接重写器的第一个版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/15472 rel="external nofollow noreferrer" target=_blank>#15472</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>将 <code class=syntax>format_regexp_escaping_rule</code> 设置的默认值 (它与 <code class=syntax>Regexp</code> 格式相关) 更改为 <code class=syntax>Raw</code> (这意味着 - 将整个子模式作为一个值读取), 使行为更符合用户的期望. <a href=https://github.com/ClickHouse/ClickHouse/pull/15426 rel="external nofollow noreferrer" target=_blank>#15426</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 SQL 中添加对嵌套多行注释 <code class=syntax>/* 注释 /* 注释 */ */</code> 的支持. 这符合SQL标准. <a href=https://github.com/ClickHouse/ClickHouse/pull/14655 rel="external nofollow noreferrer" target=_blank>#14655</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了 MergeTree 设置 (<code class=syntax>max_replicated_merges_with_ttl_in_queue</code> 和 <code class=syntax>max_number_of_merges_with_ttl_in_pool</code>) 来控制后台池和复制队列中与 TTL 合并的数量. 仅当您使用删除 TTL 时, 此更改才会破坏与旧版本的兼容性. 否则, 复制将保持兼容. 如果您一次更新所有分片副本或执行 <code class=syntax>SYSTEM STOP TTL MERGES</code> 直到完成所有副本的更新, 您可以避免不兼容问题. 如果你在复制队列中得到一个不兼容的条目, 首先, 执行 <code class=syntax>SYSTEM STOP TTL MERGES</code> , 然后在 <code class=syntax>ALTER TABLE ... DETACH PARTITION ...</code> 分配不兼容的TTL合并的分区. 将其重新连接到单个副本上. <a href=https://github.com/ClickHouse/ClickHouse/pull/14490 rel="external nofollow noreferrer" target=_blank>#14490</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>从20.5以上的版本升级时, 如果进行滚动更新, 集群同时包含20.5以上和20.5以下的版本, 如果旧版本的ClickHouse节点重启, 旧版本在新版本存在的情况下启动, 可能会导致 <code class=syntax>Part ... intersects previous part</code> 错误. 为防止出现此错误, 首先在所有集群节点上安装更新的 clickhouse-server 软件包, 然后重新启动 (因此, 当 clickhouse-server 重新启动时, 它将以新版本启动).</li> </ul> <h4 id=xin-te-zheng_2>新特征<a class=headerlink href=../amp/#xin-te-zheng_2 title="Permanent link"> </a></h4> <ul> <li>后台数据再压缩. 添加为 MergeTree 表引擎系列指定 <code class=syntax>TTL ... RECOMPRESS codec_name</code> 的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/14494 rel="external nofollow noreferrer" target=_blank>#14494</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>添加并行仲裁插入. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/15601 rel="external nofollow noreferrer" target=_blank>#15601</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15601 rel="external nofollow noreferrer" target=_blank>#15601</a> (<a href=https://github.com/alexelex rel="external nofollow noreferrer" target=_blank>Latysheva Alexandra</a>).</li> <li>用于额外强制执行数据持久性的设置. 对非复制设置有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/11948 rel="external nofollow noreferrer" target=_blank>#11948</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>当复制块写入本地不存在的副本时 (尚未从副本中提取), 不要忽略它并在本地写入, 以达到与复制成功相同的效果. <a href=https://github.com/ClickHouse/ClickHouse/pull/11684 rel="external nofollow noreferrer" target=_blank>#11684</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在我们支持 <code class=syntax>WITH &lt;identifier&gt; AS (subquery) ...</code> 在查询上下文中引入命名子查询. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/2416 rel="external nofollow noreferrer" target=_blank>#2416</a>. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/4967 rel="external nofollow noreferrer" target=_blank>#4967</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14771 rel="external nofollow noreferrer" target=_blank>#14771</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>引入 <code class=syntax>enable_global_with_statement</code> 设置, 它将第一个 select 的 <code class=syntax>WITH</code> 语句传播到同一级别的其他选择查询, 并使 <code class=syntax>WITH</code> 语句中的别名对子查询可见. <a href=https://github.com/ClickHouse/ClickHouse/pull/15451 rel="external nofollow noreferrer" target=_blank>#15451</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>安全的集群间查询执行 (initial_user 作为当前查询用户). <a href=https://github.com/ClickHouse/ClickHouse/pull/13156 rel="external nofollow noreferrer" target=_blank>#13156</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/15551 rel="external nofollow noreferrer" target=_blank>#15551</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加删除列属性和表 TTL 的功能. 引入了查询 <code class=syntax>ALTER TABLE MODIFY COLUMN col_name REMOVE what_to_remove</code>和<code class=syntax>ALTER TABLE REMOVE TTL</code>. 这两个操作都是轻量级的, 并且在元数据级别执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/14742 rel="external nofollow noreferrer" target=_blank>#14742</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>添加格式 <code class=syntax>RawBLOB</code> . 它用于输入或输出没有任何转义和分隔符的单个值. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/15349 rel="external nofollow noreferrer" target=_blank>#15349</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15364 rel="external nofollow noreferrer" target=_blank>#15364</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加 <code class=syntax>reinterpretAsUUID</code> 函数, 允许将大端字节字符串转换为 UUID. <a href=https://github.com/ClickHouse/ClickHouse/pull/15480 rel="external nofollow noreferrer" target=_blank>#15480</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>实现 <code class=syntax>force_data_skiping_indices</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/15642 rel="external nofollow noreferrer" target=_blank>#15642</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加一个设置 <code class=syntax>output_format_pretty_row_numbers</code> 以计算出漂亮格式的结果. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/15350 rel="external nofollow noreferrer" target=_blank>#15350</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15443 rel="external nofollow noreferrer" target=_blank>#15443</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>添加了查询混淆工具. 它允许共享更多查询以进行更好的测试. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/15268 rel="external nofollow noreferrer" target=_blank>#15268</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15321 rel="external nofollow noreferrer" target=_blank>#15321</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加表函数 <code class=syntax>null('structure')</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/14797 rel="external nofollow noreferrer" target=_blank>#14797</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>).</li> <li>添加了 <code class=syntax>formatReadableQuantity</code> 函数. 它对于人类读取大数字很有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/14725 rel="external nofollow noreferrer" target=_blank>#14725</a> (<a href=https://github.com/BooBSD rel="external nofollow noreferrer" target=_blank>Artem Hnilov</a>).</li> <li>添加格式 <code class=syntax>LineAsString</code> 接受由换行符分隔的一系列行, 每一行都作为一个整体解析为单个 String 字段. <a href=https://github.com/ClickHouse/ClickHouse/pull/14703 rel="external nofollow noreferrer" target=_blank>#14703</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>), <a href=https://github.com/ClickHouse/ClickHouse/pull/13846 rel="external nofollow noreferrer" target=_blank>#13846</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>添加以字符串数组形式输出数据的 <code class=syntax>JSONStrings</code> 格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/14333 rel="external nofollow noreferrer" target=_blank>#14333</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>为<code class=syntax>Regexp</code> 格式添加对 <code class=syntax>Raw</code> 列格式的支持。 它允许简单地将子模式作为一个整体提取，而无需任何转义规则. <a href=https://github.com/ClickHouse/ClickHouse/pull/15363 rel="external nofollow noreferrer" target=_blank>#15363</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>允许 <code class=syntax>TSV</code> 输出格式的可配置 <code class=syntax>NULL</code> 表示. 它由设置 <code class=syntax>output_format_tsv_null_representation</code> 控制, 默认情况下为 <code class=syntax>\N</code>. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/9375 rel="external nofollow noreferrer" target=_blank>#9375</a>. 请注意, 该设置仅控制输出格式, 并且 <code class=syntax>\N</code> 是 <code class=syntax>TSV</code> 输入格式唯一支持的 <code class=syntax>NULL</code> 表示. <a href=https://github.com/ClickHouse/ClickHouse/pull/14586 rel="external nofollow noreferrer" target=_blank>#14586</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>支持 <code class=syntax>MaterializeMySQL</code> 的十进制数据类型。 <code class=syntax>MaterializeMySQL</code> 是一个实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/14535 rel="external nofollow noreferrer" target=_blank>#14535</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>添加新功能: <code class=syntax>SHOW DATABASES LIKE 'xxx'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14521 rel="external nofollow noreferrer" target=_blank>#14521</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>添加了将 (任意) git 存储库作为示例数据集导入到 ClickHouse 的脚本. <a href=https://github.com/ClickHouse/ClickHouse/pull/14471 rel="external nofollow noreferrer" target=_blank>#14471</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在插入语句可以在列列表中带有带有列转换器的星号 (或变体). <a href=https://github.com/ClickHouse/ClickHouse/pull/14453 rel="external nofollow noreferrer" target=_blank>#14453</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>用于分布式查询的新查询复杂度限制设置 <code class=syntax>max_rows_to_read_leaf</code>、<code class=syntax>max_bytes_to_read_leaf</code>, 以限制在叶节点上读取的最大行数/字节数. 限制仅适用于本地读取, <em>排除</em>根节点上的最终合并阶段. <a href=https://github.com/ClickHouse/ClickHouse/pull/14221 rel="external nofollow noreferrer" target=_blank>#14221</a> (<a href=https://github.com/hagen1778 rel="external nofollow noreferrer" target=_blank>Roman Khavronenko</a>).</li> <li>允许用户在配置文件的 <code class=syntax>&lt;replicated_merge_tree&gt;</code> 部分为 <code class=syntax>ReplicatedMergeTree*</code> 存储指定设置. 它的工作原理类似于 <code class=syntax>&lt;merge_tree&gt;</code> 部分. 对于 <code class=syntax>ReplicatedMergeTree*</code> 存储, <code class=syntax>&lt;merge_tree&gt;</code> 和 <code class=syntax>&lt;replicated_merge_tree&gt;</code> 中的设置被一起应用, 但来自 <code class=syntax>&lt;replicated_merge_tree&gt;</code> 的设置具有更高的优先级. 添加了<code class=syntax>system.replicated_merge_tree_settings</code>表. <a href=https://github.com/ClickHouse/ClickHouse/pull/13573 rel="external nofollow noreferrer" target=_blank>#13573</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>添加 <code class=syntax>mapPopulateSeries</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/13166 rel="external nofollow noreferrer" target=_blank>#13166</a> (<a href=https://github.com/ildus rel="external nofollow noreferrer" target=_blank>Ildus Kurbangaliev</a>).</li> <li>支持 MySQL 类型：<code class=syntax>decimal</code> (作为 ClickHouse<code class=syntax>Decimal</code>) 和具有亚秒级精度的 <code class=syntax>datetime</code> (作为 <code class=syntax>DateTime64</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/11512 rel="external nofollow noreferrer" target=_blank>#11512</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>将 <code class=syntax>event_time_microseconds</code> 字段引入 <code class=syntax>system.text_log</code>、<code class=syntax>system.trace_log</code>、<code class=syntax>system.query_log</code> 和 <code class=syntax>system.query_thread_log</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/14760 rel="external nofollow noreferrer" target=_blank>#14760</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>将 <code class=syntax>event_time_microseconds</code> 添加到 <code class=syntax>system.asynchronous_metric_log</code> 和 <code class=syntax>system.metric_log</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/14514 rel="external nofollow noreferrer" target=_blank>#14514</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>将 <code class=syntax>query_start_time_microseconds</code> 字段添加到 <code class=syntax>system.query_log</code> 和 <code class=syntax>system.query_thread_log</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/14252 rel="external nofollow noreferrer" target=_blank>#14252</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> </ul> <h4 id=bug-xiu-fu_9>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_9 title="Permanent link"> </a></h4> <ul> <li>修复无论限制如何都可以过度分配内存的情况. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14560 rel="external nofollow noreferrer" target=_blank>#14560</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16206 rel="external nofollow noreferrer" target=_blank>#16206</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>executable</code> 字典源挂起. 在以前的版本中, 当使用某些格式 (例如<code class=syntax>JSONEachRow</code>) 时, 数据在至少输出一些东西之前不会提供给子进程. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/1697 rel="external nofollow noreferrer" target=_blank>#1697</a>. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/2455 rel="external nofollow noreferrer" target=_blank>#2455</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14525 rel="external nofollow noreferrer" target=_blank>#14525</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在函数 <code class=syntax>dictGet</code> 出现异常时修复double free. 如果字典加载错误, 可能会发生这种情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/16429 rel="external nofollow noreferrer" target=_blank>#16429</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用总数/汇总/多维数据集修饰符和最小/最大功能按键修复分组. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16393 rel="external nofollow noreferrer" target=_blank>#16393</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16397 rel="external nofollow noreferrer" target=_blank>#16397</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>使用 <code class=syntax>prefer_localhost_replica=0</code> 和 <code class=syntax>internal_replication</code> 修复异步分布式插入. <a href=https://github.com/ClickHouse/ClickHouse/pull/16358 rel="external nofollow noreferrer" target=_blank>#16358</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复 TwoLevelStringHashTable 实现中一个很错误的代码，可能导致内存泄漏. <a href=https://github.com/ClickHouse/ClickHouse/pull/16264 rel="external nofollow noreferrer" target=_blank>#16264</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了在lambda中某些错误聚合情况下的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/16082 rel="external nofollow noreferrer" target=_blank>#16082</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复 <code class=syntax>ReplicatedVersionedCollapsingMergeTree</code> 的 <code class=syntax>ALTER MODIFY ... ORDER BY</code> 查询挂起。 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15980 rel="external nofollow noreferrer" target=_blank>#15980</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16011 rel="external nofollow noreferrer" target=_blank>#16011</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li><code class=syntax>MaterializeMySQL</code> (实验功能): 修复整理名称和字符集名称解析器并支持字符串类型的 <code class=syntax>length = 0</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16008 rel="external nofollow noreferrer" target=_blank>#16008</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>允许对具有复杂键的字典使用 <code class=syntax>direct</code> 布局. <a href=https://github.com/ClickHouse/ClickHouse/pull/16007 rel="external nofollow noreferrer" target=_blank>#16007</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>在一段时间不活动后发生复制错误时，防止副本挂起 5-10 分钟. <a href=https://github.com/ClickHouse/ClickHouse/pull/15987 rel="external nofollow noreferrer" target=_blank>#15987</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>在插入或从 MaterializedView 中选择并同时删除目标表时修复罕见的段错误 (适用于原子数据库引擎). <a href=https://github.com/ClickHouse/ClickHouse/pull/15984 rel="external nofollow noreferrer" target=_blank>#15984</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复解析设置配置文件时的歧义: <code class=syntax>CREATE USER ... SETTINGS profile readonly</code> 现在被视为使用名为 <code class=syntax>readonly</code> 的配置文件, 而不是名为 <code class=syntax>profile</code> 的具有只读约束的设置. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15628 rel="external nofollow noreferrer" target=_blank>#15628</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15982 rel="external nofollow noreferrer" target=_blank>#15982</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li><code class=syntax>MaterializeMySQL</code> (实验功能): 修复创建数据库失败时的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/15954 rel="external nofollow noreferrer" target=_blank>#15954</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了当表被并发重命名 (对于原子数据库引擎) 时, <code class=syntax>DROP TABLE IF EXISTS</code> 失败并带有 <code class=syntax>Table ... does not exist</code> 错误的问题. 修复了并发执行具有多个表的某些 DDL 查询 (如<code class=syntax>DROP DATABASE</code> 和 <code class=syntax>RENAME TABLE</code> ) 时罕见的死锁 - 修复了并发执行 <code class=syntax>DROP/DETACH</code> 时 <code class=syntax>Table ... does not exist</code> 的 <code class=syntax>DROP/DETACH DATABASE</code> 失败表`. <a href=https://github.com/ClickHouse/ClickHouse/pull/15934 rel="external nofollow noreferrer" target=_blank>#15934</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>如果查询具有 <code class=syntax>WHERE</code>、<code class=syntax>PREWHERE</code> 和<code class=syntax>GLOBAL IN</code>, 则修复来自<code class=syntax>Distributed</code> 表的查询的错误空结果. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/15792 rel="external nofollow noreferrer" target=_blank>#15792</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15933 rel="external nofollow noreferrer" target=_blank>#15933</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12513 rel="external nofollow noreferrer" target=_blank>#12513</a>: 重新分析查询时具有相同别名的差异表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/15886 rel="external nofollow noreferrer" target=_blank>#15886</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复 RBAC 实现中可能非常罕见的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/15875 rel="external nofollow noreferrer" target=_blank>#15875</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复在 <code class=syntax>ALTER MODIFY COLUMN</code> 查询之后执行的 <code class=syntax>SELECT ... ORDER BY DESC</code> 查询中的异常 <code class=syntax>Block structure mismatch</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15800 rel="external nofollow noreferrer" target=_blank>#15800</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15852 rel="external nofollow noreferrer" target=_blank>#15852</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li><code class=syntax>MaterializeMySQL</code> (实验功能): 修复 <code class=syntax>select count()</code> 不准确. <a href=https://github.com/ClickHouse/ClickHouse/pull/15767 rel="external nofollow noreferrer" target=_blank>#15767</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复某些查询情况, 其中仅选择虚拟列. 以前可能会抛出 <code class=syntax>Not found column _nothing in block</code> 异常. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12298 rel="external nofollow noreferrer" target=_blank>#12298</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15756 rel="external nofollow noreferrer" target=_blank>#15756</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复原子数据库中具有内表的物化视图的删除 (由于工作线程挂起, 由于 MV 内表的递归 DROP TABLE, 因此挂起所有后续 DROP TABLE). <a href=https://github.com/ClickHouse/ClickHouse/pull/15743 rel="external nofollow noreferrer" target=_blank>#15743</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果第一次尝试失败, 可以将部分移动到另一个磁盘/卷. <a href=https://github.com/ClickHouse/ClickHouse/pull/15723 rel="external nofollow noreferrer" target=_blank>#15723</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>修复错误 <code class=syntax>Cannot find column</code>, 如果对 <code class=syntax>MV</code> 的查询包含 <code class=syntax>ARRAY JOIN</code> , 则在插入 <code class=syntax>MATERIALIZED VIEW</code> 时可能会发生该错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15717 rel="external nofollow noreferrer" target=_blank>#15717</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 <code class=syntax>max_replicated_logs_to_keep</code> 设置的默认值过低, 这可能导致副本过于频繁地丢失. 通过选择要克隆的最新副本来改进丢失的副本恢复过程. 也不要从丢失的复制品中取出旧零件, 而是将它们拆下. <a href=https://github.com/ClickHouse/ClickHouse/pull/15701 rel="external nofollow noreferrer" target=_blank>#15701</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复 MySQL 字典和表中罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/15686 rel="external nofollow noreferrer" target=_blank>#15686</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复 AMQP-CPP 中的 (良性) 竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/15667 rel="external nofollow noreferrer" target=_blank>#15667</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复错误 <code class=syntax>Cannot add simple transform to empty Pipe</code> , 该错误在从与目标表结构不同的 <code class=syntax>Buffer</code> 表中读取时发生. 如果目标表返回空的查询结果是可能的. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15529 rel="external nofollow noreferrer" target=_blank>#15529</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15662 rel="external nofollow noreferrer" target=_blank>#15662</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>在使用 S3 插入 MergeTree 期间正确处理错误. S3 上的 MergeTree 是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/15657 rel="external nofollow noreferrer" target=_blank>#15657</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>修复了 S3 表功能的错误: 来自 URL 的区域未应用于 S3 客户端配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/15646 rel="external nofollow noreferrer" target=_blank>#15646</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>修复查询计划的 ReadFromStorage 步骤中资源的销毁顺序. 在极少数情况下, 它可能会导致崩溃. 可能与<a href=https://github.com/ClickHouse/ClickHouse/issues/15610 rel="external nofollow noreferrer" target=_blank>#15610</a>有关. <a href=https://github.com/ClickHouse/ClickHouse/pull/15645 rel="external nofollow noreferrer" target=_blank>#15645</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>分离只读表时减去<code class=syntax>ReadonlyReplica</code> 指标. <a href=https://github.com/ClickHouse/ClickHouse/pull/15592 rel="external nofollow noreferrer" target=_blank>#15592</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>修复了使用 <code class=syntax>JSON*</code> 函数时会导致 <code class=syntax>VALUES</code>、<code class=syntax>LIMIT</code> 或 <code class=syntax>IN</code> 运算符右侧的 <code class=syntax>Element ... is not a constant expression</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15589 rel="external nofollow noreferrer" target=_blank>#15589</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>如果出现异常, 查询将更快完成. 如果发生异常, 取消对远程副本的执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/15578 rel="external nofollow noreferrer" target=_blank>#15578</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>防止出现错误消息 <code class=syntax>Could not calculate available disk space (statvfs), errno: 4, strerror: Interrupted system call</code> 的可能性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15541 rel="external nofollow noreferrer" target=_blank>#15541</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15557 rel="external nofollow noreferrer" target=_blank>#15557</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>Database &lt;db&gt; does not exist.</code> 在启动器上没有数据库时使用 IN 和分布式表的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/15538 rel="external nofollow noreferrer" target=_blank>#15538</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>Mutation 可能会在 <code class=syntax>MOVE</code> 或 <code class=syntax>REPLACE PARTITION</code> 之后等待一些不存在的部分, 或者在极少数情况下, 在 <code class=syntax>DETACH</code> 或 <code class=syntax>DROP PARTITION</code> 之后挂起. 已修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/15537 rel="external nofollow noreferrer" target=_blank>#15537</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复如果执行具有相同模式的 <code class=syntax>LIKE</code> , 则 <code class=syntax>LIKE</code> 运算符不再区分大小写的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15536 rel="external nofollow noreferrer" target=_blank>#15536</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了当选择数据中没有的列，但依赖于数据中也没有的其他列时的 <code class=syntax>Missing columns</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15530 rel="external nofollow noreferrer" target=_blank>#15530</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15532 rel="external nofollow noreferrer" target=_blank>#15532</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>将单个参数传递给 ReplicatedMergeTree 而不是忽略它时抛出错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15516 rel="external nofollow noreferrer" target=_blank>#15516</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> <li>修复了 DDLWorker 中事件订阅的错误, 该错误很少会导致查询在 <code class=syntax>ON CLUSTER</code> 中挂起. 引入 <a href=https://github.com/ClickHouse/ClickHouse/issues/13450 rel="external nofollow noreferrer" target=_blank>#13450</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15477 rel="external nofollow noreferrer" target=_blank>#15477</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>当 <code class=syntax>boundingRatio</code> 聚合函数的第二个参数类型错误时报告正确的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15407 rel="external nofollow noreferrer" target=_blank>#15407</a> (<a href=https://github.com/detailyang rel="external nofollow noreferrer" target=_blank>detailyang</a>).</li> <li>修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15365 rel="external nofollow noreferrer" target=_blank>#15365</a>: 附加带有 MySQL 引擎的数据库抛出异常 (无查询上下文) . <a href=https://github.com/ClickHouse/ClickHouse/pull/15384 rel="external nofollow noreferrer" target=_blank>#15384</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复 select 查询中多次出现列转换器的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/15378 rel="external nofollow noreferrer" target=_blank>#15378</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了 <code class=syntax>S3</code> 存储中的压缩. <a href=https://github.com/ClickHouse/ClickHouse/pull/15376 rel="external nofollow noreferrer" target=_blank>#15376</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>修复诸如 <code class=syntax>SELECT toStartOfDay(today())</code> 之类的查询失败抱怨空 time_zone 参数的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15319 rel="external nofollow noreferrer" target=_blank>#15319</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>修复合并树表重命名和背景清理过程中的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/15304 rel="external nofollow noreferrer" target=_blank>#15304</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复启用系统日志时服务器启动时罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/15300 rel="external nofollow noreferrer" target=_blank>#15300</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复带有大量子查询的查询挂起到 <code class=syntax>MySQL</code> 引擎的同一个表. 以前, 如果查询中对同一个 <code class=syntax>MySQL</code> 表的子查询超过 16 个, 它将永远挂起. <a href=https://github.com/ClickHouse/ClickHouse/pull/15299 rel="external nofollow noreferrer" target=_blank>#15299</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复 QueryLog 中的 MSan 报告. 未初始化的内存可用于字段 <code class=syntax>memory_usage</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15258 rel="external nofollow noreferrer" target=_blank>#15258</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当查询在 Merge 表上有 JOIN 时，修复 GROUP BY 中的 <code class=syntax>Unknown identifier</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/15242 rel="external nofollow noreferrer" target=_blank>#15242</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了将 <code class=syntax>joinGet</code> 与 <code class=syntax>LowCardinality</code> 类型结合使用时的实例崩溃问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15214 rel="external nofollow noreferrer" target=_blank>#15214</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15220 rel="external nofollow noreferrer" target=_blank>#15220</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复表引擎 <code class=syntax>Buffer</code> 中的错误, 该错误不允许在 <code class=syntax>ALTER</code> 查询后将新结构的数据插入到 <code class=syntax>Buffer</code> 中. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15117 rel="external nofollow noreferrer" target=_blank>#15117</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15192 rel="external nofollow noreferrer" target=_blank>#15192</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>调整 MySQL 列定义包中的 Decimal 字段大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/15152 rel="external nofollow noreferrer" target=_blank>#15152</a> (<a href=https://github.com/maqroll rel="external nofollow noreferrer" target=_blank>maqroll</a>).</li> <li>修复了 <code class=syntax>join_algorithm='auto'</code> 中的<code class=syntax>用不同方法压缩的数据</code>. 在 <code class=syntax>join_algorithm='partial_merge'</code> 中保持 LowCardinality 作为左表连接键的类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/15088 rel="external nofollow noreferrer" target=_blank>#15088</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>更新 <code class=syntax>jemalloc</code> 以修复带有亲和掩码的 <code class=syntax>percpu_arena</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15035 rel="external nofollow noreferrer" target=_blank>#15035</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/14957 rel="external nofollow noreferrer" target=_blank>#14957</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>我们已经在 String 和 FixedString 之间使用了填充比较 (<a href=https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333 target=_blank>https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333</a>) . 此 PR 将相同的逻辑应用于字段比较, 以更正 FixedString 作为主键的使用. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14908 rel="external nofollow noreferrer" target=_blank>#14908</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15033 rel="external nofollow noreferrer" target=_blank>#15033</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>如果使用专门设计的参数调用函数 <code class=syntax>bar</code>, 则可能会发生缓冲区溢出. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/13926 rel="external nofollow noreferrer" target=_blank>#13926</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15028 rel="external nofollow noreferrer" target=_blank>#15028</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在 Mac OS 上的 Docker 中运行 clickhouse-server 时, 在原子数据库中执行 DDL 查询时出现的 <code class=syntax>Cannot rename ... errno: 22, strerror: Invalid argument</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15024 rel="external nofollow noreferrer" target=_blank>#15024</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>当超过内存限制时, 使用 join_algorith='auto' 修复 RIGHT 或 FULL JOIN 中的崩溃, 我们应该使用 MergeJoin 更改 HashJoin. <a href=https://github.com/ClickHouse/ClickHouse/pull/15002 rel="external nofollow noreferrer" target=_blank>#15002</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>现在设置 <code class=syntax>number_of_free_entries_in_pool_to_execute_mutation</code> 和 <code class=syntax>number_of_free_entries_in_pool_to_lower_max_size_of_merge</code> 可以等于 <code class=syntax>background_pool_size</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14975 rel="external nofollow noreferrer" target=_blank>#14975</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>当子查询包含<code class=syntax>finalizeAggregation</code> 函数时, 修复使谓词下推工作. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14847 rel="external nofollow noreferrer" target=_blank>#14847</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14937 rel="external nofollow noreferrer" target=_blank>#14937</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>在 <code class=syntax>system.asynchronous_metrics</code> 中发布每个逻辑核心的 CPU 频率. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14923 rel="external nofollow noreferrer" target=_blank>#14923</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14924 rel="external nofollow noreferrer" target=_blank>#14924</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li><code class=syntax>MaterializeMySQL</code> (实验功能): 修复了 <code class=syntax>.metadata.tmp File exists</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/14898 rel="external nofollow noreferrer" target=_blank>#14898</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复部分调用 <code class=syntax>extractAllGroups</code> 函数可能触发 <code class=syntax>Memory limit exceeded</code> 错误的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13383 rel="external nofollow noreferrer" target=_blank>#13383</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14889 rel="external nofollow noreferrer" target=_blank>#14889</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 SIGSEGV 以尝试使用文件描述符插入 StorageFile. <a href=https://github.com/ClickHouse/ClickHouse/pull/14887 rel="external nofollow noreferrer" target=_blank>#14887</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>cache</code> 字典中的段错误 <a href=https://github.com/ClickHouse/ClickHouse/issues/14837 rel="external nofollow noreferrer" target=_blank>#14837</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14879 rel="external nofollow noreferrer" target=_blank>#14879</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li><code class=syntax>MaterializeMySQL</code> (实验功能): 修复了解析 MySQL 二进制日志事件的错误，该错误导致 <code class=syntax>MaterializeMySQL</code> 数据库引擎中的 <code class=syntax>Attempt to read after eof</code> 和 <code class=syntax>Packet payload is not fully read</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14852 rel="external nofollow noreferrer" target=_blank>#14852</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>当被查询的列具有 <code class=syntax>DEFAULT</code> 表达式时, 修复 <code class=syntax>SELECT</code> 查询中的罕见错误, 该表达式依赖于另一列, 该列也具有 <code class=syntax>DEFAULT</code> 并且不存在于选择查询中且不存在于磁盘上. 部分修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14531 rel="external nofollow noreferrer" target=_blank>#14531</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14845 rel="external nofollow noreferrer" target=_blank>#14845</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>如果必须从 ZK 获取配置文件 (使用 <code class=syntax>from_zk</code> 包含选项) , 则修复服务器在与 ZooKeeper 交谈时可能会在启动时卡住的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14814 rel="external nofollow noreferrer" target=_blank>#14814</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14843 rel="external nofollow noreferrer" target=_blank>#14843</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>修复了收缩的<code class=syntax>Int -&gt; Int</code> 签名类型转换的错误单调性检测. 可能会导致查询结果不正确. 此错误在 <a href=https://github.com/ClickHouse/ClickHouse/issues/14513 rel="external nofollow noreferrer" target=_blank>#14513</a> 中公布. <a href=https://github.com/ClickHouse/ClickHouse/pull/14783 rel="external nofollow noreferrer" target=_blank>#14783</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li><code class=syntax>Replace</code> 列转换器应该用克隆的 AST 替换标识符. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14695 rel="external nofollow noreferrer" target=_blank>#14695</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14734 rel="external nofollow noreferrer" target=_blank>#14734</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了执行 <code class=syntax>ALTER ... MODIFY QUERY</code> 时物化视图元数据中丢失的默认数据库名称. <a href=https://github.com/ClickHouse/ClickHouse/pull/14664 rel="external nofollow noreferrer" target=_blank>#14664</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了当赋值表达式和常量值 (如 <code class=syntax>UPDATE x = 42</code> ) 中带有 <code class=syntax>Nullable</code> 列的 <code class=syntax>ALTER UPDATE</code> 突变导致列或段错误中的值不正确时的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13634 rel="external nofollow noreferrer" target=_blank>#13634</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/14045 rel="external nofollow noreferrer" target=_blank>#14045</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14646 rel="external nofollow noreferrer" target=_blank>#14646</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复错误的十进制乘法结果导致结果列小数位数错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/14603 rel="external nofollow noreferrer" target=_blank>#14603</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复函数 <code class=syntax>has</code> 与 <code class=syntax>LowCardinality</code> 的 <code class=syntax>Nullable</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/14591 rel="external nofollow noreferrer" target=_blank>#14591</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>在为 StorageReplicatedMergeTree 引擎创建查询期间 Zookeeper 异常后清理数据目录. <a href=https://github.com/ClickHouse/ClickHouse/pull/14563 rel="external nofollow noreferrer" target=_blank>#14563</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>修复带有组合子 <code class=syntax>-Resample</code> 的函数中罕见的段错误, 这可能会出现在参数非常大的溢出结果中. <a href=https://github.com/ClickHouse/ClickHouse/pull/14562 rel="external nofollow noreferrer" target=_blank>#14562</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了将 <code class=syntax>Nullable(String)</code> 转换为 Enum 时的错误. 由 <a href=https://github.com/ClickHouse/ClickHouse/pull/12745 rel="external nofollow noreferrer" target=_blank>#12745</a> 介绍. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14435 rel="external nofollow noreferrer" target=_blank>#14435</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14530 rel="external nofollow noreferrer" target=_blank>#14530</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了 <code class=syntax>Nullable</code> 列不正确的排序顺序. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14344 rel="external nofollow noreferrer" target=_blank>#14344</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14495 rel="external nofollow noreferrer" target=_blank>#14495</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复 <code class=syntax>currentDatabase()</code> 函数不能在 <code class=syntax>ON CLUSTER</code> ddl 查询中使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/14211 rel="external nofollow noreferrer" target=_blank>#14211</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li><code class=syntax>MaterializeMySQL</code> (实验功能): 修复了 <code class=syntax>MaterializeMySQL</code> 数据库引擎中的 <code class=syntax>Packet payload is not full read</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/14696 rel="external nofollow noreferrer" target=_blank>#14696</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>).</li> </ul> <h4 id=gai-jin_4>改进<a class=headerlink href=../amp/#gai-jin_4 title="Permanent link"> </a></h4> <ul> <li>默认情况下为新创建的数据库启用 <code class=syntax>Atomic</code> 数据库引擎. <a href=https://github.com/ClickHouse/ClickHouse/pull/15003 rel="external nofollow noreferrer" target=_blank>#15003</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>添加为具有子类型的列指定专用编解码器的功能, 如 <code class=syntax>Delta</code>、<code class=syntax>T64</code> 等. 实现 <a href=https://github.com/ClickHouse/ClickHouse/issues/12551 rel="external nofollow noreferrer" target=_blank>#12551</a>, 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11397 rel="external nofollow noreferrer" target=_blank>#11397</a>, 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/4609 rel="external nofollow noreferrer" target=_blank>#4609</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15089 rel="external nofollow noreferrer" target=_blank>#15089</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>动态重新加载zookeeper配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/14678 rel="external nofollow noreferrer" target=_blank>#14678</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>现在， 无论集群配置中的 <code class=syntax>&lt;internal_replication&gt;</code> 设置如何, 都可以执行 <code class=syntax>ALTER ... ON CLUSTER</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/16075 rel="external nofollow noreferrer" target=_blank>#16075</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>现在 <code class=syntax>joinGet</code> 支持多键查找。 续. <a href=https://github.com/ClickHouse/ClickHouse/pull/13015 rel="external nofollow noreferrer" target=_blank>#13015</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>如果为 <code class=syntax>Atomic</code> 数据库指定了 <code class=syntax>NO DELAY</code> 或 <code class=syntax>SYNC</code>, 则等待 <code class=syntax>DROP/DETACH TABLE</code> 实际完成. <a href=https://github.com/ClickHouse/ClickHouse/pull/15448 rel="external nofollow noreferrer" target=_blank>#15448</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>现在可以使用 <code class=syntax>ALTER</code> 查询更改 <code class=syntax>VersionedCollapsingMergeTree</code> 的版本列的类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/15442 rel="external nofollow noreferrer" target=_blank>#15442</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在复制表创建时展开 <code class=syntax>zookeeper_path</code> 中的 <code class=syntax>{database}</code>、<code class=syntax>{table}</code> 和 <code class=syntax>{uuid}</code> 宏. 如果在服务器重启后可能会破坏 <code class=syntax>zookeeper_path</code>, 不要允许 <code class=syntax>RENAME TABLE</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6917 rel="external nofollow noreferrer" target=_blank>#6917</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15348 rel="external nofollow noreferrer" target=_blank>#15348</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>函数 <code class=syntax>now</code> 允许使用时区参数. 这关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/15264 rel="external nofollow noreferrer" target=_blank>15264</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15285 rel="external nofollow noreferrer" target=_blank>#15285</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>在执行 <code class=syntax>/docker-entrypoint-initdb.d/</code> 中的所有脚本之前. 不允许连接到 ClickHouse 服务器. <a href=https://github.com/ClickHouse/ClickHouse/pull/15244 rel="external nofollow noreferrer" target=_blank>#15244</a> (<a href=https://github.com/alekseik1 rel="external nofollow noreferrer" target=_blank>Aleksei Kozharin</a>).</li> <li>向 <code class=syntax>EXPLAIN PLAN</code> 查询添加了 <code class=syntax>optimize</code> 设置. 如果启用, 则应用查询计划级别优化. 默认启用. <a href=https://github.com/ClickHouse/ClickHouse/pull/15201 rel="external nofollow noreferrer" target=_blank>#15201</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>CAST 参数数量错误的正确异常消息. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/13992 rel="external nofollow noreferrer" target=_blank>#13992</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15029 rel="external nofollow noreferrer" target=_blank>#15029</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加选项以在数据部分插入时禁用 TTL 移动. <a href=https://github.com/ClickHouse/ClickHouse/pull/15000 rel="external nofollow noreferrer" target=_blank>#15000</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>进行突变时忽略关键约束. 没有这个拉取请求, 当 <code class=syntax>force_index_by_date = 1</code> 或 <code class=syntax>force_primary_key = 1</code> 时不可能进行突变. <a href=https://github.com/ClickHouse/ClickHouse/pull/14973 rel="external nofollow noreferrer" target=_blank>#14973</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>如果之前的删除尝试由于 ZooKeeper 会话过期而失败, 则允许删除复制表. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11891 rel="external nofollow noreferrer" target=_blank>#11891</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14926 rel="external nofollow noreferrer" target=_blank>#14926</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了从分布式表中使用 SETTINGS 运行 SELECT 时过多的设置约束冲突. <a href=https://github.com/ClickHouse/ClickHouse/pull/14876 rel="external nofollow noreferrer" target=_blank>#14876</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>提供一个 <code class=syntax>load_balancing_first_offset</code> 查询设置来明确说明第一个副本是什么. 它与“FIRST_OR_RANDOM”负载均衡策略一起使用, 允许控制副本工作负载. <a href=https://github.com/ClickHouse/ClickHouse/pull/14867 rel="external nofollow noreferrer" target=_blank>#14867</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>在 <code class=syntax>EXPLAIN</code> 结果中显示 <code class=syntax>SET</code> 和 <code class=syntax>JOIN</code> 的子查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/14856 rel="external nofollow noreferrer" target=_blank>#14856</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>允许在存储 <code class=syntax>Distributed</code> 中使用多卷存储配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/14839 rel="external nofollow noreferrer" target=_blank>#14839</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>从相同的 timespec 构造 <code class=syntax>query_start_time</code> 和 <code class=syntax>query_start_time_microseconds</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14831 rel="external nofollow noreferrer" target=_blank>#14831</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>支持禁用 <code class=syntax>StorageJoin</code> 和 <code class=syntax>StorageSet</code> 的持久化, 这个特性是通过设置<code class=syntax>disable_set_and_join_persistency</code>来控制的. 这个 PR 解决了问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/6318 rel="external nofollow noreferrer" target=_blank>#6318</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14776 rel="external nofollow noreferrer" target=_blank>#14776</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>).</li> <li>现在 <code class=syntax>COLUMNS</code> 可用于包装列列表并在之后应用列转换器. <a href=https://github.com/ClickHouse/ClickHouse/pull/14775 rel="external nofollow noreferrer" target=_blank>#14775</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>将 <code class=syntax>merge_algorithm</code> 添加到 <code class=syntax>system.merges</code> 表以改进合并检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/14705 rel="external nofollow noreferrer" target=_blank>#14705</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复 zookeeper 存在 watch 导致的潜在内存泄漏. <a href=https://github.com/ClickHouse/ClickHouse/pull/14693 rel="external nofollow noreferrer" target=_blank>#14693</a> (<a href=https://github.com/hustnn rel="external nofollow noreferrer" target=_blank>hustnn</a>).</li> <li>允许并行执行分布式 DDL. <a href=https://github.com/ClickHouse/ClickHouse/pull/14684 rel="external nofollow noreferrer" target=_blank>#14684</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加 <code class=syntax>QueryMemoryLimitExceeded</code> 事件计数器. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14589 rel="external nofollow noreferrer" target=_blank>#14589</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14647 rel="external nofollow noreferrer" target=_blank>#14647</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>修复查询格式中的一些尾随空格. <a href=https://github.com/ClickHouse/ClickHouse/pull/14595 rel="external nofollow noreferrer" target=_blank>#14595</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>ClickHouse 对分区 expr 和键 expr 的处理方式不同. 分区 expr 用于构造包含相关列的 minmax 索引, 而主键 expr 存储为 expr. 有时用户可能会在更粗略的级别对表进行分区, 例如 <code class=syntax>partition by i / 1000</code>. 然而, 二元运算符不是单调的, 这个 PR 试图解决这个问题. 它也可能有益于其他用例. <a href=https://github.com/ClickHouse/ClickHouse/pull/14513 rel="external nofollow noreferrer" target=_blank>#14513</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>添加一个选项以跳过对 <code class=syntax>DiskS3</code> 的访问检查. <code class=syntax>s3</code> 磁盘是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/14497 rel="external nofollow noreferrer" target=_blank>#14497</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>如果有正在进行的 S3 请求, 则加快服务器关闭过程. <a href=https://github.com/ClickHouse/ClickHouse/pull/14496 rel="external nofollow noreferrer" target=_blank>#14496</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>如果重新加载失败并继续使用以前的 users.xml, <code class=syntax>SYSTEM RELOAD CONFIG</code> 现在会抛出异常. 如果重新加载失败, 后台定期重新加载也会继续使用以前的 users.xml. <a href=https://github.com/ClickHouse/ClickHouse/pull/14492 rel="external nofollow noreferrer" target=_blank>#14492</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>对于 <code class=syntax>clickhouse-client</code> 的脚本模式下带有 VALUES 格式的内联数据的 INSERT, 除了换行外, 还支持分号作为数据终止符. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/12288 rel="external nofollow noreferrer" target=_blank>#12288</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13192 rel="external nofollow noreferrer" target=_blank>#13192</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>支持紧凑部分的自定义编解码器. <a href=https://github.com/ClickHouse/ClickHouse/pull/12183 rel="external nofollow noreferrer" target=_blank>#12183</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=xing-neng-gai-jin_2>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_2 title="Permanent link"> </a></h4> <ul> <li>默认情况下为小零件启用紧凑零件. 这将允许稍微更有效地处理频繁插入 (4..100 次). <a href=https://github.com/ClickHouse/ClickHouse/pull/11913 rel="external nofollow noreferrer" target=_blank>#11913</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>提高 <code class=syntax>quantileTDigest</code> 性能. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/2668 rel="external nofollow noreferrer" target=_blank>#2668</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15542 rel="external nofollow noreferrer" target=_blank>#15542</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>显著减少 AggregatingInOrderTransform/optimize_aggregation_in_order 中的内存使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/15543 rel="external nofollow noreferrer" target=_blank>#15543</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>更快的 256 位乘法. <a href=https://github.com/ClickHouse/ClickHouse/pull/15418 rel="external nofollow noreferrer" target=_blank>#15418</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>使用 (u)int64_t 作为宽整数的基本类型提高 256 位类型的性能. 原始宽整数使用 8 位类型作为基数. <a href=https://github.com/ClickHouse/ClickHouse/pull/14859 rel="external nofollow noreferrer" target=_blank>#14859</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>显式使用临时磁盘存储垂直合并临时数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/15639 rel="external nofollow noreferrer" target=_blank>#15639</a> (<a href=https://github.com/GrigoryPervakov rel="external nofollow noreferrer" target=_blank>Grigory Pervakov</a>).</li> <li>在循环中使用一个 S3 DeleteObjects 请求而不是多个 DeleteObject. 没有任何功能更改, 因此由现有测试 (如集成/test_log_family_s3) 覆盖. <a href=https://github.com/ClickHouse/ClickHouse/pull/15238 rel="external nofollow noreferrer" target=_blank>#15238</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>修复 <code class=syntax>DateTime &lt;op&gt; DateTime</code> 错误地选择了缓慢的通用实现. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15153 rel="external nofollow noreferrer" target=_blank>#15153</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15178 rel="external nofollow noreferrer" target=_blank>#15178</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>提高 <code class=syntax>FixedString</code> 类型的 GROUP BY 键的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/15034 rel="external nofollow noreferrer" target=_blank>#15034</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>启动 clickhouse-server 时只有 <code class=syntax>mlock</code> 代码段. 在以前的版本中, 所有映射区域都被锁定在内存中, 包括调试信息. 调试信息通常被拆分为一个单独的文件, 但如果不是, 则会导致 +2..3 GiB 内存使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/14929 rel="external nofollow noreferrer" target=_blank>#14929</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>由于链接时间优化, ClickHouse 二进制文件变得更小.</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_4>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_4 title="Permanent link"> </a></h4> <ul> <li>现在我们使用 clang-11 进行生产 ClickHouse 构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/15239 rel="external nofollow noreferrer" target=_blank>#15239</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>现在我们使用 clang-11 在 CI 中构建 ClickHouse. <a href=https://github.com/ClickHouse/ClickHouse/pull/14846 rel="external nofollow noreferrer" target=_blank>#14846</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>将二进制构建 (Linux、Darwin、AArch64、FreeDSD) 切换到 clang-11. <a href=https://github.com/ClickHouse/ClickHouse/pull/15622 rel="external nofollow noreferrer" target=_blank>#15622</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>现在所有测试图像都使用 <code class=syntax>llvm-symbolizer-11</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15069 rel="external nofollow noreferrer" target=_blank>#15069</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>允许使用 llvm-11 构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/15366 rel="external nofollow noreferrer" target=_blank>#15366</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>从 <code class=syntax>clang-tidy-10</code> 切换到 <code class=syntax>clang-tidy-11</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/14922 rel="external nofollow noreferrer" target=_blank>#14922</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>默认使用 LLVM 的实验通行证管理器. <a href=https://github.com/ClickHouse/ClickHouse/pull/15608 rel="external nofollow noreferrer" target=_blank>#15608</a> (<a href=https://github.com/danlark1 rel="external nofollow noreferrer" target=_blank>Danila Kutenin</a>).</li> <li>不允许任何 C++ 翻译单元构建超过 10 分钟或使用超过 10 GB 或内存. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14925 rel="external nofollow noreferrer" target=_blank>#14925</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15060 rel="external nofollow noreferrer" target=_blank>#15060</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>通过拆分测试运行和配置文件运行, 使性能测试更加稳定和具有代表性. <a href=https://github.com/ClickHouse/ClickHouse/pull/15027 rel="external nofollow noreferrer" target=_blank>#15027</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>尝试使性能测试更可靠. 它是通过使用 <code class=syntax>madvise</code> 动态重新映射进程的可执行内存以使用透明大页面来完成的 - 它可以降低 iTLB 未命中的数量, 这是性能测试中不稳定的主要来源. <a href=https://github.com/ClickHouse/ClickHouse/pull/14685 rel="external nofollow noreferrer" target=_blank>#14685</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>转换为python3. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14886 rel="external nofollow noreferrer" target=_blank>#14886</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15007 rel="external nofollow noreferrer" target=_blank>#15007</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果服务器未能响应, 则在功能测试中尽早失败. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/15262 rel="external nofollow noreferrer" target=_blank>#15262</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15267 rel="external nofollow noreferrer" target=_blank>#15267</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>允许在没有配置的情况下运行 AArch64 版本的 clickhouse-server. 这有利于 <a href=https://github.com/ClickHouse/ClickHouse/issues/15174 rel="external nofollow noreferrer" target=_blank>#15174</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15266 rel="external nofollow noreferrer" target=_blank>#15266</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>CI docker 镜像的改进: 摆脱 ZooKeeper 和用于测试配置安装的单个脚本. <a href=https://github.com/ClickHouse/ClickHouse/pull/15215 rel="external nofollow noreferrer" target=_blank>#15215</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在快速测试脚本中修复 CMake 选项转发. 修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14711 rel="external nofollow noreferrer" target=_blank>#14711</a> 中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15155 rel="external nofollow noreferrer" target=_blank>#15155</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>添加了一个脚本以在单个命令中执行硬件基准测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/15115 rel="external nofollow noreferrer" target=_blank>#15115</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>将巨大的测试 <code class=syntax>test_dictionaries_all_layouts_and_sources</code> 拆分成较小的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/15110 rel="external nofollow noreferrer" target=_blank>#15110</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>也许修复 base64 中的 MSan 报告 (在带有 AVX-512 的服务器上). 这修复了. <a href=https://github.com/ClickHouse/ClickHouse/pull/15030 rel="external nofollow noreferrer" target=_blank>#15030</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>重新格式化和清理所有集成测试 *.py 文件中的代码. <a href=https://github.com/ClickHouse/ClickHouse/pull/14864 rel="external nofollow noreferrer" target=_blank>#14864</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>修复在 CI 中发现的 MaterializeMySQL 空事务不稳定测试用例. <a href=https://github.com/ClickHouse/ClickHouse/pull/14854 rel="external nofollow noreferrer" target=_blank>#14854</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>尝试加快构建速度. <a href=https://github.com/ClickHouse/ClickHouse/pull/14808 rel="external nofollow noreferrer" target=_blank>#14808</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>通过删除未使用的标头来加快构建速度. <a href=https://github.com/ClickHouse/ClickHouse/pull/14714 rel="external nofollow noreferrer" target=_blank>#14714</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 OSX 中的构建失败. <a href=https://github.com/ClickHouse/ClickHouse/pull/14761 rel="external nofollow noreferrer" target=_blank>#14761</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>如果在操作系统中找到 ccache, 则默认在 cmake 中启用. <a href=https://github.com/ClickHouse/ClickHouse/pull/14575 rel="external nofollow noreferrer" target=_blank>#14575</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Control CI 从 ClickHouse 存储库构建配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/14547 rel="external nofollow noreferrer" target=_blank>#14547</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在 CMake 文件中: - 将一些选项的描述部分移动到上面的注释中. - 替换 0 -&gt; <code class=syntax>OFF</code>, 1 -&gt; <code class=syntax>option</code> 的默认值中的 <code class=syntax>ON</code>. - 在选项中添加了一些说明和文档链接. - 替换了 <code class=syntax>FUZZER</code> 选项 (还有另一个选项 <code class=syntax>ENABLE_FUZZING</code> 也可以启用相同的功能). - 删除了 <code class=syntax>ENABLE_GTEST_LIBRARY</code> 选项, 因为有 <code class=syntax>ENABLE_TESTS</code>. 请参阅 PR 中的完整说明: <a href=https://github.com/ClickHouse/ClickHouse/pull/14711 rel="external nofollow noreferrer" target=_blank>#14711</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>使二进制文件更小 (调试版本约为 50 Mb). <a href=https://github.com/ClickHouse/ClickHouse/pull/14555 rel="external nofollow noreferrer" target=_blank>#14555</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>在 ConfigProcessor 中使用 std::filesystem::path 连接文件路径. <a href=https://github.com/ClickHouse/ClickHouse/pull/14558 rel="external nofollow noreferrer" target=_blank>#14558</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>使用负大整数调用时修复 <code class=syntax>bitShiftLeft()</code> 中的调试断言. <a href=https://github.com/ClickHouse/ClickHouse/pull/14697 rel="external nofollow noreferrer" target=_blank>#14697</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> </ul> <h2 id=clickhouse-ban-ben-20-9>ClickHouse 版本 20.9<a class=headerlink href=../amp/#clickhouse-ban-ben-20-9 title="Permanent link"> </a></h2> <h3 id=clickhouse-ban-ben-v20-9-7-11-stable-2020-12-07>ClickHouse 版本 v20.9.7.11-stable, 2020-12-07<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-9-7-11-stable-2020-12-07 title="Permanent link"> </a></h3> <h4 id=xing-neng-gai-jin_3>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_3 title="Permanent link"> </a></h4> <ul> <li>修复从 <code class=syntax>Merge</code> 表读取大量 <code class=syntax>MergeTree</code> 表的性能. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7748 rel="external nofollow noreferrer" target=_blank>#7748</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16988 rel="external nofollow noreferrer" target=_blank>#16988</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=bug-xiu-fu_10>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_10 title="Permanent link"> </a></h4> <ul> <li>如果禁用了<code class=syntax>in_memory_parts_enable_wal</code>, 则不要从 WAL 恢复部件. <a href=https://github.com/ClickHouse/ClickHouse/pull/17802 rel="external nofollow noreferrer" target=_blank>#17802</a> (<a href=https://github.com/detailyang rel="external nofollow noreferrer" target=_blank>detailyang</a>).</li> <li>修复了插入 <code class=syntax>Distributed</code> 表时空间不足时的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/17737 rel="external nofollow noreferrer" target=_blank>#17737</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了 ClickHouse 无法恢复与 MySQL 服务器的连接时的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17681 rel="external nofollow noreferrer" target=_blank>#17681</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>修复了在 Linux 的 Windows 子系统上运行的 ClickHouse 在 <code class=syntax>Atomic</code> 数据库中执行 <code class=syntax>RENAME</code> 查询时出现的 <code class=syntax>Function not implementation</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17661 rel="external nofollow noreferrer" target=_blank>#17661</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17664 rel="external nofollow noreferrer" target=_blank>#17664</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>当 clickhouse-client 用于多行查询的交互模式时, 单行注释被错误地扩展到查询结束. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13654 rel="external nofollow noreferrer" target=_blank>#13654</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17565 rel="external nofollow noreferrer" target=_blank>#17565</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复在极少数情况下服务器可以停止接受连接的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17542 rel="external nofollow noreferrer" target=_blank>#17542</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了当不同副本上的相应突变被杀死时 alter 查询挂起的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16953 rel="external nofollow noreferrer" target=_blank>#16953</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17499 rel="external nofollow noreferrer" target=_blank>#17499</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复 clickhouse 低估标记缓存大小时的错误. 当有很多带有标记的小文件时可能会发生. <a href=https://github.com/ClickHouse/ClickHouse/pull/17496 rel="external nofollow noreferrer" target=_blank>#17496</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了启用 <code class=syntax>optimize_redundant_functions_in_order_by</code> 设置的 <code class=syntax>ORDER BY</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/17471 rel="external nofollow noreferrer" target=_blank>#17471</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复 <code class=syntax>DISTINCT</code> 之后由于不正确优化而可能出现的重复项. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17294 rel="external nofollow noreferrer" target=_blank>#17294</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17296 rel="external nofollow noreferrer" target=_blank>#17296</a> (<a href=https://github.com/chengxianglibra rel="external nofollow noreferrer" target=_blank>li chengxiang</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/17439 rel="external nofollow noreferrer" target=_blank>#17439</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了从具有 <code class=syntax>LowCardinality</code> 类型的 <code class=syntax>JOIN</code> 表读取时崩溃的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17228 rel="external nofollow noreferrer" target=_blank>#17228</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17397 rel="external nofollow noreferrer" target=_blank>#17397</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复子查询中存在 const 列时设置索引失效的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17246 rel="external nofollow noreferrer" target=_blank>#17246</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17249 rel="external nofollow noreferrer" target=_blank>#17249</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复 ColumnConst 比较导致崩溃. 这个修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17088 rel="external nofollow noreferrer" target=_blank>#17088</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17135 rel="external nofollow noreferrer" target=_blank>#17135</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了在创建 <code class=syntax>some_table</code> 时 <code class=syntax>CREATE TABLE ... AS some_table</code> 查询崩溃 <code class=syntax>AS table_function()</code> 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16944 rel="external nofollow noreferrer" target=_blank>#16944</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17072 rel="external nofollow noreferrer" target=_blank>#17072</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>功能 fuzzBits 的 Bug 修复, 相关问题: <a href=https://github.com/ClickHouse/ClickHouse/issues/16980 rel="external nofollow noreferrer" target=_blank>#16980</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17051 rel="external nofollow noreferrer" target=_blank>#17051</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>避免远程查询的不必要的网络错误, 这些错误在执行时可能会被取消, 例如使用 <code class=syntax>LIMIT</code> 的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/17006 rel="external nofollow noreferrer" target=_blank>#17006</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>备忘录. <a href=https://github.com/ClickHouse/ClickHouse/pull/16866 rel="external nofollow noreferrer" target=_blank>#16866</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>通过 MySQL 协议返回 INSERT 查询的受影响行数. 以前 ClickHouse 过去总是返回 0, 它是固定的. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16605 rel="external nofollow noreferrer" target=_blank>#16605</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16715 rel="external nofollow noreferrer" target=_blank>#16715</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_5>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_5 title="Permanent link"> </a></h4> <ul> <li>将嵌入的时区数据更新到 2020d 版 (同时将 cctz 更新到最新的 master). <a href=https://github.com/ClickHouse/ClickHouse/pull/17204 rel="external nofollow noreferrer" target=_blank>#17204</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-9-6-14-stable-2020-11-20>ClickHouse 版本 v20.9.6.14-stable, 2020-11-20<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-9-6-14-stable-2020-11-20 title="Permanent link"> </a></h3> <h4 id=gai-jin_5>改进<a class=headerlink href=../amp/#gai-jin_5 title="Permanent link"> </a></h4> <ul> <li>可以连接到需要 SNI 的 <code class=syntax>clickhouse-server</code> 安全端点. 当 <code class=syntax>clickhouse-server</code> 托管在 TLS 代理之后是可能的. <a href=https://github.com/ClickHouse/ClickHouse/pull/16938 rel="external nofollow noreferrer" target=_blank>#16938</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>条件聚合函数 (例如：<code class=syntax>avgIf</code>、<code class=syntax>sumIf</code>、<code class=syntax>maxIf</code>) 在缺少行并使用可为空参数时应返回 <code class=syntax>NULL</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/13964 rel="external nofollow noreferrer" target=_blank>#13964</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> </ul> <h4 id=bug-xiu-fu_11>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_11 title="Permanent link"> </a></h4> <ul> <li>修复非领导者 ReplicatedMergeTree 表的 <code class=syntax>ON CLUSTER</code> 查询可能永远挂起的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/17089 rel="external nofollow noreferrer" target=_blank>#17089</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>出现错误时解析 <code class=syntax>format_avro_schema_registry_url</code> 的IP. <a href=https://github.com/ClickHouse/ClickHouse/pull/16985 rel="external nofollow noreferrer" target=_blank>#16985</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复在 <code class=syntax>ALTER TABLE ... MODIFY COLUMN ... NewType</code> 之后可能发生的服务器崩溃, 当 <code class=syntax>SELECT</code> 在更改列上具有 <code class=syntax>WHERE</code> 表达式并且更改尚未完成时. <a href=https://github.com/ClickHouse/ClickHouse/pull/16968 rel="external nofollow noreferrer" target=_blank>#16968</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>安装脚本应始终在 config 文件夹中创建子目录. 这仅与使用自定义配置的 Docker 构建相关. <a href=https://github.com/ClickHouse/ClickHouse/pull/16936 rel="external nofollow noreferrer" target=_blank>#16936</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复使用 <code class=syntax>ORDER BY</code> 的查询可能出现的错误 <code class=syntax>Illegal type of argument</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16580 rel="external nofollow noreferrer" target=_blank>#16580</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16928 rel="external nofollow noreferrer" target=_blank>#16928</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>如果没有数据写入 WriteBufferFromS3，则中止分段上传. <a href=https://github.com/ClickHouse/ClickHouse/pull/16840 rel="external nofollow noreferrer" target=_blank>#16840</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>修复在不带任何参数的情况下使用 <code class=syntax>any</code> 时的崩溃. 这是针对 <a href=https://github.com/ClickHouse/ClickHouse/issues/16803 rel="external nofollow noreferrer" target=_blank>#16803</a> 的 . cc @azat. <a href=https://github.com/ClickHouse/ClickHouse/pull/16826 rel="external nofollow noreferrer" target=_blank>#16826</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>在启用了 <code class=syntax>transform_null_in</code> 设置的情况下修复多个列和元组上的 <code class=syntax>IN</code> 运算符. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15310 rel="external nofollow noreferrer" target=_blank>#15310</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16722 rel="external nofollow noreferrer" target=_blank>#16722</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>这将修复 optimize_read_in_order/optimize_aggregation_in_order 与 max_threads&gt;0 和 ORDER BY 中的表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/16637 rel="external nofollow noreferrer" target=_blank>#16637</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16574 rel="external nofollow noreferrer" target=_blank>#16574</a>, 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16231 rel="external nofollow noreferrer" target=_blank>#16231</a>, 修复使用时远程查询失败'if'后缀聚合函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/16610 rel="external nofollow noreferrer" target=_blank>#16610</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>在异常的情况下查询完成得更快. 如果发生异常, 取消对远程副本的执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/15578 rel="external nofollow noreferrer" target=_blank>#15578</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-9-5-5-stable-2020-11-13>ClickHouse 版本 v20.9.5.5-stable, 2020-11-13<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-9-5-5-stable-2020-11-13 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_12>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_12 title="Permanent link"> </a></h4> <ul> <li>当查询分析器打开并且 ClickHouse 安装在操作系统上时, 修复罕见的无声崩溃, glibc 版本已经 (据说) 损坏了某些功能的异步展开表. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15301 rel="external nofollow noreferrer" target=_blank>#15301</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13098 rel="external nofollow noreferrer" target=_blank>#13098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16846 rel="external nofollow noreferrer" target=_blank>#16846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在, 当从输入解析 AVRO 时, LowCardinality 将从类型中删除. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16188 rel="external nofollow noreferrer" target=_blank>#16188</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16521 rel="external nofollow noreferrer" target=_blank>#16521</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>通过适当缩小 GTID 集，修复使用 MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine 和 MySQL Slave 上启用的 <code class=syntax>slave_parallel_worker</code> 时元数据的快速增长. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15951 rel="external nofollow noreferrer" target=_blank>#15951</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16504 rel="external nofollow noreferrer" target=_blank>#16504</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>).</li> <li>修复分布式的 DROP TABLE (使用 INSERT). <a href=https://github.com/ClickHouse/ClickHouse/pull/16409 rel="external nofollow noreferrer" target=_blank>#16409</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>复复制队列中非常大的条目的处理. 如果表结构非常大 (接近 1 MB), 则非常大的条目可能会出现在 ALTER 查询中. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16307 rel="external nofollow noreferrer" target=_blank>#16307</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16332 rel="external nofollow noreferrer" target=_blank>#16332</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了由于未创建过滤集而可能删除部分返回数据时的不一致行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/16308 rel="external nofollow noreferrer" target=_blank>#16308</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复 MySQL 数据库的错误. 当用作数据库引擎的 MySQL 服务器关闭时, 某些查询会引发异常, 因为它们试图从禁用的服务器获取表, 而这是不必要的. 例如, 查询 <code class=syntax>SELECT ... FROM system.parts</code> 应该只适用于 MergeTree 表并且根本不要接触 MySQL 数据库. <a href=https://github.com/ClickHouse/ClickHouse/pull/16032 rel="external nofollow noreferrer" target=_blank>#16032</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-9-4-76-stable-2020-10-29>ClickHouse 版本 v20.9.4.76-stable (2020-10-29)<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-9-4-76-stable-2020-10-29 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_13>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_13 title="Permanent link"> </a></h4> <ul> <li>在函数 <code class=syntax>dictGet</code> 出现异常时修复double free. 如果字典加载错误, 可能会发生这种情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/16429 rel="external nofollow noreferrer" target=_blank>#16429</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复由总数/汇总/多维数据集修饰符和最小/最大功能按键分组. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16393 rel="external nofollow noreferrer" target=_blank>#16393</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16397 rel="external nofollow noreferrer" target=_blank>#16397</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复异步分布式插入 w/prefer_localhost_replica=0 和 internal_replication. <a href=https://github.com/ClickHouse/ClickHouse/pull/16358 rel="external nofollow noreferrer" target=_blank>#16358</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复 TwoLevelStringHashTable 实现中的一个非常错误的代码, 这可能会导致内存泄漏. 我很惊讶这个 bug 怎么能潜伏这么久.... <a href=https://github.com/ClickHouse/ClickHouse/pull/16264 rel="external nofollow noreferrer" target=_blank>#16264</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复无论限制如何都可以过度分配内存的情况. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14560 rel="external nofollow noreferrer" target=_blank>#14560</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16206 rel="external nofollow noreferrer" target=_blank>#16206</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>ReplicatedVersionedCollapsingMergeTree</code> 的 <code class=syntax>ALTER MODIFY ... ORDER BY</code> 查询挂起. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15980 rel="external nofollow noreferrer" target=_blank>#15980</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16011 rel="external nofollow noreferrer" target=_blank>#16011</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复整理名称和字符集名称解析器并支持字符串类型的 <code class=syntax>length = 0</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16008 rel="external nofollow noreferrer" target=_blank>#16008</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>允许对具有复杂键的字典使用直接布局. <a href=https://github.com/ClickHouse/ClickHouse/pull/16007 rel="external nofollow noreferrer" target=_blank>#16007</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>在一段时间不活动后发生复制错误时, 防止副本挂起 5-10 分钟. <a href=https://github.com/ClickHouse/ClickHouse/pull/15987 rel="external nofollow noreferrer" target=_blank>#15987</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>在插入或从 MaterializedView 中选择并同时删除目标表时修复罕见的段错误 (适用于原子数据库引擎). <a href=https://github.com/ClickHouse/ClickHouse/pull/15984 rel="external nofollow noreferrer" target=_blank>#15984</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复解析设置配置文件时的歧义: <code class=syntax>CREATE USER ... SETTINGS profile readonly</code> 现在被视为使用名为 <code class=syntax>readonly</code> 的配置文件, 而不是名为 <code class=syntax>profile</code> 的具有只读约束的设置. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15628 rel="external nofollow noreferrer" target=_blank>#15628</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15982 rel="external nofollow noreferrer" target=_blank>#15982</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复数据库创建失败时的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/15954 rel="external nofollow noreferrer" target=_blank>#15954</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了当表被并发重命名 (对于原子数据库引擎) 时, <code class=syntax>DROP TABLE IF EXISTS</code> 失败并带有 <code class=syntax>Table ... does not exist</code> 错误的问题. 修复了并发执行具有多个表的某些 DDL 查询 (如 <code class=syntax>DROP DATABASE”和“RENAME TABLE</code> )时罕见的死锁 修复了并发执行 <code class=syntax>DROP/DETACH TABLE</code> 时 <code class=syntax>Table ... does not exist</code> 的 <code class=syntax>DROP/DETACH DATABASE</code> 失败 `. <a href=https://github.com/ClickHouse/ClickHouse/pull/15934 rel="external nofollow noreferrer" target=_blank>#15934</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>如果查询具有 <code class=syntax>WHERE</code>、<code class=syntax>PREWHERE</code> 和 <code class=syntax>GLOBAL IN</code>, 则修复来自 <code class=syntax>Distributed</code> 表的查询的错误空结果. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15792 rel="external nofollow noreferrer" target=_blank>#15792</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15933 rel="external nofollow noreferrer" target=_blank>#15933</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 RBAC 中可能的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/15875 rel="external nofollow noreferrer" target=_blank>#15875</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复在 <code class=syntax>ALTER MODIFY COLUMN</code> 查询之后执行的 <code class=syntax>SELECT ... ORDER BY DESC</code> 查询中的异常 <code class=syntax>Block structure mismatch</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15800 rel="external nofollow noreferrer" target=_blank>#15800</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15852 rel="external nofollow noreferrer" target=_blank>#15852</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复 MaterializeMySQL 的 <code class=syntax>select count()</code> 不准确. <a href=https://github.com/ClickHouse/ClickHouse/pull/15767 rel="external nofollow noreferrer" target=_blank>#15767</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复某些查询情况, 其中仅选择虚拟列. 以前可能会抛出 <code class=syntax>Not found column _nothing in block</code> 异常. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12298 rel="external nofollow noreferrer" target=_blank>#12298</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15756 rel="external nofollow noreferrer" target=_blank>#15756</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 <code class=syntax>max_replicated_logs_to_keep</code> 设置的默认值过低, 这可能导致副本过于频繁地丢失. 通过选择要克隆的最新副本来改进丢失的副本恢复过程. 也不要从丢失的复制品中取出旧零件, 而是将它们拆下. <a href=https://github.com/ClickHouse/ClickHouse/pull/15701 rel="external nofollow noreferrer" target=_blank>#15701</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复错误 <code class=syntax>Cannot add simple transform to empty Pipe</code> ，该错误在从与目标表结构不同的 <code class=syntax>Buffer</code> 表中读取时发生. 如果目标表返回空的查询结果是可能的. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15529 rel="external nofollow noreferrer" target=_blank>#15529</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15662 rel="external nofollow noreferrer" target=_blank>#15662</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 S3 表函数中的 globs 错误，URL 中的区域未应用于 S3 客户端配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/15646 rel="external nofollow noreferrer" target=_blank>#15646</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>分离只读表时递减 <code class=syntax>ReadonlyReplica</code> 指标. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15598 rel="external nofollow noreferrer" target=_blank>#15598</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15592 rel="external nofollow noreferrer" target=_blank>#15592</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>将单个参数传递给 ReplicatedMergeTree 而不是忽略它时抛出错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15516 rel="external nofollow noreferrer" target=_blank>#15516</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> </ul> <h4 id=gai-jin_6>改进<a class=headerlink href=../amp/#gai-jin_6 title="Permanent link"> </a></h4> <ul> <li>现在, 无论集群配置中的 <code class=syntax>&lt;internal_replication&gt;</code> 设置如何，都可以执行 <code class=syntax>ALTER ... ON CLUSTER</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/16075 rel="external nofollow noreferrer" target=_blank>#16075</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在创建表时在 <code class=syntax>ReplicatedMergeTree</code> 参数中展开 <code class=syntax>{database}</code>、<code class=syntax>{table}</code> 和 <code class=syntax>{uuid}</code> 宏. <a href=https://github.com/ClickHouse/ClickHouse/pull/16160 rel="external nofollow noreferrer" target=_blank>#16160</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-9-3-45-stable-2020-10-09>ClickHouse 版本 v20.9.3.45-stable (2020-10-09)<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-9-3-45-stable-2020-10-09 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_14>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_14 title="Permanent link"> </a></h4> <ul> <li>修复错误 <code class=syntax>Cannot find column</code> , 如果对 <code class=syntax>MV</code> 的查询包含 <code class=syntax>ARRAY JOIN</code> , 则在插入<code class=syntax>MATERIALIZED VIEW</code> 时可能会发生该错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15717 rel="external nofollow noreferrer" target=_blank>#15717</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 AMQP-CPP 中的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/15667 rel="external nofollow noreferrer" target=_blank>#15667</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复查询计划的 ReadFromStorage 步骤中资源的销毁顺序. 在极少数情况下, 它可能会导致崩溃. 可能与<a href=https://github.com/ClickHouse/ClickHouse/issues/15610 rel="external nofollow noreferrer" target=_blank>#15610</a>有关. <a href=https://github.com/ClickHouse/ClickHouse/pull/15645 rel="external nofollow noreferrer" target=_blank>#15645</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了使用 <code class=syntax>JSON*</code> 函数时会导致 <code class=syntax>VALUES</code>、<code class=syntax>LIMIT</code>或 <code class=syntax>IN</code> 运算符右侧的 <code class=syntax>Element ... is not a constant expression</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15589 rel="external nofollow noreferrer" target=_blank>#15589</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>防止出现错误消息 <code class=syntax>Could not calculate available disk space (statvfs), errno: 4, strerror: Interrupted system call</code> 的可能性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15541 rel="external nofollow noreferrer" target=_blank>#15541</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15557 rel="external nofollow noreferrer" target=_blank>#15557</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>显著减少 AggregatingInOrderTransform/optimize_aggregation_in_order 中的内存使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/15543 rel="external nofollow noreferrer" target=_blank>#15543</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Mutation 可能会在 <code class=syntax>MOVE</code> 或 <code class=syntax>REPLACE PARTITION</code> 之后等待一些不存在的部分, 或者在极少数情况下, 在 <code class=syntax>DETACH</code> 或 <code class=syntax>DROP PARTITION</code> 之后挂起. 已修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/15537 rel="external nofollow noreferrer" target=_blank>#15537</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复如果执行具有相同模式的 <code class=syntax>LIKE</code> , 则 <code class=syntax>LIKE</code> 运算符不再区分大小写的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15536 rel="external nofollow noreferrer" target=_blank>#15536</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在选择数据中不存在但依赖于数据中也不存在的其他列时修复 <code class=syntax>Missing columns</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15530 rel="external nofollow noreferrer" target=_blank>#15530</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15532 rel="external nofollow noreferrer" target=_blank>#15532</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 DDLWorker 中事件订阅的错误, 该错误很少会导致查询在 <code class=syntax>ON CLUSTER</code> 中挂起. 引入 <a href=https://github.com/ClickHouse/ClickHouse/issues/13450 rel="external nofollow noreferrer" target=_blank>#13450</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15477 rel="external nofollow noreferrer" target=_blank>#15477</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>当 <code class=syntax>boundingRatio</code> 聚合函数的第二个参数类型错误时报告正确的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15407 rel="external nofollow noreferrer" target=_blank>#15407</a> (<a href=https://github.com/detailyang rel="external nofollow noreferrer" target=_blank>detailyang</a>).</li> <li>修复诸如 <code class=syntax>SELECT toStartOfDay(today())</code> 之类的查询失败抱怨空 time_zone 参数的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15319 rel="external nofollow noreferrer" target=_blank>#15319</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>修复合并树表重命名和背景清理过程中的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/15304 rel="external nofollow noreferrer" target=_blank>#15304</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复启用 system.logs 时服务器启动时罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/15300 rel="external nofollow noreferrer" target=_blank>#15300</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复 QueryLog 中的 MSan 报告. 未初始化的内存可用于 <code class=syntax>memory_usage</code> 字段. <a href=https://github.com/ClickHouse/ClickHouse/pull/15258 rel="external nofollow noreferrer" target=_blank>#15258</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复将 joinGet 与 LowCardinality 类型一起使用时的实例崩溃. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15214 rel="external nofollow noreferrer" target=_blank>#15214</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15220 rel="external nofollow noreferrer" target=_blank>#15220</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复表引擎 <code class=syntax>Buffer</code> 中的错误, 该错误不允许在 <code class=syntax>ALTER</code> 查询后将新结构的数据插入到 <code class=syntax>Buffer</code> 中. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15117 rel="external nofollow noreferrer" target=_blank>#15117</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15192 rel="external nofollow noreferrer" target=_blank>#15192</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>调整mysql列定义包中的decimals字段大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/15152 rel="external nofollow noreferrer" target=_blank>#15152</a> (<a href=https://github.com/maqroll rel="external nofollow noreferrer" target=_blank>maqroll</a>).</li> <li>修复了在 Mac OS 上的 docker 中运行 clickhouse-server 时, 在原子数据库中执行 DDL 查询时出现的 <code class=syntax>Cannot rename ... errno: 22, strerror: Invalid argument</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15024 rel="external nofollow noreferrer" target=_blank>#15024</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了当子查询包含 finalizeAggregation 函数时使谓词下推工作的问题.修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14847 rel="external nofollow noreferrer" target=_blank>#14847</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14937 rel="external nofollow noreferrer" target=_blank>#14937</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>如果必须从 ZK 获取配置文件 (使用 <code class=syntax>from_zk</code> 包含选项), 则修复服务器在与 ZooKeeper 交谈时可能会在启动时卡住的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14814 rel="external nofollow noreferrer" target=_blank>#14814</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14843 rel="external nofollow noreferrer" target=_blank>#14843</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> </ul> <h4 id=gai-jin_7>改进<a class=headerlink href=../amp/#gai-jin_7 title="Permanent link"> </a></h4> <ul> <li>现在可以使用 <code class=syntax>ALTER</code> 查询更改 <code class=syntax>VersionedCollapsingMergeTree</code> 的版本列的类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/15442 rel="external nofollow noreferrer" target=_blank>#15442</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-9-2-20-2020-09-22>ClickHouse 版本 v20.9.2.20, 2020-09-22<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-9-2-20-2020-09-22 title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng_3>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng_3 title="Permanent link"> </a></h4> <ul> <li>从20.5以上的版本升级时, 如果进行滚动更新, 集群同时包含20.5以上和20.5以下的版本, 如果旧版本的ClickHouse节点重启, 旧版本在新版本存在的情况下启动, 可能会导致 到 <code class=syntax>Part ... intersects previous part</code> 错误. 为防止出现此错误, 首先在所有集群节点上安装更新的 clickhouse-server 软件包, 然后重新启动 (因此, 当 clickhouse-server 重新启动时, 它将以新版本启动).</li> </ul> <h4 id=xin-te-zheng_3>新特征<a class=headerlink href=../amp/#xin-te-zheng_3 title="Permanent link"> </a></h4> <ul> <li>添加了列转换器<code class=syntax>EXCEPT</code>、<code class=syntax>REPLACE</code>、<code class=syntax>APPLY</code>, 可以应用于所选列的列表 (在<code class=syntax>*</code> 或<code class=syntax>COLUMNS(...)</code> 之后). 例如, 您可以编写 <code class=syntax>SELECT * EXCEPT(URL) REPLACE(number + 1 AS number)</code>. 另一个例子: <code class=syntax>select * apply(length) apply(max) from wide_string_table</code> 找出所有字符串列的最大长度. <a href=https://github.com/ClickHouse/ClickHouse/pull/14233 rel="external nofollow noreferrer" target=_blank>#14233</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>添加了一个聚合函数 <code class=syntax>rankCorr</code>, 用于计算秩相关系数. <a href=https://github.com/ClickHouse/ClickHouse/pull/11769 rel="external nofollow noreferrer" target=_blank>#11769</a> (<a href=https://github.com/antikvist rel="external nofollow noreferrer" target=_blank>antikvist</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/14411 rel="external nofollow noreferrer" target=_blank>#14411</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>添加了表函数 <code class=syntax>view</code>, 它将子查询转换为表对象. 这有助于传递查询. 例如, 它可以用于远程/集群表功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/12567 rel="external nofollow noreferrer" target=_blank>#12567</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> </ul> <h4 id=bug-xiu-fu_15>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_15 title="Permanent link"> </a></h4> <ul> <li>修复了在赋值表达式和常量值 (如 <code class=syntax>UPDATE x = 42</code> )中使用 Nullable 列的 <code class=syntax>ALTER UPDATE</code> 突变导致列或段错误中的值不正确时的错误. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/13634 rel="external nofollow noreferrer" target=_blank>#13634</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/14045 rel="external nofollow noreferrer" target=_blank>#14045</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14646 rel="external nofollow noreferrer" target=_blank>#14646</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了错误的十进制乘法结果导致结果列小数位数错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/14603 rel="external nofollow noreferrer" target=_blank>#14603</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了 <code class=syntax>Nullable</code> 列不正确的排序顺序. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14344 rel="external nofollow noreferrer" target=_blank>#14344</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14495 rel="external nofollow noreferrer" target=_blank>#14495</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复了索引分析中与类型为 <code class=syntax>FixedString</code> 的主键的比较不一致的问题, 如果它们与较小的字符串进行比较. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14908 rel="external nofollow noreferrer" target=_blank>#14908</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15033 rel="external nofollow noreferrer" target=_blank>#15033</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了如果表具有单个部分的分区会导致错误的合并分配的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/14444 rel="external nofollow noreferrer" target=_blank>#14444</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>如果使用专门设计的参数调用函数 <code class=syntax>bar</code>, 则可能会发生缓冲区溢出. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/13926 rel="external nofollow noreferrer" target=_blank>#13926</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15028 rel="external nofollow noreferrer" target=_blank>#15028</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 <code class=syntax>system.asynchronous_metrics</code> 中发布每个逻辑核心的 CPU 频率. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14923 rel="external nofollow noreferrer" target=_blank>#14923</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14924 rel="external nofollow noreferrer" target=_blank>#14924</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>修复了使用 <code class=syntax>MaterializeMySQL</code> 数据库引擎时 <code class=syntax>.metadata.tmp File exists</code> 的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/14898 rel="external nofollow noreferrer" target=_blank>#14898</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复部分调用 <code class=syntax>extractAllGroups</code> 函数可能触发 <code class=syntax>Memory limit exceeded</code> 错误的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13383 rel="external nofollow noreferrer" target=_blank>#13383</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14889 rel="external nofollow noreferrer" target=_blank>#14889</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 SIGSEGV 以尝试插入 StorageFile(fd). <a href=https://github.com/ClickHouse/ClickHouse/pull/14887 rel="external nofollow noreferrer" target=_blank>#14887</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>当被查询的列具有 <code class=syntax>DEFAULT</code> 表达式时, 修复 <code class=syntax>SELECT</code> 查询中的罕见错误, 该表达式依赖于另一列, 该列也具有 <code class=syntax>DEFAULT</code> 并且不存在于选择查询中且不存在于磁盘上. 部分修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14531 rel="external nofollow noreferrer" target=_blank>#14531</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14845 rel="external nofollow noreferrer" target=_blank>#14845</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了收缩的<code class=syntax>Int -&gt; Int</code> 签名类型转换的错误单调性检测. 可能会导致查询结果不正确. 此错误在 <a href=https://github.com/ClickHouse/ClickHouse/issues/14513 rel="external nofollow noreferrer" target=_blank>#14513</a> 中公布. <a href=https://github.com/ClickHouse/ClickHouse/pull/14783 rel="external nofollow noreferrer" target=_blank>#14783</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了执行 <code class=syntax>ALTER ... MODIFY QUERY</code> 时物化视图元数据中丢失的默认数据库名称. <a href=https://github.com/ClickHouse/ClickHouse/pull/14664 rel="external nofollow noreferrer" target=_blank>#14664</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复当涉及 LowCardinality 和 Nullable 类型时函数 <code class=syntax>has</code> 可能不正确的结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/14591 rel="external nofollow noreferrer" target=_blank>#14591</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>在使用 ReplicatedMergeTree Engine 对表进行 CREATE 查询期间, 在 Zookeeper 异常后清理数据目录. <a href=https://github.com/ClickHouse/ClickHouse/pull/14563 rel="external nofollow noreferrer" target=_blank>#14563</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>修复带有组合子 <code class=syntax>-Resample</code> 的函数中罕见的段错误, 这可能会出现在参数非常大的溢出结果中. <a href=https://github.com/ClickHouse/ClickHouse/pull/14562 rel="external nofollow noreferrer" target=_blank>#14562</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>检查 <code class=syntax>topK</code> 聚合函数中的数组大小溢出. 如果没有此检查, 用户可能会发送带有精心设计的参数的查询, 这将导致服务器崩溃. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14452 rel="external nofollow noreferrer" target=_blank>#14452</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14467 rel="external nofollow noreferrer" target=_blank>#14467</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>代理重启/启动/停止/重新加载 SysVinit 到 systemd (如果使用). <a href=https://github.com/ClickHouse/ClickHouse/pull/14460 rel="external nofollow noreferrer" target=_blank>#14460</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果 PipelineExecutor 本身发生异常, 则停止查询执行. 这可以防止罕见的查询挂起. <a href=https://github.com/ClickHouse/ClickHouse/pull/14334 rel="external nofollow noreferrer" target=_blank>#14334</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/14402 rel="external nofollow noreferrer" target=_blank>#14402</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复在创建为 <code class=syntax>AS table_function</code> 的表的 <code class=syntax>ALTER</code> 查询期间崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14212 rel="external nofollow noreferrer" target=_blank>#14212</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14326 rel="external nofollow noreferrer" target=_blank>#14326</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>使用 REFRESH 命令修复 ALTER LIVE VIEW 查询期间的异常. LIVE VIEW 是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/14320 rel="external nofollow noreferrer" target=_blank>#14320</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>修复带有嵌套解释器的查询的 QueryPlan 生命周期 (对于 EXPLAIN PIPELINE graph=1). <a href=https://github.com/ClickHouse/ClickHouse/pull/14315 rel="external nofollow noreferrer" target=_blank>#14315</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>更好地检查 SSD 缓存复杂键外部字典中的元组大小. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13981 rel="external nofollow noreferrer" target=_blank>#13981</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14313 rel="external nofollow noreferrer" target=_blank>#14313</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 <code class=syntax>ALIAS</code> 列类型上不允许使用 <code class=syntax>CODEC</code> . 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/13911 rel="external nofollow noreferrer" target=_blank>#13911</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14263 rel="external nofollow noreferrer" target=_blank>#14263</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>在非全局级别执行时修复 GRANT ALL 语句. <a href=https://github.com/ClickHouse/ClickHouse/pull/13987 rel="external nofollow noreferrer" target=_blank>#13987</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复 lambda 中的 arrayJoin() 捕获 (抛出逻辑错误消息的异常). <a href=https://github.com/ClickHouse/ClickHouse/pull/13792 rel="external nofollow noreferrer" target=_blank>#13792</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> </ul> <h4 id=shi-yan-gong-neng_2>实验功能<a class=headerlink href=../amp/#shi-yan-gong-neng_2 title="Permanent link"> </a></h4> <ul> <li>通过给定的 SELECT 查询添加了用于随机数据库生成的 <code class=syntax>db-generator</code> 工具. 当用户只有不完整的错误报告时, 它可能有助于重现问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/14442 rel="external nofollow noreferrer" target=_blank>#14442</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>) <a href=https://github.com/ClickHouse/ClickHouse/issues/10973 rel="external nofollow noreferrer" target=_blank>#10973</a> (<a href=https://github.com/ZeDRoman rel="external nofollow noreferrer" target=_blank>ZeDRoman</a>).</li> </ul> <h4 id=gai-jin_8>改进<a class=headerlink href=../amp/#gai-jin_8 title="Permanent link"> </a></h4> <ul> <li>允许在分布式存储中使用多卷存储配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/14839 rel="external nofollow noreferrer" target=_blank>#14839</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>禁止在 <code class=syntax>toStartOf*</code> 类型的函数中使用空的 time_zone 参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/14509 rel="external nofollow noreferrer" target=_blank>#14509</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>MySQL 处理程序为诸如 <code class=syntax>SET @@var = value</code> 之类的查询返回 <code class=syntax>OK</code>. 此类声明被忽略. 这是必需的, 因为某些 MySQL 驱动程序会在握手后发送 <code class=syntax>SET @@</code> 查询以进行设置 <a href=https://github.com/ClickHouse/ClickHouse/issues/9336#issuecomment-686222422 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/9336#issuecomment-686222422</a> . <a href=https://github.com/ClickHouse/ClickHouse/pull/14469 rel="external nofollow noreferrer" target=_blank>#14469</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>).</li> <li>现在, 如果之前没有实现 TTL, 将在合并期间应用它们. <a href=https://github.com/ClickHouse/ClickHouse/pull/14438 rel="external nofollow noreferrer" target=_blank>#14438</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>现在 <code class=syntax>clickhouse-obfuscator</code> 支持 <a href=https://github.com/ClickHouse/ClickHouse/issues/13163 rel="external nofollow noreferrer" target=_blank>#13163</a> 中提出的 UUID 类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/14409 rel="external nofollow noreferrer" target=_blank>#14409</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>).</li> <li>添加了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11384 rel="external nofollow noreferrer" target=_blank>#11384</a> 中提出的新设置 <code class=syntax>system_events_show_zero_values</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14404 rel="external nofollow noreferrer" target=_blank>#14404</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>).</li> <li>在 <code class=syntax>MaterializeMySQL</code> 中将主键隐式转换为非空 (与 <code class=syntax>MySQL</code> 相同). 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14114 rel="external nofollow noreferrer" target=_blank>#14114</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14397 rel="external nofollow noreferrer" target=_blank>#14397</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>用 <a href=https://github.com/cerevra/int target=_blank>https://github.com/cerevra/int</a> 的实现替换 boost multiprecision 中的宽整数 (256 位). 256 位整数是实验性的. <a href=https://github.com/ClickHouse/ClickHouse/pull/14229 rel="external nofollow noreferrer" target=_blank>#14229</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>为 <code class=syntax>system.part_log</code> 中的部分添加默认压缩编解码器, 名称为 <code class=syntax>default_compression_codec</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14116 rel="external nofollow noreferrer" target=_blank>#14116</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>为<code class=syntax>DateTime</code> 类型添加精度参数. 它允许使用 <code class=syntax>DateTime</code> 名称代替 <code class=syntax>DateTime64</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13761 rel="external nofollow noreferrer" target=_blank>#13761</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>为 Redis 外部字典添加了 requirepass 授权. <a href=https://github.com/ClickHouse/ClickHouse/pull/13688 rel="external nofollow noreferrer" target=_blank>#13688</a> (<a href=https://github.com/it1804 rel="external nofollow noreferrer" target=_blank>Ivan Torgashov</a>).</li> <li>RabbitMQ 引擎的改进: 添加了连接和通道故障处理、正确提交、插入故障处理、更好的交换、队列持久性和队列恢复机会、新的队列设置. 固定测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/12761 rel="external nofollow noreferrer" target=_blank>#12761</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>支持紧凑部分的自定义编解码器. <a href=https://github.com/ClickHouse/ClickHouse/pull/12183 rel="external nofollow noreferrer" target=_blank>#12183</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=xing-neng-gai-jin_4>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_4 title="Permanent link"> </a></h4> <ul> <li>使用 LIMIT/LIMIT BY/ORDER BY 优化查询以使用 GROUP BY sharding_key (在 <code class=syntax>optimize_skip_unused_shards</code> 和 <code class=syntax>optimize_distributed_group_by_sharding_key</code> 下). <a href=https://github.com/ClickHouse/ClickHouse/pull/10373 rel="external nofollow noreferrer" target=_blank>#10373</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>为多个 <code class=syntax>JOIN</code> 和 <code class=syntax>IN</code> 并行创建集合. 它可能会稍微提高具有几种不同 <code class=syntax>IN subquery</code> 表达式的查询的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/14412 rel="external nofollow noreferrer" target=_blank>#14412</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>通过为每个消费者提供独立线程来提高 Kafka 引擎性能. 流引擎的单独线程池 (如 Kafka). <a href=https://github.com/ClickHouse/ClickHouse/pull/13939 rel="external nofollow noreferrer" target=_blank>#13939</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_6>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_6 title="Permanent link"> </a></h4> <ul> <li>通过从 <code class=syntax>Functions</code> 中删除调试信息来降低调试构建中的二进制大小. 只有 Yandex 中使用非常旧的链接器的一个内部项目才需要这样做. <a href=https://github.com/ClickHouse/ClickHouse/pull/14549 rel="external nofollow noreferrer" target=_blank>#14549</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>准备使用 clang 11 进行构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/14455 rel="external nofollow noreferrer" target=_blank>#14455</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复反向移植脚本中的逻辑. 在以前的版本中, 任何 100% 红色的标签都会触发它. 这很奇怪. <a href=https://github.com/ClickHouse/ClickHouse/pull/14433 rel="external nofollow noreferrer" target=_blank>#14433</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>集成测试使用默认的基本配置. 所有配置更改都是显式的, 例如 main_configs、user_configs 和字典参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/13647 rel="external nofollow noreferrer" target=_blank>#13647</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> </ul> <h2 id=clickhouse-ban-ben-20-8>ClickHouse 版本 20.8<a class=headerlink href=../amp/#clickhouse-ban-ben-20-8 title="Permanent link"> </a></h2> <h3 id=clickhouse-ban-ben-v20-8-12-2-lts-2021-01-16>ClickHouse 版本 v20.8.12.2-lts, 2021-01-16<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-8-12-2-lts-2021-01-16 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_16>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_16 title="Permanent link"> </a></h4> <ul> <li>修复 *If 具有一元函数和 Nullable 类型的组合器. <a href=https://github.com/ClickHouse/ClickHouse/pull/18806 rel="external nofollow noreferrer" target=_blank>#18806</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>限制从宽部分合并到紧凑部分. 在垂直合并的情况下, 它会导致结果部分损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/18381 rel="external nofollow noreferrer" target=_blank>#18381</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-8-11-17-lts-2020-12-25>ClickHouse 版本 v20.8.11.17-lts, 2020-12-25<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-8-11-17-lts-2020-12-25 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_17>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_17 title="Permanent link"> </a></h4> <ul> <li>在合并期间禁用 AIO 写入, 因为它会导致合并期间主键列的数据损坏极为罕见. <a href=https://github.com/ClickHouse/ClickHouse/pull/18481 rel="external nofollow noreferrer" target=_blank>#18481</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了在使用类型为 Nullable(String) 的参数执行 <code class=syntax>toType(...)</code> 函数 (<code class=syntax>toDate</code>、<code class=syntax>toUInt32</code> 等) 时出现的 <code class=syntax>value is too short</code> 错误. 现在这些函数在解析错误时返回 <code class=syntax>NULL</code> 而不是抛出异常. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7673 rel="external nofollow noreferrer" target=_blank>#7673</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18445 rel="external nofollow noreferrer" target=_blank>#18445</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>使用组合子 <code class=syntax>Distinct</code> 修复聚合函数中可能的崩溃, 同时使用两级聚合. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/17682 rel="external nofollow noreferrer" target=_blank>#17682</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/18365 rel="external nofollow noreferrer" target=_blank>#18365</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-8-10-13-lts-2020-12-24>ClickHouse 版本 v20.8.10.13-lts, 2020-12-24<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-8-10-13-lts-2020-12-24 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_18>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_18 title="Permanent link"> </a></h4> <ul> <li>当使用 <code class=syntax>logger.size</code> 参数配置服务器日志轮换并且数值大于 2^32 时, 日志没有正确轮换. <a href=https://github.com/ClickHouse/ClickHouse/pull/17905 rel="external nofollow noreferrer" target=_blank>#17905</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>使用 <code class=syntax>min_compress_block_size</code> 修复了 MergeTreeWriterSettings 中 <code class=syntax>max_compress_block_size</code> 的错误初始化. <a href=https://github.com/ClickHouse/ClickHouse/pull/17833 rel="external nofollow noreferrer" target=_blank>#17833</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>修复了 ClickHouse 无法恢复与 MySQL 服务器的连接时的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17681 rel="external nofollow noreferrer" target=_blank>#17681</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>修复了在不同副本上杀死相应突变时的“ALTER”查询挂起. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16953 rel="external nofollow noreferrer" target=_blank>#16953</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17499 rel="external nofollow noreferrer" target=_blank>#17499</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 ClickHouse 低估标记缓存大小时的错误. 当有很多带有标记的小文件时可能会发生. <a href=https://github.com/ClickHouse/ClickHouse/pull/17496 rel="external nofollow noreferrer" target=_blank>#17496</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了启用设置 <code class=syntax>optimize_redundant_functions_in_order_by</code> 的 <code class=syntax>ORDER BY</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/17471 rel="external nofollow noreferrer" target=_blank>#17471</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了导致崩溃的 <code class=syntax>ColumnConst</code> 比较. 这个修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/17088 rel="external nofollow noreferrer" target=_blank>#17088</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/17135 rel="external nofollow noreferrer" target=_blank>#17135</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了非领导者 ReplicatedMergeTreeTables 的<code class=syntax>ON CLUSTER</code> 查询可能永远挂起的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/17089 rel="external nofollow noreferrer" target=_blank>#17089</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>避免远程查询的不必要的网络错误, 这些错误在执行时可能会被取消, 例如使用 <code class=syntax>LIMIT</code> 的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/17006 rel="external nofollow noreferrer" target=_blank>#17006</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>出现错误时解析 <code class=syntax>format_avro_schema_registry_url</code> 的IP. <a href=https://github.com/ClickHouse/ClickHouse/pull/16985 rel="external nofollow noreferrer" target=_blank>#16985</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复了在 <code class=syntax>ALTER TABLE ... MODIFY COLUMN ... NewType</code> 之后, 当 <code class=syntax>SELECT</code> 在更改列上具有 <code class=syntax>WHERE</code> 表达式并且更改尚未完成时可能出现的服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/16968 rel="external nofollow noreferrer" target=_blank>#16968</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>安装脚本应始终在 config 文件夹中创建子目录. 这仅与使用自定义配置的 Docker 构建相关. <a href=https://github.com/ClickHouse/ClickHouse/pull/16936 rel="external nofollow noreferrer" target=_blank>#16936</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复了使用 <code class=syntax>ORDER BY</code> 的查询可能出现的错误 <code class=syntax>Illegal type of argument</code> 。 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16580 rel="external nofollow noreferrer" target=_blank>#16580</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16928 rel="external nofollow noreferrer" target=_blank>#16928</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>如果没有数据写入 WriteBufferFromS3，则中止分段上传. <a href=https://github.com/ClickHouse/ClickHouse/pull/16840 rel="external nofollow noreferrer" target=_blank>#16840</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>修复了在不带任何参数的情况下使用 <code class=syntax>any</code> 时的崩溃问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16803 rel="external nofollow noreferrer" target=_blank>#16803</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16826 rel="external nofollow noreferrer" target=_blank>#16826</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了多个列和元组上的 <code class=syntax>IN</code> 运算符, 启用了 <code class=syntax>transform_null_in</code> 设置. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15310 rel="external nofollow noreferrer" target=_blank>#15310</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16722 rel="external nofollow noreferrer" target=_blank>#16722</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 <code class=syntax>optimize_read_in_order/optimize_aggregation_in_order</code> 的不一致行为, max_threads &gt; 0 和 ORDER BY 中的表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/16637 rel="external nofollow noreferrer" target=_blank>#16637</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了查询包含<code class=syntax>ARRAY JOIN</code>时查询优化产生错误结果的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/17887 rel="external nofollow noreferrer" target=_blank>#17887</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>在异常的情况下查询完成得更快. 如果发生异常, 取消对远程副本的执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/15578 rel="external nofollow noreferrer" target=_blank>#15578</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-8-6-6-lts-2020-11-13>ClickHouse 版本 v20.8.6.6-lts, 2020-11-13<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-8-6-6-lts-2020-11-13 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_19>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_19 title="Permanent link"> </a></h4> <ul> <li>当查询分析器打开并且 ClickHouse 安装在操作系统上时, 修复罕见的无声崩溃, glibc 版本已经 (据说) 损坏了某些功能的异步展开表. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15301 rel="external nofollow noreferrer" target=_blank>#15301</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13098 rel="external nofollow noreferrer" target=_blank>#13098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16846 rel="external nofollow noreferrer" target=_blank>#16846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在, 当从输入解析 AVRO 时, LowCardinality 将从类型中删除. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16188 rel="external nofollow noreferrer" target=_blank>#16188</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16521 rel="external nofollow noreferrer" target=_blank>#16521</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>通过适当缩小 GTID 集，修复使用 MySQL Master -&gt; MySQL Slave -&gt; ClickHouse MaterializeMySQL Engine 和 MySQL Slave 上启用的 <code class=syntax>slave_parallel_worker</code> 时元数据的快速增长. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15951 rel="external nofollow noreferrer" target=_blank>#15951</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16504 rel="external nofollow noreferrer" target=_blank>#16504</a> (<a href=https://github.com/TCeason rel="external nofollow noreferrer" target=_blank>TCeason</a>).</li> <li>修复分布式的 DROP TABLE (使用 INSERT). <a href=https://github.com/ClickHouse/ClickHouse/pull/16409 rel="external nofollow noreferrer" target=_blank>#16409</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了复制队列中非常大的条目的处理. 如果表结构非常大 (接近 1 MB), 则非常大的条目可能会出现在 ALTER 查询中. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/16307 rel="external nofollow noreferrer" target=_blank>#16307</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16332 rel="external nofollow noreferrer" target=_blank>#16332</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了由于未创建过滤集而可能删除部分返回数据时的不一致行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/16308 rel="external nofollow noreferrer" target=_blank>#16308</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复 MySQL 数据库的错误. 当用作数据库引擎的 MySQL 服务器关闭时, 某些查询会引发异常, 因为它们试图从禁用的服务器获取表, 而这是不必要的. 例如, 查询 <code class=syntax>SELECT ... FROM system.parts</code> 应该只适用于 MergeTree 表并且根本不要接触 MySQL 数据库. <a href=https://github.com/ClickHouse/ClickHouse/pull/16032 rel="external nofollow noreferrer" target=_blank>#16032</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-8-5-45-lts-2020-10-29>ClickHouse 版本 v20.8.5.45-lts, 2020-10-29<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-8-5-45-lts-2020-10-29 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_20>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_20 title="Permanent link"> </a></h4> <ul> <li>在函数 <code class=syntax>dictGet</code> 出现异常时修复double free. 如果字典加载错误, 可能会发生这种情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/16429 rel="external nofollow noreferrer" target=_blank>#16429</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复由总数/汇总/多维数据集修饰符和最小/最大功能按键分组. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/16393 rel="external nofollow noreferrer" target=_blank>#16393</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16397 rel="external nofollow noreferrer" target=_blank>#16397</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复异步分布式插入 w/prefer_localhost_replica=0 和 internal_replication. <a href=https://github.com/ClickHouse/ClickHouse/pull/16358 rel="external nofollow noreferrer" target=_blank>#16358</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了在使用字符串键的 <code class=syntax>GROUP BY</code> 期间可能出现的内存泄漏, 这是由 <code class=syntax>TwoLevelStringHashTable</code> 实现中的错误引起的. <a href=https://github.com/ClickHouse/ClickHouse/pull/16264 rel="external nofollow noreferrer" target=_blank>#16264</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复无论限制如何都可以过度分配内存的情况. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14560 rel="external nofollow noreferrer" target=_blank>#14560</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16206 rel="external nofollow noreferrer" target=_blank>#16206</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复<code class=syntax>ReplicatedVersionedCollapsingMergeTree</code> 的 <code class=syntax>ALTER MODIFY ... ORDER BY</code> 查询挂起。 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15980 rel="external nofollow noreferrer" target=_blank>#15980</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/16011 rel="external nofollow noreferrer" target=_blank>#16011</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复整理名称和字符集名称解析器并支持字符串类型的 <code class=syntax>length = 0</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/16008 rel="external nofollow noreferrer" target=_blank>#16008</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>允许对具有复杂键的字典使用直接布局. <a href=https://github.com/ClickHouse/ClickHouse/pull/16007 rel="external nofollow noreferrer" target=_blank>#16007</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>在一段时间不活动后发生复制错误时, 防止副本挂起 5-10 分钟. <a href=https://github.com/ClickHouse/ClickHouse/pull/15987 rel="external nofollow noreferrer" target=_blank>#15987</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>在插入或从 MaterializedView 中选择并同时删除目标表时修复罕见的段错误 (适用于原子数据库引擎). <a href=https://github.com/ClickHouse/ClickHouse/pull/15984 rel="external nofollow noreferrer" target=_blank>#15984</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复解析设置配置文件时的歧义: <code class=syntax>CREATE USER ... SETTINGS profile readonly</code> 现在被视为使用名为 <code class=syntax>readonly</code> 的配置文件, 而不是名为 <code class=syntax>profile</code> 的具有只读约束的设置. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15628 rel="external nofollow noreferrer" target=_blank>#15628</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15982 rel="external nofollow noreferrer" target=_blank>#15982</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复数据库创建失败时的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/15954 rel="external nofollow noreferrer" target=_blank>#15954</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了当表被并发重命名 (对于原子数据库引擎) 时, <code class=syntax>DROP TABLE IF EXISTS</code> 失败并带有 <code class=syntax>Table ... does not exist</code> 错误的问题. 修复了并发执行具有多个表的某些 DDL 查询 (如 <code class=syntax>DROP DATABASE</code> 和 <code class=syntax>RENAME TABLE</code> ) 时罕见的死锁, 修复了并发执行 <code class=syntax>DROP/DETACH TABLE</code> 时 <code class=syntax>Table ... does not exist</code> 的 <code class=syntax>DROP/DETACH DATABASE</code> 失败 `. <a href=https://github.com/ClickHouse/ClickHouse/pull/15934 rel="external nofollow noreferrer" target=_blank>#15934</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>如果查询具有<code class=syntax>WHERE</code>、<code class=syntax>PREWHERE</code> 和<code class=syntax>GLOBAL IN</code>, 则修复来自<code class=syntax>Distributed</code> 表的查询的错误空结果. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15792 rel="external nofollow noreferrer" target=_blank>#15792</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15933 rel="external nofollow noreferrer" target=_blank>#15933</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 RBAC 中可能的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/15875 rel="external nofollow noreferrer" target=_blank>#15875</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复在 <code class=syntax>ALTER MODIFY COLUMN</code> 查询之后执行的 <code class=syntax>SELECT ... ORDER BY DESC</code> 查询中的异常 <code class=syntax>Block structure mismatch</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15800 rel="external nofollow noreferrer" target=_blank>#15800</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15852 rel="external nofollow noreferrer" target=_blank>#15852</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复某些查询情况, 其中仅选择虚拟列. 以前可能会抛出 <code class=syntax>Not found column _nothing in block</code> 异常. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12298 rel="external nofollow noreferrer" target=_blank>#12298</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15756 rel="external nofollow noreferrer" target=_blank>#15756</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复错误 <code class=syntax>Cannot find column</code> , 如果对 <code class=syntax>MV</code> 的查询包含 <code class=syntax>ARRAY JOIN</code> , 则在插入 <code class=syntax>MATERIALIZED VIEW</code> 时可能会发生该错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15717 rel="external nofollow noreferrer" target=_blank>#15717</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 <code class=syntax>max_replicated_logs_to_keep</code> 设置的默认值过低, 这可能导致副本过于频繁地丢失. 通过选择要克隆的最新副本来改进丢失的副本恢复过程. 也不要从丢失的复制品中取出旧零件, 而是将它们拆下. <a href=https://github.com/ClickHouse/ClickHouse/pull/15701 rel="external nofollow noreferrer" target=_blank>#15701</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复错误 <code class=syntax>Cannot add simple transform to empty Pipe</code>, 该错误在从与目标表结构不同的 <code class=syntax>Buffer</code> 表中读取时发生. 如果目标表返回空的查询结果是可能的. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15529 rel="external nofollow noreferrer" target=_blank>#15529</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15662 rel="external nofollow noreferrer" target=_blank>#15662</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 S3 表函数中的 globs 错误, URL 中的区域未应用于 S3 客户端配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/15646 rel="external nofollow noreferrer" target=_blank>#15646</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>分离只读表时递减 <code class=syntax>ReadonlyReplica</code> 指标. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15598 rel="external nofollow noreferrer" target=_blank>#15598</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15592 rel="external nofollow noreferrer" target=_blank>#15592</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>将单个参数传递给 ReplicatedMergeTree 而不是忽略它时抛出错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15516 rel="external nofollow noreferrer" target=_blank>#15516</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> </ul> <h4 id=gai-jin_9>改进<a class=headerlink href=../amp/#gai-jin_9 title="Permanent link"> </a></h4> <ul> <li>现在, 无论集群配置中的 <code class=syntax>&lt;internal_replication&gt;</code> 设置如何, 都可以执行 <code class=syntax>ALTER ... ON CLUSTER</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/16075 rel="external nofollow noreferrer" target=_blank>#16075</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在创建表时在 <code class=syntax>ReplicatedMergeTree</code> 参数中展开 <code class=syntax>{database}</code>、<code class=syntax>{table}</code> 和 <code class=syntax>{uuid}</code> 宏. <a href=https://github.com/ClickHouse/ClickHouse/pull/16159 rel="external nofollow noreferrer" target=_blank>#16159</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-8-4-11-lts-2020-10-09>ClickHouse 版本 v20.8.4.11-lts, 2020-10-09<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-8-4-11-lts-2020-10-09 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_21>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_21 title="Permanent link"> </a></h4> <ul> <li>修复查询计划的 <code class=syntax>ReadFromStorage</code> 步骤中资源的销毁顺序. 在极少数情况下, 它可能会导致崩溃. 可能与<a href=https://github.com/ClickHouse/ClickHouse/issues/15610 rel="external nofollow noreferrer" target=_blank>#15610</a>有关. <a href=https://github.com/ClickHouse/ClickHouse/pull/15645 rel="external nofollow noreferrer" target=_blank>#15645</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了使用 <code class=syntax>JSON*</code> 函数时会导致 <code class=syntax>VALUES</code>、 <code class=syntax>LIMIT</code> 或 <code class=syntax>IN</code> 运算符右侧的 <code class=syntax>Element ... is not a constant expression</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15589 rel="external nofollow noreferrer" target=_blank>#15589</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>防止出现错误消息 <code class=syntax>Could not calculate available disk space (statvfs), errno: 4, strerror: Interrupted system call</code> 的可能性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15541 rel="external nofollow noreferrer" target=_blank>#15541</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15557 rel="external nofollow noreferrer" target=_blank>#15557</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>显著减少 AggregatingInOrderTransform/optimize_aggregation_in_order 中的内存使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/15543 rel="external nofollow noreferrer" target=_blank>#15543</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>Mutation 可能会在 <code class=syntax>MOVE</code> 或 <code class=syntax>REPLACE PARTITION</code> 之后等待一些不存在的部分, 或者在极少数情况下, 在 <code class=syntax>DETACH</code> 或 <code class=syntax>DROP PARTITION</code> 之后挂起. 已修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/15537 rel="external nofollow noreferrer" target=_blank>#15537</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复如果执行具有相同模式的 <code class=syntax>ILIKE</code>, 则 <code class=syntax>ILIKE</code> 运算符不再区分大小写的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15536 rel="external nofollow noreferrer" target=_blank>#15536</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在选择数据中不存在但依赖于数据中也不存在的其他列时修复 <code class=syntax>Missing columns</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15530 rel="external nofollow noreferrer" target=_blank>#15530</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15532 rel="external nofollow noreferrer" target=_blank>#15532</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 DDLWorker 中事件订阅的错误, 该错误很少会导致查询在“ON CLUSTER”中挂起. 引入 <a href=https://github.com/ClickHouse/ClickHouse/issues/13450 rel="external nofollow noreferrer" target=_blank>#13450</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15477 rel="external nofollow noreferrer" target=_blank>#15477</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>当 <code class=syntax>boundingRatio</code> 聚合函数的第二个参数类型错误时报告正确的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15407 rel="external nofollow noreferrer" target=_blank>#15407</a> (<a href=https://github.com/detailyang rel="external nofollow noreferrer" target=_blank>detailyang</a>).</li> <li>修复合并树表重命名和背景清理过程中的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/15304 rel="external nofollow noreferrer" target=_blank>#15304</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复启用 system.logs 时服务器启动时罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/15300 rel="external nofollow noreferrer" target=_blank>#15300</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复 QueryLog 中的 MSan 报告. 未初始化的内存可用于字段 <code class=syntax>memory_usage</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/15258 rel="external nofollow noreferrer" target=_blank>#15258</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复将 joinGet 与 LowCardinality 类型一起使用时的实例崩溃. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/15214 rel="external nofollow noreferrer" target=_blank>#15214</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15220 rel="external nofollow noreferrer" target=_blank>#15220</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复表引擎 <code class=syntax>Buffer</code> 中的错误, 该错误不允许在 <code class=syntax>ALTER</code> 查询后将新结构的数据插入到 <code class=syntax>Buffer</code> 中. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15117 rel="external nofollow noreferrer" target=_blank>#15117</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15192 rel="external nofollow noreferrer" target=_blank>#15192</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>调整mysql列定义包中的decimals字段大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/15152 rel="external nofollow noreferrer" target=_blank>#15152</a> (<a href=https://github.com/maqroll rel="external nofollow noreferrer" target=_blank>maqroll</a>).</li> <li>我们已经在 String 和 FixedString 之间使用了填充比较 (<a href=https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333 target=_blank>https://github.com/ClickHouse/ClickHouse/blob/master/src/Functions/FunctionsComparison.h#L333</a>) . 此 PR 将相同的逻辑应用于字段比较, 以更正 FixedString 作为主键的使用. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14908 rel="external nofollow noreferrer" target=_blank>#14908</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15033 rel="external nofollow noreferrer" target=_blank>#15033</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>如果使用专门设计的参数调用函数 <code class=syntax>bar</code>, 则可能会发生缓冲区溢出. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/13926 rel="external nofollow noreferrer" target=_blank>#13926</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15028 rel="external nofollow noreferrer" target=_blank>#15028</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在 Mac OS 上的 docker 中运行 clickhouse-server 时, 在原子数据库中执行 DDL 查询时出现的 <code class=syntax>Cannot rename ... errno: 22, strerror: Invalid argument</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/15024 rel="external nofollow noreferrer" target=_blank>#15024</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>现在设置 <code class=syntax>number_of_free_entries_in_pool_to_execute_mutation</code> 和 <code class=syntax>number_of_free_entries_in_pool_to_lower_max_size_of_merge</code> 可以等于 <code class=syntax>background_pool_size</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14975 rel="external nofollow noreferrer" target=_blank>#14975</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>当子查询包含 finalizeAggregation 函数时, 修复使谓词下推工作. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14847 rel="external nofollow noreferrer" target=_blank>#14847</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14937 rel="external nofollow noreferrer" target=_blank>#14937</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>在 <code class=syntax>system.asynchronous_metrics</code> 中发布每个逻辑核心的 CPU 频率. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14923 rel="external nofollow noreferrer" target=_blank>#14923</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14924 rel="external nofollow noreferrer" target=_blank>#14924</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>修复了使用 <code class=syntax>MaterializeMySQL</code> 数据库引擎时 <code class=syntax>.metadata.tmp File exists</code> 的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/14898 rel="external nofollow noreferrer" target=_blank>#14898</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>Fix a problem where the server may get stuck on startup while talking to ZooKeeper, if the configuration files have to be fetched from ZK (using the <code class=syntax>from_zk</code> include option). This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/14814 rel="external nofollow noreferrer" target=_blank>#14814</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14843 rel="external nofollow noreferrer" target=_blank>#14843</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>修复了收缩的 <code class=syntax>Int -&gt; Int</code> 签名类型转换的错误单调性检测. 可能会导致查询结果不正确. 此错误在 <a href=https://github.com/ClickHouse/ClickHouse/issues/14513 rel="external nofollow noreferrer" target=_blank>#14513</a> 中公布. <a href=https://github.com/ClickHouse/ClickHouse/pull/14783 rel="external nofollow noreferrer" target=_blank>#14783</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了 <code class=syntax>Nullable</code> 列不正确的排序顺序. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14344 rel="external nofollow noreferrer" target=_blank>#14344</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14495 rel="external nofollow noreferrer" target=_blank>#14495</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> </ul> <h4 id=gai-jin_10>改进<a class=headerlink href=../amp/#gai-jin_10 title="Permanent link"> </a></h4> <ul> <li>现在可以使用 <code class=syntax>ALTER</code> 查询更改 <code class=syntax>VersionedCollapsingMergeTree</code> 的版本列的类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/15442 rel="external nofollow noreferrer" target=_blank>#15442</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-8-3-18-stable-2020-09-18>ClickHouse 版本 v20.8.3.18-stable, 2020-09-18<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-8-3-18-stable-2020-09-18 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_22>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_22 title="Permanent link"> </a></h4> <ul> <li>修复部分调用 <code class=syntax>extractAllGroups</code> 函数可能触发“超出内存限制”错误的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13383 rel="external nofollow noreferrer" target=_blank>#13383</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14889 rel="external nofollow noreferrer" target=_blank>#14889</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 SIGSEGV 以尝试插入 StorageFile(fd). <a href=https://github.com/ClickHouse/ClickHouse/pull/14887 rel="external nofollow noreferrer" target=_blank>#14887</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>当被查询的列具有 <code class=syntax>DEFAULT</code> 表达式时, 修复 <code class=syntax>SELECT</code> 查询中的罕见错误, 该表达式依赖于另一列, 该列也具有“DEFAULT”并且不存在于选择查询中且不存在于磁盘上. 部分修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14531 rel="external nofollow noreferrer" target=_blank>#14531</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14845 rel="external nofollow noreferrer" target=_blank>#14845</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了执行 <code class=syntax>ALTER ... MODIFY QUERY</code> 时物化视图元数据中丢失的默认数据库名称. <a href=https://github.com/ClickHouse/ClickHouse/pull/14664 rel="external nofollow noreferrer" target=_blank>#14664</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了在赋值表达式和常量值 (如 <code class=syntax>UPDATE x = 42</code>) 中使用 Nullable 列的 <code class=syntax>ALTER UPDATE</code> 突变导致列或段错误中的值不正确时的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13634 rel="external nofollow noreferrer" target=_blank>#13634</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/14045 rel="external nofollow noreferrer" target=_blank>#14045</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14646 rel="external nofollow noreferrer" target=_blank>#14646</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复错误的十进制乘法结果导致结果列小数位数错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/14603 rel="external nofollow noreferrer" target=_blank>#14603</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>添加了检查器, 因为既不调用 <code class=syntax>lc-&gt;isNullable()</code> 也不调用 <code class=syntax>ls-&gt;getDictionaryPtr()-&gt;isNullable()</code> 将返回正确的结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/14591 rel="external nofollow noreferrer" target=_blank>#14591</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>myrrc</a>).</li> <li>在为 StorageReplicatedMergeTree 引擎创建查询期间 Zookeeper 异常后清理数据目录. <a href=https://github.com/ClickHouse/ClickHouse/pull/14563 rel="external nofollow noreferrer" target=_blank>#14563</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>使用组合器 -Resample 修复函数中罕见的段错误, 这可能会出现在参数非常大的溢出结果中. <a href=https://github.com/ClickHouse/ClickHouse/pull/14562 rel="external nofollow noreferrer" target=_blank>#14562</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=gai-jin_11>改进<a class=headerlink href=../amp/#gai-jin_11 title="Permanent link"> </a></h4> <ul> <li>如果有正在进行的 S3 请求, 则加快服务器关闭过程. <a href=https://github.com/ClickHouse/ClickHouse/pull/14858 rel="external nofollow noreferrer" target=_blank>#14858</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>允许在分布式存储中使用多卷存储配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/14839 rel="external nofollow noreferrer" target=_blank>#14839</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>如果有正在进行的 S3 请求, 则加快服务器关闭过程. <a href=https://github.com/ClickHouse/ClickHouse/pull/14496 rel="external nofollow noreferrer" target=_blank>#14496</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>支持紧凑部分的自定义编解码器. <a href=https://github.com/ClickHouse/ClickHouse/pull/12183 rel="external nofollow noreferrer" target=_blank>#12183</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-8-2-3-stable-2020-09-08>ClickHouse 版本 v20.8.2.3-stable, 2020-09-08<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-8-2-3-stable-2020-09-08 title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng_4>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng_4 title="Permanent link"> </a></h4> <ul> <li>现在 <code class=syntax>OPTIMIZE FINAL</code> 查询不会重新计算在创建 TTL 之前添加的部件的 TTL. 使用 <code class=syntax>ALTER TABLE ... MATERIALIZE TTL</code> 一次来计算它们, 之后 <code class=syntax>OPTIMIZE FINAL</code> 将正确评估TTL. 此行为从未适用于复制表. <a href=https://github.com/ClickHouse/ClickHouse/pull/14220 rel="external nofollow noreferrer" target=_blank>#14220</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>扩展 <code class=syntax>parallel_distributed_insert_select</code> 设置, 添加一个选项以将 <code class=syntax>INSERT</code> 运行到本地表中. 该设置将类型从 <code class=syntax>Bool</code> 更改为 <code class=syntax>UInt64</code>, 因此不再支持值 <code class=syntax>false</code> 和 <code class=syntax>true</code>. 如果服务器配置中有这些值, 服务器将不会启动. 请将它们分别替换为 <code class=syntax>0</code> 和 <code class=syntax>1</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14060 rel="external nofollow noreferrer" target=_blank>#14060</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>移除对 <code class=syntax>ODBCDriver</code> 输入/输出格式的支持. 这是曾经用于与 ClickHouse ODBC 驱动程序通信的弃用格式, 现在早已被 <code class=syntax>ODBCDriver2</code> 格式取代. 解决 <a href=https://github.com/ClickHouse/ClickHouse/issues/13629 rel="external nofollow noreferrer" target=_blank>#13629</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13847 rel="external nofollow noreferrer" target=_blank>#13847</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>从20.5以上的版本升级时, 如果进行滚动更新, 集群同时包含20.5以上和20.5以下的版本, 如果旧版本的ClickHouse节点重启, 旧版本在新版本存在的情况下启动, 可能会导致 <code class=syntax>Part ... intersects previous part</code> 错误. 为防止出现此错误, 首先在所有集群节点上安装更新的 clickhouse-server 软件包, 然后重新启动 (因此，当 clickhouse-server 重新启动时, 它将以新版本启动).</li> </ul> <h4 id=xin-te-zheng_4>新特征<a class=headerlink href=../amp/#xin-te-zheng_4 title="Permanent link"> </a></h4> <ul> <li>添加为与 <code class=syntax>config.xml</code> 中指定的设置相对应的列指定 <code class=syntax>Default</code> 压缩编解码器的功能. 实现: <a href=https://github.com/ClickHouse/ClickHouse/issues/9074 rel="external nofollow noreferrer" target=_blank>#9074</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14049 rel="external nofollow noreferrer" target=_blank>#14049</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>支持 Kafka 中的 Kerberos 身份验证，使用 <code class=syntax>krb5</code> 和 <code class=syntax>cyrus-sasl</code> 库. <a href=https://github.com/ClickHouse/ClickHouse/pull/12771 rel="external nofollow noreferrer" target=_blank>#12771</a> (<a href=https://github.com/ilejn rel="external nofollow noreferrer" target=_blank>Ilya Golshtein</a>).</li> <li>添加函数<code class=syntax>normalizeQuery</code>, 用占位符替换文字、文字序列和复杂别名. 添加函数 <code class=syntax>normalizedQueryHash</code> , 为类似的查询返回相同的 64 位哈希值. 它有助于分析查询日志. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11271 rel="external nofollow noreferrer" target=_blank>#11271</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13816 rel="external nofollow noreferrer" target=_blank>#13816</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加 <code class=syntax>time_zones</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/13880 rel="external nofollow noreferrer" target=_blank>#13880</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>添加函数 <code class=syntax>defaultValueOfTypeName</code>, 返回给定类型的默认值. <a href=https://github.com/ClickHouse/ClickHouse/pull/13877 rel="external nofollow noreferrer" target=_blank>#13877</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>添加 <code class=syntax>countDigits(x)</code> 函数, 用于计算整数或小数列中的小数位数. 添加 <code class=syntax>isDecimalOverflow(d, [p])</code> 函数, 用于检查 Decimal 列中的值是否超出其 (或指定的) 精度. <a href=https://github.com/ClickHouse/ClickHouse/pull/14151 rel="external nofollow noreferrer" target=_blank>#14151</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>添加 <code class=syntax>quantileExactLow</code> 和 <code class=syntax>quantileExactHigh</code> 实现, 并分别具有 <code class=syntax>medianExactLow</code> 和 <code class=syntax>medianExactHigh</code> 的别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/13818 rel="external nofollow noreferrer" target=_blank>#13818</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>添加了将日期/时间值截断为指定日期/时间部分的 <code class=syntax>date_trunc</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/13888 rel="external nofollow noreferrer" target=_blank>#13888</a> (<a href=https://github.com/vladimir-golovchenko rel="external nofollow noreferrer" target=_blank>Vladimir Golovchenko</a>).</li> <li>将新的可选部分 <code class=syntax>&lt;user_directories&gt;</code> 添加到主配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/13425 rel="external nofollow noreferrer" target=_blank>#13425</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>添加允许更改表示例子句的 <code class=syntax>ALTER SAMPLE BY</code> 语句. <a href=https://github.com/ClickHouse/ClickHouse/pull/13280 rel="external nofollow noreferrer" target=_blank>#13280</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>函数 <code class=syntax>position</code> 现在支持可选的 <code class=syntax>start_pos</code> 参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/13237 rel="external nofollow noreferrer" target=_blank>#13237</a> (<a href=https://github.com/vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>).</li> </ul> <h4 id=bug-xiu-fu_23>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_23 title="Permanent link"> </a></h4> <ul> <li>修复客户端交互模式下进度条可见数据乱码问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12562 rel="external nofollow noreferrer" target=_blank>#12562</a> 和 <a href=https://github.com/ClickHouse/ClickHouse/issues/13369 rel="external nofollow noreferrer" target=_blank>#13369</a> 和 <a href=https://github.com/ClickHouse/ClickHouse/issues/13584 rel="external nofollow noreferrer" target=_blank>#13584</a> 并修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12964 rel="external nofollow noreferrer" target=_blank>#12964</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13691 rel="external nofollow noreferrer" target=_blank>#13691</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了按多列排序时如果 <code class=syntax>LowCardinality</code> 列不正确的排序顺序. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13958 rel="external nofollow noreferrer" target=_blank>#13958</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14223 rel="external nofollow noreferrer" target=_blank>#14223</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>检查 <code class=syntax>topK</code> 聚合函数中的数组大小溢出. 如果没有此检查, 用户可能会发送带有精心设计的参数的查询, 这将导致服务器崩溃. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14452 rel="external nofollow noreferrer" target=_blank>#14452</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14467 rel="external nofollow noreferrer" target=_blank>#14467</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了如果表具有单个部分的分区可能导致错误合并分配的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/14444 rel="external nofollow noreferrer" target=_blank>#14444</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>如果 PipelineExecutor 本身发生异常, 则停止查询执行. 这可以防止罕见的查询挂起. 续 <a href=https://github.com/ClickHouse/ClickHouse/issues/14334 rel="external nofollow noreferrer" target=_blank>#14334</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14402 rel="external nofollow noreferrer" target=_blank>#14402</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/14334 rel="external nofollow noreferrer" target=_blank>#14334</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复在创建为 <code class=syntax>AS table_function</code> 的表的 <code class=syntax>ALTER</code> 查询期间崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14212 rel="external nofollow noreferrer" target=_blank>#14212</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14326 rel="external nofollow noreferrer" target=_blank>#14326</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>使用 REFRESH 命令修复 ALTER LIVE VIEW 查询期间的异常. 实时取景是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/14320 rel="external nofollow noreferrer" target=_blank>#14320</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>修复带有嵌套解释器的查询的 QueryPlan 生命周期 (对于 EXPLAIN PIPELINE graph=1). <a href=https://github.com/ClickHouse/ClickHouse/pull/14315 rel="external nofollow noreferrer" target=_blank>#14315</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>在从某些外部来源获取架构期间修复 <code class=syntax>lickhouse-odbc-bridge</code> 的段错误. PR 修复了. <a href=https://github.com/ClickHouse/ClickHouse/pull/14267 rel="external nofollow noreferrer" target=_blank>#14267</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复 <a href=https://github.com/ClickHouse/ClickHouse/pull/12277 rel="external nofollow noreferrer" target=_blank>#12277</a> 中引入的标记包含搜索崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/14225 rel="external nofollow noreferrer" target=_blank>#14225</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>使用命名元组修复表的创建. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13027 rel="external nofollow noreferrer" target=_blank>#13027</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14143 rel="external nofollow noreferrer" target=_blank>#14143</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复最小负十进制数的格式. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/14111 rel="external nofollow noreferrer" target=_blank>#14111</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14119 rel="external nofollow noreferrer" target=_blank>#14119</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>修复 <code class=syntax>DistributedFilesToInsert</code> 指标 (不应该归零). <a href=https://github.com/ClickHouse/ClickHouse/pull/14095 rel="external nofollow noreferrer" target=_blank>#14095</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 const 2d 数组将 <code class=syntax>pointInPolygon</code> 修复为多边形. <a href=https://github.com/ClickHouse/ClickHouse/pull/14079 rel="external nofollow noreferrer" target=_blank>#14079</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li> <li>修复了 <code class=syntax>Poco::Exception: no space left on device</code> 额外信息中错误的挂载点. <a href=https://github.com/ClickHouse/ClickHouse/pull/14050 rel="external nofollow noreferrer" target=_blank>#14050</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>在非全局级别执行时修复 GRANT ALL 语句. <a href=https://github.com/ClickHouse/ClickHouse/pull/13987 rel="external nofollow noreferrer" target=_blank>#13987</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复解析器以拒绝使用引擎创建表作为表函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/13940 rel="external nofollow noreferrer" target=_blank>#13940</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>如果启用了 <code class=syntax>optimize_duplicate_order_by_and_distinct</code> 设置, 则使用 <code class=syntax>DISTINCT</code> 关键字修复选择查询和使用 UNION ALL 的子查询中的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/13925 rel="external nofollow noreferrer" target=_blank>#13925</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了重命名 <code class=syntax>Distributed</code> 表时潜在的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/13922 rel="external nofollow noreferrer" target=_blank>#13922</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复按多列排序时 <code class=syntax>FixedString</code> 列的不正确排序. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13182 rel="external nofollow noreferrer" target=_blank>#13182</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13887 rel="external nofollow noreferrer" target=_blank>#13887</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 <code class=syntax>topK</code>/<code class=syntax>topKWeighted</code> 合并的潜在不精确结果 (使用非默认参数). <a href=https://github.com/ClickHouse/ClickHouse/pull/13817 rel="external nofollow noreferrer" target=_blank>#13817</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复与 NULL 比较时, 从 MergeTree 表中读取 INDEX 类型为 SET 失败的问题. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/13686 rel="external nofollow noreferrer" target=_blank>#13686</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13793 rel="external nofollow noreferrer" target=_blank>#13793</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复 lambda 中的 <code class=syntax>arrayJoin</code> 捕获 (LOGICAL_ERROR). <a href=https://github.com/ClickHouse/ClickHouse/pull/13792 rel="external nofollow noreferrer" target=_blank>#13792</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>在函数 <code class=syntax>range</code> 中添加步骤溢出检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/13790 rel="external nofollow noreferrer" target=_blank>#13790</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了并发执行 <code class=syntax>DROP DATABASE</code> 和 <code class=syntax>CREATE TABLE</code> 时的 <code class=syntax>Directory not empty</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13756 rel="external nofollow noreferrer" target=_blank>#13756</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>为 <code class=syntax>h3KRing</code> 函数添加范围检查. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/13633 rel="external nofollow noreferrer" target=_blank>#13633</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13752 rel="external nofollow noreferrer" target=_blank>#13752</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 DETACH 和后台合并之间的竞争条件. 零件在分离后可能会复活. 这是 <a href=https://github.com/ClickHouse/ClickHouse/issues/8602 rel="external nofollow noreferrer" target=_blank>#8602</a> 的延续, 它没有解决问题, 但引入了一个在极少数情况下开始失败的测试, 证明了这个问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/13746 rel="external nofollow noreferrer" target=_blank>#13746</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当 log_queries_min_type &gt; QUERY_START 时修复日志记录 Settings.Names/Values. <a href=https://github.com/ClickHouse/ClickHouse/pull/13737 rel="external nofollow noreferrer" target=_blank>#13737</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>当verbose=1时修复 <code class=syntax>/replicas_status</code> 端点响应状态代码. <a href=https://github.com/ClickHouse/ClickHouse/pull/13722 rel="external nofollow noreferrer" target=_blank>#13722</a> (<a href=https://github.com/javisantana rel="external nofollow noreferrer" target=_blank>javi santana</a>).</li> <li>在检查用户和组时修复 <code class=syntax>clickhouse-server.init</code> 中的错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/13711 rel="external nofollow noreferrer" target=_blank>#13711</a> (<a href=https://github.com/ylchou rel="external nofollow noreferrer" target=_blank>ylchou</a>).</li> <li>不要在 <code class=syntax>optimize_move_functions_out_of_any</code> 设置下优化 any(arrayJoin()) -&gt; arrayJoin(). <a href=https://github.com/ClickHouse/ClickHouse/pull/13681 rel="external nofollow noreferrer" target=_blank>#13681</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 StorageMerge 和 <code class=syntax>set enable_optimize_predicate_expression=1</code> 修复 JOIN 中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/13679 rel="external nofollow noreferrer" target=_blank>#13679</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复关于 <code class=syntax>number_of_free_entries_in_pool_to_lower_max_size_of_merge</code> 设置的值的错误消息中的错字. <a href=https://github.com/ClickHouse/ClickHouse/pull/13678 rel="external nofollow noreferrer" target=_blank>#13678</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>并发 <code class=syntax>ALTER ... REPLACE/MOVE PARTITION ...</code> 查询可能会导致死锁. 已修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/13626 rel="external nofollow noreferrer" target=_blank>#13626</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了有时缓存字典从源返回默认值而不是当前值时的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/13624 rel="external nofollow noreferrer" target=_blank>#13624</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复紧凑部分中的二级索引损坏. 紧凑的部件是实验功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/13538 rel="external nofollow noreferrer" target=_blank>#13538</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复必须在单个副本上执行的查询的过早 <code class=syntax>ON CLUSTER</code> 超时. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6704 rel="external nofollow noreferrer" target=_blank>#6704</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7228 rel="external nofollow noreferrer" target=_blank>#7228</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/13361 rel="external nofollow noreferrer" target=_blank>#13361</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/11884 rel="external nofollow noreferrer" target=_blank>#11884</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13450 rel="external nofollow noreferrer" target=_blank>#13450</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复函数 <code class=syntax>netloc</code> 中的错误代码. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/13335 rel="external nofollow noreferrer" target=_blank>#13335</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13446 rel="external nofollow noreferrer" target=_blank>#13446</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>StorageMemory</code> 中可能出现的竞争. <a href=https://github.com/ClickHouse/ClickHouse/pull/13416 rel="external nofollow noreferrer" target=_blank>#13416</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 HTTP 协议中 <code class=syntax>TSV/CSVWithNames</code> 格式中缺失或过多的标头. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12504 rel="external nofollow noreferrer" target=_blank>#12504</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13343 rel="external nofollow noreferrer" target=_blank>#13343</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>当数据库或表的名称包含点时, 修复从 users.xml 解析行策略. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/5779 rel="external nofollow noreferrer" target=_blank>#5779</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/12527 rel="external nofollow noreferrer" target=_blank>#12527</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13199 rel="external nofollow noreferrer" target=_blank>#13199</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>在连接断开一次后修复对 <code class=syntax>redis</code> 字典的访问. <code class=syntax>cache</code> 和 <code class=syntax>direct</code> 字典布局可能会发生这种情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/13082 rel="external nofollow noreferrer" target=_blank>#13082</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>删除了使用 ClickHouseDictionarySource 查询远程表时错误的身份验证访问检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/12756 rel="external nofollow noreferrer" target=_blank>#12756</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>正确区分某些情况下的子查询, 用于公共子表达式的消除. <a href=https://github.com/ClickHouse/ClickHouse/issues/8333 rel="external nofollow noreferrer" target=_blank>#8333</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8367 rel="external nofollow noreferrer" target=_blank>#8367</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> </ul> <h4 id=gai-jin_12>改进<a class=headerlink href=../amp/#gai-jin_12 title="Permanent link"> </a></h4> <ul> <li>在 <code class=syntax>ALIAS</code> 列类型上不允许使用 <code class=syntax>CODEC</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13911 rel="external nofollow noreferrer" target=_blank>#13911</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14263 rel="external nofollow noreferrer" target=_blank>#14263</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>等待字典更新完成时, 使用由 <code class=syntax>query_wait_timeout_milliseconds</code> 设置指定的超时而不是硬编码值. <a href=https://github.com/ClickHouse/ClickHouse/pull/14105 rel="external nofollow noreferrer" target=_blank>#14105</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>添加设置 <code class=syntax>min_index_granularity_bytes</code> 以防止意外创建具有非常低的 <code class=syntax>index_granularity_bytes</code> 设置的表. <a href=https://github.com/ClickHouse/ClickHouse/pull/14139 rel="external nofollow noreferrer" target=_blank>#14139</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>现在可以从使用不同 ZooKeeper 的集群中获取分区: <code class=syntax>ALTER TABLE table_name FETCH PARTITION partition_expr FROM 'zk-name:/path-in-zookeeper'</code>. 这对于将数据传送到新集群很有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/14155 rel="external nofollow noreferrer" target=_blank>#14155</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>如果 Memory 表是由大量非常小的块构建的, 那么它的性能会稍好一些 (这不太可能). 这个想法的作者: <a href=https://github.com/markpapadakis rel="external nofollow noreferrer" target=_blank>Mark Papadakis</a>. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14043 rel="external nofollow noreferrer" target=_blank>#14043</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14056 rel="external nofollow noreferrer" target=_blank>#14056</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>条件聚合函数 (例如: <code class=syntax>avgIf</code>、<code class=syntax>sumIf</code>、<code class=syntax>maxIf</code>) 在缺少行并使用可为空参数时应返回 <code class=syntax>NULL</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/13964 rel="external nofollow noreferrer" target=_blank>#13964</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>将 -Resample 组合器中的限制增加到 1M. <a href=https://github.com/ClickHouse/ClickHouse/pull/13947 rel="external nofollow noreferrer" target=_blank>#13947</a> (<a href=https://github.com/Felixoid rel="external nofollow noreferrer" target=_blank>Mikhail f. Shiryaev</a>).</li> <li>更正了 AvroConfluent 格式的错误, 该错误导致 Kafka 表引擎在收到异常小的、格式错误的消息时停止处理消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/13941 rel="external nofollow noreferrer" target=_blank>#13941</a> (<a href=https://github.com/gervarela rel="external nofollow noreferrer" target=_blank>Gervasio Varela</a>).</li> <li>修复长查询的错误错误. 为了正确查询, 可能会出现除 <code class=syntax>Max query size exceeded</code> 之外的语法错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13928 rel="external nofollow noreferrer" target=_blank>#13928</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li><code class=syntax>TabSeparated</code> 格式的空值的更好的错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/13906 rel="external nofollow noreferrer" target=_blank>#13906</a> (<a href=https://github.com/tomjiang1987 rel="external nofollow noreferrer" target=_blank>jiang tao</a>).</li> <li>如果数组元素的类型是 Float32/Float64, 函数 <code class=syntax>arrayCompact</code> 将按位比较 NaN. 在以前的版本中, 如果数组元素的类型是 Float32/Float64，NaN 总是不相等, 如果类型更复杂, 例如 Nullable(Float64), NaN 总是相等. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/13857 rel="external nofollow noreferrer" target=_blank>#13857</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13868 rel="external nofollow noreferrer" target=_blank>#13868</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>lgamma</code> 函数中的数据竞争. 这场比赛只在 <code class=syntax>tsan</code> 中被抓到, 没有真正发生过副作用. <a href=https://github.com/ClickHouse/ClickHouse/pull/13842 rel="external nofollow noreferrer" target=_blank>#13842</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当数组作为字段操作时, 避免太慢的查询. 改为抛出异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/13753 rel="external nofollow noreferrer" target=_blank>#13753</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>新增Redis requirepass授权 (针对redis字典源码). <a href=https://github.com/ClickHouse/ClickHouse/pull/13688 rel="external nofollow noreferrer" target=_blank>#13688</a> (<a href=https://github.com/it1804 rel="external nofollow noreferrer" target=_blank>Ivan Torgashov</a>).</li> <li>添加 MergeTree Write-Ahead-Log (WAL) 转储工具. WAL 是一个实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/13640 rel="external nofollow noreferrer" target=_blank>#13640</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>).</li> <li>在以前的版本中, 如果使用专门设计的参数调用, <code class=syntax>lcm</code> 函数可能会在调试构建中产生断言冲突. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13368 rel="external nofollow noreferrer" target=_blank>#13368</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13510 rel="external nofollow noreferrer" target=_blank>#13510</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在更多情况下为 <code class=syntax>toDate/toDateTime</code> 函数提供单调性. 单调性信息用于索引分析 (更复杂的查询将能够使用索引). 现在输入参数更自然地饱和并提供更好的单调性. <a href=https://github.com/ClickHouse/ClickHouse/pull/13497 rel="external nofollow noreferrer" target=_blank>#13497</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>支持自定义设置的复合标识符. 自定义设置是 ClickHouse 代码库与其他代码库的集成点 (对 ClickHouse 本身没有好处) <a href=https://github.com/ClickHouse/ClickHouse/pull/13496 rel="external nofollow noreferrer" target=_blank>#13496</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>将部分从 DiskLocal 并行移动到 DiskS3. <code class=syntax>DiskS3</code> 是一个实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/13459 rel="external nofollow noreferrer" target=_blank>#13459</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>默认启用混合粒度部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/13449 rel="external nofollow noreferrer" target=_blank>#13449</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>S3 重定向中正确的远程主机检查 (与安全相关的事情). <a href=https://github.com/ClickHouse/ClickHouse/pull/13404 rel="external nofollow noreferrer" target=_blank>#13404</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>将 <code class=syntax>QueryTimeMicroseconds</code>、<code class=syntax>SelectQueryTimeMicroseconds</code> 和 <code class=syntax>InsertQueryTimeMicroseconds</code> 添加到 system.events. <a href=https://github.com/ClickHouse/ClickHouse/pull/13336 rel="external nofollow noreferrer" target=_blank>#13336</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>修复 Decimal 具有太大负指数时的调试断言. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13188 rel="external nofollow noreferrer" target=_blank>#13188</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13228 rel="external nofollow noreferrer" target=_blank>#13228</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>为 DiskS3 添加了缓存层 (缓存到本地磁盘标记和索引文件). <code class=syntax>DiskS3</code> 是一个实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/13076 rel="external nofollow noreferrer" target=_blank>#13076</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>修复 readline 以便现在将历史记录转储到文件中. <a href=https://github.com/ClickHouse/ClickHouse/pull/13600 rel="external nofollow noreferrer" target=_blank>#13600</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>默认使用 <code class=syntax>Atomic</code> 引擎创建 <code class=syntax>system</code> 数据库 (准备在任何地方默认启用 <code class=syntax>Atomic</code> 数据库引擎). <a href=https://github.com/ClickHouse/ClickHouse/pull/13680 rel="external nofollow noreferrer" target=_blank>#13680</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> </ul> <h4 id=xing-neng-gai-jin_5>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_5 title="Permanent link"> </a></h4> <ul> <li>使用 <code class=syntax>LowCardinality</code> 稍微优化非常短的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/14129 rel="external nofollow noreferrer" target=_blank>#14129</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>当设置 <code class=syntax>max_insert_threads</code> 时, 为表引擎 <code class=syntax>Null</code>、<code class=syntax>Memory</code>、<code class=syntax>Distributed</code> 和 <code class=syntax>Buffer</code> 启用并行插入. <a href=https://github.com/ClickHouse/ClickHouse/pull/14120 rel="external nofollow noreferrer" target=_blank>#14120</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果在部件扫描时超过 <code class=syntax>max_rows_to_read</code> 限制, 则快速失败. 此更改背后的动机是, 如果明显已超过 <code class=syntax>max_rows_to_read</code>, 则跳过所有选定部分的范围扫描. 对于大量零件的查询, 这种变化非常明显. <a href=https://github.com/ClickHouse/ClickHouse/pull/13677 rel="external nofollow noreferrer" target=_blank>#13677</a> (<a href=https://github.com/hagen1778 rel="external nofollow noreferrer" target=_blank>Roman Khavronenko</a>).</li> <li>通过 UInt8/UInt16 键略微提高聚合性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/13099 rel="external nofollow noreferrer" target=_blank>#13099</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>优化<code class=syntax>has()</code>、<code class=syntax>indexOf()</code>和 <code class=syntax>countEqual()</code> 函数, 用于 <code class=syntax>Array(LowCardinality(T))</code> 和常量右参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/12550 rel="external nofollow noreferrer" target=_blank>#12550</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>myrrc</a>).</li> <li>在执行简单的 <code class=syntax>INSERT SELECT</code> 查询时, 自动将 <code class=syntax>max_threads</code> 设置为1 或 <code class=syntax>max_insert_threads</code>, 并将 <code class=syntax>max_block_size</code> 设置为 <code class=syntax>min_insert_block_size_rows</code>. 相关 <a href=https://github.com/ClickHouse/ClickHouse/issues/5907 rel="external nofollow noreferrer" target=_blank>#5907</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12195 rel="external nofollow noreferrer" target=_blank>#12195</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> </ul> <h4 id=shi-yan-gong-neng_3>实验功能<a class=headerlink href=../amp/#shi-yan-gong-neng_3 title="Permanent link"> </a></h4> <ul> <li>ClickHouse 可以用作 MySQL 副本 - 它由 <code class=syntax>MaterializeMySQL</code> 数据库引擎实现. 实现 <a href=https://github.com/ClickHouse/ClickHouse/issues/4006 rel="external nofollow noreferrer" target=_blank>#4006</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10851 rel="external nofollow noreferrer" target=_blank>#10851</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>为它们添加类型 <code class=syntax>Int128</code>、<code class=syntax>Int256</code>、<code class=syntax>UInt256</code> 和相关函数. 使用 Decimal256 扩展小数 (精度高达 76 位). 新类型在设置 <code class=syntax>allow_experimental_bigint_types</code> 下. 它的工作非常缓慢和糟糕. 实施不完整. 请不要使用此功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/13097 rel="external nofollow noreferrer" target=_blank>#13097</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_7>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_7 title="Permanent link"> </a></h4> <ul> <li>添加了 <code class=syntax>clickhouse install</code> 脚本, 如果你只有一个二进制文件, 这很有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/13528 rel="external nofollow noreferrer" target=_blank>#13528</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>允许在没有配置的情况下运行 <code class=syntax>clickhouse</code> 二进制文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/13515 rel="external nofollow noreferrer" target=_blank>#13515</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>使用 <code class=syntax>codespell</code> 启用检查代码中的拼写错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13513 rel="external nofollow noreferrer" target=_blank>#13513</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/13511 rel="external nofollow noreferrer" target=_blank>#13511</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 CI 中启用 Shellcheck 作为 .sh 测试的 linter. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/13168 rel="external nofollow noreferrer" target=_blank>#13168</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13530 rel="external nofollow noreferrer" target=_blank>#13530</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/13529 rel="external nofollow noreferrer" target=_blank>#13529</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加 CMake 选项以失败配置而不是自动重新配置, 默认启用. <a href=https://github.com/ClickHouse/ClickHouse/pull/13687 rel="external nofollow noreferrer" target=_blank>#13687</a> (<a href=https://github.com/podshumok rel="external nofollow noreferrer" target=_blank>Konstantin</a>).</li> <li>通过 system.build_options 中的 TZDATA_VERSION 公开嵌入式 tzdata 的版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/13648 rel="external nofollow noreferrer" target=_blank>#13648</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>在构建期间改进 system.time_zones 表的生成. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/14209 rel="external nofollow noreferrer" target=_blank>#14209</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14215 rel="external nofollow noreferrer" target=_blank>#14215</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>使用来自包存储库的最新 tzdata 构建 ClickHouse. <a href=https://github.com/ClickHouse/ClickHouse/pull/13623 rel="external nofollow noreferrer" target=_blank>#13623</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在skip_list.json中添加编写js样式注释的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/14159 rel="external nofollow noreferrer" target=_blank>#14159</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>确保没有复制粘贴的 GPL 代码. <a href=https://github.com/ClickHouse/ClickHouse/pull/13514 rel="external nofollow noreferrer" target=_blank>#13514</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>切换测试 docker 图像以使用基于测试的父级. <a href=https://github.com/ClickHouse/ClickHouse/pull/14167 rel="external nofollow noreferrer" target=_blank>#14167</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>启动docker-compose集群时添加重试逻辑; 增加 COMPOSE_HTTP_TIMEOUT. <a href=https://github.com/ClickHouse/ClickHouse/pull/14112 rel="external nofollow noreferrer" target=_blank>#14112</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>在压力测试中启用 <code class=syntax>system.text_log</code> 以发现更多错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13855 rel="external nofollow noreferrer" target=_blank>#13855</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>Testflows LDAP 模块: 为 openldap4 添加缺少的证书和 dhparam.pem. <a href=https://github.com/ClickHouse/ClickHouse/pull/13780 rel="external nofollow noreferrer" target=_blank>#13780</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>ZooKeeper 在 CI 基础设施的单元测试中无法可靠地工作. 使用单元测试进行 ZooKeeper 与真正的 ZooKeeper 交互从一开始就是个坏主意 (单元测试不应该验证复杂的分布式系统). 我们已经为此目的使用集成测试, 它们更适合. <a href=https://github.com/ClickHouse/ClickHouse/pull/13745 rel="external nofollow noreferrer" target=_blank>#13745</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了用于样式检查的 docker 图像. 添加样式检查所有 docker 和 docker compose 文件都位于 docker 目录中. <a href=https://github.com/ClickHouse/ClickHouse/pull/13724 rel="external nofollow noreferrer" target=_blank>#13724</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>修复 Mac OS 上的 cassandra 构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/13708 rel="external nofollow noreferrer" target=_blank>#13708</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>修复共享构建中的链接错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13700 rel="external nofollow noreferrer" target=_blank>#13700</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>更新 LDAP 用户身份验证套件以检查它是否适用于 RBAC. <a href=https://github.com/ClickHouse/ClickHouse/pull/13656 rel="external nofollow noreferrer" target=_blank>#13656</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>删除了 <code class=syntax>contrib/aws</code> 的 <code class=syntax>-DENABLE_CURL_CLIENT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13628 rel="external nofollow noreferrer" target=_blank>#13628</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>增加 ClickHouse 节点的运行状况检查超时, 并在发现不健康的容器时添加对转储 docker-compose 日志的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/13612 rel="external nofollow noreferrer" target=_blank>#13612</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>确保 <a href=https://github.com/ClickHouse/ClickHouse/issues/10977 rel="external nofollow noreferrer" target=_blank>#10977</a> 无效. <a href=https://github.com/ClickHouse/ClickHouse/pull/13539 rel="external nofollow noreferrer" target=_blank>#13539</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>从robot-clickhouse 跳过PR. <a href=https://github.com/ClickHouse/ClickHouse/pull/13489 rel="external nofollow noreferrer" target=_blank>#13489</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>将 Dockerfiles 从集成测试移动到 <code class=syntax>docker/test</code> 目录. docker_compose 文件在 <code class=syntax>runner</code> docker 容器中可用. Docker 镜像是在 CI 中构建的, 而不是在集成测试中. <a href=https://github.com/ClickHouse/ClickHouse/pull/13448 rel="external nofollow noreferrer" target=_blank>#13448</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> </ul> <h2 id=clickhouse-ban-ben-20-7>ClickHouse 版本 20.7<a class=headerlink href=../amp/#clickhouse-ban-ben-20-7 title="Permanent link"> </a></h2> <h3 id=clickhouse-ban-ben-v20-7-2-30-stable-2020-08-31>ClickHouse 版本 v20.7.2.30-stable, 2020-08-31<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-7-2-30-stable-2020-08-31 title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng_5>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng_5 title="Permanent link"> </a></h4> <ul> <li>以至少一个浮点数作为参数的函数 <code class=syntax>modulo</code> (运算符 <code class=syntax>%</code> )将直接计算浮点数的除法余数, 而不将两个参数都转换为整数. 它使行为与大多数 DBMS 兼容. 这也适用于 Date 和 DateTime 数据类型. 添加别名 <code class=syntax>mod</code> . 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/7323 rel="external nofollow noreferrer" target=_blank>#7323</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12585 rel="external nofollow noreferrer" target=_blank>#12585</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>弃用零日期/日期时间值的特殊打印为 <code class=syntax>0000-00-00</code> 和<code class=syntax>0000-00-00 00:00:00</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12442 rel="external nofollow noreferrer" target=_blank>#12442</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>函数 <code class=syntax>groupArrayMoving*</code> 不适用于分布式查询. 它的结果是在不正确的数据类型中计算的 (没有升级到最大的类型). <code class=syntax>groupArrayMovingAvg</code> 函数返回的整数与 <code class=syntax>avg</code> 函数不一致. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/12568 rel="external nofollow noreferrer" target=_blank>#12568</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12622 rel="external nofollow noreferrer" target=_blank>#12622</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>为 MergeTree 设置添加健全性检查. 如果设置不正确，服务器将拒绝启动或创建表, 并向用户打印详细说明. <a href=https://github.com/ClickHouse/ClickHouse/pull/13153 rel="external nofollow noreferrer" target=_blank>#13153</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>防止用户可能将 <code class=syntax>background_pool_size</code> 设置为低于 <code class=syntax>number_of_free_entries_in_pool_to_execute_mutation</code> 或 <code class=syntax>number_of_free_entries_in_pool_to_lower_max_size_of_merge</code> 的值. 在这些情况下, ALTER 将不起作用或合并的最大大小将太有限. 它将抛出异常解释要做什么. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/10897 rel="external nofollow noreferrer" target=_blank>#10897</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12728 rel="external nofollow noreferrer" target=_blank>#12728</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>从20.5以上的版本升级时, 如果进行滚动更新, 集群同时包含20.5以上和20.5以下的版本, 如果旧版本的ClickHouse节点重启, 旧版本在新版本存在的情况下启动, 可能会导致 <code class=syntax>Part ... intersects previous part</code> 错误. 为防止出现此错误, 首先在所有集群节点上安装更新的 clickhouse-server 软件包, 然后重新启动 (因此, 当 clickhouse-server 重新启动时, 它将以新版本启动).</li> </ul> <h4 id=xin-te-zheng_5>新特征<a class=headerlink href=../amp/#xin-te-zheng_5 title="Permanent link"> </a></h4> <ul> <li>提供高效 <code class=syntax>reverse geocoding</code> 查找的多边形字典类型 - 在许多多边形的字典 (世界地图) 中通过坐标查找区域. 它使用精心优化的算法和递归网格来保持较低的 CPU 和内存使用率. <a href=https://github.com/ClickHouse/ClickHouse/pull/9278 rel="external nofollow noreferrer" target=_blank>#9278</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>).</li> <li>添加了对预配置用户的 LDAP 身份验证支持 ( <code class=syntax>Simple Bind</code> 方法). <a href=https://github.com/ClickHouse/ClickHouse/pull/11234 rel="external nofollow noreferrer" target=_blank>#11234</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>).</li> <li>引入设置 <code class=syntax>alter_partition_verbose_result</code>, 它为某些类型的 <code class=syntax>ALTER TABLE ... PARTITION ...</code> 查询 (当前是<code class=syntax>ATTACH</code> 和<code class=syntax>FREEZE</code>)输出有关触摸部分的信息. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/8076 rel="external nofollow noreferrer" target=_blank>#8076</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13017 rel="external nofollow noreferrer" target=_blank>#13017</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>为 bayesian-ab-testing 添加 <code class=syntax>bayesAB</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/12327 rel="external nofollow noreferrer" target=_blank>#12327</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>).</li> <li>添加了 <code class=syntax>system.crash_log</code> 表, 用于收集致命错误的堆栈跟踪. 这个表应该是空的. <a href=https://github.com/ClickHouse/ClickHouse/pull/12316 rel="external nofollow noreferrer" target=_blank>#12316</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了 http 标头 <code class=syntax>X-ClickHouse-Database</code> 和 <code class=syntax>X-ClickHouse-Format</code>, 可用于设置默认数据库和输出格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/12981 rel="external nofollow noreferrer" target=_blank>#12981</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>将 <code class=syntax>minMap</code> 和 <code class=syntax>maxMap</code> 函数支持添加到 <code class=syntax>SimpleAggregateFunction</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12662 rel="external nofollow noreferrer" target=_blank>#12662</a> (<a href=https://github.com/ildus rel="external nofollow noreferrer" target=_blank>Ildus Kurbangaliev</a>).</li> <li>添加设置 <code class=syntax>allow_non_metadata_alters</code>, 它限制执行修改磁盘上数据的 <code class=syntax>ALTER</code> 查询. 默认禁用. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11547 rel="external nofollow noreferrer" target=_blank>#11547</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12635 rel="external nofollow noreferrer" target=_blank>#12635</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>添加了一个函数 <code class=syntax>formatRow</code> 以支持通过给定格式将任意表达式转换为字符串. 它对于操作 SQL 输出很有用, 并且与 <code class=syntax>columns</code> 函数结合使用非常通用. <a href=https://github.com/ClickHouse/ClickHouse/pull/12574 rel="external nofollow noreferrer" target=_blank>#12574</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>添加 <code class=syntax>FROM_UNIXTIME</code> 函数以兼容 MySQL, 与 <a href=https://github.com/ClickHouse/ClickHouse/issues/12149 rel="external nofollow noreferrer" target=_blank>12149</a> 相关. <a href=https://github.com/ClickHouse/ClickHouse/pull/12484 rel="external nofollow noreferrer" target=_blank>#12484</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>如果启用了 <code class=syntax>allow_nullable_key</code> 表设置, 则允许 Nullable 类型作为 MergeTree 表中的键. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/5319 rel="external nofollow noreferrer" target=_blank>#5319</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12433 rel="external nofollow noreferrer" target=_blank>#12433</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>与 <a href=https://intl.cloud.tencent.com/product/cos rel="external nofollow noreferrer" target=_blank>COS</a> 集成. <a href=https://github.com/ClickHouse/ClickHouse/pull/12386 rel="external nofollow noreferrer" target=_blank>#12386</a> (<a href=https://github.com/fastio rel="external nofollow noreferrer" target=_blank>fastio</a>).</li> <li>添加 <code class=syntax>mapAdd</code> 和 <code class=syntax>mapSubtract</code> 函数以添加/减去键映射值. <a href=https://github.com/ClickHouse/ClickHouse/pull/11735 rel="external nofollow noreferrer" target=_blank>#11735</a> (<a href=https://github.com/ildus rel="external nofollow noreferrer" target=_blank>Ildus Kurbangaliev</a>).</li> </ul> <h4 id=bug-xiu-fu_24>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_24 title="Permanent link"> </a></h4> <ul> <li>修复必须在单个副本上执行的查询的过早 <code class=syntax>ON CLUSTER</code> 超时. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6704 rel="external nofollow noreferrer" target=_blank>#6704</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7228 rel="external nofollow noreferrer" target=_blank>#7228</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/13361 rel="external nofollow noreferrer" target=_blank>#13361</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/11884 rel="external nofollow noreferrer" target=_blank>#11884</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13450 rel="external nofollow noreferrer" target=_blank>#13450</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复 <a href=https://github.com/ClickHouse/ClickHouse/pull/12277 rel="external nofollow noreferrer" target=_blank>#12277</a> 中引入的标记包含搜索崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/14225 rel="external nofollow noreferrer" target=_blank>#14225</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>使用缓存布局修复外部字典中的竞争条件, 这可能导致服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/12566 rel="external nofollow noreferrer" target=_blank>#12566</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复客户端交互模式下进度条可见数据乱码问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12562 rel="external nofollow noreferrer" target=_blank>#12562</a> 和 <a href=https://github.com/ClickHouse/ClickHouse/issues/13369 rel="external nofollow noreferrer" target=_blank>#13369</a> 和 [#13584] (<a href=https://github.com/ClickHouse/ClickHouse/issues/13584 target=_blank>https://github.com/ClickHouse/ClickHouse/issues/13584</a>) 并修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12964 rel="external nofollow noreferrer" target=_blank>#12964</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13691 rel="external nofollow noreferrer" target=_blank>#13691</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了当使用 ORDER BY 多列时 <code class=syntax>LowCardinality</code> 列的不正确排序顺序. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13958 rel="external nofollow noreferrer" target=_blank>#13958</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14223 rel="external nofollow noreferrer" target=_blank>#14223</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>删除了硬编码超时, 它错误地否决了缓存字典的 <code class=syntax>query_wait_timeout_milliseconds</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/14105 rel="external nofollow noreferrer" target=_blank>#14105</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复了 <code class=syntax>Poco::Exception: no space left on device</code> 额外信息中错误的挂载点. <a href=https://github.com/ClickHouse/ClickHouse/pull/14050 rel="external nofollow noreferrer" target=_blank>#14050</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>在启用了 <code class=syntax>optimize_duplicate_order_by_and_distinct</code> 设置的情况下, 当子查询也具有 <code class=syntax>DISTINCT</code> 时, 使用 <code class=syntax>DISTINCT</code> 关键字修复选择查询的错误查询优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/13925 rel="external nofollow noreferrer" target=_blank>#13925</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了重命名 <code class=syntax>Distributed</code> 表时潜在的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/13922 rel="external nofollow noreferrer" target=_blank>#13922</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复使用 ORDER BY 多列时 <code class=syntax>FixedString</code> 列的不正确排序。 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13182 rel="external nofollow noreferrer" target=_blank>#13182</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13887 rel="external nofollow noreferrer" target=_blank>#13887</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 <code class=syntax>topK</code>/<code class=syntax>topKWeighted</code> 聚合的潜在较低精度 (使用非默认参数). <a href=https://github.com/ClickHouse/ClickHouse/pull/13817 rel="external nofollow noreferrer" target=_blank>#13817</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复从 MergeTree 表中读取 INDEX 类型为 SET 时与 NULL 相比失败的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13686 rel="external nofollow noreferrer" target=_blank>#13686</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13793 rel="external nofollow noreferrer" target=_blank>#13793</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复函数<code class=syntax>range()</code>中的步骤溢出. <a href=https://github.com/ClickHouse/ClickHouse/pull/13790 rel="external nofollow noreferrer" target=_blank>#13790</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了并发执行 <code class=syntax>DROP DATABASE</code> 和 <code class=syntax>CREATE TABLE</code> 时的 <code class=syntax>Directory not empty</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13756 rel="external nofollow noreferrer" target=_blank>#13756</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>为 <code class=syntax>h3KRing</code> 函数添加范围检查. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13633 rel="external nofollow noreferrer" target=_blank>#13633</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13752 rel="external nofollow noreferrer" target=_blank>#13752</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 DETACH 和后台合并之间的竞争条件. 零件在分离后可能会复活. 这是 <a href=https://github.com/ClickHouse/ClickHouse/issues/8602 rel="external nofollow noreferrer" target=_blank>#8602</a> 的延续, 它没有解决问题, 但引入了一个在极少数情况下开始失败的测试, 证明了这个问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/13746 rel="external nofollow noreferrer" target=_blank>#13746</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当 <code class=syntax>log_queries_min_type</code> 大于 <code class=syntax>QUERY_START</code> 时修复日志 Settings.Names/Values . <a href=https://github.com/ClickHouse/ClickHouse/pull/13737 rel="external nofollow noreferrer" target=_blank>#13737</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>在检查用户和组时修复 <code class=syntax>clickhouse-server.init</code> 中的错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/13711 rel="external nofollow noreferrer" target=_blank>#13711</a> (<a href=https://github.com/ylchou rel="external nofollow noreferrer" target=_blank>ylchou</a>).</li> <li>不要在 <code class=syntax>optimize_move_functions_out_of_any</code> 下将 <code class=syntax>any(arrayJoin())</code> 优化为 <code class=syntax>arrayJoin()</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/13681 rel="external nofollow noreferrer" target=_blank>#13681</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了并发 <code class=syntax>ALTER ... REPLACE/MOVE PARTITION ...</code> 查询中可能出现的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/13626 rel="external nofollow noreferrer" target=_blank>#13626</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了有时缓存字典从源返回默认值而不是当前值时的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/13624 rel="external nofollow noreferrer" target=_blank>#13624</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复紧凑部分中的二级索引损坏 (紧凑部分是一个实验性功能). <a href=https://github.com/ClickHouse/ClickHouse/pull/13538 rel="external nofollow noreferrer" target=_blank>#13538</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复函数 <code class=syntax>netloc</code> 中的错误代码. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13335 rel="external nofollow noreferrer" target=_blank>#13335</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13446 rel="external nofollow noreferrer" target=_blank>#13446</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当 unix 时间戳作为参数传递时, 修复 <code class=syntax>parseDateTimeBestEffort</code> 函数中的错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13362 rel="external nofollow noreferrer" target=_blank>#13362</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13441 rel="external nofollow noreferrer" target=_blank>#13441</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复无效的返回类型, 用于将元组与 <code class=syntax>NULL</code> 元素进行比较. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12461 rel="external nofollow noreferrer" target=_blank>#12461</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13420 rel="external nofollow noreferrer" target=_blank>#13420</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复错误优化导致 <code class=syntax>aggregate function any(x) is found inside another aggregate function in query</code> 错误 <code class=syntax>SET optimize_move_functions_out_of_any = 1</code> 和 <code class=syntax>any()</code> 内的别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/13419 rel="external nofollow noreferrer" target=_blank>#13419</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复 <code class=syntax>storagmemory</code> 中可能存在的竞争问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/13416 rel="external nofollow noreferrer" target=_blank>#13416</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>如果查询返回零行, 修复<code class=syntax>Arrow</code> 和<code class=syntax>Parquet</code> 格式的空输出. 这样做是因为空输出对于这种格式无效. <a href=https://github.com/ClickHouse/ClickHouse/pull/13399 rel="external nofollow noreferrer" target=_blank>#13399</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>在 <code class=syntax>ORDER BY</code> 子句中使用常量列和主键前缀修复选择查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/13396 rel="external nofollow noreferrer" target=_blank>#13396</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复 clickhouse-local 的 <code class=syntax>PrettyCompactMonoBlock</code>. 使用 <code class=syntax>PrettyCompactMonoBlock</code> 修复极端/总数. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7746 rel="external nofollow noreferrer" target=_blank>#7746</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13394 rel="external nofollow noreferrer" target=_blank>#13394</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 system.text_log 中的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/12452 rel="external nofollow noreferrer" target=_blank>#12452</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>). 它是 <a href=https://github.com/ClickHouse/ClickHouse/issues/12339 rel="external nofollow noreferrer" target=_blank>#12339</a> 的一部分. 这修复了 [#12325]. <a href=https://github.com/ClickHouse/ClickHouse/pull/13386 rel="external nofollow noreferrer" target=_blank>#13386</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复了<code class=syntax>File(TSVWithNames*)</code> (标题被多次写入), 修复了 <code class=syntax>clickhouse-local --format CSVWithNames*</code> (缺少标题, 在<a href="https://github.com/ClickHouse/ClickHouse/ 问题/12197" rel="external nofollow noreferrer" target=_blank>#12197</a>), 修复了零行 (缺少标题) 的 <code class=syntax>clickhouse-local --format CSVWithNames*</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13343 rel="external nofollow noreferrer" target=_blank>#13343</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>当函数 <code class=syntax>groupArrayMovingSum</code> 反序列化空状态时, 修复段错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13339 rel="external nofollow noreferrer" target=_blank>#13339</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13341 rel="external nofollow noreferrer" target=_blank>#13341</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在 <code class=syntax>JOIN ON</code> 部分中的 <code class=syntax>arrayJoin()</code> 函数上抛出错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13330 rel="external nofollow noreferrer" target=_blank>#13330</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>使用 <code class=syntax>join_use_nulls=1</code> 修复 <code class=syntax>LEFT ASOF JOIN</code> 中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/13291 rel="external nofollow noreferrer" target=_blank>#13291</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>在从延迟副本查询的情况下, 修复可能的错误 <code class=syntax>Totals having transform was already added to pipeline</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/13290 rel="external nofollow noreferrer" target=_blank>#13290</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>如果用户将特制的参数传递给函数 <code class=syntax>h3ToChildren</code>, 服务器可能会崩溃. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13275 rel="external nofollow noreferrer" target=_blank>#13275</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13277 rel="external nofollow noreferrer" target=_blank>#13277</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在具有 NaN 值的 Float 类型上调用的 <code class=syntax>uniqExact</code>、<code class=syntax>topK</code>、<code class=syntax>sumDistinct</code> 和类似聚合函数的潜在低性能和稍微不正确的结果. 它还在调试版本中触发断言. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12491 rel="external nofollow noreferrer" target=_blank>#12491</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13254 rel="external nofollow noreferrer" target=_blank>#13254</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当主键包含具有单调函数的表达式并且查询包含与类型不同的常量的比较时, 修复 KeyCondition 中的断言. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/12465 rel="external nofollow noreferrer" target=_blank>#12465</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13251 rel="external nofollow noreferrer" target=_blank>#13251</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>返回在函数 roundUpToPowerOfTwoOrZero() 中设置了 MSB 的数字的传递数字. 它可以防止数组大小溢出时的潜在错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13234 rel="external nofollow noreferrer" target=_blank>#13234</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果使用可为空的 constexpr 作为不是文字 NULL 的 cond, 则修复函数. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12463 rel="external nofollow noreferrer" target=_blank>#12463</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13226 rel="external nofollow noreferrer" target=_blank>#13226</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在数组元素为 Nullable 且数组下标也可为 Null 的情况下, 修复 <code class=syntax>arrayElement</code> 函数中的断言. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12172 rel="external nofollow noreferrer" target=_blank>#12172</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13224 rel="external nofollow noreferrer" target=_blank>#13224</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>使用常量参数修复 DateTime64 转换函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/13205 rel="external nofollow noreferrer" target=_blank>#13205</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>当数据库或表的名称包含点时, 修复从 users.xml 解析行策略. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5779 rel="external nofollow noreferrer" target=_blank>#5779</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/12527 rel="external nofollow noreferrer" target=_blank>#12527</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13199 rel="external nofollow noreferrer" target=_blank>#13199</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>在连接断开一次后修复对 <code class=syntax>redis</code> 字典的访问. <code class=syntax>cache</code> 和 <code class=syntax>direct</code> 字典布局可能会发生这种情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/13082 rel="external nofollow noreferrer" target=_blank>#13082</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>使用函数修复错误的索引分析. 从 <code class=syntax>MergeTree</code> 表中读取时, 可能会导致跳过某些数据部分. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13060 rel="external nofollow noreferrer" target=_blank>#13060</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/12406 rel="external nofollow noreferrer" target=_blank>#12406</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13081 rel="external nofollow noreferrer" target=_blank>#13081</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复错误 <code class=syntax>Cannot convert column because it is constant but values of constants are different in source and result</code> , 远程查询在查询范围内使用确定性函数, 但查询之间不具有确定性, 例如<code class=syntax>now()</code>、<code class=syntax>now64()</code>、<code class=syntax>randConstant()</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11327 rel="external nofollow noreferrer" target=_blank>#11327</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13075 rel="external nofollow noreferrer" target=_blank>#13075</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了使用 <code class=syntax>ORDER BY</code> 元组和小 <code class=syntax>LIMIT</code> 查询时可能发生的崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12623 rel="external nofollow noreferrer" target=_blank>#12623</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13009 rel="external nofollow noreferrer" target=_blank>#13009</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复带有 <code class=syntax>UNION</code> 和 <code class=syntax>JOIN</code> 的查询的 <code class=syntax>Block structure mismatch</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12602 rel="external nofollow noreferrer" target=_blank>#12602</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12989 rel="external nofollow noreferrer" target=_blank>#12989</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>更正了 <code class=syntax>merge_with_ttl_timeout</code> 逻辑, 当过期影响一个时间间隔内的多个分区时, 该逻辑无法正常工作. (作者 @excitoon). <a href=https://github.com/ClickHouse/ClickHouse/pull/12982 rel="external nofollow noreferrer" target=_blank>#12982</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>修复从 DDL 查询创建的范围哈希字典的列重复. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/10605 rel="external nofollow noreferrer" target=_blank>#10605</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12857 rel="external nofollow noreferrer" target=_blank>#12857</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复对从本地副本中选择的线程数的不必要限制. <a href=https://github.com/ClickHouse/ClickHouse/pull/12840 rel="external nofollow noreferrer" target=_blank>#12840</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了当 <code class=syntax>ALTER DELETE</code> 和 <code class=syntax>ALTER MODIFY COLUMN</code> 查询作为单个突变同时执行时的罕见错误. 错误导致 <code class=syntax>count.txt</code> 中的行数不正确，从而导致部分数据不正确. 此外, 修复了同时使用 <code class=syntax>ALTER RENAME COLUMN</code> 和 <code class=syntax>ALTER ADD COLUMN</code> 的小错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/12760 rel="external nofollow noreferrer" target=_blank>#12760</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>使用 <code class=syntax>clickhouse</code> 字典源查询远程表时使用了错误的凭据. <a href=https://github.com/ClickHouse/ClickHouse/pull/12756 rel="external nofollow noreferrer" target=_blank>#12756</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>).</li> <li>修复 <code class=syntax>CAST(Nullable(String), Enum())</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12745 rel="external nofollow noreferrer" target=_blank>#12745</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复大元组的性能，这些元组在<code class=syntax>IN</code> 部分被解释为函数. 当用户出于某种晦涩的原因编写 <code class=syntax>WHERE x IN tuple(1, 2, ...)</code> 而不是 <code class=syntax>WHERE x IN (1, 2, ...)</code> 的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/12700 rel="external nofollow noreferrer" target=_blank>#12700</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复 input_format_parallel_parsing 的内存跟踪 (通过将线程附加到组). <a href=https://github.com/ClickHouse/ClickHouse/pull/12672 rel="external nofollow noreferrer" target=_blank>#12672</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>在 <code class=syntax>any(func(&lt;lambda&gt;))</code> 的情况下修复错误的优化 <code class=syntax>optimize_move_functions_out_of_any=1</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12664 rel="external nofollow noreferrer" target=_blank>#12664</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10572 rel="external nofollow noreferrer" target=_blank>#10572</a> 使用 const 表达式修复布隆过滤器索引. <a href=https://github.com/ClickHouse/ClickHouse/pull/12659 rel="external nofollow noreferrer" target=_blank>#12659</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>当代理不可用时 (不仅如此) 修复 StorageKafka 中的 SIGSEGV. <a href=https://github.com/ClickHouse/ClickHouse/pull/12658 rel="external nofollow noreferrer" target=_blank>#12658</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加对带有 <code class=syntax>Array(UUID)</code> 参数的函数 <code class=syntax>if</code> 的支持. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11066 rel="external nofollow noreferrer" target=_blank>#11066</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12648 rel="external nofollow noreferrer" target=_blank>#12648</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果用户存在, CREATE USER IF NOT EXISTS 现在不会抛出异常. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/12507 rel="external nofollow noreferrer" target=_blank>#12507</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12646 rel="external nofollow noreferrer" target=_blank>#12646</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>在意外情况下 (例如从 UInt64 列中减去时),在 <code class=syntax>ALTER ... UPDATE</code> 期间可以抛出异常 <code class=syntax>There is no supertype...</code>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7306 rel="external nofollow noreferrer" target=_blank>#7306</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/4165 rel="external nofollow noreferrer" target=_blank>#4165</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12633 rel="external nofollow noreferrer" target=_blank>#12633</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复使用外部排序的查询可能出现的 <code class=syntax>Pipeline stuck</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12617 rel="external nofollow noreferrer" target=_blank>#12617</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12618 rel="external nofollow noreferrer" target=_blank>#12618</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 <code class=syntax>OPTIMIZE DEDUPLICATE</code> 的错误 <code class=syntax>Output of TreeExecutor is not sorted</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11572 rel="external nofollow noreferrer" target=_blank>#11572</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12613 rel="external nofollow noreferrer" target=_blank>#12613</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复查询优化过程中函数 <code class=syntax>any</code> 结果的别名可能丢失的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/12593 rel="external nofollow noreferrer" target=_blank>#12593</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>在 DROP TABLE 上删除分布式表 (来自异步插入的块) 的数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/12556 rel="external nofollow noreferrer" target=_blank>#12556</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).<br> 现在 ClickHouse 将在文件 <code class=syntax>checksums.txt</code> 不存在时重新计算部件的校验和. 自 <a href=https://github.com/ClickHouse/ClickHouse/issues/9827 rel="external nofollow noreferrer" target=_blank>#9827</a> 以来已损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/12545 rel="external nofollow noreferrer" target=_blank>#12545</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复当 <code class=syntax>enable_mixed_granularity_parts=1</code> 时, 在 <code class=syntax>ALTER DELETE</code> 查询后导致旧部件损坏的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12536 rel="external nofollow noreferrer" target=_blank>#12536</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12543 rel="external nofollow noreferrer" target=_blank>#12543</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复实时视图表中可能导致数据重复的竞争条件. LIVE VIEW 是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/12519 rel="external nofollow noreferrer" target=_blank>#12519</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>修复 <code class=syntax>AggregateFunction(avg, ...)</code>值二进制格式的向后兼容性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12342 rel="external nofollow noreferrer" target=_blank>#12342</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12486 rel="external nofollow noreferrer" target=_blank>#12486</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当我们加入字典键的表达时, 修复 JOIN 与字典中的崩溃: <code class=syntax>t JOIN dict ON expr(dict.id) = t.id</code>. 在这种情况下禁用字典连接优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/12458 rel="external nofollow noreferrer" target=_blank>#12458</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>当指定非常大的 LIMIT 或 OFFSET 时修复溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10470 rel="external nofollow noreferrer" target=_blank>#10470</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11372 rel="external nofollow noreferrer" target=_blank>#11372</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12427 rel="external nofollow noreferrer" target=_blank>#12427</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>kafka: 修复 SIGSEGV 如果在批处理中间有错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/12302 rel="external nofollow noreferrer" target=_blank>#12302</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> </ul> <h4 id=gai-jin_13>改进<a class=headerlink href=../amp/#gai-jin_13 title="Permanent link"> </a></h4> <ul> <li>在 ZooKeeper 中保留少量日志. 当有许多服务器/表/插入时, 避免在离线副本的情况下过度增长 ZooKeeper 节点. <a href=https://github.com/ClickHouse/ClickHouse/pull/13100 rel="external nofollow noreferrer" target=_blank>#13100</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在, 如果在 ALTER 或突变期间发生错误, 则异常会转发给客户端. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11329 rel="external nofollow noreferrer" target=_blank>#11329</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12666 rel="external nofollow noreferrer" target=_blank>#12666</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>将 <code class=syntax>QueryTimeMicroseconds</code>、<code class=syntax>SelectQueryTimeMicroseconds</code> 和 <code class=syntax>InsertQueryTimeMicroseconds</code> 添加到 <code class=syntax>system.events</code>, 以及 system.metrics、processes、query_log 等. <a href=https://github.com/ClickHouse/ClickHouse/pull/13028 rel="external nofollow noreferrer" target=_blank>#13028</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>将 <code class=syntax>SelectedRows</code> 和 <code class=syntax>SelectedBytes</code> 添加到 <code class=syntax>system.events</code>, 以及 system.metrics、processes、query_log 等. <a href=https://github.com/ClickHouse/ClickHouse/pull/12638 rel="external nofollow noreferrer" target=_blank>#12638</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>将 <code class=syntax>current_database</code> 信息添加到 <code class=syntax>system.query_log</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12652 rel="external nofollow noreferrer" target=_blank>#12652</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>允许 <code class=syntax>TabSeparatedRaw</code> 作为输入格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/12009 rel="external nofollow noreferrer" target=_blank>#12009</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>现在 <code class=syntax>joinGet</code> 支持多键查找. <a href=https://github.com/ClickHouse/ClickHouse/pull/12418 rel="external nofollow noreferrer" target=_blank>#12418</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>允许 <code class=syntax>*Map</code> 聚合函数处理带有 NULL 的数组. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13157 rel="external nofollow noreferrer" target=_blank>#13157</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13225 rel="external nofollow noreferrer" target=_blank>#13225</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>避免解析 DateTime 值时溢出, 这将导致其时区中的 unix 时间戳为负 (例如, 莫斯科的 <code class=syntax>1970-01-01 00:00:00</code> ). 相反, 饱和为零. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/3470 rel="external nofollow noreferrer" target=_blank>#3470</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/4172 rel="external nofollow noreferrer" target=_blank>#4172</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12443 rel="external nofollow noreferrer" target=_blank>#12443</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>AvroConfluent: 跳过 Kafka 墓碑记录 - 支持跳过损坏的记录 <a href=https://github.com/ClickHouse/ClickHouse/pull/13203 rel="external nofollow noreferrer" target=_blank>#13203</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>).</li> <li>修复长查询的错误错误. 为了正确查询, 可能会出现除 <code class=syntax>Max query size exceeded</code> 之外的语法错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13928 rel="external nofollow noreferrer" target=_blank>#13928</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 <code class=syntax>lgamma</code> 函数中的数据竞争. 这场比赛只在 <code class=syntax>tsan</code> 中被抓到，真的没有副作用. <a href=https://github.com/ClickHouse/ClickHouse/pull/13842 rel="external nofollow noreferrer" target=_blank>#13842</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 ATTACH/ALTER/CREATE QUOTA 语句的 <code class=syntax>Week</code> 间隔格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/13417 rel="external nofollow noreferrer" target=_blank>#13417</a> (<a href=https://github.com/vladimir-golovchenko rel="external nofollow noreferrer" target=_blank>vladimir-golovchenko</a>).</li> <li>现在, 在紧凑零件加工中遇到损坏零件时也会报告. 紧凑型零件是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/13282 rel="external nofollow noreferrer" target=_blank>#13282</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复 <code class=syntax>geohashesInBox</code> 中的断言. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12554 rel="external nofollow noreferrer" target=_blank>#12554</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13229 rel="external nofollow noreferrer" target=_blank>#13229</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>parseDateTimeBestEffort</code> 中的断言. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12649 rel="external nofollow noreferrer" target=_blank>#12649</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13227 rel="external nofollow noreferrer" target=_blank>#13227</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>Processors/PipelineExecutor 中的小优化: 跳出循环, 因为这样做很有意义. <a href=https://github.com/ClickHouse/ClickHouse/pull/13058 rel="external nofollow noreferrer" target=_blank>#13058</a> (<a href=https://github.com/markpapadakis rel="external nofollow noreferrer" target=_blank>Mark Papadakis</a>).</li> <li>支持不带 TABLE 关键字的 TRUNCATE 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/12653 rel="external nofollow noreferrer" target=_blank>#12653</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复默认情况下解释查询格式覆盖. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12432 rel="external nofollow noreferrer" target=_blank>#12541</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12541 rel="external nofollow noreferrer" target=_blank>#12541</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>).</li> <li>允许以更标准的方式设置 JOIN 种类和类型: <code class=syntax>LEFT SEMI JOIN</code> 而不是 <code class=syntax>SEMI LEFT JOIN</code>. 目前两者都是正确的. <a href=https://github.com/ClickHouse/ClickHouse/pull/12520 rel="external nofollow noreferrer" target=_blank>#12520</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>将 <code class=syntax>multiple_joins_rewriter_version</code> 的默认值更改为 2. 它启用知道列名的新的多连接重写器. <a href=https://github.com/ClickHouse/ClickHouse/pull/12469 rel="external nofollow noreferrer" target=_blank>#12469</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>为对 S3 存储的请求添加多个指标. <a href=https://github.com/ClickHouse/ClickHouse/pull/12464 rel="external nofollow noreferrer" target=_blank>#12464</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>使用 <code class=syntax>--secure</code> 参数为clickhouse-benchmark使用正确的默认安全端口. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11044 rel="external nofollow noreferrer" target=_blank>#11044</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12440 rel="external nofollow noreferrer" target=_blank>#12440</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li><code class=syntax>Log</code>、<code class=syntax>TinyLog</code>、<code class=syntax>StripeLog</code> 引擎中的回滚插入错误. 在以前的版本中, 插入错误会导致表状态不一致 (这按照文档工作，对于这些表引擎来说是正常的). 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12402 rel="external nofollow noreferrer" target=_blank>#12402</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12426 rel="external nofollow noreferrer" target=_blank>#12426</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>为<code class=syntax>Atomic</code> 数据库引擎实现<code class=syntax>RENAME DATABASE</code> 和<code class=syntax>RENAME DICTIONARY</code> - 添加隐式<code class=syntax>{uuid}</code> 宏, 可在<code class=syntax>ReplicatedMergeTree</code> 的ZooKeeper 路径中使用. 它适用于 <code class=syntax>CREATE ... ON CLUSTER ...</code> 查询. 将 <code class=syntax>show_table_uuid_in_table_create_query_if_not_nil</code> 设置为 <code class=syntax>true</code> 以使用它. - 将 <code class=syntax>ReplicatedMergeTree</code> 引擎参数设为可选, 默认使用 <code class=syntax>/clickhouse/tables/{uuid}/{shard}/</code> 和 <code class=syntax>{replica}</code>. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/12135 rel="external nofollow noreferrer" target=_blank>#12135</a>. - 小修正. - 这些更改破坏了 <code class=syntax>Atomic</code> 数据库引擎的向后兼容性. 以前创建的“原子”数据库必须手动转换为新格式. 原子数据库是一个实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/12343 rel="external nofollow noreferrer" target=_blank>#12343</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>将 <code class=syntax>AWSAuthV4Signer</code> 分离到不同的记录器中, 从日志消息中删除过多的 <code class=syntax>AWSClient: AWSClient</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12320 rel="external nofollow noreferrer" target=_blank>#12320</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>磁盘访问存储中更好的异常消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/12625 rel="external nofollow noreferrer" target=_blank>#12625</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>参数数目无效的函数 <code class=syntax>in</code> 的更好例外. <a href=https://github.com/ClickHouse/ClickHouse/pull/12529 rel="external nofollow noreferrer" target=_blank>#12529</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复有关自适应粒度的错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/12624 rel="external nofollow noreferrer" target=_blank>#12624</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复格式化后的设置解析. <a href=https://github.com/ClickHouse/ClickHouse/pull/12480 rel="external nofollow noreferrer" target=_blank>#12480</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果 MergeTree 表不包含 ORDER BY 或 PARTITION BY, 则可能会请求 ALTER 清除所有列, 而 ALTER 将卡住. 已修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7941 rel="external nofollow noreferrer" target=_blank>#7941</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12382 rel="external nofollow noreferrer" target=_blank>#12382</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>避免在每次查询后从历史文件重新加载完成 (以避免历史与其他客户端会话重叠). <a href=https://github.com/ClickHouse/ClickHouse/pull/13086 rel="external nofollow noreferrer" target=_blank>#13086</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> </ul> <h4 id=xing-neng-gai-jin_6>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_6 title="Permanent link"> </a></h4> <ul> <li>某些操作的内存使用量降低高达 2 倍. <a href=https://github.com/ClickHouse/ClickHouse/pull/12424 rel="external nofollow noreferrer" target=_blank>#12424</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>针对匹配精确 PK 范围的查询优化 PK 查找. <a href=https://github.com/ClickHouse/ClickHouse/pull/12277 rel="external nofollow noreferrer" target=_blank>#12277</a> (<a href=https://github.com/bobrik rel="external nofollow noreferrer" target=_blank>Ivan Babrou</a>).</li> <li>使用 <code class=syntax>LowCardinality</code> 稍微优化非常短的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/14129 rel="external nofollow noreferrer" target=_blank>#14129</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>通过 UInt8/UInt16 键略微提高聚合性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/13091 rel="external nofollow noreferrer" target=_blank>#13091</a> and <a href=https://github.com/ClickHouse/ClickHouse/pull/13055 rel="external nofollow noreferrer" target=_blank>#13055</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>下推<code class=syntax>LIMIT</code>步骤查询计划 (在子查询内). <a href=https://github.com/ClickHouse/ClickHouse/pull/13016 rel="external nofollow noreferrer" target=_blank>#13016</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>并行主键查找和跳过部分的索引阶段, 如 <a href=https://github.com/ClickHouse/ClickHouse/issues/11564 rel="external nofollow noreferrer" target=_blank>#11564</a> 中所述. <a href=https://github.com/ClickHouse/ClickHouse/pull/12589 rel="external nofollow noreferrer" target=_blank>#12589</a> (<a href=https://github.com/bobrik rel="external nofollow noreferrer" target=_blank>Ivan Babrou</a>).</li> <li>如果 <code class=syntax>set optimize_if_transform_strings_to_enum = 1</code>, 则将函数 <code class=syntax>if</code> 和 <code class=syntax>transform</code> 的字符串类型参数转换为枚举. <a href=https://github.com/ClickHouse/ClickHouse/pull/12515 rel="external nofollow noreferrer" target=_blank>#12515</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>如果 <code class=syntax>set optimize_monotonous_functions_in_order_by=1</code>, 则用 <code class=syntax>ORDER BY</code> 中的参数替换单调函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/12467 rel="external nofollow noreferrer" target=_blank>#12467</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>通过优化添加顺序, 如果 <code class=syntax>set optimize_redundant_functions_in_order_by = 1</code>, 则用 <code class=syntax>ORDER by x</code> 重写 <code class=syntax>ORDER BY x, f(x)</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/12404 rel="external nofollow noreferrer" target=_blank>#12404</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>当子查询包含<code class=syntax>WITH</code> 子句时允许下推谓词. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12293 rel="external nofollow noreferrer" target=_blank>#12293</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/12663 rel="external nofollow noreferrer" target=_blank>#12663</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>提高读取紧凑部件的性能. 紧凑型零件是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/12492 rel="external nofollow noreferrer" target=_blank>#12492</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>尝试在 <code class=syntax>DiskS3</code> 中实现流优化. DiskS3 是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/12434 rel="external nofollow noreferrer" target=_blank>#12434</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_8>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_8 title="Permanent link"> </a></h4> <ul> <li>使用 <code class=syntax>shellcheck</code> 进行 sh 测试 linting. <a href=https://github.com/ClickHouse/ClickHouse/pull/13200 rel="external nofollow noreferrer" target=_blank>#13200</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/13207 rel="external nofollow noreferrer" target=_blank>#13207</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 GitHub 挂钩中添加为拉取请求设置标签的脚本. <a href=https://github.com/ClickHouse/ClickHouse/pull/13183 rel="external nofollow noreferrer" target=_blank>#13183</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>删除一些递归子模块. 见 <a href=https://github.com/ClickHouse/ClickHouse/issues/13378 rel="external nofollow noreferrer" target=_blank>#13378</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13379 rel="external nofollow noreferrer" target=_blank>#13379</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>确保所有子模块都来自正确的 URL. Continuation of <a href=https://github.com/ClickHouse/ClickHouse/issues/13379 rel="external nofollow noreferrer" target=_blank>#13379</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/13378 rel="external nofollow noreferrer" target=_blank>#13378</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13397 rel="external nofollow noreferrer" target=_blank>#13397</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了对用户声明的设置的支持, 可以从内部查询访问. 当 ClickHouse 引擎用作另一个系统的组件时需要这样做. <a href=https://github.com/ClickHouse/ClickHouse/pull/13013 rel="external nofollow noreferrer" target=_blank>#13013</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>在 TestFlows 中添加了对 INSERT 权限的 RBAC 功能的测试. 正在测试 SELECT 的扩展表. 添加了匹配新表引擎测试的要求. <a href=https://github.com/ClickHouse/ClickHouse/pull/13340 rel="external nofollow noreferrer" target=_blank>#13340</a> (<a href=https://github.com/MyroTk rel="external nofollow noreferrer" target=_blank>MyroTk</a>).</li> <li>修复压力测试中服务器重启时超时错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13321 rel="external nofollow noreferrer" target=_blank>#13321</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>现在快速测试将等待服务器重试. <a href=https://github.com/ClickHouse/ClickHouse/pull/13284 rel="external nofollow noreferrer" target=_blank>#13284</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>函数<code class=syntax>materialize()</code> (用于 ClickHouse 测试的函数) 将按预期为 NULL 工作 - 通过将其转换为非常量列. <a href=https://github.com/ClickHouse/ClickHouse/pull/13212 rel="external nofollow noreferrer" target=_blank>#13212</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 AArch64 中的 libunwind 构建. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13204 rel="external nofollow noreferrer" target=_blank>#13204</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13208 rel="external nofollow noreferrer" target=_blank>#13208</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 zkutil gtest 中进行更多重试以防止测试不稳定. <a href=https://github.com/ClickHouse/ClickHouse/pull/13165 rel="external nofollow noreferrer" target=_blank>#13165</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>对 RBAC 测试流的小修正. <a href=https://github.com/ClickHouse/ClickHouse/pull/13152 rel="external nofollow noreferrer" target=_blank>#13152</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>修复 <code class=syntax>00960_live_view_watch_events_live.py</code> 测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/13108 rel="external nofollow noreferrer" target=_blank>#13108</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>改进文档部署脚本中的缓存清除. <a href=https://github.com/ClickHouse/ClickHouse/pull/13107 rel="external nofollow noreferrer" target=_blank>#13107</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>重写了一些孤立的测试到gtest. 从测试中移除无用的内容. <a href=https://github.com/ClickHouse/ClickHouse/pull/13073 rel="external nofollow noreferrer" target=_blank>#13073</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>在 TestFlows 中添加了对 <code class=syntax>SELECT</code> 权限的 RBAC 功能的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/13061 rel="external nofollow noreferrer" target=_blank>#13061</a> (<a href=https://github.com/ritaank rel="external nofollow noreferrer" target=_blank>Ritaank Tiwari</a>).</li> <li>在快速测试检查中重新运行一些测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/12992 rel="external nofollow noreferrer" target=_blank>#12992</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复 <code class=syntax>rdkafka</code> 库中的 MSan 错误. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/12990 rel="external nofollow noreferrer" target=_blank>#12990</a>. 将 <code class=syntax>rdkafka</code> 更新到 1.5 版 (主). <a href=https://github.com/ClickHouse/ClickHouse/pull/12991 rel="external nofollow noreferrer" target=_blank>#12991</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果在带有 AVX-512 的服务器上运行测试, 则修复 base64 中的 UBSan 报告. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12318 rel="external nofollow noreferrer" target=_blank>#12318</a>. 作者: @qoega. <a href=https://github.com/ClickHouse/ClickHouse/pull/12441 rel="external nofollow noreferrer" target=_blank>#12441</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 HDFS 库中的 UBSan 报告. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/12330 rel="external nofollow noreferrer" target=_blank>#12330</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12453 rel="external nofollow noreferrer" target=_blank>#12453</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>检查我们能够将备份从旧版本恢复到新版本的能力. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/8979 rel="external nofollow noreferrer" target=_blank>#8979</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12959 rel="external nofollow noreferrer" target=_blank>#12959</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>不要在集成测试中构建 helper_container 图像. 在 CI 中构建 docker 容器并在集成测试中使用预构建的 helper_container. <a href=https://github.com/ClickHouse/ClickHouse/pull/12953 rel="external nofollow noreferrer" target=_blank>#12953</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>为主键列添加对 <code class=syntax>ALTER TABLE CLEAR COLUMN</code> 查询的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/12951 rel="external nofollow noreferrer" target=_blank>#12951</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>测试流测试中的超时时间增加. <a href=https://github.com/ClickHouse/ClickHouse/pull/12949 rel="external nofollow noreferrer" target=_blank>#12949</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>修复 Mac OS X 下的测试构建. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/12767 rel="external nofollow noreferrer" target=_blank>#12767</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12772 rel="external nofollow noreferrer" target=_blank>#12772</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>连接器-ODBC 更新为 mysql-connector-odbc-8.0.21. <a href=https://github.com/ClickHouse/ClickHouse/pull/12739 rel="external nofollow noreferrer" target=_blank>#12739</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>在 TestFlows 中添加 RBAC 语法测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/12642 rel="external nofollow noreferrer" target=_blank>#12642</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>提高 TestKeeper 的性能. 这将加速大量使用复制表的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/12505 rel="external nofollow noreferrer" target=_blank>#12505</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在我们检查服务器是否能够在压力测试运行后启动. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12473 rel="external nofollow noreferrer" target=_blank>#12473</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12496 rel="external nofollow noreferrer" target=_blank>#12496</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>将 fmtlib 更新到 master (7.0.1). <a href=https://github.com/ClickHouse/ClickHouse/pull/12446 rel="external nofollow noreferrer" target=_blank>#12446</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加 docker 镜像以进行快速测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/12294 rel="external nofollow noreferrer" target=_blank>#12294</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>集成测试的返工配置路径. <a href=https://github.com/ClickHouse/ClickHouse/pull/12285 rel="external nofollow noreferrer" target=_blank>#12285</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>添加编译器选项以控制堆栈帧不会太大. 这将有助于在具有小堆栈大小的纤程中运行代码. <a href=https://github.com/ClickHouse/ClickHouse/pull/11524 rel="external nofollow noreferrer" target=_blank>#11524</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>更新 gitignore 文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/13447 rel="external nofollow noreferrer" target=_blank>#13447</a> (<a href=https://github.com/vladimir-golovchenko rel="external nofollow noreferrer" target=_blank>vladimir-golovchenko</a>).</li> </ul> <h2 id=clickhouse-ban-ben-20-6>ClickHouse 版本 20.6<a class=headerlink href=../amp/#clickhouse-ban-ben-20-6 title="Permanent link"> </a></h2> <h3 id=clickhouse-ban-ben-v20-6-3-28-stable>ClickHouse 版本 v20.6.3.28-stable<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-6-3-28-stable title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng_6>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng_6 title="Permanent link"> </a></h4> <ul> <li>从20.5以上的版本升级时, 如果进行滚动更新, 集群同时包含20.5以上和20.5以下的版本, 如果旧版本的ClickHouse节点重启, 旧版本在新版本存在的情况下启动，可能会导致 到 <code class=syntax>Part ... intersects previous part</code> 错误. 为防止出现此错误，首先在所有集群节点上安装更新的 clickhouse-server 软件包，然后重新启动 (因此, 当 clickhouse-server 重新启动时, 它将以新版本启动).</li> </ul> <h4 id=xin-te-zheng_6>新特征<a class=headerlink href=../amp/#xin-te-zheng_6 title="Permanent link"> </a></h4> <ul> <li>添加了 <code class=syntax>EXPLAIN</code> 查询的初始实现. 语法: <code class=syntax>EXPLAIN SELECT ...</code>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/1118 rel="external nofollow noreferrer" target=_blank>#1118</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11873 rel="external nofollow noreferrer" target=_blank>#11873</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>添加了存储 <code class=syntax>RabbitMQ</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11069 rel="external nofollow noreferrer" target=_blank>#11069</a> (<a href=https://github.com/kssenii rel="external nofollow noreferrer" target=_blank>Kseniia Sumarokova</a>).</li> <li>为 <a href=https://github.com/ClickHouse/ClickHouse/issues/11710 rel="external nofollow noreferrer" target=_blank>#11710</a> 实现了类似 PostgreSQL 的 <code class=syntax>ILIKE</code> 操作符. <a href=https://github.com/ClickHouse/ClickHouse/pull/12125 rel="external nofollow noreferrer" target=_blank>#12125</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>支持 RIGHT 和 FULL JOIN 与 <code class=syntax>SET join_algorithm = 'partial_merge'</code>. 只允许 ALL 严格 (ANY、SEMI、ANTI、ASOF 不是). <a href=https://github.com/ClickHouse/ClickHouse/pull/12118 rel="external nofollow noreferrer" target=_blank>#12118</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>添加了一个函数 <code class=syntax>initializeAggregation</code> 以初始化基于单个值的聚合. <a href=https://github.com/ClickHouse/ClickHouse/pull/12109 rel="external nofollow noreferrer" target=_blank>#12109</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>).</li> <li>支持 <code class=syntax>ALTER TABLE ... [ADD|MODIFY] COLUMN ... FIRST</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/4006 rel="external nofollow noreferrer" target=_blank>#4006</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12073 rel="external nofollow noreferrer" target=_blank>#12073</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>添加了函数 <code class=syntax>parseDateTimeBestEffortUS</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/12028 rel="external nofollow noreferrer" target=_blank>#12028</a> (<a href=https://github.com/ucasFL rel="external nofollow noreferrer" target=_blank>flynn</a>).</li> <li>支持输出格式 <code class=syntax>ORC</code> (仅支持输入). <a href=https://github.com/ClickHouse/ClickHouse/pull/11662 rel="external nofollow noreferrer" target=_blank>#11662</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> </ul> <h4 id=bug-xiu-fu_25>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_25 title="Permanent link"> </a></h4> <ul> <li>修复了 <code class=syntax>aggregate function any(x) is found inside another aggregate function in query</code> 错误, 其中包含 <code class=syntax>SET optimize_move_functions_out_of_any = 1</code> 和 <code class=syntax>any()</code> 中的别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/13419 rel="external nofollow noreferrer" target=_blank>#13419</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了 clickhouse-local 的 <code class=syntax>PrettyCompactMonoBlock</code> . 使用 <code class=syntax>PrettyCompactMonoBlock</code> 修复了极端/总数. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7746 rel="external nofollow noreferrer" target=_blank>#7746</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13394 rel="external nofollow noreferrer" target=_blank>#13394</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了在从延迟副本查询的情况下可能出现的错误 <code class=syntax>Totals having transform was already added to pipeline</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/13290 rel="external nofollow noreferrer" target=_blank>#13290</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>如果用户将特制的参数传递给函数 <code class=syntax>h3ToChildren</code>, 服务器可能会崩溃. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13275 rel="external nofollow noreferrer" target=_blank>#13275</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13277 rel="external nofollow noreferrer" target=_blank>#13277</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在具有 NaN 值的 Float 类型上调用的 <code class=syntax>uniqExact</code>、<code class=syntax>topK</code>、<code class=syntax>sumDistinct</code> 和类似聚合函数的潜在低性能和稍微不正确的结果. 它还在调试版本中触发断言. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12491 rel="external nofollow noreferrer" target=_blank>#12491</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13254 rel="external nofollow noreferrer" target=_blank>#13254</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了如果以nullable constexpr为cond, 则不是字面量 NULL 问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12463 rel="external nofollow noreferrer" target=_blank>#12463</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13226 rel="external nofollow noreferrer" target=_blank>#13226</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在数组元素为 Nullable 且数组下标也可为 Null 的情况下, 修复了 <code class=syntax>arrayElement</code> 函数中的断言. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12172 rel="external nofollow noreferrer" target=_blank>#12172</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13224 rel="external nofollow noreferrer" target=_blank>#13224</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了带有常量参数的 <code class=syntax>DateTime64</code> 转换函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/13205 rel="external nofollow noreferrer" target=_blank>#13205</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>用函数修正了错误的索引分析. 在从 <code class=syntax>MergeTree</code> 表中读取时, 它可能会导致修剪错误的部分. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13060 rel="external nofollow noreferrer" target=_blank>#13060</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/12406 rel="external nofollow noreferrer" target=_blank>#12406</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13081 rel="external nofollow noreferrer" target=_blank>#13081</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了错误 <code class=syntax>Cannot convert column because it is constant but values of constants are different in source and result</code>, 远程查询在查询范围内使用确定性函数, 但查询之间不具有确定性, 例如 <code class=syntax>now()</code>、<code class=syntax>now64()</code>、<code class=syntax>randConstant()</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11327 rel="external nofollow noreferrer" target=_blank>#11327</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13075 rel="external nofollow noreferrer" target=_blank>#13075</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了对从本地副本进行选择的线程数的不必要限制. <a href=https://github.com/ClickHouse/ClickHouse/pull/12840 rel="external nofollow noreferrer" target=_blank>#12840</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了当 <code class=syntax>ALTER DELETE</code> 和 <code class=syntax>ALTER MODIFY COLUMN</code> 查询作为单个突变同时执行时的罕见错误. 错误导致 <code class=syntax>count.txt</code> 中的行数不正确, 从而导致部分数据不正确. 另外, 修复了一个同时使用<code class=syntax>ALTER RENAME COLUMN</code>和<code class=syntax>ALTER ADD COLUMN</code> 的小错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/12760 rel="external nofollow noreferrer" target=_blank>#12760</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 <code class=syntax>CAST(Nullable(String), Enum())</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12745 rel="external nofollow noreferrer" target=_blank>#12745</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了大元组的性能, 这些元组在 <code class=syntax>IN</code> 部分被解释为函数. 当用户出于某种晦涩的原因编写 <code class=syntax>WHERE x IN tuple(1, 2, ...)</code> 而不是 <code class=syntax>WHERE x IN (1, 2, ...)</code> 的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/12700 rel="external nofollow noreferrer" target=_blank>#12700</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 <code class=syntax>input_format_parallel_parsing</code> 的内存跟踪 (通过将线程附加到组). <a href=https://github.com/ClickHouse/ClickHouse/pull/12672 rel="external nofollow noreferrer" target=_blank>#12672</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 const 表达式修复了布隆过滤器索引. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10572 rel="external nofollow noreferrer" target=_blank>#10572</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12659 rel="external nofollow noreferrer" target=_blank>#12659</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了当 Broker 不可用时 (不仅如此) 在 <code class=syntax>StorageKafka</code> 中的 <code class=syntax>SIGSEGV</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12658 rel="external nofollow noreferrer" target=_blank>#12658</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加了对带有 <code class=syntax>Array(UUID)</code> 参数的函数 <code class=syntax>if</code> 的支持. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11066 rel="external nofollow noreferrer" target=_blank>#11066</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12648 rel="external nofollow noreferrer" target=_blank>#12648</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果用户存在, <code class=syntax>CREATE USER IF NOT EXISTS</code> 现在不会抛出异常. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12507 rel="external nofollow noreferrer" target=_blank>#12507</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12646 rel="external nofollow noreferrer" target=_blank>#12646</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>磁盘访问存储中更好的异常消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/12625 rel="external nofollow noreferrer" target=_blank>#12625</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>函数 <code class=syntax>groupArrayMoving*</code> 不适用于分布式查询. 它的结果是在不正确的数据类型中计算的 (没有升级到最大的类型). <code class=syntax>groupArrayMovingAvg</code> 函数返回的整数与 <code class=syntax>avg</code> 函数不一致. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12568 rel="external nofollow noreferrer" target=_blank>#12568</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12622 rel="external nofollow noreferrer" target=_blank>#12622</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了函数 <code class=syntax>any</code> 缺少别名的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/12593 rel="external nofollow noreferrer" target=_blank>#12593</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了带有缓存布局的外部字典中的竞争条件, 这可能导致服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/12566 rel="external nofollow noreferrer" target=_blank>#12566</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在 DROP TABLE 上删除分布式表 (来自异步插入的块) 的数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/12556 rel="external nofollow noreferrer" target=_blank>#12556</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了当 <code class=syntax>enable_mixed_granularity_parts=1</code> 时, 在 <code class=syntax>ALTER DELETE</code> 查询后导致旧部件损坏的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12536 rel="external nofollow noreferrer" target=_blank>#12536</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12543 rel="external nofollow noreferrer" target=_blank>#12543</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>参数数目无效的函数 <code class=syntax>in</code> 的更好例外. <a href=https://github.com/ClickHouse/ClickHouse/pull/12529 rel="external nofollow noreferrer" target=_blank>#12529</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复实时视图表中可能导致数据重复的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/12519 rel="external nofollow noreferrer" target=_blank>#12519</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>修正了从合并部分读取时的性能问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/12492 rel="external nofollow noreferrer" target=_blank>#12492</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 <code class=syntax>AggregateFunction(avg, ...)</code> 值的二进制格式的向后兼容性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12342 rel="external nofollow noreferrer" target=_blank>#12342</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12486 rel="external nofollow noreferrer" target=_blank>#12486</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>固定设置解析格式后. <a href=https://github.com/ClickHouse/ClickHouse/pull/12480 rel="external nofollow noreferrer" target=_blank>#12480</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了启用 <code class=syntax>text_log</code> 时的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/12452 rel="external nofollow noreferrer" target=_blank>#12452</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了指定非常大的 <code class=syntax>LIMIT</code> 或 <code class=syntax>OFFSET</code> 时的溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10470 rel="external nofollow noreferrer" target=_blank>#10470</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11372 rel="external nofollow noreferrer" target=_blank>#11372</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12427 rel="external nofollow noreferrer" target=_blank>#12427</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果 <code class=syntax>StorageMerge</code> , 则修复了可能的段错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12054 rel="external nofollow noreferrer" target=_blank>#12054</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12401 rel="external nofollow noreferrer" target=_blank>#12401</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>恢复在 <a href=https://github.com/ClickHouse/ClickHouse/issues/11079 rel="external nofollow noreferrer" target=_blank>#11079</a> 中引入的更改以解决 <a href=https://github.com/ClickHouse/ClickHouse/issues/12098 rel="external nofollow noreferrer" target=_blank>#12098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12397 rel="external nofollow noreferrer" target=_blank>#12397</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>额外检查布隆过滤器索引的参数. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11408 rel="external nofollow noreferrer" target=_blank>#11408</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12388 rel="external nofollow noreferrer" target=_blank>#12388</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在索引表的 WHERE 条件中使用负数或浮点常量时避免异常. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11905 rel="external nofollow noreferrer" target=_blank>#11905</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12384 rel="external nofollow noreferrer" target=_blank>#12384</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在索引表的 WHERE 条件中使用负数或浮点常量时避免异常. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12333 rel="external nofollow noreferrer" target=_blank>#12333</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12378 rel="external nofollow noreferrer" target=_blank>#12378</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复带有 <code class=syntax>-State</code> 和 <code class=syntax>Nullable</code> 参数的聚合函数的 <code class=syntax>TOTALS/ROLLUP/CUBE</code>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12163 rel="external nofollow noreferrer" target=_blank>#12163</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12376 rel="external nofollow noreferrer" target=_blank>#12376</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在不允许使用 <code class=syntax>RENAME</code> 时, <code class=syntax>ALTER RENAME COLUMN</code> 查询的错误消息和退出代码. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12301 rel="external nofollow noreferrer" target=_blank>#12301</a> 和 <a href=https://github.com/ClickHouse/ClickHouse/issues/12303 rel="external nofollow noreferrer" target=_blank>#12303</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12335 rel="external nofollow noreferrer" target=_blank>#12335</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 <code class=syntax>ReplicatedMergeTree Queue</code> 中非常罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/12315 rel="external nofollow noreferrer" target=_blank>#12315</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当使用具有非固定宽度类型的编解码器 <code class=syntax>Delta</code> 或 <code class=syntax>DoubleDelta</code> 时, 返回代码为 <code class=syntax>LOGICAL_ERROR</code> 的异常而不是代码为 <code class=syntax>BAD_ARGUMENTS</code> 的异常 (我们确保代码逻辑错误的异常永远不会发生). 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12110 rel="external nofollow noreferrer" target=_blank>#12110</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12308 rel="external nofollow noreferrer" target=_blank>#12308</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 <code class=syntax>WITH FILL</code> 修饰符中列的顺序. 以前不遵守 <code class=syntax>ORDER BY</code> 语句的列顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/12306 rel="external nofollow noreferrer" target=_blank>#12306</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>当存在按虚拟列 (如 <code class=syntax>Merge</code> 表中的 <code class=syntax>_table</code>) 或系统表中的 "index" 列过滤数据 (例如从 <code class=syntax>system.tables</code> 查询时按数据库名称过滤) 时, 避免 <code class=syntax>bad cast</code> 异常 <code class=syntax>, 并且这个表达式返回</code>Nullable` 类型. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12166 rel="external nofollow noreferrer" target=_blank>#12166</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12305 rel="external nofollow noreferrer" target=_blank>#12305</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了重命名列后的 <code class=syntax>TTL</code>, 它依赖于 TTL 表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/12304 rel="external nofollow noreferrer" target=_blank>#12304</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 SIGSEGV 如果在 <code class=syntax>Kafka</code> 引擎中批处理中间有错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/12302 rel="external nofollow noreferrer" target=_blank>#12302</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>DNS</code> 缓存更新过程中某些线程可能会随机挂起几秒钟的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/12296 rel="external nofollow noreferrer" target=_blank>#12296</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了设置名称中的错字. <a href=https://github.com/ClickHouse/ClickHouse/pull/12292 rel="external nofollow noreferrer" target=_blank>#12292</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li><code class=syntax>TrieDictionary</code> 加载失败后显示错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/12290 rel="external nofollow noreferrer" target=_blank>#12290</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>对于可能导致崩溃的空数组, 函数 <code class=syntax>arrayFill</code> 工作不正确. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12263 rel="external nofollow noreferrer" target=_blank>#12263</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12279 rel="external nofollow noreferrer" target=_blank>#12279</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>实现到 <code class=syntax>LowCardinality</code> 类型的公共类型的转换. 这允许对具有 LowCardinality 列和其他列的表执行 UNION ALL. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8212 rel="external nofollow noreferrer" target=_blank>#8212</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/4342 rel="external nofollow noreferrer" target=_blank>#4342</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12275 rel="external nofollow noreferrer" target=_blank>#12275</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在对 <code class=syntax>S3</code> 存储的请求中达到重定向限制的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/12256 rel="external nofollow noreferrer" target=_blank>#12256</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>修复了在某些特殊类型的 <code class=syntax>StorageFile</code> 标头中多次连续插入期间多次写入时的行为. 这个修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6155 rel="external nofollow noreferrer" target=_blank>#6155</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12197 rel="external nofollow noreferrer" target=_blank>#12197</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复了 UInt8 值不等于 0 或 1 时的逻辑函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/12196 rel="external nofollow noreferrer" target=_blank>#12196</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>上限 max_memory_usage* 限制为进程驻留内存. <a href=https://github.com/ClickHouse/ClickHouse/pull/12182 rel="external nofollow noreferrer" target=_blank>#12182</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>在 <code class=syntax>GROUP BY</code> 内射函数消除期间修复 dictGet 参数检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/12179 rel="external nofollow noreferrer" target=_blank>#12179</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了当 <code class=syntax>SummingMergeTree</code> 引擎从分区键中汇总列时的行为. 在列的显式定义与分区键列相交的情况下添加了一个例外. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7867 rel="external nofollow noreferrer" target=_blank>#7867</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12173 rel="external nofollow noreferrer" target=_blank>#12173</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>如果 ODBC 连接不支持架构, 则不要将字典源的表名拆分为架构和表名本身. <a href=https://github.com/ClickHouse/ClickHouse/pull/12165 rel="external nofollow noreferrer" target=_blank>#12165</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复了 <code class=syntax>ALTER DELETE</code> 中的错误逻辑, 当条件评估为 NULL 时会导致删除记录. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9088 rel="external nofollow noreferrer" target=_blank>#9088</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/12106 rel="external nofollow noreferrer" target=_blank>#12106</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12153 rel="external nofollow noreferrer" target=_blank>#12153</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在存在别名的情况下发送到外部 DBMS (例如 MySQL、ODBC) 的查询转换. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/12032 rel="external nofollow noreferrer" target=_blank>#12032</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12151 rel="external nofollow noreferrer" target=_blank>#12151</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了冗余 ORDER BY 优化中的错误代码. 该错误是在 <a href=https://github.com/ClickHouse/ClickHouse/issues/10067 rel="external nofollow noreferrer" target=_blank>#10067</a> 中引入的. <a href=https://github.com/ClickHouse/ClickHouse/pull/12148 rel="external nofollow noreferrer" target=_blank>#12148</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了整数除法中的潜在溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12119 rel="external nofollow noreferrer" target=_blank>#12119</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12140 rel="external nofollow noreferrer" target=_blank>#12140</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 <code class=syntax>greatCircleDistance</code>、<code class=syntax>geoDistance</code> 中潜在的无限循环. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12117 rel="external nofollow noreferrer" target=_blank>#12117</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12137 rel="external nofollow noreferrer" target=_blank>#12137</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>规范化 <code class=syntax>pid</code> 文件处理. 在以前的版本中, 如果服务器在没有正确关闭的情况下被杀死, 并且有另一个进程与以前运行的服务器具有相同的 pid, 则服务器可能会拒绝启动. 即使有另一台服务器正在运行, pid 文件也可能在服务器启动失败时被删除. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/3501 rel="external nofollow noreferrer" target=_blank>#3501</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12133 rel="external nofollow noreferrer" target=_blank>#12133</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了导致 ZooKeepeer 中 ReplicatedVersionedCollapsingMergeTree 表的表元数据不正确的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12093 rel="external nofollow noreferrer" target=_blank>#12093</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12121 rel="external nofollow noreferrer" target=_blank>#12121</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>对于具有连接或附加到系统日志 (system.query_log、metric_log 等) 或 engine=Buffer 基础表的子查询的物化视图, 避免 <code class=syntax>There is no query</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/12120 rel="external nofollow noreferrer" target=_blank>#12120</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复了对字典的 ENGINE=Dictionary 表的处理依赖性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10994 rel="external nofollow noreferrer" target=_blank>#10994</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10397 rel="external nofollow noreferrer" target=_blank>#10397</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12116 rel="external nofollow noreferrer" target=_blank>#12116</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>格式 <code class=syntax>Parquet</code> 现在可以正确地与 <code class=syntax>LowCardinality</code> 和 <code class=syntax>LowCardinality(Nullable)</code> 类型一起使用. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12086 rel="external nofollow noreferrer" target=_blank>#12086</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/8406 rel="external nofollow noreferrer" target=_blank>#8406</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12108 rel="external nofollow noreferrer" target=_blank>#12108</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了由于线程总数限制错误导致的带有 <code class=syntax>UNION</code> 的选择的性能. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12030 rel="external nofollow noreferrer" target=_blank>#12030</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12103 rel="external nofollow noreferrer" target=_blank>#12103</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用 <code class=syntax>-StateResample</code> 组合器修复了段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/12092 rel="external nofollow noreferrer" target=_blank>#12092</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 <code class=syntax>system.quey_log</code> 中选择的空 <code class=syntax>result_rows</code> 和 <code class=syntax>result_bytes</code> 指标. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11595 rel="external nofollow noreferrer" target=_blank>#11595</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12089 rel="external nofollow noreferrer" target=_blank>#12089</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了不必要的限制从 <code class=syntax>VIEW</code> 中选择的线程数. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11937 rel="external nofollow noreferrer" target=_blank>#11937</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12085 rel="external nofollow noreferrer" target=_blank>#12085</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 DROP TABLE 上 StorageKafka 中的 SIGSEGV. <a href=https://github.com/ClickHouse/ClickHouse/pull/12075 rel="external nofollow noreferrer" target=_blank>#12075</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了对 <code class=syntax>PREWHERE</code> 使用错误类型时可能发生的崩溃。 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12053 rel="external nofollow noreferrer" target=_blank>#12053</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/12060 rel="external nofollow noreferrer" target=_blank>#12060</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12060 rel="external nofollow noreferrer" target=_blank>#12060</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了带有 <code class=syntax>Tuple(LowCardinality)</code> 参数的高阶函数的错误 <code class=syntax>Cannot capture column</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9766 rel="external nofollow noreferrer" target=_blank>#9766</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12055 rel="external nofollow noreferrer" target=_blank>#12055</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>固定约束检查约束是否为常量表达式. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11360 rel="external nofollow noreferrer" target=_blank>#11360</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12042 rel="external nofollow noreferrer" target=_blank>#12042</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在调用具有不同大小的 <code class=syntax>FixedString</code> 类型参数的函数 <code class=syntax>if</code> 时出现错误结果和潜在崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11362 rel="external nofollow noreferrer" target=_blank>#11362</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12021 rel="external nofollow noreferrer" target=_blank>#12021</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h4 id=gai-jin_14>改进<a class=headerlink href=../amp/#gai-jin_14 title="Permanent link"> </a></h4> <ul> <li>允许以更标准的方式设置 <code class=syntax>JOIN</code> 种类和类型: <code class=syntax>LEFT SEMI JOIN</code>而不是<code class=syntax>SEMI LEFT JOIN</code>. 目前两者都是正确的. <a href=https://github.com/ClickHouse/ClickHouse/pull/12520 rel="external nofollow noreferrer" target=_blank>#12520</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>缓冲区引擎的lifetime_rows/lifetime_bytes. <a href=https://github.com/ClickHouse/ClickHouse/pull/12421 rel="external nofollow noreferrer" target=_blank>#12421</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>将详细异常消息写入客户端而不是 <code class=syntax>MySQL server has gone away</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/12383 rel="external nofollow noreferrer" target=_blank>#12383</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>).</li> <li>允许更改用于打印网格边框的字符集. 可用的字符集如下: UTF-8、ASCII. 设置 <code class=syntax>output_format_pretty_grid_charset</code> 启用此功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/12372 rel="external nofollow noreferrer" target=_blank>#12372</a> (<a href=https://github.com/s-mx rel="external nofollow noreferrer" target=_blank>Sabyanin Maxim</a>).</li> <li>1.支持 MySQL 'SELECT DATABASE()' <a href=https://github.com/ClickHouse/ClickHouse/issues/9336 rel="external nofollow noreferrer" target=_blank>#9336</a>. 2. 添加 MySQL 替换查询集成测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/12314 rel="external nofollow noreferrer" target=_blank>#12314</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>).</li> <li>为 MySQL 客户端/驱动程序添加 <code class=syntax>KILL QUERY [connection_id]</code> 以取消长查询, 问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/12038 rel="external nofollow noreferrer" target=_blank>#12038</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12152 rel="external nofollow noreferrer" target=_blank>#12152</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>).</li> <li>在 <code class=syntax>formatDateTime</code> 函数中添加了对 <code class=syntax>%g</code> (两位 ISO 年份) 和 <code class=syntax>%G</code> (四位 ISO 年份) 替换的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/12136 rel="external nofollow noreferrer" target=_blank>#12136</a> (<a href=https://github.com/vivarum rel="external nofollow noreferrer" target=_blank>vivarum</a>).</li> <li>在 system.disks 中添加了 <code class=syntax>type</code> 列. <a href=https://github.com/ClickHouse/ClickHouse/pull/12115 rel="external nofollow noreferrer" target=_blank>#12115</a> (<a href=https://github.com/ianton-ru rel="external nofollow noreferrer" target=_blank>ianton-ru</a>).</li> <li>改进的<code class=syntax>REVOKE</code> 命令: 现在它只需要授予/管理选项才能被撤销. 例如, 现在要执行 <code class=syntax>REVOKE ALL ON *.* FROM user1</code>, 不需要通过授予选项授予完全访问权限. 添加命令 <code class=syntax>REVOKE ALL FROM user1</code> - 它从 <code class=syntax>user1</code> 撤销所有授予的角色. <a href=https://github.com/ClickHouse/ClickHouse/pull/12083 rel="external nofollow noreferrer" target=_blank>#12083</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>为 load_balancing 添加了副本优先级 (用于手动确定负载平衡的优先级). <a href=https://github.com/ClickHouse/ClickHouse/pull/11995 rel="external nofollow noreferrer" target=_blank>#11995</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>将 S3 元数据中的路径切换为相对路径, 以便更轻松地处理 S3 blob. <a href=https://github.com/ClickHouse/ClickHouse/pull/11892 rel="external nofollow noreferrer" target=_blank>#11892</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> </ul> <h4 id=xing-neng-gai-jin_7>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_7 title="Permanent link"> </a></h4> <ul> <li>通过排序键的前缀改进了 <code class=syntax>ORDER BY</code> 和 <code class=syntax>GROUP BY</code> 的性能 (使用 <code class=syntax>optimize_aggregation_in_order</code> 设置启用, 默认禁用). <a href=https://github.com/ClickHouse/ClickHouse/pull/11696 rel="external nofollow noreferrer" target=_blank>#11696</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>如果 <code class=syntax>set optimize_injective_functions_inside_uniq=1</code>, 则删除 <code class=syntax>uniq*()</code> 内的单射函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/12337 rel="external nofollow noreferrer" target=_blank>#12337</a> (<a href=https://github.com/kamalov-ruslan rel="external nofollow noreferrer" target=_blank>Ruslan Kamalov</a>).</li> <li>索引不用于带文字的 IN 运算符, 在 v19.3 前后引入了性能回归. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/10574 rel="external nofollow noreferrer" target=_blank>#10574</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12062 rel="external nofollow noreferrer" target=_blank>#12062</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> <li>为 DiskS3 (实验功能) 实现单部分上传. <a href=https://github.com/ClickHouse/ClickHouse/pull/12026 rel="external nofollow noreferrer" target=_blank>#12026</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> </ul> <h4 id=shi-yan-gong-neng_4>实验功能<a class=headerlink href=../amp/#shi-yan-gong-neng_4 title="Permanent link"> </a></h4> <ul> <li>在 <code class=syntax>MergeTree</code> -family 表中添加了新的部件内存格式, 将数据存储在内存中. 第一次合并时将部分写入磁盘. 如果零件的行或字节大小低于阈值 <code class=syntax>min_rows_for_compact_part</code> 和 <code class=syntax>min_bytes_for_compact_part</code>, 将以内存格式创建. 还提供了对 Write-Ahead-Log 的可选支持, 默认情况下启用并通过设置 <code class=syntax>in_memory_parts_enable_wal</code> 来控制. <a href=https://github.com/ClickHouse/ClickHouse/pull/10697 rel="external nofollow noreferrer" target=_blank>#10697</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_9>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_9 title="Permanent link"> </a></h4> <ul> <li>为 clickhouse-client 实现基于 AST 的查询模糊测试模式. 请参阅 <a href="https://github.com/ClickHouse/ClickHouse/issues?q=label%3Afuzz+is%3Aissue" rel="external nofollow noreferrer" target=_blank>this label</a> 了解我们最近通过模糊测试发现的问题列表. 其中大部分是由这个工具发现的, 还有一些是由 SQLancer 和 <code class=syntax>00746_sql_fuzzy.pl</code> 发现的. <a href=https://github.com/ClickHouse/ClickHouse/pull/12111 rel="external nofollow noreferrer" target=_blank>#12111</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>添加基于 Testflows 框架的新型测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/12090 rel="external nofollow noreferrer" target=_blank>#12090</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>添加了 S3 HTTPS 集成测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/12412 rel="external nofollow noreferrer" target=_blank>#12412</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>从单独的线程记录清除陷阱消息. 这将防止线程消毒剂下可能出现的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/12313 rel="external nofollow noreferrer" target=_blank>#12313</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在功能和压力测试将能够使用旧版本的 <code class=syntax>clickhouse-test</code> 脚本运行. <a href=https://github.com/ClickHouse/ClickHouse/pull/12287 rel="external nofollow noreferrer" target=_blank>#12287</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在 <code class=syntax>orc</code> 构建期间删除奇怪的文件创建. <a href=https://github.com/ClickHouse/ClickHouse/pull/12258 rel="external nofollow noreferrer" target=_blank>#12258</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>将常见的 docker compose 文件放置到集成 docker 容器中. <a href=https://github.com/ClickHouse/ClickHouse/pull/12168 rel="external nofollow noreferrer" target=_blank>#12168</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>修复来自 CodeQL 的警告. <code class=syntax>CodeQL</code> 是另一个静态分析器, 我们将与我们已经使用的 <code class=syntax>clang-tidy</code> 和 <code class=syntax>PVS-Studio</code> 一起使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/12138 rel="external nofollow noreferrer" target=_blank>#12138</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>UNBUNDLED 构建的小 CMake 修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/12131 rel="external nofollow noreferrer" target=_blank>#12131</a> (<a href=https://github.com/matwey rel="external nofollow noreferrer" target=_blank>Matwey V. Kornilov</a>).</li> <li>添加了一个不使用任何 Linux 发行版的最小 Docker 镜像的展示. <a href=https://github.com/ClickHouse/ClickHouse/pull/12126 rel="external nofollow noreferrer" target=_blank>#12126</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 <code class=syntax>clickhouse-server</code> docker 镜像中执行系统包的升级. <a href=https://github.com/ClickHouse/ClickHouse/pull/12124 rel="external nofollow noreferrer" target=_blank>#12124</a> (<a href=https://github.com/blinkov rel="external nofollow noreferrer" target=_blank>Ivan Blinkov</a>).</li> <li>将 <code class=syntax>UNBUNDLED</code> 标志添加到 <code class=syntax>system.build_options</code> 表. 将 <code class=syntax>clickhouse-test</code> 的跳过列表移动到 clickhouse repo. <a href=https://github.com/ClickHouse/ClickHouse/pull/12107 rel="external nofollow noreferrer" target=_blank>#12107</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>通过 <a href=https://docs.anchore.com rel="external nofollow noreferrer" target=_blank>Anchore Container Analysis</a> 安全分析工具定期检查, 该工具会在 <code class=syntax>clickhouse-server</code> Docker 镜像中查找 <a href=https://cve.mitre.org/ rel="external nofollow noreferrer" target=_blank>CVE</a>. 还确认<code class=syntax>Dockerfile</code> 是可构建的. 每天在 <code class=syntax>master</code> 和 <code class=syntax>Dockerfile</code> 的拉取请求上运行. <a href=https://github.com/ClickHouse/ClickHouse/pull/12102 rel="external nofollow noreferrer" target=_blank>#12102</a> (<a href=https://github.com/blinkov rel="external nofollow noreferrer" target=_blank>Ivan Blinkov</a>).</li> <li>每日检查 <a href=https://securitylab.github.com/tools/codeql rel="external nofollow noreferrer" target=_blank>GitHub CodeQL</a> 安全分析工具, 寻找 <a href=https://cwe.mitre.org/ rel="external nofollow noreferrer" target=_blank>CWE</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12101 rel="external nofollow noreferrer" target=_blank>#12101</a> (<a href=https://github.com/blinkov rel="external nofollow noreferrer" target=_blank>Ivan Blinkov</a>).</li> <li>在 Dockerfile 中的第一个 <code class=syntax>apt-get update</code> 之前安装 <code class=syntax>ca-certificates</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12095 rel="external nofollow noreferrer" target=_blank>#12095</a> (<a href=https://github.com/blinkov rel="external nofollow noreferrer" target=_blank>Ivan Blinkov</a>).</li> </ul> <h2 id=clickhouse-ban-ben-20-5>ClickHouse 版本 20.5<a class=headerlink href=../amp/#clickhouse-ban-ben-20-5 title="Permanent link"> </a></h2> <h3 id=clickhouse-ban-ben-v20-5-4-40-stable-2020-08-10>ClickHouse 版本 v20.5.4.40-stable 2020-08-10<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-5-4-40-stable-2020-08-10 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_26>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_26 title="Permanent link"> </a></h4> <ul> <li>用函数修正了错误的索引分析. 在从 <code class=syntax>MergeTree</code> 表中读取时, 它可能会导致修剪错误的部分. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13060 rel="external nofollow noreferrer" target=_blank>#13060</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/12406 rel="external nofollow noreferrer" target=_blank>#12406</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13081 rel="external nofollow noreferrer" target=_blank>#13081</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了对从本地副本进行选择的线程数的不必要限制. <a href=https://github.com/ClickHouse/ClickHouse/pull/12840 rel="external nofollow noreferrer" target=_blank>#12840</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了大元组的性能, 这些元组在 <code class=syntax>IN</code> 部分被解释为函数. 当用户出于某种晦涩的原因编写 <code class=syntax>WHERE x IN tuple(1, 2, ...)</code> 而不是 <code class=syntax>WHERE x IN (1, 2, ...)</code> 的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/12700 rel="external nofollow noreferrer" target=_blank>#12700</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 input_format_parallel_parsing 的内存跟踪 (通过将线程附加到组). <a href=https://github.com/ClickHouse/ClickHouse/pull/12672 rel="external nofollow noreferrer" target=_blank>#12672</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 const 表达式修复了布隆过滤器索引. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10572 rel="external nofollow noreferrer" target=_blank>#10572</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12659 rel="external nofollow noreferrer" target=_blank>#12659</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了当 Broker 不可用时 (不仅如此) 在 <code class=syntax>StorageKafka</code> 中的 <code class=syntax>SIGSEGV</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12658 rel="external nofollow noreferrer" target=_blank>#12658</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加了对带有 <code class=syntax>Array(UUID)</code> 参数的函数 <code class=syntax>if</code> 的支持. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11066 rel="external nofollow noreferrer" target=_blank>#11066</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12648 rel="external nofollow noreferrer" target=_blank>#12648</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了函数 <code class=syntax>any</code> 缺少别名的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/12593 rel="external nofollow noreferrer" target=_blank>#12593</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了带有缓存布局的外部字典中的竞争条件, 这可能导致服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/12566 rel="external nofollow noreferrer" target=_blank>#12566</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在 DROP TABLE 上删除分布式表 (来自异步插入的块) 的数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/12556 rel="external nofollow noreferrer" target=_blank>#12556</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了当 <code class=syntax>enable_mixed_granularity_parts=1</code> 时, 在 <code class=syntax>ALTER DELETE</code> 查询后导致旧部件损坏的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12536 rel="external nofollow noreferrer" target=_blank>#12536</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12543 rel="external nofollow noreferrer" target=_blank>#12543</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>参数数目无效的函数 <code class=syntax>in</code> 的更好例外. <a href=https://github.com/ClickHouse/ClickHouse/pull/12529 rel="external nofollow noreferrer" target=_blank>#12529</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了实时视图表中可能导致数据重复的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/12519 rel="external nofollow noreferrer" target=_blank>#12519</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>修正了从合并部分读取时的性能问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/12492 rel="external nofollow noreferrer" target=_blank>#12492</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 <code class=syntax>AggregateFunction(avg, ...)</code> 值的二进制格式的向后兼容性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12342 rel="external nofollow noreferrer" target=_blank>#12342</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12486 rel="external nofollow noreferrer" target=_blank>#12486</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了启用 <code class=syntax>text_log</code> 时的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/12452 rel="external nofollow noreferrer" target=_blank>#12452</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了当指定非常大的限制或偏移量时的溢出问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10470 rel="external nofollow noreferrer" target=_blank>#10470</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11372 rel="external nofollow noreferrer" target=_blank>#11372</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12427 rel="external nofollow noreferrer" target=_blank>#12427</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 StorageMerge 时可能出现的段错误. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/12054 rel="external nofollow noreferrer" target=_blank>#12054</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12401 rel="external nofollow noreferrer" target=_blank>#12401</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>还原 <a href=https://github.com/ClickHouse/ClickHouse/issues/11079 rel="external nofollow noreferrer" target=_blank>#11079</a> 中引入的更改以解决 <a href=https://github.com/ClickHouse/ClickHouse/issues/12098 rel="external nofollow noreferrer" target=_blank>#12098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12397 rel="external nofollow noreferrer" target=_blank>#12397</a> (<a href=https://github.com/myrrc rel="external nofollow noreferrer" target=_blank>Mike</a>).</li> <li>在索引表的 WHERE 条件中使用负数或浮点常量时避免异常. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11905 rel="external nofollow noreferrer" target=_blank>#11905</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12384 rel="external nofollow noreferrer" target=_blank>#12384</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>即使存在依赖的 DEFAULT 表达式，也允许 CLEAR 列. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12333 rel="external nofollow noreferrer" target=_blank>#12333</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12378 rel="external nofollow noreferrer" target=_blank>#12378</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了带有 <code class=syntax>-State</code> 和 <code class=syntax>Nullable</code> 参数的聚合函数的 TOTALS/ROLLUP/CUBE. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12163 rel="external nofollow noreferrer" target=_blank>#12163</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12376 rel="external nofollow noreferrer" target=_blank>#12376</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 SIGSEGV 如果在 <code class=syntax>Kafka</code> 引擎中批处理中间有错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/12302 rel="external nofollow noreferrer" target=_blank>#12302</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了当 <code class=syntax>SummingMergeTree</code> 引擎从分区键中汇总列时的行为. 在列的显式定义与分区键列相交的情况下添加了一个例外. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7867 rel="external nofollow noreferrer" target=_blank>#7867</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12173 rel="external nofollow noreferrer" target=_blank>#12173</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复了在存在别名的情况下发送到外部 DBMS (例如 MySQL、ODBC) 的查询转换. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12032 rel="external nofollow noreferrer" target=_blank>#12032</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12151 rel="external nofollow noreferrer" target=_blank>#12151</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了导致 ZooKeepeer 中 ReplicatedVersionedCollapsingMergeTree 表的表元数据不正确的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12093 rel="external nofollow noreferrer" target=_blank>#12093</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12121 rel="external nofollow noreferrer" target=_blank>#12121</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了从 <code class=syntax>VIEW</code> 中选择的不必要的线程数限制. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11937 rel="external nofollow noreferrer" target=_blank>#11937</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12085 rel="external nofollow noreferrer" target=_blank>#12085</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用 <code class=syntax>join_algorithm=partial_merge</code> 修复了具有 LowCardinality 类型的 JOIN 崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/12035 rel="external nofollow noreferrer" target=_blank>#12035</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了条件为 NULL 的 <code class=syntax>if()</code> 的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/11807 rel="external nofollow noreferrer" target=_blank>#11807</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> </ul> <h4 id=xing-neng-gai-jin_8>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_8 title="Permanent link"> </a></h4> <ul> <li>索引不用于带文字的 IN 运算符, 在 v19.3 前后引入了性能回归. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10574 rel="external nofollow noreferrer" target=_blank>#10574</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12062 rel="external nofollow noreferrer" target=_blank>#12062</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_10>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_10 title="Permanent link"> </a></h4> <ul> <li>在 Dockerfile 中的第一个 <code class=syntax>apt-get update</code> 之前安装 <code class=syntax>ca-certificates</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12095 rel="external nofollow noreferrer" target=_blank>#12095</a> (<a href=https://github.com/blinkov rel="external nofollow noreferrer" target=_blank>Ivan Blinkov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-5-2-7-stable-2020-07-02>ClickHouse 版本 v20.5.2.7-stable 2020-07-02<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-5-2-7-stable-2020-07-02 title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng_7>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng_7 title="Permanent link"> </a></h4> <ul> <li>从 COUNT(DISTINCT) 和 <code class=syntax>uniq</code> 聚合函数系列返回不可为空的结果. 如果所有传递的值都是 NULL, 则返回零. 这提高了 SQL 兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/11661 rel="external nofollow noreferrer" target=_blank>#11661</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了对在错误位置指定用户级设置的情况的检查. 用户级设置应该在 <code class=syntax>&lt;profile&gt;</code> 部分内的 <code class=syntax>users.xml</code> 中为特定用户配置文件指定 (或在 <code class=syntax>&lt;default&gt;</code> 中指定默认设置). 服务器不会以日志中的异常消息启动. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9051 rel="external nofollow noreferrer" target=_blank>#9051</a>. 如果您想跳过检查, 您可以将设置移动到适当的位置或将 <code class=syntax>&lt;skip_check_for_incorrect_settings&gt;1&lt;/skip_check_for_incorrect_settings&gt;</code> 添加到 config.xml. <a href=https://github.com/ClickHouse/ClickHouse/pull/11449 rel="external nofollow noreferrer" target=_blank>#11449</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>默认情况下启用设置 <code class=syntax>input_format_with_names_use_header</code>. 它会影响对输入格式 <code class=syntax>-WithNames</code> 和 <code class=syntax>-WithNamesAndTypes</code> 的解析. <a href=https://github.com/ClickHouse/ClickHouse/pull/10937 rel="external nofollow noreferrer" target=_blank>#10937</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>删除 <code class=syntax>experimental_use_processors</code> 设置. 它默认启用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10924 rel="external nofollow noreferrer" target=_blank>#10924</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>将 <code class=syntax>zstd</code> 更新到 1.4.4. 它在性能和压缩比方面有一些小的改进. 如果您使用不同版本的 ClickHouse 运行副本, 您可能会看到合理的错误消息 <code class=syntax>Data after merge is not byte-identical to data on another replicas.</code> 并附有说明. 这些消息没问题, 您不必担心. 此更改向后兼容, 但我们将其列在更改日志中, 以防您对这些消息感到疑惑. <a href=https://github.com/ClickHouse/ClickHouse/pull/10663 rel="external nofollow noreferrer" target=_blank>#10663</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了对无意义编解码器的检查和设置 <code class=syntax>allow_suspicious_codecs</code> 来控制此检查. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/4966 rel="external nofollow noreferrer" target=_blank>#4966</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10645 rel="external nofollow noreferrer" target=_blank>#10645</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>一些 Kafka 设置更改了它们的默认值. 见 <a href=https://github.com/ClickHouse/ClickHouse/pull/11388 rel="external nofollow noreferrer" target=_blank>#11388</a>.</li> <li>从20.5以上的版本升级时, 如果进行滚动更新, 集群同时包含20.5以上和20.5以下的版本, 如果旧版本的ClickHouse节点重新启动, 旧版本在新版本存在的情况下启动, 可能会导致 <code class=syntax>Part ... intersects previous part</code> 错误. 为防止出现此错误, 首先在所有集群节点上安装更新的 clickhouse-server 软件包, 然后重新启动 (因此, 当 clickhouse-server 重新启动时, 它将以新版本启动).</li> </ul> <h4 id=xin-te-zheng_7>新特征<a class=headerlink href=../amp/#xin-te-zheng_7 title="Permanent link"> </a></h4> <ul> <li><code class=syntax>TTL DELETE WHERE</code> 和 <code class=syntax>TTL GROUP BY</code> 用于表中的自动数据粗化和汇总. <a href=https://github.com/ClickHouse/ClickHouse/pull/10537 rel="external nofollow noreferrer" target=_blank>#10537</a> (<a href=https://github.com/expl0si0nn rel="external nofollow noreferrer" target=_blank>expl0si0nn</a>).</li> <li>PostgreSQL 有线协议的实现. <a href=https://github.com/ClickHouse/ClickHouse/pull/10242 rel="external nofollow noreferrer" target=_blank>#10242</a> (<a href=https://github.com/MovElb rel="external nofollow noreferrer" target=_blank>Movses</a>).</li> <li>为 users, roles, grants, settings profiles, quotas, row policies 添加了系统表; 添加了命令 SHOW USER, SHOW [CURRENT|ENABLED] ROLES, SHOW SETTINGS PROFILES. <a href=https://github.com/ClickHouse/ClickHouse/pull/10387 rel="external nofollow noreferrer" target=_blank>#10387</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>支持写入 ODBC 表函数 <a href=https://github.com/ClickHouse/ClickHouse/pull/10554 rel="external nofollow noreferrer" target=_blank>#10554</a> (<a href=https://github.com/ageraab rel="external nofollow noreferrer" target=_blank>ageraab</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10901 rel="external nofollow noreferrer" target=_blank>#10901</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>添加基于 Linux <code class=syntax>perf_events</code> 的查询性能指标 (这些指标是使用硬件 CPU 计数器和 OS 计数器计算的). 它是可选的, 需要在 clickhouse 二进制文件上设置 <code class=syntax>CAP_SYS_ADMIN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9545 rel="external nofollow noreferrer" target=_blank>#9545</a> <a href=https://github.com/And42 rel="external nofollow noreferrer" target=_blank>Andrey Skobtsov</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11226 rel="external nofollow noreferrer" target=_blank>#11226</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>现在支持 <code class=syntax>CREATE</code> 查询中数据类型的 <code class=syntax>NULL</code> 和 <code class=syntax>NOT NULL</code> 修饰符. <a href=https://github.com/ClickHouse/ClickHouse/pull/11057 rel="external nofollow noreferrer" target=_blank>#11057</a> (<a href=https://github.com/Potya rel="external nofollow noreferrer" target=_blank>Павел Потемкин</a>).</li> <li>添加 <code class=syntax>ArrowStream</code> 输入输出格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/11088 rel="external nofollow noreferrer" target=_blank>#11088</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>支持 Cassandra 作为外部字典源. <a href=https://github.com/ClickHouse/ClickHouse/pull/4978 rel="external nofollow noreferrer" target=_blank>#4978</a> (<a href=https://github.com/favstovol rel="external nofollow noreferrer" target=_blank>favstovol</a>).</li> <li>添加了一个新的布局 <code class=syntax>direct</code>, 它直接从每个查询的源加载所有数据, 而不存储或缓存数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/10622 rel="external nofollow noreferrer" target=_blank>#10622</a> (<a href=https://github.com/kekekekule rel="external nofollow noreferrer" target=_blank>Artem Streltsov</a>).</li> <li>向字典添加了新的 <code class=syntax>complex_key_direct</code> 布局, 在查询执行期间不会在本地存储任何内容. <a href=https://github.com/ClickHouse/ClickHouse/pull/10850 rel="external nofollow noreferrer" target=_blank>#10850</a> (<a href=https://github.com/kekekekule rel="external nofollow noreferrer" target=_blank>Artem Streltsov</a>).</li> <li>添加了对 MySQL 样式全局变量语法 (存根) 的支持. 这是 MySQL 协议兼容性所必需的. <a href=https://github.com/ClickHouse/ClickHouse/pull/11832 rel="external nofollow noreferrer" target=_blank>#11832</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>使用 <code class=syntax>repl</code> 为 <code class=syntax>clickhouse-client</code> 添加了语法高亮. <a href=https://github.com/ClickHouse/ClickHouse/pull/11422 rel="external nofollow noreferrer" target=_blank>#11422</a> (<a href=https://github.com/kuskarov rel="external nofollow noreferrer" target=_blank>Tagir Kuskarov</a>).</li> <li>添加了 <code class=syntax>mind Map</code> 和 <code class=syntax>maxMap</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/11603 rel="external nofollow noreferrer" target=_blank>#11603</a> (<a href=https://github.com/ildus rel="external nofollow noreferrer" target=_blank>Ildus Kurbangaliev</a>).</li> <li>添加记录来自 <code class=syntax>system.asynchronous_metrics</code> 的历史指标的 <code class=syntax>system.asynchronous_metric_log</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/11588 rel="external nofollow noreferrer" target=_blank>#11588</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>添加函数 <code class=syntax>extractAllGroupsHorizontal(haystack, re)</code> 和 <code class=syntax>extractAllGroupsVertical(haystack, re)</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11554 rel="external nofollow noreferrer" target=_blank>#11554</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>添加 SHOW CLUSTER(S) 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/11467 rel="external nofollow noreferrer" target=_blank>#11467</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>添加<code class=syntax>netloc</code>函数用于提取网络位置, 类似于python中的<code class=syntax>urlparse(url)</code>、<code class=syntax>netloc</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11356 rel="external nofollow noreferrer" target=_blank>#11356</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>).</li> <li>为 engine=Kafka 添加 2 个虚拟列以访问消息头. <a href=https://github.com/ClickHouse/ClickHouse/pull/11283 rel="external nofollow noreferrer" target=_blank>#11283</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>为 Kafka 引擎添加 <code class=syntax>_timestamp_ms</code> 虚拟列 (类型为 <code class=syntax>Nullable(DateTime64(3))</code>) . <a href=https://github.com/ClickHouse/ClickHouse/pull/11260 rel="external nofollow noreferrer" target=_blank>#11260</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>添加函数 <code class=syntax>randomFixedString</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10866 rel="external nofollow noreferrer" target=_blank>#10866</a> (<a href=https://github.com/xolm rel="external nofollow noreferrer" target=_blank>Andrei Nekrashevich</a>).</li> <li>添加函数 <code class=syntax>fuzzBits</code>, 以给定的概率随机翻转字符串中的位. <a href=https://github.com/ClickHouse/ClickHouse/pull/11237 rel="external nofollow noreferrer" target=_blank>#11237</a> (<a href=https://github.com/xolm rel="external nofollow noreferrer" target=_blank>Andrei Nekrashevich</a>).</li> <li>允许在比较运算符、IN 和 VALUES 部分中将数字与常量字符串进行比较. <a href=https://github.com/ClickHouse/ClickHouse/pull/11647 rel="external nofollow noreferrer" target=_blank>#11647</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加 <code class=syntax>round_robin</code> 负载平衡模式. <a href=https://github.com/ClickHouse/ClickHouse/pull/11645 rel="external nofollow noreferrer" target=_blank>#11645</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加 <code class=syntax>cast_keep_nullable</code> 设置. 如果设置 <code class=syntax>CAST(something_nullable AS Type)</code> 返回 <code class=syntax>Nullable(Type)</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11733 rel="external nofollow noreferrer" target=_blank>#11733</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>将列 <code class=syntax>position</code> 添加到 <code class=syntax>system.columns</code> 表, 将 <code class=syntax>column_position</code> 添加到 <code class=syntax>system.parts_columns</code> 表. 它包含从 1 开始的表中列的顺序位置.这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/7744 rel="external nofollow noreferrer" target=_blank>#7744</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11655 rel="external nofollow noreferrer" target=_blank>#11655</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>ON CLUSTER 支持系统 {FLUSH DISTRIBUTED,STOP/START DISTRIBUTED SEND}. <a href=https://github.com/ClickHouse/ClickHouse/pull/11415 rel="external nofollow noreferrer" target=_blank>#11415</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加 system.distribution_queue 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/11394 rel="external nofollow noreferrer" target=_blank>#11394</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>支持Kafka中的所有格式设置, 在表级别公开一些设置, 调整默认值以获得更好的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/11388 rel="external nofollow noreferrer" target=_blank>#11388</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>添加 <code class=syntax>port</code> 函数 (从 URL 中提取端口). <a href=https://github.com/ClickHouse/ClickHouse/pull/11120 rel="external nofollow noreferrer" target=_blank>#11120</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>现在 <code class=syntax>dictGet*</code> 函数接受表名. <a href=https://github.com/ClickHouse/ClickHouse/pull/11050 rel="external nofollow noreferrer" target=_blank>#11050</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>当使用 <code class=syntax>-n</code> 参数时, <code class=syntax>clickhouse-format</code> 工具现在能够格式化多个查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/10852 rel="external nofollow noreferrer" target=_blank>#10852</a> (<a href=https://github.com/dgrr rel="external nofollow noreferrer" target=_blank>Darío</a>).</li> <li>可以为 DiskS3 配置代理解析器. <a href=https://github.com/ClickHouse/ClickHouse/pull/10744 rel="external nofollow noreferrer" target=_blank>#10744</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>使 <code class=syntax>pointInPolygon</code> 与非常量多边形一起工作. PointInPolygon 现在可以将 Array(Array(Tuple(..., ...))) 作为第二个参数, 多边形和孔的数组. <a href=https://github.com/ClickHouse/ClickHouse/pull/10623 rel="external nofollow noreferrer" target=_blank>#10623</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/11421 rel="external nofollow noreferrer" target=_blank>#11421</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li> <li>将 <code class=syntax>move_ttl_info</code> 添加到 <code class=syntax>system.parts</code> 以提供对移动 TTL 功能的内省. <a href=https://github.com/ClickHouse/ClickHouse/pull/10591 rel="external nofollow noreferrer" target=_blank>#10591</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>可以通过代理使用 S3. <a href=https://github.com/ClickHouse/ClickHouse/pull/10576 rel="external nofollow noreferrer" target=_blank>#10576</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>为数据类型添加 <code class=syntax>NCHAR</code> 和 <code class=syntax>NVARCHAR</code> 同义词. <a href=https://github.com/ClickHouse/ClickHouse/pull/11025 rel="external nofollow noreferrer" target=_blank>#11025</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>已解决 <a href=https://github.com/ClickHouse/ClickHouse/issues/7224 rel="external nofollow noreferrer" target=_blank>#7224</a>: 将 <code class=syntax>FailedQuery</code>、<code class=syntax>FailedSelectQuery</code> 和 <code class=syntax>FailedInsertQuery</code> 指标添加到 <code class=syntax>system.events</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/11151 rel="external nofollow noreferrer" target=_blank>#11151</a> (<a href=https://github.com/naorlov rel="external nofollow noreferrer" target=_blank>Nikita Orlov</a>).</li> <li>向 <code class=syntax>system.asynchronous_metrics</code> 添加更多 <code class=syntax>jemalloc</code> 统计信息, 并确保我们看到它们的最新值. <a href=https://github.com/ClickHouse/ClickHouse/pull/11748 rel="external nofollow noreferrer" target=_blank>#11748</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>允许指定默认 S3 凭据和自定义身份验证标头. <a href=https://github.com/ClickHouse/ClickHouse/pull/11134 rel="external nofollow noreferrer" target=_blank>#11134</a> (<a href=https://github.com/GrigoryPervakov rel="external nofollow noreferrer" target=_blank>Grigory Pervakov</a>).</li> <li>添加了以各种精度将 DateTime64 导入/导出为 Int64 的新函数: <code class=syntax>to-/fromUnixTimestamp64Milli/-Micro/-Nano</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10923 rel="external nofollow noreferrer" target=_blank>#10923</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>允许为 MongoDB 字典指定 <code class=syntax>mongodb://</code> URI. <a href=https://github.com/ClickHouse/ClickHouse/pull/10915 rel="external nofollow noreferrer" target=_blank>#10915</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>现在可以在没有附属 LIMIT 子句的情况下使用 OFFSET 关键字. <a href=https://github.com/ClickHouse/ClickHouse/pull/10802 rel="external nofollow noreferrer" target=_blank>#10802</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>).</li> <li>添加了 <code class=syntax>system.licenses</code> 表. 此表包含位于 <code class=syntax>contrib</code> 目录中的第三方库的许可证. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/2890 rel="external nofollow noreferrer" target=_blank>#2890</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10795 rel="external nofollow noreferrer" target=_blank>#10795</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>新函数 toStartOfSecond(DateTime64) -&gt; DateTime64 使 DateTime64 值的亚秒部分无效. <a href=https://github.com/ClickHouse/ClickHouse/pull/10722 rel="external nofollow noreferrer" target=_blank>#10722</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>添加新的输入格式 <code class=syntax>JSONAsString</code> , 它接受由换行符、空格和/或逗号分隔的一系列 JSON 对象. <a href=https://github.com/ClickHouse/ClickHouse/pull/10607 rel="external nofollow noreferrer" target=_blank>#10607</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>).</li> <li>允许以比 4 MiB 更细的粒度步长分析内存. 添加了采样内存分析器以捕获随机分配/解除分配. <a href=https://github.com/ClickHouse/ClickHouse/pull/10598 rel="external nofollow noreferrer" target=_blank>#10598</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li><code class=syntax>SimpleAggregateFunction</code> 现在也支持 <code class=syntax>sumMap</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10000 rel="external nofollow noreferrer" target=_blank>#10000</a> (<a href=https://github.com/ildus rel="external nofollow noreferrer" target=_blank>Ildus Kurbangaliev</a>).</li> <li>分布式表引擎支持 <code class=syntax>ALTER RENAME COLUMN</code> . 继续 <a href=https://github.com/ClickHouse/ClickHouse/issues/10727 rel="external nofollow noreferrer" target=_blank>#10727</a>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10747 rel="external nofollow noreferrer" target=_blank>#10747</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10887 rel="external nofollow noreferrer" target=_blank>#10887</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h4 id=bug-xiu-fu_27>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_27 title="Permanent link"> </a></h4> <ul> <li>修复十进制解析中的 UBSan 报告. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7540 rel="external nofollow noreferrer" target=_blank>#7540</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10512 rel="external nofollow noreferrer" target=_blank>#10512</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>解析 DateTime64 时修复潜在的浮点异常. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11374 rel="external nofollow noreferrer" target=_blank>#11374</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11875 rel="external nofollow noreferrer" target=_blank>#11875</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复在 prewhere 条件下使用 <code class=syntax>Nullable</code> 列导致的罕见崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/11895 rel="external nofollow noreferrer" target=_blank>#11895</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/11608 rel="external nofollow noreferrer" target=_blank>#11608</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/11869 rel="external nofollow noreferrer" target=_blank>#11869</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>不允许在高阶函数中使用 arrayJoin. 它导致协议同步中断. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/3933 rel="external nofollow noreferrer" target=_blank>#3933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11846 rel="external nofollow noreferrer" target=_blank>#11846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 FixedString 与常量 String 比较的错误结果. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11393 rel="external nofollow noreferrer" target=_blank>#11393</a>. 这个bug出现在20.4版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/11828 rel="external nofollow noreferrer" target=_blank>#11828</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复条件为 NULL 的 <code class=syntax>if</code> 的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/11807 rel="external nofollow noreferrer" target=_blank>#11807</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复使用过多线程进行查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/11788 rel="external nofollow noreferrer" target=_blank>#11788</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了在 <code class=syntax>SELECT ... FROM merge_tree_table ...</code> 中使用 <code class=syntax>WITH &lt;scalar subquery&gt; ...</code> 时的 <code class=syntax>Scalar does not exist</code> 异常 <a href=https://github.com/ClickHouse/ClickHouse/issues/11621 rel="external nofollow noreferrer" target=_blank>#11621</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11767 rel="external nofollow noreferrer" target=_blank>#11767</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复像 <code class=syntax>SELECT *, xyz.*</code> 这样的查询的意外行为, 这些查询在预期错误时成功. <a href=https://github.com/ClickHouse/ClickHouse/pull/11753 rel="external nofollow noreferrer" target=_blank>#11753</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>现在, 在修改元数据期间, 复制的取数据将被取消. <a href=https://github.com/ClickHouse/ClickHouse/pull/11744 rel="external nofollow noreferrer" target=_blank>#11744</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在检查相等性之前解析存储在 zookeeper 中的元数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/11739 rel="external nofollow noreferrer" target=_blank>#11739</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了由 Values 输入格式中复杂文字的错误类型推导导致的 LOGICAL_ERROR. <a href=https://github.com/ClickHouse/ClickHouse/pull/11732 rel="external nofollow noreferrer" target=_blank>#11732</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复 <code class=syntax>ORDER BY ... WITH FILL</code> 在 const 列上. <a href=https://github.com/ClickHouse/ClickHouse/pull/11697 rel="external nofollow noreferrer" target=_blank>#11697</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>复 SYSTEM SYNC REPLICA 中非常罕见的竞争条件. 如果创建了复制表, 同时另一个客户端从单独的连接中对该表发出 <code class=syntax>SYSTEM SYNC REPLICA</code> 命令 (这不太可能, 因为另一个客户端应该知道该表已创建), 则有可能获得 nullptr 取消引用. <a href=https://github.com/ClickHouse/ClickHouse/pull/11691 rel="external nofollow noreferrer" target=_blank>#11691</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>与 XDBC 桥通信时传递适当的超时. 最近在检查桥接活性和接收元信息时没有遵守超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/11690 rel="external nofollow noreferrer" target=_blank>#11690</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>将 <code class=syntax>LIMIT n WITH TIES</code> 与包含别名的 <code class=syntax>ORDER BY</code> 语句一起使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/11689 rel="external nofollow noreferrer" target=_blank>#11689</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复带有并行 <code class=syntax>FINAL</code> 的选择的可能的 <code class=syntax>Pipeline stuck</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11636 rel="external nofollow noreferrer" target=_blank>#11636</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11682 rel="external nofollow noreferrer" target=_blank>#11682</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复导致 <code class=syntax>system.mutations</code> 状态不正确的错误. 它可能表明整个突变已经完成, 但服务器在复制队列中仍有 <code class=syntax>MUTATE_PART</code> 任务并尝试执行它们. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11611 rel="external nofollow noreferrer" target=_blank>#11611</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11681 rel="external nofollow noreferrer" target=_blank>#11681</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复 CREATE USER 查询中的语法 hilite. <a href=https://github.com/ClickHouse/ClickHouse/pull/11664 rel="external nofollow noreferrer" target=_blank>#11664</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加对带有不区分大小写标志的正则表达式的支持. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11101 rel="external nofollow noreferrer" target=_blank>#11101</a> 并修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11506 rel="external nofollow noreferrer" target=_blank>#11506</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11649 rel="external nofollow noreferrer" target=_blank>#11649</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果设置了行级安全性, 则删除琐碎的计数查询优化. 在以前的版本中, 用户获取表中记录的总数而不是过滤。 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11352 rel="external nofollow noreferrer" target=_blank>#11352</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11644 rel="external nofollow noreferrer" target=_blank>#11644</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复字符串的布隆过滤器 (数据跳过索引). <a href=https://github.com/ClickHouse/ClickHouse/pull/11638 rel="external nofollow noreferrer" target=_blank>#11638</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果没有 <code class=syntax>-q</code> 选项, 数据库不会在启动时创建. <a href=https://github.com/ClickHouse/ClickHouse/pull/11604 rel="external nofollow noreferrer" target=_blank>#11604</a> (<a href=https://github.com/giordyb rel="external nofollow noreferrer" target=_blank>giordyb</a>).</li> <li>修复错误 <code class=syntax>Block structure mismatch</code>, 用于从“缓冲区”表中采样读取的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/11602 rel="external nofollow noreferrer" target=_blank>#11602</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 clickhouse-client 错误的退出代码, 当 <code class=syntax>exception.code() % 256 == 0</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11601 rel="external nofollow noreferrer" target=_blank>#11601</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复 ReplicatedMergeTree 的不同副本的 CREATE/DROP 中的竞争条件. 如果表未从 ZooKeeper 中完全删除或未成功创建, 则继续工作. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11432 rel="external nofollow noreferrer" target=_blank>#11432</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11592 rel="external nofollow noreferrer" target=_blank>#11592</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复服务器启动时有关 <code class=syntax>Mark cache size was lowered</code> 的日志消息中的小错误. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11399 rel="external nofollow noreferrer" target=_blank>#11399</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11589 rel="external nofollow noreferrer" target=_blank>#11589</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复错误 <code class=syntax>Size of offsets does not match size of column</code> , 用于查询中的 <code class=syntax>PREWHERE column in (subquery)</code> 和 <code class=syntax>ARRAY JOIN</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11580 rel="external nofollow noreferrer" target=_blank>#11580</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 <code class=syntax>SHOW CREATE TABLE</code> 中罕见的段错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11490 rel="external nofollow noreferrer" target=_blank>#11490</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11579 rel="external nofollow noreferrer" target=_blank>#11579</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>HTTP 会话中的所有查询都具有相同的 query_id. 它是固定的. <a href=https://github.com/ClickHouse/ClickHouse/pull/11578 rel="external nofollow noreferrer" target=_blank>#11578</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>现在 clickhouse-server docker 容器将更喜欢 IPv6 检查服务器活动性. <a href=https://github.com/ClickHouse/ClickHouse/pull/11550 rel="external nofollow noreferrer" target=_blank>#11550</a> (<a href=https://github.com/istarkov rel="external nofollow noreferrer" target=_blank>Ivan Starkov</a>).</li> <li>修复了在启用 <code class=syntax>min_bytes_to_use_direct_io</code> 且 PREWHERE 处于活动状态并使用 SAMPLE 或大量线程时可能发生的 <code class=syntax>Data compressed with different methods</code> 错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11539 rel="external nofollow noreferrer" target=_blank>#11539</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11540 rel="external nofollow noreferrer" target=_blank>#11540</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>&lt;node&gt;</code> 的 shard_num/replica_num (破坏 use_compact_format_in_distributed_parts_names). <a href=https://github.com/ClickHouse/ClickHouse/pull/11528 rel="external nofollow noreferrer" target=_blank>#11528</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>将异步 INSERT 修复到分布式中, 以用于 prefer_localhost_replica=0 和 w/o internal_replication. <a href=https://github.com/ClickHouse/ClickHouse/pull/11527 rel="external nofollow noreferrer" target=_blank>#11527</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 <code class=syntax>-State</code> 函数在聚合过程中抛出异常时修复内存泄漏. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8995 rel="external nofollow noreferrer" target=_blank>#8995</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11496 rel="external nofollow noreferrer" target=_blank>#11496</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>INSERT SELECT FINAL</code> 的 <code class=syntax>Pipeline stuck</code> 异常, 其中 <code class=syntax>SELECT</code> (<code class=syntax>max_threads</code>&gt; 1)有多个流, 而<code class=syntax>INSERT</code> 只有一个 (<code class=syntax>max_insert_threads</code>==0). <a href=https://github.com/ClickHouse/ClickHouse/pull/11455 rel="external nofollow noreferrer" target=_blank>#11455</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复查询中的错误结果, 例如 <code class=syntax>select count() from t, u</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11454 rel="external nofollow noreferrer" target=_blank>#11454</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复编解码器的返回压缩大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/11448 rel="external nofollow noreferrer" target=_blank>#11448</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当列具有带有非文字参数的压缩编解码器时修复服务器崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11365 rel="external nofollow noreferrer" target=_blank>#11365</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11431 rel="external nofollow noreferrer" target=_blank>#11431</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了当表没有成功创建时, 在合并树关闭时可能出现的未初始化内存读取问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/11420 rel="external nofollow noreferrer" target=_blank>#11420</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 JOIN 在 <code class=syntax>LowCarinality(T)</code> 和 <code class=syntax>Nullable(T)</code> 上的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/issues/11380 rel="external nofollow noreferrer" target=_blank>#11380</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11414 rel="external nofollow noreferrer" target=_blank>#11414</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复错误 <code class=syntax>USING</code> 键的错误代码. <a href=https://github.com/ClickHouse/ClickHouse/issues/11373 rel="external nofollow noreferrer" target=_blank>#11373</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11404 rel="external nofollow noreferrer" target=_blank>#11404</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了参数超出纬度/经度范围的 <code class=syntax>geohashesInBox</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11403 rel="external nofollow noreferrer" target=_blank>#11403</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li><code class=syntax>joinGet()</code> 函数更好的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/11389 rel="external nofollow noreferrer" target=_blank>#11389</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复具有外部排序和限制的查询可能出现的 <code class=syntax>Pipeline stuck</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11359 rel="external nofollow noreferrer" target=_blank>#11359</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11366 rel="external nofollow noreferrer" target=_blank>#11366</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>在 ReplicatedMergeTree 中发送零件期间删除冗余锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/11354 rel="external nofollow noreferrer" target=_blank>#11354</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了多行模式下 clickhouse-client 对 <code class=syntax>\G</code>（垂直输出）的支持. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/9933 rel="external nofollow noreferrer" target=_blank>#9933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11350 rel="external nofollow noreferrer" target=_blank>#11350</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复使用 <code class=syntax>Lazy</code> 数据库时潜在的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/11348 rel="external nofollow noreferrer" target=_blank>#11348</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复从 <code class=syntax>Join</code> 表引擎 (没有 JOIN) 直接选择的崩溃和错误的可空性. <a href=https://github.com/ClickHouse/ClickHouse/pull/11340 rel="external nofollow noreferrer" target=_blank>#11340</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复 <code class=syntax>quantilesExactWeightedArray</code> 中的崩溃问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/11337 rel="external nofollow noreferrer" target=_blank>#11337</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>现在合并在 <code class=syntax>ALTER</code> 查询中更改元数据之前停止. <a href=https://github.com/ClickHouse/ClickHouse/pull/11335 rel="external nofollow noreferrer" target=_blank>#11335</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>Make writing to <code class=syntax>MATERIALIZED VIEW</code> with setting <code class=syntax>parallel_view_processing = 1</code> parallel again. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11330 rel="external nofollow noreferrer" target=_blank>#11330</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当提取的 JSON 具有不平衡的 { 或 [ 字符串时，修复 <code class=syntax>visitParamExtractRaw</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11318 rel="external nofollow noreferrer" target=_blank>#11318</a> (<a href=https://github.com/devwout rel="external nofollow noreferrer" target=_blank>Ewout</a>).</li> <li>修复 ThreadPool 中非常罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/11314 rel="external nofollow noreferrer" target=_blank>#11314</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>clickhouse-copier</code> 中无关紧要的数据竞争. 通过集成测试发现. <a href=https://github.com/ClickHouse/ClickHouse/pull/11313 rel="external nofollow noreferrer" target=_blank>#11313</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复转换中潜在的未初始化内存. 示例: <code class=syntax>SELECT toIntervalSecond(now64())</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11311 rel="external nofollow noreferrer" target=_blank>#11311</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了如果表的主键中有 Array 列并且查询正在使用 <code class=syntax>empty</code> 或 <code class=syntax>notEmpty</code> 函数按此列过滤时索引分析无法工作的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11286 rel="external nofollow noreferrer" target=_blank>#11286</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11303 rel="external nofollow noreferrer" target=_blank>#11303</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复当查询速度估计可能不正确时的错误, 并且如果查询受到 <code class=syntax>max_network_bandwidth</code>、<code class=syntax>max_execution_speed</code> 或 <code class=syntax>priority</code> 设置的限制, <code class=syntax>min_execution_speed</code> 的限制可能无法工作或无法正常工作。 将 <code class=syntax>timeout_before_checking_execution_speed</code> 的默认值更改为非零值, 否则设置 <code class=syntax>min_execution_speed</code> 和 <code class=syntax>max_execution_speed</code> 无效/ 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11297 rel="external nofollow noreferrer" target=_blank>#11297</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5732 rel="external nofollow noreferrer" target=_blank>#5732</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6228 rel="external nofollow noreferrer" target=_blank>#6228</a>. 可用性改进: 避免在 <code class=syntax>clickhouse-client</code> 中将异常消息与进度条串联. <a href=https://github.com/ClickHouse/ClickHouse/pull/11296 rel="external nofollow noreferrer" target=_blank>#11296</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了使用错误参数调用 <code class=syntax>SET DEFAULT ROLE</code> 时的崩溃. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10586 rel="external nofollow noreferrer" target=_blank>#10586</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11278 rel="external nofollow noreferrer" target=_blank>#11278</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复在以 <code class=syntax>Protobuf</code> 格式读取格式错误的数据时崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5957 rel="external nofollow noreferrer" target=_blank>#5957</a>, fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11203 rel="external nofollow noreferrer" target=_blank>#11203</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11258 rel="external nofollow noreferrer" target=_blank>#11258</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复了 <code class=syntax>cache</code> 字典可以返回默认值而不是正常值 (只有过期键时) 的错误. 这仅影响字符串字段. <a href=https://github.com/ClickHouse/ClickHouse/pull/11233 rel="external nofollow noreferrer" target=_blank>#11233</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复错误 <code class=syntax>Block structure mismatch in QueryPipeline</code> , 同时从内部查询中的常量读取 <code class=syntax>VIEW</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11181 rel="external nofollow noreferrer" target=_blank>#11181</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11205 rel="external nofollow noreferrer" target=_blank>#11205</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复可能的异常 <code class=syntax>Invalid status for associated output</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11200 rel="external nofollow noreferrer" target=_blank>#11200</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>现在将检查 <code class=syntax>primary.idx</code> 是否在 <code class=syntax>CREATE</code> 查询中定义. <a href=https://github.com/ClickHouse/ClickHouse/pull/11199 rel="external nofollow noreferrer" target=_blank>#11199</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>使用 <code class=syntax>Array(Array(LowCardinality))</code> 捕获参数修复高阶函数的可能错误 <code class=syntax>Cannot capture column</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11185 rel="external nofollow noreferrer" target=_blank>#11185</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了在超过 1000 个键和一些后端的情况下可能会失败的 <code class=syntax>S3</code> 通配符. <a href=https://github.com/ClickHouse/ClickHouse/pull/11179 rel="external nofollow noreferrer" target=_blank>#11179</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>如果数据跳过索引依赖于将在后台合并期间修改的列 (对于 SummingMergeTree、AggregatingMergeTree 以及 TTL GROUP BY), 则计算错误. 此问题已通过合并后移动索引计算得到修复, 因此索引是在合并数据上计算的. <a href=https://github.com/ClickHouse/ClickHouse/pull/11162 rel="external nofollow noreferrer" target=_blank>#11162</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了在表引擎 = Kafka 的 DROP 期间 (或在服务器重新启动期间) 有时发生的挂起. <a href=https://github.com/ClickHouse/ClickHouse/pull/11145 rel="external nofollow noreferrer" target=_blank>#11145</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复简单查询过多的线程预留 (优化减少线程数量, 在管道更改后部分中断). <a href=https://github.com/ClickHouse/ClickHouse/pull/11114 rel="external nofollow noreferrer" target=_blank>#11114</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果没有最终确定, 则从突变终止任务中删除日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/11109 rel="external nofollow noreferrer" target=_blank>#11109</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了更新后服务器启动过程中的死锁, 系统日志表的结构发生了变化. <a href=https://github.com/ClickHouse/ClickHouse/pull/11106 rel="external nofollow noreferrer" target=_blank>#11106</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 registerDiskS3 中的内存泄漏. <a href=https://github.com/ClickHouse/ClickHouse/pull/11074 rel="external nofollow noreferrer" target=_blank>#11074</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>当 JOIN 出现在 PREWHERE 或 <code class=syntax>optimize_move_to_prewhere</code> 使 PREWHERE from WHERE 出现时, 修复错误 <code class=syntax>No such name in Block::erase()</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11051 rel="external nofollow noreferrer" target=_blank>#11051</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复 Kafka 引擎表终止期间可能丢失的数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/11048 rel="external nofollow noreferrer" target=_blank>#11048</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复了 parseDateTime64BestEffort 参数解析错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/10925 rel="external nofollow noreferrer" target=_blank>#10925</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11038 rel="external nofollow noreferrer" target=_blank>#11038</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>现在可以在单个 <code class=syntax>ALTER</code> 查询中对同一列进行 <code class=syntax>ADD/DROP</code> 和 <code class=syntax>RENAME</code>. 同时 <code class=syntax>MODIFY</code> 和 <code class=syntax>RENAME</code> 的异常信息变得更加清晰. 部分修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10669 rel="external nofollow noreferrer" target=_blank>#10669</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11037 rel="external nofollow noreferrer" target=_blank>#11037</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 S3 URL 的解析. <a href=https://github.com/ClickHouse/ClickHouse/pull/11036 rel="external nofollow noreferrer" target=_blank>#11036</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>修复存在 <code class=syntax>LIMIT</code> 时两级 <code class=syntax>GROUP BY</code> 的内存跟踪. <a href=https://github.com/ClickHouse/ClickHouse/pull/11022 rel="external nofollow noreferrer" target=_blank>#11022</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果表未成功创建，则修复 MergeTree 中非常罕见的潜在释放后使用错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10986 rel="external nofollow noreferrer" target=_blank>#10986</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复原子数据库的元数据 (重命名的相对路径) 和数据 (符号链接的相对路径) 处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/10980 rel="external nofollow noreferrer" target=_blank>#10980</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 <code class=syntax>Atomic</code> 数据库引擎修复并发 <code class=syntax>ALTER</code> 和 <code class=syntax>DROP DATABASE</code> 查询时的服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/10968 rel="external nofollow noreferrer" target=_blank>#10968</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复方法 getRawData() 中不正确的原始数据大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/10964 rel="external nofollow noreferrer" target=_blank>#10964</a> (<a href=https://github.com/ObjatieGroba rel="external nofollow noreferrer" target=_blank>Igr</a>).</li> <li>修复了 20.1 及更早版本之间两级聚合的不兼容性. 当在发起节点和远程节点上使用不同版本的 ClickHouse 并且 GROUP BY 结果的大小很大并且由单个 String 字段执行聚合时, 就会发生这种不兼容. 结果导致单个键的多个未合并的行. <a href=https://github.com/ClickHouse/ClickHouse/pull/10952 rel="external nofollow noreferrer" target=_blank>#10952</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>避免通过 DistributedBlockOutputStream 发送部分写入的文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/10940 rel="external nofollow noreferrer" target=_blank>#10940</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>复 <code class=syntax>SELECT count(notNullIn(NULL, []))</code> 中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/10920 rel="external nofollow noreferrer" target=_blank>#10920</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了在表引擎 = Kafka 的 DROP 期间 (或在服务器重新启动期间) 有时发生的挂起. <a href=https://github.com/ClickHouse/ClickHouse/pull/10910 rel="external nofollow noreferrer" target=_blank>#10910</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>现在可以像 <code class=syntax>a TO b, c TO a</code> 那样执行多个 <code class=syntax>ALTER RENAME</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10895 rel="external nofollow noreferrer" target=_blank>#10895</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复当您从同一列的多个线程的聚合函数状态获得结果时可能发生的竞争. 唯一可能发生的方法 (我发现) 是当您使用 <code class=syntax>finalizeAggregation</code> 函数同时使用 <code class=syntax>Memory</code> 引擎从表中读取时, 该引擎为 <code class=syntax>quanite*</code> 函数存储 <code class=syntax>AggregateFunction</code> 状态. <a href=https://github.com/ClickHouse/ClickHouse/pull/10890 rel="external nofollow noreferrer" target=_blank>#10890</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复与分布式表中元组的向后兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/10889 rel="external nofollow noreferrer" target=_blank>#10889</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复 StringHashTable 中的 SIGSEGV (如果这样的键不存在). <a href=https://github.com/ClickHouse/ClickHouse/pull/10870 rel="external nofollow noreferrer" target=_blank>#10870</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了在使用 <code class=syntax>Atomic</code> 引擎从数据库中删除 <code class=syntax>LiveView</code> 表后, <code class=syntax>WATCH</code> 挂起的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10859 rel="external nofollow noreferrer" target=_blank>#10859</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了 <code class=syntax>ReplicatedMergeTree</code> 中的错误, 该错误可能导致 <code class=syntax>OPTIMIZE</code> 查询上的某些 <code class=syntax>ALTER</code> 在它变为非活动状态后挂起等待某些副本. <a href=https://github.com/ClickHouse/ClickHouse/pull/10849 rel="external nofollow noreferrer" target=_blank>#10849</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>现在，如果参与 <code class=syntax>CONSTRAINT</code> 表达式的列被重命名, 则约束会更新. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10844 rel="external nofollow noreferrer" target=_blank>#10844</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10847 rel="external nofollow noreferrer" target=_blank>#10847</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复缓存字典中未初始化内存的潜在读取. <a href=https://github.com/ClickHouse/ClickHouse/pull/10834 rel="external nofollow noreferrer" target=_blank>#10834</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 Block::sortColumns() 之后修复列顺序 (还添加了一个测试, 表明它会影响一些实际用例 - 缓冲区引擎). <a href=https://github.com/ClickHouse/ClickHouse/pull/10826 rel="external nofollow noreferrer" target=_blank>#10826</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复 ODBC 桥在不要求引用标识符时的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7984 rel="external nofollow noreferrer" target=_blank>#7984</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10821 rel="external nofollow noreferrer" target=_blank>#10821</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 DateLUT 中的 UBSan 和 MSan 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/10798 rel="external nofollow noreferrer" target=_blank>#10798</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在关键条件下使用 <code class=syntax>src_type</code> 进行正确的类型转换. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6287 rel="external nofollow noreferrer" target=_blank>#6287</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10791 rel="external nofollow noreferrer" target=_blank>#10791</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>).</li> <li>摆脱旧的 libunwind 补丁. <a href=https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012 target=_blank>https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012</a> 这允许在 <code class=syntax>clang</code> 中禁用 <code class=syntax>-fno-omit-frame-pointer</code> 至少 1% 的平均构建性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/10761 rel="external nofollow noreferrer" target=_blank>#10761</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复了在多个分片上使用浮点权重时的avgWeighted问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10758 rel="external nofollow noreferrer" target=_blank>#10758</a> (<a href=https://github.com/bgiard rel="external nofollow noreferrer" target=_blank>Baudouin Giard</a>).</li> <li>修复 <code class=syntax>parallel_view_processing</code> 行为. 现在, 如果发生异常, 所有对 <code class=syntax>MATERIALIZED VIEW</code> 的插入都应该无一例外地完成. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10757 rel="external nofollow noreferrer" target=_blank>#10757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>与 -State 结合时修复组合器 -OrNull 和 -OrDefault. <a href=https://github.com/ClickHouse/ClickHouse/pull/10741 rel="external nofollow noreferrer" target=_blank>#10741</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>使用嵌套类型修复 <code class=syntax>generateRandom</code> 中的崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10583 rel="external nofollow noreferrer" target=_blank>#10583</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10734 rel="external nofollow noreferrer" target=_blank>#10734</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复合并后可能发生的 <code class=syntax>SummingMergeTree</code> 中 <code class=syntax>LowCardinality(FixedString)</code> 键列的数据损坏. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10489 rel="external nofollow noreferrer" target=_blank>#10489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10721 rel="external nofollow noreferrer" target=_blank>#10721</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复使用 <code class=syntax>FINAL</code> 修饰符和 <code class=syntax>ORDER BY</code> 优化包装成函数的主键的使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10715 rel="external nofollow noreferrer" target=_blank>#10715</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复函数 <code class=syntax>h3EdgeAngle</code> 中可能的缓冲区溢出. <a href=https://github.com/ClickHouse/ClickHouse/pull/10711 rel="external nofollow noreferrer" target=_blank>#10711</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复消失的总数. 如果查询具有带有外部 where 条件的连接或子查询, 则总计可能已被过滤. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10674 rel="external nofollow noreferrer" target=_blank>#10674</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10698 rel="external nofollow noreferrer" target=_blank>#10698</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 HTTP 插入的原子性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9666 rel="external nofollow noreferrer" target=_blank>#9666</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10687 rel="external nofollow noreferrer" target=_blank>#10687</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>).</li> <li>在一个查询中使用相同的集合修复 <code class=syntax>IN</code> 运算符的多次使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10686 rel="external nofollow noreferrer" target=_blank>#10686</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了当 <code class=syntax>readonly=2</code> 和 <code class=syntax>cancel_http_readonly_queries_on_client_close=1</code> 时导致 http 请求卡在客户端关闭的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7939 rel="external nofollow noreferrer" target=_blank>#7939</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7019 rel="external nofollow noreferrer" target=_blank>#7019</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7736 rel="external nofollow noreferrer" target=_blank>#7736</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7091 rel="external nofollow noreferrer" target=_blank>#7091</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10684 rel="external nofollow noreferrer" target=_blank>#10684</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复 AggregateTransform 构造函数中参数的顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/10667 rel="external nofollow noreferrer" target=_blank>#10667</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>).</li> <li>修复启用了 <code class=syntax>distributed_aggregation_memory_efficient</code> 的远程查询缺乏并行执行的问题。 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10655 rel="external nofollow noreferrer" target=_blank>#10655</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10664 rel="external nofollow noreferrer" target=_blank>#10664</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用 <code class=syntax>LIMIT</code> 修复查询的可能不正确的行数. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/10566 rel="external nofollow noreferrer" target=_blank>#10566</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10709 rel="external nofollow noreferrer" target=_blank>#10709</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10660 rel="external nofollow noreferrer" target=_blank>#10660</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复当表有很多部分时锁定并发更改的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10659 rel="external nofollow noreferrer" target=_blank>#10659</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>如果服务器在表启动之前关闭，则修复 StorageBuffer 中的 nullptr 取消引用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10641 rel="external nofollow noreferrer" target=_blank>#10641</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复分布式查询的谓词优化 (<code class=syntax>enable_optimize_predicate_expression=1</code>) 对于带有 <code class=syntax>HAVING</code> 部分的查询 (即需要在服务器启动器上进行过滤时), 通过保留表达式的顺序 (这足以修复), 并且还强制 聚合器在索引上使用列名. 修复: <a href=https://github.com/ClickHouse/ClickHouse/issues/10613 rel="external nofollow noreferrer" target=_blank>#10613</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/11413 rel="external nofollow noreferrer" target=_blank>#11413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10621 rel="external nofollow noreferrer" target=_blank>#10621</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 LowCardinality 修复 optimize_skip_unused_shards. <a href=https://github.com/ClickHouse/ClickHouse/pull/10611 rel="external nofollow noreferrer" target=_blank>#10611</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复服务器启动异常时 StorageBuffer 中的段错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10550 rel="external nofollow noreferrer" target=_blank>#10550</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10609 rel="external nofollow noreferrer" target=_blank>#10609</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>在 <code class=syntax>SYSTEM DROP DNS CACHE</code> 查询中还会删除缓存, 用于检查是否允许用户从某些 IP 地址进行连接. <a href=https://github.com/ClickHouse/ClickHouse/pull/10608 rel="external nofollow noreferrer" target=_blank>#10608</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了 <code class=syntax>MATERIALIZED VIEW</code> 内部查询中不正确的标量结果, 以防该查询包含相关表. <a href=https://github.com/ClickHouse/ClickHouse/pull/10603 rel="external nofollow noreferrer" target=_blank>#10603</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了同步突变的处理条件变量. 在某些情况下, 该条件变量的信号可能会丢失. <a href=https://github.com/ClickHouse/ClickHouse/pull/10588 rel="external nofollow noreferrer" target=_blank>#10588</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>修复了在 <code class=syntax>loadStoredObject()</code> 完成之前调用 <code class=syntax>createDictionary()</code> 可能导致的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/10587 rel="external nofollow noreferrer" target=_blank>#10587</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复错误 <code class=syntax>the BloomFilter false positive must be a double number between 0 and 1</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/10551 rel="external nofollow noreferrer" target=_blank>#10551</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10569 rel="external nofollow noreferrer" target=_blank>#10569</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复 SELECT 列 ALIAS 的默认表达式类型与列类型不同. <a href=https://github.com/ClickHouse/ClickHouse/pull/10563 rel="external nofollow noreferrer" target=_blank>#10563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>实现了 DateTime64 和 String 值之间的比较 (就像 DateTime 一样). <a href=https://github.com/ClickHouse/ClickHouse/pull/10560 rel="external nofollow noreferrer" target=_blank>#10560</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>修复索引损坏，在某些情况下将合并部分合并到另一个合并部分后可能会发生. <a href=https://github.com/ClickHouse/ClickHouse/pull/10531 rel="external nofollow noreferrer" target=_blank>#10531</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>默认禁用GROUP BY sharding_key优化 (<code class=syntax>optimize_distributed_group_by_sharding_key</code> 已被引入并默认关闭, 由于sharding_key分析的技巧, 简单的例子是分片键中的 <code class=syntax>if</code> ) 并修复 WITH ROLLUP/CUBE/TOTALS. <a href=https://github.com/ClickHouse/ClickHouse/pull/10516 rel="external nofollow noreferrer" target=_blank>#10516</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复: <a href=https://github.com/ClickHouse/ClickHouse/issues/10263 rel="external nofollow noreferrer" target=_blank>#10263</a> (之后通过 INSERT 发送的 PR dist 在每个 INSERT 上被推迟) 修复: <a href=https://github.com/ClickHouse/ClickHouse/issues/8756 rel="external nofollow noreferrer" target=_blank>#8756</a> (that PR breaks distributed sends with all of the following conditions met (unlikely setup for now I guess): <code class=syntax>internal_replication == false</code>, multiple local shards (activates the hardlinking code) and <code class=syntax>distributed_storage_policy</code> (makes <code class=syntax>link(2)</code> fails on <code class=syntax>EXDEV</code>)). <a href=https://github.com/ClickHouse/ClickHouse/pull/10486 rel="external nofollow noreferrer" target=_blank>#10486</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>max_rows_to_sort</code> 限制的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10268 rel="external nofollow noreferrer" target=_blank>#10268</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>每次调用读取外部字典的任何函数时, 仅获取一次字典并检查访问权限. <a href=https://github.com/ClickHouse/ClickHouse/pull/10928 rel="external nofollow noreferrer" target=_blank>#10928</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> </ul> <h4 id=gai-jin_15>改进<a class=headerlink href=../amp/#gai-jin_15 title="Permanent link"> </a></h4> <ul> <li>在 <code class=syntax>ALTER MODIFY TTL</code> 查询之后, 对旧数据应用 <code class=syntax>TTL</code> . 这个行为是通过设置 <code class=syntax>materialize_ttl_after_modify</code> 来控制的, 默认是启用的. <a href=https://github.com/ClickHouse/ClickHouse/pull/11042 rel="external nofollow noreferrer" target=_blank>#11042</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>在解析字符串文字、VALUES 和各种文本格式中的 C 样式反斜杠转义时 (这是对 ClickHouse 和 MySQL 特有的 SQL 标准的扩展), 如果发现未知的转义序列 (例如<code class=syntax>\%</code> 或 <code class=syntax>\ w</code>), 这将使 <code class=syntax>LIKE</code> 和<code class=syntax>match</code> 正则表达式的使用更加方便 (写<code class=syntax>name LIKE 'used\_cars'</code> 而不是 <code class=syntax>name LIKE 'used\\_cars'</code> 就足够了) 同时更兼容. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10922 rel="external nofollow noreferrer" target=_blank>#10922</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11208 rel="external nofollow noreferrer" target=_blank>#11208</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>读取 Decimal 值时, 在点后切掉多余的数字. 此行为与 MySQL 和 PostgreSQL 更兼容. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10202 rel="external nofollow noreferrer" target=_blank>#10202</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11831 rel="external nofollow noreferrer" target=_blank>#11831</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果 ZooKeeper 中的元数据已经被删除并且不存在, 则允许 DROP 复制表 (这也是使用 TestKeeper 进行测试并重新启动服务器时的情况). 即使与 ZooKeeper 通信出现错误, 也允许重命名复制表. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10720 rel="external nofollow noreferrer" target=_blank>#10720</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11652 rel="external nofollow noreferrer" target=_blank>#11652</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>稍微改进从字符串中读取十进制的诊断. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/10202 rel="external nofollow noreferrer" target=_blank>#10202</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11829 rel="external nofollow noreferrer" target=_blank>#11829</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复信号处理程序中的睡眠调用. 它的睡眠时间比预期的要少. <a href=https://github.com/ClickHouse/ClickHouse/pull/11825 rel="external nofollow noreferrer" target=_blank>#11825</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>(仅限 Linux) 操作系统相关的性能指标 (针对 CPU 和 I/O) 即使没有 <code class=syntax>CAP_NET_ADMIN</code> 功能也能正常工作. <a href=https://github.com/ClickHouse/ClickHouse/pull/10544 rel="external nofollow noreferrer" target=_blank>#10544</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>添加了 <code class=syntax>hostname</code> 作为函数 <code class=syntax>hostName</code> 的别名. 此功能由 Yandex.Metrica 的 Victor Tarnavskiy 提出. <a href=https://github.com/ClickHouse/ClickHouse/pull/11821 rel="external nofollow noreferrer" target=_blank>#11821</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了对跨复制集群上分布式 <code class=syntax>DDL</code> (更新/删除/删除分区) 的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/11703 rel="external nofollow noreferrer" target=_blank>#11703</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>如果我们无法侦听侦听地址之一 (例如，在 Docker 中 IPv6 不可用), 则在启动时在服务器日志中发出警告而不是错误. 请注意，如果服务器未能侦听所有列出的地址, 它将像以前一样拒绝启动. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/4406 rel="external nofollow noreferrer" target=_blank>#4406</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11687 rel="external nofollow noreferrer" target=_blank>#11687</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 docker 映像启动时创建默认用户和数据库. <a href=https://github.com/ClickHouse/ClickHouse/pull/10637 rel="external nofollow noreferrer" target=_blank>#10637</a> (<a href=https://github.com/tarampampam rel="external nofollow noreferrer" target=_blank>Paramtamtam</a>).</li> <li>当多行查询打印到服务器日志时, 这些行被连接起来. 使其在多行字符串文字、标识符和单行注释的情况下正常工作. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/3853 rel="external nofollow noreferrer" target=_blank>#3853</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11686 rel="external nofollow noreferrer" target=_blank>#11686</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在允许在命令中使用多个名称: CREATE USER、CREATE ROLE、ALTER USER、SHOW CREATE USER、SHOW GRANTS 等. <a href=https://github.com/ClickHouse/ClickHouse/pull/11670 rel="external nofollow noreferrer" target=_blank>#11670</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>在跨复制集群上添加对分布式 DDL (<code class=syntax>UPDATE/DELETE/DROP PARTITION</code>) 的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/11508 rel="external nofollow noreferrer" target=_blank>#11508</a> (<a href=https://github.com/etah000 rel="external nofollow noreferrer" target=_blank>frank lee</a>).</li> <li>如果用户已使用显式值指定密码, 则从命令行中的 <code class=syntax>clickhouse-client</code> 和 <code class=syntax>clickhouse-benchmark</code> 清除密码. 这可以防止 <code class=syntax>ps</code> 和类似工具暴露密码. <a href=https://github.com/ClickHouse/ClickHouse/pull/11665 rel="external nofollow noreferrer" target=_blank>#11665</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果 ELF 文件与正在运行的二进制文件不对应, 请不要使用调试信息. 需要避免在堆栈跟踪中打印错误的函数名称和源位置. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7514 rel="external nofollow noreferrer" target=_blank>#7514</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11657 rel="external nofollow noreferrer" target=_blank>#11657</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当在 parseDateTimeBestEffortOrNull/Zero 函数中没有完全解析值时, 返回 NULL/零. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7876 rel="external nofollow noreferrer" target=_blank>#7876</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11653 rel="external nofollow noreferrer" target=_blank>#11653</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>跳过请求的 URL 中的空参数. 当你写 <code class=syntax>http://localhost:8123/?&amp;a=b</code> 或 <code class=syntax>http://localhost:8123/?a=b&amp;&amp;c=d</code> 时, 它们可能会出现. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/10749 rel="external nofollow noreferrer" target=_blank>#10749</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11651 rel="external nofollow noreferrer" target=_blank>#11651</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>允许使用 <code class=syntax>groupArrayArray</code> 和 <code class=syntax>groupUniqArrayArray</code> 作为 <code class=syntax>SimpleAggregateFunction</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11650 rel="external nofollow noreferrer" target=_blank>#11650</a> (<a href=https://github.com/ksvladimir rel="external nofollow noreferrer" target=_blank>Volodymyr Kuznetsov</a>).</li> <li>在分析其他类型的索引条件时, 允许通过隐式转换与常量字符串进行比较. 这可能会关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11630 rel="external nofollow noreferrer" target=_blank>#11630</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11648 rel="external nofollow noreferrer" target=_blank>#11648</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li><a href=https://github.com/ClickHouse/ClickHouse/pull/7572#issuecomment-642815377 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/7572#issuecomment-642815377</a> 支持配置默认 HTTPHandlers. <a href=https://github.com/ClickHouse/ClickHouse/pull/11628 rel="external nofollow noreferrer" target=_blank>#11628</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>制作更多输入格式以与 Kafka 引擎配合使用. 解决过早冲洗的问题. 修复 <code class=syntax>kafka_num_consumers</code> 大于主题分区数时的性能问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/11599 rel="external nofollow noreferrer" target=_blank>#11599</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>改进 <code class=syntax>multiple_joins_rewriter_version=2</code> 逻辑. 修复 lambda 别名的未知列错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/11587 rel="external nofollow noreferrer" target=_blank>#11587</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>无法解析列声明列表时更好的异常消息. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/10403 rel="external nofollow noreferrer" target=_blank>#10403</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11537 rel="external nofollow noreferrer" target=_blank>#11537</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>改进 VIEW 的 <code class=syntax>enable_optimize_predicate_expression=1</code> 逻辑. <a href=https://github.com/ClickHouse/ClickHouse/pull/11513 rel="external nofollow noreferrer" target=_blank>#11513</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>在实时视图表中添加对 PREWHERE 的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/11495 rel="external nofollow noreferrer" target=_blank>#11495</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>自动更新 DNS 缓存, 用于检查是否允许用户从某个地址连接. <a href=https://github.com/ClickHouse/ClickHouse/pull/11487 rel="external nofollow noreferrer" target=_blank>#11487</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>即使执行并发合并, OPTIMIZE FINAL 也会强制合并. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11309 rel="external nofollow noreferrer" target=_blank>#11309</a> 并关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11322 rel="external nofollow noreferrer" target=_blank>#11322</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11346 rel="external nofollow noreferrer" target=_blank>#11346</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>抑制 clickhouse-client 中取消查询的输出. 在以前的版本中, 即使按 Ctrl+C 取消查询, 结果也可能会继续在终端中打印. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/9473 rel="external nofollow noreferrer" target=_blank>#9473</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11342 rel="external nofollow noreferrer" target=_blank>#11342</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在历史文件会在每次查询后更新, 如果多个客户端使用一个历史文件, 则不会出现竞争条件. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9897 rel="external nofollow noreferrer" target=_blank>#9897</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11453 rel="external nofollow noreferrer" target=_blank>#11453</a> (<a href=https://github.com/kuskarov rel="external nofollow noreferrer" target=_blank>Tagir Kuskarov</a>).</li> <li>重新加载配置时更好地记录消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/11341 rel="external nofollow noreferrer" target=_blank>#11341</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在某些情况下，从 <code class=syntax>clickhouse-client</code> 或 <code class=syntax>clickhouse-format</code> 中的格式化查询中删除尾随空格. <a href=https://github.com/ClickHouse/ClickHouse/pull/11325 rel="external nofollow noreferrer" target=_blank>#11325</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加设置 <code class=syntax>output_format_pretty_max_value_width</code> . 如果 value 较长, 则将其剪切以避免在终端中输出过大的 value. 这将关闭. <a href=https://github.com/ClickHouse/ClickHouse/pull/11324 rel="external nofollow noreferrer" target=_blank>#11324</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在内存映射不足的情况下更好的异常消息. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11027 rel="external nofollow noreferrer" target=_blank>#11027</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11316 rel="external nofollow noreferrer" target=_blank>#11316</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>支持 (U)Int8、(U)Int16、ASOF JOIN 中的日期. <a href=https://github.com/ClickHouse/ClickHouse/pull/11301 rel="external nofollow noreferrer" target=_blank>#11301</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>支持 Kafka 表的 kafka_client_id 参数. 它还将 ClickHouse 在与 Kafka 通信时使用的默认 <code class=syntax>client.id</code> 更改为更加详细和可用. <a href=https://github.com/ClickHouse/ClickHouse/pull/11252 rel="external nofollow noreferrer" target=_blank>#11252</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>将 <code class=syntax>DistributedFilesToInsert</code> 指标的值保留在异常上. 在以前的版本中, 该值是在我们要发送一些文件时设置的, 但如果出现异常并且一些文件仍处于待处理状态, 则该值为零. 现在它对应于文件系统中待处理文件的数量. <a href=https://github.com/ClickHouse/ClickHouse/pull/11220 rel="external nofollow noreferrer" target=_blank>#11220</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加对多字数据类型名称的支持 (例如 <code class=syntax>DOUBLE PRECISION</code> and <code class=syntax>CHAR VARYING</code> ) 以获得更好的 SQL 兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/11214 rel="external nofollow noreferrer" target=_blank>#11214</a> (<a href=https://github.com/Potya rel="external nofollow noreferrer" target=_blank>Павел Потемкин</a>).</li> <li>为某些数据类型提供同义词. <a href=https://github.com/ClickHouse/ClickHouse/pull/10856 rel="external nofollow noreferrer" target=_blank>#10856</a> (<a href=https://github.com/Potya rel="external nofollow noreferrer" target=_blank>Павел Потемкин</a>).</li> <li>现在默认启用查询日志. <a href=https://github.com/ClickHouse/ClickHouse/pull/11184 rel="external nofollow noreferrer" target=_blank>#11184</a> (<a href=https://github.com/blinkov rel="external nofollow noreferrer" target=_blank>Ivan Blinkov</a>).</li> <li>在表 system.users 和执行 SHOW CREATE USER 查询时显示身份验证类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/11080 rel="external nofollow noreferrer" target=_blank>#11080</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>删除 <code class=syntax>Memory</code> 数据库引擎的显式 <code class=syntax>DROP DATABASE</code> 上的数据. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10557 rel="external nofollow noreferrer" target=_blank>#10557</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11021 rel="external nofollow noreferrer" target=_blank>#11021</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>为 rdkafka 库的内部线程设置线程名称. 使来自 rdkafka 的日志在服务器日志中可用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10983 rel="external nofollow noreferrer" target=_blank>#10983</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>支持查询中的 unicode 空格. 这有助于从 Word 或网页复制粘贴查询. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10896 rel="external nofollow noreferrer" target=_blank>#10896</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10903 rel="external nofollow noreferrer" target=_blank>#10903</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>允许大型 UInt 类型作为函数 <code class=syntax>tupleElement</code> 中的索引. <a href=https://github.com/ClickHouse/ClickHouse/pull/10874 rel="external nofollow noreferrer" target=_blank>#10874</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>尊重在 INSERT 到分布式上的prefer_localhost_replica/load_balancing. <a href=https://github.com/ClickHouse/ClickHouse/pull/10867 rel="external nofollow noreferrer" target=_blank>#10867</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>介绍 <code class=syntax>min_insert_block_size_rows_for_materialized_views</code>、<code class=syntax>min_insert_block_size_bytes_for_materialized_views</code> 设置. 此设置类似于 <code class=syntax>min_insert_block_size_rows</code> 和 <code class=syntax>min_insert_block_size_bytes</code>, 但仅适用于插入到 <code class=syntax>MATERIALIZED VIEW</code> 中的块. 它有助于在推送到 MV 时控制块挤压并避免过多的内存使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10858 rel="external nofollow noreferrer" target=_blank>#10858</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>在服务器关闭期间摆脱复制队列中的异常. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10819 rel="external nofollow noreferrer" target=_blank>#10819</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10841 rel="external nofollow noreferrer" target=_blank>#10841</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>确保 <code class=syntax>varSamp</code>、<code class=syntax>varPop</code> 不能因数值错误返回负结果, 并且不能从负方差计算 <code class=syntax>stddevSamp</code>、<code class=syntax>stddevPop</code>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10532 rel="external nofollow noreferrer" target=_blank>#10532</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10829 rel="external nofollow noreferrer" target=_blank>#10829</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>更好的 DNS 异常消息. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10813 rel="external nofollow noreferrer" target=_blank>#10813</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10828 rel="external nofollow noreferrer" target=_blank>#10828</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>将某些解析错误的 HTTP 响应代码更改为 400 Bad Request. 这个修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10636 rel="external nofollow noreferrer" target=_blank>#10636</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10640 rel="external nofollow noreferrer" target=_blank>#10640</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果 clickhouse-client 比 clickhouse-server 新, 则打印一条消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/10627 rel="external nofollow noreferrer" target=_blank>#10627</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加对 <code class=syntax>INSERT INTO [db.]table WATCH</code> 查询的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/10498 rel="external nofollow noreferrer" target=_blank>#10498</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>允许在 clickhouse-client 中传递 quota_key. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/10227 rel="external nofollow noreferrer" target=_blank>#10227</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10270 rel="external nofollow noreferrer" target=_blank>#10270</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h4 id=xing-neng-gai-jin_9>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_9 title="Permanent link"> </a></h4> <ul> <li>允许多个副本同时分配合并、突变、分区删除、移动和替换. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/10367 rel="external nofollow noreferrer" target=_blank>#10367</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11639 rel="external nofollow noreferrer" target=_blank>#11639</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/11795 rel="external nofollow noreferrer" target=_blank>#11795</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>关于表排序键的 GROUP BY 优化, 通过 <code class=syntax>optimize_aggregation_in_order</code> 设置启用. <a href=https://github.com/ClickHouse/ClickHouse/pull/9113 rel="external nofollow noreferrer" target=_blank>#9113</a> (<a href=https://github.com/dimarub2000 rel="external nofollow noreferrer" target=_blank>dimarub2000</a>).</li> <li>带有 final 的选择是并行执行的. 添加设置 <code class=syntax>max_final_threads</code> 以限制使用的线程数. <a href=https://github.com/ClickHouse/ClickHouse/pull/10463 rel="external nofollow noreferrer" target=_blank>#10463</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当生成小块时, 通过 <code class=syntax>INSERT SELECT</code> 或 INSERT with clickhouse-client 提高 INSERT 查询的性能 (并行解析的典型情况). 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11275 rel="external nofollow noreferrer" target=_blank>#11275</a>. 修复 CONSTRAINT 不适用于 DEFAULT 字段的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11273 rel="external nofollow noreferrer" target=_blank>#11273</a>. 修复 TEMPORARY 表忽略 CONSTRAINTS 的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11274 rel="external nofollow noreferrer" target=_blank>#11274</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11276 rel="external nofollow noreferrer" target=_blank>#11276</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>消除 SELECT 部分中 GROUP BY 键的最小/最大/任何聚合器的优化, 通过 <code class=syntax>optimize_aggregators_of_group_by_keys</code> 设置启用. <a href=https://github.com/ClickHouse/ClickHouse/pull/11667 rel="external nofollow noreferrer" target=_blank>#11667</a> (<a href=https://github.com/xPoSx rel="external nofollow noreferrer" target=_blank>xPoSx</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/11806 rel="external nofollow noreferrer" target=_blank>#11806</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 <code class=syntax>optimize_move_functions_out_of_any</code> 启用的新优化, 可从 <code class=syntax>any</code> 函数中删除所有操作 <a href=https://github.com/ClickHouse/ClickHouse/pull/11529 rel="external nofollow noreferrer" target=_blank>#11529</a> (<a href=https://github.com/kamalov-ruslan rel="external nofollow noreferrer" target=_blank>Ruslan</a>).</li> <li>当使用 Pretty 格式时, 提高交互模式下 <code class=syntax>clickhouse-client</code> 的性能. 在以前的版本中, 计算 UTF-8 字符串的可见宽度可能会花费大量时间. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11323 rel="external nofollow noreferrer" target=_blank>#11323</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11323 rel="external nofollow noreferrer" target=_blank>#11323</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>使用 <code class=syntax>ORDER BY</code> 和小的 <code class=syntax>LIMIT</code> 提高查询的性能 (小于, 然后是 <code class=syntax>max_block_size</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/11171 rel="external nofollow noreferrer" target=_blank>#11171</a> (<a href=https://github.com/Provet rel="external nofollow noreferrer" target=_blank>Albert Kidrachev</a>).</li> <li>添加运行时 CPU 检测以选择和调度最佳功能实现. 添加对多个目标的代码生成的支持. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/1017 rel="external nofollow noreferrer" target=_blank>#1017</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10058 rel="external nofollow noreferrer" target=_blank>#10058</a> (<a href=https://github.com/DimasKovas rel="external nofollow noreferrer" target=_blank>DimasKovas</a>).</li> <li>默认启用 clickhouse 二进制文件的 <code class=syntax>mlock</code>. 它将防止 clickhouse 可执行文件在高 IO 负载下被分页. <a href=https://github.com/ClickHouse/ClickHouse/pull/11139 rel="external nofollow noreferrer" target=_blank>#11139</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>使用 <code class=syntax>sum</code> 聚合函数进行查询而不使用 GROUP BY 键以更快地运行多次. <a href=https://github.com/ClickHouse/ClickHouse/pull/10992 rel="external nofollow noreferrer" target=_blank>#10992</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>通过删除一些冗余数据移动来改进基数排序 (在带有简单键的 <code class=syntax>ORDER BY</code> 中使用). <a href=https://github.com/ClickHouse/ClickHouse/pull/10981 rel="external nofollow noreferrer" target=_blank>#10981</a> (<a href=https://github.com/g-arslan rel="external nofollow noreferrer" target=_blank>Arslan Gumerov</a>).</li> <li>在 MergeJoin 中对左表的较大部分进行排序. 缓冲内存中的剩余块. 添加 <code class=syntax>partial_merge_join_left_table_buffer_bytes</code> 设置来管理左侧块缓冲区大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/10601 rel="external nofollow noreferrer" target=_blank>#10601</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>从子查询中删除重复的 ORDER BY 和 DISTINCT, 此优化通过 <code class=syntax>optimize_duplicate_order_by_and_distinct</code> 启用 <a href=https://github.com/ClickHouse/ClickHouse/pull/10067 rel="external nofollow noreferrer" target=_blank>#10067</a> (<a href=https://github.com/demo-99 rel="external nofollow noreferrer" target=_blank>Mikhail Malafeev</a>).</li> <li>此功能消除了 GROUP BY 部分中其他键的功能, 通过 <code class=syntax>optimize_group_by_function_keys</code> 启用 <a href=https://github.com/ClickHouse/ClickHouse/pull/10051 rel="external nofollow noreferrer" target=_blank>#10051</a> (<a href=https://github.com/xPoSx rel="external nofollow noreferrer" target=_blank>xPoSx</a>).</li> <li>使用 <code class=syntax>optimize_arithmetic_operations_in_aggregate_functions</code> 启用从聚合函数中提取算术运算的新优化 <a href=https://github.com/ClickHouse/ClickHouse/pull/10047 rel="external nofollow noreferrer" target=_blank>#10047</a> (<a href=https://github.com/kamalov-ruslan rel="external nofollow noreferrer" target=_blank>Ruslan</a>).</li> <li>使用基于 Poco 而不是 curl 的 S3 的 HTTP 客户端. 这将提高性能并降低 s3 存储和表函数的内存使用量. <a href=https://github.com/ClickHouse/ClickHouse/pull/11230 rel="external nofollow noreferrer" target=_blank>#11230</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>修复与基于限制重新安排相关的 Kafka 性能问题, 这些限制总是被应用. <a href=https://github.com/ClickHouse/ClickHouse/pull/11149 rel="external nofollow noreferrer" target=_blank>#11149</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>为 jemalloc 启用 percpu_arena:percpu (这将减少由于线程池造成的内存碎片). <a href=https://github.com/ClickHouse/ClickHouse/pull/11084 rel="external nofollow noreferrer" target=_blank>#11084</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>从 S3 HTTP 客户端读取响应时优化内存使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/11561 rel="external nofollow noreferrer" target=_blank>#11561</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>调整默认的 Kafka 设置以获得更好的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/11388 rel="external nofollow noreferrer" target=_blank>#11388</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> </ul> <h4 id=shi-yan-gong-neng_5>实验功能<a class=headerlink href=../amp/#shi-yan-gong-neng_5 title="Permanent link"> </a></h4> <ul> <li>添加数据类型 <code class=syntax>Point</code> (Tuple(Float64, Float64)) 和 <code class=syntax>Polygon</code> (Array(Array(Tuple(Float64, Float64))). <a href=https://github.com/ClickHouse/ClickHouse/pull/10678 rel="external nofollow noreferrer" target=_blank>#10678</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li> <li>添加一个 <code class=syntax>hasSubstr</code> 函数, 允许在数组中查找子序列. 注: 此功能可能会更名, 恕不另行通知. <a href=https://github.com/ClickHouse/ClickHouse/pull/11071 rel="external nofollow noreferrer" target=_blank>#11071</a> (<a href=https://github.com/r-zenine rel="external nofollow noreferrer" target=_blank>Ryad Zenine</a>).</li> <li>添加了 OpenCL 支持和双音排序算法, 可用于对单列中的整数类型数据进行排序. 需要使用标志 <code class=syntax>-DENABLE_OPENCL=1</code> 构建. 要使用双音排序算法而不是其他算法, 您需要为设置选项 <code class=syntax>special_sort</code> 设置 <code class=syntax>bitonic_sort</code>, 并确保 OpenCL 可用. 此功能不会提高性能或其他任何东西, 仅作为示例和演示目的提供. 如果在这个方向上没有进一步的发展, 它可能会在不久的将来被移除. <a href=https://github.com/ClickHouse/ClickHouse/pull/10232 rel="external nofollow noreferrer" target=_blank>#10232</a> (<a href=https://github.com/margaritiko rel="external nofollow noreferrer" target=_blank>Ri</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_11>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_11 title="Permanent link"> </a></h4> <ul> <li>为程序和实用程序启用 clang-tidy. <a href=https://github.com/ClickHouse/ClickHouse/pull/10991 rel="external nofollow noreferrer" target=_blank>#10991</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>删除对 <code class=syntax>tzdata</code> 的依赖: 如果 <code class=syntax>/usr/share/zoneinfo</code> 目录不存在, 则不会失败. 请注意, 即使系统中没有安装 tzdata，所有时区都可以在 ClickHouse 中使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/11827 rel="external nofollow noreferrer" target=_blank>#11827</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了 MSan 和 UBSan 压力测试. 请注意, 我们已经有了用于功能测试的 MSan、UBSan, 而 "stress" 测试是另一种测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/10871 rel="external nofollow noreferrer" target=_blank>#10871</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在崩溃消息中打印编译器构建 ID. 这将使我们更加确定哪个二进制文件崩溃了. 添加了新函数 <code class=syntax>buildId</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11824 rel="external nofollow noreferrer" target=_blank>#11824</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了一个测试以确保在 FREEZE 查询后突变继续工作. <a href=https://github.com/ClickHouse/ClickHouse/pull/11820 rel="external nofollow noreferrer" target=_blank>#11820</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>不允许在名称中包含 "fail" 子字符串的测试, 因为当您键入 Ctrl+F 并搜索 "fail" 时, 这会使在浏览器中查看测试结果变得不那么方便. <a href=https://github.com/ClickHouse/ClickHouse/pull/11817 rel="external nofollow noreferrer" target=_blank>#11817</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>从 HTTPHandlerFactory 中删除未使用的导入. <a href=https://github.com/ClickHouse/ClickHouse/pull/11660 rel="external nofollow noreferrer" target=_blank>#11660</a> (<a href=https://github.com/bharatnc rel="external nofollow noreferrer" target=_blank>Bharat Nallan</a>).</li> <li>添加了对执行复制程序的实例的随机抽样. 需要避免 <code class=syntax>Too many simultaneous queries</code> 错误. 还增加了超时时间并降低了故障概率. <a href=https://github.com/ClickHouse/ClickHouse/pull/11573 rel="external nofollow noreferrer" target=_blank>#11573</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复遗漏的 include. <a href=https://github.com/ClickHouse/ClickHouse/pull/11525 rel="external nofollow noreferrer" target=_blank>#11525</a> (<a href=https://github.com/matwey rel="external nofollow noreferrer" target=_blank>Matwey V. Kornilov</a>).</li> <li>通过删除旧的示例程序来加速构建。 还发现了一些孤儿功能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/11486 rel="external nofollow noreferrer" target=_blank>#11486</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>增加 CI 中构建的 ccache 大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/11450 rel="external nofollow noreferrer" target=_blank>#11450</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在 deb 构建中只保留 unit_tests_dbms. <a href=https://github.com/ClickHouse/ClickHouse/pull/11429 rel="external nofollow noreferrer" target=_blank>#11429</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>).</li> <li>将 librdkafka 更新到版本 <a href=https://github.com/edenhill/librdkafka/releases/tag/v1.4.2 rel="external nofollow noreferrer" target=_blank>1.4.2</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11256 rel="external nofollow noreferrer" target=_blank>#11256</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>重构 CMake 构建文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/11390 rel="external nofollow noreferrer" target=_blank>#11390</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>修复几个不稳定的集成测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/11355 rel="external nofollow noreferrer" target=_blank>#11355</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>添加对使用 UBSan 运行的单元测试的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/11345 rel="external nofollow noreferrer" target=_blank>#11345</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>从集成测试 <code class=syntax>test_insertion_sync_fails_with_timeout</code> 中删除冗余超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/11343 rel="external nofollow noreferrer" target=_blank>#11343</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>更好地检查 clickhouse-test 中的挂起查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/11321 rel="external nofollow noreferrer" target=_blank>#11321</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果服务器是在调试中构建或使用消毒剂构建的, 则发出警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/11304 rel="external nofollow noreferrer" target=_blank>#11304</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在 clickhouse-test 在测试运行之前检查服务器的活动性. <a href=https://github.com/ClickHouse/ClickHouse/pull/11285 rel="external nofollow noreferrer" target=_blank>#11285</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复可能不稳定的测试 <code class=syntax>00731_long_merge_tree_select_opened_files.sh</code>. 它不会经常失败, 但我们在试验 ThreadFuzzer 时发现了这个测试中潜在的竞争条件: <a href=https://github.com/ClickHouse/ClickHouse/issues/9814 rel="external nofollow noreferrer" target=_blank>#9814</a> 见 <a href=https://clickhouse-test-reports.s3.yandex.net/9814/40e3023e215df22985d275bf85f4d2290897b76b/functional_stateless_tests_(unbundled).html#fail1 rel="external nofollow noreferrer" target=_blank>link</a> for the example. <a href=https://github.com/ClickHouse/ClickHouse/pull/11270 rel="external nofollow noreferrer" target=_blank>#11270</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果 <code class=syntax>curl</code> 调用超时, 则在 CI 中重复测试. 由于系统挂断超过 10 秒, 这在我们的 CI 基础设施中很常见. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11267 rel="external nofollow noreferrer" target=_blank>#11267</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11268 rel="external nofollow noreferrer" target=_blank>#11268</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>从@donmikel 添加对连接表引擎的测试. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/9158 rel="external nofollow noreferrer" target=_blank>#9158</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11265 rel="external nofollow noreferrer" target=_blank>#11265</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复单元测试中的几个非重大错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/11262 rel="external nofollow noreferrer" target=_blank>#11262</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>现在, <code class=syntax>cctz</code> 库的部分链接器命令将不会与其他库混在一起. <a href=https://github.com/ClickHouse/ClickHouse/pull/11213 rel="external nofollow noreferrer" target=_blank>#11213</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>将 /programs/server 拆分为实际的程序和库. <a href=https://github.com/ClickHouse/ClickHouse/pull/11186 rel="external nofollow noreferrer" target=_blank>#11186</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>改进 protobuf 和 gRPC 的构建脚本. <a href=https://github.com/ClickHouse/ClickHouse/pull/11172 rel="external nofollow noreferrer" target=_blank>#11172</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>启用不起作用的性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/11158 rel="external nofollow noreferrer" target=_blank>#11158</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在启动任何 CH 实例之前为测试创建根 S3 存储桶. <a href=https://github.com/ClickHouse/ClickHouse/pull/11142 rel="external nofollow noreferrer" target=_blank>#11142</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>添加非恒定多边形的性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/11141 rel="external nofollow noreferrer" target=_blank>#11141</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>00979_live_view_watch_continuous_aggregates</code> 测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/11024 rel="external nofollow noreferrer" target=_blank>#11024</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>添加在 tmpfs 上的集成测试中运行 zookeeper 的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/11002 rel="external nofollow noreferrer" target=_blank>#11002</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>等待具有指数退避的 odbc-bridge. 在我们的 CI 环境中, 之前 200 毫秒的等待时间是不够的. <a href=https://github.com/ClickHouse/ClickHouse/pull/10990 rel="external nofollow noreferrer" target=_blank>#10990</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复非确定性测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/10989 rel="external nofollow noreferrer" target=_blank>#10989</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了对空外部数据的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/10926 rel="external nofollow noreferrer" target=_blank>#10926</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>每次测试都会重新创建数据库. 这改进了测试的分离. <a href=https://github.com/ClickHouse/ClickHouse/pull/10902 rel="external nofollow noreferrer" target=_blank>#10902</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在列代码中添加了更多断言. <a href=https://github.com/ClickHouse/ClickHouse/pull/10833 rel="external nofollow noreferrer" target=_blank>#10833</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>与清除系统更好的合作. 在清除失败的消息中打印有关 query_id 的信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/10832 rel="external nofollow noreferrer" target=_blank>#10832</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 "Split build smoke test" 检查中修复明显的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/10820 rel="external nofollow noreferrer" target=_blank>#10820</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 MergeTreeIndexFullText 中修复 (false) MSan 报告. 该问题首次出现在 <a href=https://github.com/ClickHouse/ClickHouse/issues/9968 rel="external nofollow noreferrer" target=_blank>#9968</a> 中. <a href=https://github.com/ClickHouse/ClickHouse/pull/10801 rel="external nofollow noreferrer" target=_blank>#10801</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>为 MariaDB 客户端库添加 MSan 抑制. <a href=https://github.com/ClickHouse/ClickHouse/pull/10800 rel="external nofollow noreferrer" target=_blank>#10800</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>GRPC make 找不到 protobuf 文件, 通过添加正确的链接来更改 make 文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/10794 rel="external nofollow noreferrer" target=_blank>#10794</a> (<a href=https://github.com/mnkonkova rel="external nofollow noreferrer" target=_blank>mnkonkova</a>).</li> <li>为 base、utils、programs 启用额外警告 (<code class=syntax>-Weverything</code>). 请注意, 我们已经为大部分代码提供了它. <a href=https://github.com/ClickHouse/ClickHouse/pull/10779 rel="external nofollow noreferrer" target=_blank>#10779</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在 <a href=https://github.com/ClickHouse/ClickHouse/issues/10396 rel="external nofollow noreferrer" target=_blank>#10396</a> 中, 对图书馆警告的抑制被错误地声明为公开. <a href=https://github.com/ClickHouse/ClickHouse/pull/10776 rel="external nofollow noreferrer" target=_blank>#10776</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>恢复在 <a href=https://github.com/ClickHouse/ClickHouse/issues/10396 rel="external nofollow noreferrer" target=_blank>#10396</a> 中意外删除的补丁. <a href=https://github.com/ClickHouse/ClickHouse/pull/10774 rel="external nofollow noreferrer" target=_blank>#10774</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复性能测试错误, 第 2 部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/10773 rel="external nofollow noreferrer" target=_blank>#10773</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复性能测试错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10766 rel="external nofollow noreferrer" target=_blank>#10766</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>更新交叉构建以使用 clang-10 编译器. <a href=https://github.com/ClickHouse/ClickHouse/pull/10724 rel="external nofollow noreferrer" target=_blank>#10724</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>更新安装 RPM 包的说明. 这是由 Denis (TG login @ldviolet) 建议并由 Arkady Shejn 实施的. <a href=https://github.com/ClickHouse/ClickHouse/pull/10707 rel="external nofollow noreferrer" target=_blank>#10707</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>试图修复 <code class=syntax>tests/queries/0_stateless/01246_insert_into_watch_live_view.py</code> 测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/10670 rel="external nofollow noreferrer" target=_blank>#10670</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>修复和重新启用 00979_live_view_watch_continuous_aggregates.py 测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/10658 rel="external nofollow noreferrer" target=_blank>#10658</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>修复 ASan 压力测试中的 OOM. <a href=https://github.com/ClickHouse/ClickHouse/pull/10646 rel="external nofollow noreferrer" target=_blank>#10646</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复迁移到 clang-10 后出现的 HashTable 中的 UBSan 报告 (向 nullptr 添加零). <a href=https://github.com/ClickHouse/ClickHouse/pull/10638 rel="external nofollow noreferrer" target=_blank>#10638</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在编译时的 tzdata 处理期间删除对 <code class=syntax>ld</code> (bfd) 链接器的外部调用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10634 rel="external nofollow noreferrer" target=_blank>#10634</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>允许使用 <code class=syntax>lld</code> 来链接 blob (资源). <a href=https://github.com/ClickHouse/ClickHouse/pull/10632 rel="external nofollow noreferrer" target=_blank>#10632</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>LZ4</code> 库中的UBSan报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/10631 rel="external nofollow noreferrer" target=_blank>#10631</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>). See also <a href=https://github.com/lz4/lz4/issues/857 rel="external nofollow noreferrer" target=_blank>https://github.com/lz4/lz4/issues/857</a></li> <li>将 LZ4 更新到最新的 dev 分支. <a href=https://github.com/ClickHouse/ClickHouse/pull/10630 rel="external nofollow noreferrer" target=_blank>#10630</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了自动生成的机器可读文件与稳定版本的列表. <a href=https://github.com/ClickHouse/ClickHouse/pull/10628 rel="external nofollow noreferrer" target=_blank>#10628</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>capnp::UnalignedFlatArrayMessageReader</code> 的 <code class=syntax>capnproto</code> 版本检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/10618 rel="external nofollow noreferrer" target=_blank>#10618</a> (<a href=https://github.com/matwey rel="external nofollow noreferrer" target=_blank>Matwey V. Kornilov</a>).</li> <li>测试中的内存使用率较低. <a href=https://github.com/ClickHouse/ClickHouse/pull/10617 rel="external nofollow noreferrer" target=_blank>#10617</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在新的实时视图测试中修复硬编码超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/10604 rel="external nofollow noreferrer" target=_blank>#10604</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>在 tests/queries/0_stateless/helpers/client.py 中打开客户端时增加超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/10599 rel="external nofollow noreferrer" target=_blank>#10599</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>).</li> <li>为 clang 构建启用 ThinLTO, 继续 <a href=https://github.com/ClickHouse/ClickHouse/pull/10435 rel="external nofollow noreferrer" target=_blank>#10435</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10585 rel="external nofollow noreferrer" target=_blank>#10585</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>添加模糊器并准备 oss-fuzz 集成. <a href=https://github.com/ClickHouse/ClickHouse/pull/10546 rel="external nofollow noreferrer" target=_blank>#10546</a> (<a href=https://github.com/kyprizel rel="external nofollow noreferrer" target=_blank>kyprizel</a>).</li> <li>修复 FreeBSD 构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/10150 rel="external nofollow noreferrer" target=_blank>#10150</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> <li>使用 pytest 框架为查询测试添加新版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/10039 rel="external nofollow noreferrer" target=_blank>#10039</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>).</li> </ul> <h2 id=clickhouse-ban-ben-v20-4>ClickHouse 版本 v20.4<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-4 title="Permanent link"> </a></h2> <h3 id=clickhouse-ban-ben-v20-4-8-99-stable-2020-08-10>ClickHouse 版本 v20.4.8.99-stable 2020-08-10<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-4-8-99-stable-2020-08-10 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_28>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_28 title="Permanent link"> </a></h4> <ul> <li>修复了当 unix 时间戳作为参数传递时 <code class=syntax>parseDateTimeBestEffort</code> 函数中的错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13362 rel="external nofollow noreferrer" target=_blank>#13362</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13441 rel="external nofollow noreferrer" target=_blank>#13441</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在具有 NaN 值的 Float 类型上调用的 <code class=syntax>uniqExact</code>、<code class=syntax>topK</code>、<code class=syntax>sumDistinct</code> 和类似聚合函数的潜在低性能和稍微不正确的结果. 它还在调试版本中触发断言. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12491 rel="external nofollow noreferrer" target=_blank>#12491</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13254 rel="external nofollow noreferrer" target=_blank>#13254</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果将可空 constexpr 作为不是文字 NULL 的 cond 的固定函数. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12463 rel="external nofollow noreferrer" target=_blank>#12463</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13226 rel="external nofollow noreferrer" target=_blank>#13226</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在数组元素为 Nullable 且数组下标也可为 Null 的情况下, 修复了 <code class=syntax>arrayElement</code> 函数中的断言. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12172 rel="external nofollow noreferrer" target=_blank>#12172</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13224 rel="external nofollow noreferrer" target=_blank>#13224</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>用函数修正了错误的索引分析. 在从 <code class=syntax>MergeTree</code> 表中读取时, 它可能会导致修剪错误的部分. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13060 rel="external nofollow noreferrer" target=_blank>#13060</a>. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/12406 rel="external nofollow noreferrer" target=_blank>#12406</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13081 rel="external nofollow noreferrer" target=_blank>#13081</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了对从本地副本进行选择的线程数的不必要限制. <a href=https://github.com/ClickHouse/ClickHouse/pull/12840 rel="external nofollow noreferrer" target=_blank>#12840</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了查询 <code class=syntax>WITH TOTALS</code> 时可能出现的数据中可能出现的额外溢出行. <a href=https://github.com/ClickHouse/ClickHouse/pull/12747 rel="external nofollow noreferrer" target=_blank>#12747</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了大元组的性能, 这些元组在 <code class=syntax>IN</code> 部分被解释为函数. 当用户出于某种晦涩的原因编写 <code class=syntax>WHERE x IN tuple(1, 2, ...)</code> 而不是 <code class=syntax>WHERE x IN (1, 2, ...)</code> 时的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/12700 rel="external nofollow noreferrer" target=_blank>#12700</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了<code class=syntax>input_format_parallel_parsing</code> 的内存跟踪（通过将线程附加到组). <a href=https://github.com/ClickHouse/ClickHouse/pull/12672 rel="external nofollow noreferrer" target=_blank>#12672</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12293 rel="external nofollow noreferrer" target=_blank>#12293</a> 当子查询包含 with 子句时允许推送谓词. <a href=https://github.com/ClickHouse/ClickHouse/pull/12663 rel="external nofollow noreferrer" target=_blank>#12663</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10572 rel="external nofollow noreferrer" target=_blank>#10572</a> 使用 const 表达式修复布隆过滤器索引. <a href=https://github.com/ClickHouse/ClickHouse/pull/12659 rel="external nofollow noreferrer" target=_blank>#12659</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了当 Broker 不可用时 (不仅如此) 在 <code class=syntax>StorageKafka</code> 中的 <code class=syntax>SIGSEGV</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12658 rel="external nofollow noreferrer" target=_blank>#12658</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加了对带有 <code class=syntax>Array(UUID)</code> 参数的函数 <code class=syntax>if</code> 的支持. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11066 rel="external nofollow noreferrer" target=_blank>#11066</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12648 rel="external nofollow noreferrer" target=_blank>#12648</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了带有缓存布局的外部字典中的竞争条件, 这可能导致服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/12566 rel="external nofollow noreferrer" target=_blank>#12566</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>删除了 DROP TABLE 上分布式表 (来自异步插入的块) 的数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/12556 rel="external nofollow noreferrer" target=_blank>#12556</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了当 <code class=syntax>enable_mixed_granularity_parts=1</code> 时, 在 <code class=syntax>ALTER DELETE</code> 查询后导致旧部件损坏的错误。 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12536 rel="external nofollow noreferrer" target=_blank>#12536</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12543 rel="external nofollow noreferrer" target=_blank>#12543</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>参数数目无效的函数 <code class=syntax>in</code> 的更好例外. <a href=https://github.com/ClickHouse/ClickHouse/pull/12529 rel="external nofollow noreferrer" target=_blank>#12529</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了性能问题, 同时读取紧凑部件. <a href=https://github.com/ClickHouse/ClickHouse/pull/12492 rel="external nofollow noreferrer" target=_blank>#12492</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了当我们通过字典键的表达式加入时, JOIN 与字典中的崩溃: <code class=syntax>t JOIN dict ON expr(dict.id) = t.id</code>. 在这种情况下禁用字典连接优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/12458 rel="external nofollow noreferrer" target=_blank>#12458</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了 StorageMerge 时可能出现的段错误. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/12054 rel="external nofollow noreferrer" target=_blank>#12054</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12401 rel="external nofollow noreferrer" target=_blank>#12401</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了 <code class=syntax>WITH FILL</code> 修饰符中列的顺序. 以前不遵守 <code class=syntax>ORDER BY</code> 语句的列顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/12306 rel="external nofollow noreferrer" target=_blank>#12306</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>当存在按虚拟列 (如 <code class=syntax>Merge</code> 表中的<code class=syntax>_table</code>) 或系统表中的 "index" 列过滤数据 (例如从 <code class=syntax>system.tables</code> 查询时按数据库名称过滤) 时, 避免 "bad cast" 异常, 并且这个表达式返回 <code class=syntax>Nullable</code> 类型. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12166 rel="external nofollow noreferrer" target=_blank>#12166</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12305 rel="external nofollow noreferrer" target=_blank>#12305</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>TrieDictionary 加载失败后显示错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/12290 rel="external nofollow noreferrer" target=_blank>#12290</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>对于可能导致崩溃的空数组, 函数 <code class=syntax>arrayFill</code> 工作不正确. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12263 rel="external nofollow noreferrer" target=_blank>#12263</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12279 rel="external nofollow noreferrer" target=_blank>#12279</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>实现了到 <code class=syntax>LowCardinality</code> 类型的通用类型的转换. 这允许对具有 LowCardinality 列和其他列的表执行 UNION ALL. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/8212 rel="external nofollow noreferrer" target=_blank>#8212</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/4342 rel="external nofollow noreferrer" target=_blank>#4342</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12275 rel="external nofollow noreferrer" target=_blank>#12275</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在某些特殊类型的 <code class=syntax>StorageFile</code> 标头中多次连续插入期间多次写入时的行为. 这个修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6155 rel="external nofollow noreferrer" target=_blank>#6155</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12197 rel="external nofollow noreferrer" target=_blank>#12197</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复了 UInt8 值不等于 0 或 1 时的逻辑函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/12196 rel="external nofollow noreferrer" target=_blank>#12196</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>上限 max_memory_usage* 对进程驻留内存的限制. <a href=https://github.com/ClickHouse/ClickHouse/pull/12182 rel="external nofollow noreferrer" target=_blank>#12182</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>在 GROUP BY 内射函数消除期间修复了 <code class=syntax>dictGet</code> 参数检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/12179 rel="external nofollow noreferrer" target=_blank>#12179</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果 ODBC 连接不支持架构，则不要将字典源的表名拆分为架构和表名本身. <a href=https://github.com/ClickHouse/ClickHouse/pull/12165 rel="external nofollow noreferrer" target=_blank>#12165</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复了 <code class=syntax>ALTER DELETE</code> 中的错误逻辑, 当条件评估为 NULL 时会导致删除记录. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9088 rel="external nofollow noreferrer" target=_blank>#9088</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/12106 rel="external nofollow noreferrer" target=_blank>#12106</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12153 rel="external nofollow noreferrer" target=_blank>#12153</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在存在别名的情况下发送到外部 DBMS (例如 MySQL、ODBC) 的查询转换. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/12032 rel="external nofollow noreferrer" target=_blank>#12032</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12151 rel="external nofollow noreferrer" target=_blank>#12151</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了整数除法中的潜在溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12119 rel="external nofollow noreferrer" target=_blank>#12119</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12140 rel="external nofollow noreferrer" target=_blank>#12140</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 <code class=syntax>greatCircleDistance</code>、<code class=syntax>geoDistance</code> 中潜在的无限循环. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12117 rel="external nofollow noreferrer" target=_blank>#12117</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12137 rel="external nofollow noreferrer" target=_blank>#12137</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>规范化 <code class=syntax>pid</code> 文件处理. 在以前的版本中, 如果服务器在没有正确关闭的情况下被杀死, 并且有另一个进程与以前运行的服务器具有相同的 pid, 则服务器可能会拒绝启动. 即使有另一台服务器正在运行, pid 文件也可能在服务器启动失败时被删除. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/3501 rel="external nofollow noreferrer" target=_blank>#3501</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12133 rel="external nofollow noreferrer" target=_blank>#12133</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了对字典的 ENGINE=Dictionary 表的处理依赖性. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/10994 rel="external nofollow noreferrer" target=_blank>#10994</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/10397 rel="external nofollow noreferrer" target=_blank>#10397</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12116 rel="external nofollow noreferrer" target=_blank>#12116</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复了由于线程总数限制错误导致的带有 <code class=syntax>UNION</code> 的选择的性能. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12030 rel="external nofollow noreferrer" target=_blank>#12030</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12103 rel="external nofollow noreferrer" target=_blank>#12103</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用 <code class=syntax>-StateResample</code> 组合器修复了段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/12092 rel="external nofollow noreferrer" target=_blank>#12092</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 <code class=syntax>system.quey_log</code> 中选择的空 <code class=syntax>result_rows</code> 和 <code class=syntax>result_bytes</code> 指标. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11595 rel="external nofollow noreferrer" target=_blank>#11595</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12089 rel="external nofollow noreferrer" target=_blank>#12089</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了从 <code class=syntax>VIEW</code> 中选择的不必要的线程数限制. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11937 rel="external nofollow noreferrer" target=_blank>#11937</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12085 rel="external nofollow noreferrer" target=_blank>#12085</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了使用错误类型 <code class=syntax>PREWHERE</code> 时可能发生的崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12053 rel="external nofollow noreferrer" target=_blank>#12053</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/12060 rel="external nofollow noreferrer" target=_blank>#12060</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12060 rel="external nofollow noreferrer" target=_blank>#12060</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了具有 <code class=syntax>LowCardinality</code> 类型的函数 <code class=syntax>defaultValueOfArgumentType</code> 的 <code class=syntax>Expected single dictionary argument for function</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11808 rel="external nofollow noreferrer" target=_blank>#11808</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12056 rel="external nofollow noreferrer" target=_blank>#12056</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了带有 <code class=syntax>Tuple(LowCardinality)</code> 参数的高阶函数的错误 <code class=syntax>Cannot capture column</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9766 rel="external nofollow noreferrer" target=_blank>#9766</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12055 rel="external nofollow noreferrer" target=_blank>#12055</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>加载数据库时并行解析表元数据. 这修复了有大量表时服务器启动缓慢的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/12045 rel="external nofollow noreferrer" target=_blank>#12045</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>使 <code class=syntax>topK</code> 聚合函数为 Enum 类型返回 Enum. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/3740 rel="external nofollow noreferrer" target=_blank>#3740</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12043 rel="external nofollow noreferrer" target=_blank>#12043</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了是否为常量表达式的约束检查. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11360 rel="external nofollow noreferrer" target=_blank>#11360</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12042 rel="external nofollow noreferrer" target=_blank>#12042</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了元组与 <code class=syntax>Nullable</code> 列的不正确比较. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11985 rel="external nofollow noreferrer" target=_blank>#11985</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12039 rel="external nofollow noreferrer" target=_blank>#12039</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 allow_introspection_functions=0 时访问权限的计算. <a href=https://github.com/ClickHouse/ClickHouse/pull/12031 rel="external nofollow noreferrer" target=_blank>#12031</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复了在调用具有不同大小的 <code class=syntax>FixedString</code> 类型参数的函数 <code class=syntax>if</code> 时出现错误结果和潜在崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11362 rel="external nofollow noreferrer" target=_blank>#11362</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12021 rel="external nofollow noreferrer" target=_blank>#12021</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果使用偏移量 <code class=syntax>-9223372036854775808</code> 调用函数, 则以函数 <code class=syntax>neighbor</code> 作为唯一返回表达式的查询可能会返回空结果. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11367 rel="external nofollow noreferrer" target=_blank>#11367</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12019 rel="external nofollow noreferrer" target=_blank>#12019</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 allow_ddl=0 时访问权限的计算. <a href=https://github.com/ClickHouse/ClickHouse/pull/12015 rel="external nofollow noreferrer" target=_blank>#12015</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复了 generateRandom 中可能导致崩溃的潜在数组大小溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11371 rel="external nofollow noreferrer" target=_blank>#11371</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12013 rel="external nofollow noreferrer" target=_blank>#12013</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了潜在的浮点异常. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11378 rel="external nofollow noreferrer" target=_blank>#11378</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12005 rel="external nofollow noreferrer" target=_blank>#12005</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了服务器启动时日志消息中错误的设置名称. <a href=https://github.com/ClickHouse/ClickHouse/pull/11997 rel="external nofollow noreferrer" target=_blank>#11997</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 <code class=syntax>Values</code> 格式中的 <code class=syntax>Query parameter was not set</code> 问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11918 rel="external nofollow noreferrer" target=_blank>#11918</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11936 rel="external nofollow noreferrer" target=_blank>#11936</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>在查询 (参数化查询) 中保留替换的别名. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11914 rel="external nofollow noreferrer" target=_blank>#11914</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11916 rel="external nofollow noreferrer" target=_blank>#11916</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了从默认存储策略更改存储策略时没有移动的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/11893 rel="external nofollow noreferrer" target=_blank>#11893</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>修复了解析 <code class=syntax>DateTime64</code> 时潜在的浮点异常. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11374 rel="external nofollow noreferrer" target=_blank>#11374</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11875 rel="external nofollow noreferrer" target=_blank>#11875</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>通过 HTTP 接口固定内存记帐 (使用 <code class=syntax>wait_end_of_query=1</code> 可能很重要). <a href=https://github.com/ClickHouse/ClickHouse/pull/11840 rel="external nofollow noreferrer" target=_blank>#11840</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>在检查相等性之前解析存储在 zookeeper 中的元数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/11739 rel="external nofollow noreferrer" target=_blank>#11739</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> </ul> <h4 id=xing-neng-gai-jin_10>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_10 title="Permanent link"> </a></h4> <ul> <li>索引不用于带文字的 IN 运算符, 在 v19.3 前后引入了性能回归. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10574 rel="external nofollow noreferrer" target=_blank>#10574</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12062 rel="external nofollow noreferrer" target=_blank>#12062</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_12>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_12 title="Permanent link"> </a></h4> <ul> <li>在 Dockerfile 中的第一个 <code class=syntax>apt-get update</code> 之前安装 <code class=syntax>ca-certificates</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12095 rel="external nofollow noreferrer" target=_blank>#12095</a> (<a href=https://github.com/blinkov rel="external nofollow noreferrer" target=_blank>Ivan Blinkov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-4-6-53-stable-2020-06-25>ClickHouse 版本 v20.4.6.53-stable 2020-06-25<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-4-6-53-stable-2020-06-25 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_29>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_29 title="Permanent link"> </a></h4> <ul> <li>修复在 prewhere 条件下使用 <code class=syntax>Nullable</code> 列导致的罕见崩溃. 续 <a href=https://github.com/ClickHouse/ClickHouse/issues/11608 rel="external nofollow noreferrer" target=_blank>#11608</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11869 rel="external nofollow noreferrer" target=_blank>#11869</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>不允许在高阶函数中使用 arrayJoin. 它导致协议同步中断. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/3933 rel="external nofollow noreferrer" target=_blank>#3933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11846 rel="external nofollow noreferrer" target=_blank>#11846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 FixedString 与常量 String 比较的错误结果. 这修复了. <a href=https://github.com/ClickHouse/ClickHouse/pull/11828 rel="external nofollow noreferrer" target=_blank>#11828</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复条件为 NULL 的 <code class=syntax>if()</code> 的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/11807 rel="external nofollow noreferrer" target=_blank>#11807</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复使用过多线程进行查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/11788 rel="external nofollow noreferrer" target=_blank>#11788</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复像 <code class=syntax>SELECT *, xyz.*</code> 这样的查询的意外行为, 这些查询在预期错误时成功. <a href=https://github.com/ClickHouse/ClickHouse/pull/11753 rel="external nofollow noreferrer" target=_blank>#11753</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>现在复制的提取将在元数据更改期间取消. <a href=https://github.com/ClickHouse/ClickHouse/pull/11744 rel="external nofollow noreferrer" target=_blank>#11744</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了由 Values 输入格式中复杂文字的错误类型推导导致的 LOGICAL_ERROR. <a href=https://github.com/ClickHouse/ClickHouse/pull/11732 rel="external nofollow noreferrer" target=_blank>#11732</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复 在 const 列上的 <code class=syntax>ORDER BY ... WITH FILL</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11697 rel="external nofollow noreferrer" target=_blank>#11697</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>与 XDBC 桥通信时传递适当的超时. 最近在检查桥接活性和接收元信息时没有遵守超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/11690 rel="external nofollow noreferrer" target=_blank>#11690</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>将 <code class=syntax>LIMIT n WITH TIES</code> 与包含别名的 <code class=syntax>ORDER BY</code> 语句一起使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/11689 rel="external nofollow noreferrer" target=_blank>#11689</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复导致 <code class=syntax>system.mutations</code> 状态不正确的错误. 它可能表明整个突变已经完成, 但服务器在复制队列中仍有 <code class=syntax>MUTATE_PART</code> 任务并尝试执行它们. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11611 rel="external nofollow noreferrer" target=_blank>#11611</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11681 rel="external nofollow noreferrer" target=_blank>#11681</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>添加对带有不区分大小写标志的正则表达式的支持. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11101 rel="external nofollow noreferrer" target=_blank>#11101</a> and fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11506 rel="external nofollow noreferrer" target=_blank>#11506</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11649 rel="external nofollow noreferrer" target=_blank>#11649</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果设置了行级安全性, 则删除琐碎的计数查询优化. 在以前的版本中, 用户获取表中记录的总数而不是过滤. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/11352 rel="external nofollow noreferrer" target=_blank>#11352</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11644 rel="external nofollow noreferrer" target=_blank>#11644</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复字符串的布隆过滤器 (数据跳过索引). <a href=https://github.com/ClickHouse/ClickHouse/pull/11638 rel="external nofollow noreferrer" target=_blank>#11638</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复在 prewhere 条件下使用 <code class=syntax>Nullable</code> 列导致的罕见崩溃. (可能它以某种方式与 <a href=https://github.com/ClickHouse/ClickHouse/issues/11572 rel="external nofollow noreferrer" target=_blank>#11572</a> 相关联). <a href=https://github.com/ClickHouse/ClickHouse/pull/11608 rel="external nofollow noreferrer" target=_blank>#11608</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复错误 <code class=syntax>Block structure mismatch</code> , 用于从 <code class=syntax>Buffer</code> 表中采样读取的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/11602 rel="external nofollow noreferrer" target=_blank>#11602</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 clickhouse-client 的错误退出代码, 当 exception.code() % 256 = 0 时. <a href=https://github.com/ClickHouse/ClickHouse/pull/11601 rel="external nofollow noreferrer" target=_blank>#11601</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复服务器启动时有关 <code class=syntax>Mark cache size was lowered</code> 的日志消息中的小错误. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11399 rel="external nofollow noreferrer" target=_blank>#11399</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11589 rel="external nofollow noreferrer" target=_blank>#11589</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复错误 <code class=syntax>Size of offsets does not match size of column</code> , 用于查询中的 <code class=syntax>PREWHERE column in (subquery)</code> 和 <code class=syntax>ARRAY JOIN</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11580 rel="external nofollow noreferrer" target=_blank>#11580</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 <code class=syntax>SHOW CREATE TABLE</code> 中罕见的段错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11490 rel="external nofollow noreferrer" target=_blank>#11490</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11579 rel="external nofollow noreferrer" target=_blank>#11579</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>HTTP 会话中的所有查询都具有相同的 query_id. 它是固定的. <a href=https://github.com/ClickHouse/ClickHouse/pull/11578 rel="external nofollow noreferrer" target=_blank>#11578</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>现在 clickhouse-server docker 容器将更喜欢 IPv6 检查服务器活动性. <a href=https://github.com/ClickHouse/ClickHouse/pull/11550 rel="external nofollow noreferrer" target=_blank>#11550</a> (<a href=https://github.com/istarkov rel="external nofollow noreferrer" target=_blank>Ivan Starkov</a>).</li> <li>修复 <code class=syntax>&lt;node&gt;</code> 的 shard_num/replica_num (破坏 use_compact_format_in_distributed_parts_names). <a href=https://github.com/ClickHouse/ClickHouse/pull/11528 rel="external nofollow noreferrer" target=_blank>#11528</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复可能导致表删除期间异常的竞争条件. 这有点棘手, 一点也不危险. 如果你想要解释, 请在电报中通知我. <a href=https://github.com/ClickHouse/ClickHouse/pull/11523 rel="external nofollow noreferrer" target=_blank>#11523</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>使用 -State 函数在聚合过程中抛出异常时修复内存泄漏. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8995 rel="external nofollow noreferrer" target=_blank>#8995</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11496 rel="external nofollow noreferrer" target=_blank>#11496</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果数据跳过索引依赖于将在后台合并期间修改的列 (对于 SummingMergeTree、AggregatingMergeTree 以及 TTL GROUP BY) , 则计算错误. 此问题已通过合并后移动索引计算得到修复, 因此索引是在合并数据上计算的. <a href=https://github.com/ClickHouse/ClickHouse/pull/11162 rel="external nofollow noreferrer" target=_blank>#11162</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>摆脱旧的 libunwind 补丁. <a href=https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012 target=_blank>https://github.com/ClickHouse-Extras/libunwind/commit/500aa227911bd185a94bfc071d68f4d3b03cb3b1#r39048012</a> 这允许在 <code class=syntax>clang</code> 中禁用 <code class=syntax>-fno-omit-frame-pointer</code> 至少 1% 的平均构建性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/10761 rel="external nofollow noreferrer" target=_blank>#10761</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>使用 <code class=syntax>FINAL</code> 修饰符和 <code class=syntax>ORDER BY</code> 优化来修复包装到函数中的主键的使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10715 rel="external nofollow noreferrer" target=_blank>#10715</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_13>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_13 title="Permanent link"> </a></h4> <ul> <li>修复单元测试中的几个非重大错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/11262 rel="external nofollow noreferrer" target=_blank>#11262</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>在 MergeTreeIndexFullText 中修复 (false) MSan 报告. 该问题首先出现在 <a href=https://github.com/ClickHouse/ClickHouse/issues/9968 rel="external nofollow noreferrer" target=_blank>#9968</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10801 rel="external nofollow noreferrer" target=_blank>#10801</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-4-5-36-stable-2020-06-10>ClickHouse 版本 v20.4.5.36-stable 2020-06-10<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-4-5-36-stable-2020-06-10 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_30>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_30 title="Permanent link"> </a></h4> <ul> <li>修复了在启用 <code class=syntax>min_bytes_to_use_direct_io</code> 且 PREWHERE 处于活动状态并使用 SAMPLE 或大量线程时可能发生的 <code class=syntax>Data compressed with different methods</code> 错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11539 rel="external nofollow noreferrer" target=_blank>#11539</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11540 rel="external nofollow noreferrer" target=_blank>#11540</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复编解码器的返回压缩大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/11448 rel="external nofollow noreferrer" target=_blank>#11448</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当列具有带有非文字参数的压缩编解码器时修复服务器崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11365 rel="external nofollow noreferrer" target=_blank>#11365</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11431 rel="external nofollow noreferrer" target=_blank>#11431</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>以 nan 为点修复 pointInPolygon. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11375 rel="external nofollow noreferrer" target=_blank>#11375</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11421 rel="external nofollow noreferrer" target=_blank>#11421</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li> <li>如果表未成功创建, 则修复 MergeTree 关闭时潜在的未初始化内存读取. <a href=https://github.com/ClickHouse/ClickHouse/pull/11420 rel="external nofollow noreferrer" target=_blank>#11420</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了带有纬度/经度范围之外的参数的 geohashesInBox. <a href=https://github.com/ClickHouse/ClickHouse/pull/11403 rel="external nofollow noreferrer" target=_blank>#11403</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>修复具有外部排序和限制的查询可能出现的 <code class=syntax>Pipeline stuck</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11359 rel="external nofollow noreferrer" target=_blank>#11359</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11366 rel="external nofollow noreferrer" target=_blank>#11366</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>在 ReplicatedMergeTree 中发送零件期间删除冗余锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/11354 rel="external nofollow noreferrer" target=_blank>#11354</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了多行模式下 clickhouse-client 对 <code class=syntax>\G</code>（垂直输出）的支持. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/9933 rel="external nofollow noreferrer" target=_blank>#9933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11350 rel="external nofollow noreferrer" target=_blank>#11350</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复使用 <code class=syntax>Lazy</code> 数据库时潜在的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/11348 rel="external nofollow noreferrer" target=_blank>#11348</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>quantilesExactWeightedArray</code> 中的崩溃问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/11337 rel="external nofollow noreferrer" target=_blank>#11337</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>现在合并在 <code class=syntax>ALTER</code> 查询中更改元数据之前停止. <a href=https://github.com/ClickHouse/ClickHouse/pull/11335 rel="external nofollow noreferrer" target=_blank>#11335</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>通过再次设置 <code class=syntax>parallel_view_processing = 1</code> 并行写入 <code class=syntax>MATERIALIZED VIEW</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11330 rel="external nofollow noreferrer" target=_blank>#11330</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当提取的 JSON 具有不平衡的 { 或 [ 字符串时, 修复visitParamExtractRaw. <a href=https://github.com/ClickHouse/ClickHouse/pull/11318 rel="external nofollow noreferrer" target=_blank>#11318</a> (<a href=https://github.com/devwout rel="external nofollow noreferrer" target=_blank>Ewout</a>).</li> <li>修复 ThreadPool 中非常罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/11314 rel="external nofollow noreferrer" target=_blank>#11314</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 clickhouse-copier 中无关紧要的数据竞争. 通过集成测试发现. <a href=https://github.com/ClickHouse/ClickHouse/pull/11313 rel="external nofollow noreferrer" target=_blank>#11313</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复转换中潜在的未初始化内存. 示例: <code class=syntax>SELECT toIntervalSecond(now64())</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11311 rel="external nofollow noreferrer" target=_blank>#11311</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了如果表的主键中有 Array 列并且查询正在使用 <code class=syntax>empty</code> 或 <code class=syntax>notEmpty</code> 函数按此列过滤时索引分析无法工作的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11286 rel="external nofollow noreferrer" target=_blank>#11286</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11303 rel="external nofollow noreferrer" target=_blank>#11303</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复当查询速度估计可能不正确时的错误, 并且如果查询受到 <code class=syntax>max_network_bandwidth</code>、<code class=syntax>max_execution_speed</code> 或 <code class=syntax>priority</code> 设置的限制, <code class=syntax>min_execution_speed</code> 的限制可能无法工作或无法正常工作. 将 <code class=syntax>timeout_before_checking_execution_speed</code> 的默认值更改为非零值, 否则设置 <code class=syntax>min_execution_speed</code> 和 <code class=syntax>max_execution_speed</code> 无效. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11297 rel="external nofollow noreferrer" target=_blank>#11297</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5732 rel="external nofollow noreferrer" target=_blank>#5732</a>。 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6228 rel="external nofollow noreferrer" target=_blank>#6228</a>. 可用性改进：避免在“clickhouse-client”中将异常消息与进度条串联. <a href=https://github.com/ClickHouse/ClickHouse/pull/11296 rel="external nofollow noreferrer" target=_blank>#11296</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复使用错误参数调用 SET DEFAULT ROLE 时的崩溃. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/10586 rel="external nofollow noreferrer" target=_blank>#10586</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11278 rel="external nofollow noreferrer" target=_blank>#11278</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复读取 Protobuf 格式错误数据时崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5957 rel="external nofollow noreferrer" target=_blank>#5957</a>, fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11203 rel="external nofollow noreferrer" target=_blank>#11203</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11258 rel="external nofollow noreferrer" target=_blank>#11258</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复了缓存字典可以返回默认值而不是正常值 (只有过期键时) 的错误. 这仅影响字符串字段. <a href=https://github.com/ClickHouse/ClickHouse/pull/11233 rel="external nofollow noreferrer" target=_blank>#11233</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复错误 <code class=syntax>Block structure mismatch in QueryPipeline</code>, 同时从内部查询中的常量读取 <code class=syntax>VIEW</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11181 rel="external nofollow noreferrer" target=_blank>#11181</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11205 rel="external nofollow noreferrer" target=_blank>#11205</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复可能的异常 <code class=syntax>Invalid status for associated output</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11200 rel="external nofollow noreferrer" target=_blank>#11200</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用 <code class=syntax>Array(Array(LowCardinality))</code> 捕获参数修复高阶函数的可能错误 <code class=syntax>Cannot capture column</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11185 rel="external nofollow noreferrer" target=_blank>#11185</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 S3 globbing 在超过 1000 个密钥和一些后端的情况下可能会失败的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/11179 rel="external nofollow noreferrer" target=_blank>#11179</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>如果数据跳过索引依赖于将在后台合并期间修改的列 (对于 SummingMergeTree、AggregatingMergeTree 以及 TTL GROUP BY), 则计算错误. 此问题已通过合并后移动索引计算得到修复, 因此索引是在合并数据上计算的. <a href=https://github.com/ClickHouse/ClickHouse/pull/11162 rel="external nofollow noreferrer" target=_blank>#11162</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复与基于限制重新安排相关的 Kafka 性能问题, 这些限制总是被应用. <a href=https://github.com/ClickHouse/ClickHouse/pull/11149 rel="external nofollow noreferrer" target=_blank>#11149</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复了在表引擎 = Kafka 的 DROP 期间 (或在服务器重新启动期间) 有时发生的挂起. <a href=https://github.com/ClickHouse/ClickHouse/pull/11145 rel="external nofollow noreferrer" target=_blank>#11145</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复简单查询过多的线程预留 (优化减少线程数量, 在管道更改后部分中断). <a href=https://github.com/ClickHouse/ClickHouse/pull/11114 rel="external nofollow noreferrer" target=_blank>#11114</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复分布式查询的谓词优化 (<code class=syntax>enable_optimize_predicate_expression=1</code>) 对于带有 <code class=syntax>HAVING</code> 部分的查询 (即需要在服务器启动器上进行过滤时), 通过保留表达式的顺序 (这足以修复), 并且还强制 聚合器在索引上使用列名. 修复: <a href=https://github.com/ClickHouse/ClickHouse/issues/10613 rel="external nofollow noreferrer" target=_blank>#10613</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/11413 rel="external nofollow noreferrer" target=_blank>#11413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10621 rel="external nofollow noreferrer" target=_blank>#10621</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_14>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_14 title="Permanent link"> </a></h4> <ul> <li>修复几个不稳定的集成测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/11355 rel="external nofollow noreferrer" target=_blank>#11355</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-4-4-18-stable-2020-05-26>ClickHouse 版本 v20.4.4.18-stable 2020-05-26<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-4-4-18-stable-2020-05-26 title="Permanent link"> </a></h3> <p>与 v20.4.3.16 稳定版相比没有变化.</p> <h3 id=clickhouse-ban-ben-v20-4-3-16-stable-2020-05-23>ClickHouse 版本 v20.4.3.16-stable 2020-05-23<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-4-3-16-stable-2020-05-23 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_31>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_31 title="Permanent link"> </a></h4> <ul> <li>如果没有最终确定, 则从突变终止任务中删除日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/11109 rel="external nofollow noreferrer" target=_blank>#11109</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 registerDiskS3 中的内存泄漏. <a href=https://github.com/ClickHouse/ClickHouse/pull/11074 rel="external nofollow noreferrer" target=_blank>#11074</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>).</li> <li>修复 Kafka 引擎表终止时可能丢失的数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/11048 rel="external nofollow noreferrer" target=_blank>#11048</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>复了 <code class=syntax>parseDateTime64BestEffort</code> 参数解析错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/11038 rel="external nofollow noreferrer" target=_blank>#11038</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>如果表未成功创建, 则修复了 <code class=syntax>MergeTree</code> 中非常罕见的潜在释放后使用错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10986 rel="external nofollow noreferrer" target=_blank>#10986</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/10970 rel="external nofollow noreferrer" target=_blank>#10970</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了原子数据库的元数据 (重命名的相对路径) 和数据 (符号链接的相对路径) 处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/10980 rel="external nofollow noreferrer" target=_blank>#10980</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了使用 <code class=syntax>Atomic</code> 数据库引擎并发 <code class=syntax>ALTER</code> 和 <code class=syntax>DROP DATABASE</code> 查询时服务器崩溃的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10968 rel="external nofollow noreferrer" target=_blank>#10968</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了 <code class=syntax>getRawData()</code> 方法中不正确的原始数据大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/10964 rel="external nofollow noreferrer" target=_blank>#10964</a> (<a href=https://github.com/ObjatieGroba rel="external nofollow noreferrer" target=_blank>Igr</a>).</li> <li>修复了 20.1 及更早版本之间两级聚合的不兼容问题. 当在发起节点和远程节点上使用不同版本的 ClickHouse 并且 GROUP BY 结果的大小很大并且由单个 String 字段执行聚合时, 就会发生这种不兼容. 结果导致单个键的多个未合并的行. <a href=https://github.com/ClickHouse/ClickHouse/pull/10952 rel="external nofollow noreferrer" target=_blank>#10952</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了通过 <code class=syntax>DistributedBlockOutputStream</code> 发送部分写入的文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/10940 rel="external nofollow noreferrer" target=_blank>#10940</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>SELECT count(notNullIn(NULL, []))</code> 中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/10920 rel="external nofollow noreferrer" target=_blank>#10920</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了在 <code class=syntax>Kafka</code> 表引擎的 <code class=syntax>DROP</code> 期间有时发生的挂起. (或在服务器重新启动期间). <a href=https://github.com/ClickHouse/ClickHouse/pull/10910 rel="external nofollow noreferrer" target=_blank>#10910</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复了无法像 <code class=syntax>a TO b, c TO a</code> 那样执行多个 <code class=syntax>ALTER RENAME</code> 的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10895 rel="external nofollow noreferrer" target=_blank>#10895</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了当您从同一列的多个线程的聚合函数状态获得结果时可能发生的竞争. 它可能发生的唯一方法是当您使用 <code class=syntax>finalizeAggregation</code> 函数同时使用 <code class=syntax>Memory</code> 引擎从表中读取时, 该引擎为 <code class=syntax>quantile*</code> 函数存储 <code class=syntax>AggregateFunction</code> 状态. <a href=https://github.com/ClickHouse/ClickHouse/pull/10890 rel="external nofollow noreferrer" target=_blank>#10890</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了与分布式表中元组的向后兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/10889 rel="external nofollow noreferrer" target=_blank>#10889</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>如果这样的键不存在, 则修复了 <code class=syntax>StringHashTable</code> 中的 <code class=syntax>SIGSEGV</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10870 rel="external nofollow noreferrer" target=_blank>#10870</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了在使用 <code class=syntax>Atomic</code> 引擎从数据库中删除 <code class=syntax>LiveView</code> 表后, <code class=syntax>WATCH</code> 挂起的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10859 rel="external nofollow noreferrer" target=_blank>#10859</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了 <code class=syntax>ReplicatedMergeTree</code> 中的错误, 该错误可能导致 <code class=syntax>OPTIMIZE</code> 查询上的某些 <code class=syntax>ALTER</code> 在它变为非活动状态后挂起等待某些副本. <a href=https://github.com/ClickHouse/ClickHouse/pull/10849 rel="external nofollow noreferrer" target=_blank>#10849</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>现在, 如果参与 <code class=syntax>CONSTRAINT</code> 表达式的列被重命名, 则约束会更新. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10844 rel="external nofollow noreferrer" target=_blank>#10844</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10847 rel="external nofollow noreferrer" target=_blank>#10847</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了缓存字典中未初始化内存的潜在读取. <a href=https://github.com/ClickHouse/ClickHouse/pull/10834 rel="external nofollow noreferrer" target=_blank>#10834</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>Block::sortColumns()</code> 之后的列顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/10826 rel="external nofollow noreferrer" target=_blank>#10826</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了当不要求引用标识符时 <code class=syntax>ODBC</code> 桥的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7984 rel="external nofollow noreferrer" target=_blank>#7984</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10821 rel="external nofollow noreferrer" target=_blank>#10821</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 <code class=syntax>DateLUT</code> 中的 <code class=syntax>UBSan</code> 和 <code class=syntax>MSan</code> 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/10798 rel="external nofollow noreferrer" target=_blank>#10798</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了关键条件下错误的类型转换. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6287 rel="external nofollow noreferrer" target=_blank>#6287</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10791 rel="external nofollow noreferrer" target=_blank>#10791</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>).</li> <li>修复了 <code class=syntax>parallel_view_processing</code> 行为. 现在, 如果发生异常, 所有对 <code class=syntax>MATERIALIZED VIEW</code> 的插入都应该无一例外地完成. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10757 rel="external nofollow noreferrer" target=_blank>#10757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>固定组合器 <code class=syntax>-OrNull</code> 和 <code class=syntax>-OrDefault</code> 与 <code class=syntax>-State</code> 结合使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10741 rel="external nofollow noreferrer" target=_blank>#10741</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>修复了函数 <code class=syntax>h3EdgeAngle</code> 中可能出现的缓冲区溢出. <a href=https://github.com/ClickHouse/ClickHouse/pull/10711 rel="external nofollow noreferrer" target=_blank>#10711</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了当表有很多部分时锁定并发更改的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10659 rel="external nofollow noreferrer" target=_blank>#10659</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>如果服务器在表启动前关闭, 则修复了 <code class=syntax>StorageBuffer</code> 中的 <code class=syntax>nullptr</code> 取消引用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10641 rel="external nofollow noreferrer" target=_blank>#10641</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>使用 <code class=syntax>LowCardinality</code> 修复了 <code class=syntax>optimize_skip_unused_shards</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/10611 rel="external nofollow noreferrer" target=_blank>#10611</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了同步突变的处理条件变量. 在某些情况下, 该条件变量的信号可能会丢失. <a href=https://github.com/ClickHouse/ClickHouse/pull/10588 rel="external nofollow noreferrer" target=_blank>#10588</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>修复了在 <code class=syntax>loadStoredObject()</code> 完成之前调用 <code class=syntax>createDictionary()</code> 时可能发生的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/10587 rel="external nofollow noreferrer" target=_blank>#10587</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复了列 <code class=syntax>ALIAS</code> 的 <code class=syntax>SELECT</code>, 它的默认表达式类型与列类型不同. <a href=https://github.com/ClickHouse/ClickHouse/pull/10563 rel="external nofollow noreferrer" target=_blank>#10563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>实现了 DateTime64 和 String 值之间的比较. <a href=https://github.com/ClickHouse/ClickHouse/pull/10560 rel="external nofollow noreferrer" target=_blank>#10560</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>默认禁用 <code class=syntax>GROUP BY</code> sharding_key优化 ( <code class=syntax>optimize_distributed_group_by_sharding_key</code> 已经被引入并默认关闭, 由于 sharding_key 分析的技巧, 简单的例子是 sharding key 中的 <code class=syntax>if</code>) 并修复它为 <code class=syntax>WITH ROLLUP/CUBE/TOTALS</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10516 rel="external nofollow noreferrer" target=_blank>#10516</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>已修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10263 rel="external nofollow noreferrer" target=_blank>#10263</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10486 rel="external nofollow noreferrer" target=_blank>#10486</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>添加了关于 <code class=syntax>max_rows_to_sort</code> 设置的测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/10268 rel="external nofollow noreferrer" target=_blank>#10268</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了创建布隆过滤器索引的向后兼容性. <a href=https://github.com/ClickHouse/ClickHouse/issues/10551 rel="external nofollow noreferrer" target=_blank>#10551</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10569 rel="external nofollow noreferrer" target=_blank>#10569</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-4-2-9-2020-05-12>ClickHouse 版本 v20.4.2.9, 2020-05-12<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-4-2-9-2020-05-12 title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng_8>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng_8 title="Permanent link"> </a></h4> <ul> <li>系统表 (例如 system.query_log、system.trace_log、system.metric_log) 对小于 10 MiB 的部分使用合并数据部分格式. 自 20.3 版起支持压缩数据部分格式. 如果你打算降级到20.3以下的版本, 你应该手动删除 <code class=syntax>/var/lib/clickhouse/data/system/</code> 中系统日志的表数据.</li> <li>当字符串比较涉及 FixedString 并且比较的参数大小不同时, 将较小的字符串填充到较大的字符串的长度进行比较. 如果我们想象 FixedString 数据类型对应于 SQL CHAR，这是为了 SQL 兼容性. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/9272 rel="external nofollow noreferrer" target=_blank>#9272</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10363 rel="external nofollow noreferrer" target=_blank>#10363</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使 SHOW CREATE TABLE 多行. 现在它更具可读性, 更像 MySQL. <a href=https://github.com/ClickHouse/ClickHouse/pull/10049 rel="external nofollow noreferrer" target=_blank>#10049</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加了在 <code class=syntax>pointInPolygon</code> 函数中使用并默认启用的设置 <code class=syntax>validate_polygons</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9857 rel="external nofollow noreferrer" target=_blank>#9857</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=xin-te-zheng_8>新特征<a class=headerlink href=../amp/#xin-te-zheng_8 title="Permanent link"> </a></h4> <ul> <li>添加对从 ClickHouse 到 Zookeeper 的安全连接的支持 <a href=https://github.com/ClickHouse/ClickHouse/pull/10184 rel="external nofollow noreferrer" target=_blank>#10184</a> (<a href=https://github.com/xzkostyan rel="external nofollow noreferrer" target=_blank>Konstantin Lebedev</a>)</li> <li>支持自定义 HTTP 处理程序。 参见 <a href=https://github.com/ClickHouse/ClickHouse/issues/5436 rel="external nofollow noreferrer" target=_blank>#5436</a> 的描述. <a href=https://github.com/ClickHouse/ClickHouse/pull/7572 rel="external nofollow noreferrer" target=_blank>#7572</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>添加 MessagePack 输入/输出格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/9889 rel="external nofollow noreferrer" target=_blank>#9889</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>)</li> <li>添加正则表达式输入格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/9196 rel="external nofollow noreferrer" target=_blank>#9196</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>)</li> <li>添加了输出格式 <code class=syntax>Markdown</code>, 用于在 Markdown 文档中嵌入表格. <a href=https://github.com/ClickHouse/ClickHouse/pull/10317 rel="external nofollow noreferrer" target=_blank>#10317</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>)</li> <li>添加了对字典中自定义设置部分的支持. 还修复了问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/2829 rel="external nofollow noreferrer" target=_blank>#2829</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10137 rel="external nofollow noreferrer" target=_blank>#10137</a> (<a href=https://github.com/kekekekule rel="external nofollow noreferrer" target=_blank>Artem Streltsov</a>)</li> <li>在 DDL 查询中为 <code class=syntax>CREATE DICTIONARY</code> 添加了自定义设置支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/10465 rel="external nofollow noreferrer" target=_blank>#10465</a> (<a href=https://github.com/kekekekule rel="external nofollow noreferrer" target=_blank>Artem Streltsov</a>)</li> <li>添加简单的服务器范围内存分析器, 当服务器内存使用率高于下一个分配阈值时, 它将收集分配上下文. <a href=https://github.com/ClickHouse/ClickHouse/pull/10444 rel="external nofollow noreferrer" target=_blank>#10444</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加设置 <code class=syntax>always_fetch_merged_part</code> 限制副本自己合并部分, 并且总是喜欢从其他副本下载. <a href=https://github.com/ClickHouse/ClickHouse/pull/10379 rel="external nofollow noreferrer" target=_blank>#10379</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加函数 <code class=syntax>JSONExtractKeysAndValuesRaw</code>, 它从JSON对象中提取原始数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/10378 rel="external nofollow noreferrer" target=_blank>#10378</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>将操作系统的内存使用添加到 <code class=syntax>system.asynchronous_metrics</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10361 rel="external nofollow noreferrer" target=_blank>#10361</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了函数 <code class=syntax>least</code> 和 <code class=syntax>greatest</code> 的通用变体. 现在它们可以处理任意数量的任意类型的参数. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/4767 rel="external nofollow noreferrer" target=_blank>#4767</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10318 rel="external nofollow noreferrer" target=_blank>#10318</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>现在, ClickHouse 在其一侧控制字典源的超时. 缓存字典配置中添加了两个新设置: <code class=syntax>strict_max_lifetime_seconds</code>，默认为 <code class=syntax>max_lifetime</code>，以及 <code class=syntax>query_wait_timeout_milliseconds</code>, 默认为一分钟. 第一个设置对于 <code class=syntax>allow_read_expired_keys</code> 设置也很有用 (禁止读取非常过期的键). <a href=https://github.com/ClickHouse/ClickHouse/pull/10337 rel="external nofollow noreferrer" target=_blank>#10337</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>添加 log_queries_min_type 以过滤哪些条目将写入 query_log. <a href=https://github.com/ClickHouse/ClickHouse/pull/10053 rel="external nofollow noreferrer" target=_blank>#10053</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加函数 <code class=syntax>isConstant</code>. 此函数检查其参数是否为常量表达式并返回 1 或 0. 用于开发、调试和演示目的. <a href=https://github.com/ClickHouse/ClickHouse/pull/10198 rel="external nofollow noreferrer" target=_blank>#10198</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加 joinGetOrNull 以在 key 丢失时返回 NULL 而不是返回默认值. <a href=https://github.com/ClickHouse/ClickHouse/pull/10094 rel="external nofollow noreferrer" target=_blank>#10094</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>如果设置了选项 <code class=syntax>transform_null_in</code>, 则认为 <code class=syntax>NULL</code> 等于 <code class=syntax>IN</code> 运算符中的 <code class=syntax>NULL</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10085 rel="external nofollow noreferrer" target=_blank>#10085</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li> <li>为 MergeTree 表引擎系列添加 <code class=syntax>ALTER TABLE ... RENAME COLUMN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9948 rel="external nofollow noreferrer" target=_blank>#9948</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>支持并行分布式 INSERT SELECT. <a href=https://github.com/ClickHouse/ClickHouse/pull/9759 rel="external nofollow noreferrer" target=_blank>#9759</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>)</li> <li>添加在分布式上查询分布式的能力 (不带 <code class=syntax>distributed_group_by_no_merge</code>) ... <a href=https://github.com/ClickHouse/ClickHouse/pull/9923 rel="external nofollow noreferrer" target=_blank>#9923</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加函数 <code class=syntax>arrayReduceInRanges</code> , 它聚合给定范围内的数组元素. <a href=https://github.com/ClickHouse/ClickHouse/pull/9598 rel="external nofollow noreferrer" target=_blank>#9598</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>在 prometheus 导出器上添加字典状态. <a href=https://github.com/ClickHouse/ClickHouse/pull/9622 rel="external nofollow noreferrer" target=_blank>#9622</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>添加函数 <code class=syntax>arrayAUC</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8698 rel="external nofollow noreferrer" target=_blank>#8698</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>)</li> <li>支持 <code class=syntax>DROP VIEW</code> 语句以获得更好的TPC-H兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/9831 rel="external nofollow noreferrer" target=_blank>#9831</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>将 <code class=syntax>strict_order</code> 选项添加到 windowFunnel(). <a href=https://github.com/ClickHouse/ClickHouse/pull/9773 rel="external nofollow noreferrer" target=_blank>#9773</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li> <li>支持 <code class=syntax>DATE</code> 和 <code class=syntax>TIMESTAMP</code> SQL 操作符, 例如 <code class=syntax>选择日期'2001-01-01'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9691 rel="external nofollow noreferrer" target=_blank>#9691</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> </ul> <h4 id=shi-yan-gong-neng_6>实验功能<a class=headerlink href=../amp/#shi-yan-gong-neng_6 title="Permanent link"> </a></h4> <ul> <li>添加了实验性数据库引擎 Atomic. 它支持非阻塞 <code class=syntax>DROP</code> 和 <code class=syntax>RENAME TABLE</code> 查询以及原子 <code class=syntax>EXCHANGE TABLES t1 AND t2</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/7512 rel="external nofollow noreferrer" target=_blank>#7512</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>对 S3 上的 ReplicatedMergeTree 的初始支持 (它以次优方式工作). <a href=https://github.com/ClickHouse/ClickHouse/pull/10126 rel="external nofollow noreferrer" target=_blank>#10126</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li> </ul> <h4 id=bug-xiu-fu_32>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_32 title="Permanent link"> </a></h4> <ul> <li>修复了 <code class=syntax>MATERIALIZED VIEW</code> 内部查询中不正确的标量结果, 以防该查询包含相关表. <a href=https://github.com/ClickHouse/ClickHouse/pull/10603 rel="external nofollow noreferrer" target=_blank>#10603</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了当 <code class=syntax>readonly=2</code> 和 <code class=syntax>cancel_http_readonly_queries_on_client_close=1</code> 时导致 HTTP 请求卡在客户端关闭连接上的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10684 rel="external nofollow noreferrer" target=_blank>#10684</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>在服务器启动时抛出异常时修复 StorageBuffer 中的段错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10550 rel="external nofollow noreferrer" target=_blank>#10550</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10609 rel="external nofollow noreferrer" target=_blank>#10609</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>查询 <code class=syntax>SYSTEM DROP DNS CACHE</code> 现在还删除用于检查是否允许用户从某些 IP 地址连接的缓存. <a href=https://github.com/ClickHouse/ClickHouse/pull/10608 rel="external nofollow noreferrer" target=_blank>#10608</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复在一个查询中使用多个具有相同集合的 <code class=syntax>IN</code> 运算符. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10539 rel="external nofollow noreferrer" target=_blank>#10539</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10686 rel="external nofollow noreferrer" target=_blank>#10686</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>使用嵌套类型修复 <code class=syntax>generateRandom</code> 中的崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10583 rel="external nofollow noreferrer" target=_blank>#10583</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10734 rel="external nofollow noreferrer" target=_blank>#10734</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复合并后可能发生的 <code class=syntax>SummingMergeTree</code> 中 <code class=syntax>LowCardinality(FixedString)</code> 键列的数据损坏. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10489 rel="external nofollow noreferrer" target=_blank>#10489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10721 rel="external nofollow noreferrer" target=_blank>#10721</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复 aggregation_memory_efficient_merge_threads 设置的逻辑. <a href=https://github.com/ClickHouse/ClickHouse/pull/10667 rel="external nofollow noreferrer" target=_blank>#10667</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>)</li> <li>修复消失的总数. 如果查询具有 <code class=syntax>JOIN</code> 或带有外部 <code class=syntax>WHERE</code> 条件的子查询, 则总计可能被过滤。 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/10674 rel="external nofollow noreferrer" target=_blank>#10674</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10698 rel="external nofollow noreferrer" target=_blank>#10698</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复启用了 <code class=syntax>distributed_aggregation_memory_efficient</code> 的远程查询缺乏并行执行的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10655 rel="external nofollow noreferrer" target=_blank>#10655</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10664 rel="external nofollow noreferrer" target=_blank>#10664</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>使用 <code class=syntax>LIMIT</code> 修复查询的可能不正确的行数. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10566 rel="external nofollow noreferrer" target=_blank>#10566</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10709 rel="external nofollow noreferrer" target=_blank>#10709</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10660 rel="external nofollow noreferrer" target=_blank>#10660</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复索引损坏, 在某些情况下将合并部分合并到另一个合并部分后可能会发生这种情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/10531 rel="external nofollow noreferrer" target=_blank>#10531</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复当mutation完成所有部分, 但在 <code class=syntax>is_done=0</code> 中挂掉的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/10526 rel="external nofollow noreferrer" target=_blank>#10526</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复 unix 纪元开始时与 UTC 有小数偏移的时区的溢出. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9335 rel="external nofollow noreferrer" target=_blank>#9335</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10513 rel="external nofollow noreferrer" target=_blank>#10513</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>更好的输入格式诊断. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10204 rel="external nofollow noreferrer" target=_blank>#10204</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10418 rel="external nofollow noreferrer" target=_blank>#10418</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复 <code class=syntax>simpleLinearRegression()</code> 中大整数上的数字溢出. <a href=https://github.com/ClickHouse/ClickHouse/pull/10474 rel="external nofollow noreferrer" target=_blank>#10474</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>修复分布式关闭中的use-after-free, 避免等待发送所有批次 <a href=https://github.com/ClickHouse/ClickHouse/pull/10491 rel="external nofollow noreferrer" target=_blank>#10491</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>将 CA 证书添加到 clickhouse-server docker 镜像. <a href=https://github.com/ClickHouse/ClickHouse/pull/10476 rel="external nofollow noreferrer" target=_blank>#10476</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复使用 <code class=syntax>addressToLine</code> 函数或 AggregateFunctionState 列时可能发生的罕见无限循环. <a href=https://github.com/ClickHouse/ClickHouse/pull/10466 rel="external nofollow noreferrer" target=_blank>#10466</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>在分布式查询期间处理zookeeper <code class=syntax>no node error</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10050 rel="external nofollow noreferrer" target=_blank>#10050</a> (<a href=https://github.com/Phantomape rel="external nofollow noreferrer" target=_blank>Daniel Chen</a>)</li> <li>修复更改列的默认值后服务器无法附加表的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10441 rel="external nofollow noreferrer" target=_blank>#10441</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>将默认表达式类型隐式转换为 ALIAS 列的列类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/10563 rel="external nofollow noreferrer" target=_blank>#10563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>如果 <code class=syntax>ATTACH DATABASE</code> 失败, 不要删除元数据目录. <a href=https://github.com/ClickHouse/ClickHouse/pull/10442 rel="external nofollow noreferrer" target=_blank>#10442</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>避免依赖系统 tzdata. 修复了在 CentOS 8 上加载 <code class=syntax>Africa/Casablanca</code> 时区的问题. <a href=https://github.com/ClickHouse/ClickHouse/issues/10211 rel="external nofollow noreferrer" target=_blank>#10211</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10425 rel="external nofollow noreferrer" target=_blank>#10425</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>如果数据以仲裁插入然后被删除 (DROP PARTITION、TTL 等), 则修复一些问题. 它导致在 SELECT 中卡住 INSERT 或误报异常. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9946 rel="external nofollow noreferrer" target=_blank>#9946</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10188 rel="external nofollow noreferrer" target=_blank>#10188</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>创建 BloomFilter 索引时检查参数的数量和类型 <a href=https://github.com/ClickHouse/ClickHouse/issues/9623 rel="external nofollow noreferrer" target=_blank>#9623</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10431 rel="external nofollow noreferrer" target=_blank>#10431</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>更喜欢 <code class=syntax>fallback_to_stale_replicas</code> 而不是 <code class=syntax>skip_unavailable_shards</code> , 否则当两个设置都指定并且没有最新的副本时, 查询将失败 (来自@alex-zaitsev的补丁 ). <a href=https://github.com/ClickHouse/ClickHouse/pull/10422 rel="external nofollow noreferrer" target=_blank>#10422</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复带有 ARRAY JOIN、ORDER BY 和 LIMIT 的查询可能返回不完整结果的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10226 rel="external nofollow noreferrer" target=_blank>#10226</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10427 rel="external nofollow noreferrer" target=_blank>#10427</a> (<a href=https://github.com/VadimPlh rel="external nofollow noreferrer" target=_blank>Vadim Plakhtinskiy</a>)</li> <li>在 DETACH/ATTACH 之后将数据库名称添加到字典名称. 修复 system.dictionaries 表和 <code class=syntax>SYSTEM RELOAD</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/10415 rel="external nofollow noreferrer" target=_blank>#10415</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复处理器管道中极端情况可能导致的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/10131 rel="external nofollow noreferrer" target=_blank>#10131</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复启用设置 <code class=syntax>distributed_group_by_no_merge</code> 时可能出现的段错误 (在 20.3.7.46 中由 <a href=https://github.com/ClickHouse/ClickHouse/issues/10131 rel="external nofollow noreferrer" target=_blank>#10131</a> 引入). <a href=https://github.com/ClickHouse/ClickHouse/pull/10399 rel="external nofollow noreferrer" target=_blank>#10399</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复 <code class=syntax>Array(Tuple(...))</code> 数据类型的错误扁平化. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10259 rel="external nofollow noreferrer" target=_blank>#10259</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10390 rel="external nofollow noreferrer" target=_blank>#10390</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 JOIN 内的常量列名可能与 JOIN 外的常量名冲突. <a href=https://github.com/ClickHouse/ClickHouse/pull/9950 rel="external nofollow noreferrer" target=_blank>#9950</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>在 Block::sortColumns() 之后修复列的顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/10826 rel="external nofollow noreferrer" target=_blank>#10826</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复 <code class=syntax>ConcatProcessor</code> 中可能发生的 <code class=syntax>Pipeline stuck</code> 错误，该错误可能在远程查询中发生. <a href=https://github.com/ClickHouse/ClickHouse/pull/10381 rel="external nofollow noreferrer" target=_blank>#10381</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>不要为聚合预留磁盘. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9241 rel="external nofollow noreferrer" target=_blank>#9241</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10375 rel="external nofollow noreferrer" target=_blank>#10375</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复了时区的日期时间函数的错误行为, 这些时区在 UTC 的正负偏移量之间发生了变化 (例如 Pacific/Kiritimati). 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7202 rel="external nofollow noreferrer" target=_blank>#7202</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10369 rel="external nofollow noreferrer" target=_blank>#10369</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>避免在 <code class=syntax>dictIsIn</code> 函数中出现无限循环. 修复 #515. <a href=https://github.com/ClickHouse/ClickHouse/pull/10365 rel="external nofollow noreferrer" target=_blank>#10365</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>默认禁用 GROUP BY sharding_key 优化并修复 WITH ROLLUP/CUBE/TOTALS. <a href=https://github.com/ClickHouse/ClickHouse/pull/10516 rel="external nofollow noreferrer" target=_blank>#10516</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>检查零件时检查错误代码, 如果错误类似于 <code class=syntax>not enough memory</code>, 请不要将零件标记为损坏. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6269 rel="external nofollow noreferrer" target=_blank>#6269</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10364 rel="external nofollow noreferrer" target=_blank>#10364</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在系统表中显示有关未加载词典的信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/10234 rel="external nofollow noreferrer" target=_blank>#10234</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>如果服务器在表启动前关闭, 则修复 StorageBuffer 中的 nullptr 取消引用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10641 rel="external nofollow noreferrer" target=_blank>#10641</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 <code class=syntax>ReplicatedMergeTree</code> 中的 <code class=syntax>DROP</code> 与 <code class=syntax>OPTIMIZE</code> 竞赛. 如果存在并发的 OPTIMIZE 查询, 则 DROP 可能会在 ZooKeeper 的副本路径中留下一些垃圾. <a href=https://github.com/ClickHouse/ClickHouse/pull/10312 rel="external nofollow noreferrer" target=_blank>#10312</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复 <code class=syntax>Logical error: CROSS JOIN has expressions</code> 错误, 用于使用逗号和名称连接混合的查询. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9910 rel="external nofollow noreferrer" target=_blank>#9910</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10311 rel="external nofollow noreferrer" target=_blank>#10311</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>使用 <code class=syntax>max_bytes_before_external_group_by</code> 修复查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/10302 rel="external nofollow noreferrer" target=_blank>#10302</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复在某些情况下限制解析器中最大递归深度的问题. 此修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10283 rel="external nofollow noreferrer" target=_blank>#10283</a> 此修复可能会引入轻微的不兼容性: 通过 clickhouse-client 进行长时间和深度查询可能会拒绝工作, 您应该调整设置 <code class=syntax>max_query_size</code> 和 <code class=syntax>max_parser_depth</code> 相应. <a href=https://github.com/ClickHouse/ClickHouse/pull/10295 rel="external nofollow noreferrer" target=_blank>#10295</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>允许对多个 JOIN 使用 <code class=syntax>count(*)</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9853 rel="external nofollow noreferrer" target=_blank>#9853</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10291 rel="external nofollow noreferrer" target=_blank>#10291</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>使用 <code class=syntax>max_rows_to_group_by</code> 和 <code class=syntax>group_by_overflow_mode = 'break'</code> 修复错误 <code class=syntax>Pipeline stuck</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10279 rel="external nofollow noreferrer" target=_blank>#10279</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复使用 DDL 查询创建 <code class=syntax>range_hashed</code> 字典时出现的 <code class=syntax>Cannot add column</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10093 rel="external nofollow noreferrer" target=_blank>#10093</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10235 rel="external nofollow noreferrer" target=_blank>#10235</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复罕见的可能异常 <code class=syntax>Cannot drain connections: cancel first</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10239 rel="external nofollow noreferrer" target=_blank>#10239</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了 ClickHouse 会抛出 <code class=syntax>Unknown function lambda</code> 的错误. 当用户尝试在 ENGINE = Replicated* 的表上运行 ALTER UPDATE/DELETE 时出现错误消息. 检查非确定性函数现在可以正确处理 lambda 表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/10237 rel="external nofollow noreferrer" target=_blank>#10237</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>修复了当 SELECT ... FROM system.tables 在具有惰性引擎的数据库上运行时发生的 StorageSystemTables 中相当罕见的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10209 rel="external nofollow noreferrer" target=_blank>#10209</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>当查询实际上应该在 LIMIT 停止时, 修复可能的无限查询执行, 同时从无限源 (如 <code class=syntax>system.numbers</code> 或 <code class=syntax>system.zeros</code> )读取. <a href=https://github.com/ClickHouse/ClickHouse/pull/10206 rel="external nofollow noreferrer" target=_blank>#10206</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了 Date 类型的 <code class=syntax>generateRandom</code> 函数. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9973 rel="external nofollow noreferrer" target=_blank>#9973</a>. 修复了将 2106 年的日期插入到使用旧式分区的 MergeTree 表但分区以 1970 年命名的边缘情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/10218 rel="external nofollow noreferrer" target=_blank>#10218</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>如果 View 的表定义与 SELECT 查询不对应, 则转换类型. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10180 rel="external nofollow noreferrer" target=_blank>#10180</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/10022 rel="external nofollow noreferrer" target=_blank>#10022</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10217 rel="external nofollow noreferrer" target=_blank>#10217</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 RFC-2822 中字符串的 <code class=syntax>parseDateTimeBestEffort</code>, 当一周中的某一天是星期二或星期四时. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10082 rel="external nofollow noreferrer" target=_blank>#10082</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10214 rel="external nofollow noreferrer" target=_blank>#10214</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 JOIN 内的常量列名可能与 JOIN 外的常量名冲突. <a href=https://github.com/ClickHouse/ClickHouse/pull/10207 rel="external nofollow noreferrer" target=_blank>#10207</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在存在数组连接函数的情况下修复移动到前置位置优化 (在某些情况下). 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/10092 rel="external nofollow noreferrer" target=_blank>#10092</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10195 rel="external nofollow noreferrer" target=_blank>#10195</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复本机 mysql-connector-java (JDBC) 的 SCRAMBLE 中出现分隔符的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10140 rel="external nofollow noreferrer" target=_blank>#10140</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>)</li> <li>修复未指定数据库时使用当前数据库进行访问检查的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10192 rel="external nofollow noreferrer" target=_blank>#10192</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>用合并部分修复表的 ALTER. <a href=https://github.com/ClickHouse/ClickHouse/pull/10130 rel="external nofollow noreferrer" target=_blank>#10130</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>添加了通过 <code class=syntax>allow_nondeterministic_mutations</code> 设置放宽对突变中非确定性函数使用限制的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/10186 rel="external nofollow noreferrer" target=_blank>#10186</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复字典调用 <code class=syntax>DROP TABLE</code> 的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10165 rel="external nofollow noreferrer" target=_blank>#10165</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>如果在将 <code class=syntax>INSERT</code> 插入分布式表时结构不匹配, 则转换块. <a href=https://github.com/ClickHouse/ClickHouse/pull/10135 rel="external nofollow noreferrer" target=_blank>#10135</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>当插入的块被带有分区键的部分分割时，记录的行数不正确 (作为所有部分的总和). <a href=https://github.com/ClickHouse/ClickHouse/pull/10138 rel="external nofollow noreferrer" target=_blank>#10138</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为 MySQL 数据库引擎添加一些参数检查和支持标识符参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/10077 rel="external nofollow noreferrer" target=_blank>#10077</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>在创建新副本时修复不正确的 <code class=syntax>index_granularity_bytes</code> 检查. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10098 rel="external nofollow noreferrer" target=_blank>#10098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10121 rel="external nofollow noreferrer" target=_blank>#10121</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>当表包含跳过索引时, 修复 <code class=syntax>CHECK TABLE</code> 查询中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10068 rel="external nofollow noreferrer" target=_blank>#10068</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复嵌套表中只有一个分片的 Distributed-over-Distributed 问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/9997 rel="external nofollow noreferrer" target=_blank>#9997</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>使用 <code class=syntax>JOIN</code> 和 <code class=syntax>UNION ALL</code> 修复查询可能丢失的行. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9826 rel="external nofollow noreferrer" target=_blank>#9826</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10113 rel="external nofollow noreferrer" target=_blank>#10113</a>. ... <a href=https://github.com/ClickHouse/ClickHouse/pull/10099 rel="external nofollow noreferrer" target=_blank>#10099</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复使用本地 clickhouse 服务器作为源时字典中的错误. 如果字典和源中的类型不兼容, 可能会导致内存损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/10071 rel="external nofollow noreferrer" target=_blank>#10071</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了从不存在 <code class=syntax>/table/replicas/replica_name/metadata</code> 节点的旧 ClickHouse 版本更新时复制表启动的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10037 rel="external nofollow noreferrer" target=_blank>#10037</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10095 rel="external nofollow noreferrer" target=_blank>#10095</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复错误 <code class=syntax>Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code> . 当设置 <code class=syntax>distributed_aggregation_memory_efficient</code> 被启用, 并且分布式查询从不同分片读取混合单级和二级聚合的聚合数据时发生这种情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/10063 rel="external nofollow noreferrer" target=_blank>#10063</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复具有实体化视图的数据库在启动时附加失败时的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/10054 rel="external nofollow noreferrer" target=_blank>#10054</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复 GROUP BY 中可能发生的分段错误，该错误是包含尾随零字节的字符串键 (<a href=https://github.com/ClickHouse/ClickHouse/issues/8636 rel="external nofollow noreferrer" target=_blank>#8636</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/8925 rel="external nofollow noreferrer" target=_blank>#8925</a>). ... <a href=https://github.com/ClickHouse/ClickHouse/pull/10025 rel="external nofollow noreferrer" target=_blank>#10025</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>当别名可以覆盖限定的列名时, 修复分布式查询的错误结果. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9672 rel="external nofollow noreferrer" target=_blank>#9672</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/9714 rel="external nofollow noreferrer" target=_blank>#9714</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9972 rel="external nofollow noreferrer" target=_blank>#9972</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复 <code class=syntax>SYSTEM RESTART REPLICAS</code> 中可能出现的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/9955 rel="external nofollow noreferrer" target=_blank>#9955</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复用于远程查询执行的线程数 (性能回归, 自 20.3 起). 当来自 <code class=syntax>Distributed</code> 表的查询在本地和远程分片上同时执行时, 就会发生这种情况. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9965 rel="external nofollow noreferrer" target=_blank>#9965</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9971 rel="external nofollow noreferrer" target=_blank>#9971</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了 <code class=syntax>ATTACH PART</code> 中的 <code class=syntax>DeleteOnDestroy</code> 逻辑, 这可能导致自动删除附加部分并添加了一些测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/9410 rel="external nofollow noreferrer" target=_blank>#9410</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复 <code class=syntax>ON CLUSTER</code> DDL 查询在服务器启动时冻结的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9927 rel="external nofollow noreferrer" target=_blank>#9927</a> (<a href=https://github.com/garneja rel="external nofollow noreferrer" target=_blank>Gagan Arneja</a>)</li> <li>修复了在某些数据库查询的处理阶段之一未检索到必要表的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9699 rel="external nofollow noreferrer" target=_blank>#9699</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9949 rel="external nofollow noreferrer" target=_blank>#9949</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>)</li> <li>修复 <code class=syntax>JOIN</code> 与 <code class=syntax>TOTALS</code> 一起出现时 Not found column in block 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9839 rel="external nofollow noreferrer" target=_blank>#9839</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9939 rel="external nofollow noreferrer" target=_blank>#9939</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复解析 CREATE USER 命令中设置的多个主机. <a href=https://github.com/ClickHouse/ClickHouse/pull/9924 rel="external nofollow noreferrer" target=_blank>#9924</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复连接表引擎的 <code class=syntax>TRUNCATE</code>. (<a href=https://github.com/ClickHouse/ClickHouse/issues/9917 rel="external nofollow noreferrer" target=_blank>#9917</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9920 rel="external nofollow noreferrer" target=_blank>#9920</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复 <code class=syntax>ReplicatedMergeTree</code> 中删除和优化之间的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/9901 rel="external nofollow noreferrer" target=_blank>#9901</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>当设置了 <code class=syntax>optimize_skip_unused_shards</code> 时, 修复分布式的 <code class=syntax>DISTINCT</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9808 rel="external nofollow noreferrer" target=_blank>#9808</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复 ALTER 中的 <code class=syntax>scalar does not exist</code> 错误 (<a href=https://github.com/ClickHouse/ClickHouse/issues/9878 rel="external nofollow noreferrer" target=_blank>#9878</a>). ... <a href=https://github.com/ClickHouse/ClickHouse/pull/9904 rel="external nofollow noreferrer" target=_blank>#9904</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复 <code class=syntax>distributed_product_mode=\'local\'</code> 中的限定名称错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/4756 rel="external nofollow noreferrer" target=_blank>#4756</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9891 rel="external nofollow noreferrer" target=_blank>#9891</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>对于 INSERT 查询, 分片现在确实将启动器的设置限制到它们的约束, 而不是抛出异常. 此修复允许将 INSERT 查询发送到具有其他约束的分片. 此更改改进了修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9447 rel="external nofollow noreferrer" target=_blank>#9447</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9852 rel="external nofollow noreferrer" target=_blank>#9852</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>在向 Kafka 代理提交偏移量时添加一些重试, 因为如果在 <code class=syntax>offsets.commit.timeout.ms</code> 期间没有足够的副本可用于 <code class=syntax>__consumer_offsets</code> 主题, 它可以拒绝提交. <a href=https://github.com/ClickHouse/ClickHouse/pull/9884 rel="external nofollow noreferrer" target=_blank>#9884</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复在 <code class=syntax>WHERE</code> 中使用基础表的虚拟列时的分布式引擎行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/9847 rel="external nofollow noreferrer" target=_blank>#9847</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复了函数参数的时区使用不正确的一些情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/9574 rel="external nofollow noreferrer" target=_blank>#9574</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>当查询在分布式表上具有 PREWHERE 和 WHERE 并且 <code class=syntax>SET分布式产品模式 = 'local'</code> 时, 修复 <code class=syntax>Different expressions with the same alias</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9871 rel="external nofollow noreferrer" target=_blank>#9871</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复具有复合主键的表的突变过多的内存消耗. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9850 rel="external nofollow noreferrer" target=_blank>#9850</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9860 rel="external nofollow noreferrer" target=_blank>#9860</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了从设置 <code class=syntax>allow_introspection_functions</code> 计算内省函数的授权. <a href=https://github.com/ClickHouse/ClickHouse/pull/9840 rel="external nofollow noreferrer" target=_blank>#9840</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复 max_distributed_connections (带和不带处理器) <a href=https://github.com/ClickHouse/ClickHouse/pull/9673 rel="external nofollow noreferrer" target=_blank>#9673</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复客户端上可能出现的异常 <code class=syntax>Got 0 in totals chunk, expected 1</code> . 如果右连接表有零行, 则使用 <code class=syntax>JOIN</code> 进行查询时会发生这种情况. 示例: <code class=syntax>select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9777 rel="external nofollow noreferrer" target=_blank>#9777</a>. ... <a href=https://github.com/ClickHouse/ClickHouse/pull/9823 rel="external nofollow noreferrer" target=_blank>#9823</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复 <code class=syntax>COMMA to CROSS JOIN rewriter is not enabled or cannot rewrite query</code> 错误, 以防在表列表中使用 COMMA JOIN 进行子查询 (即在 WHERE 中). 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9782 rel="external nofollow noreferrer" target=_blank>#9782</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9830 rel="external nofollow noreferrer" target=_blank>#9830</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了设置 <code class=syntax>optimize_skip_unused_shards</code> 时服务器崩溃并且键的表达式无法转换为其字段类型的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/9804 rel="external nofollow noreferrer" target=_blank>#9804</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复 <code class=syntax>splitByString</code> 中的空字符串处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/9767 rel="external nofollow noreferrer" target=_blank>#9767</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>修复损坏的 <code class=syntax>ALTER TABLE DELETE COLUMN</code> 查询合并部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/9779 rel="external nofollow noreferrer" target=_blank>#9779</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了通过 http (使用处理器管道) 查询时缺少的 <code class=syntax>rows_before_limit_at_least</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9730 rel="external nofollow noreferrer" target=_blank>#9730</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9757 rel="external nofollow noreferrer" target=_blank>#9757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复 <code class=syntax>ALTER</code> 查询 (突变) 中的过多内存消耗. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9533 rel="external nofollow noreferrer" target=_blank>#9533</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/9670 rel="external nofollow noreferrer" target=_blank>#9670</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9754 rel="external nofollow noreferrer" target=_blank>#9754</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复可能的永久性 <code class=syntax>Cannot schedule a task</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9154 rel="external nofollow noreferrer" target=_blank>#9154</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复外部字典 DDL 中反引号的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9619 rel="external nofollow noreferrer" target=_blank>#9619</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9734 rel="external nofollow noreferrer" target=_blank>#9734</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>text_log</code> 中的数据竞争. 它不对应任何真正的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9726 rel="external nofollow noreferrer" target=_blank>#9726</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复复制中的错误, 如果用户在以前的版本上执行了更改, 则不允许复制工作. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9645 rel="external nofollow noreferrer" target=_blank>#9645</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9652 rel="external nofollow noreferrer" target=_blank>#9652</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>sumKahan</code> 和 <code class=syntax>sumWithOverflow</code> 不正确的内部函数名称. 在远程查询中使用此函数时导致异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/9636 rel="external nofollow noreferrer" target=_blank>#9636</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加设置 <code class=syntax>use_compact_format_in_distributed_parts_names</code>, 它允许将<code class=syntax>INSERT</code> 查询的文件以更紧凑的格式写入 <code class=syntax>Distributed</code> 表. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9647 rel="external nofollow noreferrer" target=_blank>#9647</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9653 rel="external nofollow noreferrer" target=_blank>#9653</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>在 JOIN 键中使用低基数修复 RIGHT 和 FULL JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/9610 rel="external nofollow noreferrer" target=_blank>#9610</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复 <code class=syntax>MergeTreeRangeReader</code> 中可能出现的异常 <code class=syntax>Size of filter does not match size of column</code> and <code class=syntax>Invalid number of rows in Chunk</code> 和 <code class=syntax>Invalid number of rows in Chunk</code>. 在某些情况下, 它们可能会在执行 <code class=syntax>PREWHERE</code> 时出现. <a href=https://github.com/ClickHouse/ClickHouse/pull/9612 rel="external nofollow noreferrer" target=_blank>#9612</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>允许具有内部复制的分布式表的 <code class=syntax>ALTER ON CLUSTER</code>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/3268 rel="external nofollow noreferrer" target=_blank>#3268</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9617 rel="external nofollow noreferrer" target=_blank>#9617</a> (<a href=https://github.com/shinoi2 rel="external nofollow noreferrer" target=_blank>shinoi2</a>)</li> <li>如果您编写像 <code class=syntax>time + 1</code> 这样的简单算术表达式 (与像 <code class=syntax>time + INTERVAL 1 SECOND</code> 这样的表达式相反), 则修复了未保留时区的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5743 rel="external nofollow noreferrer" target=_blank>#5743</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9323 rel="external nofollow noreferrer" target=_blank>#9323</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=gai-jin_16>改进<a class=headerlink href=../amp/#gai-jin_16 title="Permanent link"> </a></h4> <ul> <li>将 DateTime 与字符串文字进行比较时使用时区. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5206 rel="external nofollow noreferrer" target=_blank>#5206</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10515 rel="external nofollow noreferrer" target=_blank>#10515</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>如果无法从文本输入格式解析 Decimal 值, 则打印详细的诊断信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/10205 rel="external nofollow noreferrer" target=_blank>#10205</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为分布式/缓冲调度池添加任务/内存指标. <a href=https://github.com/ClickHouse/ClickHouse/pull/10449 rel="external nofollow noreferrer" target=_blank>#10449</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>一旦准备好在 clickhouse-local 和 HTTP 接口中进行 SELECT DISTINCT 查询, 就立即显示结果. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8951 rel="external nofollow noreferrer" target=_blank>#8951</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9559 rel="external nofollow noreferrer" target=_blank>#9559</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>允许使用 <code class=syntax>SAMPLE OFFSET</code> 查询代替 <code class=syntax>cityHash64(PRIMARY KEY) % N == n</code> 在 <code class=syntax>clickhouse-copier</code> 中进行拆分. 要使用此功能, 请将 <code class=syntax>--experimental-use-sample-offset 1</code> 作为命令行参数传递. <a href=https://github.com/ClickHouse/ClickHouse/pull/10414 rel="external nofollow noreferrer" target=_blank>#10414</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>如果第一列的值中不能包含 BOM, 则允许在 TSV 中解析 BOM. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10301 rel="external nofollow noreferrer" target=_blank>#10301</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10424 rel="external nofollow noreferrer" target=_blank>#10424</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加 Avro 嵌套字段插入支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/10354 rel="external nofollow noreferrer" target=_blank>#10354</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li> <li>指定相同类型时, 允许在非修改数据模式下更改列. <a href=https://github.com/ClickHouse/ClickHouse/pull/10382 rel="external nofollow noreferrer" target=_blank>#10382</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>在 GROUP BY 分片键上自动 <code class=syntax>distributed_group_by_no_merge</code> (如果设置了 <code class=syntax>optimize_skip_unused_shards</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10341 rel="external nofollow noreferrer" target=_blank>#10341</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>使用 LIMIT/LIMIT BY/ORDER BY 优化查询以使用 GROUP BY sharding_key 进行分布式. <a href=https://github.com/ClickHouse/ClickHouse/pull/10373 rel="external nofollow noreferrer" target=_blank>#10373</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加了设置 <code class=syntax>max_server_memory_usage</code> 以限制服务器的总内存使用量. 现在计算指标 <code class=syntax>MemoryTracking</code> 没有漂移. 设置 <code class=syntax>max_memory_usage_for_all_queries</code> 现在已经过时并且什么都不做. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/10293 rel="external nofollow noreferrer" target=_blank>#10293</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10362 rel="external nofollow noreferrer" target=_blank>#10362</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加配置选项 <code class=syntax>system_tables_lazy_load</code>. 如果设置为 false, 则在服务器启动时加载带有日志的系统表. <a href=https://github.com/Alex-Burmak rel="external nofollow noreferrer" target=_blank>Alexander Burmak</a>, <a href=https://github.com/DeifyTheGod rel="external nofollow noreferrer" target=_blank>Svyatoslav Tkhon Il Pak</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/9642 rel="external nofollow noreferrer" target=_blank>#9642</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10359 rel="external nofollow noreferrer" target=_blank>#10359</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用后台线程池 (background_schedule_pool_size) 进行分布式发送. <a href=https://github.com/ClickHouse/ClickHouse/pull/10263 rel="external nofollow noreferrer" target=_blank>#10263</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>使用后台线程池进行后台缓冲区刷新. <a href=https://github.com/ClickHouse/ClickHouse/pull/10315 rel="external nofollow noreferrer" target=_blank>#10315</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>支持删除不完整写入部分的一种特殊情况. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/9940 rel="external nofollow noreferrer" target=_blank>#9940</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10221 rel="external nofollow noreferrer" target=_blank>#10221</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用 isInjective() 在此类函数的手动列表上进行 GROUP BY 优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/10342 rel="external nofollow noreferrer" target=_blank>#10342</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>如果客户端在连接时立即发送 RST 数据包, 请避免在日志中打印错误消息. 这是具有 keepalived 和 VRRP 的 IPVS 平衡器的典型行为. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/1851 rel="external nofollow noreferrer" target=_blank>#1851</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10274 rel="external nofollow noreferrer" target=_blank>#10274</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>允许为浮点类型解析 <code class=syntax>+inf</code>. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/1839 rel="external nofollow noreferrer" target=_blank>#1839</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10272 rel="external nofollow noreferrer" target=_blank>#10272</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为嵌套类型实现了 <code class=syntax>generateRandom</code> 表函数. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/9903 rel="external nofollow noreferrer" target=_blank>#9903</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10219 rel="external nofollow noreferrer" target=_blank>#10219</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 MySQL 兼容接口中提供 <code class=syntax>max_allowed_packed</code> 将帮助一些客户端通过 MySQL 协议与 ClickHouse 通信. <a href=https://github.com/ClickHouse/ClickHouse/pull/10199 rel="external nofollow noreferrer" target=_blank>#10199</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>)</li> <li>允许 GLOBAL IN 的文字 (即<code class=syntax>SELECT * FROM remote('localhost', system.one) WHERE dummy global in (0)</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10196 rel="external nofollow noreferrer" target=_blank>#10196</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复 clickhouse-client 交互模式下的各种小问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10194 rel="external nofollow noreferrer" target=_blank>#10194</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>避免多余的字典加载 (system.tables, DROP/SHOW CREATE TABLE). <a href=https://github.com/ClickHouse/ClickHouse/pull/10164 rel="external nofollow noreferrer" target=_blank>#10164</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>更新到 RWLock：getLock() + 实现的超时参数重新设计为阶段公平. <a href=https://github.com/ClickHouse/ClickHouse/pull/10073 rel="external nofollow noreferrer" target=_blank>#10073</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>增强与本机 mysql-connector-java(JDBC) 的兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/10021 rel="external nofollow noreferrer" target=_blank>#10021</a> (<a href=https://github.com/BohuTANG rel="external nofollow noreferrer" target=_blank>BohuTANG</a>)</li> <li><code class=syntax>toString</code> 函数被认为是单调的, 即使在使用 String 或 LowCardinality(String) 参数的重言式情况下也可以用于索引分析. <a href=https://github.com/ClickHouse/ClickHouse/pull/10110 rel="external nofollow noreferrer" target=_blank>#10110</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>向命令 <code class=syntax>{CREATE|DROP} USER/ROLE/ROW POLICY/SETTINGS PROFILE/QUOTA</code>、<code class=syntax>GRANT</code> 添加 <code class=syntax>ON CLUSTER</code> 子句支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/9811 rel="external nofollow noreferrer" target=_blank>#9811</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>对 S3 URI 的虚拟托管式支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/9998 rel="external nofollow noreferrer" target=_blank>#9998</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li> <li>现在可以在字典 DDL 查询中不用圆括号指定没有参数的字典的布局类型. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10057 rel="external nofollow noreferrer" target=_blank>#10057</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10064 rel="external nofollow noreferrer" target=_blank>#10064</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加在文件路径中使用带前导零的数字范围的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/9989 rel="external nofollow noreferrer" target=_blank>#9989</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>CROSS JOIN 中更好的内存使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10029 rel="external nofollow noreferrer" target=_blank>#10029</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>获取远程表的结构并设置 skip_unavailable_shards 时尝试连接到集群中的所有分片. <a href=https://github.com/ClickHouse/ClickHouse/pull/7278 rel="external nofollow noreferrer" target=_blank>#7278</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>)</li> <li>将 <code class=syntax>total_rows</code>/<code class=syntax>total_bytes</code> 添加到 <code class=syntax>system.tables</code> 表中. <a href=https://github.com/ClickHouse/ClickHouse/pull/9919 rel="external nofollow noreferrer" target=_blank>#9919</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>系统日志表现在默认使用多态部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/9905 rel="external nofollow noreferrer" target=_blank>#9905</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>将类型列添加到 system.settings/merge_tree_settings. <a href=https://github.com/ClickHouse/ClickHouse/pull/9909 rel="external nofollow noreferrer" target=_blank>#9909</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>尽早在服务器启动时检查可用的 CPU 指令. <a href=https://github.com/ClickHouse/ClickHouse/pull/9888 rel="external nofollow noreferrer" target=_blank>#9888</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>从突变中移除 <code class=syntax>ORDER BY</code> 阶段, 因为我们从单个线程中的单个有序部分读取. 还添加检查突变中的行是否按排序键排序并且不违反此顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/9886 rel="external nofollow noreferrer" target=_blank>#9886</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>在左侧为 FixedString 实现运算符 LIKE. 这是更好地支持 TPC-DS 查询所必需的. <a href=https://github.com/ClickHouse/ClickHouse/pull/9890 rel="external nofollow noreferrer" target=_blank>#9890</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加 <code class=syntax>force_optimize_skip_unused_shards_no_nested</code> 将禁用嵌套分布式表的 <code class=syntax>force_optimize_skip_unused_shards</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9812 rel="external nofollow noreferrer" target=_blank>#9812</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>现在, 对于 MergeTree 数据部分, 列大小只计算一次. <a href=https://github.com/ClickHouse/ClickHouse/pull/9827 rel="external nofollow noreferrer" target=_blank>#9827</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>评估<code class=syntax>optimize_skip_unused_shards</code> 的常量表达式 (即<code class=syntax>SELECT * FROM foo_dist WHERE key=xxHash32(0)</code>).<a href=https://github.com/ClickHouse/ClickHouse/pull/8846 rel="external nofollow noreferrer" target=_blank>#8846</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>删除了从 TTL 表达式中检查使用 <code class=syntax>Date</code> 或 <code class=syntax>DateTime</code> 列的方法. <a href=https://github.com/ClickHouse/ClickHouse/pull/9967 rel="external nofollow noreferrer" target=_blank>#9967</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>DiskS3硬链接优化实现. <a href=https://github.com/ClickHouse/ClickHouse/pull/9760 rel="external nofollow noreferrer" target=_blank>#9760</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li> <li>如果 <code class=syntax>set multiple_joins_rewriter_version = 2</code> 启用多个 JOIN 重写的第二个版本, 以保持列名不冲突. 它支持多个带有 <code class=syntax>USING</code> 的JOIN, 并允许 <code class=syntax>select *</code> 用于带有子查询的JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/9739 rel="external nofollow noreferrer" target=_blank>#9739</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>StorageMergeTree 的 <code class=syntax>non-blocking</code> 更改的实现. <a href=https://github.com/ClickHouse/ClickHouse/pull/9606 rel="external nofollow noreferrer" target=_blank>#9606</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加 MergeTree 对 DiskS3 的全面支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/9646 rel="external nofollow noreferrer" target=_blank>#9646</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li> <li>扩展 <code class=syntax>splitByString</code> 以支持空字符串作为分隔符. <a href=https://github.com/ClickHouse/ClickHouse/pull/9742 rel="external nofollow noreferrer" target=_blank>#9742</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>将 <code class=syntax>timestamp_ns</code> 列添加到 <code class=syntax>system.trace_log</code> . 它包含跟踪事件的高清时间戳, 并允许构建线程配置文件的时间线 ("火焰图"). <a href=https://github.com/ClickHouse/ClickHouse/pull/9696 rel="external nofollow noreferrer" target=_blank>#9696</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>启用设置 <code class=syntax>send_logs_level</code> 时, 避免日志消息和查询进度混淆. <a href=https://github.com/ClickHouse/ClickHouse/pull/9634 rel="external nofollow noreferrer" target=_blank>#9634</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加了对<code class=syntax>MATERIALIZE TTL IN PARTITION</code>的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/9581 rel="external nofollow noreferrer" target=_blank>#9581</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>支持 Avro 嵌套字段内的复杂类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/10502 rel="external nofollow noreferrer" target=_blank>#10502</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li> </ul> <h4 id=xing-neng-gai-jin_11>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_11 title="Permanent link"> </a></h4> <ul> <li>为 Partial MergeJoin 的右表提供更好的插入逻辑. <a href=https://github.com/ClickHouse/ClickHouse/pull/10467 rel="external nofollow noreferrer" target=_blank>#10467</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>改进了面向行的格式的性能 (CSV 超过 10%，Avro 超过 35%, 在窄表的情况下). <a href=https://github.com/ClickHouse/ClickHouse/pull/10503 rel="external nofollow noreferrer" target=_blank>#10503</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li> <li>使用 IN 运算符右侧显式定义的集合和左侧的元组提高查询的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/10385 rel="external nofollow noreferrer" target=_blank>#10385</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>在 HashJoin 中为哈希表使用更少的内存. <a href=https://github.com/ClickHouse/ClickHouse/pull/10416 rel="external nofollow noreferrer" target=_blank>#10416</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>StorageDictionary 上的特殊 HashJoin. 允许使用 JOIN 重写 <code class=syntax>dictGet()</code> 函数. 它本身并不是向后不兼容的, 但可能会在某些安装中发现 <a href=https://github.com/ClickHouse/ClickHouse/issues/8400 rel="external nofollow noreferrer" target=_blank>#8400</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10133 rel="external nofollow noreferrer" target=_blank>#10133</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>当目标表支持时启用物化视图的并行插入. <a href=https://github.com/ClickHouse/ClickHouse/pull/10052 rel="external nofollow noreferrer" target=_blank>#10052</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>)</li> <li>使用单调函数改进指数分析的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/9607 rel="external nofollow noreferrer" target=_blank>#9607</a><a href=https://github.com/ClickHouse/ClickHouse/pull/10026 rel="external nofollow noreferrer" target=_blank>#10026</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>使用 SSE2 或 SSE4.2 SIMD 内在函数来加速布隆过滤器中的标记化. <a href=https://github.com/ClickHouse/ClickHouse/pull/9968 rel="external nofollow noreferrer" target=_blank>#9968</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>在 <code class=syntax>IN</code> 运算符的右侧使用显式定义的集合提高查询的性能. 这修复了 20.3 版中的性能回归. <a href=https://github.com/ClickHouse/ClickHouse/pull/9740 rel="external nofollow noreferrer" target=_blank>#9740</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>现在, clickhouse-copier 将每个分区分成几部分并独立复制. <a href=https://github.com/ClickHouse/ClickHouse/pull/9075 rel="external nofollow noreferrer" target=_blank>#9075</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>添加更多聚合方法. 例如，TPC-H 查询 1 现在将选择 <code class=syntax>FixedHashMap&lt;UInt16, AggregateDataPtr&gt;</code> 并获得 25% 的性能提升 <a href=https://github.com/ClickHouse/ClickHouse/pull/9829 rel="external nofollow noreferrer" target=_blank>#9829</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>在预限制转换中对多个流使用单行计数器. 这有助于避免在带有 <code class=syntax>limit</code> 但没有 <code class=syntax>order by</code> 的查询中联合管道流 (如 <code class=syntax>select f(x) from (select x from t limit 1000000000)</code>) 并使用多个线程进行进一步处理. <a href=https://github.com/ClickHouse/ClickHouse/pull/9602 rel="external nofollow noreferrer" target=_blank>#9602</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_15>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_15 title="Permanent link"> </a></h4> <ul> <li>使用来自 ClickHouse-Extras 的 AWS SDK 库的分支. <a href=https://github.com/ClickHouse/ClickHouse/pull/10527 rel="external nofollow noreferrer" target=_blank>#10527</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li> <li>为新的 ALTER RENAME COLUMN 查询添加集成测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/10654 rel="external nofollow noreferrer" target=_blank>#10654</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li> <li>在使用错误参数调用函数 <code class=syntax>now64</code> 时修复可能的有符号整数溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8973 rel="external nofollow noreferrer" target=_blank>#8973</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10511 rel="external nofollow noreferrer" target=_blank>#10511</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>拆分 fuzzer 和 sanitizer 配置, 使构建配置与 Oss-fuzz 兼容. <a href=https://github.com/ClickHouse/ClickHouse/pull/10494 rel="external nofollow noreferrer" target=_blank>#10494</a> (<a href=https://github.com/kyprizel rel="external nofollow noreferrer" target=_blank>kyprizel</a>)</li> <li>修复了 clang-10 上的 clang-tidy. <a href=https://github.com/ClickHouse/ClickHouse/pull/10420 rel="external nofollow noreferrer" target=_blank>#10420</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在错误消息中显示绝对路径. 否则 KDevelop 无法导航到正确的文件, 而是打开一个新文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/10434 rel="external nofollow noreferrer" target=_blank>#10434</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了 <code class=syntax>ASAN_OPTIONS</code> 环境变量以使用 Address sanitizer 调查 CI 压力测试中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10440 rel="external nofollow noreferrer" target=_blank>#10440</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>为 clang 构建启用 ThinLTO (实验性). <a href=https://github.com/ClickHouse/ClickHouse/pull/10435 rel="external nofollow noreferrer" target=_blank>#10435</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>删除系统安装 Z3 求解器时可能引入的对 Z3 的意外依赖. <a href=https://github.com/ClickHouse/ClickHouse/pull/10426 rel="external nofollow noreferrer" target=_blank>#10426</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将集成测试 docker 文件移动到 docker/ 目录. <a href=https://github.com/ClickHouse/ClickHouse/pull/10335 rel="external nofollow noreferrer" target=_blank>#10335</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li> <li>允许在 CI 中使用 <code class=syntax>clang-10</code>. 它确保 <a href=https://github.com/ClickHouse/ClickHouse/issues/10238 rel="external nofollow noreferrer" target=_blank>#10238</a> 是已修复的. <a href=https://github.com/ClickHouse/ClickHouse/pull/10384 rel="external nofollow noreferrer" target=_blank>#10384</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 OpenSSL 更新为上游主服务器. 修复了 TLS 连接可能失败并显示消息 <code class=syntax>OpenSSL SSL_read: error:14094438:SSLroutines:ssl3_read_bytes:tlsv1 alert internal error</code> 和 <code class=syntax>SSL Exception: error:2400006E:random number generator::error retrieving entropy</code> 时的问题. 该问题存在于 20.1 版中. <a href=https://github.com/ClickHouse/ClickHouse/pull/8956 rel="external nofollow noreferrer" target=_blank>#8956</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 clang-10 构建. <a href=https://github.com/ClickHouse/ClickHouse/issues/10238 rel="external nofollow noreferrer" target=_blank>#10238</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10370 rel="external nofollow noreferrer" target=_blank>#10370</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>为[Parallel INSERT for materialized view] (<a href=https://github.com/ClickHouse/ClickHouse/pull/10052)添加性能测试 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/10052)添加性能测试</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10345 rel="external nofollow noreferrer" target=_blank>#10345</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>)</li> <li>修复片状测试 <code class=syntax>test_settings_constraints_distributed.test_insert_clamps_settings</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10346 rel="external nofollow noreferrer" target=_blank>#10346</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>添加 util 以在 CI ClickHouse 中上传测试结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/10330 rel="external nofollow noreferrer" target=_blank>#10330</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li> <li>在 junit_to_html 工具中将测试结果转换为 JSONEachRow 格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/10323 rel="external nofollow noreferrer" target=_blank>#10323</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li> <li>更新 cctz. <a href=https://github.com/ClickHouse/ClickHouse/pull/10215 rel="external nofollow noreferrer" target=_blank>#10215</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>允许从最纯粹的 JUnit XML 报告创建 HTML 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/10247 rel="external nofollow noreferrer" target=_blank>#10247</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li> <li>更新对最小编译器版本的检查. 修复问题的根本原因 <a href=https://github.com/ClickHouse/ClickHouse/issues/10250 rel="external nofollow noreferrer" target=_blank>#10250</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10256 rel="external nofollow noreferrer" target=_blank>#10256</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>对分布式实时视图表的初始支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/10179 rel="external nofollow noreferrer" target=_blank>#10179</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li> <li>在 MergeTreeIndexFullText 中修复 (false) MSan 报告. 该问题首先出现在 <a href=https://github.com/ClickHouse/ClickHouse/issues/9968 rel="external nofollow noreferrer" target=_blank>#9968</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10801 rel="external nofollow noreferrer" target=_blank>#10801</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>clickhouse-docker-util. <a href=https://github.com/ClickHouse/ClickHouse/pull/10151 rel="external nofollow noreferrer" target=_blank>#10151</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>将 pdqsort 更新到最新版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/10171 rel="external nofollow noreferrer" target=_blank>#10171</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>将 libdivide 更新至 v3.0. <a href=https://github.com/ClickHouse/ClickHouse/pull/10169 rel="external nofollow noreferrer" target=_blank>#10169</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>使用启用的多态部分添加检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/10086 rel="external nofollow noreferrer" target=_blank>#10086</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>为 FreeBSD 添加交叉编译构建. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9465 rel="external nofollow noreferrer" target=_blank>#9465</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9643 rel="external nofollow noreferrer" target=_blank>#9643</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>添加性能测试. <a href=https://github.com/ClickHouse/ClickHouse/issues/6924 rel="external nofollow noreferrer" target=_blank>#6924</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6980 rel="external nofollow noreferrer" target=_blank>#6980</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>在 <code class=syntax>File</code> 引擎中添加对 <code class=syntax>/dev/null</code> 的支持以进行更好的性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/8455 rel="external nofollow noreferrer" target=_blank>#8455</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>将 /dbms 中的所有文件夹向上移动一级. <a href=https://github.com/ClickHouse/ClickHouse/pull/9974 rel="external nofollow noreferrer" target=_blank>#9974</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>添加一个测试, 检查从 MergeTree 中读取的单线程是否按顺序执行. 添加到 <a href=https://github.com/ClickHouse/ClickHouse/issues/9670 rel="external nofollow noreferrer" target=_blank>#9670</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9762 rel="external nofollow noreferrer" target=_blank>#9762</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>00964_live_view_watch_events_heartbeat.py</code> 测试以避免竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/9944 rel="external nofollow noreferrer" target=_blank>#9944</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li> <li>修复集成测试 <code class=syntax>test_settings_constraints</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9962 rel="external nofollow noreferrer" target=_blank>#9962</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>每个函数都在自己的文件中, 第 12 部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/9922 rel="external nofollow noreferrer" target=_blank>#9922</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>增加了对元组数组分析速度极慢的情况的性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/9872 rel="external nofollow noreferrer" target=_blank>#9872</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 zstd 更新到 1.4.4. 它在性能和压缩比方面有一些小的改进. 如果您使用不同版本的 ClickHouse 运行副本, 您可能会看到合理的错误消息 <code class=syntax>Data after merge is not byte-identical to data on another replicas.</code> 并附有说明. 这些消息没问题, 您不必担心. <a href=https://github.com/ClickHouse/ClickHouse/pull/10663 rel="external nofollow noreferrer" target=_blank>#10663</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>system.stack_trace</code> 中的 TSan 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/9832 rel="external nofollow noreferrer" target=_blank>#9832</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>删除了对 <code class=syntax>clock_getres</code> 的依赖. <a href=https://github.com/ClickHouse/ClickHouse/pull/9833 rel="external nofollow noreferrer" target=_blank>#9833</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了使用 clang-tidy 的标识符名称检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/9799 rel="external nofollow noreferrer" target=_blank>#9799</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>更新 <code class=syntax>builder</code> docker 镜像. 此镜像未在 CI 中使用, 但对开发人员有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/9809 rel="external nofollow noreferrer" target=_blank>#9809</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>删除 CI 中不再使用的旧的 <code class=syntax>performance-test</code> 工具. <code class=syntax>clickhouse-performance-test</code> 很棒, 但现在我们正在使用更高级的工具, 该工具通过复杂的统计公式进行比较测试, 无论环境如何变化, 都能获得可靠的结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/9796 rel="external nofollow noreferrer" target=_blank>#9796</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了大部分 clang-static-analyzer 检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/9765 rel="external nofollow noreferrer" target=_blank>#9765</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 Poco 更新到 1.9.3, 为 MongoDB URI 支持做准备. <a href=https://github.com/ClickHouse/ClickHouse/pull/6892 rel="external nofollow noreferrer" target=_blank>#6892</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>使用 <code class=syntax>-DUSE_STATIC_LIBRARIES=0 -DENABLE_JEMALLOC=0</code> 修复构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/9651 rel="external nofollow noreferrer" target=_blank>#9651</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>对于变更日志脚本, 如果合并提交被挑选到发布分支, 则从提交描述中获取 PR 名称. <a href=https://github.com/ClickHouse/ClickHouse/pull/9708 rel="external nofollow noreferrer" target=_blank>#9708</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>在 backport 脚本中支持 <code class=syntax>vX.X-conflicts</code> 标签. <a href=https://github.com/ClickHouse/ClickHouse/pull/9705 rel="external nofollow noreferrer" target=_blank>#9705</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复用于向后移植脚本的 <code class=syntax>auto-label</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/9685 rel="external nofollow noreferrer" target=_blank>#9685</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>在 Darwin 交叉构建中使用 libc++ 使其与原生构建一致. <a href=https://github.com/ClickHouse/ClickHouse/pull/9665 rel="external nofollow noreferrer" target=_blank>#9665</a> (<a href=https://github.com/huiwang rel="external nofollow noreferrer" target=_blank>Hui Wang</a>)</li> <li>修复不稳定的测试 <code class=syntax>01017_uniqCombined_memory_usage</code>. 续 <a href=https://github.com/ClickHouse/ClickHouse/issues/7236 rel="external nofollow noreferrer" target=_blank>#7236</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9667 rel="external nofollow noreferrer" target=_blank>#9667</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复原生 MacOS Clang 编译器的构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/9649 rel="external nofollow noreferrer" target=_blank>#9649</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>允许在 <code class=syntax>pthread_mutex_lock</code>、<code class=syntax>pthread_mutex_unlock</code> 函数周围添加各种故障. <a href=https://github.com/ClickHouse/ClickHouse/pull/9635 rel="external nofollow noreferrer" target=_blank>#9635</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 <code class=syntax>packager</code> 脚本中添加对 <code class=syntax>clang-tidy</code> 的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/9625 rel="external nofollow noreferrer" target=_blank>#9625</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加使用未捆绑的 msgpack 的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/10168 rel="external nofollow noreferrer" target=_blank>#10168</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> </ul> <h2 id=clickhouse-ban-ben-v20-3>ClickHouse 版本 v20.3<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3 title="Permanent link"> </a></h2> <h3 id=clickhouse-ban-ben-v20-3-21-2-lts-2020-11-02>ClickHouse 版本 v20.3.21.2-lts, 2020-11-02<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-21-2-lts-2020-11-02 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_33>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_33 title="Permanent link"> </a></h4> <ul> <li>修复 sharding_key 中的 dictGet (以及类似的地方, 即当函数上下文被永久存储时). <a href=https://github.com/ClickHouse/ClickHouse/pull/16205 rel="external nofollow noreferrer" target=_blank>#16205</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果查询具有<code class=syntax>WHERE</code>、<code class=syntax>PREWHERE</code> 和<code class=syntax>GLOBAL IN</code>, 则修复来自<code class=syntax>Distributed</code> 表的查询的错误空结果. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/15792 rel="external nofollow noreferrer" target=_blank>#15792</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/15933 rel="external nofollow noreferrer" target=_blank>#15933</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 <code class=syntax>TSV/CSVWithNames</code> 格式中缺失或过多的标题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12504 rel="external nofollow noreferrer" target=_blank>#12504</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13343 rel="external nofollow noreferrer" target=_blank>#13343</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-20-6-lts-2020-10-09>ClickHouse 版本 v20.3.20.6-lts, 2020-10-09<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-20-6-lts-2020-10-09 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_34>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_34 title="Permanent link"> </a></h4> <ul> <li>Mutation 可能会在 <code class=syntax>MOVE</code> 或 <code class=syntax>REPLACE PARTITION</code> 之后等待一些不存在的部分, 或者在极少数情况下, 在 <code class=syntax>DETACH</code> 或 <code class=syntax>DROP PARTITION</code> 之后挂起。 已修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/15724 rel="external nofollow noreferrer" target=_blank>#15724</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/15537 rel="external nofollow noreferrer" target=_blank>#15537</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复带有大量子查询的查询挂起到 <code class=syntax>MySQL</code> 引擎的同一个表. 以前, 如果查询中有超过 16 个子查询到同一个 <code class=syntax>MySQL</code> 表, 它会永远挂起. <a href=https://github.com/ClickHouse/ClickHouse/pull/15299 rel="external nofollow noreferrer" target=_blank>#15299</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>当查询在 Merge 表上有 JOIN 时，修复 GROUP BY 中的 <code class=syntax>Unknown identifier</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/15242 rel="external nofollow noreferrer" target=_blank>#15242</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>当子查询包含 finalizeAggregation 函数时, 修复使谓词下推工作. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14847 rel="external nofollow noreferrer" target=_blank>#14847</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14937 rel="external nofollow noreferrer" target=_blank>#14937</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>并发 <code class=syntax>ALTER ... REPLACE/MOVE PARTITION ...</code> 查询可能会导致死锁. 已修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/13626 rel="external nofollow noreferrer" target=_blank>#13626</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-19-4-lts-2020-09-18>ClickHouse 版本 v20.3.19.4-lts, 2020-09-18<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-19-4-lts-2020-09-18 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_35>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_35 title="Permanent link"> </a></h4> <ul> <li>当被查询的列具有 <code class=syntax>DEFAULT</code> 表达式时, 修复 <code class=syntax>SELECT</code> 查询中的罕见错误, 该表达式依赖于另一列, 该列也具有 <code class=syntax>DEFAULT</code> 并且不存在于选择查询中且不存在于磁盘上. 部分修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/14531 rel="external nofollow noreferrer" target=_blank>#14531</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14845 rel="external nofollow noreferrer" target=_blank>#14845</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了在赋值表达式和常量值 (如 <code class=syntax>UPDATE x = 42</code>) 中使用 Nullable 列的 <code class=syntax>ALTER UPDATE</code> 突变导致列或段错误中的值不正确时的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/13634 rel="external nofollow noreferrer" target=_blank>#13634</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/14045 rel="external nofollow noreferrer" target=_blank>#14045</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14646 rel="external nofollow noreferrer" target=_blank>#14646</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复错误的十进制乘法结果导致结果列小数位数错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/14603 rel="external nofollow noreferrer" target=_blank>#14603</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> </ul> <h4 id=gai-jin_17>改进<a class=headerlink href=../amp/#gai-jin_17 title="Permanent link"> </a></h4> <ul> <li>支持合并部分的自定义编解码器. <a href=https://github.com/ClickHouse/ClickHouse/pull/12183 rel="external nofollow noreferrer" target=_blank>#12183</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-18-10-lts-2020-09-08>ClickHouse 版本 v20.3.18.10-lts, 2020-09-08<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-18-10-lts-2020-09-08 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_36>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_36 title="Permanent link"> </a></h4> <ul> <li>如果 <code class=syntax>PipelineExecutor</code> 本身发生异常, 则停止查询执行. 这可以防止罕见的查询挂起. 续 <a href=https://github.com/ClickHouse/ClickHouse/issues/14334 rel="external nofollow noreferrer" target=_blank>#14334</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/14402 rel="external nofollow noreferrer" target=_blank>#14402</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了有时缓存字典从源返回默认值而不是当前值时的行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/13624 rel="external nofollow noreferrer" target=_blank>#13624</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>当数据库或表的名称包含点时, 修复从 users.xml 解析行策略. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/5779 rel="external nofollow noreferrer" target=_blank>#5779</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/12527 rel="external nofollow noreferrer" target=_blank>#12527</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13199 rel="external nofollow noreferrer" target=_blank>#13199</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复 CAST(Nullable(String), Enum()). <a href=https://github.com/ClickHouse/ClickHouse/pull/12745 rel="external nofollow noreferrer" target=_blank>#12745</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>text_log</code> 中的数据竞争. 它不对应任何真正的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9726 rel="external nofollow noreferrer" target=_blank>#9726</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h4 id=gai-jin_18>改进<a class=headerlink href=../amp/#gai-jin_18 title="Permanent link"> </a></h4> <ul> <li>修复长查询的错误错误. 为了正确查询, 可能会出现除 <code class=syntax>Max query size exceeded</code> 之外的语法错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/13928 rel="external nofollow noreferrer" target=_blank>#13928</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当在 parseDateTimeBestEffortOrNull/Zero 函数中没有完全解析值时, 返回 NULL/零. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7876 rel="external nofollow noreferrer" target=_blank>#7876</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11653 rel="external nofollow noreferrer" target=_blank>#11653</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h4 id=xing-neng-gai-jin_12>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_12 title="Permanent link"> </a></h4> <ul> <li>使用 LowCardinality 稍微优化非常短的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/14129 rel="external nofollow noreferrer" target=_blank>#14129</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_16>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_16 title="Permanent link"> </a></h4> <ul> <li>修复迁移到 clang-10 后出现的 HashTable 中的 UBSan 报告 (向 nullptr 添加零). <a href=https://github.com/ClickHouse/ClickHouse/pull/10638 rel="external nofollow noreferrer" target=_blank>#10638</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-17-173-lts-2020-08-15>ClickHouse 版本 v20.3.17.173-lts, 2020-08-15<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-17-173-lts-2020-08-15 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_37>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_37 title="Permanent link"> </a></h4> <ul> <li>使用 StorageMerge 和 <code class=syntax>set enable_optimize_predicate_expression=1</code> 修复 JOIN 中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/13679 rel="external nofollow noreferrer" target=_blank>#13679</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复无效的返回类型, 用于将元组与 <code class=syntax>NULL</code> 元素进行比较. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/12461 rel="external nofollow noreferrer" target=_blank>#12461</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13420 rel="external nofollow noreferrer" target=_blank>#13420</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用常量列和主键的 <code class=syntax>ORDER BY</code> 前缀修复查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/13396 rel="external nofollow noreferrer" target=_blank>#13396</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>返回在 roundUpToPowerOfTwoOrZero() 中设置 MSB 的数字的传递数字. <a href=https://github.com/ClickHouse/ClickHouse/pull/13234 rel="external nofollow noreferrer" target=_blank>#13234</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-16-165-lts-2020-08-10>ClickHouse 版本 v20.3.16.165-lts 2020-08-10<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-16-165-lts-2020-08-10 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_38>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_38 title="Permanent link"> </a></h4> <ul> <li>修复了当 unix 时间戳作为参数传递时 <code class=syntax>parseDateTimeBestEffort</code> 函数中的错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/13362 rel="external nofollow noreferrer" target=_blank>#13362</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13441 rel="external nofollow noreferrer" target=_blank>#13441</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在具有 NaN 值的 Float 类型上调用的 <code class=syntax>uniqExact</code>、<code class=syntax>topK</code>、<code class=syntax>sumDistinct</code> 和类似聚合函数的潜在低性能和稍微不正确的结果. 它还在调试版本中触发断言. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12491 rel="external nofollow noreferrer" target=_blank>#12491</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13254 rel="external nofollow noreferrer" target=_blank>#13254</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果将可空 constexpr 作为不是文字 NULL 的 cond 的固定函数. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12463 rel="external nofollow noreferrer" target=_blank>#12463</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13226 rel="external nofollow noreferrer" target=_blank>#13226</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>在数组元素为 Nullable 且数组下标也可为 Null 的情况下, 修复了 <code class=syntax>arrayElement</code> 函数中的断言. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12172 rel="external nofollow noreferrer" target=_blank>#12172</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/13224 rel="external nofollow noreferrer" target=_blank>#13224</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了对从本地副本进行选择的线程数的不必要限制. <a href=https://github.com/ClickHouse/ClickHouse/pull/12840 rel="external nofollow noreferrer" target=_blank>#12840</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了查询 <code class=syntax>WITH TOTALS</code> 时可能出现的数据中可能出现的额外溢出行. <a href=https://github.com/ClickHouse/ClickHouse/pull/12747 rel="external nofollow noreferrer" target=_blank>#12747</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了大元组的性能, 这些元组在 <code class=syntax>IN</code> 部分被解释为函数. 当用户出于某种晦涩的原因编写 <code class=syntax>WHERE x IN tuple(1, 2, ...)</code> 而不是 <code class=syntax>WHERE x IN (1, 2, ...)</code> 的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/12700 rel="external nofollow noreferrer" target=_blank>#12700</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了 input_format_parallel_parsing 的内存跟踪 (通过将线程附加到组). <a href=https://github.com/ClickHouse/ClickHouse/pull/12672 rel="external nofollow noreferrer" target=_blank>#12672</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12293 rel="external nofollow noreferrer" target=_blank>#12293</a> 当子查询包含 with 子句时允许推送谓词. <a href=https://github.com/ClickHouse/ClickHouse/pull/12663 rel="external nofollow noreferrer" target=_blank>#12663</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10572 rel="external nofollow noreferrer" target=_blank>#10572</a> 使用 const 表达式修复布隆过滤器索引. <a href=https://github.com/ClickHouse/ClickHouse/pull/12659 rel="external nofollow noreferrer" target=_blank>#12659</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>当代理不可用时 (不仅如此) 修复了 StorageKafka 中的 SIGSEGV. <a href=https://github.com/ClickHouse/ClickHouse/pull/12658 rel="external nofollow noreferrer" target=_blank>#12658</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了带有缓存布局的外部字典中的竞争条件, 这可能导致服务器崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/12566 rel="external nofollow noreferrer" target=_blank>#12566</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了当 <code class=syntax>enable_mixed_granularity_parts=1</code> 时, 在 <code class=syntax>ALTER DELETE</code> 查询后导致旧部件损坏的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12536 rel="external nofollow noreferrer" target=_blank>#12536</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12543 rel="external nofollow noreferrer" target=_blank>#12543</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>对于参数数目无效的函数 <code class=syntax>in</code> 更好的异常信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/12529 rel="external nofollow noreferrer" target=_blank>#12529</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了性能问题，同时读取合并部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/12492 rel="external nofollow noreferrer" target=_blank>#12492</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了启用 <code class=syntax>text_log</code> 时的死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/12452 rel="external nofollow noreferrer" target=_blank>#12452</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 StorageMerge 时可能出现的段错误. 关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/12054 rel="external nofollow noreferrer" target=_blank>#12054</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12401 rel="external nofollow noreferrer" target=_blank>#12401</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了带有 <code class=syntax>-State</code> 和 <code class=syntax>Nullable</code> 参数的聚合函数的 <code class=syntax>TOTALS/ROLLUP/CUBE</code>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12163 rel="external nofollow noreferrer" target=_blank>#12163</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12376 rel="external nofollow noreferrer" target=_blank>#12376</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 <code class=syntax>WITH FILL</code> 修饰符中列的顺序. 以前不遵守 <code class=syntax>ORDER BY</code> 语句的列顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/12306 rel="external nofollow noreferrer" target=_blank>#12306</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>当存在按虚拟列 (如 <code class=syntax>Merge</code>表中的<code class=syntax>_table</code>) 或系统表中的 <code class=syntax>index</code> 列过滤数据 (例如从 <code class=syntax>system.tables</code> 查询时按数据库名称过滤) 时, 避免 <code class=syntax>bad cast</code> 异常, 并且这个表达式返回 <code class=syntax>Nullable</code> 类型. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12166 rel="external nofollow noreferrer" target=_blank>#12166</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12305 rel="external nofollow noreferrer" target=_blank>#12305</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li><code class=syntax>TrieDictionary</code> 加载失败后显示错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/12290 rel="external nofollow noreferrer" target=_blank>#12290</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>对于可能导致崩溃的空数组, 函数 <code class=syntax>arrayFill</code> 工作不正确. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12263 rel="external nofollow noreferrer" target=_blank>#12263</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12279 rel="external nofollow noreferrer" target=_blank>#12279</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>实现到 <code class=syntax>LowCardinality</code> 类型的通用类型的转换. 这允许对具有 LowCardinality 列和其他列的表执行 UNION ALL. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8212 rel="external nofollow noreferrer" target=_blank>#8212</a>. This fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/4342 rel="external nofollow noreferrer" target=_blank>#4342</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12275 rel="external nofollow noreferrer" target=_blank>#12275</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在某些特殊类型的 <code class=syntax>StorageFile</code> 标头中多次连续插入期间多次写入时的行为. 这已修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6155 rel="external nofollow noreferrer" target=_blank>#6155</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12197 rel="external nofollow noreferrer" target=_blank>#12197</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复了 UInt8 值不等于 0 或 1 时的逻辑函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/12196 rel="external nofollow noreferrer" target=_blank>#12196</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>在 GROUP BY 内射函数消除期间修复了 <code class=syntax>dictGet</code> 参数检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/12179 rel="external nofollow noreferrer" target=_blank>#12179</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>ALTER DELETE</code> 中的错误逻辑, 当条件评估为 NULL 时会导致删除记录. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9088 rel="external nofollow noreferrer" target=_blank>#9088</a>. This closes <a href=https://github.com/ClickHouse/ClickHouse/issues/12106 rel="external nofollow noreferrer" target=_blank>#12106</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12153 rel="external nofollow noreferrer" target=_blank>#12153</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在存在别名的情况下发送到外部 DBMS (例如 MySQL、ODBC) 的查询转换. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12032 rel="external nofollow noreferrer" target=_blank>#12032</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12151 rel="external nofollow noreferrer" target=_blank>#12151</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了整数除法中的潜在溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12119 rel="external nofollow noreferrer" target=_blank>#12119</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12140 rel="external nofollow noreferrer" target=_blank>#12140</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 <code class=syntax>greatCircleDistance</code>、<code class=syntax>geoDistance</code> 中潜在的无限循环. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/12117 rel="external nofollow noreferrer" target=_blank>#12117</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12137 rel="external nofollow noreferrer" target=_blank>#12137</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>对于带有连接或附加到系统日志 (ystem.query_log、metric_log 等) 或 engine=Buffer 基础表的子查询的物化视图, 避免 <code class=syntax>There is no query</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/12120 rel="external nofollow noreferrer" target=_blank>#12120</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复了由于线程总数限制错误导致的带有 <code class=syntax>UNION</code> 的选择的性能. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/12030 rel="external nofollow noreferrer" target=_blank>#12030</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12103 rel="external nofollow noreferrer" target=_blank>#12103</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用 <code class=syntax>-StateResample</code> 组合器修复了段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/12092 rel="external nofollow noreferrer" target=_blank>#12092</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了不必要的限制从 <code class=syntax>VIEW</code> 中选择的线程数. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11937 rel="external nofollow noreferrer" target=_blank>#11937</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12085 rel="external nofollow noreferrer" target=_blank>#12085</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了使用错误类型 <code class=syntax>PREWHERE</code> 时可能发生的崩溃. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/12053 rel="external nofollow noreferrer" target=_blank>#12053</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/12060 rel="external nofollow noreferrer" target=_blank>#12060</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12060 rel="external nofollow noreferrer" target=_blank>#12060</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了具有 <code class=syntax>LowCardinality</code> 类型的函数 <code class=syntax>defaultValueOfArgumentType</code> 的 <code class=syntax>Expected single dictionary argument for function</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11808 rel="external nofollow noreferrer" target=_blank>#11808</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12056 rel="external nofollow noreferrer" target=_blank>#12056</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了带有 <code class=syntax>Tuple(LowCardinality)</code> 参数的高阶函数的错误 <code class=syntax>Cannot capture column</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9766 rel="external nofollow noreferrer" target=_blank>#9766</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12055 rel="external nofollow noreferrer" target=_blank>#12055</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>加载数据库时并行解析表元数据. 这修复了有大量表时服务器启动缓慢的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/12045 rel="external nofollow noreferrer" target=_blank>#12045</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>使 <code class=syntax>topK</code> 聚合函数为 Enum 类型返回 Enum. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/3740 rel="external nofollow noreferrer" target=_blank>#3740</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12043 rel="external nofollow noreferrer" target=_blank>#12043</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了否为常量表达式的约束检查. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11360 rel="external nofollow noreferrer" target=_blank>#11360</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12042 rel="external nofollow noreferrer" target=_blank>#12042</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了元组与 <code class=syntax>Nullable</code> 列的不正确比较. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11985 rel="external nofollow noreferrer" target=_blank>#11985</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12039 rel="external nofollow noreferrer" target=_blank>#12039</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了在调用具有不同大小的 <code class=syntax>FixedString</code> 类型参数的函数 <code class=syntax>if</code> 时出现错误结果和潜在崩溃的问题. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/11362 rel="external nofollow noreferrer" target=_blank>#11362</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12021 rel="external nofollow noreferrer" target=_blank>#12021</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果使用偏移量 <code class=syntax>-9223372036854775808</code> 调用函数, 则以函数 <code class=syntax>neighbor</code> 作为唯一返回表达式的查询可能会返回空结果. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11367 rel="external nofollow noreferrer" target=_blank>#11367</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12019 rel="external nofollow noreferrer" target=_blank>#12019</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 generateRandom 中可能导致崩溃的潜在数组大小溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11371 rel="external nofollow noreferrer" target=_blank>#11371</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12013 rel="external nofollow noreferrer" target=_blank>#12013</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了潜在的浮点异常. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11378 rel="external nofollow noreferrer" target=_blank>#11378</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12005 rel="external nofollow noreferrer" target=_blank>#12005</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了服务器启动时日志消息中错误的设置名称. <a href=https://github.com/ClickHouse/ClickHouse/pull/11997 rel="external nofollow noreferrer" target=_blank>#11997</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 <code class=syntax>Values</code> 格式中的 <code class=syntax>Query parameter was not set</code> 问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11918 rel="external nofollow noreferrer" target=_blank>#11918</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11936 rel="external nofollow noreferrer" target=_blank>#11936</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>在查询 (参数化查询) 中保留替换的别名. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11914 rel="external nofollow noreferrer" target=_blank>#11914</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11916 rel="external nofollow noreferrer" target=_blank>#11916</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了解析 DateTime64 时潜在的浮点异常. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11374 rel="external nofollow noreferrer" target=_blank>#11374</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11875 rel="external nofollow noreferrer" target=_blank>#11875</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>通过 <code class=syntax>HTTP</code> 接口修复内存记帐 (对于 <code class=syntax>wait_end_of_query=1</code> 可能很重要). <a href=https://github.com/ClickHouse/ClickHouse/pull/11840 rel="external nofollow noreferrer" target=_blank>#11840</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了条件为 NULL 的 <code class=syntax>if()</code> 的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/11807 rel="external nofollow noreferrer" target=_blank>#11807</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>在检查相等性之前解析存储在 zookeeper 中的元数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/11739 rel="external nofollow noreferrer" target=_blank>#11739</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>LIMIT n WITH TIES</code> 与 <code class=syntax>ORDER BY</code> 语句一起使用的问题, 该语句包含别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/11689 rel="external nofollow noreferrer" target=_blank>#11689</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复缓存字典中未初始化内存的潜在读取. <a href=https://github.com/ClickHouse/ClickHouse/pull/10834 rel="external nofollow noreferrer" target=_blank>#10834</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h4 id=xing-neng-gai-jin_13>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_13 title="Permanent link"> </a></h4> <ul> <li>索引不用于带文字的 IN 运算符, 在 v19.3 前后引入了性能回归. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10574 rel="external nofollow noreferrer" target=_blank>#10574</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/12062 rel="external nofollow noreferrer" target=_blank>#12062</a> (<a href=https://github.com/nvartolomei rel="external nofollow noreferrer" target=_blank>nvartolomei</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-12-112-lts-2020-06-25>ClickHouse 版本 v20.3.12.112-lts 2020-06-25<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-12-112-lts-2020-06-25 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_39>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_39 title="Permanent link"> </a></h4> <ul> <li>修复在 prewhere 条件下使用 <code class=syntax>Nullable</code> 列导致的罕见崩溃. 续 <a href=https://github.com/ClickHouse/ClickHouse/issues/11608 rel="external nofollow noreferrer" target=_blank>#11608</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11869 rel="external nofollow noreferrer" target=_blank>#11869</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>不允许在高阶函数中使用 arrayJoin. 它导致协议同步中断. 这关闭了 <a href=https://github.com/ClickHouse/ClickHouse/issues/3933 rel="external nofollow noreferrer" target=_blank>#3933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11846 rel="external nofollow noreferrer" target=_blank>#11846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复使用过多线程进行查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/11788 rel="external nofollow noreferrer" target=_blank>#11788</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复像 <code class=syntax>SELECT *, xyz.*</code> 这样的查询的意外行为, 这些查询在预期错误时成功. <a href=https://github.com/ClickHouse/ClickHouse/pull/11753 rel="external nofollow noreferrer" target=_blank>#11753</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>现在复制的提取将在元数据更改期间取消. <a href=https://github.com/ClickHouse/ClickHouse/pull/11744 rel="external nofollow noreferrer" target=_blank>#11744</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了由 Values 输入格式中复杂文字的错误类型推导导致的 LOGICAL_ERROR. <a href=https://github.com/ClickHouse/ClickHouse/pull/11732 rel="external nofollow noreferrer" target=_blank>#11732</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复 <code class=syntax>ORDER BY ... WITH FILL</code> 在 const 列上. <a href=https://github.com/ClickHouse/ClickHouse/pull/11697 rel="external nofollow noreferrer" target=_blank>#11697</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>与 XDBC 桥通信时传递适当的超时. 最近在检查桥接活性和接收元信息时没有遵守超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/11690 rel="external nofollow noreferrer" target=_blank>#11690</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复导致 <code class=syntax>system.mutations</code> 状态不正确的错误. 它可能表明整个突变已经完成, 但服务器在复制队列中仍有 <code class=syntax>MUTATE_PART</code> 任务并尝试执行它们. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11611 rel="external nofollow noreferrer" target=_blank>#11611</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11681 rel="external nofollow noreferrer" target=_blank>#11681</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>添加对带有不区分大小写标志的正则表达式的支持. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11101 rel="external nofollow noreferrer" target=_blank>#11101</a> and fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11506 rel="external nofollow noreferrer" target=_blank>#11506</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11649 rel="external nofollow noreferrer" target=_blank>#11649</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果设置了行级安全性，则删除琐碎的计数查询优化. 在以前的版本中, 用户获取表中记录的总数而不是过滤. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/11352 rel="external nofollow noreferrer" target=_blank>#11352</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11644 rel="external nofollow noreferrer" target=_blank>#11644</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复字符串的布隆过滤器 (数据跳过索引). <a href=https://github.com/ClickHouse/ClickHouse/pull/11638 rel="external nofollow noreferrer" target=_blank>#11638</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复在 prewhere 条件下使用 <code class=syntax>Nullable</code> 列导致的罕见崩溃. (可能它以某种方式与 <a href=https://github.com/ClickHouse/ClickHouse/issues/11572 rel="external nofollow noreferrer" target=_blank>#11572</a> somehow). <a href=https://github.com/ClickHouse/ClickHouse/pull/11608 rel="external nofollow noreferrer" target=_blank>#11608</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复错误 <code class=syntax>Block structure mismatch</code> , 用于从 <code class=syntax>Buffer</code> 表中采样读取的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/11602 rel="external nofollow noreferrer" target=_blank>#11602</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 clickhouse-client 的错误退出代码, 当 exception.code() % 256 = 0 时. <a href=https://github.com/ClickHouse/ClickHouse/pull/11601 rel="external nofollow noreferrer" target=_blank>#11601</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复服务器启动时有关 <code class=syntax>Mark cache size was lowered</code> 的日志消息中的小错误. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11399 rel="external nofollow noreferrer" target=_blank>#11399</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11589 rel="external nofollow noreferrer" target=_blank>#11589</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复错误 <code class=syntax>Size of offsets does not match size of column</code> , 用于查询中的 <code class=syntax>PREWHERE column in (subquery)</code> 和 <code class=syntax>ARRAY JOIN</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11580 rel="external nofollow noreferrer" target=_blank>#11580</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>HTTP 会话中的所有查询都具有相同的 query_id. 已修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/11578 rel="external nofollow noreferrer" target=_blank>#11578</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>现在 clickhouse-server docker 容器将更喜欢 IPv6 检查服务器活动性. <a href=https://github.com/ClickHouse/ClickHouse/pull/11550 rel="external nofollow noreferrer" target=_blank>#11550</a> (<a href=https://github.com/istarkov rel="external nofollow noreferrer" target=_blank>Ivan Starkov</a>).</li> <li>修复 <code class=syntax>&lt;node&gt;</code> 的 shard_num/replica_num (破坏 use_compact_format_in_distributed_parts_names). <a href=https://github.com/ClickHouse/ClickHouse/pull/11528 rel="external nofollow noreferrer" target=_blank>#11528</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 -State 函数在聚合过程中抛出异常时修复内存泄漏. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8995 rel="external nofollow noreferrer" target=_blank>#8995</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11496 rel="external nofollow noreferrer" target=_blank>#11496</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当别名可以覆盖限定的列名, 修复分布式查询的错误结果. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9672 rel="external nofollow noreferrer" target=_blank>#9672</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/9714 rel="external nofollow noreferrer" target=_blank>#9714</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9972 rel="external nofollow noreferrer" target=_blank>#9972</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-11-97-lts-2020-06-10>ClickHouse 版本 v20.3.11.97-lts 2020-06-10<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-11-97-lts-2020-06-10 title="Permanent link"> </a></h3> <h4 id=xin-te-zheng_9>新特征<a class=headerlink href=../amp/#xin-te-zheng_9 title="Permanent link"> </a></h4> <ul> <li>现在, ClickHouse 在其一侧控制字典源的超时. 缓存字典配置中添加了两个新设置: <code class=syntax>strict_max_lifetime_seconds</code>, 默认为 <code class=syntax>max_lifetime</code> 和 <code class=syntax>query_wait_timeout_milliseconds</code>, 默认为一分钟. 第一个设置对于 <code class=syntax>allow_read_expired_keys</code> 设置也很有用 (禁止读取非常过期的键). <a href=https://github.com/ClickHouse/ClickHouse/pull/10337 rel="external nofollow noreferrer" target=_blank>#10337</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> </ul> <h4 id=bug-xiu-fu_40>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_40 title="Permanent link"> </a></h4> <ul> <li>修复了在启用 <code class=syntax>min_bytes_to_use_direct_io</code> 且 PREWHERE 处于活动状态并使用 SAMPLE 或大量线程时可能发生的 <code class=syntax>Data compressed with different methods</code> 错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11539 rel="external nofollow noreferrer" target=_blank>#11539</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11540 rel="external nofollow noreferrer" target=_blank>#11540</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复编解码器的返回压缩大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/11448 rel="external nofollow noreferrer" target=_blank>#11448</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当列具有带有非文字参数的压缩编解码器时修复服务器崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11365 rel="external nofollow noreferrer" target=_blank>#11365</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11431 rel="external nofollow noreferrer" target=_blank>#11431</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>以 nan 为点修复 pointInPolygon. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11375 rel="external nofollow noreferrer" target=_blank>#11375</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11421 rel="external nofollow noreferrer" target=_blank>#11421</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li> <li>修复 JOIN 在 LowCarinality(T) 和 Nullable(T) 上的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/issues/11380 rel="external nofollow noreferrer" target=_blank>#11380</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11414 rel="external nofollow noreferrer" target=_blank>#11414</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复错误 <code class=syntax>USING</code> 键的错误代码. <a href=https://github.com/ClickHouse/ClickHouse/issues/11373 rel="external nofollow noreferrer" target=_blank>#11373</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11404 rel="external nofollow noreferrer" target=_blank>#11404</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了带有纬度/经度范围之外的参数的 geohashesInBox. <a href=https://github.com/ClickHouse/ClickHouse/pull/11403 rel="external nofollow noreferrer" target=_blank>#11403</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li><code class=syntax>joinGet()</code> 函数更好的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/11389 rel="external nofollow noreferrer" target=_blank>#11389</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复具有外部排序和限制的查询可能出现的 <code class=syntax>Pipeline stuck</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11359 rel="external nofollow noreferrer" target=_blank>#11359</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11366 rel="external nofollow noreferrer" target=_blank>#11366</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>在 ReplicatedMergeTree 中发送零件期间删除冗余锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/11354 rel="external nofollow noreferrer" target=_blank>#11354</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了多行模式下 clickhouse-client 对 <code class=syntax>\G</code>（垂直输出）的支持. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/9933 rel="external nofollow noreferrer" target=_blank>#9933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11350 rel="external nofollow noreferrer" target=_blank>#11350</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复直接从 StorageJoin 选择 (没有 JOIN) 时的崩溃和错误的可空性. <a href=https://github.com/ClickHouse/ClickHouse/pull/11340 rel="external nofollow noreferrer" target=_blank>#11340</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复 <code class=syntax>quantilesExactWeightedArray</code> 中的崩溃问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/11337 rel="external nofollow noreferrer" target=_blank>#11337</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>现在合并在 <code class=syntax>ALTER</code> 查询中更改元数据之前停止. <a href=https://github.com/ClickHouse/ClickHouse/pull/11335 rel="external nofollow noreferrer" target=_blank>#11335</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>通过再次设置 <code class=syntax>parallel_view_processing = 1</code> 并行写入 <code class=syntax>MATERIALIZED VIEW</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11330 rel="external nofollow noreferrer" target=_blank>#11330</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当提取的 JSON 具有不平衡的 { 或 [ 字符串时, 修复visitParamExtractRaw. <a href=https://github.com/ClickHouse/ClickHouse/pull/11318 rel="external nofollow noreferrer" target=_blank>#11318</a> (<a href=https://github.com/devwout rel="external nofollow noreferrer" target=_blank>Ewout</a>).</li> <li>修复 ThreadPool 中非常罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/11314 rel="external nofollow noreferrer" target=_blank>#11314</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复转换中潜在的未初始化内存. 示例: <code class=syntax>SELECT toIntervalSecond(now64())</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11311 rel="external nofollow noreferrer" target=_blank>#11311</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了如果表的主键中有 Array 列并且查询正在使用 <code class=syntax>empty</code> 或 <code class=syntax>notEmpty</code> 函数按此列过滤时索引分析无法工作的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11286 rel="external nofollow noreferrer" target=_blank>#11286</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11303 rel="external nofollow noreferrer" target=_blank>#11303</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复当查询速度估计可能不正确时的错误, 并且如果查询受到 <code class=syntax>max_network_bandwidth</code>、<code class=syntax>max_execution_speed</code> 或 <code class=syntax>priority</code> 设置的限制, <code class=syntax>min_execution_speed</code> 的限制可能无法工作或无法正常工作. 将 <code class=syntax>timeout_before_checking_execution_speed</code> 的默认值更改为非零值, 否则设置 <code class=syntax>min_execution_speed</code> 和 <code class=syntax>max_execution_speed</code> 无效. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11297 rel="external nofollow noreferrer" target=_blank>#11297</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5732 rel="external nofollow noreferrer" target=_blank>#5732</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6228 rel="external nofollow noreferrer" target=_blank>#6228</a>. 可用性改进：避免在 <code class=syntax>clickhouse-client</code> 中将异常消息与进度条串联. <a href=https://github.com/ClickHouse/ClickHouse/pull/11296 rel="external nofollow noreferrer" target=_blank>#11296</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复读取 Protobuf 格式错误数据时崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5957 rel="external nofollow noreferrer" target=_blank>#5957</a>, fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11203 rel="external nofollow noreferrer" target=_blank>#11203</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11258 rel="external nofollow noreferrer" target=_blank>#11258</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复了缓存字典可以返回默认值而不是正常值 (只有过期键时) 的错误. 这仅影响字符串字段. <a href=https://github.com/ClickHouse/ClickHouse/pull/11233 rel="external nofollow noreferrer" target=_blank>#11233</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复错误 <code class=syntax>Block structure mismatch in QueryPipeline</code> , 同时从内部查询中的常量读取 <code class=syntax>VIEW</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11181 rel="external nofollow noreferrer" target=_blank>#11181</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11205 rel="external nofollow noreferrer" target=_blank>#11205</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复可能的异常 <code class=syntax>Invalid status for associated output</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11200 rel="external nofollow noreferrer" target=_blank>#11200</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用 <code class=syntax>Array(Array(LowCardinality))</code> 捕获参数修复高阶函数的可能错误 <code class=syntax>Cannot capture column</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11185 rel="external nofollow noreferrer" target=_blank>#11185</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 S3 globbing 在超过 1000 个密钥和一些后端的情况下可能会失败的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/11179 rel="external nofollow noreferrer" target=_blank>#11179</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> <li>如果数据跳过索引依赖于将在后台合并期间修改的列 (对于 SummingMergeTree、AggregatingMergeTree 以及 TTL GROUP BY), 则计算错误. 此问题已通过合并后移动索引计算得到修复, 因此索引是在合并数据上计算的. <a href=https://github.com/ClickHouse/ClickHouse/pull/11162 rel="external nofollow noreferrer" target=_blank>#11162</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复简单查询过多的线程预留 (优化减少线程数量, 在管道更改后部分中断). <a href=https://github.com/ClickHouse/ClickHouse/pull/11114 rel="external nofollow noreferrer" target=_blank>#11114</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复分布式查询的谓词优化 (<code class=syntax>enable_optimize_predicate_expression=1</code>) 对于带有 <code class=syntax>HAVING</code> 部分的查询 (即需要在服务器启动器上进行过滤时), 通过保留表达式的顺序 (这足以修复), 并且还强制 聚合器在索引上使用列名. 修复: <a href=https://github.com/ClickHouse/ClickHouse/issues/10613 rel="external nofollow noreferrer" target=_blank>#10613</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/11413 rel="external nofollow noreferrer" target=_blank>#11413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10621 rel="external nofollow noreferrer" target=_blank>#10621</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>引入提交重试逻辑, 以减少在极少数情况下, 偏移提交失败时从 Kafka 获取重复项的可能性. <a href=https://github.com/ClickHouse/ClickHouse/pull/9884 rel="external nofollow noreferrer" target=_blank>#9884</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> </ul> <h4 id=xing-neng-gai-jin_14>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_14 title="Permanent link"> </a></h4> <ul> <li>每次调用读取外部字典的任何函数时, 仅获取一次字典并检查访问权限. <a href=https://github.com/ClickHouse/ClickHouse/pull/10928 rel="external nofollow noreferrer" target=_blank>#10928</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_17>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_17 title="Permanent link"> </a></h4> <ul> <li>修复几个不稳定的集成测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/11355 rel="external nofollow noreferrer" target=_blank>#11355</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-10-75-lts-2020-05-23>ClickHouse 版本 v20.3.10.75-lts 2020-05-23<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-10-75-lts-2020-05-23 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_41>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_41 title="Permanent link"> </a></h4> <ul> <li>如果没有最终确定, 则从突变终止任务中删除日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/11109 rel="external nofollow noreferrer" target=_blank>#11109</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 <code class=syntax>parseDateTime64BestEffort</code> 参数解析错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/11038 rel="external nofollow noreferrer" target=_blank>#11038</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>修复了方法 <code class=syntax>getRawData()</code> 中不正确的原始数据大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/10964 rel="external nofollow noreferrer" target=_blank>#10964</a> (<a href=https://github.com/ObjatieGroba rel="external nofollow noreferrer" target=_blank>Igr</a>).</li> <li>修复了 20.1 及更早版本之间两级聚合的不兼容问题. 当在启动器节点和远程节点上使用不同版本的 ClickHouse 并且 <code class=syntax>GROUP BY</code> 结果的大小很大并且聚合由单个 <code class=syntax>String</code> 字段执行时, 就会发生这种不兼容性. 结果导致单个键的多个未合并的行. <a href=https://github.com/ClickHouse/ClickHouse/pull/10952 rel="external nofollow noreferrer" target=_blank>#10952</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了与 <code class=syntax>Distributed</code> 表中元组的向后兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/10889 rel="external nofollow noreferrer" target=_blank>#10889</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>如果这样的键不存在, 则修复了 <code class=syntax>StringHashTable</code> 中的 <code class=syntax>SIGSEGV</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10870 rel="external nofollow noreferrer" target=_blank>#10870</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>ReplicatedMergeTree</code> 中的错误, 该错误可能导致 <code class=syntax>OPTIMIZE</code> 查询上的某些 <code class=syntax>ALTER</code> 在它变为非活动状态后挂起等待某些副本. <a href=https://github.com/ClickHouse/ClickHouse/pull/10849 rel="external nofollow noreferrer" target=_blank>#10849</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复 <code class=syntax>Block::sortColumns()</code> 之后的列顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/10826 rel="external nofollow noreferrer" target=_blank>#10826</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了当不要求引用标识符时 <code class=syntax>ODBC</code> 桥的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7984 rel="external nofollow noreferrer" target=_blank>#7984</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10821 rel="external nofollow noreferrer" target=_blank>#10821</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 <code class=syntax>DateLUT</code> 中的 <code class=syntax>UBSan</code> 和 <code class=syntax>MSan</code> 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/10798 rel="external nofollow noreferrer" target=_blank>#10798</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了关键条件下错误的类型转换. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/6287 rel="external nofollow noreferrer" target=_blank>#6287</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10791 rel="external nofollow noreferrer" target=_blank>#10791</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li> <li>修复了 <code class=syntax>parallel_view_processing</code> 行为. 现在, 如果发生异常, 所有对 <code class=syntax>MATERIALIZED VIEW</code> 的插入都应该无一例外地完成. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10757 rel="external nofollow noreferrer" target=_blank>#10757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了组合符 <code class=syntax>-OrNull</code> 和 <code class=syntax>-OrDefault</code> 与 <code class=syntax>-State</code> 组合时的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10741 rel="external nofollow noreferrer" target=_blank>#10741</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>修复了带有嵌套类型的 <code class=syntax>generateRandom</code> 中的崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10583 rel="external nofollow noreferrer" target=_blank>#10583</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10734 rel="external nofollow noreferrer" target=_blank>#10734</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了合并后可能发生的 <code class=syntax>SummingMergeTree</code> 中 <code class=syntax>LowCardinality(FixedString)</code> 键列的数据损坏. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10489 rel="external nofollow noreferrer" target=_blank>#10489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10721 rel="external nofollow noreferrer" target=_blank>#10721</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了函数 <code class=syntax>h3EdgeAngle</code> 中可能出现的缓冲区溢出. <a href=https://github.com/ClickHouse/ClickHouse/pull/10711 rel="external nofollow noreferrer" target=_blank>#10711</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了消失的总数. 如果查询具有连接或具有外部 where 条件的子查询, 则总计可能已被过滤. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10674 rel="external nofollow noreferrer" target=_blank>#10674</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10698 rel="external nofollow noreferrer" target=_blank>#10698</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了在一个查询中具有相同集合的 <code class=syntax>IN</code> 运算符的多次使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10686 rel="external nofollow noreferrer" target=_blank>#10686</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了当 <code class=syntax>readonly=2</code> 和 <code class=syntax>cancel_http_readonly_queries_on_client_close=1</code> 时导致 http 请求卡在客户端关闭的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7939 rel="external nofollow noreferrer" target=_blank>#7939</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7019 rel="external nofollow noreferrer" target=_blank>#7019</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7736 rel="external nofollow noreferrer" target=_blank>#7736</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7091 rel="external nofollow noreferrer" target=_blank>#7091</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10684 rel="external nofollow noreferrer" target=_blank>#10684</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了 <code class=syntax>AggregateTransform</code> 构造函数中参数的顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/10667 rel="external nofollow noreferrer" target=_blank>#10667</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>).</li> <li>修复了启用 <code class=syntax>distributed_aggregation_memory_efficient</code> 时远程查询缺乏并行执行的问题. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/10655 rel="external nofollow noreferrer" target=_blank>#10655</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10664 rel="external nofollow noreferrer" target=_blank>#10664</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了使用 <code class=syntax>LIMIT</code> 的查询可能不正确的行数. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10566 rel="external nofollow noreferrer" target=_blank>#10566</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10709 rel="external nofollow noreferrer" target=_blank>#10709</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10660 rel="external nofollow noreferrer" target=_blank>#10660</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了当表有很多部分时锁定并发更改的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10659 rel="external nofollow noreferrer" target=_blank>#10659</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了在 <code class=syntax>SYSTEM DROP DNS CACHE</code> 查询也删除缓存时的错误, 用于检查是否允许用户从某些 IP 地址连接. <a href=https://github.com/ClickHouse/ClickHouse/pull/10608 rel="external nofollow noreferrer" target=_blank>#10608</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了 <code class=syntax>MATERIALIZED VIEW</code> 内部查询中不正确的标量结果, 以防该查询包含相关表. <a href=https://github.com/ClickHouse/ClickHouse/pull/10603 rel="external nofollow noreferrer" target=_blank>#10603</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了列 <code class=syntax>ALIAS</code> 的 <code class=syntax>SELECT</code>, 它的默认表达式类型与列类型不同. <a href=https://github.com/ClickHouse/ClickHouse/pull/10563 rel="external nofollow noreferrer" target=_blank>#10563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>实现了 DateTime64 和 String 值之间的比较. <a href=https://github.com/ClickHouse/ClickHouse/pull/10560 rel="external nofollow noreferrer" target=_blank>#10560</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>修复索引损坏, 在某些情况下将紧凑部分合并到另一个紧凑部分后可能会发生. <a href=https://github.com/ClickHouse/ClickHouse/pull/10531 rel="external nofollow noreferrer" target=_blank>#10531</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复了所有部分mutation完成后, 在 <code class=syntax>is_done=0</code> 中挂掉的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/10526 rel="external nofollow noreferrer" target=_blank>#10526</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 unix 纪元开始时与 <code class=syntax>UTC</code> 有小数偏移的时区溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9335 rel="external nofollow noreferrer" target=_blank>#9335</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10513 rel="external nofollow noreferrer" target=_blank>#10513</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了 <code class=syntax>Distributed</code> 存储的不当关闭. <a href=https://github.com/ClickHouse/ClickHouse/pull/10491 rel="external nofollow noreferrer" target=_blank>#10491</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>simpleLinearRegression</code> 中大整数上的数字溢出. <a href=https://github.com/ClickHouse/ClickHouse/pull/10474 rel="external nofollow noreferrer" target=_blank>#10474</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_18>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_18 title="Permanent link"> </a></h4> <ul> <li>修复 LZ4 库中的 UBSan 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/10631 rel="external nofollow noreferrer" target=_blank>#10631</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 clang-10 构建. <a href=https://github.com/ClickHouse/ClickHouse/issues/10238 rel="external nofollow noreferrer" target=_blank>#10238</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10370 rel="external nofollow noreferrer" target=_blank>#10370</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>添加了关于 <code class=syntax>max_rows_to_sort</code> 设置的失败测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/10268 rel="external nofollow noreferrer" target=_blank>#10268</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加了在输入格式中打印诊断信息的一些改进. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10204 rel="external nofollow noreferrer" target=_blank>#10204</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10418 rel="external nofollow noreferrer" target=_blank>#10418</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>将 CA 证书添加到 clickhouse-server docker 镜像. <a href=https://github.com/ClickHouse/ClickHouse/pull/10476 rel="external nofollow noreferrer" target=_blank>#10476</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> </ul> <h4 id=bug-xiu-fu_42>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_42 title="Permanent link"> </a></h4> <ul> <li>修复错误 <code class=syntax>the BloomFilter false positive must be a double number between 0 and 1</code> <a href=https://github.com/ClickHouse/ClickHouse/issues/10551 rel="external nofollow noreferrer" target=_blank>#10551</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10569 rel="external nofollow noreferrer" target=_blank>#10569</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-8-53-2020-04-23>ClickHouse 版本 v20.3.8.53, 2020-04-23<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-8-53-2020-04-23 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_43>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_43 title="Permanent link"> </a></h4> <ul> <li>修复了时区的日期时间函数的错误行为, 这些时区在 UTC 的正负偏移量之间发生了变化 (例如 Pacific/Kiritimati). 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/7202 rel="external nofollow noreferrer" target=_blank>#7202</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10369 rel="external nofollow noreferrer" target=_blank>#10369</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复启用 <code class=syntax>distributed_group_by_no_merge</code> 时可能出现的段错误 (在 20.3.7.46 中由 <a href=https://github.com/ClickHouse/ClickHouse/issues/10131 rel="external nofollow noreferrer" target=_blank>#10131</a> 引入). <a href=https://github.com/ClickHouse/ClickHouse/pull/10399 rel="external nofollow noreferrer" target=_blank>#10399</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复 <code class=syntax>Array(Tuple(...))</code> 数据类型的错误扁平化. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10259 rel="external nofollow noreferrer" target=_blank>#10259</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10390 rel="external nofollow noreferrer" target=_blank>#10390</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在聚合器中删除磁盘预留. 这修复了磁盘空间预留的错误, 该错误可能导致大型外部聚合即使成功完成也可能失败. <a href=https://github.com/ClickHouse/ClickHouse/pull/10375 rel="external nofollow noreferrer" target=_blank>#10375</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复了 <code class=syntax>ReplicatedMergeTree</code> 中的 <code class=syntax>DROP</code> 与 <code class=syntax>OPTIMIZE</code> 竞赛. 如果存在并发的 OPTIMIZE 查询, 则 DROP 可能会在 ZooKeeper 的副本路径中留下一些垃圾. <a href=https://github.com/ClickHouse/ClickHouse/pull/10312 rel="external nofollow noreferrer" target=_blank>#10312</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复更改列默认值后服务器无法附加表的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10441 rel="external nofollow noreferrer" target=_blank>#10441</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>在加载表之前附加数据库失败时不要删除元数据目录. <a href=https://github.com/ClickHouse/ClickHouse/pull/10442 rel="external nofollow noreferrer" target=_blank>#10442</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>修复了一些错误, 当某些数据以法定人数插入, 然后以某种方式删除 (DROP PARTITION, TTL) 时, 这会导致插入卡住或 SELECT 中的误报异常. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9946 rel="external nofollow noreferrer" target=_blank>#9946</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10188 rel="external nofollow noreferrer" target=_blank>#10188</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>修复 <code class=syntax>ConcatProcessor</code> 中可能发生的 <code class=syntax>Pipeline stuck</code> 错误，该错误可能发生在远程查询中. <a href=https://github.com/ClickHouse/ClickHouse/pull/10381 rel="external nofollow noreferrer" target=_blank>#10381</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了 HashTable 中尝试从缓冲区读取 HashMap 时导致编译错误的错误行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/10386 rel="external nofollow noreferrer" target=_blank>#10386</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>)</li> <li>允许对多个 JOIN 使用 <code class=syntax>count(*)</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9853 rel="external nofollow noreferrer" target=_blank>#9853</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10291 rel="external nofollow noreferrer" target=_blank>#10291</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>更喜欢 <code class=syntax>fallback_to_stale_replicas</code> 而不是 <code class=syntax>skip_unavailable_shards</code>, 否则当两个设置都指定并且没有最新的副本时, 查询将失败 (来自@alex-zaitsev的补丁). 修复: <a href=https://github.com/ClickHouse/ClickHouse/issues/2564 rel="external nofollow noreferrer" target=_blank>#2564</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10422 rel="external nofollow noreferrer" target=_blank>#10422</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复带有 ARRAY JOIN、ORDER BY 和 LIMIT 的查询可能返回不完整结果的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10226 rel="external nofollow noreferrer" target=_blank>#10226</a>. 作者: <a href=https://github.com/VadimPlh rel="external nofollow noreferrer" target=_blank>Vadim Plakhtinskiy</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10427 rel="external nofollow noreferrer" target=_blank>#10427</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>创建 BloomFilter 索引时检查参数的数量和类型. <a href=https://github.com/ClickHouse/ClickHouse/issues/9623 rel="external nofollow noreferrer" target=_blank>#9623</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/10431 rel="external nofollow noreferrer" target=_blank>#10431</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> </ul> <h4 id=xing-neng-gai-jin_15>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_15 title="Permanent link"> </a></h4> <ul> <li>在 <code class=syntax>IN</code> 运算符的右侧显式定义的集合和左侧的元组提高了查询的性能. 这修复了 20.3 版中的性能回归. <a href=https://github.com/ClickHouse/ClickHouse/pull/9740 rel="external nofollow noreferrer" target=_blank>#9740</a>, <a href=https://github.com/ClickHouse/ClickHouse/pull/10385 rel="external nofollow noreferrer" target=_blank>#10385</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-7-46-2020-04-17>ClickHouse 版本 v20.3.7.46, 2020-04-17<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-7-46-2020-04-17 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_44>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_44 title="Permanent link"> </a></h4> <ul> <li>修复 <code class=syntax>Logical error: CROSS JOIN has expressions</code> 错误, 用于使用逗号和名称连接混合的查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/10311 rel="external nofollow noreferrer" target=_blank>#10311</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>使用 <code class=syntax>max_bytes_before_external_group_by</code> 修复查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/10302 rel="external nofollow noreferrer" target=_blank>#10302</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>在存在数组连接函数的情况下修复移动到前置位置优化 (在某些情况下). 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/10092 rel="external nofollow noreferrer" target=_blank>#10092</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10195 rel="external nofollow noreferrer" target=_blank>#10195</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加放宽对使用 <code class=syntax>allow_nondeterministic_mutations</code> 设置的突变中非确定性函数使用限制的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/10186 rel="external nofollow noreferrer" target=_blank>#10186</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-6-40-2020-04-16>ClickHouse 版本 v20.3.6.40, 2020-04-16<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-6-40-2020-04-16 title="Permanent link"> </a></h3> <h4 id=xin-te-zheng_10>新特征<a class=headerlink href=../amp/#xin-te-zheng_10 title="Permanent link"> </a></h4> <ul> <li>添加函数 <code class=syntax>isConstant</code>. 此函数检查其参数是否为常量表达式并返回 1 或 0. 用于开发、调试和演示目的. <a href=https://github.com/ClickHouse/ClickHouse/pull/10198 rel="external nofollow noreferrer" target=_blank>#10198</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h4 id=bug-xiu-fu_45>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_45 title="Permanent link"> </a></h4> <ul> <li>使用 <code class=syntax>max_rows_to_group_by</code> 和 <code class=syntax>group_by_overflow_mode = 'break'</code> 修复错误 <code class=syntax>Pipeline stuck</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10279 rel="external nofollow noreferrer" target=_blank>#10279</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复罕见的可能异常 <code class=syntax>Cannot drain connections: cancel first</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10239 rel="external nofollow noreferrer" target=_blank>#10239</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了 ClickHouse 会抛出 <code class=syntax>Unknown function lambda.</code> 的错误. 当用户尝试在 ENGINE = Replicated* 的表上运行 ALTER UPDATE/DELETE 时出现错误消息. 检查非确定性函数现在可以正确处理 lambda 表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/10237 rel="external nofollow noreferrer" target=_blank>#10237</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>修复了 Date 类型的 <code class=syntax>generateRandom</code> 函数. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9973 rel="external nofollow noreferrer" target=_blank>#9973</a>. 修复了将 2106 年的日期插入到使用旧式分区的 MergeTree 表但分区以 1970 年命名的边缘情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/10218 rel="external nofollow noreferrer" target=_blank>#10218</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>如果 View 的表定义与 SELECT 查询不对应，则转换类型. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10180 rel="external nofollow noreferrer" target=_blank>#10180</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/10022 rel="external nofollow noreferrer" target=_blank>#10022</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10217 rel="external nofollow noreferrer" target=_blank>#10217</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 RFC-2822 中字符串的 <code class=syntax>parseDateTimeBestEffort</code>, 当一周中的某一天是星期二或星期四时. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/10082 rel="external nofollow noreferrer" target=_blank>#10082</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10214 rel="external nofollow noreferrer" target=_blank>#10214</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 JOIN 内的常量列名可能与 JOIN 外的常量名冲突. <a href=https://github.com/ClickHouse/ClickHouse/pull/10207 rel="external nofollow noreferrer" target=_blank>#10207</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>当查询实际上应该在 LIMIT 停止时, 修复可能的无限查询执行, 同时从无限源 (如 <code class=syntax>system.numbers</code> 或 <code class=syntax>system.zeros</code> ) 读取. <a href=https://github.com/ClickHouse/ClickHouse/pull/10206 rel="external nofollow noreferrer" target=_blank>#10206</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复未指定数据库时使用当前数据库进行访问检查的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10192 rel="external nofollow noreferrer" target=_blank>#10192</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>如果结构在 INSERT 中不匹配, 则将块转换为 Distributed(). <a href=https://github.com/ClickHouse/ClickHouse/pull/10135 rel="external nofollow noreferrer" target=_blank>#10135</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复处理器管道中极端情况可能导致的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/10131 rel="external nofollow noreferrer" target=_blank>#10131</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>用合并部分修复某些类型的改动. <a href=https://github.com/ClickHouse/ClickHouse/pull/10130 rel="external nofollow noreferrer" target=_blank>#10130</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>在创建新副本时修复不正确的 <code class=syntax>index_granularity_bytes</code> 检查. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10098 rel="external nofollow noreferrer" target=_blank>#10098</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10121 rel="external nofollow noreferrer" target=_blank>#10121</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>当其结构与基础表不同时, 修复 INSERT 上的 SIGSEGV 到分布式表中. <a href=https://github.com/ClickHouse/ClickHouse/pull/10105 rel="external nofollow noreferrer" target=_blank>#10105</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 <code class=syntax>JOIN</code> 和 <code class=syntax>UNION ALL</code> 修复查询可能丢失的行. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9826 rel="external nofollow noreferrer" target=_blank>#9826</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10113 rel="external nofollow noreferrer" target=_blank>#10113</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10099 rel="external nofollow noreferrer" target=_blank>#10099</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了从不存在 <code class=syntax>/table/replicas/replica_name/metadata</code> 节点的旧 ClickHouse 版本更新时复制表启动的问题. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10037 rel="external nofollow noreferrer" target=_blank>#10037</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10095 rel="external nofollow noreferrer" target=_blank>#10095</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>为 MySQL 数据库引擎添加一些参数检查和支持标识符参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/10077 rel="external nofollow noreferrer" target=_blank>#10077</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复来自 localhost clickhouse 服务器的 clickhouse 字典源中的错误. 如果字典和源中的类型不兼容, 该错误可能会导致内存损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/10071 rel="external nofollow noreferrer" target=_blank>#10071</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>当表包含跳过索引时, 修复<code class=syntax>CHECK TABLE</code>查询中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/10068 rel="external nofollow noreferrer" target=_blank>#10068</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复错误 <code class=syntax>Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. 当设置 <code class=syntax>distributed_aggregation_memory_efficient</code> 被启用, 并且分布式查询从不同分片读取不同级别的聚合数据时发生这种情况 (混合单级和二级聚合). <a href=https://github.com/ClickHouse/ClickHouse/pull/10063 rel="external nofollow noreferrer" target=_blank>#10063</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 GROUP BY 中可能发生的分段错误, 该错误是包含尾随零字节的字符串键 (<a href=https://github.com/ClickHouse/ClickHouse/issues/8636 rel="external nofollow noreferrer" target=_blank>#8636</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/8925 rel="external nofollow noreferrer" target=_blank>#8925</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10025 rel="external nofollow noreferrer" target=_blank>#10025</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>修复用于远程查询执行的线程数 (性能回归, 自 20.3 起). 当来自 <code class=syntax>Distributed</code> 表的查询在本地和远程分片上同时执行时, 就会发生这种情况. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9965 rel="external nofollow noreferrer" target=_blank>#9965</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9971 rel="external nofollow noreferrer" target=_blank>#9971</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了在某些数据库查询的处理阶段之一未检索到必要表的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9699 rel="external nofollow noreferrer" target=_blank>#9699</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9949 rel="external nofollow noreferrer" target=_blank>#9949</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>).</li> <li>修复 <code class=syntax>JOIN</code> 与 <code class=syntax>TOTALS</code> 一起出现时 <code class=syntax>Not found column in block</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9839 rel="external nofollow noreferrer" target=_blank>#9839</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9939 rel="external nofollow noreferrer" target=_blank>#9939</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复 <code class=syntax>ON CLUSTER</code> DDL 查询在服务器启动时冻结的错误 <a href=https://github.com/ClickHouse/ClickHouse/pull/9927 rel="external nofollow noreferrer" target=_blank>#9927</a> (<a href=https://github.com/garneja rel="external nofollow noreferrer" target=_blank>Gagan Arneja</a>).</li> <li>修复解析 CREATE USER 命令中设置的多个主机, 例如 <code class=syntax>CREATE USER user6 HOST NAME REGEXP 'lo.?*host', NAME REGEXP 'lo*host'</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9924 rel="external nofollow noreferrer" target=_blank>#9924</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复连接表引擎的 <code class=syntax>TRUNCATE</code> (<a href=https://github.com/ClickHouse/ClickHouse/issues/9917 rel="external nofollow noreferrer" target=_blank>#9917</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9920 rel="external nofollow noreferrer" target=_blank>#9920</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复 ALTER 中的 <code class=syntax>scalar does not exist</code> 错误 (<a href=https://github.com/ClickHouse/ClickHouse/issues/9878 rel="external nofollow noreferrer" target=_blank>#9878</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9904 rel="external nofollow noreferrer" target=_blank>#9904</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复 <code class=syntax>ReplicatedMergeTree</code> 中删除和优化之间的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/9901 rel="external nofollow noreferrer" target=_blank>#9901</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复 <code class=syntax>distributed_product_mode='local'</code> 中的限定名称错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/4756 rel="external nofollow noreferrer" target=_blank>#4756</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9891 rel="external nofollow noreferrer" target=_blank>#9891</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复了设置 <code class=syntax>allow_introspection_functions</code> 中内省函数的计算授权. <a href=https://github.com/ClickHouse/ClickHouse/pull/9840 rel="external nofollow noreferrer" target=_blank>#9840</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_19>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_19 title="Permanent link"> </a></h4> <ul> <li>修复集成测试<code class=syntax>test_settings_constraints</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9962 rel="external nofollow noreferrer" target=_blank>#9962</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>删除了对 <code class=syntax>clock_getres</code> 的依赖. <a href=https://github.com/ClickHouse/ClickHouse/pull/9833 rel="external nofollow noreferrer" target=_blank>#9833</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-5-21-2020-03-27>ClickHouse 版本 v20.3.5.21, 2020-03-27<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-5-21-2020-03-27 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_46>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_46 title="Permanent link"> </a></h4> <ul> <li>当查询在分布式表上具有 PREWHERE 和 WHERE 并且 <code class=syntax>SET distributed_product_mode = 'local'</code> 时, 修复 <code class=syntax>Different expressions with the same alias</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9871 rel="external nofollow noreferrer" target=_blank>#9871</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复具有复合主键的表的突变过多的内存消耗. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/9850 rel="external nofollow noreferrer" target=_blank>#9850</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9860 rel="external nofollow noreferrer" target=_blank>#9860</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>对于 INSERT 查询, 分片现在将从发起者获得的设置限制在分片的约束中, 而不是抛出异常. 此修复允许将 INSERT 查询发送到具有其他约束的分片. 此更改改进了修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9447 rel="external nofollow noreferrer" target=_blank>#9447</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9852 rel="external nofollow noreferrer" target=_blank>#9852</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复 <code class=syntax>COMMA to CROSS JOIN rewriter is not enabled or cannot rewrite query</code> 错误, 以防在表列表中使用 COMMA JOIN 进行子查询 (即在 WHERE 中). 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/9782 rel="external nofollow noreferrer" target=_blank>#9782</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9830 rel="external nofollow noreferrer" target=_blank>#9830</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复客户端上可能出现的异常 <code class=syntax>Got 0 in totals chunk, expected 1</code> on client. 如果右连接表有零行, 则使用“JOIN”进行查询时会发生这种情况. 示例: <code class=syntax>select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9777 rel="external nofollow noreferrer" target=_blank>#9777</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9823 rel="external nofollow noreferrer" target=_blank>#9823</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>无法转换类型时使用 optimize_skip_unused_shards 修复 SIGSEGV. <a href=https://github.com/ClickHouse/ClickHouse/pull/9804 rel="external nofollow noreferrer" target=_blank>#9804</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复损坏的 <code class=syntax>ALTER TABLE DELETE COLUMN</code> 查询合并部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/9779 rel="external nofollow noreferrer" target=_blank>#9779</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复 max_distributed_connections (带和不带处理器). <a href=https://github.com/ClickHouse/ClickHouse/pull/9673 rel="external nofollow noreferrer" target=_blank>#9673</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了函数参数的时区使用不正确的一些情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/9574 rel="external nofollow noreferrer" target=_blank>#9574</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> </ul> <h4 id=gai-jin_19>改进<a class=headerlink href=../amp/#gai-jin_19 title="Permanent link"> </a></h4> <ul> <li>由于我们从单个线程中的单个有序部分读取, 因此逐阶段从突变中删除顺序. 还添加检查突变中的行顺序是否按排序键顺序排序并且不违反此顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/9886 rel="external nofollow noreferrer" target=_blank>#9886</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-4-10-2020-03-20>ClickHouse 版本 v20.3.4.10, 2020-03-20<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-4-10-2020-03-20 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_47>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_47 title="Permanent link"> </a></h4> <ul> <li>此版本还包含 20.1.8.41 的所有错误修复.</li> <li>修复丢失的 <code class=syntax>rows_before_limit_at_least</code> 用于通过 http (使用处理器管道) 的查询. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9730 rel="external nofollow noreferrer" target=_blank>#9730</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9757 rel="external nofollow noreferrer" target=_blank>#9757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-3-6-2020-03-17>ClickHouse 版本 v20.3.3.6, 2020-03-17<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-3-6-2020-03-17 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_48>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_48 title="Permanent link"> </a></h4> <ul> <li>此版本还包含 20.1.7.38 的所有错误修复.</li> <li>修复复制中的错误, 如果用户在以前的版本上执行了更改, 则不允许复制工作. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9645 rel="external nofollow noreferrer" target=_blank>#9645</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9652 rel="external nofollow noreferrer" target=_blank>#9652</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>). It makes version 20.3 backward compatible again.</li> <li>添加设置 <code class=syntax>use_compact_format_in_distributed_parts_names</code> , 它允许将 <code class=syntax>INSERT</code> 查询的文件以更紧凑的格式写入 <code class=syntax>Distributed</code> 表. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9647 rel="external nofollow noreferrer" target=_blank>#9647</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9653 rel="external nofollow noreferrer" target=_blank>#9653</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>). 它使 20.3 版再次向后兼容.</li> </ul> <h3 id=clickhouse-ban-ben-v20-3-2-1-2020-03-12>ClickHouse 版本 v20.3.2.1, 2020-03-12<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-3-2-1-2020-03-12 title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng_9>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng_9 title="Permanent link"> </a></h4> <ul> <li>修复了为大量副本的 <code class=syntax>Distributed</code> 表发送数据时 <code class=syntax>file name too long</code> 的问题. 修复了副本凭据在服务器日志中暴露的问题. 磁盘目录名格式改为 <code class=syntax>[shard{shard_index}[_replica{replica_index}]]</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8911 rel="external nofollow noreferrer" target=_blank>#8911</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>) 升级到新版本后, 您将不会无需人工干预即可降级, 因为旧服务器版本无法识别新目录格式. 如果要降级, 则必须手动将相应目录重命名为旧格式. 仅当您对 <code class=syntax>Distributed</code> 表使用异步 <code class=syntax>INSERT</code> 时, 此更改才相关. 在 20.3.3 版本中, 我们将引入一个设置, 允许您逐步启用新格式.</li> <li>更改了突变命令的复制日志条目的格式. 在安装新版本之前, 您必须等待旧的突变处理.</li> <li>实现简单的内存分析器, 在超过软分配限制 <a href=https://github.com/ClickHouse/ClickHouse/pull/8765 rel="external nofollow noreferrer" target=_blank>#8765</a> (<a href="https:// github.com/abyss7" rel="external nofollow noreferrer" target=_blank>Ivan</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/9472 rel="external nofollow noreferrer" target=_blank>#9472</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) 专栏 <code class=syntax>system.trace_log</code> 的内容从 <code class=syntax>timer_type</code> 重命名为 <code class=syntax>trace_type</code>. 这将需要更改第三方性能分析和火焰图处理工具.</li> <li>在任何地方使用 OS 线程 id 而不是内部线程号. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7477 rel="external nofollow noreferrer" target=_blank>#7477</a> 当启用设置 <code class=syntax>send_logs_level</code> 时, 旧的 <code class=syntax>clickhouse-client</code> 无法接收从服务器发送的日志, 因为名称和结构化日志消息的类型已更改. 另一方面, 不同的服务器版本可以相互发送不同类型的日志. 当你不使用 <code class=syntax>send_logs_level</code> 设置时, 你应该不在乎. <a href=https://github.com/ClickHouse/ClickHouse/pull/8954 rel="external nofollow noreferrer" target=_blank>#8954</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>移除 <code class=syntax>indexHint</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/9542 rel="external nofollow noreferrer" target=_blank>#9542</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>移除 <code class=syntax>findClusterIndex</code>、<code class=syntax>findClusterValue</code> 函数. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8641 rel="external nofollow noreferrer" target=_blank>#8641</a>. 如果您正在使用这些功能, 请发送电子邮件至 <code class=syntax>clickhouse-feedback@yandex-team.com</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9543 rel="external nofollow noreferrer" target=_blank>#9543</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>现在不允许使用 <code class=syntax>SELECT</code> 子查询作为默认表达式创建列或添加列. <a href=https://github.com/ClickHouse/ClickHouse/pull/9481 rel="external nofollow noreferrer" target=_blank>#9481</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>JOIN 中的子查询需要别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/9274 rel="external nofollow noreferrer" target=_blank>#9274</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>改进了 <code class=syntax>ALTER MODIFY/ADD</code> 查询逻辑. 现在你不能在没有类型的情况下 <code class=syntax>ADD</code> 列, <code class=syntax>MODIFY</code> 默认表达式不会改变列的类型, <code class=syntax>MODIFY</code> 类型不会丢失默认表达式值. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/8669 rel="external nofollow noreferrer" target=_blank>#8669</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9227 rel="external nofollow noreferrer" target=_blank>#9227</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>需要重新启动服务器以应用日志配置中的更改. 这是一个临时解决方法, 以避免服务器记录到已删除的日志文件的错误 (请参阅 <a href=https://github.com/ClickHouse/ClickHouse/issues/8696 rel="external nofollow noreferrer" target=_blank>#8696</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8707 rel="external nofollow noreferrer" target=_blank>#8707</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>默认情况下启用设置 <code class=syntax>experimental_use_processors</code>. 此设置启用新查询管道的使用. 这是内部重构, 我们预计不会有明显的变化. 如果您会看到任何问题, 请将其设置为零. <a href=https://github.com/ClickHouse/ClickHouse/pull/8768 rel="external nofollow noreferrer" target=_blank>#8768</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=xin-te-zheng_11>新特征<a class=headerlink href=../amp/#xin-te-zheng_11 title="Permanent link"> </a></h4> <ul> <li>添加 <code class=syntax>Avro</code> 和 <code class=syntax>AvroConfluent</code> 输入/输出格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/8571 rel="external nofollow noreferrer" target=_blank>#8571</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8957 rel="external nofollow noreferrer" target=_blank>#8957</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8717 rel="external nofollow noreferrer" target=_blank>#8717</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>cache</code> 字典中过期键的多线程和非阻塞更新 (具有读取旧键的可选权限). <a href=https://github.com/ClickHouse/ClickHouse/pull/8303 rel="external nofollow noreferrer" target=_blank>#8303</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>添加查询 <code class=syntax>ALTER ... MATERIALIZE TTL</code>. 它运行突变, 强制通过 TTL 删除过期数据并重新计算有关 TTL 的所有部分的元信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/8775 rel="external nofollow noreferrer" target=_blank>#8775</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>如果需要, 从 HashJoin 切换到 MergeJoin (在磁盘上). <a href=https://github.com/ClickHouse/ClickHouse/pull/9082 rel="external nofollow noreferrer" target=_blank>#9082</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>为 <code class=syntax>ALTER TABLE</code> 添加了 <code class=syntax>MOVE PARTITION</code> 命令. <a href=https://github.com/ClickHouse/ClickHouse/issues/4729 rel="external nofollow noreferrer" target=_blank>#4729</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/6168 rel="external nofollow noreferrer" target=_blank>#6168</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>即时从配置文件重新加载存储配置. <a href=https://github.com/ClickHouse/ClickHouse/pull/8594 rel="external nofollow noreferrer" target=_blank>#8594</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>允许将 <code class=syntax>storage_policy</code> 更改为不那么丰富的一个. <a href=https://github.com/ClickHouse/ClickHouse/pull/8107 rel="external nofollow noreferrer" target=_blank>#8107</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>添加了对 S3 存储和表功能的通配符/通配符的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/8851 rel="external nofollow noreferrer" target=_blank>#8851</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>为 <code class=syntax>FixedString(N)</code> 数据类型实现 <code class=syntax>bitAnd</code>、<code class=syntax>bitOr</code>、<code class=syntax>bitXor</code>、<code class=syntax>bitNot</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9091 rel="external nofollow noreferrer" target=_blank>#9091</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>添加函数 <code class=syntax>bitCount</code> . 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8702 rel="external nofollow noreferrer" target=_blank>#8702</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8708 rel="external nofollow noreferrer" target=_blank>#8708</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8749 rel="external nofollow noreferrer" target=_blank>#8749</a> (<a href=https://github.com/ikopylov rel="external nofollow noreferrer" target=_blank>ikopylov</a>)</li> <li>添加 <code class=syntax>generateRandom</code> 表函数以生成具有给定模式的随机行. 允许用数据填充任意测试表. <a href=https://github.com/ClickHouse/ClickHouse/pull/8994 rel="external nofollow noreferrer" target=_blank>#8994</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li> <li><code class=syntax>JSONEachRowFormat</code>: 当对象包含在顶级数组中时支持特殊情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/8860 rel="external nofollow noreferrer" target=_blank>#8860</a> (<a href=https://github.com/Avogar rel="external nofollow noreferrer" target=_blank>Kruglov Pavel</a>)</li> <li>现在可以使用 <code class=syntax>DEFAULT</code> 表达式创建一个列, 该列依赖于具有默认 <code class=syntax>ALIAS</code> 表达式的列. <a href=https://github.com/ClickHouse/ClickHouse/pull/9489 rel="external nofollow noreferrer" target=_blank>#9489</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>允许在 <code class=syntax>clickhouse-obfuscator</code> 中指定大于源数据大小的 <code class=syntax>--limit</code>. 数据将用不同的随机种子重复. <a href=https://github.com/ClickHouse/ClickHouse/pull/9155 rel="external nofollow noreferrer" target=_blank>#9155</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了带有储层采样算法的 <code class=syntax>groupArraySample</code> 函数 (类似于 <code class=syntax>group Array</code> ). <a href=https://github.com/ClickHouse/ClickHouse/pull/8286 rel="external nofollow noreferrer" target=_blank>#8286</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>现在您可以通过系统指标监控 <code class=syntax>cache</code>/<code class=syntax>complex_key_cache</code> 字典中更新队列的大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/9413 rel="external nofollow noreferrer" target=_blank>#9413</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>允许使用 CRLF 作为 CSV 输出格式的行分隔符, 并将 <code class=syntax>output_format_csv_crlf_end_of_line</code> 设置为 1 <a href=https://github.com/ClickHouse/ClickHouse/pull/8934 rel="external nofollow noreferrer" target=_blank>#8934</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8935 rel="external nofollow noreferrer" target=_blank>#8935</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8963 rel="external nofollow noreferrer" target=_blank>#8963</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>实现<a href=https://github.com/uber/h3 rel="external nofollow noreferrer" target=_blank>H3</a> API的更多功能: <code class=syntax>h3GetBaseCell</code>、<code class=syntax>h3HexAreaM2</code>、<code class=syntax>h3IndexesAreNeighbors</code>、<code class=syntax>h3ToChildren</code>、<code class=syntax>h3ToString</code>和<code class=syntax>stringToH3</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8938 rel="external nofollow noreferrer" target=_blank>#8938</a> (<a href=https://github.com/nmandery rel="external nofollow noreferrer" target=_blank>Nico Mandery</a>)</li> <li>引入了新设置: <code class=syntax>max_parser_depth</code> 以控制最大堆栈大小并允许大型复杂查询. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6681 rel="external nofollow noreferrer" target=_blank>#6681</a> 和 <a href=https://github.com/ClickHouse/ClickHouse/issues/7668 rel="external nofollow noreferrer" target=_blank>#7668</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8647 rel="external nofollow noreferrer" target=_blank>#8647</a> (<a href=https://github.com/qMBQx8GH rel="external nofollow noreferrer" target=_blank>Maxim Smirnov</a>)</li> <li>如果无法跳过未使用的分片, 则添加设置 <code class=syntax>force_optimize_skip_unused_shards</code> 设置以抛出. <a href=https://github.com/ClickHouse/ClickHouse/pull/8805 rel="external nofollow noreferrer" target=_blank>#8805</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>允许配置多个磁盘/卷来存储数据以在 <code class=syntax>Distributed</code> 引擎中发送. <a href=https://github.com/ClickHouse/ClickHouse/pull/8756 rel="external nofollow noreferrer" target=_blank>#8756</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>支持存储临时数据的存储策略 (<code class=syntax>&lt;tmp_policy&gt;</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8750 rel="external nofollow noreferrer" target=_blank>#8750</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加了 <code class=syntax>X-ClickHouse-Exception-Code</code> HTTP 标头, 如果在发送数据之前抛出异常, 则会设置该标头. 这实现了 <a href=https://github.com/ClickHouse/ClickHouse/issues/4971 rel="external nofollow noreferrer" target=_blank>#4971</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8786 rel="external nofollow noreferrer" target=_blank>#8786</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>添加函数 <code class=syntax>ifNotFinite</code>. 它只是一个语法糖: <code class=syntax>ifNotFinite(x, y) = isFinite(x) ? x : y</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8710 rel="external nofollow noreferrer" target=_blank>#8710</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 <code class=syntax>system.dictionaries</code> 表中添加了 <code class=syntax>last_successful_update_time</code> 列. <a href=https://github.com/ClickHouse/ClickHouse/pull/9394 rel="external nofollow noreferrer" target=_blank>#9394</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>添加 <code class=syntax>blockSerializedSize</code> 函数 (未压缩的磁盘大小). <a href=https://github.com/ClickHouse/ClickHouse/pull/8952 rel="external nofollow noreferrer" target=_blank>#8952</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加函数 <code class=syntax>moduloOrZero</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9358 rel="external nofollow noreferrer" target=_blank>#9358</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>添加了系统表<code class=syntax>system.zeros</code> 和<code class=syntax>system.zeros_mt</code> 以及故事函数<code class=syntax>zeros()</code> 和<code class=syntax>zeros_mt()</code>. 表 (和表函数) 包含名称为 <code class=syntax>zero</code> 且类型为 <code class=syntax>UInt8</code> 的单列. 此列包含零. 出于测试目的需要它作为生成多行的最快方法. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6604 rel="external nofollow noreferrer" target=_blank>#6604</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9593 rel="external nofollow noreferrer" target=_blank>#9593</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> </ul> <h4 id=shi-yan-gong-neng_7>实验功能<a class=headerlink href=../amp/#shi-yan-gong-neng_7 title="Permanent link"> </a></h4> <ul> <li>在<code class=syntax>MergeTree</code>-family 表中添加新的零件紧凑格式, 其中所有列都存储在一个文件中. 它有助于提高小而频繁的插入的性能. 旧格式 (每列一个文件) 现在称为宽格式. 数据存储格式由设置 <code class=syntax>min_bytes_for_wide_part</code> 和 <code class=syntax>min_rows_for_wide_part</code> 控制. <a href=https://github.com/ClickHouse/ClickHouse/pull/8290 rel="external nofollow noreferrer" target=_blank>#8290</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>支持对 <code class=syntax>Log</code>、<code class=syntax>TinyLog</code> 和<code class=syntax>StripeLog</code> 表的S3 存储. <a href=https://github.com/ClickHouse/ClickHouse/pull/8862 rel="external nofollow noreferrer" target=_blank>#8862</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li> </ul> <h4 id=bug-xiu-fu_49>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_49 title="Permanent link"> </a></h4> <ul> <li>修复了日志消息中不一致的空格. <a href=https://github.com/ClickHouse/ClickHouse/pull/9322 rel="external nofollow noreferrer" target=_blank>#9322</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复未命名元组数组在表创建时被展平为嵌套结构的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8866 rel="external nofollow noreferrer" target=_blank>#8866</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>)</li> <li>修复了 <code class=syntax>File</code> 表或 <code class=syntax>file</code> 表函数中匹配 glob 模式的文件过多时, 可能会出现 <code class=syntax>Too many open files</code> 错误的问题. 现在文件被懒惰地打开. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8857 rel="external nofollow noreferrer" target=_blank>#8857</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8861 rel="external nofollow noreferrer" target=_blank>#8861</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>DROP TEMPORARY TABLE 现在只删除临时表. <a href=https://github.com/ClickHouse/ClickHouse/pull/8907 rel="external nofollow noreferrer" target=_blank>#8907</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>当我们关闭服务器或 DETACH/ATTACH 表时删除过时的分区. <a href=https://github.com/ClickHouse/ClickHouse/pull/8602 rel="external nofollow noreferrer" target=_blank>#8602</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>关于默认磁盘如何计算 <code class=syntax>data</code> 子目录中的可用空间. 修复了如果将 <code class=syntax>data</code> 目录安装到单独的设备 (罕见情况), 则无法正确计算可用空间量的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7441 rel="external nofollow noreferrer" target=_blank>#7441</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9257 rel="external nofollow noreferrer" target=_blank>#9257</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>允许逗号 (交叉) 与 IN() 内连接. <a href=https://github.com/ClickHouse/ClickHouse/pull/9251 rel="external nofollow noreferrer" target=_blank>#9251</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>如果 WHERE 部分中有 [NOT] LIKE 运算符, 则允许将 CROSS 重写为 INNER JOIN. <a href=https://github.com/ClickHouse/ClickHouse/pull/9229 rel="external nofollow noreferrer" target=_blank>#9229</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>在启用设置 <code class=syntax>distributed_aggregation_memory_efficient</code> 的情况下修复<code class=syntax>GROUP BY</code> 后可能出现的错误结果. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9134 rel="external nofollow noreferrer" target=_blank>#9134</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9289 rel="external nofollow noreferrer" target=_blank>#9289</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>找到的键在缓存字典的度量中被计为遗漏. <a href=https://github.com/ClickHouse/ClickHouse/pull/9411 rel="external nofollow noreferrer" target=_blank>#9411</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/8598 rel="external nofollow noreferrer" target=_blank>#8598</a> 中引入的复制协议不兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/9412 rel="external nofollow noreferrer" target=_blank>#9412</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>ReplicatedMergeTree</code> 表启动时 <code class=syntax>queue_task_handle</code> 上的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/9552 rel="external nofollow noreferrer" target=_blank>#9552</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>令牌 <code class=syntax>NOT</code> 在 <code class=syntax>SHOW TABLES NOT LIKE</code> 查询中不起作用. <a href=https://github.com/ClickHouse/ClickHouse/issues/8727 rel="external nofollow noreferrer" target=_blank>#8727</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8940 rel="external nofollow noreferrer" target=_blank>#8940</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加范围检查功能 <code class=syntax>h3EdgeLengthM</code>. 如果没有这个检查, 缓冲区溢出是可能的. <a href=https://github.com/ClickHouse/ClickHouse/pull/8945 rel="external nofollow noreferrer" target=_blank>#8945</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了多个参数 (超过 10 个) 的三元逻辑 OP 的批量计算中的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8718 rel="external nofollow noreferrer" target=_blank>#8718</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>修复 PREWHERE 优化错误，可能导致段错误或 <code class=syntax>Inconsistent number of columns got from MergeTreeRangeReader</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/9024 rel="external nofollow noreferrer" target=_blank>#9024</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复意外的 <code class=syntax>Timeout exceeded while reading from socket</code> 异常, 该异常在实际超过超时之前和启用查询分析器时在安全连接上随机发生. 同时添加 <code class=syntax>connect_timeout_with_failover_secure_ms</code>设置 (默认100ms), 与 <code class=syntax>connect_timeout_with_failover_ms</code> 类似, 但用于安全连接 (因为SSL握手比普通TCP连接慢). <a href=https://github.com/ClickHouse/ClickHouse/pull/9026 rel="external nofollow noreferrer" target=_blank>#9026</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复突变终止的错误, 当突变可能挂在 <code class=syntax>parts_to_do=0</code> 和 <code class=syntax>is_done=0</code> 状态时. <a href=https://github.com/ClickHouse/ClickHouse/pull/9022 rel="external nofollow noreferrer" target=_blank>#9022</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>使用带有 <code class=syntax>partial_merge_join</code> 设置的新 ANY JOIN 逻辑. 现在可以使用 <code class=syntax>partial_merge_join=1</code> 进行 <code class=syntax>ANY|ALL|SEMI LEFT</code> 和 <code class=syntax>ALL INNER</code> 连接. <a href=https://github.com/ClickHouse/ClickHouse/pull/8932 rel="external nofollow noreferrer" target=_blank>#8932</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>分片现在将从发起者获得的设置限制到分片的约束, 而不是抛出异常. 此修复允许将查询发送到具有其他约束的分片. <a href=https://github.com/ClickHouse/ClickHouse/pull/9447 rel="external nofollow noreferrer" target=_blank>#9447</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复了 <code class=syntax>MergeTreeReadPool</code> 中的内存管理问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/8791 rel="external nofollow noreferrer" target=_blank>#8791</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>使用字符串 <code class=syntax>e</code> 调用时修复 <code class=syntax>toDecimal*OrNull()</code> 函数族. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/8312 rel="external nofollow noreferrer" target=_blank>#8312</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8764 rel="external nofollow noreferrer" target=_blank>#8764</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>确保 <code class=syntax>FORMAT Null</code> 没有向客户端发送数据. <a href=https://github.com/ClickHouse/ClickHouse/pull/8767 rel="external nofollow noreferrer" target=_blank>#8767</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>修复 <code class=syntax>LiveViewBlockInputStream</code> 中的时间戳不会更新的错误. <code class=syntax>LIVE VIEW</code> 是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/8644 rel="external nofollow noreferrer" target=_blank>#8644</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8625 rel="external nofollow noreferrer" target=_blank>#8625</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>)</li> <li>修复了不允许删除旧 TTL 表达式的 <code class=syntax>ALTER MODIFY TTL</code> 错误行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/8422 rel="external nofollow noreferrer" target=_blank>#8422</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复了 MergeTreeIndexSet 中的 UBSan 报告. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9250 rel="external nofollow noreferrer" target=_blank>#9250</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9365 rel="external nofollow noreferrer" target=_blank>#9365</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了当 haystack 有零字节时 <code class=syntax>match</code> 和 <code class=syntax>extract</code> 函数的行为. 当 haystack 不变时, 行为是错误的. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9160 rel="external nofollow noreferrer" target=_blank>#9160</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9163 rel="external nofollow noreferrer" target=_blank>#9163</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/9345 rel="external nofollow noreferrer" target=_blank>#9345</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>避免从 Apache Avro 3rd 方库中的析构函数抛出. <a href=https://github.com/ClickHouse/ClickHouse/pull/9066 rel="external nofollow noreferrer" target=_blank>#9066</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li> <li>不要提交部分从 <code class=syntax>Kafka</code> 轮询的批处理, 因为它可能导致数据漏洞. <a href=https://github.com/ClickHouse/ClickHouse/pull/8876 rel="external nofollow noreferrer" target=_blank>#8876</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>使用可为空的返回类型修复 <code class=syntax>joinGet</code>. <a href=https://github.com/ClickHouse/ClickHouse/issues/8919 rel="external nofollow noreferrer" target=_blank>#8919</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9014 rel="external nofollow noreferrer" target=_blank>#9014</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复使用 <code class=syntax>T64</code>编解码器压缩时数据不兼容的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/9016 rel="external nofollow noreferrer" target=_blank>#9016</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>) 修复<code class=syntax>T64</code>压缩编解码器中导致的数据类型ID 在受影响的版本中错误 (解) 压缩 <a href=https://github.com/ClickHouse/ClickHouse/pull/9033 rel="external nofollow noreferrer" target=_blank>#9033</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>添加设置 <code class=syntax>enable_early_constant_folding</code> 并在某些导致错误的情况下禁用它. <a href=https://github.com/ClickHouse/ClickHouse/pull/9010 rel="external nofollow noreferrer" target=_blank>#9010</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>使用 VIEW 修复下推谓词优化器并启用测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/9011 rel="external nofollow noreferrer" target=_blank>#9011</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>修复 <code class=syntax>Merge</code> 表中的段错误, 这在从 <code class=syntax>File</code> 存储读取时可能发生. <a href=https://github.com/ClickHouse/ClickHouse/pull/9387 rel="external nofollow noreferrer" target=_blank>#9387</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>在 <code class=syntax>ATTACH PARTITION FROM</code>、<code class=syntax>REPLACE PARTITION</code>、<code class=syntax>MOVE TO TABLE</code>中添加了对存储策略的检查. 否则会导致重启后部分数据无法访问, 导致ClickHouse无法启动. <a href=https://github.com/ClickHouse/ClickHouse/pull/9383 rel="external nofollow noreferrer" target=_blank>#9383</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>如果为表设置了 TTL, 则修复更改. <a href=https://github.com/ClickHouse/ClickHouse/pull/8800 rel="external nofollow noreferrer" target=_blank>#8800</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复在修改/添加/删除某些字典时执行 <code class=syntax>SYSTEM RELOAD ALL DICTIONARIES</code> 时可能发生的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/8801 rel="external nofollow noreferrer" target=_blank>#8801</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>在以前的版本 <code class=syntax>Memory</code> 数据库引擎使用空数据路径, 所以表在 <code class=syntax>path</code>目录 (例如 <code class=syntax>/var/lib/clickhouse/</code>) 中创建, 而不是在数据库的数据目录中 (例如. <code class=syntax>/var/lib/clickhouse/db_name</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8753 rel="external nofollow noreferrer" target=_blank>#8753</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了有关缺少默认磁盘或策略的错误日志消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/9530 rel="external nofollow noreferrer" target=_blank>#9530</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复 not(has()) 数组类型的bloom_filter索引. <a href=https://github.com/ClickHouse/ClickHouse/pull/9407 rel="external nofollow noreferrer" target=_blank>#9407</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li> <li>允许带有 <code class=syntax>Log</code> 引擎的表中的第一列作为别名 <a href=https://github.com/ClickHouse/ClickHouse/pull/9231 rel="external nofollow noreferrer" target=_blank>#9231</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>在一个线程中从 <code class=syntax>MergeTree</code> 表读取时修复范围的顺序. 它可能导致 <code class=syntax>MergeTreeRangeReader</code> 的异常或错误的查询结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/9050 rel="external nofollow noreferrer" target=_blank>#9050</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>使 <code class=syntax>reinterpretAsFixedString</code> 返回 <code class=syntax>FixedString</code> 而不是 <code class=syntax>String</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9052 rel="external nofollow noreferrer" target=_blank>#9052</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li> <li>避免极少数情况下用户可能会收到错误的错误消息 (<code class=syntax>Success</code>而不是详细的错误描述). <a href=https://github.com/ClickHouse/ClickHouse/pull/9457 rel="external nofollow noreferrer" target=_blank>#9457</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使用带有空行模板的 <code class=syntax>Template</code> 格式时不会崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/8785 rel="external nofollow noreferrer" target=_blank>#8785</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>系统表的元数据文件可能创建在错误的位置 <a href=https://github.com/ClickHouse/ClickHouse/pull/8653 rel="external nofollow noreferrer" target=_blank>#8653</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>) Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/8581 rel="external nofollow noreferrer" target=_blank>#8581</a>.</li> <li>修复缓存字典中 exception_ptr 的数据竞争 <a href=https://github.com/ClickHouse/ClickHouse/issues/8303 rel="external nofollow noreferrer" target=_blank>#8303</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9379 rel="external nofollow noreferrer" target=_blank>#9379</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>不要为查询 <code class=syntax>ATTACH TABLE IF NOT EXISTS</code> 抛出异常. 以前, 如果表已经存在, 则抛出它, 尽管有 <code class=syntax>IF NOT EXISTS</code> 子句. <a href=https://github.com/ClickHouse/ClickHouse/pull/8967 rel="external nofollow noreferrer" target=_blank>#8967</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复了异常消息中缺少关闭括号的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/8811 rel="external nofollow noreferrer" target=_blank>#8811</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在交互模式下启动 clickhouse-client 时避免消息 <code class=syntax>Possible deadlock avoid</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/9455 rel="external nofollow noreferrer" target=_blank>#9455</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 base64 编码值末尾填充可能格式错误的问题. 更新 base64 库. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9491 rel="external nofollow noreferrer" target=_blank>#9491</a>, closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9492 rel="external nofollow noreferrer" target=_blank>#9492</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9500 rel="external nofollow noreferrer" target=_blank>#9500</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在读取后缀之后但提交之前发生异常时, 在极少数情况下防止在 <code class=syntax>Kafka</code> 中丢失数据. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9378 rel="external nofollow noreferrer" target=_blank>#9378</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9507 rel="external nofollow noreferrer" target=_blank>#9507</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复了<code class=syntax>DROP TABLE IF EXISTS</code> 中的异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/8663 rel="external nofollow noreferrer" target=_blank>#8663</a> (<a href=https://github.com/nikvas0 rel="external nofollow noreferrer" target=_blank>Nikita Vasilev</a>)</li> <li>修复当用户尝试为旧格式的 <code class=syntax>MergeTree</code> 表引擎系列 <code class=syntax>ALTER MODIFY SETTING</code> 时崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/9435 rel="external nofollow noreferrer" target=_blank>#9435</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>支持 JSON 相关函数中不适合 Int64 的 UInt64 数字. 将 SIMDJSON 更新为 master. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/9209 rel="external nofollow noreferrer" target=_blank>#9209</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9344 rel="external nofollow noreferrer" target=_blank>#9344</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了使用非严格单调函数索引时反向谓词的执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/9223 rel="external nofollow noreferrer" target=_blank>#9223</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>不要尝试在 <code class=syntax>GROUP BY</code> 中折叠 <code class=syntax>IN</code> 常量. <a href=https://github.com/ClickHouse/ClickHouse/pull/8868 rel="external nofollow noreferrer" target=_blank>#8868</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复 <code class=syntax>ALTER DELETE</code> 突变中导致索引损坏的错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9019 rel="external nofollow noreferrer" target=_blank>#9019</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/8982 rel="external nofollow noreferrer" target=_blank>#8982</a>. Additionally fix extremely rare race conditions in <code class=syntax>ReplicatedMergeTree</code> <code class=syntax>ALTER</code> queries. <a href=https://github.com/ClickHouse/ClickHouse/pull/9048 rel="external nofollow noreferrer" target=_blank>#9048</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>当设置 <code class=syntax>compile_expressions</code> 启用时，当我们使用 <code class=syntax>Nullable</code> 类型时，你会在 <code class=syntax>LLVMExecutableFunction</code> 中得到 <code class=syntax>unexpected column</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8910 rel="external nofollow noreferrer" target=_blank>#8910</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li><code class=syntax>Kafka</code> 引擎的多项修复: 1) 修复在消费者组重新平衡期间出现的重复项. 2) 修复了当数据从多个分区轮询一次轮询并部分提交时出现的罕见 <code class=syntax>holes</code> (现在我们总是处理/提交整个轮询的消息块). 3) 按块大小修复刷新 (在此之前, 只有超时刷新才能正常工作). 4) 更好的订阅程序 (带有分配反馈). 5) 使测试工作更快 (使用默认间隔和超时). 由于数据之前没有按块大小刷新 (根据文档应该如此), 该 PR 可能会导致默认设置的性能下降 (由于更频繁和更小的刷新不是最佳的). 如果您在更改后遇到性能问题 - 请将表中的 <code class=syntax>kafka_max_block_size</code> 增加到更大的值 (例如 <code class=syntax>CREATE TABLE ...Engine=Kafka ... SETTINGS ... kafka_max_block_size=524288</code>). 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7259 rel="external nofollow noreferrer" target=_blank>#7259</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8917 rel="external nofollow noreferrer" target=_blank>#8917</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复 PREWHERE 优化后某些查询中的 <code class=syntax>Parameter out of bound</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/8914 rel="external nofollow noreferrer" target=_blank>#8914</a> (<a href=https://github.com/bgiard rel="external nofollow noreferrer" target=_blank>Baudouin Giard</a>)</li> <li>修复了函数 <code class=syntax>arrayZip</code> 的参数混合常量的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/8705 rel="external nofollow noreferrer" target=_blank>#8705</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>执行 <code class=syntax>CREATE</code> 查询时，在存储引擎参数中折叠常量表达式. 用当前数据库替换空数据库名称. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6508 rel="external nofollow noreferrer" target=_blank>#6508</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/3492 rel="external nofollow noreferrer" target=_blank>#3492</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9262 rel="external nofollow noreferrer" target=_blank>#9262</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>现在无法创建或添加具有简单循环别名的列, 例如 <code class=syntax>a DEFAULT b, b DEFAULT a</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9603 rel="external nofollow noreferrer" target=_blank>#9603</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了可能会损坏原始部分的双重移动错误。 如果您使用 <code class=syntax>ALTER TABLE MOVE</code>, 这是相关的. <a href=https://github.com/ClickHouse/ClickHouse/pull/8680 rel="external nofollow noreferrer" target=_blank>#8680</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>允许 <code class=syntax>interval</code> 标识符正确解析而无需反引号. 修复了即使 <code class=syntax>interval</code> 标识符包含在反引号或双引号中也无法执行查询的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9124 rel="external nofollow noreferrer" target=_blank>#9124</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9142 rel="external nofollow noreferrer" target=_blank>#9142</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 <code class=syntax>bitTestAll</code>/<code class=syntax>bitTestAny</code> 函数的模糊测试和错误行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/9143 rel="external nofollow noreferrer" target=_blank>#9143</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>当有很多行等于第 n 行时, 修复 <code class=syntax>LIMIT n WITH TIES</code> 中可能的崩溃/错误的行数. <a href=https://github.com/ClickHouse/ClickHouse/pull/9464 rel="external nofollow noreferrer" target=_blank>#9464</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复使用启用的 <code class=syntax>insert_quorum</code> 编写的部分的突变. <a href=https://github.com/ClickHouse/ClickHouse/pull/9463 rel="external nofollow noreferrer" target=_blank>#9463</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复 <code class=syntax>Poco::HTTPServer</code> 破坏时的数据竞争. 当服务器启动并立即关闭时可能会发生这种情况 <a href=https://github.com/ClickHouse/ClickHouse/pull/9468 rel="external nofollow noreferrer" target=_blank>#9468</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复运行 <code class=syntax>SHOW CREATE TABLE a_table_that_does_not_exist</code> 时显示误导性错误消息的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8899 rel="external nofollow noreferrer" target=_blank>#8899</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>)</li> <li>当我们有一个 ORDER BY 和一个 LIMIT 子句时, 当我们在 SELECT 子句中有一个常量时, 在一些罕见的情况下修复了 <code class=syntax>Parameters is out of bound</code> 异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/8892 rel="external nofollow noreferrer" target=_blank>#8892</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>修复突变完成, 当已经完成突变时, 可以有状态<code class=syntax>is_done=0</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9217 rel="external nofollow noreferrer" target=_blank>#9217</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>防止使用旧语法对 MergeTree 表执行 <code class=syntax>ALTER ADD INDEX</code> , 因为它不起作用. <a href=https://github.com/ClickHouse/ClickHouse/pull/8822 rel="external nofollow noreferrer" target=_blank>#8822</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>在服务器启动期间不要访问 <code class=syntax>LIVE VIEW</code> 所依赖的表, 因此服务器将能够启动. 分离 <code class=syntax>LIVE VIEW</code> 时也要删除 <code class=syntax>LIVE VIEW</code> 依赖项. <code class=syntax>LIVE VIEW</code> 是一项实验性功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/8824 rel="external nofollow noreferrer" target=_blank>#8824</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了在执行 PREWHERE 时在 MergeTreeRangeReader 中可能出现的段错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9106 rel="external nofollow noreferrer" target=_blank>#9106</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>使用列 TTL 修复可能不匹配的校验和. <a href=https://github.com/ClickHouse/ClickHouse/pull/9451 rel="external nofollow noreferrer" target=_blank>#9451</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复了在只有一个卷的情况下部件不会通过 TTL 规则在后台移动的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8672 rel="external nofollow noreferrer" target=_blank>#8672</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复了 <code class=syntax>Method createColumn() is not implemented for data type Set</code> 实现的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7799 rel="external nofollow noreferrer" target=_blank>#7799</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8674 rel="external nofollow noreferrer" target=_blank>#8674</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>现在我们将尝试更频繁地完成突变. <a href=https://github.com/ClickHouse/ClickHouse/pull/9427 rel="external nofollow noreferrer" target=_blank>#9427</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>通过减去一个常量来修复 <code class=syntax>intDiv</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9351 rel="external nofollow noreferrer" target=_blank>#9351</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>修复 <code class=syntax>BlockIO</code> 中可能的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/9356 rel="external nofollow noreferrer" target=_blank>#9356</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复在尝试使用/删除使用错误参数创建的 <code class=syntax>Kafka</code> 表时导致服务器终止的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9513 rel="external nofollow noreferrer" target=_blank>#9513</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>如果 OS 为 <code class=syntax>timer_create</code> 函数返回错误结果, 则添加了解决方法. <a href=https://github.com/ClickHouse/ClickHouse/pull/8837 rel="external nofollow noreferrer" target=_blank>#8837</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了使用 <code class=syntax>min_marks_for_seek</code> 参数时的错误. 修复了分布式表中没有分片键并且我们尝试跳过未使用的分片时的错误消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/8908 rel="external nofollow noreferrer" target=_blank>#8908</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> </ul> <h4 id=gai-jin_20>改进<a class=headerlink href=../amp/#gai-jin_20 title="Permanent link"> </a></h4> <ul> <li>在 <code class=syntax>ReplicatedMergeTree*</code> 引擎系列的突变之上实施 <code class=syntax>ALTER MODIFY/DROP</code> 查询. 现在 ALTERS 仅在元数据更新阶段阻塞, 之后不再阻塞. <a href=https://github.com/ClickHouse/ClickHouse/pull/8701 rel="external nofollow noreferrer" target=_blank>#8701</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加使用包含不合格名称的 <code class=syntax>WHERE</code> 部分重写 CROSS 到 INNER JOIN 的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/9512 rel="external nofollow noreferrer" target=_blank>#9512</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>使 <code class=syntax>SHOW TABLES</code> 和 <code class=syntax>SHOW DATABASES</code> 查询支持 <code class=syntax>WHERE</code> 表达式和<code class=syntax>FROM</code>/<code class=syntax>IN</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9076 rel="external nofollow noreferrer" target=_blank>#9076</a> (<a href=https://github.com/sundy-li rel="external nofollow noreferrer" target=_blank>sundyli</a>)</li> <li>添加了一个设置 <code class=syntax>deduplicate_blocks_in_dependent_materialized_views</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9070 rel="external nofollow noreferrer" target=_blank>#9070</a> (<a href=https://github.com/urykhy rel="external nofollow noreferrer" target=_blank>urykhy</a>)</li> <li>在最近的更改之后, MySQL 客户端开始以十六进制打印二进制字符串, 从而使它们不可读 (<a href=https://github.com/ClickHouse/ClickHouse/issues/9032 rel="external nofollow noreferrer" target=_blank>#9032</a>). ClickHouse 中的解决方法是将字符串列标记为 UTF-8, 这并非总是如此, 但通常如此. <a href=https://github.com/ClickHouse/ClickHouse/pull/9079 rel="external nofollow noreferrer" target=_blank>#9079</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>添加对 <code class=syntax>sumMap</code> 的 String 和 FixedString 键的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/8903 rel="external nofollow noreferrer" target=_blank>#8903</a> (<a href=https://github.com/bgiard rel="external nofollow noreferrer" target=_blank>Baudouin Giard</a>)</li> <li>支持 SummingMergeTree 映射中的字符串键. <a href=https://github.com/ClickHouse/ClickHouse/pull/8933 rel="external nofollow noreferrer" target=_blank>#8933</a> (<a href=https://github.com/bgiard rel="external nofollow noreferrer" target=_blank>Baudouin Giard</a>)</li> <li>即使线程抛出异常, 也会向线程池发出线程终止信号. <a href=https://github.com/ClickHouse/ClickHouse/pull/8736 rel="external nofollow noreferrer" target=_blank>#8736</a> (<a href=https://github.com/dingxiangfei2009 rel="external nofollow noreferrer" target=_blank>Ding Xiang Fei</a>)</li> <li>允许在 <code class=syntax>clickhouse-benchmark</code> 中设置 <code class=syntax>query_id</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9416 rel="external nofollow noreferrer" target=_blank>#9416</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>不允许在 <code class=syntax>ALTER TABLE ... PARTITION partition</code> 查询中出现奇怪的表达式. 这个地址 <a href=https://github.com/ClickHouse/ClickHouse/issues/7192 rel="external nofollow noreferrer" target=_blank>#7192</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8835 rel="external nofollow noreferrer" target=_blank>#8835</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>表 <code class=syntax>system.table_engines</code> 现在提供有关功能支持的信息 (例如 <code class=syntax>supports_ttl</code> 或 <code class=syntax>supports_sort_order</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8830 rel="external nofollow noreferrer" target=_blank>#8830</a> (<a href=https://github.com/zlobober rel="external nofollow noreferrer" target=_blank>Max Akhmedov</a>)</li> <li>默认启用 <code class=syntax>system.metric_log</code>. 它将包含具有 ProfileEvents 值的行, CurrentMetrics 以 <code class=syntax>collect_interval_milliseconds</code> 间隔 (默认为一秒) 收集. 表很小 (通常以兆字节为单位), 默认收集这些数据是合理的. <a href=https://github.com/ClickHouse/ClickHouse/pull/9225 rel="external nofollow noreferrer" target=_blank>#9225</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>Initialize query profiler for all threads in a group, e.g. it allows to fully profile insert-queries. Fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/6964 rel="external nofollow noreferrer" target=_blank>#6964</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8874 rel="external nofollow noreferrer" target=_blank>#8874</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>现在临时的 <code class=syntax>LIVE VIEW</code> 是由 <code class=syntax>CREATE LIVE VIEW name WITH TIMEOUT [42] ...</code> 创建的, 而不是 <code class=syntax>CREATE TEMPORARY LIVE VIEW ...</code>, 因为之前的语法与 <code class=syntax>CREATE TEMPORARY TABLE ...</code> 不一致. <a href=https://github.com/ClickHouse/ClickHouse/pull/9131 rel="external nofollow noreferrer" target=_blank>#9131</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>添加 text_log.level 配置参数以限制进入 <code class=syntax>system.text_log</code> 表的条目. <a href=https://github.com/ClickHouse/ClickHouse/pull/8809 rel="external nofollow noreferrer" target=_blank>#8809</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>允许根据 TTL 规则将下载的部分放入磁盘/卷. <a href=https://github.com/ClickHouse/ClickHouse/pull/8598 rel="external nofollow noreferrer" target=_blank>#8598</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>对于外部 MySQL 字典, 允许相互化 MySQL 连接池以在字典之间 <code class=syntax>share</code> 它们. 此选项显着减少了与 MySQL 服务器的连接数. <a href=https://github.com/ClickHouse/ClickHouse/pull/9409 rel="external nofollow noreferrer" target=_blank>#9409</a> (<a href=https://github.com/clemrodriguez rel="external nofollow noreferrer" target=_blank>Clément Rodriguez</a>)</li> <li>在 <code class=syntax>clickhouse-benchmark</code> 输出中显示分位数的最近查询执行时间, 而不是内插值. 最好显示与某些查询的执行时间相对应的值. <a href=https://github.com/ClickHouse/ClickHouse/pull/8712 rel="external nofollow noreferrer" target=_blank>#8712</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将数据插入 Kafka 时，可以为消息添加密钥和时间戳. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7198 rel="external nofollow noreferrer" target=_blank>#7198</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8969 rel="external nofollow noreferrer" target=_blank>#8969</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>如果服务器从终端运行, 则按颜色突出显示线程编号、查询 ID 和日志优先级. 这是为了提高开发人员对相关日志消息的可读性. <a href=https://github.com/ClickHouse/ClickHouse/pull/8961 rel="external nofollow noreferrer" target=_blank>#8961</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>加载 <code class=syntax>Ordinary</code> 数据库表时更好的异常消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/9527 rel="external nofollow noreferrer" target=_blank>#9527</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为具有聚合函数状态的数组实现 <code class=syntax>arraySlice</code>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9388 rel="external nofollow noreferrer" target=_blank>#9388</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9391 rel="external nofollow noreferrer" target=_blank>#9391</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>允许在 IN 运算符的右侧使用常量函数和常量数组. <a href=https://github.com/ClickHouse/ClickHouse/pull/8813 rel="external nofollow noreferrer" target=_blank>#8813</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>如果在为 system.replicas 获取数据时发生 zookeeper 异常, 则将其显示在单独的列中. 这实现了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9137 rel="external nofollow noreferrer" target=_blank>#9137</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9138 rel="external nofollow noreferrer" target=_blank>#9138</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在销毁时原子地删除 MergeTree 数据部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/8402 rel="external nofollow noreferrer" target=_blank>#8402</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>支持分布式表的行级安全. <a href=https://github.com/ClickHouse/ClickHouse/pull/8926 rel="external nofollow noreferrer" target=_blank>#8926</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>现在我们在设置值中识别后缀 (如 KB、KiB...). <a href=https://github.com/ClickHouse/ClickHouse/pull/8072 rel="external nofollow noreferrer" target=_blank>#8072</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>在构建大型 JOIN 的结果时防止内存不足. <a href=https://github.com/ClickHouse/ClickHouse/pull/8637 rel="external nofollow noreferrer" target=_blank>#8637</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>在 <code class=syntax>clickhouse-client</code> 中以交互模式向建议添加集群名称. <a href=https://github.com/ClickHouse/ClickHouse/pull/8709 rel="external nofollow noreferrer" target=_blank>#8709</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为组中的所有线程初始化查询分析器, 例如它允许完全分析插入查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/8820 rel="external nofollow noreferrer" target=_blank>#8820</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>在 <code class=syntax>system.query_log</code> 表中添加了列 <code class=syntax>exception_code</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8770 rel="external nofollow noreferrer" target=_blank>#8770</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>在默认服务器配置文件中的端口 <code class=syntax>9004</code> 上启用 MySQL 兼容性服务器. 配置示例中的固定密码生成命令. <a href=https://github.com/ClickHouse/ClickHouse/pull/8771 rel="external nofollow noreferrer" target=_blank>#8771</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>如果文件系统是只读的，则防止在关机时中止. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9094 rel="external nofollow noreferrer" target=_blank>#9094</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9100 rel="external nofollow noreferrer" target=_blank>#9100</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 HTTP POST 查询中需要长度时更好的异常消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/9453 rel="external nofollow noreferrer" target=_blank>#9453</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 <code class=syntax>_path</code> 和 <code class=syntax>_file</code> 虚拟列添加到 <code class=syntax>HDFS</code> 和 <code class=syntax>File</code> 引擎以及 <code class=syntax>hdfs</code> 和 <code class=syntax>file</code> 表函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/8489 rel="external nofollow noreferrer" target=_blank>#8489</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>如果将新列添加到视图的内部表中，则在插入到 <code class=syntax>MATERIALIZED VIEW</code> 时修复错误 <code class=syntax>Cannot find column</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/8766 rel="external nofollow noreferrer" target=_blank>#8766</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8788 rel="external nofollow noreferrer" target=_blank>#8788</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>) <a href=https://github.com/ClickHouse/ClickHouse/issues/8788 rel="external nofollow noreferrer" target=_blank>#8788</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8806 rel="external nofollow noreferrer" target=_blank>#8806</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8803 rel="external nofollow noreferrer" target=_blank>#8803</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>通过在最终更新 (如日志) 后发送进度来修复本地客户端 - 服务器协议的进度. 这可能仅与某些使用本机协议的第三方工具相关. <a href=https://github.com/ClickHouse/ClickHouse/pull/9495 rel="external nofollow noreferrer" target=_blank>#9495</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>添加使用 MySQL 协议跟踪客户端连接数的系统指标. (<a href=https://github.com/ClickHouse/ClickHouse/issues/9013 rel="external nofollow noreferrer" target=_blank>#9013</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9015 rel="external nofollow noreferrer" target=_blank>#9015</a> (<a href=https://github.com/Slach rel="external nofollow noreferrer" target=_blank>Eugene Klimov</a>)</li> <li>从现在开始, HTTP 响应将把 <code class=syntax>X-ClickHouse-Timezone</code> 标头设置为 <code class=syntax>SELECT timezone()</code> 将报告的相同时区值. <a href=https://github.com/ClickHouse/ClickHouse/pull/9493 rel="external nofollow noreferrer" target=_blank>#9493</a> (<a href=https://github.com/traceon rel="external nofollow noreferrer" target=_blank>Denis Glazachev</a>)</li> </ul> <h4 id=xing-neng-gai-jin_16>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_16 title="Permanent link"> </a></h4> <ul> <li>提高使用 IN 分析索引的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/9261 rel="external nofollow noreferrer" target=_blank>#9261</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>逻辑函数 + 代码清理中更简单、更高效的代码. <a href=https://github.com/ClickHouse/ClickHouse/issues/8718 rel="external nofollow noreferrer" target=_blank>#8718</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8728 rel="external nofollow noreferrer" target=_blank>#8728</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>通过使用 C++20 功能确保更严格的别名, 整体性能改进 (受影响查询的范围为 5%..200%). <a href=https://github.com/ClickHouse/ClickHouse/pull/9304 rel="external nofollow noreferrer" target=_blank>#9304</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>比较函数的内部循环更严格的别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/9327 rel="external nofollow noreferrer" target=_blank>#9327</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>算术函数的内部循环更严格的别名. <a href=https://github.com/ClickHouse/ClickHouse/pull/9325 rel="external nofollow noreferrer" target=_blank>#9325</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>ColumnVector::replicate() 的实现速度提高了约 3 倍, 通过它实现了 ColumnConst::convertToFullColumn(). 在实现常量的测试中也很有用. <a href=https://github.com/ClickHouse/ClickHouse/pull/9293 rel="external nofollow noreferrer" target=_blank>#9293</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li><code class=syntax>ColumnVector::replicate()</code> 的另一个小性能改进 (这加速了 <code class=syntax>materialize</code> 函数和高阶函数) . 进一步改进了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9293 rel="external nofollow noreferrer" target=_blank>#9293</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9442 rel="external nofollow noreferrer" target=_blank>#9442</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>改进了 <code class=syntax>stochasticLinearRegression</code> 聚合函数的性能. 此补丁由英特尔提供. <a href=https://github.com/ClickHouse/ClickHouse/pull/8652 rel="external nofollow noreferrer" target=_blank>#8652</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>提高 <code class=syntax>reinterpretAsFixedString</code> 函数的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/9342 rel="external nofollow noreferrer" target=_blank>#9342</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>Do not send blocks to client for <code class=syntax>Null</code> format in processors pipeline. <a href=https://github.com/ClickHouse/ClickHouse/pull/8797 rel="external nofollow noreferrer" target=_blank>#8797</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8767 rel="external nofollow noreferrer" target=_blank>#8767</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_20>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_20 title="Permanent link"> </a></h4> <ul> <li>异常处理现在可以在适用于 Linux 的 Windows 子系统上正常工作. 参见 <a href=https://github.com/ClickHouse-Extras/libunwind/pull/3 target=_blank>https://github.com/ClickHouse-Extras/libunwind/pull/3</a> . 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6480 rel="external nofollow noreferrer" target=_blank>#6480</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9564 rel="external nofollow noreferrer" target=_blank>#9564</a> (<a href=https://github.com/sobolevsv rel="external nofollow noreferrer" target=_blank>sobolevsv</a>)</li> <li>将 <code class=syntax>readline</code> 替换为 <code class=syntax>replxx</code> 以在 <code class=syntax>clickhouse-client</code> 中进行交互式行编辑. <a href=https://github.com/ClickHouse/ClickHouse/pull/8416 rel="external nofollow noreferrer" target=_blank>#8416</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>FunctionsComparison 中更好的构建时间和更少的模板实例化. <a href=https://github.com/ClickHouse/ClickHouse/pull/9324 rel="external nofollow noreferrer" target=_blank>#9324</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 CI 中添加了与 <code class=syntax>clang-tidy</code> 的集成. 另见 <a href=https://github.com/ClickHouse/ClickHouse/issues/6044 rel="external nofollow noreferrer" target=_blank>#6044</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9566 rel="external nofollow noreferrer" target=_blank>#9566</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>现在我们在 CI 中使用 <code class=syntax>lld</code> 链接 ClickHouse, 即使对于 <code class=syntax>gcc</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9049 rel="external nofollow noreferrer" target=_blank>#9049</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>允许在设置 <code class=syntax>THREAD_FUZZER_*</code> 环境变量时随机化线程调度并插入故障. 这有助于测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/9459 rel="external nofollow noreferrer" target=_blank>#9459</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在无状态测试中启用安全套接字. <a href=https://github.com/ClickHouse/ClickHouse/pull/9288 rel="external nofollow noreferrer" target=_blank>#9288</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>使 SPLIT_SHARED_LIBRARIES=OFF 更健壮. <a href=https://github.com/ClickHouse/ClickHouse/pull/9156 rel="external nofollow noreferrer" target=_blank>#9156</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>使 <code class=syntax>performance_introspection_and_logging</code> 测试对随机服务器卡住是可靠的. 这可能发生在 CI 环境中. 另见 <a href=https://github.com/ClickHouse/ClickHouse/issues/9515 rel="external nofollow noreferrer" target=_blank>#9515</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9528 rel="external nofollow noreferrer" target=_blank>#9528</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在样式检查中验证 XML. <a href=https://github.com/ClickHouse/ClickHouse/pull/9550 rel="external nofollow noreferrer" target=_blank>#9550</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了测试 <code class=syntax>00738_lock_for_inner_table</code> 中的竞争条件. 这个测试依赖于睡眠. <a href=https://github.com/ClickHouse/ClickHouse/pull/9555 rel="external nofollow noreferrer" target=_blank>#9555</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>删除类型为 <code class=syntax>once</code> 的性能测试. 这是在统计比较模式下运行所有性能测试所必需的 (更可靠). <a href=https://github.com/ClickHouse/ClickHouse/pull/9557 rel="external nofollow noreferrer" target=_blank>#9557</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了算术函数的性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/9326 rel="external nofollow noreferrer" target=_blank>#9326</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>增加了 <code class=syntax>sumMap</code> 和 <code class=syntax>summapwithverflow</code> 聚合函数的性能测试. 后续的 <a href=https://github.com/ClickHouse/ClickHouse/issues/8933 rel="external nofollow noreferrer" target=_blank>#8933</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8947 rel="external nofollow noreferrer" target=_blank>#8947</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>通过样式检查确保错误代码的样式. <a href=https://github.com/ClickHouse/ClickHouse/pull/9370 rel="external nofollow noreferrer" target=_blank>#9370</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为测试历史添加脚本. <a href=https://github.com/ClickHouse/ClickHouse/pull/8796 rel="external nofollow noreferrer" target=_blank>#8796</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加 GCC 警告 <code class=syntax>-Wsuggest-override</code> 以定位和修复所有必须使用 <code class=syntax>override</code> 关键字的地方. <a href=https://github.com/ClickHouse/ClickHouse/pull/8760 rel="external nofollow noreferrer" target=_blank>#8760</a> (<a href=https://github.com/kreuzerkrieg rel="external nofollow noreferrer" target=_blank>kreuzerkrieg</a>)</li> <li>忽略 Mac OS X 下的弱符号，因为它必须被定义. <a href=https://github.com/ClickHouse/ClickHouse/pull/9538 rel="external nofollow noreferrer" target=_blank>#9538</a> (<a href=https://github.com/ghost rel="external nofollow noreferrer" target=_blank>Deleted user</a>)</li> <li>在性能测试中规范一些查询的运行时间. 这样做是为了准备在比较模式下运行所有性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/9565 rel="external nofollow noreferrer" target=_blank>#9565</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复一些测试以支持 pytest 与查询测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/9062 rel="external nofollow noreferrer" target=_blank>#9062</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>使用 MSan 在构建中启用 SSL, 因此在运行无状态测试时服务器不会在启动时失败. <a href=https://github.com/ClickHouse/ClickHouse/pull/9531 rel="external nofollow noreferrer" target=_blank>#9531</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复测试结果中的数据库替换. <a href=https://github.com/ClickHouse/ClickHouse/pull/9384 rel="external nofollow noreferrer" target=_blank>#9384</a> (<a href=https://github.com/qoega rel="external nofollow noreferrer" target=_blank>Ilya Yatsishin</a>)</li> <li>为其他平台构建修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/9381 rel="external nofollow noreferrer" target=_blank>#9381</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8755 rel="external nofollow noreferrer" target=_blank>#8755</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8631 rel="external nofollow noreferrer" target=_blank>#8631</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>将磁盘部分添加到 stateless-with-coverage 测试 docker 映像. <a href=https://github.com/ClickHouse/ClickHouse/pull/9213 rel="external nofollow noreferrer" target=_blank>#9213</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li> <li>使用 GRPC 构建时摆脱源代码树文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/9588 rel="external nofollow noreferrer" target=_blank>#9588</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>通过从上下文中删除 SessionCleaner, 可以稍微加快构建时间. 让SessionCleaner的代码更简单. <a href=https://github.com/ClickHouse/ClickHouse/pull/9232 rel="external nofollow noreferrer" target=_blank>#9232</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>更新了对 clickhouse-test 脚本中挂起查询的检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/8858 rel="external nofollow noreferrer" target=_blank>#8858</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>从存储库中删除了一些无用的文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/8843 rel="external nofollow noreferrer" target=_blank>#8843</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将数学性能测试的类型从 <code class=syntax>once</code> 更改为 <code class=syntax>loop</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/8783 rel="external nofollow noreferrer" target=_blank>#8783</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>添加 docker 图像，它允许为我们的代码库构建交互式代码浏览器 HTML 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/8781 rel="external nofollow noreferrer" target=_blank>#8781</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>) See <a href=https://clickhouse-test-reports.s3.yandex.net/codebrowser/html_report///ClickHouse/dbms/index.html rel="external nofollow noreferrer" target=_blank>Woboq Code Browser</a></li> <li>抑制 MSan 下的一些测试失败. <a href=https://github.com/ClickHouse/ClickHouse/pull/8780 rel="external nofollow noreferrer" target=_blank>#8780</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>加速 <code class=syntax>exception while insert</code> 测试. 此测试经常在 debug-with-coverage 构建中超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/8711 rel="external nofollow noreferrer" target=_blank>#8711</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 <code class=syntax>libcxx</code> 和 <code class=syntax>libcxxabi</code> 更新为 master. 准备 <a href=https://github.com/ClickHouse/ClickHouse/issues/9304 rel="external nofollow noreferrer" target=_blank>#9304</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9308 rel="external nofollow noreferrer" target=_blank>#9308</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复不稳定的测试 <code class=syntax>00910_zookeeper_test_alter_compression_codecs</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9525 rel="external nofollow noreferrer" target=_blank>#9525</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>清理重复的链接器标志. 确保链接器不会查找意外的符号. <a href=https://github.com/ClickHouse/ClickHouse/pull/9433 rel="external nofollow noreferrer" target=_blank>#9433</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>将 <code class=syntax>clickhouse-odbc</code> 驱动程序添加到测试图像中. 这允许通过其自己的 ODBC 驱动程序测试 ClickHouse 与 ClickHouse 的交互. <a href=https://github.com/ClickHouse/ClickHouse/pull/9348 rel="external nofollow noreferrer" target=_blank>#9348</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复单元测试中的几个错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9047 rel="external nofollow noreferrer" target=_blank>#9047</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>启用 <code class=syntax>-Wmissing-include-dirs</code> GCC 警告以消除所有不存在的包含 - 主要是由于 CMake 脚本错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8704 rel="external nofollow noreferrer" target=_blank>#8704</a> (<a href=https://github.com/kreuzerkrieg rel="external nofollow noreferrer" target=_blank>kreuzerkrieg</a>)</li> <li>如果查询分析器无法工作, 请描述原因. 这适用于 <a href=https://github.com/ClickHouse/ClickHouse/issues/9049 rel="external nofollow noreferrer" target=_blank>#9049</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9144 rel="external nofollow noreferrer" target=_blank>#9144</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 OpenSSL 更新为上游主服务器. 修复了 TLS 连接可能失败并显示消息 <code class=syntax>OpenSSL SSL_read: error:14094438:SSLroutines:ssl3_read_bytes:tlsv1 alert internal error</code> 和 <code class=syntax>SSL Exception: error:2400006E:random number generator::error retrieving entropy</code> 的问题. 该问题存在于 20.1 版中. <a href=https://github.com/ClickHouse/ClickHouse/pull/8956 rel="external nofollow noreferrer" target=_blank>#8956</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>更新服务器的 Dockerfile. <a href=https://github.com/ClickHouse/ClickHouse/pull/8893 rel="external nofollow noreferrer" target=_blank>#8893</a> (<a href=https://github.com/ne-ray rel="external nofollow noreferrer" target=_blank>Ilya Mazaev</a>)</li> <li>build-gcc-from-sources 脚本中的小修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/8774 rel="external nofollow noreferrer" target=_blank>#8774</a> (<a href=https://github.com/mnach rel="external nofollow noreferrer" target=_blank>Michael Nacharov</a>)</li> <li>在不使用 <code class=syntax>number</code> 列的性能测试中, 将 <code class=syntax>numbers</code> 替换为 <code class=syntax>zeros</code>. 这将导致更干净的测试结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/9600 rel="external nofollow noreferrer" target=_blank>#9600</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复在 Column 构造函数中使用 initializer_list 时的堆栈溢出问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/9367 rel="external nofollow noreferrer" target=_blank>#9367</a> (<a href=https://github.com/ghost rel="external nofollow noreferrer" target=_blank>Deleted user</a>)</li> <li>将 librdkafka 升级到 v1.3.0。 在 Mac OS X 上启用捆绑的 <code class=syntax>rdkafka</code> 和 <code class=syntax>gsasl</code> 库. <a href=https://github.com/ClickHouse/ClickHouse/pull/9000 rel="external nofollow noreferrer" target=_blank>#9000</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>)</li> <li>在 GCC 9.2.0 上构建修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/9306 rel="external nofollow noreferrer" target=_blank>#9306</a> (<a href=https://github.com/Vxider rel="external nofollow noreferrer" target=_blank>vxider</a>)</li> </ul> <h2 id=clickhouse-ban-ben-v20-1>ClickHouse 版本 v20.1<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1 title="Permanent link"> </a></h2> <h3 id=clickhouse-ban-ben-v20-1-16-120-stable-2020-60-26>ClickHouse 版本 v20.1.16.120-stable 2020-60-26<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-16-120-stable-2020-60-26 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_50>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_50 title="Permanent link"> </a></h4> <ul> <li>修复在 prewhere 条件下使用 <code class=syntax>Nullable</code> 列导致的罕见崩溃. 续 <a href=https://github.com/ClickHouse/ClickHouse/issues/11608 rel="external nofollow noreferrer" target=_blank>#11608</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11869 rel="external nofollow noreferrer" target=_blank>#11869</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>不允许在高阶函数中使用 arrayJoin. 它导致协议同步中断. 这关闭了 <a href=https://github.com/ClickHouse/ClickHouse/issues/3933 rel="external nofollow noreferrer" target=_blank>#3933</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11846 rel="external nofollow noreferrer" target=_blank>#11846</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复像 <code class=syntax>SELECT *, xyz.*</code> 这样的查询的意外行为, 这些查询在预期错误时成功. <a href=https://github.com/ClickHouse/ClickHouse/pull/11753 rel="external nofollow noreferrer" target=_blank>#11753</a> (<a href=https://github.com/hexiaoting rel="external nofollow noreferrer" target=_blank>hexiaoting</a>).</li> <li>修复了由 Values 输入格式中复杂文字的错误类型推导导致的 LOGICAL_ERROR. <a href=https://github.com/ClickHouse/ClickHouse/pull/11732 rel="external nofollow noreferrer" target=_blank>#11732</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复 <code class=syntax>ORDER BY ... WITH FILL</code> 在 const 列上. <a href=https://github.com/ClickHouse/ClickHouse/pull/11697 rel="external nofollow noreferrer" target=_blank>#11697</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>与 XDBC 桥通信时传递适当的超时. 最近在检查桥接活性和接收元信息时没有遵守超时. <a href=https://github.com/ClickHouse/ClickHouse/pull/11690 rel="external nofollow noreferrer" target=_blank>#11690</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加对带有不区分大小写标志的正则表达式的支持. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11101 rel="external nofollow noreferrer" target=_blank>#11101</a> and fixes <a href=https://github.com/ClickHouse/ClickHouse/issues/11506 rel="external nofollow noreferrer" target=_blank>#11506</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11649 rel="external nofollow noreferrer" target=_blank>#11649</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复字符串的布隆过滤器 (数据跳过索引). <a href=https://github.com/ClickHouse/ClickHouse/pull/11638 rel="external nofollow noreferrer" target=_blank>#11638</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复在 prewhere 条件下使用 <code class=syntax>Nullable</code> 列导致的罕见崩溃. (可能它以某种方式与 <a href=https://github.com/ClickHouse/ClickHouse/issues/11572 rel="external nofollow noreferrer" target=_blank>#11572</a> 相关联). <a href=https://github.com/ClickHouse/ClickHouse/pull/11608 rel="external nofollow noreferrer" target=_blank>#11608</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 clickhouse-client 的错误退出代码, 当 exception.code() % 256 = 0 时. <a href=https://github.com/ClickHouse/ClickHouse/pull/11601 rel="external nofollow noreferrer" target=_blank>#11601</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>修复服务器启动时有关 <code class=syntax>Mark cache size was lowered</code> 的日志消息中的小错误. 这将关闭 <a href=https://github.com/ClickHouse/ClickHouse/issues/11399 rel="external nofollow noreferrer" target=_blank>#11399</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11589 rel="external nofollow noreferrer" target=_blank>#11589</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>现在 clickhouse-server docker 容器将更喜欢 IPv6 检查服务器活动性. <a href=https://github.com/ClickHouse/ClickHouse/pull/11550 rel="external nofollow noreferrer" target=_blank>#11550</a> (<a href=https://github.com/istarkov rel="external nofollow noreferrer" target=_blank>Ivan Starkov</a>).</li> <li>使用 -State 函数在聚合过程中抛出异常时修复内存泄漏. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8995 rel="external nofollow noreferrer" target=_blank>#8995</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11496 rel="external nofollow noreferrer" target=_blank>#11496</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了使用 <code class=syntax>FINAL</code> 修饰符和 <code class=syntax>ORDER BY</code> 优化包装到函数中的主键的使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10715 rel="external nofollow noreferrer" target=_blank>#10715</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-1-15-109-stable-2020-06-19>ClickHouse 版本 v20.1.15.109-stable 2020-06-19<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-15-109-stable-2020-06-19 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_51>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_51 title="Permanent link"> </a></h4> <ul> <li>在更改期间修复结构的多余锁定. <a href=https://github.com/ClickHouse/ClickHouse/pull/11790 rel="external nofollow noreferrer" target=_blank>#11790</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-1-14-107-stable-2020-06-11>ClickHouse 版本 v20.1.14.107-stable 2020-06-11<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-14-107-stable-2020-06-11 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_52>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_52 title="Permanent link"> </a></h4> <ul> <li>修复错误 <code class=syntax>Size of offsets does not match size of column</code> , 用于查询中的 <code class=syntax>PREWHERE column in (subquery)</code> 和 <code class=syntax>ARRAY JOIN</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11580 rel="external nofollow noreferrer" target=_blank>#11580</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-1-13-105-stable-2020-06-10>ClickHouse 版本 v20.1.13.105-stable 2020-06-10<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-13-105-stable-2020-06-10 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_53>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_53 title="Permanent link"> </a></h4> <ul> <li>修复了在启用 <code class=syntax>min_bytes_to_use_direct_io</code> 且 PREWHERE 处于活动状态并使用 SAMPLE 或大量线程时可能发生的 <code class=syntax>Data compressed with different methods</code> 错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11539 rel="external nofollow noreferrer" target=_blank>#11539</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11540 rel="external nofollow noreferrer" target=_blank>#11540</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复编解码器的返回压缩大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/11448 rel="external nofollow noreferrer" target=_blank>#11448</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了当列具有非文字参数的压缩编解码器时服务器崩溃的问题.修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11365 rel="external nofollow noreferrer" target=_blank>#11365</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11431 rel="external nofollow noreferrer" target=_blank>#11431</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>以 nan 为点修复 pointInPolygon. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11375 rel="external nofollow noreferrer" target=_blank>#11375</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11421 rel="external nofollow noreferrer" target=_blank>#11421</a> (<a href=https://github.com/livace rel="external nofollow noreferrer" target=_blank>Alexey Ilyukhov</a>).</li> <li>修复了带有纬度/经度范围之外的参数的 geohashesInBox. <a href=https://github.com/ClickHouse/ClickHouse/pull/11403 rel="external nofollow noreferrer" target=_blank>#11403</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>修复具有外部排序和限制的查询可能出现的 <code class=syntax>Pipeline stuck</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/11359 rel="external nofollow noreferrer" target=_blank>#11359</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11366 rel="external nofollow noreferrer" target=_blank>#11366</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复 <code class=syntax>quantilesExactWeightedArray</code> 中的崩溃问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/11337 rel="external nofollow noreferrer" target=_blank>#11337</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>通过再次设置 <code class=syntax>parallel_view_processing = 1</code> 并行写入 <code class=syntax>MATERIALIZED VIEW</code> . 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11330 rel="external nofollow noreferrer" target=_blank>#11330</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当提取的 JSON 具有不平衡的 { 或 [ 字符串时, 修复visitParamExtractRaw. <a href=https://github.com/ClickHouse/ClickHouse/pull/11318 rel="external nofollow noreferrer" target=_blank>#11318</a> (<a href=https://github.com/devwout rel="external nofollow noreferrer" target=_blank>Ewout</a>).</li> <li>修复 ThreadPool 中非常罕见的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/11314 rel="external nofollow noreferrer" target=_blank>#11314</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复转换中潜在的未初始化内存. 示例: <code class=syntax>SELECT toIntervalSecond(now64())</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11311 rel="external nofollow noreferrer" target=_blank>#11311</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了如果表的主键中有 Array 列并且查询正在使用 <code class=syntax>empty</code> 或 <code class=syntax>notEmpty</code> 函数按此列过滤时索引分析无法工作的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11286 rel="external nofollow noreferrer" target=_blank>#11286</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11303 rel="external nofollow noreferrer" target=_blank>#11303</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复当查询速度估计可能不正确时的错误, 并且如果查询受到 <code class=syntax>max_network_bandwidth</code>、<code class=syntax>max_execution_speed</code> 或 <code class=syntax>priority</code> 设置的限制，<code class=syntax>min_execution_speed</code> 的限制可能无法工作或无法正常工作. 将 <code class=syntax>timeout_before_checking_execution_speed</code> 的默认值更改为非零值, 否则设置 <code class=syntax>min_execution_speed</code> 和 <code class=syntax>max_execution_speed</code> 无效. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11297 rel="external nofollow noreferrer" target=_blank>#11297</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5732 rel="external nofollow noreferrer" target=_blank>#5732</a>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6228 rel="external nofollow noreferrer" target=_blank>#6228</a>. 可用性改进: 避免在 <code class=syntax>clickhouse-client</code> 中将异常消息与进度条串联. <a href=https://github.com/ClickHouse/ClickHouse/pull/11296 rel="external nofollow noreferrer" target=_blank>#11296</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复读取 Protobuf 格式错误数据时崩溃的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5957 rel="external nofollow noreferrer" target=_blank>#5957</a>, 修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/11203 rel="external nofollow noreferrer" target=_blank>#11203</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11258 rel="external nofollow noreferrer" target=_blank>#11258</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>使用 <code class=syntax>Array(Array(LowCardinality))</code> 捕获参数修复高阶函数的可能错误 <code class=syntax>Cannot capture column</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/11185 rel="external nofollow noreferrer" target=_blank>#11185</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>如果数据跳过索引依赖于将在后台合并期间修改的列 (对于 SummingMergeTree、AggregatingMergeTree 以及 TTL GROUP BY), 则计算错误. 此问题已通过合并后移动索引计算得到修复, 因此索引是在合并数据上计算的. <a href=https://github.com/ClickHouse/ClickHouse/pull/11162 rel="external nofollow noreferrer" target=_blank>#11162</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>如果没有最终确定，则从突变终止任务中删除日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/11109 rel="external nofollow noreferrer" target=_blank>#11109</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 parseDateTime64BestEffort 参数解析错误. <a href=https://github.com/ClickHouse/ClickHouse/issues/10925 rel="external nofollow noreferrer" target=_blank>#10925</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/11038 rel="external nofollow noreferrer" target=_blank>#11038</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> <li>修复方法 getRawData() 中不正确的原始数据大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/10964 rel="external nofollow noreferrer" target=_blank>#10964</a> (<a href=https://github.com/ObjatieGroba rel="external nofollow noreferrer" target=_blank>Igr</a>).</li> <li>修复与分布式表中元组的向后兼容性. <a href=https://github.com/ClickHouse/ClickHouse/pull/10889 rel="external nofollow noreferrer" target=_blank>#10889</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复 StringHashTable 中的 SIGSEGV (如果这样的键不存在). <a href=https://github.com/ClickHouse/ClickHouse/pull/10870 rel="external nofollow noreferrer" target=_blank>#10870</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>ReplicatedMergeTree</code> 中的错误, 该错误可能导致 <code class=syntax>OPTIMIZE</code> 查询上的某些 <code class=syntax>ALTER</code> 在它变为非活动状态后挂起等待某些副本. <a href=https://github.com/ClickHouse/ClickHouse/pull/10849 rel="external nofollow noreferrer" target=_blank>#10849</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>在 Block::sortColumns() 之后修复列顺序 (还添加了一个测试，表明它会影响一些实际用例 - 缓冲区引擎). <a href=https://github.com/ClickHouse/ClickHouse/pull/10826 rel="external nofollow noreferrer" target=_blank>#10826</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复 ODBC 桥在不要求引用标识符时的问题. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/7984 rel="external nofollow noreferrer" target=_blank>#7984</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10821 rel="external nofollow noreferrer" target=_blank>#10821</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 DateLUT 中的 UBSan 和 MSan 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/10798 rel="external nofollow noreferrer" target=_blank>#10798</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li> <ul> <li>在关键条件下使用 <code class=syntax>src_type</code> 进行正确的类型转换. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/6287 rel="external nofollow noreferrer" target=_blank>#6287</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10791 rel="external nofollow noreferrer" target=_blank>#10791</a> (<a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>Andrew Onyshchuk</a>).</li> </ul> </li> <li>修复 <code class=syntax>parallel_view_processing</code> 行为. 现在, 如果发生异常, 所有对 <code class=syntax>MATERIALIZED VIEW</code> 的插入都应该无一例外地完成. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10241 rel="external nofollow noreferrer" target=_blank>#10241</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10757 rel="external nofollow noreferrer" target=_blank>#10757</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>与 -State 结合时修复组合器 -OrNull 和 -OrDefault. <a href=https://github.com/ClickHouse/ClickHouse/pull/10741 rel="external nofollow noreferrer" target=_blank>#10741</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>修复消失的总数. 如果查询具有连接或具有外部 where 条件的子查询, 则总计可能已被过滤. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/10674 rel="external nofollow noreferrer" target=_blank>#10674</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10698 rel="external nofollow noreferrer" target=_blank>#10698</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>在一个查询中使用相同的集合修复 <code class=syntax>IN</code> 运算符的多次使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/10686 rel="external nofollow noreferrer" target=_blank>#10686</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>).</li> <li>修复 AggregateTransform 构造函数中参数的顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/10667 rel="external nofollow noreferrer" target=_blank>#10667</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>).</li> <li>修复启用了 <code class=syntax>distributed_aggregation_memory_efficient</code> 的远程查询缺乏并行执行的问题. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/10655 rel="external nofollow noreferrer" target=_blank>#10655</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10664 rel="external nofollow noreferrer" target=_blank>#10664</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复分布式查询的谓词优化 (<code class=syntax>enable_optimize_predicate_expression=1</code>) 对于带有 <code class=syntax>HAVING</code> 部分的查询 (即需要在服务器启动器上进行过滤时), 通过保留表达式的顺序 (这足以修复), 并且还强制 聚合器在索引上使用列名. 修复: <a href=https://github.com/ClickHouse/ClickHouse/issues/10613 rel="external nofollow noreferrer" target=_blank>#10613</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/11413 rel="external nofollow noreferrer" target=_blank>#11413</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10621 rel="external nofollow noreferrer" target=_blank>#10621</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复错误 <code class=syntax>the BloomFilter false positive must be a double number between 0 and 1</code>. <a href=https://github.com/ClickHouse/ClickHouse/issues/10551 rel="external nofollow noreferrer" target=_blank>#10551</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10569 rel="external nofollow noreferrer" target=_blank>#10569</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复 SELECT 列 ALIAS 的默认表达式类型与列类型不同. <a href=https://github.com/ClickHouse/ClickHouse/pull/10563 rel="external nofollow noreferrer" target=_blank>#10563</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>实现了 DateTime64 和 String 值之间的比较 (就像 DateTime 一样). <a href=https://github.com/ClickHouse/ClickHouse/pull/10560 rel="external nofollow noreferrer" target=_blank>#10560</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-1-12-86-2020-05-26>ClickHouse 版本 v20.1.12.86, 2020-05-26<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-12-86-2020-05-26 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_54>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_54 title="Permanent link"> </a></h4> <ul> <li>修复了 20.1 及更早版本之间两级聚合的不兼容问题. 当在发起节点和远程节点上使用不同版本的 ClickHouse 并且 GROUP BY 结果的大小很大并且由单个 String 字段执行聚合时, 就会发生这种不兼容. 结果导致单个键的多个未合并的行. <a href=https://github.com/ClickHouse/ClickHouse/pull/10952 rel="external nofollow noreferrer" target=_blank>#10952</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了合并后可能发生的 <code class=syntax>SummingMergeTree</code> 中 <code class=syntax>LowCardinality(FixedString)</code> 键列的数据损坏. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/10489 rel="external nofollow noreferrer" target=_blank>#10489</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10721 rel="external nofollow noreferrer" target=_blank>#10721</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了当 <code class=syntax>readonly=2</code> 和 <code class=syntax>cancel_http_readonly_queries_on_client_close=1</code> 时导致 http 请求卡在客户端关闭的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7939 rel="external nofollow noreferrer" target=_blank>#7939</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7019 rel="external nofollow noreferrer" target=_blank>#7019</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7736 rel="external nofollow noreferrer" target=_blank>#7736</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7091 rel="external nofollow noreferrer" target=_blank>#7091</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10684 rel="external nofollow noreferrer" target=_blank>#10684</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了在 <code class=syntax>SYSTEM DROP DNS CACHE</code> 查询也删除缓存时的错误, 用于检查是否允许用户从某些 IP 地址连接. <a href=https://github.com/ClickHouse/ClickHouse/pull/10608 rel="external nofollow noreferrer" target=_blank>#10608</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>).</li> <li>修复了 <code class=syntax>MATERIALIZED VIEW</code> 内部查询中不正确的标量结果, 以防该查询包含相关表. <a href=https://github.com/ClickHouse/ClickHouse/pull/10603 rel="external nofollow noreferrer" target=_blank>#10603</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复所有部分 mutation 完成, 但是在 <code class=syntax>is_done=0</code> 中挂掉的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/10526 rel="external nofollow noreferrer" target=_blank>#10526</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 unix 纪元开始时与 UTC 有小数偏移的时区的溢出. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9335 rel="external nofollow noreferrer" target=_blank>#9335</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10513 rel="external nofollow noreferrer" target=_blank>#10513</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了分布式存储的不当关闭. <a href=https://github.com/ClickHouse/ClickHouse/pull/10491 rel="external nofollow noreferrer" target=_blank>#10491</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>simpleLinearRegression</code> 中大整数上的数字溢出. <a href=https://github.com/ClickHouse/ClickHouse/pull/10474 rel="external nofollow noreferrer" target=_blank>#10474</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>).</li> <li>修复了附加数据库失败时删除元数据目录的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/10442 rel="external nofollow noreferrer" target=_blank>#10442</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>在创建 <code class=syntax>BloomFilter</code> 索引时添加了对参数数量和类型的检查 <a href=https://github.com/ClickHouse/ClickHouse/issues/9623 rel="external nofollow noreferrer" target=_blank>#9623</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10431 rel="external nofollow noreferrer" target=_blank>#10431</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复了使用 <code class=syntax>ARRAY JOIN</code>、<code class=syntax>ORDER BY</code> 和 <code class=syntax>LIMIT</code> 的查询可能返回不完整结果的问题. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10226 rel="external nofollow noreferrer" target=_blank>#10226</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10427 rel="external nofollow noreferrer" target=_blank>#10427</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>更喜欢 <code class=syntax>fallback_to_stale_replicas</code> 而不是 <code class=syntax>skip_unavailable_shards</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10422 rel="external nofollow noreferrer" target=_blank>#10422</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了 <code class=syntax>Array(Tuple(...))</code> 数据类型的错误扁平化. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/10259 rel="external nofollow noreferrer" target=_blank>#10259</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10390 rel="external nofollow noreferrer" target=_blank>#10390</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了在尝试从缓冲区读取 HashMap 时导致编译错误的 <code class=syntax>HashTable</code> 中的错误行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/10386 rel="external nofollow noreferrer" target=_blank>#10386</a> (<a href=https://github.com/palasonic1 rel="external nofollow noreferrer" target=_blank>palasonic1</a>).</li> <li>修复了 <code class=syntax>ConcatProcessor</code> 中可能发生的 <code class=syntax>Pipeline stuck</code> 错误, 该错误可能发生在远程查询中. <a href=https://github.com/ClickHouse/ClickHouse/pull/10381 rel="external nofollow noreferrer" target=_blank>#10381</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>使用 <code class=syntax>max_rows_to_group_by</code> 和 <code class=syntax>group_by_overflow_mode = 'break'</code> 修复了错误 <code class=syntax>Pipeline stuck</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10279 rel="external nofollow noreferrer" target=_blank>#10279</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了一些错误, 当某些数据以法定人数插入, 然后以某种方式删除 (DROP PARTITION, TTL) 时, 这会导致插入卡住或 SELECT 中的误报异常. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9946 rel="external nofollow noreferrer" target=_blank>#9946</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10188 rel="external nofollow noreferrer" target=_blank>#10188</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>).</li> <li>修复了在远程服务器上使用 18.12.17 之前的版本而在启动服务器上使用较新版本时不兼容的问题, 以及 GROUP BY 固定和非固定键, 以及激活两级分组方法时. <a href=https://github.com/ClickHouse/ClickHouse/pull/3254 rel="external nofollow noreferrer" target=_blank>#3254</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_21>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_21 title="Permanent link"> </a></h4> <ul> <li>将 CA 证书添加到 clickhouse-server docker 镜像. <a href=https://github.com/ClickHouse/ClickHouse/pull/10476 rel="external nofollow noreferrer" target=_blank>#10476</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-1-10-70-2020-04-17>ClickHouse 版本 v20.1.10.70, 2020-04-17<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-10-70-2020-04-17 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_55>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_55 title="Permanent link"> </a></h4> <ul> <li>修复罕见的可能异常 <code class=syntax>Cannot drain connections: cancel first</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10239 rel="external nofollow noreferrer" target=_blank>#10239</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复了当用户尝试在带有 <code class=syntax>ENGINE = Replicated*</code> 的表上运行 <code class=syntax>ALTER UPDATE/DELETE</code> 时, ClickHouse 会抛出 <code class=syntax>Unknown function lambda.</code> 错误消息的错误. 检查非确定性函数现在可以正确处理 lambda 表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/10237 rel="external nofollow noreferrer" target=_blank>#10237</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>).</li> <li>修复 RFC-2822 中字符串的 <code class=syntax>parseDateTimeBestEffort</code>, 当一周中的某一天是星期二或星期四时. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/10082 rel="external nofollow noreferrer" target=_blank>#10082</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10214 rel="external nofollow noreferrer" target=_blank>#10214</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复 <code class=syntax>JOIN</code> 内的常量列名可能与 <code class=syntax>JOIN</code> 外的常量名冲突. <a href=https://github.com/ClickHouse/ClickHouse/pull/10207 rel="external nofollow noreferrer" target=_blank>#10207</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>修复了可能的无限查询执行, 当查询实际上应该在LIMIT上停止, 而从无限源读取, 如 <code class=syntax>system.numbers</code> 或 <code class=syntax>system.zeros</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10206 rel="external nofollow noreferrer" target=_blank>#10206</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>在存在<code class=syntax>array Join</code>函数的情况下修复移动到prewhere优化 (在某些情况下). 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/10092 rel="external nofollow noreferrer" target=_blank>#10092</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10195 rel="external nofollow noreferrer" target=_blank>#10195</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>).</li> <li>添加放宽对使用 <code class=syntax>allow_nondeterministic_mutations</code> 设置的突变中非确定性函数使用限制的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/10186 rel="external nofollow noreferrer" target=_blank>#10186</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>).</li> <li>如果结构在 <code class=syntax>INSERT</code> 上不匹配，则将块转换为带有 <code class=syntax>Distributed</code> 引擎的表. <a href=https://github.com/ClickHouse/ClickHouse/pull/10135 rel="external nofollow noreferrer" target=_blank>#10135</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>当其结构与底层表不同时, 将 <code class=syntax>INSERT</code> 上的 <code class=syntax>SIGSEGV</code> 修复到 <code class=syntax>Distributed</code> 表中. <a href=https://github.com/ClickHouse/ClickHouse/pull/10105 rel="external nofollow noreferrer" target=_blank>#10105</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>使用 <code class=syntax>JOIN</code> 和 <code class=syntax>UNION ALL</code> 修复查询可能丢失的行. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9826 rel="external nofollow noreferrer" target=_blank>#9826</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/10113 rel="external nofollow noreferrer" target=_blank>#10113</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/10099 rel="external nofollow noreferrer" target=_blank>#10099</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>为 MySQL 数据库引擎添加参数检查和支持标识符参数. <a href=https://github.com/ClickHouse/ClickHouse/pull/10077 rel="external nofollow noreferrer" target=_blank>#10077</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>).</li> <li>修复来自 localhost clickhouse 服务器的 clickhouse 字典源中的错误. 如果字典和源中的类型不兼容, 该错误可能会导致内存损坏. <a href=https://github.com/ClickHouse/ClickHouse/pull/10071 rel="external nofollow noreferrer" target=_blank>#10071</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复错误 <code class=syntax>Cannot clone block with columns because block has 0 columns ... While executing GroupingAggregatedTransform</code>. 当设置 <code class=syntax>distributed_aggregation_memory_efficient</code> 被启用, 并且分布式查询从不同分片读取不同级别的聚合数据时发生这种情况 (混合单级和二级聚合). <a href=https://github.com/ClickHouse/ClickHouse/pull/10063 rel="external nofollow noreferrer" target=_blank>#10063</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>修复在包含尾随零字节的字符串键上的 <code class=syntax>GROUP BY</code> 中可能发生的分段错误 (<a href=https://github.com/ClickHouse/ClickHouse/issues/8636 rel="external nofollow noreferrer" target=_blank>#8636</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/8925 rel="external nofollow noreferrer" target=_blank>#8925</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/10025 rel="external nofollow noreferrer" target=_blank>#10025</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>).</li> <li>修复了在某些数据库查询的处理阶段之一未检索到必要表的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9699 rel="external nofollow noreferrer" target=_blank>#9699</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9949 rel="external nofollow noreferrer" target=_blank>#9949</a> (<a href=https://github.com/achulkov2 rel="external nofollow noreferrer" target=_blank>achulkov2</a>).</li> <li>修复 <code class=syntax>JOIN</code> 与 <code class=syntax>TOTALS</code> 一起出现时的 <code class=syntax>Not found column in block</code> 错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9839 rel="external nofollow noreferrer" target=_blank>#9839</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9939 rel="external nofollow noreferrer" target=_blank>#9939</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复 <code class=syntax>ON CLUSTER</code> DDL 查询在服务器启动时冻结的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9927 rel="external nofollow noreferrer" target=_blank>#9927</a> (<a href=https://github.com/garneja rel="external nofollow noreferrer" target=_blank>Gagan Arneja</a>).</li> <li>修复连接表引擎的 <code class=syntax>TRUNCATE</code> (<a href=https://github.com/ClickHouse/ClickHouse/issues/9917 rel="external nofollow noreferrer" target=_blank>#9917</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9920 rel="external nofollow noreferrer" target=_blank>#9920</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复 ALTER 查询中的 <code class=syntax>scalar does not exist</code> 错误 (<a href=https://github.com/ClickHouse/ClickHouse/issues/9878 rel="external nofollow noreferrer" target=_blank>#9878</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/9904 rel="external nofollow noreferrer" target=_blank>#9904</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> <li>修复 <code class=syntax>ReplicatedMergeTree</code> 中删除和优化之间的竞争条件. <a href=https://github.com/ClickHouse/ClickHouse/pull/9901 rel="external nofollow noreferrer" target=_blank>#9901</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>修复了 <code class=syntax>ATTACH PART</code> 中的 <code class=syntax>DeleteOnDestroy</code> 逻辑, 这可能导致自动删除附加部分并添加了一些测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/9410 rel="external nofollow noreferrer" target=_blank>#9410</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_22>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_22 title="Permanent link"> </a></h4> <ul> <li>修复单元测试 <code class=syntax>collapsing_sorted_stream</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9367 rel="external nofollow noreferrer" target=_blank>#9367</a> (<a href=https://github.com/ghost rel="external nofollow noreferrer" target=_blank>Deleted user</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-1-9-54-2020-03-28>ClickHouse 版本 v20.1.9.54, 2020-03-28<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-9-54-2020-03-28 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_56>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_56 title="Permanent link"> </a></h4> <ul> <li>修正了在分布式表上有 <code class=syntax>PREWHERE</code> 和 <code class=syntax>WHERE</code> 以及 <code class=syntax>SET distributed_product_mode = 'local'</code> 时出现的 <code class=syntax>Different expressions with the same alias</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/9871 rel="external nofollow noreferrer" target=_blank>#9871</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>).</li> <li>修复具有复合主键的表的突变过多的内存消耗. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9850 rel="external nofollow noreferrer" target=_blank>#9850</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9860 rel="external nofollow noreferrer" target=_blank>#9860</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> <li>对于 INSERT 查询, 分片现在将从发起者获得的设置限制在分片的约束中, 而不是抛出异常. 此修复允许将 <code class=syntax>INSERT</code> 查询发送到具有另一个约束的分片. 此更改改进了修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9447 rel="external nofollow noreferrer" target=_blank>#9447</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9852 rel="external nofollow noreferrer" target=_blank>#9852</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>).</li> <li>修复客户端上可能出现的异常 <code class=syntax>Got 0 in totals chunk, expected 1</code> on client. 如果右连接表有零行, 则使用“JOIN”进行查询时会发生这种情况. 示例: <code class=syntax>select * from system.one t1 join system.one t2 on t1.dummy = t2.dummy limit 0 FORMAT TabSeparated;</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9777 rel="external nofollow noreferrer" target=_blank>#9777</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9823 rel="external nofollow noreferrer" target=_blank>#9823</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>).</li> <li>当类型无法转换时, 使用 <code class=syntax>optimize_skip_unused_shards</code> 修复 <code class=syntax>SIGSEGV</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9804 rel="external nofollow noreferrer" target=_blank>#9804</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>).</li> <li>修复了函数参数的时区使用不正确的一些情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/9574 rel="external nofollow noreferrer" target=_blank>#9574</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>).</li> </ul> <h4 id=gai-jin_21>改进<a class=headerlink href=../amp/#gai-jin_21 title="Permanent link"> </a></h4> <ul> <li>从突变中移除 <code class=syntax>ORDER BY</code> 阶段, 因为我们从单个线程中的单个有序部分读取. 还添加检查突变中的行顺序是否按排序键顺序排序并且不违反此顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/9886 rel="external nofollow noreferrer" target=_blank>#9886</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>).</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_23>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_23 title="Permanent link"> </a></h4> <ul> <li>清理重复的链接器标志. 确保链接器不会查找意外的符号. <a href=https://github.com/ClickHouse/ClickHouse/pull/9433 rel="external nofollow noreferrer" target=_blank>#9433</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>).</li> </ul> <h3 id=clickhouse-ban-ben-v20-1-8-41-2020-03-20>ClickHouse 版本 v20.1.8.41, 2020-03-20<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-8-41-2020-03-20 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_57>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_57 title="Permanent link"> </a></h4> <ul> <li>修复可能的永久性 <code class=syntax>Cannot schedule a task</code> 错误 (由于 <code class=syntax>ParallelAggregatingBlockInputStream::Handler::onFinish/onFinishThread</code> 中的未处理异常). 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6833 rel="external nofollow noreferrer" target=_blank>#6833</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9154 rel="external nofollow noreferrer" target=_blank>#9154</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复 <code class=syntax>ALTER</code> 查询 (突变) 中的过多内存消耗. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9533 rel="external nofollow noreferrer" target=_blank>#9533</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/9670 rel="external nofollow noreferrer" target=_blank>#9670</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9754 rel="external nofollow noreferrer" target=_blank>#9754</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复外部字典 DDL 中反引号的错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9619 rel="external nofollow noreferrer" target=_blank>#9619</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9734 rel="external nofollow noreferrer" target=_blank>#9734</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> </ul> <h3 id=clickhouse-ban-ben-v20-1-7-38-2020-03-18>ClickHouse 版本 v20.1.7.38, 2020-03-18<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-7-38-2020-03-18 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_58>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_58 title="Permanent link"> </a></h4> <ul> <li>修复了 <code class=syntax>sumKahan</code> 和 <code class=syntax>sumWithOverflow</code> 不正确的内部函数名称. 在远程查询中使用此函数时导致异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/9636 rel="external nofollow noreferrer" target=_blank>#9636</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>). This issue was in all ClickHouse releases.</li> <li>允许具有内部复制的 <code class=syntax>Distributed</code> 表的 <code class=syntax>ALTER ON CLUSTER</code> . 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/3268 rel="external nofollow noreferrer" target=_blank>#3268</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9617 rel="external nofollow noreferrer" target=_blank>#9617</a> (<a href=https://github.com/shinoi2 rel="external nofollow noreferrer" target=_blank>shinoi2</a>). This issue was in all ClickHouse releases.</li> <li>修复 <code class=syntax>MergeTreeRangeReader</code> 中可能出现的异常 <code class=syntax>Size of filter does not match size of column</code> 和 <code class=syntax>Invalid number of rows in Chunk</code> . 在某些情况下, 它们可能会在执行 <code class=syntax>PREWHERE</code> 时出现. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9132 rel="external nofollow noreferrer" target=_blank>#9132</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9612 rel="external nofollow noreferrer" target=_blank>#9612</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修正了这个问题: 如果你写一个简单的算术表达式, 比如 <code class=syntax>time + 1</code> (与像 <code class=syntax>time + INTERVAL 1 SECOND</code> 这样的表达式相反), 时区不会被保留. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5743 rel="external nofollow noreferrer" target=_blank>#5743</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9323 rel="external nofollow noreferrer" target=_blank>#9323</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)。 此问题存在于所有 ClickHouse 版本中.</li> <li>现在无法创建或添加具有简单循环别名的列, 例如 <code class=syntax>a DEFAULT b, b DEFAULT a</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/9603 rel="external nofollow noreferrer" target=_blank>#9603</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 base64 编码值末尾填充可能格式错误的问题. 更新 base64 库. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9491 rel="external nofollow noreferrer" target=_blank>#9491</a>, closes <a href=https://github.com/ClickHouse/ClickHouse/issues/9492 rel="external nofollow noreferrer" target=_blank>#9492</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9500 rel="external nofollow noreferrer" target=_blank>#9500</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>Poco::HTTPServer</code> 破坏时的数据竞争. 服务器启动并立即关闭时可能会发生这种情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/9468 rel="external nofollow noreferrer" target=_blank>#9468</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>当有很多行等于第 n 行时, 修复 <code class=syntax>LIMIT n WITH TIES</code> 中可能的崩溃/错误的行数. <a href=https://github.com/ClickHouse/ClickHouse/pull/9464 rel="external nofollow noreferrer" target=_blank>#9464</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>使用列 TTL 修复可能不匹配的校验和. <a href=https://github.com/ClickHouse/ClickHouse/pull/9451 rel="external nofollow noreferrer" target=_blank>#9451</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>修复当用户尝试为旧格式的 <code class=syntax>MergeTree</code> 表引擎系列 <code class=syntax>ALTER MODIFY SETTING</code> 时崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/9435 rel="external nofollow noreferrer" target=_blank>#9435</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>现在我们将尝试更频繁地完成突变. <a href=https://github.com/ClickHouse/ClickHouse/pull/9427 rel="external nofollow noreferrer" target=_blank>#9427</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/8598 rel="external nofollow noreferrer" target=_blank>#8598</a> 中引入的复制协议不兼容问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/9412 rel="external nofollow noreferrer" target=_blank>#9412</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复 not(has()) 数组类型的bloom_filter索引. <a href=https://github.com/ClickHouse/ClickHouse/pull/9407 rel="external nofollow noreferrer" target=_blank>#9407</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li> <li>修复了当 haystack 有零字节时<code class=syntax>match</code> 和<code class=syntax>extract</code> 函数的行为. 当 haystack 不变时, 行为是错误的. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9160 rel="external nofollow noreferrer" target=_blank>#9160</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9163 rel="external nofollow noreferrer" target=_blank>#9163</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/9345 rel="external nofollow noreferrer" target=_blank>#9345</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_24>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_24 title="Permanent link"> </a></h4> <ul> <li>异常处理现在可以在适用于 Linux 的 Windows 子系统上正常工作. 参见 <a href=https://github.com/ClickHouse-Extras/libunwind/pull/3 target=_blank>https://github.com/ClickHouse-Extras/libunwind/pull/3</a> 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6480 rel="external nofollow noreferrer" target=_blank>#6480</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/9564 rel="external nofollow noreferrer" target=_blank>#9564</a> (<a href=https://github.com/sobolevsv rel="external nofollow noreferrer" target=_blank>sobolevsv</a>)</li> </ul> <h3 id=clickhouse-ban-ben-v20-1-6-30-2020-03-05>ClickHouse 版本 v20.1.6.30, 2020-03-05<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-6-30-2020-03-05 title="Permanent link"> </a></h3> <h4 id=bug-xiu-fu_59>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_59 title="Permanent link"> </a></h4> <ul> <li>修复使用 <code class=syntax>T64</code> 编解码器压缩时数据不兼容的问题.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9039 rel="external nofollow noreferrer" target=_blank>#9039</a> <a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>(abyss7)</a></li> <li>在一个线程中从 MergeTree 表读取时修复范围的顺序. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/8964 rel="external nofollow noreferrer" target=_blank>#8964</a>.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9050 rel="external nofollow noreferrer" target=_blank>#9050</a> <a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>(CurtizJ)</a></li> <li>修复在执行 <code class=syntax>PREWHERE</code> 时在 <code class=syntax>MergeTreeRangeReader</code> 中可能出现的段错误. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/9064 rel="external nofollow noreferrer" target=_blank>#9064</a>.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9106 rel="external nofollow noreferrer" target=_blank>#9106</a> <a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>(CurtizJ)</a></li> <li>修复 <code class=syntax>reinterpretAsFixedString</code> 以返回 <code class=syntax>FixedString</code> 而不是 <code class=syntax>String</code>.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9052 rel="external nofollow noreferrer" target=_blank>#9052</a> <a href=https://github.com/oandrew rel="external nofollow noreferrer" target=_blank>(oandrew)</a></li> <li>使用可为空的返回类型修复 <code class=syntax>joinGet</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/8919 rel="external nofollow noreferrer" target=_blank>#8919</a><br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9014 rel="external nofollow noreferrer" target=_blank>#9014</a> <a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>(amosbird)</a></li> <li>修复模糊测试和 bitTestAll/bitTestAny 函数的错误行为.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9143 rel="external nofollow noreferrer" target=_blank>#9143</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>(alexey-milovidov)</a></li> <li>修复 haystack 为零字节时匹配和提取函数的行为. 当 haystack 不变时, 行为是错误的. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9160 rel="external nofollow noreferrer" target=_blank>#9160</a><br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9163 rel="external nofollow noreferrer" target=_blank>#9163</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>(alexey-milovidov)</a></li> <li>修复了使用非严格单调函数索引时反向谓词的执行. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9034 rel="external nofollow noreferrer" target=_blank>#9034</a><br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9223 rel="external nofollow noreferrer" target=_blank>#9223</a> <a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>(Akazz)</a></li> <li>如果 <code class=syntax>WHERE</code> 部分中有 <code class=syntax>[NOT] LIKE</code> 运算符, 则允许将 <code class=syntax>CROSS</code> 重写为 <code class=syntax>INNER JOIN</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9191 rel="external nofollow noreferrer" target=_blank>#9191</a><br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9229 rel="external nofollow noreferrer" target=_blank>#9229</a> <a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>(4ertus2)</a></li> <li>允许带有日志引擎的表中的第一列作为别名.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9231 rel="external nofollow noreferrer" target=_blank>#9231</a> <a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>(abyss7)</a></li> <li>允许在内部使用逗号连接 <code class=syntax>IN()</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7314 rel="external nofollow noreferrer" target=_blank>#7314</a>.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9251 rel="external nofollow noreferrer" target=_blank>#9251</a> <a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>(4ertus2)</a></li> <li>改进<code class=syntax>ALTER MODIFY/ADD</code>查询逻辑. 现在你不能在没有类型的情况下 <code class=syntax>ADD</code> 列, <code class=syntax>MODIFY</code> 默认表达式不会改变列的类型, <code class=syntax>MODIFY</code> 类型不会丢失默认表达式值. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/8669 rel="external nofollow noreferrer" target=_blank>#8669</a>.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9227 rel="external nofollow noreferrer" target=_blank>#9227</a> <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>(alesapin)</a></li> <li>修复突变完成, 当已经完成突变时, 状态可以为 is_done=0.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9217 rel="external nofollow noreferrer" target=_blank>#9217</a> <a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>(alesapin)</a></li> <li>支持 system.numbers 和 system.numbers_mt 的 <code class=syntax>Processors</code> 管道. 这也修复了不遵守 <code class=syntax>max_execution_time</code> 时的错误.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/7796 rel="external nofollow noreferrer" target=_blank>#7796</a> <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>(KochetovNicolai)</a></li> <li>修复 <code class=syntax>DictCacheKeysRequestedFound</code> 指标的错误计数.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9411 rel="external nofollow noreferrer" target=_blank>#9411</a> <a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>(nikitamikhaylov)</a></li> <li>在<code class=syntax>ATTACH PARTITION FROM</code>、<code class=syntax>REPLACE PARTITION</code>、<code class=syntax>MOVE TO TABLE</code> 中添加了对存储策略的检查, 否则可能会使重启后部分数据无法访问并阻止ClickHouse启动.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9383 rel="external nofollow noreferrer" target=_blank>#9383</a> <a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>(excitoon)</a></li> <li>修复了 <code class=syntax>MergeTreeIndexSet</code> 中的 UBSan 报告. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9250 rel="external nofollow noreferrer" target=_blank>#9250</a><br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9365 rel="external nofollow noreferrer" target=_blank>#9365</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>(alexey-milovidov)</a></li> <li>修复 BlockIO 中可能的数据竞争.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9356 rel="external nofollow noreferrer" target=_blank>#9356</a> <a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>(KochetovNicolai)</a></li> <li>支持在 JSON 相关函数中不适合 Int64 的 <code class=syntax>UInt64</code> 数字. 将 <code class=syntax>SIMDJSON</code> 更新为 master. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/9209 rel="external nofollow noreferrer" target=_blank>#9209</a><br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9344 rel="external nofollow noreferrer" target=_blank>#9344</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>(alexey-milovidov)</a></li> <li>修复了如果数据目录安装到单独的设备时无法正确计算可用空间量的问题. 对于默认磁盘, 从数据子目录计算可用空间. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7441 rel="external nofollow noreferrer" target=_blank>#7441</a><br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9257 rel="external nofollow noreferrer" target=_blank>#9257</a> <a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>(millb)</a></li> <li>修复 TLS 连接可能失败并显示消息 <code class=syntax>OpenSSL SSL_read: error:14094438:SSL routines:ssl3_read_bytes:tlsv1 alert internal error and SSL Exception: error:2400006E:random number generator::error retrieving entropy.</code> . 更新 OpenSSL 到上游掌握.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/8956 rel="external nofollow noreferrer" target=_blank>#8956</a> <a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>(alexey-milovidov)</a></li> <li>执行 <code class=syntax>CREATE</code> 查询时, 在存储引擎参数中折叠常量表达式. 用当前数据库替换空数据库名称. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6508 rel="external nofollow noreferrer" target=_blank>#6508</a>、<a href=https://github.com/ClickHouse/ClickHouse/issues/3492 rel="external nofollow noreferrer" target=_blank>#3492</a>. 还修复了 ClickHouseDictionarySource 中本地地址的检查.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9262 rel="external nofollow noreferrer" target=_blank>#9262</a> <a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>(tabplubix)</a></li> <li>修复 <code class=syntax>StorageMerge</code> 中的段错误, 这在从 StorageFile 读取时可能发生<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9387 rel="external nofollow noreferrer" target=_blank>#9387</a> <a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>(tabplubix)</a></li> <li>在读取后缀之后但提交之前发生异常时, 在极少数情况下防止在 <code class=syntax>Kafka</code> 中丢失数据. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/9378 rel="external nofollow noreferrer" target=_blank>#9378</a>. Related: <a href=https://github.com/ClickHouse/ClickHouse/issues/7175 rel="external nofollow noreferrer" target=_blank>#7175</a><br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9507 rel="external nofollow noreferrer" target=_blank>#9507</a> <a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>(filimonov)</a></li> <li>修复在尝试使用/删除使用错误参数创建的 <code class=syntax>Kafka</code> 表时导致服务器终止的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/9494 rel="external nofollow noreferrer" target=_blank>#9494</a>. Incorporates <a href=https://github.com/ClickHouse/ClickHouse/issues/9507 rel="external nofollow noreferrer" target=_blank>#9507</a>.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9513 rel="external nofollow noreferrer" target=_blank>#9513</a> <a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>(filimonov)</a></li> </ul> <h4 id=xin-te-zheng_12>新特征<a class=headerlink href=../amp/#xin-te-zheng_12 title="Permanent link"> </a></h4> <ul> <li>添加 <code class=syntax>deduplicate_blocks_in_dependent_materialized_views</code> 选项以控制幂等插入到具有物化视图的表中的行为. 应 Altinity 的特殊要求, 此新功能已添加到错误修复版本中.<br> <a href=https://github.com/ClickHouse/ClickHouse/pull/9070 rel="external nofollow noreferrer" target=_blank>#9070</a> <a href=https://github.com/urykhy rel="external nofollow noreferrer" target=_blank>(urykhy)</a></li> </ul> <h3 id=clickhouse-ban-ben-v20-1-2-4-2020-01-22>ClickHouse 版本 v20.1.2.4, 2020-01-22<a class=headerlink href=../amp/#clickhouse-ban-ben-v20-1-2-4-2020-01-22 title="Permanent link"> </a></h3> <h4 id=xiang-hou-bu-jian-rong-bian-geng_10>向后不兼容变更<a class=headerlink href=../amp/#xiang-hou-bu-jian-rong-bian-geng_10 title="Permanent link"> </a></h4> <ul> <li>使设置 <code class=syntax>merge_tree_uniform_read_distribution</code> 过时. 服务器仍然可以识别此设置, 但没有效果. <a href=https://github.com/ClickHouse/ClickHouse/pull/8308 rel="external nofollow noreferrer" target=_blank>#8308</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将函数 <code class=syntax>greatCircleDistance</code> 的返回类型更改为 <code class=syntax>Float32</code> , 因为现在计算的结果是 <code class=syntax>Float32</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/7993 rel="external nofollow noreferrer" target=_blank>#7993</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>现在预计查询参数以 <code class=syntax>escaped</code> 格式表示. 例如, 要传递字符串 <code class=syntax>a&lt;tab&gt;b</code> , 您必须在URL 中分别写入 <code class=syntax>a\tb</code> 或 <code class=syntax>a\&lt;tab&gt;b</code> 以及 <code class=syntax>a%5Ctb</code> 或 <code class=syntax>a%5C%09b</code>. 这需要添加将 NULL 作为 <code class=syntax>\N</code> 传递的可能性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7488 rel="external nofollow noreferrer" target=_blank>#7488</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8517 rel="external nofollow noreferrer" target=_blank>#8517</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>默认情况下为 <code class=syntax>ReplicatedMergeTree</code> 启用 <code class=syntax>use_minimalistic_part_header_in_zookeeper</code> 设置. 这将显着减少存储在 ZooKeeper 中的数据量. 从 19.1 版开始支持此设置, 我们已经在多个服务的生产中使用它半年多没有任何问题. 如果您有机会降级到 19.1 之前的版本, 请禁用此设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/6850 rel="external nofollow noreferrer" target=_blank>#6850</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>数据跳过索引已准备好生产并默认启用. 设置 <code class=syntax>allow_experimental_data_skipping_indices</code>、<code class=syntax>allow_experimental_cross_to_join_conversion</code> 和 <code class=syntax>allow_experimental_multiple_joins_emulation</code> 现在已经过时并且什么都不做. <a href=https://github.com/ClickHouse/ClickHouse/pull/7974 rel="external nofollow noreferrer" target=_blank>#7974</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为与 <code class=syntax>JOIN</code> 操作一致的 <code class=syntax>StorageJoin</code> 添加新的 <code class=syntax>ANY JOIN</code> 逻辑. 要在不改变行为的情况下进行升级, 您需要将 <code class=syntax>SETTINGS any_join_distinct_right_table_keys = 1</code> 添加到引擎连接表元数据或在升级后重新创建这些表. <a href=https://github.com/ClickHouse/ClickHouse/pull/8400 rel="external nofollow noreferrer" target=_blank>#8400</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>需要重新启动服务器以应用日志配置中的更改. 这是一个临时解决方法, 以避免服务器记录到已删除的日志文件的错误 (请参阅 <a href=https://github.com/ClickHouse/ClickHouse/issues/8696 rel="external nofollow noreferrer" target=_blank>#8696</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8707 rel="external nofollow noreferrer" target=_blank>#8707</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> </ul> <h4 id=xin-te-zheng_13>新特征<a class=headerlink href=../amp/#xin-te-zheng_13 title="Permanent link"> </a></h4> <ul> <li>向 <code class=syntax>system.merges</code> 添加了有关部件路径的信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/8043 rel="external nofollow noreferrer" target=_blank>#8043</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>添加在 <code class=syntax>ON CLUSTER</code> 模式下执行 <code class=syntax>SYSTEM RELOAD DICTIONARY</code> 查询的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/8288 rel="external nofollow noreferrer" target=_blank>#8288</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> <li>添加在 <code class=syntax>ON CLUSTER</code> 模式下执行 <code class=syntax>CREATE DICTIONARY</code> 查询的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/8163 rel="external nofollow noreferrer" target=_blank>#8163</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>现在用户在 <code class=syntax>users.xml</code> 中的配置文件可以继承多个配置文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/8343 rel="external nofollow noreferrer" target=_blank>#8343</a> (<a href=https://github.com/Felixoid rel="external nofollow noreferrer" target=_blank>Mikhail f. Shiryaev</a>)</li> <li>添加了 <code class=syntax>system.stack_trace</code> 表, 允许查看所有服务器线程的堆栈跟踪. 这对于开发人员自省服务器状态很有用. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/7576 rel="external nofollow noreferrer" target=_blank>#7576</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8344 rel="external nofollow noreferrer" target=_blank>#8344</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加具有可配置亚秒级精度的 <code class=syntax>DateTime64</code> 数据类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/7170 rel="external nofollow noreferrer" target=_blank>#7170</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>添加表函数 <code class=syntax>clusterAllReplicas</code>, 允许查询集群中的所有节点. <a href=https://github.com/ClickHouse/ClickHouse/pull/8493 rel="external nofollow noreferrer" target=_blank>#8493</a> (<a href=https://github.com/kiransunkari rel="external nofollow noreferrer" target=_blank>kiran sunkari</a>)</li> <li>添加聚合函数 <code class=syntax>categoricalInformationValue</code>, 用于计算离散特征的信息值. <a href=https://github.com/ClickHouse/ClickHouse/pull/8117 rel="external nofollow noreferrer" target=_blank>#8117</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>通过并行执行来加速对 <code class=syntax>CSV</code>、<code class=syntax>TSV</code> 和 <code class=syntax>JSONEachRow</code> 格式的数据文件的解析. <a href=https://github.com/ClickHouse/ClickHouse/pull/7780 rel="external nofollow noreferrer" target=_blank>#7780</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>添加执行银行家舍入的函数<code class=syntax>bankerRound</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8112 rel="external nofollow noreferrer" target=_blank>#8112</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>在区域名称的嵌入式字典中支持更多语言: 'ru', 'en', 'ua', 'uk', 'by', 'kz', 'tr', 'de', 'uz', 'lv', 'lt', 'et', 'pt', 'he', 'vi'. <a href=https://github.com/ClickHouse/ClickHouse/pull/8189 rel="external nofollow noreferrer" target=_blank>#8189</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>改进了 <code class=syntax>ANY JOIN</code> 逻辑的一致性. 现在 <code class=syntax>t1 ANY LEFT JOIN t2</code> 等于 <code class=syntax>t2 ANY RIGHT JOIN t1</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7665 rel="external nofollow noreferrer" target=_blank>#7665</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>添加设置 <code class=syntax>any_join_distinct_right_table_keys</code> 以启用 <code class=syntax>ANY INNER JOIN</code> 的旧行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/7665 rel="external nofollow noreferrer" target=_blank>#7665</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>添加新的 <code class=syntax>SEMI</code> 和 <code class=syntax>ANTI JOIN</code>. 旧的 <code class=syntax>ANY INNER JOIN</code> 行为现在可用作 <code class=syntax>SEMI LEFT JOIN</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/7665 rel="external nofollow noreferrer" target=_blank>#7665</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>为 <code class=syntax>File</code> 引擎和 <code class=syntax>file</code> 表功能添加了 <code class=syntax>Distributed</code> 格式, 允许从异步插入到 <code class=syntax>Distributed</code>表中生成的 <code class=syntax>.bin</code> 文件中读取. <a href=https://github.com/ClickHouse/ClickHouse/pull/8535 rel="external nofollow noreferrer" target=_blank>#8535</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>为 <code class=syntax>runningAccumulate</code> 添加可选的重置列参数, 允许重置每个新键值的聚合结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/8326 rel="external nofollow noreferrer" target=_blank>#8326</a> (<a href=https://github.com/kononencheg rel="external nofollow noreferrer" target=_blank>Sergey Kononenko</a>)</li> <li>添加使用 ClickHouse 作为 Prometheus 端点的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/7900 rel="external nofollow noreferrer" target=_blank>#7900</a> (<a href=https://github.com/Vdimir rel="external nofollow noreferrer" target=_blank>vdimir</a>)</li> <li>在 <code class=syntax>config.xml</code> 中添加 <code class=syntax>&lt;remote_url_allow_hosts&gt;</code> 部分, 限制远程表引擎和表函数 <code class=syntax>URL</code>、<code class=syntax>S3</code>、<code class=syntax>HDFS</code>的允许主机. <a href=https://github.com/ClickHouse/ClickHouse/pull/7154 rel="external nofollow noreferrer" target=_blank>#7154</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>添加了函数 <code class=syntax>greatCircleAngle</code>, 以度数计算球体上的距离. <a href=https://github.com/ClickHouse/ClickHouse/pull/8105 rel="external nofollow noreferrer" target=_blank>#8105</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>更改地球半径与 H3 库一致. <a href=https://github.com/ClickHouse/ClickHouse/pull/8105 rel="external nofollow noreferrer" target=_blank>#8105</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为输入和输出添加了 <code class=syntax>JSONCompactEachRow</code> 和 <code class=syntax>JSONCompactEachRowWithNamesAndTypes</code> 格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/7841 rel="external nofollow noreferrer" target=_blank>#7841</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>添加了与文件相关的表引擎和表函数 (<code class=syntax>File</code>、<code class=syntax>S3</code>、<code class=syntax>URL</code>、<code class=syntax>HDFS</code>) 的功能, 允许根据附加引擎参数或文件扩展名读写 <code class=syntax>gzip</code> 文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/7840 rel="external nofollow noreferrer" target=_blank>#7840</a> (<a href=https://github.com/apbodrov rel="external nofollow noreferrer" target=_blank>Andrey Bodrov</a>)</li> <li>添加了 <code class=syntax>randomASCII(length)</code> 函数, 生成一个带有随机 <a href=https://en.wikipedia.org/wiki/ASCII#Printable_characters rel="external nofollow noreferrer" target=_blank>ASCII</a> 可打印字符集的字符串. <a href=https://github.com/ClickHouse/ClickHouse/pull/8401 rel="external nofollow noreferrer" target=_blank>#8401</a> (<a href=https://github.com/BayoNet rel="external nofollow noreferrer" target=_blank>BayoNet</a>)</li> <li>添加了函数 <code class=syntax>JSONExtractArrayRaw</code>, 它从 <code class=syntax>JSON</code> 字符串返回未解析的 json 数组元素的数组. <a href=https://github.com/ClickHouse/ClickHouse/pull/8081 rel="external nofollow noreferrer" target=_blank>#8081</a> (<a href=https://github.com/errx rel="external nofollow noreferrer" target=_blank>Oleg Matrokhin</a>)</li> <li>添加 <code class=syntax>arrayZip</code> 函数, 该函数允许将多个长度相等的数组组合成一个元组数组. <a href=https://github.com/ClickHouse/ClickHouse/pull/8149 rel="external nofollow noreferrer" target=_blank>#8149</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>添加根据为 <code class=syntax>*MergeTree</code> 表引擎系列配置的 <code class=syntax>TTL</code> 表达式在磁盘之间移动数据的能力. <a href=https://github.com/ClickHouse/ClickHouse/pull/8140 rel="external nofollow noreferrer" target=_blank>#8140</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>添加了新的聚合函数 <code class=syntax>avgWeighted</code>, 它允许计算加权平均值. <a href=https://github.com/ClickHouse/ClickHouse/pull/7898 rel="external nofollow noreferrer" target=_blank>#7898</a> (<a href=https://github.com/apbodrov rel="external nofollow noreferrer" target=_blank>Andrey Bodrov</a>)</li> <li>现在默认为 <code class=syntax>TSV</code>、<code class=syntax>TSKV</code>、<code class=syntax>CSV</code> 和 <code class=syntax>JSONEachRow</code> 格式启用并行解析. <a href=https://github.com/ClickHouse/ClickHouse/pull/7894 rel="external nofollow noreferrer" target=_blank>#7894</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>从<code class=syntax>H3</code> 库添加几个地理函数: <code class=syntax>h3GetResolution</code>、<code class=syntax>h3EdgeAngle</code>、<code class=syntax>h3EdgeLength</code>、<code class=syntax>h3IsValid</code> 和 <code class=syntax>h3kRing</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8034 rel="external nofollow noreferrer" target=_blank>#8034</a> (<a href=https://github.com/hombit rel="external nofollow noreferrer" target=_blank>Konstantin Malanchev</a>)</li> <li>在文件相关的存储和表函数中添加了对 brotli (<code class=syntax>br</code>) 压缩的支持. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8156 rel="external nofollow noreferrer" target=_blank>#8156</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8526 rel="external nofollow noreferrer" target=_blank>#8526</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为 <code class=syntax>SimpleAggregationFunction</code> 类型添加 <code class=syntax>groupBit*</code> 函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/8485 rel="external nofollow noreferrer" target=_blank>#8485</a> (<a href=https://github.com/YiuRULE rel="external nofollow noreferrer" target=_blank>Guillaume Tassery</a>)</li> </ul> <h4 id=bug-xiu-fu_60>Bug 修复<a class=headerlink href=../amp/#bug-xiu-fu_60 title="Permanent link"> </a></h4> <ul> <li>使用 <code class=syntax>Distributed</code> 引擎修复表的重命名. 修复问题 <a href=https://github.com/ClickHouse/ClickHouse/issues/7868 rel="external nofollow noreferrer" target=_blank>#7868</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8306 rel="external nofollow noreferrer" target=_blank>#8306</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>现在字典支持非 ClickHouse SQL 方言中任意字符串中的属性的 <code class=syntax>EXPRESSION</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8098 rel="external nofollow noreferrer" target=_blank>#8098</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复损坏的 <code class=syntax>INSERT SELECT FROM mysql(...)</code> 查询. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8070 rel="external nofollow noreferrer" target=_blank>#8070</a> 和 <a href=https://github.com/ClickHouse/ClickHouse/issues/7960 rel="external nofollow noreferrer" target=_blank>#7960</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8234 rel="external nofollow noreferrer" target=_blank>#8234</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复从 <code class=syntax>JSONEachRow</code> 插入默认 <code class=syntax>Tuple</code> 时出现的错误 <code class=syntax>Mismatch column sizes</code>. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/5653 rel="external nofollow noreferrer" target=_blank>#5653</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8606 rel="external nofollow noreferrer" target=_blank>#8606</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>现在，如果将 <code class=syntax>WITH TIES</code> 与 <code class=syntax>LIMIT BY</code> 一起使用, 则会引发异常. 还添加了将 <code class=syntax>TOP</code> 与 <code class=syntax>LIMIT BY</code> 一起使用的功能. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7472 rel="external nofollow noreferrer" target=_blank>#7472</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7637 rel="external nofollow noreferrer" target=_blank>#7637</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>在 <code class=syntax>clickhouse-odbc-bridge</code> 二进制文件中修复来自新 glibc 版本的意外依赖. <a href=https://github.com/ClickHouse/ClickHouse/pull/8046 rel="external nofollow noreferrer" target=_blank>#8046</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复 <code class=syntax>*MergeTree</code> 引擎家族的检查功能错误. 现在, 如果我们在最后一个颗粒和最后一个标记 (非最终) 中有相同数量的行, 它不会失败. <a href=https://github.com/ClickHouse/ClickHouse/pull/8047 rel="external nofollow noreferrer" target=_blank>#8047</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>当基础数字类型等于表指定类型时, 修复在 <code class=syntax>ALTER</code> 查询后插入 <code class=syntax>Enum*</code> 列. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7836 rel="external nofollow noreferrer" target=_blank>#7836</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7908 rel="external nofollow noreferrer" target=_blank>#7908</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>允许函数 <code class=syntax>substring</code> 的非常量负 <code class=syntax>size</code> 参数. 这是不允许的. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/4832 rel="external nofollow noreferrer" target=_blank>#4832</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7703 rel="external nofollow noreferrer" target=_blank>#7703</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复传递给 <code class=syntax>(O|J)DBC</code> 表引擎的参数数量错误时的解析错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7709 rel="external nofollow noreferrer" target=_blank>#7709</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>将日志发送到 syslog 时使用正在运行的 clickhouse 进程的命令名称. 在以前的版本中, 使用空字符串代替命令名称. <a href=https://github.com/ClickHouse/ClickHouse/pull/8460 rel="external nofollow noreferrer" target=_blank>#8460</a> (<a href=https://github.com/mnach rel="external nofollow noreferrer" target=_blank>Michael Nacharov</a>)</li> <li>修复对 <code class=syntax>localhost</code> 允许主机的检查. 此 PR 修复了 <a href=https://github.com/ClickHouse/ClickHouse/pull/8241 rel="external nofollow noreferrer" target=_blank>#8241</a> 中提供的解决方案. <a href=https://github.com/ClickHouse/ClickHouse/pull/8342 rel="external nofollow noreferrer" target=_blank>#8342</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复在 <code class=syntax>argMin</code> 和 <code class=syntax>argMax</code> 函数中, 当结果用于 <code class=syntax>runningAccumulate</code> 函数时, 长字符串参数的罕见崩溃. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8325 rel="external nofollow noreferrer" target=_blank>#8325</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8341 rel="external nofollow noreferrer" target=_blank>#8341</a> (<a href=https://github.com/769344359 rel="external nofollow noreferrer" target=_blank>dinosaur</a>)</li> <li>使用 <code class=syntax>Buffer</code> 引擎修复表的内存过量使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/8345 rel="external nofollow noreferrer" target=_blank>#8345</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复了函数中可以将 <code class=syntax>NULL</code> 作为参数之一并返回非 NULL 的潜在错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8196 rel="external nofollow noreferrer" target=_blank>#8196</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>线程池中更好的度量计算, 用于 <code class=syntax>MergeTree</code> 表引擎的后台进程. <a href=https://github.com/ClickHouse/ClickHouse/pull/8194 rel="external nofollow noreferrer" target=_blank>#8194</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>当存在行级表过滤器时, 在 <code class=syntax>WHERE</code> 语句中修复函数 <code class=syntax>IN</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/6687 rel="external nofollow noreferrer" target=_blank>#6687</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8357 rel="external nofollow noreferrer" target=_blank>#8357</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>现在, 如果未完全解析设置值的整数值, 则会引发异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/7678 rel="external nofollow noreferrer" target=_blank>#7678</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>修复使用聚合函数查询具有两个以上本地分片的分布式表时的异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/8164 rel="external nofollow noreferrer" target=_blank>#8164</a> (<a href=https://github.com/nicelulu rel="external nofollow noreferrer" target=_blank>小路</a>)</li> <li>现在布隆过滤器可以处理零长度数组并且不执行冗余计算. <a href=https://github.com/ClickHouse/ClickHouse/pull/8242 rel="external nofollow noreferrer" target=_blank>#8242</a> (<a href=https://github.com/achimbab rel="external nofollow noreferrer" target=_blank>achimbab</a>)</li> <li>修复了通过将客户端主机与 <code class=syntax>users.xml</code> 中指定的 <code class=syntax>host_regexp</code> 匹配来检查是否允许客户端主机. <a href=https://github.com/ClickHouse/ClickHouse/pull/8241 rel="external nofollow noreferrer" target=_blank>#8241</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>放宽不明确的列检查, 导致多个 <code class=syntax>JOIN ON</code> 部分出现误报. <a href=https://github.com/ClickHouse/ClickHouse/pull/8385 rel="external nofollow noreferrer" target=_blank>#8385</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了当服务器无法以 <code class=syntax>JSON</code> 或 <code class=syntax>XML</code> 格式发送或写入数据为 <code class=syntax>String</code> 数据类型 (需要 <code class=syntax>UTF-8</code> 验证) 或压缩时可能出现的服务器崩溃 (<code class=syntax>std::terminate</code>) Brotli 算法或其他一些罕见情况下的结果数据. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7603 rel="external nofollow noreferrer" target=_blank>#7603</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8384 rel="external nofollow noreferrer" target=_blank>#8384</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 CI 发现的 <code class=syntax>StorageDistributedDirectoryMonitor</code> 中的竞争条件. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8364 rel="external nofollow noreferrer" target=_blank>#8364</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8383 rel="external nofollow noreferrer" target=_blank>#8383</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>现在 <code class=syntax>*MergeTree</code> 表引擎族中的后台合并更准确地保留存储策略卷顺序. <a href=https://github.com/ClickHouse/ClickHouse/pull/8549 rel="external nofollow noreferrer" target=_blank>#8549</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>现在表引擎 <code class=syntax>Kafka</code> 可以正常使用 <code class=syntax>Native</code> 格式. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/6731 rel="external nofollow noreferrer" target=_blank>#6731</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/7337 rel="external nofollow noreferrer" target=_blank>#7337</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/8003 rel="external nofollow noreferrer" target=_blank>#8003</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8016 rel="external nofollow noreferrer" target=_blank>#8016</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复了带有标题的格式 (如 <code class=syntax>CSVWithNames</code>), 这些格式会为表引擎 <code class=syntax>Kafka</code> 抛出有关 EOF 的异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/8016 rel="external nofollow noreferrer" target=_blank>#8016</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>修复了从 <code class=syntax>IN</code> 部分右侧的子查询进行设置的错误. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/5767 rel="external nofollow noreferrer" target=_blank>#5767</a> and <a href=https://github.com/ClickHouse/ClickHouse/issues/2542 rel="external nofollow noreferrer" target=_blank>#2542</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7755 rel="external nofollow noreferrer" target=_blank>#7755</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>修复从存储 <code class=syntax>File</code> 读取时可能发生的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/7756 rel="external nofollow noreferrer" target=_blank>#7756</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>固定读取包含类型为 <code class=syntax>list</code> 的列的 <code class=syntax>arquet</code> 格式的文件. <a href=https://github.com/ClickHouse/ClickHouse/pull/8334 rel="external nofollow noreferrer" target=_blank>#8334</a> (<a href=https://github.com/maxulan rel="external nofollow noreferrer" target=_blank>maxulan</a>)</li> <li>如果<code class=syntax>max_parallel_replicas &gt; 1</code>, 则使用依赖于采样键的 <code class=syntax>PREWHERE</code> 条件修复分布式查询的错误 <code class=syntax>Not found column</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/7913 rel="external nofollow noreferrer" target=_blank>#7913</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>如果查询使用依赖于表别名的 <code class=syntax>PREWHERE</code>, 并且由于主键条件导致结果集为空, 则修复错误 <code class=syntax>Not found column</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7911 rel="external nofollow noreferrer" target=_blank>#7911</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复了函数 <code class=syntax>rand</code> 和 <code class=syntax>randConstant</code> 在 <code class=syntax>Nullable</code> 参数的情况下的返回类型. 现在函数总是返回 <code class=syntax>UInt32</code> 而不是 <code class=syntax>Nullable(UInt32)</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8204 rel="external nofollow noreferrer" target=_blank>#8204</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>禁用了<code class=syntax>WITH FILL</code> 表达式的谓词下推. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/7784 rel="external nofollow noreferrer" target=_blank>#7784</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7789 rel="external nofollow noreferrer" target=_blank>#7789</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>修复了使用 <code class=syntax>FINAL</code> 部分时 <code class=syntax>SummingMergeTree</code> 的错误 <code class=syntax>count()</code> 结果. <a href=https://github.com/ClickHouse/ClickHouse/issues/3280 rel="external nofollow noreferrer" target=_blank>#3280</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7786 rel="external nofollow noreferrer" target=_blank>#7786</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>修复来自远程服务器的常量函数可能的错误结果. 它发生在具有诸如 <code class=syntax>version()</code>、<code class=syntax>uptime()</code> 等函数的查询中, 这些函数为不同的服务器返回不同的常量值. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7666 rel="external nofollow noreferrer" target=_blank>#7666</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7689 rel="external nofollow noreferrer" target=_blank>#7689</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复下推谓词优化中导致错误结果的复杂错误. 这修复了很多关于下推谓词优化的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/8503 rel="external nofollow noreferrer" target=_blank>#8503</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>修复 <code class=syntax>CREATE TABLE .. AS dictionary</code> 查询中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/8508 rel="external nofollow noreferrer" target=_blank>#8508</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li><code class=syntax>.g4</code> 文件中的多项改进 ClickHouse 语法. <a href=https://github.com/ClickHouse/ClickHouse/pull/8294 rel="external nofollow noreferrer" target=_blank>#8294</a> (<a href=https://github.com/taiyang-li rel="external nofollow noreferrer" target=_blank>taiyang-li</a>)</li> <li>修复导致带有引擎 <code class=syntax>Join</code> 的表在 <code class=syntax>JOIN</code> 中崩溃的错误. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7556 rel="external nofollow noreferrer" target=_blank>#7556</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/8254 rel="external nofollow noreferrer" target=_blank>#8254</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/7915 rel="external nofollow noreferrer" target=_blank>#7915</a> <a href=https://github.com/ClickHouse/ClickHouse/issues/8100 rel="external nofollow noreferrer" target=_blank>#8100</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8298 rel="external nofollow noreferrer" target=_blank>#8298</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复冗余字典重新加载到 <code class=syntax>CREATE DATABASE</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/7916 rel="external nofollow noreferrer" target=_blank>#7916</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>限制从 <code class=syntax>StorageFile</code> 和 <code class=syntax>StorageHDFS</code> 读取的最大流数。 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7650 rel="external nofollow noreferrer" target=_blank>#7650</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7981 rel="external nofollow noreferrer" target=_blank>#7981</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>当用户同时指定默认表达式和编解码器时, 修复 <code class=syntax>ALTER ... MODIFY ... CODEC</code> 查询中的错误. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/8593 rel="external nofollow noreferrer" target=_blank>8593</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8614 rel="external nofollow noreferrer" target=_blank>#8614</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复具有 <code class=syntax>SimpleAggregateFunction(LowCardinality)</code> 类型的列的后台合并错误 <a href=https://github.com/ClickHouse/ClickHouse/pull/8613 rel="external nofollow noreferrer" target=_blank>#8613</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>固定类型检查函数 <code class=syntax>toDateTime64</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8375 rel="external nofollow noreferrer" target=_blank>#8375</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>现在服务器不会在 <code class=syntax>LEFT</code> 或 <code class=syntax>FULL JOIN</code> 和Join 引擎和不支持的 <code class=syntax>join_use_nulls</code> 设置上崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/8479 rel="external nofollow noreferrer" target=_blank>#8479</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>现在, 如果 <code class=syntax>db</code> 不存在, <code class=syntax>DROP DICTIONARY IF EXISTS db.dict</code> 查询不会抛出异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/8185 rel="external nofollow noreferrer" target=_blank>#8185</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>修复由于使用对已删除的 <code class=syntax>IStorage</code> 对象的引用而导致的表函数 (<code class=syntax>file</code>、<code class=syntax>mysql</code>、<code class=syntax>remote</code>)中可能的崩溃. 修复插入表函数时指定的列的错误解析. <a href=https://github.com/ClickHouse/ClickHouse/pull/7762 rel="external nofollow noreferrer" target=_blank>#7762</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>在启动 <code class=syntax>clickhouse-server</code> 之前确保网络已启动. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7507 rel="external nofollow noreferrer" target=_blank>#7507</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8570 rel="external nofollow noreferrer" target=_blank>#8570</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>)</li> <li>修复安全连接的超时处理, 因此查询不会无限期挂起. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/8126 rel="external nofollow noreferrer" target=_blank>#8126</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8128 rel="external nofollow noreferrer" target=_blank>#8128</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复并发工作者之间的 <code class=syntax>clickhouse-copier</code> 冗余争用. <a href=https://github.com/ClickHouse/ClickHouse/pull/7816 rel="external nofollow noreferrer" target=_blank>#7816</a> (<a href=https://github.com/dingxiangfei2009 rel="external nofollow noreferrer" target=_blank>Ding Xiang Fei</a>)</li> <li>现在突变不会跳过附加的部分, 即使它们的突变版本大于当前的突变版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/7812 rel="external nofollow noreferrer" target=_blank>#7812</a> (<a href=https://github.com/yuzhichang rel="external nofollow noreferrer" target=_blank>Zhichang Yu</a>) <a href=https://github.com/ClickHouse/ClickHouse/pull/8250 rel="external nofollow noreferrer" target=_blank>#8250</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>移动到另一个磁盘和服务器重启后, 忽略 <code class=syntax>*MergeTree</code> 数据部分的冗余副本. <a href=https://github.com/ClickHouse/ClickHouse/pull/7810 rel="external nofollow noreferrer" target=_blank>#7810</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>使用 <code class=syntax>JOIN</code> 键中的 <code class=syntax>Low Cardinality</code> 修复 <code class=syntax>FULL JOIN</code> 中的崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/8252 rel="external nofollow noreferrer" target=_blank>#8252</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>禁止在插入查询中多次使用列名, 例如 <code class=syntax>INSERT INTO tbl (x, y, x)</code>. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/5465 rel="external nofollow noreferrer" target=_blank>#5465</a>, <a href=https://github.com/ClickHouse/ClickHouse/issues/7681 rel="external nofollow noreferrer" target=_blank>#7681</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7685 rel="external nofollow noreferrer" target=_blank>#7685</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>添加回退以检测未知 CPU 的物理 CPU 内核数 (使用逻辑 CPU 内核数) . 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5239 rel="external nofollow noreferrer" target=_blank>#5239</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7726 rel="external nofollow noreferrer" target=_blank>#7726</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复物化列和别名列的 <code class=syntax>There's no column</code> 错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8210 rel="external nofollow noreferrer" target=_blank>#8210</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了在没有 <code class=syntax>TABLE</code> 或 <code class=syntax>DICTIONARY</code> 限定符的情况下使用 <code class=syntax>EXISTS</code> 查询时服务器崩溃的问题. 就像 <code class=syntax>EXISTS t</code>。 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8172 rel="external nofollow noreferrer" target=_blank>#8172</a>. 这个错误是在 19.17 版本中引入的. <a href=https://github.com/ClickHouse/ClickHouse/pull/8213 rel="external nofollow noreferrer" target=_blank>#8213</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了使用 <code class=syntax>SimpleAggregateFunction</code> 列时可能出现的带有错误 <code class=syntax>"Sizes of columns not match"</code> 的罕见错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7790 rel="external nofollow noreferrer" target=_blank>#7790</a> (<a href=https://github.com/bgranvea rel="external nofollow noreferrer" target=_blank>Boris Granveaud</a>)</li> <li>修复具有空 <code class=syntax>allow_databases</code> 的用户可以访问所有数据库的错误 (对于 <code class=syntax>allow_dictionaries</code> 也是如此). <a href=https://github.com/ClickHouse/ClickHouse/pull/7793 rel="external nofollow noreferrer" target=_blank>#7793</a> (<a href=https://github.com/DeifyTheGod rel="external nofollow noreferrer" target=_blank>DeifyTheGod</a>)</li> <li>当服务器已经与客户端断开连接时修复客户端崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/8071 rel="external nofollow noreferrer" target=_blank>#8071</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>在按主键前缀和非主键后缀排序的情况下修复 <code class=syntax>ORDER BY</code> 行为. <a href=https://github.com/ClickHouse/ClickHouse/pull/7759 rel="external nofollow noreferrer" target=_blank>#7759</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>检查表中是否存在合格的列. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6836 rel="external nofollow noreferrer" target=_blank>#6836</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7758 rel="external nofollow noreferrer" target=_blank>#7758</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>修复了在合并完成移动指定的超部分后立即运行的 <code class=syntax>ALTER MOVE</code> 行为. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/8103 rel="external nofollow noreferrer" target=_blank>#8103</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8104 rel="external nofollow noreferrer" target=_blank>#8104</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复使用具有不同列数的 <code class=syntax>UNION</code> 时可能出现的服务器崩溃. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7279 rel="external nofollow noreferrer" target=_blank>#7279</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7929 rel="external nofollow noreferrer" target=_blank>#7929</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>修复具有负大小的函数 <code class=syntax>substr</code> 的结果子字符串的大小. <a href=https://github.com/ClickHouse/ClickHouse/pull/8589 rel="external nofollow noreferrer" target=_blank>#8589</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>现在，如果后台池中没有足够的空闲线程, 服务器不会在 <code class=syntax>MergeTree</code> 中执行部分突变. <a href=https://github.com/ClickHouse/ClickHouse/pull/8588 rel="external nofollow noreferrer" target=_blank>#8588</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复格式化<code class=syntax>UNION ALL</code> AST 时的一个小错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7999 rel="external nofollow noreferrer" target=_blank>#7999</a> (<a href=https://github.com/litao91 rel="external nofollow noreferrer" target=_blank>litao91</a>)</li> <li>修复了负数的错误布隆过滤器结果. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8317 rel="external nofollow noreferrer" target=_blank>#8317</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8566 rel="external nofollow noreferrer" target=_blank>#8566</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>修复了解压缩中潜在的缓冲区溢出. 恶意用户可以传递伪造的压缩数据, 这将导致缓冲区后读取. 这个问题是由 Yandex 信息安全团队的 Eldar Zaitov 发现的. <a href=https://github.com/ClickHouse/ClickHouse/pull/8404 rel="external nofollow noreferrer" target=_blank>#8404</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复由于 <code class=syntax>arrayIntersect</code> 中整数溢出而导致的错误结果. <a href=https://github.com/ClickHouse/ClickHouse/pull/7777 rel="external nofollow noreferrer" target=_blank>#7777</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>现在 <code class=syntax>OPTIMIZE TABLE</code> 查询不会等待离线副本执行操作. <a href=https://github.com/ClickHouse/ClickHouse/pull/8314 rel="external nofollow noreferrer" target=_blank>#8314</a> (<a href=https://github.com/javisantana rel="external nofollow noreferrer" target=_blank>javi santana</a>)</li> <li>修复了 <code class=syntax>Replicated*MergeTree</code> 表的 <code class=syntax>ALTER TTL</code> 解析器. <a href=https://github.com/ClickHouse/ClickHouse/pull/8318 rel="external nofollow noreferrer" target=_blank>#8318</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复服务器和客户端之间的通信, 以便服务器在查询失败后读取临时表信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/8084 rel="external nofollow noreferrer" target=_blank>#8084</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复聚合位图和标量位图相交时的 <code class=syntax>bitmapAnd</code> 函数错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8082 rel="external nofollow noreferrer" target=_blank>#8082</a> (<a href=https://github.com/moon03432 rel="external nofollow noreferrer" target=_blank>Yue Huang</a>)</li> <li>根据修复了 <code class=syntax>clickhouse-cluster-copier</code> 中的错误的 ZooKeeper 程序员指南细化 <code class=syntax>ZXid</code> 的定义. <a href=https://github.com/ClickHouse/ClickHouse/pull/8088 rel="external nofollow noreferrer" target=_blank>#8088</a> (<a href=https://github.com/dingxiangfei2009 rel="external nofollow noreferrer" target=_blank>Ding Xiang Fei</a>)</li> <li><code class=syntax>odbc</code> 表函数现在尊重 <code class=syntax>external_table_functions_use_nulls</code> 设置. <a href=https://github.com/ClickHouse/ClickHouse/pull/7506 rel="external nofollow noreferrer" target=_blank>#7506</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>修复了导致罕见数据竞争的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/8143 rel="external nofollow noreferrer" target=_blank>#8143</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>现在<code class=syntax>SYSTEM RELOAD DICTIONARY</code> 完全重新加载字典, 忽略<code class=syntax>update_field</code>. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7440 rel="external nofollow noreferrer" target=_blank>#7440</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8037 rel="external nofollow noreferrer" target=_blank>#8037</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>添加检查创建查询中是否存在字典的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/8032 rel="external nofollow noreferrer" target=_blank>#8032</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>以 <code class=syntax>Values</code> 格式修复 <code class=syntax>Float*</code> 解析. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7817 rel="external nofollow noreferrer" target=_blank>#7817</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7870 rel="external nofollow noreferrer" target=_blank>#7870</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复当我们无法在 <code class=syntax>*MergeTree</code> 表引擎系列的某些后台操作中保留空间时崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/7873 rel="external nofollow noreferrer" target=_blank>#7873</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>修复当表包含 <code class=syntax>SimpleAggregateFunction(LowCardinality)</code> 列时合并操作的崩溃. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8515 rel="external nofollow noreferrer" target=_blank>#8515</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8522 rel="external nofollow noreferrer" target=_blank>#8522</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>恢复对所有 ICU 语言环境的支持, 并添加对常量表达式应用排序规则的功能. 还将语言名称添加到 <code class=syntax>system.collations</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/8051 rel="external nofollow noreferrer" target=_blank>#8051</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了最小生命周期为零 (<code class=syntax>LIFETIME(MIN 0 MAX N)</code>, <code class=syntax>LIFETIME(N)</code>) 的外部字典不在后台更新时的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7983 rel="external nofollow noreferrer" target=_blank>#7983</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复带有 ClickHouse 源的外部字典在查询中有子查询时崩溃. <a href=https://github.com/ClickHouse/ClickHouse/pull/8351 rel="external nofollow noreferrer" target=_blank>#8351</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>使用引擎 <code class=syntax>URL</code> 修复表中文件扩展名的错误解析. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8157 rel="external nofollow noreferrer" target=_blank>#8157</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8419 rel="external nofollow noreferrer" target=_blank>#8419</a> (<a href=https://github.com/apbodrov rel="external nofollow noreferrer" target=_blank>Andrey Bodrov</a>)</li> <li>修复没有键的 <code class=syntax>*MergeTree</code> 表的 <code class=syntax>CHECK TABLE</code> 查询. 修复<a href=https://github.com/ClickHouse/ClickHouse/issues/7543 rel="external nofollow noreferrer" target=_blank>#7543</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7979 rel="external nofollow noreferrer" target=_blank>#7979</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了 <code class=syntax>Float64</code> 到 MySQL 类型的转换. <a href=https://github.com/ClickHouse/ClickHouse/pull/8079 rel="external nofollow noreferrer" target=_blank>#8079</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>现在如果表因为服务器崩溃而没有完全删除, 服务器将尝试恢复并加载它. <a href=https://github.com/ClickHouse/ClickHouse/pull/8176 rel="external nofollow noreferrer" target=_blank>#8176</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> <li>修复了表函数 <code class=syntax>file</code> 在插入不存在的文件时崩溃的问题. 现在在这种情况下将创建文件, 然后将处理插入. <a href=https://github.com/ClickHouse/ClickHouse/pull/8177 rel="external nofollow noreferrer" target=_blank>#8177</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>修复启用 <code class=syntax>trace_log</code> 时可能发生的罕见死锁. <a href=https://github.com/ClickHouse/ClickHouse/pull/7838 rel="external nofollow noreferrer" target=_blank>#7838</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>在从 DDL 查询创建的 <code class=syntax>RangeHashed</code> 外部字典中添加除 <code class=syntax>Date</code> 之外的不同类型的处理能力. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/7899 rel="external nofollow noreferrer" target=_blank>7899</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8275 rel="external nofollow noreferrer" target=_blank>#8275</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了当使用另一个函数的结果调用 <code class=syntax>now64()</code> 时崩溃的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/8270 rel="external nofollow noreferrer" target=_blank>#8270</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>修复了通过 mysql 线路协议检测连接的客户端 IP 的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7743 rel="external nofollow noreferrer" target=_blank>#7743</a> (<a href=https://github.com/dmitriy-myz rel="external nofollow noreferrer" target=_blank>Dmitry Muzyka</a>)</li> <li>修复 <code class=syntax>arraySplit</code> 函数中的空数组处理. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7708 rel="external nofollow noreferrer" target=_blank>#7708</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7747 rel="external nofollow noreferrer" target=_blank>#7747</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>修复了另一个正在运行的 <code class=syntax>clickhouse-server</code> 的 <code class=syntax>pid-file</code> 可能会被删除的问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/8487 rel="external nofollow noreferrer" target=_blank>#8487</a> (<a href=https://github.com/weiqxu rel="external nofollow noreferrer" target=_blank>Weiqing Xu</a>)</li> <li>修复字典重新加载, 如果它有 <code class=syntax>invalidate_query</code>，它会停止更新, 并且在之前的更新尝试中出现一些异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/8029 rel="external nofollow noreferrer" target=_blank>#8029</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复了函数 <code class=syntax>arrayReduce</code> 中可能导致 <code class=syntax>double free</code> 的错误和聚合函数组合器 <code class=syntax>Resample</code> 中可能导致内存泄漏的错误. 添加了聚合函数 <code class=syntax>aggThrow</code>. 此功能可用于测试目的. <a href=https://github.com/ClickHouse/ClickHouse/pull/8446 rel="external nofollow noreferrer" target=_blank>#8446</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=gai-jin_22>改进<a class=headerlink href=../amp/#gai-jin_22 title="Permanent link"> </a></h4> <ul> <li>使用 <code class=syntax>S3</code> 表引擎时改进了日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/8251 rel="external nofollow noreferrer" target=_blank>#8251</a> (<a href=https://github.com/GrigoryPervakov rel="external nofollow noreferrer" target=_blank>Grigory Pervakov</a>)</li> <li>调用 <code class=syntax>clickhouse-local</code> 时没有传递参数时打印帮助消息. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5335 rel="external nofollow noreferrer" target=_blank>#5335</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8230 rel="external nofollow noreferrer" target=_blank>#8230</a> (<a href=https://github.com/Melancholic rel="external nofollow noreferrer" target=_blank>Andrey Nagorny</a>)</li> <li>添加设置 <code class=syntax>mutations_sync</code> 允许同步等待 <code class=syntax>ALTER UPDATE/DELETE</code> 查询. <a href=https://github.com/ClickHouse/ClickHouse/pull/8237 rel="external nofollow noreferrer" target=_blank>#8237</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>允许在 <code class=syntax>config.xml</code> 中设置相关的 <code class=syntax>user_files_path</code> (类似于 <code class=syntax>format_schema_path</code> ). <a href=https://github.com/ClickHouse/ClickHouse/pull/7632 rel="external nofollow noreferrer" target=_blank>#7632</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>为带有 <code class=syntax>-OrZero</code> 后缀的转换函数添加非法类型的例外. <a href=https://github.com/ClickHouse/ClickHouse/pull/7880 rel="external nofollow noreferrer" target=_blank>#7880</a> (<a href=https://github.com/akonyaev90 rel="external nofollow noreferrer" target=_blank>Andrey Konyaev</a>)</li> <li>简化分布式查询中发送到分片的数据头格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/8044 rel="external nofollow noreferrer" target=_blank>#8044</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li><code class=syntax>Live View</code> 表引擎重构. <a href=https://github.com/ClickHouse/ClickHouse/pull/8519 rel="external nofollow noreferrer" target=_blank>#8519</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li> <li>为从 DDL 查询创建的外部词典添加额外检查. <a href=https://github.com/ClickHouse/ClickHouse/pull/8127 rel="external nofollow noreferrer" target=_blank>#8127</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>修复错误 <code class=syntax>Column ... already exists</code> , 同时使用 <code class=syntax>FINAL</code> 和 <code class=syntax>SAMPLE</code>, 例如 <code class=syntax>select count() from table final sample 1/2</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/5186 rel="external nofollow noreferrer" target=_blank>#5186</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7907 rel="external nofollow noreferrer" target=_blank>#7907</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>现在表 <code class=syntax>joinGet</code> 函数的第一个参数可以是表标识符. <a href=https://github.com/ClickHouse/ClickHouse/pull/7707 rel="external nofollow noreferrer" target=_blank>#7707</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>允许将 <code class=syntax>MaterializedView</code> 与 <code class=syntax>Kafka</code> 表上方的子查询一起使用. <a href=https://github.com/ClickHouse/ClickHouse/pull/8197 rel="external nofollow noreferrer" target=_blank>#8197</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>现在磁盘之间的后台移动在单独的线程池中运行它. <a href=https://github.com/ClickHouse/ClickHouse/pull/7670 rel="external nofollow noreferrer" target=_blank>#7670</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li><code class=syntax>SYSTEM RELOAD DICTIONARY</code> 现在同步执行. <a href=https://github.com/ClickHouse/ClickHouse/pull/8240 rel="external nofollow noreferrer" target=_blank>#8240</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>堆栈跟踪现在显示物理地址 (目标文件中的偏移量) 而不是虚拟内存地址 (加载目标文件的位置). 当二进制文件与位置无关且 ASLR 处于活动状态时, 这允许使用 <code class=syntax>addr2line</code>. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/8360 rel="external nofollow noreferrer" target=_blank>#8360</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8387 rel="external nofollow noreferrer" target=_blank>#8387</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>支持行级安全过滤器的新语法: <code class=syntax>&lt;table name='table_name'&gt;...&lt;/table&gt;</code>. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/5779 rel="external nofollow noreferrer" target=_blank>#5779</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8381 rel="external nofollow noreferrer" target=_blank>#8381</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>现在 <code class=syntax>cityHash</code> 函数可以处理 <code class=syntax>Decimal</code> 和 <code class=syntax>UUID</code> 类型. 修复 <a href=https://github.com/ClickHouse/ClickHouse/issues/5184 rel="external nofollow noreferrer" target=_blank>#5184</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7693 rel="external nofollow noreferrer" target=_blank>#7693</a> (<a href=https://github.com/millb rel="external nofollow noreferrer" target=_blank>Mikhail Korotov</a>)</li> <li>从系统日志中删除了固定索引粒度 (它是 1024), 因为它在实现自适应粒度后已过时. <a href=https://github.com/ClickHouse/ClickHouse/pull/7698 rel="external nofollow noreferrer" target=_blank>#7698</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在不使用 SSL 的情况下编译 ClickHouse 时启用 MySQL 兼容性服务器. <a href=https://github.com/ClickHouse/ClickHouse/pull/7852 rel="external nofollow noreferrer" target=_blank>#7852</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>现在服务器校验和分布式批处理, 这会在批处理损坏的数据的情况下提供更详细的错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7914 rel="external nofollow noreferrer" target=_blank>#7914</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>支持 <code class=syntax>DROP DATABASE</code>、<code class=syntax>DETACH TABLE</code>、<code class=syntax>DROP TABLE</code>和 <code class=syntax>ATTACH TABLE</code> 用于 <code class=syntax>MySQL</code> 数据库引擎. <a href=https://github.com/ClickHouse/ClickHouse/pull/8202 rel="external nofollow noreferrer" target=_blank>#8202</a> (<a href=https://github.com/zhang2014 rel="external nofollow noreferrer" target=_blank>Winter Zhang</a>)</li> <li>在 S3 表函数和表引擎中添加身份验证. <a href=https://github.com/ClickHouse/ClickHouse/pull/7623 rel="external nofollow noreferrer" target=_blank>#7623</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>添加了对不同磁盘上 <code class=syntax>MergeTree</code> 额外部分的检查, 以免遗漏未定义磁盘上的数据部分. <a href=https://github.com/ClickHouse/ClickHouse/pull/8118 rel="external nofollow noreferrer" target=_blank>#8118</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>为 Mac 客户端和服务器启用 SSL 支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/8297 rel="external nofollow noreferrer" target=_blank>#8297</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>现在 ClickHouse 可以用作 MySQL 联合服务器 (请参阅 <a href=https://dev.mysql.com/doc/refman/5.7/en/federated-create-server.html target=_blank>https://dev.mysql.com/doc/refman/5.7/en/federated-create-server.html</a>). <a href=https://github.com/ClickHouse/ClickHouse/pull/7717 rel="external nofollow noreferrer" target=_blank>#7717</a> (<a href=https://github.com/MaxFedotov rel="external nofollow noreferrer" target=_blank>Maxim Fedotov</a>)</li> <li><code class=syntax>clickhouse-client</code> 现在仅在开启多查询且关闭多行时启用 <code class=syntax>bracketed-paste</code> . 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7757 rel="external nofollow noreferrer" target=_blank>#7757</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7761 rel="external nofollow noreferrer" target=_blank>#7761</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>在 <code class=syntax>if</code> 函数中支持 <code class=syntax>Array(Decimal)</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7721 rel="external nofollow noreferrer" target=_blank>#7721</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>在 <code class=syntax>arrayDifference</code>、<code class=syntax>arrayCumSum</code> 和 <code class=syntax>arrayCumSumNegative</code> 函数中支持小数. <a href=https://github.com/ClickHouse/ClickHouse/pull/7724 rel="external nofollow noreferrer" target=_blank>#7724</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>向 <code class=syntax>system.dictionaries</code> 表添加了 <code class=syntax>lifetime</code> 列. <a href=https://github.com/ClickHouse/ClickHouse/issues/6820 rel="external nofollow noreferrer" target=_blank>#6820</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7727 rel="external nofollow noreferrer" target=_blank>#7727</a> (<a href=https://github.com/kekekekule rel="external nofollow noreferrer" target=_blank>kekekekule</a>)</li> <li>改进了对 <code class=syntax>*MergeTree</code> 表引擎不同磁盘上现有部分的检查. 地址 <a href=https://github.com/ClickHouse/ClickHouse/issues/7660 rel="external nofollow noreferrer" target=_blank>#7660</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8440 rel="external nofollow noreferrer" target=_blank>#8440</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>与用于 <code class=syntax>S3</code> 交互的 <code class=syntax>AWS SDK</code> 集成, 允许开箱即用地使用所有 S3 功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/8011 rel="external nofollow noreferrer" target=_blank>#8011</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li> <li>添加了对 <code class=syntax>Live View</code> 表中子查询的支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/7792 rel="external nofollow noreferrer" target=_blank>#7792</a> (<a href=https://github.com/vzakaznikov rel="external nofollow noreferrer" target=_blank>vzakaznikov</a>)</li> <li>删除了从 <code class=syntax>TTL</code> 表达式中检查使用 <code class=syntax>Date</code> 或 <code class=syntax>DateTime</code> 列的情况. <a href=https://github.com/ClickHouse/ClickHouse/pull/7920 rel="external nofollow noreferrer" target=_blank>#7920</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>有关磁盘的信息已添加到 <code class=syntax>system.detached_parts</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/7833 rel="external nofollow noreferrer" target=_blank>#7833</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>现在可以在不重启的情况下更改设置 <code class=syntax>max_(table|partition)_size_to_drop</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7779 rel="external nofollow noreferrer" target=_blank>#7779</a> (<a href=https://github.com/GrigoryPervakov rel="external nofollow noreferrer" target=_blank>Grigory Pervakov</a>)</li> <li>错误消息的可用性略好. 要求用户不要删除 <code class=syntax>Stack trace:</code> 下面的行. <a href=https://github.com/ClickHouse/ClickHouse/pull/7897 rel="external nofollow noreferrer" target=_blank>#7897</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 <a href=https://github.com/ClickHouse/ClickHouse/issues/7935 rel="external nofollow noreferrer" target=_blank>#7935</a> 之后，更好地读取来自 <code class=syntax>Kafka</code> 引擎的各种格式的消息. <a href=https://github.com/ClickHouse/ClickHouse/pull/8035 rel="external nofollow noreferrer" target=_blank>#8035</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>更好地兼容不支持 <code class=syntax>sha2_password</code> 认证插件的 MySQL 客户端. <a href=https://github.com/ClickHouse/ClickHouse/pull/8036 rel="external nofollow noreferrer" target=_blank>#8036</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>在 MySQL 兼容服务器中支持更多的列类型. <a href=https://github.com/ClickHouse/ClickHouse/pull/7975 rel="external nofollow noreferrer" target=_blank>#7975</a> (<a href=https://github.com/yurriy rel="external nofollow noreferrer" target=_blank>Yuriy Baranov</a>)</li> <li>为带有底层 <code class=syntax>MergeTree</code> 表的 <code class=syntax>Merge</code>、<code class=syntax>Buffer</code> 和 <code class=syntax>Materialized View</code> 存储实现 <code class=syntax>ORDER BY</code> 优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/8130 rel="external nofollow noreferrer" target=_blank>#8130</a> (<a href=https://github.com/CurtizJ rel="external nofollow noreferrer" target=_blank>Anton Popov</a>)</li> <li>现在我们总是使用 <code class=syntax>getrandom</code> 的POSIX实现来更好地兼容旧内核 (&lt; 3.17). <a href=https://github.com/ClickHouse/ClickHouse/pull/7940 rel="external nofollow noreferrer" target=_blank>#7940</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>更好地检查移动 TTL 规则中的有效目的地. <a href=https://github.com/ClickHouse/ClickHouse/pull/8410 rel="external nofollow noreferrer" target=_blank>#8410</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>更好地检查 <code class=syntax>Distributed</code> 表引擎的损坏插入批次. <a href=https://github.com/ClickHouse/ClickHouse/pull/7933 rel="external nofollow noreferrer" target=_blank>#7933</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>将带有突变必须在未来处理的部分名称数组的列添加到 <code class=syntax>system.mutations</code> 表. <a href=https://github.com/ClickHouse/ClickHouse/pull/8179 rel="external nofollow noreferrer" target=_blank>#8179</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>处理器的并行归并排序优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/8552 rel="external nofollow noreferrer" target=_blank>#8552</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>设置 <code class=syntax>mark_cache_min_lifetime</code> 现在已经过时并且什么都不做. 在以前的版本中, 标记缓存可以在大于 <code class=syntax>mark_cache_size</code> 的内存中增长, 以在 <code class=syntax>mark_cache_min_lifetime</code> 秒内容纳数据. 这导致混乱和比预期更高的内存使用量, 这在内存受限的系统上尤其糟糕. 如果您在安装此版本后发现性能下降, 您应该增加 <code class=syntax>mark_cache_size</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8484 rel="external nofollow noreferrer" target=_blank>#8484</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>准备在任何地方使用 <code class=syntax>tid</code>. 这是 <a href=https://github.com/ClickHouse/ClickHouse/issues/7477 rel="external nofollow noreferrer" target=_blank>#7477</a> 所必需的. <a href=https://github.com/ClickHouse/ClickHouse/pull/8276 rel="external nofollow noreferrer" target=_blank>#8276</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h4 id=xing-neng-gai-jin_17>性能改进<a class=headerlink href=../amp/#xing-neng-gai-jin_17 title="Permanent link"> </a></h4> <ul> <li>处理器管道中的性能优化. <a href=https://github.com/ClickHouse/ClickHouse/pull/7988 rel="external nofollow noreferrer" target=_blank>#7988</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>缓存字典中过期键的非阻塞更新 (具有读取旧键的权限). <a href=https://github.com/ClickHouse/ClickHouse/pull/8303 rel="external nofollow noreferrer" target=_blank>#8303</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>全局编译不带 <code class=syntax>-fno-omit-frame-pointer</code> 的 ClickHouse 以节省一个寄存器. <a href=https://github.com/ClickHouse/ClickHouse/pull/8097 rel="external nofollow noreferrer" target=_blank>#8097</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>加速 <code class=syntax>greatCircleDistance</code> 函数并为其添加性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/7307 rel="external nofollow noreferrer" target=_blank>#7307</a> (<a href=https://github.com/stavrolia rel="external nofollow noreferrer" target=_blank>Olga Khvostikova</a>)</li> <li>改进功能 <code class=syntax>roundDown</code> 的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/8465 rel="external nofollow noreferrer" target=_blank>#8465</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>改进了 <code class=syntax>DateTime64</code> 数据类型的 <code class=syntax>max</code>、<code class=syntax>min</code>、<code class=syntax>argMin</code>、<code class=syntax>argMax</code>的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/8199 rel="external nofollow noreferrer" target=_blank>#8199</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>改进了无限制或大限制和外部排序的排序性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/8545 rel="external nofollow noreferrer" target=_blank>#8545</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>格式化浮点数的性能提高了 6 倍. <a href=https://github.com/ClickHouse/ClickHouse/pull/8542 rel="external nofollow noreferrer" target=_blank>#8542</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>改进了 <code class=syntax>modulo</code> 函数的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/7750 rel="external nofollow noreferrer" target=_blank>#7750</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>优化了<code class=syntax>ORDER BY</code> 并与单列键合并. <a href=https://github.com/ClickHouse/ClickHouse/pull/8335 rel="external nofollow noreferrer" target=_blank>#8335</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>更好地实现 <code class=syntax>arrayReduce</code>、<code class=syntax>-Array</code> 和 <code class=syntax>-State</code> 组合器. <a href=https://github.com/ClickHouse/ClickHouse/pull/7710 rel="external nofollow noreferrer" target=_blank>#7710</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>现在 <code class=syntax>PREWHERE</code> 应该被优化为至少和 <code class=syntax>WHERE</code> 一样有效. <a href=https://github.com/ClickHouse/ClickHouse/pull/7769 rel="external nofollow noreferrer" target=_blank>#7769</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>改进 <code class=syntax>round</code> 和 <code class=syntax>roundBankers</code> 处理负数的方式. <a href=https://github.com/ClickHouse/ClickHouse/pull/8229 rel="external nofollow noreferrer" target=_blank>#8229</a> (<a href=https://github.com/hczhcz rel="external nofollow noreferrer" target=_blank>hcz</a>)</li> <li>将 <code class=syntax>DoubleDelta</code> 和 <code class=syntax>Gorilla</code> 编解码器的解码性能提高了大约 30-40%. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7082 rel="external nofollow noreferrer" target=_blank>#7082</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8019 rel="external nofollow noreferrer" target=_blank>#8019</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>改进了 <code class=syntax>base64</code> 相关功能的性能. <a href=https://github.com/ClickHouse/ClickHouse/pull/8444 rel="external nofollow noreferrer" target=_blank>#8444</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>添加了一个功能<code class=syntax>geoDistance</code>. 它类似于 <code class=syntax>greatCircleDistance</code>, 但使用对 WGS-84 椭球模型的近似. 两种功能的性能几乎相同. <a href=https://github.com/ClickHouse/ClickHouse/pull/8086 rel="external nofollow noreferrer" target=_blank>#8086</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>Decimal</code> 数据类型的更快的 <code class=syntax>min</code> 和 <code class=syntax>max</code> 聚合函数. <a href=https://github.com/ClickHouse/ClickHouse/pull/8144 rel="external nofollow noreferrer" target=_blank>#8144</a> (<a href=https://github.com/4ertus2 rel="external nofollow noreferrer" target=_blank>Artem Zuikov</a>)</li> <li>向量化处理<code class=syntax>arrayReduce</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7608 rel="external nofollow noreferrer" target=_blank>#7608</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li><code class=syntax>if</code> 链现在优化为 <code class=syntax>multiIf</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8355 rel="external nofollow noreferrer" target=_blank>#8355</a> (<a href=https://github.com/kamalov-ruslan rel="external nofollow noreferrer" target=_blank>kamalov-ruslan</a>)</li> <li>修复了 19.15 中引入的 <code class=syntax>Kafka</code> 表引擎的性能回归. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/7261 rel="external nofollow noreferrer" target=_blank>#7261</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7935 rel="external nofollow noreferrer" target=_blank>#7935</a> (<a href=https://github.com/filimonov rel="external nofollow noreferrer" target=_blank>filimonov</a>)</li> <li>删除了 Debian 软件包中的 <code class=syntax>gcc</code> 偶尔会在默认情况下带来的 'pie' 代码生成. <a href=https://github.com/ClickHouse/ClickHouse/pull/8483 rel="external nofollow noreferrer" target=_blank>#8483</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>并行解析数据格式. <a href=https://github.com/ClickHouse/ClickHouse/pull/6553 rel="external nofollow noreferrer" target=_blank>#6553</a> (<a href=https://github.com/nikitamikhaylov rel="external nofollow noreferrer" target=_blank>Nikita Mikhaylov</a>)</li> <li>默认情况下启用带有表达式的“值”的优化解析器 (<code class=syntax>input_format_values_deduce_templates_of_expressions=1</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/8231 rel="external nofollow noreferrer" target=_blank>#8231</a> (<a href=https://github.com/tavplubix rel="external nofollow noreferrer" target=_blank>tavplubix</a>)</li> </ul> <h4 id=gou-jian-ce-shi-da-bao-gai-jin_25>构建/测试/打包改进<a class=headerlink href=../amp/#gou-jian-ce-shi-da-bao-gai-jin_25 title="Permanent link"> </a></h4> <ul> <li>为 <code class=syntax>ARM</code> 和最小模式构建修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/8304 rel="external nofollow noreferrer" target=_blank>#8304</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>未调用 std::atexit 时为 <code class=syntax>clickhouse-server</code> 添加覆盖文件刷新. 还略微改进了具有覆盖率的无状态测试的日志记录. <a href=https://github.com/ClickHouse/ClickHouse/pull/8267 rel="external nofollow noreferrer" target=_blank>#8267</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>在 contrib 中更新 LLVM 库. 避免使用 OS 包中的 LLVM. <a href=https://github.com/ClickHouse/ClickHouse/pull/8258 rel="external nofollow noreferrer" target=_blank>#8258</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使捆绑的 <code class=syntax>curl</code> 构建完全安静. <a href=https://github.com/ClickHouse/ClickHouse/pull/8232 rel="external nofollow noreferrer" target=_blank>#8232</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8203 rel="external nofollow noreferrer" target=_blank>#8203</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li> <li>修复一些 <code class=syntax>MemorySanitizer</code> 警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/8235 rel="external nofollow noreferrer" target=_blank>#8235</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>在 <code class=syntax>CMakeLists.txt</code> 中使用 <code class=syntax>add_warning</code> 和 <code class=syntax>no_warning</code> 宏. <a href=https://github.com/ClickHouse/ClickHouse/pull/8604 rel="external nofollow noreferrer" target=_blank>#8604</a> (<a href=https://github.com/abyss7 rel="external nofollow noreferrer" target=_blank>Ivan</a>)</li> <li>添加对 Minio S3 兼容对象 (<a href=https://min.io/ target=_blank>https://min.io/</a>) 的支持以进行更好的集成测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/7863 rel="external nofollow noreferrer" target=_blank>#7863</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/7875 rel="external nofollow noreferrer" target=_blank>#7875</a> (<a href=https://github.com/Jokser rel="external nofollow noreferrer" target=_blank>Pavel Kovalenko</a>)</li> <li>将 <code class=syntax>libc</code> 头文件导入到 contrib. 它允许在各种系统之间使构建更加一致 (仅适用于 <code class=syntax>x86_64-linux-gnu</code>). <a href=https://github.com/ClickHouse/ClickHouse/pull/5773 rel="external nofollow noreferrer" target=_blank>#5773</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>从某些库中删除 <code class=syntax>-fPIC</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8464 rel="external nofollow noreferrer" target=_blank>#8464</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为 curl 清理 <code class=syntax>CMakeLists.txt</code>. 见 <a href=https://github.com/ClickHouse/ClickHouse/pull/8011#issuecomment-569478910 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/8011#issuecomment-569478910</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8459 rel="external nofollow noreferrer" target=_blank>#8459</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li><code class=syntax>CapNProto</code> 库中的静默警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/8220 rel="external nofollow noreferrer" target=_blank>#8220</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为短字符串优化哈希表添加性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/7679 rel="external nofollow noreferrer" target=_blank>#7679</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>现在, 即使 <code class=syntax>MADV_FREE</code> 不可用, ClickHouse 也将构建在 <code class=syntax>AArch64</code> 上. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8027 rel="external nofollow noreferrer" target=_blank>#8027</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8243 rel="external nofollow noreferrer" target=_blank>#8243</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>更新 <code class=syntax>zlib-ng</code> 以修复内存清理器问题. <a href=https://github.com/ClickHouse/ClickHouse/pull/7182 rel="external nofollow noreferrer" target=_blank>#7182</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8206 rel="external nofollow noreferrer" target=_blank>#8206</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>在非 Linux 系统上启用内部 MySQL 库, 因为 OS 包的使用非常脆弱, 通常根本不起作用. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/5765 rel="external nofollow noreferrer" target=_blank>#5765</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8426 rel="external nofollow noreferrer" target=_blank>#8426</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了启用 <code class=syntax>libc++</code> 后在某些系统上的构建. 这取代了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8374 rel="external nofollow noreferrer" target=_blank>#8374</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8380 rel="external nofollow noreferrer" target=_blank>#8380</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使 <code class=syntax>Field</code> 方法更加类型安全以查找更多错误. <a href=https://github.com/ClickHouse/ClickHouse/pull/7386 rel="external nofollow noreferrer" target=_blank>#7386</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8209 rel="external nofollow noreferrer" target=_blank>#8209</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>将缺失的文件添加到 <code class=syntax>libc-headers</code> 子模块. <a href=https://github.com/ClickHouse/ClickHouse/pull/8507 rel="external nofollow noreferrer" target=_blank>#8507</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复性能测试输出中错误的 <code class=syntax>JSON</code> 引用. <a href=https://github.com/ClickHouse/ClickHouse/pull/8497 rel="external nofollow noreferrer" target=_blank>#8497</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>现在为 <code class=syntax>std::exception</code> 和 <code class=syntax>Poco::Exception</code> 显示堆栈跟踪. 在以前的版本中, 它仅适用于<code class=syntax>DB::Exception</code>. 这改进了诊断. <a href=https://github.com/ClickHouse/ClickHouse/pull/8501 rel="external nofollow noreferrer" target=_blank>#8501</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>为新的 glibc 版本移植 <code class=syntax>clock_gettime</code> 和 <code class=syntax>clock_nanosleep</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8054 rel="external nofollow noreferrer" target=_blank>#8054</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>在示例配置中为开发人员启用<code class=syntax>part_log</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8609 rel="external nofollow noreferrer" target=_blank>#8609</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复 <code class=syntax>01036_no_superfluous_dict_reload_on_create_database*</code> 中重新加载的异步性质. <a href=https://github.com/ClickHouse/ClickHouse/pull/8111 rel="external nofollow noreferrer" target=_blank>#8111</a> (<a href=https://github.com/azat rel="external nofollow noreferrer" target=_blank>Azat Khuzhin</a>)</li> <li>修复编解码器性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/8615 rel="external nofollow noreferrer" target=_blank>#8615</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>为 <code class=syntax>.tgz</code> 构建和文档添加安装脚本. <a href=https://github.com/ClickHouse/ClickHouse/pull/8612 rel="external nofollow noreferrer" target=_blank>#8612</a> <a href=https://github.com/ClickHouse/ClickHouse/pull/8591 rel="external nofollow noreferrer" target=_blank>#8591</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>删除了旧的 <code class=syntax>ZSTD</code> 测试 (它是在 2016 年创建的, 用于重现 ZSTD 1.0 版之前的错误). 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8618 rel="external nofollow noreferrer" target=_blank>#8618</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8619 rel="external nofollow noreferrer" target=_blank>#8619</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了 Mac OS Catalina 上的构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/8600 rel="external nofollow noreferrer" target=_blank>#8600</a> (<a href=https://github.com/meob rel="external nofollow noreferrer" target=_blank>meo</a>)</li> <li>增加编解码器性能测试中的行数, 使结果更显着. <a href=https://github.com/ClickHouse/ClickHouse/pull/8574 rel="external nofollow noreferrer" target=_blank>#8574</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li>在调试版本中, 将 <code class=syntax>LOGICAL_ERROR</code> 异常视为断言失败, 以便它们更容易被注意到. <a href=https://github.com/ClickHouse/ClickHouse/pull/8475 rel="external nofollow noreferrer" target=_blank>#8475</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>使与格式相关的性能测试更具确定性. <a href=https://github.com/ClickHouse/ClickHouse/pull/8477 rel="external nofollow noreferrer" target=_blank>#8477</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>更新 <code class=syntax>lz4</code> 以修复 MemorySanitizer 故障. <a href=https://github.com/ClickHouse/ClickHouse/pull/8181 rel="external nofollow noreferrer" target=_blank>#8181</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>在异常处理中抑制已知的 MemorySanitizer 误报. <a href=https://github.com/ClickHouse/ClickHouse/pull/8182 rel="external nofollow noreferrer" target=_blank>#8182</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>将 <code class=syntax>gcc</code> 和 <code class=syntax>g++</code> 更新到 <code class=syntax>build/docker/build.sh</code> 中的版本 9. <a href=https://github.com/ClickHouse/ClickHouse/pull/7766 rel="external nofollow noreferrer" target=_blank>#7766</a> (<a href=https://github.com/tlightsky rel="external nofollow noreferrer" target=_blank>TLightSky</a>)</li> <li>添加性能测试用例来测试 <code class=syntax>PREWHERE</code> 比 <code class=syntax>WHERE</code> 差. <a href=https://github.com/ClickHouse/ClickHouse/pull/7768 rel="external nofollow noreferrer" target=_blank>#7768</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复一个不稳定的测试的进展. <a href=https://github.com/ClickHouse/ClickHouse/pull/8621 rel="external nofollow noreferrer" target=_blank>#8621</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>避免对来自<code class=syntax>libunwind</code> 的数据进行 MemorySanitizer 报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/8539 rel="external nofollow noreferrer" target=_blank>#8539</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>将 <code class=syntax>libc++</code> 更新到最新版本. <a href=https://github.com/ClickHouse/ClickHouse/pull/8324 rel="external nofollow noreferrer" target=_blank>#8324</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>从源代码构建 ICU 库. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/6460 rel="external nofollow noreferrer" target=_blank>#6460</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8219 rel="external nofollow noreferrer" target=_blank>#8219</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>从 <code class=syntax>libressl</code> 切换到 <code class=syntax>openssl</code>. 在此更改后，ClickHouse 应支持 TLS 1.3 和 SNI. 这修复了<a href=https://github.com/ClickHouse/ClickHouse/issues/8171 rel="external nofollow noreferrer" target=_blank>#8171</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8218 rel="external nofollow noreferrer" target=_blank>#8218</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复了从 SSL 使用 <code class=syntax>chacha20_poly1305</code> 时的 UBSan 报告 (发生在连接到 <a href=https://yandex.ru/ target=_blank>https://yandex.ru/</a> 时). <a href=https://github.com/ClickHouse/ClickHouse/pull/8214 rel="external nofollow noreferrer" target=_blank>#8214</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复<code class=syntax>.deb</code> linux 发行版的默认密码文件模式. <a href=https://github.com/ClickHouse/ClickHouse/pull/8075 rel="external nofollow noreferrer" target=_blank>#8075</a> (<a href=https://github.com/proller rel="external nofollow noreferrer" target=_blank>proller</a>)</li> <li>改进了在 <code class=syntax>clickhouse-test</code> 中获取 <code class=syntax>clickhouse-server</code> PID 的表达式. <a href=https://github.com/ClickHouse/ClickHouse/pull/8063 rel="external nofollow noreferrer" target=_blank>#8063</a> (<a href=https://github.com/Akazz rel="external nofollow noreferrer" target=_blank>Alexander Kazakov</a>)</li> <li>将 contrib/googletest 更新到 v1.10.0. <a href=https://github.com/ClickHouse/ClickHouse/pull/8587 rel="external nofollow noreferrer" target=_blank>#8587</a> (<a href=https://github.com/Alex-Burmak rel="external nofollow noreferrer" target=_blank>Alexander Burmak</a>)</li> <li>修复了 <code class=syntax>base64</code> 库中的 ThreadSaninitizer 报告. 也把这个库更新到了最新版本, 不过没关系. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8397 rel="external nofollow noreferrer" target=_blank>#8397</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8403 rel="external nofollow noreferrer" target=_blank>#8403</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>修复处理器的 <code class=syntax>00600_replace_running_query</code> . <a href=https://github.com/ClickHouse/ClickHouse/pull/8272 rel="external nofollow noreferrer" target=_blank>#8272</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>删除对 <code class=syntax>tcmalloc</code> 的支持, 使 <code class=syntax>CMakeLists.txt</code> 更简单. <a href=https://github.com/ClickHouse/ClickHouse/pull/8310 rel="external nofollow noreferrer" target=_blank>#8310</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>发布 gcc 构建现在使用 <code class=syntax>libc++</code> 而不是 <code class=syntax>libstdc++</code>. 最近 <code class=syntax>libc++</code> 只与clang 一起使用. 这将提高构建配置和可移植性的一致性. <a href=https://github.com/ClickHouse/ClickHouse/pull/8311 rel="external nofollow noreferrer" target=_blank>#8311</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>启用 ICU 库以使用 MemorySanitizer 进行构建. <a href=https://github.com/ClickHouse/ClickHouse/pull/8222 rel="external nofollow noreferrer" target=_blank>#8222</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>抑制来自 <code class=syntax>CapNProto</code> 库的警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/8224 rel="external nofollow noreferrer" target=_blank>#8224</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>删除了 <code class=syntax>tcmalloc</code> 代码的特殊情况, 因为它不再受支持. <a href=https://github.com/ClickHouse/ClickHouse/pull/8225 rel="external nofollow noreferrer" target=_blank>#8225</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 CI 覆盖任务中, 优雅地杀死服务器以允许它保存覆盖报告. 这修复了我们最近看到的不完整的覆盖报告. <a href=https://github.com/ClickHouse/ClickHouse/pull/8142 rel="external nofollow noreferrer" target=_blank>#8142</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>针对 <code class=syntax>Float64</code> 和 <code class=syntax>UInt64</code> 值对所有编解码器进行性能测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/8349 rel="external nofollow noreferrer" target=_blank>#8349</a> (<a href=https://github.com/Enmk rel="external nofollow noreferrer" target=_blank>Vasily Nemkov</a>)</li> <li><code class=syntax>termcap</code> 非常不推荐使用并导致各种问题 (例如, 缺少“up”cap 和回显 <code class=syntax>^J</code> 而不是多行). 支持<code class=syntax>terminfo</code> 或捆绑 <code class=syntax>ncurses</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7737 rel="external nofollow noreferrer" target=_blank>#7737</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>修复 <code class=syntax>test_storage_s3</code> 集成测试. <a href=https://github.com/ClickHouse/ClickHouse/pull/7734 rel="external nofollow noreferrer" target=_blank>#7734</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>支持 <code class=syntax>StorageFile(&lt;format&gt;, null)</code> 将块插入给定的格式文件而不实际写入磁盘. 这是性能测试所必需的. <a href=https://github.com/ClickHouse/ClickHouse/pull/8455 rel="external nofollow noreferrer" target=_blank>#8455</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> <li>向功能测试添加了参数 <code class=syntax>--print-time</code>, 用于打印每个测试的执行时间. <a href=https://github.com/ClickHouse/ClickHouse/pull/8001 rel="external nofollow noreferrer" target=_blank>#8001</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>在评估 RPN 时向 <code class=syntax>KeyCondition</code> 添加断言. 这将修复来自 gcc-9 的警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/8279 rel="external nofollow noreferrer" target=_blank>#8279</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>在 CI 构建中转储 cmake 选项. <a href=https://github.com/ClickHouse/ClickHouse/pull/8273 rel="external nofollow noreferrer" target=_blank>#8273</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>不要为某些胖库生成调试信息. <a href=https://github.com/ClickHouse/ClickHouse/pull/8271 rel="external nofollow noreferrer" target=_blank>#8271</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>使 <code class=syntax>log_to_console.xml</code> 始终登录到 stderr, 无论它是否交互. <a href=https://github.com/ClickHouse/ClickHouse/pull/8395 rel="external nofollow noreferrer" target=_blank>#8395</a> (<a href=https://github.com/akuzm rel="external nofollow noreferrer" target=_blank>Alexander Kuzmenkov</a>)</li> <li>从 <code class=syntax>clickhouse-performance-test</code> 工具中删除了一些未使用的功能. <a href=https://github.com/ClickHouse/ClickHouse/pull/8555 rel="external nofollow noreferrer" target=_blank>#8555</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>现在我们还将搜索带有相应 <code class=syntax>clang-X</code> 版本的 <code class=syntax>lld-X</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8092 rel="external nofollow noreferrer" target=_blank>#8092</a> (<a href=https://github.com/alesapin rel="external nofollow noreferrer" target=_blank>alesapin</a>)</li> <li>Parquet 构建改进. <a href=https://github.com/ClickHouse/ClickHouse/pull/8421 rel="external nofollow noreferrer" target=_blank>#8421</a> (<a href=https://github.com/maxulan rel="external nofollow noreferrer" target=_blank>maxulan</a>)</li> <li>更多 GCC 警告. <a href=https://github.com/ClickHouse/ClickHouse/pull/8221 rel="external nofollow noreferrer" target=_blank>#8221</a> (<a href=https://github.com/kreuzerkrieg rel="external nofollow noreferrer" target=_blank>kreuzerkrieg</a>)</li> <li>Arch Linux 软件包现在允许运行 ClickHouse 服务器, 而不仅仅是客户端. <a href=https://github.com/ClickHouse/ClickHouse/pull/8534 rel="external nofollow noreferrer" target=_blank>#8534</a> (<a href=https://github.com/excitoon rel="external nofollow noreferrer" target=_blank>Vladimir Chebotarev</a>)</li> <li>使用处理器修复测试. 微小的性能修复. <a href=https://github.com/ClickHouse/ClickHouse/pull/7672 rel="external nofollow noreferrer" target=_blank>#7672</a> (<a href=https://github.com/KochetovNicolai rel="external nofollow noreferrer" target=_blank>Nikolai Kochetov</a>)</li> <li>更新 contrib/protobuf. <a href=https://github.com/ClickHouse/ClickHouse/pull/8256 rel="external nofollow noreferrer" target=_blank>#8256</a> (<a href=https://github.com/matwey rel="external nofollow noreferrer" target=_blank>Matwey V. Kornilov</a>)</li> <li>准备切换到 c++20 作为新年庆祝活动. "May the C++ force be with ClickHouse". <a href=https://github.com/ClickHouse/ClickHouse/pull/8447 rel="external nofollow noreferrer" target=_blank>#8447</a> (<a href=https://github.com/amosbird rel="external nofollow noreferrer" target=_blank>Amos Bird</a>)</li> </ul> <h4 id=shi-yan-gong-neng_8>实验功能<a class=headerlink href=../amp/#shi-yan-gong-neng_8 title="Permanent link"> </a></h4> <ul> <li>添加了实验设置 <code class=syntax>min_bytes_to_use_mmap_io</code>. 它允许读取大文件而无需将数据从内核复制到用户空间. 默认情况下禁用该设置. 推荐的阈值大约是 64 MB, 因为 mmap/munmap 很慢. <a href=https://github.com/ClickHouse/ClickHouse/pull/8520 rel="external nofollow noreferrer" target=_blank>#8520</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> <li>重新设计配额作为访问控制系统的一部分. 添加了新表 <code class=syntax>system.quotas</code>、新函数 <code class=syntax>currentQuota</code>、<code class=syntax>currentQuotaKey</code>、新SQL语法 <code class=syntax>CREATE QUOTA</code>、<code class=syntax>ALTER QUOTA</code>、<code class=syntax>DROP QUOTA</code>、<code class=syntax>SHOW QUOTA</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7257 rel="external nofollow noreferrer" target=_blank>#7257</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>允许跳过带有警告的未知设置而不是抛出异常. <a href=https://github.com/ClickHouse/ClickHouse/pull/7653 rel="external nofollow noreferrer" target=_blank>#7653</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> <li>重新设计行策略作为访问控制系统的一部分. 添加新表<code class=syntax>system.row_policies</code>、新函数 <code class=syntax>currentRowPolicies()</code>、新SQL语法 <code class=syntax>CREATE POLICY</code>、<code class=syntax>ALTER POLICY</code>、<code class=syntax>DROP POLICY</code>、<code class=syntax>SHOW CREATE POLICY</code>、<code class=syntax>SHOW POLICIES</code>. <a href=https://github.com/ClickHouse/ClickHouse/pull/7808 rel="external nofollow noreferrer" target=_blank>#7808</a> (<a href=https://github.com/vitlibar rel="external nofollow noreferrer" target=_blank>Vitaly Baranov</a>)</li> </ul> <h4 id=security-fix>Security Fix<a class=headerlink href=../amp/#security-fix title="Permanent link"> </a></h4> <ul> <li>修复了使用 <code class=syntax>File</code> 表引擎读取表中目录结构的可能性. 这修复了 <a href=https://github.com/ClickHouse/ClickHouse/issues/8536 rel="external nofollow noreferrer" target=_blank>#8536</a>. <a href=https://github.com/ClickHouse/ClickHouse/pull/8537 rel="external nofollow noreferrer" target=_blank>#8537</a> (<a href=https://github.com/alexey-milovidov rel="external nofollow noreferrer" target=_blank>alexey-milovidov</a>)</li> </ul> <h2 id=changelog-for-2019><a href=https://github.com/ClickHouse/ClickHouse/blob/master/docs/en/whats-new/changelog/2019.md rel="external nofollow noreferrer" target=_blank>Changelog for 2019</a><a class=headerlink href=../amp/#changelog-for-2019 title="Permanent link"> </a></h2>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2022 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/c60fd44c5b70c56ff0f9c7fc538e58c6c8186aea" rel="external nofollow noreferrer" target="_blank" class="text-reset">c60fd44c</a>
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/zh/whats-new/changelog/2020/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
