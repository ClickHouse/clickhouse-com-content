










    



    



    



    
    






    <!doctype html>
<html ⚡ lang="zh">
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <title>system.query_log | ClickHouse文档</title>
    <link rel="canonical" href="https://clickhouse.com/docs/zh/operations/system-tables/query_log/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    
<script type="application/ld+json">[{
"@context": "http://schema.org",
"@type": "TechArticle",
"headline": "system.query_log | ClickHouse文档",
"mainEntityOfPage": "https://clickhouse.com/docs/zh/operations/system-tables/query_log/",




"image": "https://clickhouse.com/images/clickhouse-209x60.png",
"author": {
  "@type": "Project",
  "name": "ClickHouse"
},
"publisher": {
  "@type": "Organization",
  "name": "ClickHouse, Inc.",
  "logo": {
    "@type": "ImageObject",
    "url": "https://clickhouse.com/images/logo-400x240.png",
    "width": 400,
    "height": 240
  }
}}, {
"@context": "http://schema.org",
"@type": "Episode",
"name": "system.query_log | ClickHouse文档",
"aggregateRating": {
  "@type": "AggregateRating",
  "ratingValue": RATING_VALUE,
  "ratingCount": RATING_COUNT
}
}]</script>

    
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--gray:#6c757d;--gray-dark:#343a40;--brand-primary:#fc0;--brand-secondary:#ff3939;--primary-accent-yellow:#fc0;--primary-accent-light-yellow:#fffaf0;--primary-accent-blue:#257af4;--primary-accent-light-blue:#e3f1fe;--secondary-accent-orange:#ff8c00;--secondary-accent-light-orange:#ffe4b5;--secondary-accent-red:#ff3939;--secondary-accent-light-red:#ffe4e1;--primary:#fc0;--secondary:#212529;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f1f6f9;--dark:#495057;--primary-light:#fffaf0;--secondary-light:#fff;--tertiary:#257af4;--tertiary-light:#e3f1fe;--white:#fff;--black:#212529;--blue:#257af4;--light-blue:#e3f1fe;--yellow:#fc0;--light-yellow:#fffaf0;--orange:#ff8c00;--light-orange:#ffe4b5;--red:#ff3939;--light-red:#ffe4e1;--medium:#d6dbdf;--breakpoint-xxs:0;--breakpoint-xs:400px;--breakpoint-sm:616px;--breakpoint-md:768px;--breakpoint-lg:980px;--breakpoint-xl:1240px;--font-family-sans-serif:"Noto Sans",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}*,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(33,37,41,0)}article,footer,header,main{display:block}body{margin:0;font-family:Noto Sans,sans-serif;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}[tabindex="-1"]:focus:not(:focus-visible){outline:0}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:16px}p{margin-top:0;margin-bottom:1rem}address{font-style:normal;line-height:inherit}address,ol,ul{margin-bottom:1rem}ol,ul{margin-top:0}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}b,strong{font-weight:bolder}a{text-decoration:none;background-color:transparent}a,a:hover{color:#ff8c00}a:hover{text-decoration:underline}a:not([href]),a:not([href]):hover{color:inherit;text-decoration:none}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}select{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit]{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{padding:0;border-style:none}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:16px;font-family:Hind Siliguri,sans-serif;font-weight:500;line-height:1.125}.h1,h1{font-size:2.5rem}@media(max-width:1200px){.h1,h1{font-size:calc(1.375rem+1.5vw)}}.h2,h2{font-size:2rem}@media(max-width:1200px){.h2,h2{font-size:calc(1.325rem+.9vw)}}.h3,h3{font-size:1.75rem}@media(max-width:1200px){.h3,h3{font-size:calc(1.3rem+.6vw)}}.h4,h4{font-size:1.5rem}@media(max-width:1200px){.h4,h4{font-size:calc(1.275rem+.3vw)}}.h5,h5{font-size:1.125rem}.h6,h6{font-size:.875rem}.lead{font-size:1.375rem;font-weight:400}@media(max-width:1200px){.lead{font-size:calc(1.2625rem+.15vw)}}.display-1{font-size:4rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-1{font-size:calc(1.525rem+3.3vw)}}.display-2{font-size:2.5rem;font-weight:600;line-height:1.125}@media(max-width:1200px){.display-2{font-size:calc(1.375rem+1.5vw)}}.display-3{font-size:2rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-3{font-size:calc(1.325rem+.9vw)}}.display-4{font-size:1.75rem;font-weight:500;line-height:1.125}@media(max-width:1200px){.display-4{font-size:calc(1.3rem+.6vw)}}.img-fluid{max-width:100%;height:auto}code{font-size:87.5%;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}pre{display:block;font-size:87.5%;color:#495057}pre code{font-size:inherit;color:inherit;word-break:normal}.container{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container{max-width:958px}}@media(min-width:980px){.container{max-width:1008px}}@media(min-width:1240px){.container{max-width:1118px}}.container-fluid,.container-lg,.container-md{width:100%;padding-right:20px;padding-left:20px;margin-right:auto;margin-left:auto}@media(min-width:400px){.container{max-width:576px}}@media(min-width:616px){.container{max-width:576px}}@media(min-width:768px){.container,.container-md{max-width:958px}}@media(min-width:980px){.container,.container-lg,.container-md{max-width:1008px}}@media(min-width:1240px){.container,.container-lg,.container-md{max-width:1118px}}.row{display:flex;flex-wrap:wrap;margin-right:-20px;margin-left:-20px}.col,.col-1,.col-10,.col-11,.col-12,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{position:relative;width:100%;padding-right:20px;padding-left:20px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-12{flex:0 0 100%;max-width:100%}@media(min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-md-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-md-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-md-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-md-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-md-12{flex:0 0 100%;max-width:100%}}@media(min-width:980px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.3333333333%;max-width:8.3333333333%}.col-lg-2{flex:0 0 16.6666666667%;max-width:16.6666666667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.3333333333%;max-width:33.3333333333%}.col-lg-5{flex:0 0 41.6666666667%;max-width:41.6666666667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.3333333333%;max-width:58.3333333333%}.col-lg-8{flex:0 0 66.6666666667%;max-width:66.6666666667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.3333333333%;max-width:83.3333333333%}.col-lg-11{flex:0 0 91.6666666667%;max-width:91.6666666667%}.col-lg-12{flex:0 0 100%;max-width:100%}}.table{width:100%;margin-bottom:8px;color:#212529}.table-primary{background-color:#fff1b8}.table-light{background-color:#fbfcfd}.table-dark{background-color:#ccced0}.table-primary-light{background-color:#fffefb}.table-white{background-color:#fff}.table-black{background-color:#c1c2c3}.table-orange{background-color:#ffdfb8}.table-light-orange{background-color:#fff7ea}.table-dark{color:#fff;background-color:#343a40}.btn{display:inline-block;font-family:inherit;font-weight:700;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 32px;font-size:.875rem;line-height:20px;border-radius:8px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.btn{transition:none}}.btn:hover{color:#212529;text-decoration:none}.btn:focus{outline:0;box-shadow:none}.btn:disabled{opacity:.65}.btn-primary{color:#495057;background-color:#fc0;border-color:#fc0}.btn-primary:focus,.btn-primary:hover{color:#495057;background-color:#d9ad00;border-color:#cca300}.btn-primary:focus{box-shadow:0 0 0 0 rgba(228,185,13,.5)}.btn-primary:disabled{color:#495057;background-color:#fc0;border-color:#fc0}.btn-light{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-light:focus,.btn-light:hover{color:#495057;background-color:#d6e5ee;border-color:#cddfea}.btn-light:focus{box-shadow:0 0 0 0 rgba(216,221,225,.5)}.btn-light:disabled{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-dark{color:#fff;background-color:#495057;border-color:#495057}.btn-dark:focus,.btn-dark:hover{color:#fff;background-color:#383d42;border-color:#32373b}.btn-dark:focus{box-shadow:0 0 0 0 rgba(100,106,112,.5)}.btn-dark:disabled{color:#fff;background-color:#495057;border-color:#495057}.btn-primary-light{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-primary-light:focus,.btn-primary-light:hover{color:#495057;background-color:#ffedca;border-color:#ffe9bd}.btn-primary-light:focus{box-shadow:0 0 0 0 rgba(228,225,217,.5)}.btn-primary-light:disabled{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-white{color:#495057;background-color:#fff;border-color:#fff}.btn-white:focus,.btn-white:hover{color:#495057;background-color:#ececec;border-color:#e6e6e6}.btn-white:focus{box-shadow:0 0 0 0 rgba(228,229,230,.5)}.btn-white:disabled{color:#495057;background-color:#fff;border-color:#fff}.btn-black{color:#fff;background-color:#212529;border-color:#212529}.btn-black:focus,.btn-black:hover{color:#fff;background-color:#101214;border-color:#0a0c0d}.btn-black:focus{box-shadow:0 0 0 0 rgba(66,70,73,.5)}.btn-black:disabled{color:#fff;background-color:#212529;border-color:#212529}.btn-orange{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-orange:focus,.btn-orange:hover{color:#fff;background-color:#d97700;border-color:#cc7000}.btn-orange:focus{box-shadow:0 0 0 0 rgba(228,131,13,.5)}.btn-orange:disabled{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-light-orange{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-light-orange:focus,.btn-light-orange:hover{color:#495057;background-color:#ffd68f;border-color:#ffd182}.btn-light-orange:focus{box-shadow:0 0 0 0 rgba(228,206,167,.5)}.btn-light-orange:disabled{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-primary{color:#fc0;border-color:#fc0}.btn-outline-primary:hover{color:#495057;background-color:#fc0;border-color:#fc0}.btn-outline-primary:focus{box-shadow:0 0 0 0 rgba(255,204,0,.5)}.btn-outline-primary:disabled{color:#fc0;background-color:transparent}.btn-outline-light{color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:hover{color:#495057;background-color:#f1f6f9;border-color:#f1f6f9}.btn-outline-light:focus{box-shadow:0 0 0 0 rgba(241,246,249,.5)}.btn-outline-light:disabled{color:#f1f6f9;background-color:transparent}.btn-outline-dark{color:#495057;border-color:#495057}.btn-outline-dark:hover{color:#fff;background-color:#495057;border-color:#495057}.btn-outline-dark:focus{box-shadow:0 0 0 0 rgba(73,80,87,.5)}.btn-outline-dark:disabled{color:#495057;background-color:transparent}.btn-outline-primary-light{color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:hover{color:#495057;background-color:#fffaf0;border-color:#fffaf0}.btn-outline-primary-light:focus{box-shadow:0 0 0 0 rgba(255,250,240,.5)}.btn-outline-primary-light:disabled{color:#fffaf0;background-color:transparent}.btn-outline-white{color:#fff;border-color:#fff}.btn-outline-white:hover{color:#495057;background-color:#fff;border-color:#fff}.btn-outline-white:focus{box-shadow:0 0 0 0 hsla(0,0%,100%,.5)}.btn-outline-white:disabled{color:#fff;background-color:transparent}.btn-outline-black{color:#212529;border-color:#212529}.btn-outline-black:hover{color:#fff;background-color:#212529;border-color:#212529}.btn-outline-black:focus{box-shadow:0 0 0 0 rgba(33,37,41,.5)}.btn-outline-black:disabled{color:#212529;background-color:transparent}.btn-outline-orange{color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:hover{color:#495057;background-color:#ff8c00;border-color:#ff8c00}.btn-outline-orange:focus{box-shadow:0 0 0 0 rgba(255,140,0,.5)}.btn-outline-orange:disabled{color:#ff8c00;background-color:transparent}.btn-outline-light-orange{color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:hover{color:#495057;background-color:#ffe4b5;border-color:#ffe4b5}.btn-outline-light-orange:focus{box-shadow:0 0 0 0 rgba(255,228,181,.5)}.btn-outline-light-orange:disabled{color:#ffe4b5;background-color:transparent}.btn-link{font-weight:400;color:#ff8c00;text-decoration:none}.btn-link:hover{color:#ff8c00;text-decoration:underline}.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link:disabled{color:#d6dbdf;pointer-events:none}.btn-group-lg>.btn,.btn-lg{padding:16px 32px;font-size:1.125rem;line-height:26px;border-radius:8px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:24px}.btn-group,.btn-group-vertical{position:relative;display:inline-flex;vertical-align:middle}.btn-group-vertical>.btn,.btn-group>.btn{position:relative;flex:1 1 auto}.btn-group-vertical>.btn:active,.btn-group-vertical>.btn:focus,.btn-group-vertical>.btn:hover,.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:1}.btn-group>.btn-group:not(:first-child),.btn-group>.btn:not(:first-child){margin-left:-1px}.btn-group>.btn-group:not(:last-child)>.btn{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:not(:first-child)>.btn,.btn-group>.btn:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.btn-group-vertical{flex-direction:column;align-items:flex-start;justify-content:center}.btn-group-vertical>.btn,.btn-group-vertical>.btn-group{width:100%}.btn-group-vertical>.btn-group:not(:first-child),.btn-group-vertical>.btn:not(:first-child){margin-top:-1px}.btn-group-vertical>.btn-group:not(:last-child)>.btn{border-bottom-right-radius:0;border-bottom-left-radius:0}.btn-group-vertical>.btn-group:not(:first-child)>.btn,.btn-group-vertical>.btn:not(:first-child){border-top-left-radius:0;border-top-right-radius:0}.custom-select{display:inline-block;width:100%;height:calc(1.5em+.75rem+2px);padding:.375rem 1.75rem .375rem .75rem;font-size:1rem;font-weight:400;line-height:1.5;color:#6c757d;vertical-align:middle;background:#fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center/8px 10px;border:1px solid #ced4da;border-radius:8px;-webkit-appearance:none;-moz-appearance:none;appearance:none}.custom-select:focus{border-color:#ffe680;outline:0;box-shadow:0 0 0 .2rem rgba(255,204,0,.25)}.custom-select:focus::-ms-value{color:#6c757d;background-color:#fff}.custom-select[multiple],.custom-select[size]:not([size="1"]){height:auto;padding-right:.75rem;background-image:none}.custom-select:disabled{color:#6c757d;background-color:#e9ecef}.custom-select::-ms-expand{display:none}.custom-select:-moz-focusring{color:transparent;text-shadow:0 0 0 #6c757d}.custom-select-lg{height:calc(1.5em+1rem+2px);padding-top:.5rem;padding-bottom:.5rem;padding-left:1rem;font-size:1.125rem}.custom-select{transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}@media(prefers-reduced-motion:reduce){.custom-select{transition:none}}pre{white-space:pre-wrap}pre{border:1px solid #d6dbdf;page-break-inside:avoid}img{page-break-inside:avoid}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}@page{size:a3}.container,body{min-width:980px}.table{border-collapse:collapse}.table-dark{color:inherit}</style>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>
  </head>
  <body class="amp" dir="ltr">
    <div class="container-fluid container-lg pb-5">
      <div class="row pt-3 mb-3">
        <div class="col">
          <a href="/" class="text-decoration-none">
            <amp-img class="d-inline-block mr-3" layout="fixed" width="40" height="36" src="/docs/images/logo.svg" alt="ClickHouse logo" title="ClickHouse logo"></amp-img><amp-img class="invert-dark d-inline-block" layout="fixed" width="238" height="36" src="/docs/images/clickhouse-black.svg" alt="ClickHouse" title="ClickHouse"></amp-img>
          </a>
        </div>
      </div>
      <div class="row">
        <div id="content" class="col">
          
    <div class="alert alert-primary" role="alert">
      <p class="display-5 mb-2">Help wanted!</p>
      <p class="lead">The following content of this documentation page has been machine-translated. But unlike other websites, it is not done on the fly. This translated text lives on GitHub repository alongside main ClickHouse codebase and waits for fellow native speakers to make it more human-readable. <a href="/docs/en/operations/system-tables/query_log/" class="alert-link">You can also use the original English version as a reference.</a></p>
      <p class="lead">
          <a class="btn btn-lg btn-primary text-white" href="https://github.com/ClickHouse/ClickHouse/edit/master/docs/zh/operations/system-tables/query_log.md" target="_blank" rel="external nofollow noreferrer">
              Help ClickHouse documentation by editing this page
          </a>
      </p>
    </div>

          <h1 id=system_tables-query_log>system.query_log<a class=headerlink href=../amp/#system_tables-query_log title="Permanent link"> </a></h1> <p>包含已执行查询的相关信息，例如：开始时间、处理持续时间、错误消息。</p> <div class="admonition note alert pb-0 mb-4 alert-primary" role=alert> <p class="admonition-title alert-heading display-4 text-reset mb-2">注</p> <p>此表不包含以下内容的摄取数据 <code class=syntax>INSERT</code> 查询。</p> </div> <p>您可以更改query_log的设置，在服务器配置的 <a href=../../../server-configuration-parameters/settings/amp/#server_configuration_parameters-query-log>query_log</a> 部分。</p> <p>您可以通过设置 <a href=../../../settings/settings/amp/#settings-log-queries>log_queries=0</a>来禁用query_log. 我们不建议关闭此日志，因为此表中的信息对于解决问题很重要。</p> <p>数据刷新的周期可通过 <code class=syntax>flush_interval_milliseconds</code> 参数来设置 <a href=../../../server-configuration-parameters/settings/amp/#server_configuration_parameters-query-log>query_log</a> 。 要强制刷新，请使用 <a href=../../../../sql-reference/statements/system/amp/#query_language-system-flush_logs>SYSTEM FLUSH LOGS</a>。</p> <p>ClickHouse不会自动从表中删除数据。更多详情请看 <a href=../../amp/#system-tables-introduction>introduction</a> 。</p> <p><code class=syntax>system.query_log</code> 表注册两种查询:</p> <ol> <li>客户端直接运行的初始查询。</li> <li>由其他查询启动的子查询（用于分布式查询执行）。 对于这些类型的查询，有关父查询的信息显示在 <code class=syntax>initial_*</code> 列。</li> </ol> <p>每个查询在<code class=syntax>query_log</code> 表中创建一或两行记录，这取决于查询的状态（见 <code class=syntax>type</code> 列）:</p> <ol> <li>如果查询执行成功，会创建type分别为<code class=syntax>QueryStart</code> 和 <code class=syntax>QueryFinish</code> 的两行记录。</li> <li>如果在查询处理过程中发生错误，会创建type分别为<code class=syntax>QueryStart</code> 和 <code class=syntax>ExceptionWhileProcessing</code> 的两行记录。</li> <li>如果在启动查询之前发生错误，则创建一行type为<code class=syntax>ExceptionBeforeStart</code> 的记录。</li> </ol> <p>列:</p> <ul> <li><code class=syntax>type</code> (<a href=../../../../sql-reference/data-types/enum/amp/ >Enum8</a>) — 执行查询时的事件类型. 值:<ul> <li><code class=syntax>'QueryStart' = 1</code> — 查询成功启动.</li> <li><code class=syntax>'QueryFinish' = 2</code> — 查询成功完成.</li> <li><code class=syntax>'ExceptionBeforeStart' = 3</code> — 查询执行前有异常.</li> <li><code class=syntax>'ExceptionWhileProcessing' = 4</code> — 查询执行期间有异常.</li> </ul> </li> <li><code class=syntax>event_date</code> (<a href=../../../../sql-reference/data-types/date/amp/ >Date</a>) — 查询开始日期.</li> <li><code class=syntax>event_time</code> (<a href=../../../../sql-reference/data-types/datetime/amp/ >DateTime</a>) — 查询开始时间.</li> <li><code class=syntax>event_time_microseconds</code> (<a href=../../../../sql-reference/data-types/datetime64/amp/ >DateTime64</a>) — 查询开始时间（毫秒精度）.</li> <li><code class=syntax>query_start_time</code> (<a href=../../../../sql-reference/data-types/datetime/amp/ >DateTime</a>) — 查询执行的开始时间.</li> <li><code class=syntax>query_start_time_microseconds</code> (DateTime64) — 查询执行的开始时间（毫秒精度）.</li> <li><code class=syntax>query_duration_ms</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/#uint-ranges>UInt64</a>) — 查询消耗的时间（毫秒）.</li> <li><code class=syntax>read_rows</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/#uint-ranges>UInt64</a>) — 从参与了查询的所有表和表函数读取的总行数. 包括：普通的子查询, <code class=syntax>IN</code> 和 <code class=syntax>JOIN</code>的子查询. 对于分布式查询 <code class=syntax>read_rows</code> 包括在所有副本上读取的行总数。 每个副本发送它的 <code class=syntax>read_rows</code> 值，并且查询的服务器-发起方汇总所有接收到的和本地的值。 缓存卷不会影响此值。</li> <li><code class=syntax>read_bytes</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/#uint-ranges>UInt64</a>) — 从参与了查询的所有表和表函数读取的总字节数. 包括：普通的子查询, <code class=syntax>IN</code> 和 <code class=syntax>JOIN</code>的子查询. 对于分布式查询 <code class=syntax>read_bytes</code> 包括在所有副本上读取的字节总数。 每个副本发送它的 <code class=syntax>read_bytes</code> 值，并且查询的服务器-发起方汇总所有接收到的和本地的值。 缓存卷不会影响此值。</li> <li><code class=syntax>written_rows</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/#uint-ranges>UInt64</a>) — 对于 <code class=syntax>INSERT</code> 查询，为写入的行数。 对于其他查询，值为0。</li> <li><code class=syntax>written_bytes</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/#uint-ranges>UInt64</a>) — 对于 <code class=syntax>INSERT</code> 查询时，为写入的字节数。 对于其他查询，值为0。</li> <li><code class=syntax>result_rows</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/#uint-ranges>UInt64</a>) — <code class=syntax>SELECT</code> 查询结果的行数，或<code class=syntax>INSERT</code> 的行数。</li> <li><code class=syntax>result_bytes</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/#uint-ranges>UInt64</a>) — 存储查询结果的RAM量.</li> <li><code class=syntax>memory_usage</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/#uint-ranges>UInt64</a>) — 查询使用的内存.</li> <li><code class=syntax>query</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — 查询语句.</li> <li><code class=syntax>exception</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — 异常信息.</li> <li><code class=syntax>exception_code</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/ >Int32</a>) — 异常码.</li> <li><code class=syntax>stack_trace</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — <a href=https://en.wikipedia.org/wiki/Stack_trace rel="external nofollow noreferrer" target=_blank>Stack Trace</a>. 如果查询成功完成，则为空字符串。</li> <li><code class=syntax>is_initial_query</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/ >UInt8</a>) — 查询类型. 可能的值:<ul> <li>1 — 客户端发起的查询.</li> <li>0 — 由另一个查询发起的，作为分布式查询的一部分.</li> </ul> </li> <li><code class=syntax>user</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — 发起查询的用户.</li> <li><code class=syntax>query_id</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — 查询ID.</li> <li><code class=syntax>address</code> (<a href=../../../../sql-reference/data-types/domains/ipv6/amp/ >IPv6</a>) — 发起查询的客户端IP地址.</li> <li><code class=syntax>port</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/ >UInt16</a>) — 发起查询的客户端端口.</li> <li><code class=syntax>initial_user</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — 初始查询的用户名（用于分布式查询执行）.</li> <li><code class=syntax>initial_query_id</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — 运行初始查询的ID（用于分布式查询执行）.</li> <li><code class=syntax>initial_address</code> (<a href=../../../../sql-reference/data-types/domains/ipv6/amp/ >IPv6</a>) — 运行父查询的IP地址.</li> <li><code class=syntax>initial_port</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/ >UInt16</a>) — 发起父查询的客户端端口.</li> <li><code class=syntax>interface</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/ >UInt8</a>) — 发起查询的接口. 可能的值:<ul> <li>1 — TCP.</li> <li>2 — HTTP.</li> </ul> </li> <li><code class=syntax>os_user</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — 运行 <a href=../../../../interfaces/cli/amp/ >clickhouse-client</a>的操作系统用户名.</li> <li><code class=syntax>client_hostname</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — 运行<a href=../../../../interfaces/cli/amp/ >clickhouse-client</a> 或其他TCP客户端的机器的主机名。</li> <li><code class=syntax>client_name</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — <a href=../../../../interfaces/cli/amp/ >clickhouse-client</a> 或其他TCP客户端的名称。</li> <li><code class=syntax>client_revision</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/ >UInt32</a>) — <a href=../../../../interfaces/cli/amp/ >clickhouse-client</a> 或其他TCP客户端的Revision。</li> <li><code class=syntax>client_version_major</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/ >UInt32</a>) — <a href=../../../../interfaces/cli/amp/ >clickhouse-client</a> 或其他TCP客户端的Major version。</li> <li><code class=syntax>client_version_minor</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/ >UInt32</a>) — <a href=../../../../interfaces/cli/amp/ >clickhouse-client</a> 或其他TCP客户端的Minor version。</li> <li><code class=syntax>client_version_patch</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/ >UInt32</a>) — <a href=../../../../interfaces/cli/amp/ >clickhouse-client</a> 或其他TCP客户端的Patch component。</li> <li><code class=syntax>http_method</code> (UInt8) — 发起查询的HTTP方法. 可能值:<ul> <li>0 — TCP接口的查询.</li> <li>1 — <code class=syntax>GET</code></li> <li>2 — <code class=syntax>POST</code></li> </ul> </li> <li><code class=syntax>http_user_agent</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — The <code class=syntax>UserAgent</code> The UserAgent header passed in the HTTP request。</li> <li><code class=syntax>quota_key</code> (<a href=../../../../sql-reference/data-types/string/amp/ >String</a>) — 在<a href=../../../quotas/amp/ >quotas</a> 配置里设置的“quota key” （见 <code class=syntax>keyed</code>).</li> <li><code class=syntax>revision</code> (<a href=../../../../sql-reference/data-types/int-uint/amp/ >UInt32</a>) — ClickHouse revision.</li> <li><code class=syntax>ProfileEvents</code> (<a href=../../../../sql-reference/data-types/array/amp/ >Map(String, UInt64))</a>) — Counters that measure different metrics. The description of them could be found in the table <a href=../../events/amp/#system_tables-events>系统。活动</a></li> <li><code class=syntax>Settings</code> (<a href=../../../../sql-reference/data-types/array/amp/ >Map(String, String)</a>) — Names of settings that were changed when the client ran the query. To enable logging changes to settings, set the <code class=syntax>log_query_settings</code> 参数为1。</li> <li><code class=syntax>thread_ids</code> (<a href=../../../../sql-reference/data-types/array/amp/ >Array(UInt64)</a>) — 参与查询的线程数.</li> <li><code class=syntax>Settings.Names</code> (<a href=../../../../sql-reference/data-types/array/amp/ >Array（String)</a>) — 客户端运行查询时更改的设置的名称。 要启用对设置的日志记录更改，请将log_query_settings参数设置为1。</li> <li><code class=syntax>Settings.Values</code> (<a href=../../../../sql-reference/data-types/array/amp/ >Array（String)</a>) — <code class=syntax>Settings.Names</code> 列中列出的设置的值。<br> <strong>示例</strong></li> </ul> <div class=codehilite><pre><span></span><code class=syntax><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>system</span><span class=p>.</span><span class=n>query_log</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>FORMAT</span><span class=w> </span><span class=n>Vertical</span><span class=p>;</span><span class=w></span>
</code></pre></div> <div class=codehilite><pre><span></span><code class=syntax>Row 1:
──────
type:                 QueryStart
event_date:           2020-05-13
event_time:           2020-05-13 14:02:28
query_start_time:     2020-05-13 14:02:28
query_duration_ms:    0
read_rows:            0
read_bytes:           0
written_rows:         0
written_bytes:        0
result_rows:          0
result_bytes:         0
memory_usage:         0
query:                SELECT 1
exception_code:       0
exception:
stack_trace:
is_initial_query:     1
user:                 default
query_id:             5e834082-6f6d-4e34-b47b-cd1934f4002a
address:              ::ffff:127.0.0.1
port:                 57720
initial_user:         default
initial_query_id:     5e834082-6f6d-4e34-b47b-cd1934f4002a
initial_address:      ::ffff:127.0.0.1
initial_port:         57720
interface:            1
os_user:              bayonet
client_hostname:      clickhouse.ru-central1.internal
client_name:          ClickHouse client
client_revision:      54434
client_version_major: 20
client_version_minor: 4
client_version_patch: 1
http_method:          0
http_user_agent:
quota_key:
revision:             54434
thread_ids:           []
ProfileEvents:        {'Query':1,'SelectQuery':1,'ReadCompressedBytes':36,'CompressedReadBufferBlocks':1,'CompressedReadBufferBytes':10,'IOBufferAllocs':1,'IOBufferAllocBytes':89,'ContextLock':15,'RWLockAcquiredReadLocks':1}
Settings:             {'background_pool_size':'32','load_balancing':'random','allow_suspicious_low_cardinality_types':'1','distributed_aggregation_memory_efficient':'1','skip_unavailable_shards':'1','log_queries':'1','max_bytes_before_external_group_by':'20000000000','max_bytes_before_external_sort':'20000000000','allow_introspection_functions':'1'}
</code></pre></div> <p><strong>另请参阅</strong></p> <ul> <li><a href=../../query_thread_log/amp/#system_tables-query_thread_log>system.query_thread_log</a> — 这个表包含了每个查询执行线程的信息</li> </ul>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
<div class="alert alert-light my-3">
  <p class="float-right mb-0">Rating: RATING_VALUE - RATING_COUNT votes</p>
  <span class="alert-heading display-6">Article Rating</span>
  <div id="rating-stars" class="display-6 mb-0"
     
  >RATING_STARS</div>
</div>

<div id="content-footer" class="text-muted pt-3 mb-5">
    <div class="float-md-right">©2016–2022 ClickHouse, Inc.</div>
    <div>Built from <a href="https://github.com/ClickHouse/ClickHouse/commit/38993f215f9186c1ac3505b1e09697cd9a468b5d" rel="external nofollow noreferrer" target="_blank" class="text-reset">38993f21</a>
    
    </div>
</div>

        </div>
      </div>
      <div id="to-full-website" class="row fixed-bottom text-center bg-white py-3">
        <div class="col">
          <a class="btn btn-lg btn-outline-orange" href="https://clickhouse.com/docs/zh/operations/system-tables/query_log/">To full website</a>
        </div>
      </div>
    </div>
    <amp-analytics type="metrika">
      <script type="application/json">{
"vars": {
  "counterId": "18343495",
  "triggers": {
    "notBounce": {
      "on": "timer",
      "timerSpec": {
        "immediate": false,
        "interval": 15,
        "maxTimerLength": 16
      },
      "request": "notBounce"
    }
  }
}
}</script>
  </amp-analytics>
  </body>
</html>
